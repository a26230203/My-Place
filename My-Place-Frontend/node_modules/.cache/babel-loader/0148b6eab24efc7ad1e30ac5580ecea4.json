{"ast":null,"code":"/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.8.2 (2021-06-23)\n */\n(function () {\n  'use strict';\n\n  var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n  var __assign = function () {\n    __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n\n      return t;\n    };\n\n    return __assign.apply(this, arguments);\n  };\n\n  var typeOf = function (x) {\n    var t = typeof x;\n\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n\n  var isType = function (type) {\n    return function (value) {\n      return typeOf(value) === type;\n    };\n  };\n\n  var isSimpleType = function (type) {\n    return function (value) {\n      return typeof value === type;\n    };\n  };\n\n  var eq = function (t) {\n    return function (a) {\n      return t === a;\n    };\n  };\n\n  var isString = isType('string');\n  var isObject = isType('object');\n  var isArray = isType('array');\n  var isNull = eq(null);\n  var isBoolean = isSimpleType('boolean');\n\n  var isNullable = function (a) {\n    return a === null || a === undefined;\n  };\n\n  var isNonNullable = function (a) {\n    return !isNullable(a);\n  };\n\n  var isNumber = isSimpleType('number');\n\n  var noop = function () {};\n\n  var constant = function (value) {\n    return function () {\n      return value;\n    };\n  };\n\n  var never = constant(false);\n  var always = constant(true);\n\n  var none = function () {\n    return NONE;\n  };\n\n  var NONE = function () {\n    var eq = function (o) {\n      return o.isNone();\n    };\n\n    var call = function (thunk) {\n      return thunk();\n    };\n\n    var id = function (n) {\n      return n;\n    };\n\n    var me = {\n      fold: function (n, _s) {\n        return n();\n      },\n      is: never,\n      isSome: never,\n      isNone: always,\n      getOr: id,\n      getOrThunk: call,\n      getOrDie: function (msg) {\n        throw new Error(msg || 'error: getOrDie called on none.');\n      },\n      getOrNull: constant(null),\n      getOrUndefined: constant(undefined),\n      or: id,\n      orThunk: call,\n      map: none,\n      each: noop,\n      bind: none,\n      exists: never,\n      forall: always,\n      filter: none,\n      equals: eq,\n      equals_: eq,\n      toArray: function () {\n        return [];\n      },\n      toString: constant('none()')\n    };\n    return me;\n  }();\n\n  var some = function (a) {\n    var constant_a = constant(a);\n\n    var self = function () {\n      return me;\n    };\n\n    var bind = function (f) {\n      return f(a);\n    };\n\n    var me = {\n      fold: function (n, s) {\n        return s(a);\n      },\n      is: function (v) {\n        return a === v;\n      },\n      isSome: always,\n      isNone: never,\n      getOr: constant_a,\n      getOrThunk: constant_a,\n      getOrDie: constant_a,\n      getOrNull: constant_a,\n      getOrUndefined: constant_a,\n      or: self,\n      orThunk: self,\n      map: function (f) {\n        return some(f(a));\n      },\n      each: function (f) {\n        f(a);\n      },\n      bind: bind,\n      exists: bind,\n      forall: bind,\n      filter: function (f) {\n        return f(a) ? me : NONE;\n      },\n      toArray: function () {\n        return [a];\n      },\n      toString: function () {\n        return 'some(' + a + ')';\n      },\n      equals: function (o) {\n        return o.is(a);\n      },\n      equals_: function (o, elementEq) {\n        return o.fold(never, function (b) {\n          return elementEq(a, b);\n        });\n      }\n    };\n    return me;\n  };\n\n  var from = function (value) {\n    return value === null || value === undefined ? NONE : some(value);\n  };\n\n  var Optional = {\n    some: some,\n    none: none,\n    from: from\n  };\n  var keys = Object.keys;\n  var hasOwnProperty = Object.hasOwnProperty;\n\n  var each = function (obj, f) {\n    var props = keys(obj);\n\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n\n  var objAcc = function (r) {\n    return function (x, i) {\n      r[i] = x;\n    };\n  };\n\n  var internalFilter = function (obj, pred, onTrue, onFalse) {\n    var r = {};\n    each(obj, function (x, i) {\n      (pred(x, i) ? onTrue : onFalse)(x, i);\n    });\n    return r;\n  };\n\n  var filter = function (obj, pred) {\n    var t = {};\n    internalFilter(obj, pred, objAcc(t), noop);\n    return t;\n  };\n\n  var has = function (obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n\n  var hasNonNullableKey = function (obj, key) {\n    return has(obj, key) && obj[key] !== undefined && obj[key] !== null;\n  };\n\n  var nativePush = Array.prototype.push;\n\n  var flatten = function (xs) {\n    var r = [];\n\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n\n      nativePush.apply(r, xs[i]);\n    }\n\n    return r;\n  };\n\n  var get = function (xs, i) {\n    return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();\n  };\n\n  var head = function (xs) {\n    return get(xs, 0);\n  };\n\n  var findMap = function (arr, f) {\n    for (var i = 0; i < arr.length; i++) {\n      var r = f(arr[i], i);\n\n      if (r.isSome()) {\n        return r;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var Global = typeof window !== 'undefined' ? window : Function('return this;')();\n\n  var rawSet = function (dom, key, value) {\n    if (isString(value) || isBoolean(value) || isNumber(value)) {\n      dom.setAttribute(key, value + '');\n    } else {\n      console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n      throw new Error('Attribute value was not simple');\n    }\n  };\n\n  var set = function (element, key, value) {\n    rawSet(element.dom, key, value);\n  };\n\n  var remove = function (element, key) {\n    element.dom.removeAttribute(key);\n  };\n\n  var fromHtml = function (html, scope) {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n\n    if (!div.hasChildNodes() || div.childNodes.length > 1) {\n      console.error('HTML does not have a single root node', html);\n      throw new Error('HTML must have a single root node');\n    }\n\n    return fromDom(div.childNodes[0]);\n  };\n\n  var fromTag = function (tag, scope) {\n    var doc = scope || document;\n    var node = doc.createElement(tag);\n    return fromDom(node);\n  };\n\n  var fromText = function (text, scope) {\n    var doc = scope || document;\n    var node = doc.createTextNode(text);\n    return fromDom(node);\n  };\n\n  var fromDom = function (node) {\n    if (node === null || node === undefined) {\n      throw new Error('Node cannot be null or undefined');\n    }\n\n    return {\n      dom: node\n    };\n  };\n\n  var fromPoint = function (docElm, x, y) {\n    return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n  };\n\n  var SugarElement = {\n    fromHtml: fromHtml,\n    fromTag: fromTag,\n    fromText: fromText,\n    fromDom: fromDom,\n    fromPoint: fromPoint\n  };\n  var global$1 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n  var global$2 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n  var global$3 = tinymce.util.Tools.resolve('tinymce.util.XHR');\n\n  var hasDimensions = function (editor) {\n    return editor.getParam('image_dimensions', true, 'boolean');\n  };\n\n  var hasAdvTab = function (editor) {\n    return editor.getParam('image_advtab', false, 'boolean');\n  };\n\n  var hasUploadTab = function (editor) {\n    return editor.getParam('image_uploadtab', true, 'boolean');\n  };\n\n  var getPrependUrl = function (editor) {\n    return editor.getParam('image_prepend_url', '', 'string');\n  };\n\n  var getClassList = function (editor) {\n    return editor.getParam('image_class_list');\n  };\n\n  var hasDescription = function (editor) {\n    return editor.getParam('image_description', true, 'boolean');\n  };\n\n  var hasImageTitle = function (editor) {\n    return editor.getParam('image_title', false, 'boolean');\n  };\n\n  var hasImageCaption = function (editor) {\n    return editor.getParam('image_caption', false, 'boolean');\n  };\n\n  var getImageList = function (editor) {\n    return editor.getParam('image_list', false);\n  };\n\n  var hasUploadUrl = function (editor) {\n    return isNonNullable(editor.getParam('images_upload_url'));\n  };\n\n  var hasUploadHandler = function (editor) {\n    return isNonNullable(editor.getParam('images_upload_handler'));\n  };\n\n  var showAccessibilityOptions = function (editor) {\n    return editor.getParam('a11y_advanced_options', false, 'boolean');\n  };\n\n  var isAutomaticUploadsEnabled = function (editor) {\n    return editor.getParam('automatic_uploads', true, 'boolean');\n  };\n\n  var parseIntAndGetMax = function (val1, val2) {\n    return Math.max(parseInt(val1, 10), parseInt(val2, 10));\n  };\n\n  var getImageSize = function (url) {\n    return new global$2(function (callback) {\n      var img = document.createElement('img');\n\n      var done = function (dimensions) {\n        if (img.parentNode) {\n          img.parentNode.removeChild(img);\n        }\n\n        callback(dimensions);\n      };\n\n      img.onload = function () {\n        var width = parseIntAndGetMax(img.width, img.clientWidth);\n        var height = parseIntAndGetMax(img.height, img.clientHeight);\n        var dimensions = {\n          width: width,\n          height: height\n        };\n        done(global$2.resolve(dimensions));\n      };\n\n      img.onerror = function () {\n        done(global$2.reject('Failed to get image dimensions for: ' + url));\n      };\n\n      var style = img.style;\n      style.visibility = 'hidden';\n      style.position = 'fixed';\n      style.bottom = style.left = '0px';\n      style.width = style.height = 'auto';\n      document.body.appendChild(img);\n      img.src = url;\n    });\n  };\n\n  var removePixelSuffix = function (value) {\n    if (value) {\n      value = value.replace(/px$/, '');\n    }\n\n    return value;\n  };\n\n  var addPixelSuffix = function (value) {\n    if (value.length > 0 && /^[0-9]+$/.test(value)) {\n      value += 'px';\n    }\n\n    return value;\n  };\n\n  var mergeMargins = function (css) {\n    if (css.margin) {\n      var splitMargin = String(css.margin).split(' ');\n\n      switch (splitMargin.length) {\n        case 1:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[0];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[0];\n          css['margin-left'] = css['margin-left'] || splitMargin[0];\n          break;\n\n        case 2:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[0];\n          css['margin-left'] = css['margin-left'] || splitMargin[1];\n          break;\n\n        case 3:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[2];\n          css['margin-left'] = css['margin-left'] || splitMargin[1];\n          break;\n\n        case 4:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[2];\n          css['margin-left'] = css['margin-left'] || splitMargin[3];\n      }\n\n      delete css.margin;\n    }\n\n    return css;\n  };\n\n  var createImageList = function (editor, callback) {\n    var imageList = getImageList(editor);\n\n    if (typeof imageList === 'string') {\n      global$3.send({\n        url: imageList,\n        success: function (text) {\n          callback(JSON.parse(text));\n        }\n      });\n    } else if (typeof imageList === 'function') {\n      imageList(callback);\n    } else {\n      callback(imageList);\n    }\n  };\n\n  var waitLoadImage = function (editor, data, imgElm) {\n    var selectImage = function () {\n      imgElm.onload = imgElm.onerror = null;\n\n      if (editor.selection) {\n        editor.selection.select(imgElm);\n        editor.nodeChanged();\n      }\n    };\n\n    imgElm.onload = function () {\n      if (!data.width && !data.height && hasDimensions(editor)) {\n        editor.dom.setAttribs(imgElm, {\n          width: String(imgElm.clientWidth),\n          height: String(imgElm.clientHeight)\n        });\n      }\n\n      selectImage();\n    };\n\n    imgElm.onerror = selectImage;\n  };\n\n  var blobToDataUri = function (blob) {\n    return new global$2(function (resolve, reject) {\n      var reader = new FileReader();\n\n      reader.onload = function () {\n        resolve(reader.result);\n      };\n\n      reader.onerror = function () {\n        reject(reader.error.message);\n      };\n\n      reader.readAsDataURL(blob);\n    });\n  };\n\n  var isPlaceholderImage = function (imgElm) {\n    return imgElm.nodeName === 'IMG' && (imgElm.hasAttribute('data-mce-object') || imgElm.hasAttribute('data-mce-placeholder'));\n  };\n\n  var DOM = global$1.DOM;\n\n  var getHspace = function (image) {\n    if (image.style.marginLeft && image.style.marginRight && image.style.marginLeft === image.style.marginRight) {\n      return removePixelSuffix(image.style.marginLeft);\n    } else {\n      return '';\n    }\n  };\n\n  var getVspace = function (image) {\n    if (image.style.marginTop && image.style.marginBottom && image.style.marginTop === image.style.marginBottom) {\n      return removePixelSuffix(image.style.marginTop);\n    } else {\n      return '';\n    }\n  };\n\n  var getBorder = function (image) {\n    if (image.style.borderWidth) {\n      return removePixelSuffix(image.style.borderWidth);\n    } else {\n      return '';\n    }\n  };\n\n  var getAttrib = function (image, name) {\n    if (image.hasAttribute(name)) {\n      return image.getAttribute(name);\n    } else {\n      return '';\n    }\n  };\n\n  var getStyle = function (image, name) {\n    return image.style[name] ? image.style[name] : '';\n  };\n\n  var hasCaption = function (image) {\n    return image.parentNode !== null && image.parentNode.nodeName === 'FIGURE';\n  };\n\n  var updateAttrib = function (image, name, value) {\n    if (value === '') {\n      image.removeAttribute(name);\n    } else {\n      image.setAttribute(name, value);\n    }\n  };\n\n  var wrapInFigure = function (image) {\n    var figureElm = DOM.create('figure', {\n      class: 'image'\n    });\n    DOM.insertAfter(figureElm, image);\n    figureElm.appendChild(image);\n    figureElm.appendChild(DOM.create('figcaption', {\n      contentEditable: 'true'\n    }, 'Caption'));\n    figureElm.contentEditable = 'false';\n  };\n\n  var removeFigure = function (image) {\n    var figureElm = image.parentNode;\n    DOM.insertAfter(image, figureElm);\n    DOM.remove(figureElm);\n  };\n\n  var toggleCaption = function (image) {\n    if (hasCaption(image)) {\n      removeFigure(image);\n    } else {\n      wrapInFigure(image);\n    }\n  };\n\n  var normalizeStyle = function (image, normalizeCss) {\n    var attrValue = image.getAttribute('style');\n    var value = normalizeCss(attrValue !== null ? attrValue : '');\n\n    if (value.length > 0) {\n      image.setAttribute('style', value);\n      image.setAttribute('data-mce-style', value);\n    } else {\n      image.removeAttribute('style');\n    }\n  };\n\n  var setSize = function (name, normalizeCss) {\n    return function (image, name, value) {\n      if (image.style[name]) {\n        image.style[name] = addPixelSuffix(value);\n        normalizeStyle(image, normalizeCss);\n      } else {\n        updateAttrib(image, name, value);\n      }\n    };\n  };\n\n  var getSize = function (image, name) {\n    if (image.style[name]) {\n      return removePixelSuffix(image.style[name]);\n    } else {\n      return getAttrib(image, name);\n    }\n  };\n\n  var setHspace = function (image, value) {\n    var pxValue = addPixelSuffix(value);\n    image.style.marginLeft = pxValue;\n    image.style.marginRight = pxValue;\n  };\n\n  var setVspace = function (image, value) {\n    var pxValue = addPixelSuffix(value);\n    image.style.marginTop = pxValue;\n    image.style.marginBottom = pxValue;\n  };\n\n  var setBorder = function (image, value) {\n    var pxValue = addPixelSuffix(value);\n    image.style.borderWidth = pxValue;\n  };\n\n  var setBorderStyle = function (image, value) {\n    image.style.borderStyle = value;\n  };\n\n  var getBorderStyle = function (image) {\n    return getStyle(image, 'borderStyle');\n  };\n\n  var isFigure = function (elm) {\n    return elm.nodeName === 'FIGURE';\n  };\n\n  var isImage = function (elm) {\n    return elm.nodeName === 'IMG';\n  };\n\n  var getIsDecorative = function (image) {\n    return DOM.getAttrib(image, 'alt').length === 0 && DOM.getAttrib(image, 'role') === 'presentation';\n  };\n\n  var getAlt = function (image) {\n    if (getIsDecorative(image)) {\n      return '';\n    } else {\n      return getAttrib(image, 'alt');\n    }\n  };\n\n  var defaultData = function () {\n    return {\n      src: '',\n      alt: '',\n      title: '',\n      width: '',\n      height: '',\n      class: '',\n      style: '',\n      caption: false,\n      hspace: '',\n      vspace: '',\n      border: '',\n      borderStyle: '',\n      isDecorative: false\n    };\n  };\n\n  var getStyleValue = function (normalizeCss, data) {\n    var image = document.createElement('img');\n    updateAttrib(image, 'style', data.style);\n\n    if (getHspace(image) || data.hspace !== '') {\n      setHspace(image, data.hspace);\n    }\n\n    if (getVspace(image) || data.vspace !== '') {\n      setVspace(image, data.vspace);\n    }\n\n    if (getBorder(image) || data.border !== '') {\n      setBorder(image, data.border);\n    }\n\n    if (getBorderStyle(image) || data.borderStyle !== '') {\n      setBorderStyle(image, data.borderStyle);\n    }\n\n    return normalizeCss(image.getAttribute('style'));\n  };\n\n  var create = function (normalizeCss, data) {\n    var image = document.createElement('img');\n    write(normalizeCss, __assign(__assign({}, data), {\n      caption: false\n    }), image);\n    setAlt(image, data.alt, data.isDecorative);\n\n    if (data.caption) {\n      var figure = DOM.create('figure', {\n        class: 'image'\n      });\n      figure.appendChild(image);\n      figure.appendChild(DOM.create('figcaption', {\n        contentEditable: 'true'\n      }, 'Caption'));\n      figure.contentEditable = 'false';\n      return figure;\n    } else {\n      return image;\n    }\n  };\n\n  var read = function (normalizeCss, image) {\n    return {\n      src: getAttrib(image, 'src'),\n      alt: getAlt(image),\n      title: getAttrib(image, 'title'),\n      width: getSize(image, 'width'),\n      height: getSize(image, 'height'),\n      class: getAttrib(image, 'class'),\n      style: normalizeCss(getAttrib(image, 'style')),\n      caption: hasCaption(image),\n      hspace: getHspace(image),\n      vspace: getVspace(image),\n      border: getBorder(image),\n      borderStyle: getStyle(image, 'borderStyle'),\n      isDecorative: getIsDecorative(image)\n    };\n  };\n\n  var updateProp = function (image, oldData, newData, name, set) {\n    if (newData[name] !== oldData[name]) {\n      set(image, name, newData[name]);\n    }\n  };\n\n  var setAlt = function (image, alt, isDecorative) {\n    if (isDecorative) {\n      DOM.setAttrib(image, 'role', 'presentation');\n      var sugarImage = SugarElement.fromDom(image);\n      set(sugarImage, 'alt', '');\n    } else {\n      if (isNull(alt)) {\n        var sugarImage = SugarElement.fromDom(image);\n        remove(sugarImage, 'alt');\n      } else {\n        var sugarImage = SugarElement.fromDom(image);\n        set(sugarImage, 'alt', alt);\n      }\n\n      if (DOM.getAttrib(image, 'role') === 'presentation') {\n        DOM.setAttrib(image, 'role', '');\n      }\n    }\n  };\n\n  var updateAlt = function (image, oldData, newData) {\n    if (newData.alt !== oldData.alt || newData.isDecorative !== oldData.isDecorative) {\n      setAlt(image, newData.alt, newData.isDecorative);\n    }\n  };\n\n  var normalized = function (set, normalizeCss) {\n    return function (image, name, value) {\n      set(image, value);\n      normalizeStyle(image, normalizeCss);\n    };\n  };\n\n  var write = function (normalizeCss, newData, image) {\n    var oldData = read(normalizeCss, image);\n    updateProp(image, oldData, newData, 'caption', function (image, _name, _value) {\n      return toggleCaption(image);\n    });\n    updateProp(image, oldData, newData, 'src', updateAttrib);\n    updateProp(image, oldData, newData, 'title', updateAttrib);\n    updateProp(image, oldData, newData, 'width', setSize('width', normalizeCss));\n    updateProp(image, oldData, newData, 'height', setSize('height', normalizeCss));\n    updateProp(image, oldData, newData, 'class', updateAttrib);\n    updateProp(image, oldData, newData, 'style', normalized(function (image, value) {\n      return updateAttrib(image, 'style', value);\n    }, normalizeCss));\n    updateProp(image, oldData, newData, 'hspace', normalized(setHspace, normalizeCss));\n    updateProp(image, oldData, newData, 'vspace', normalized(setVspace, normalizeCss));\n    updateProp(image, oldData, newData, 'border', normalized(setBorder, normalizeCss));\n    updateProp(image, oldData, newData, 'borderStyle', normalized(setBorderStyle, normalizeCss));\n    updateAlt(image, oldData, newData);\n  };\n\n  var normalizeCss = function (editor, cssText) {\n    var css = editor.dom.styles.parse(cssText);\n    var mergedCss = mergeMargins(css);\n    var compressed = editor.dom.styles.parse(editor.dom.styles.serialize(mergedCss));\n    return editor.dom.styles.serialize(compressed);\n  };\n\n  var getSelectedImage = function (editor) {\n    var imgElm = editor.selection.getNode();\n    var figureElm = editor.dom.getParent(imgElm, 'figure.image');\n\n    if (figureElm) {\n      return editor.dom.select('img', figureElm)[0];\n    }\n\n    if (imgElm && (imgElm.nodeName !== 'IMG' || isPlaceholderImage(imgElm))) {\n      return null;\n    }\n\n    return imgElm;\n  };\n\n  var splitTextBlock = function (editor, figure) {\n    var dom = editor.dom;\n    var textBlockElements = filter(editor.schema.getTextBlockElements(), function (_, parentElm) {\n      return !editor.schema.isValidChild(parentElm, 'figure');\n    });\n    var textBlock = dom.getParent(figure.parentNode, function (node) {\n      return hasNonNullableKey(textBlockElements, node.nodeName);\n    }, editor.getBody());\n\n    if (textBlock) {\n      return dom.split(textBlock, figure);\n    } else {\n      return figure;\n    }\n  };\n\n  var readImageDataFromSelection = function (editor) {\n    var image = getSelectedImage(editor);\n    return image ? read(function (css) {\n      return normalizeCss(editor, css);\n    }, image) : defaultData();\n  };\n\n  var insertImageAtCaret = function (editor, data) {\n    var elm = create(function (css) {\n      return normalizeCss(editor, css);\n    }, data);\n    editor.dom.setAttrib(elm, 'data-mce-id', '__mcenew');\n    editor.focus();\n    editor.selection.setContent(elm.outerHTML);\n    var insertedElm = editor.dom.select('*[data-mce-id=\"__mcenew\"]')[0];\n    editor.dom.setAttrib(insertedElm, 'data-mce-id', null);\n\n    if (isFigure(insertedElm)) {\n      var figure = splitTextBlock(editor, insertedElm);\n      editor.selection.select(figure);\n    } else {\n      editor.selection.select(insertedElm);\n    }\n  };\n\n  var syncSrcAttr = function (editor, image) {\n    editor.dom.setAttrib(image, 'src', image.getAttribute('src'));\n  };\n\n  var deleteImage = function (editor, image) {\n    if (image) {\n      var elm = editor.dom.is(image.parentNode, 'figure.image') ? image.parentNode : image;\n      editor.dom.remove(elm);\n      editor.focus();\n      editor.nodeChanged();\n\n      if (editor.dom.isEmpty(editor.getBody())) {\n        editor.setContent('');\n        editor.selection.setCursorLocation();\n      }\n    }\n  };\n\n  var writeImageDataToSelection = function (editor, data) {\n    var image = getSelectedImage(editor);\n    write(function (css) {\n      return normalizeCss(editor, css);\n    }, data, image);\n    syncSrcAttr(editor, image);\n\n    if (isFigure(image.parentNode)) {\n      var figure = image.parentNode;\n      splitTextBlock(editor, figure);\n      editor.selection.select(image.parentNode);\n    } else {\n      editor.selection.select(image);\n      waitLoadImage(editor, data, image);\n    }\n  };\n\n  var insertOrUpdateImage = function (editor, partialData) {\n    var image = getSelectedImage(editor);\n\n    if (image) {\n      var selectedImageData = read(function (css) {\n        return normalizeCss(editor, css);\n      }, image);\n\n      var data = __assign(__assign({}, selectedImageData), partialData);\n\n      if (data.src) {\n        writeImageDataToSelection(editor, data);\n      } else {\n        deleteImage(editor, image);\n      }\n    } else if (partialData.src) {\n      insertImageAtCaret(editor, __assign(__assign({}, defaultData()), partialData));\n    }\n  };\n\n  var hasOwnProperty$1 = Object.prototype.hasOwnProperty;\n\n  var deep = function (old, nu) {\n    var bothObjects = isObject(old) && isObject(nu);\n    return bothObjects ? deepMerge(old, nu) : nu;\n  };\n\n  var baseMerge = function (merger) {\n    return function () {\n      var objects = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        objects[_i] = arguments[_i];\n      }\n\n      if (objects.length === 0) {\n        throw new Error('Can\\'t merge zero objects');\n      }\n\n      var ret = {};\n\n      for (var j = 0; j < objects.length; j++) {\n        var curObject = objects[j];\n\n        for (var key in curObject) {\n          if (hasOwnProperty$1.call(curObject, key)) {\n            ret[key] = merger(ret[key], curObject[key]);\n          }\n        }\n      }\n\n      return ret;\n    };\n  };\n\n  var deepMerge = baseMerge(deep);\n\n  var isNotEmpty = function (s) {\n    return s.length > 0;\n  };\n\n  var global$4 = tinymce.util.Tools.resolve('tinymce.util.ImageUploader');\n  var global$5 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n  var getValue = function (item) {\n    return isString(item.value) ? item.value : '';\n  };\n\n  var getText = function (item) {\n    if (isString(item.text)) {\n      return item.text;\n    } else if (isString(item.title)) {\n      return item.title;\n    } else {\n      return '';\n    }\n  };\n\n  var sanitizeList = function (list, extractValue) {\n    var out = [];\n    global$5.each(list, function (item) {\n      var text = getText(item);\n\n      if (item.menu !== undefined) {\n        var items = sanitizeList(item.menu, extractValue);\n        out.push({\n          text: text,\n          items: items\n        });\n      } else {\n        var value = extractValue(item);\n        out.push({\n          text: text,\n          value: value\n        });\n      }\n    });\n    return out;\n  };\n\n  var sanitizer = function (extracter) {\n    if (extracter === void 0) {\n      extracter = getValue;\n    }\n\n    return function (list) {\n      if (list) {\n        return Optional.from(list).map(function (list) {\n          return sanitizeList(list, extracter);\n        });\n      } else {\n        return Optional.none();\n      }\n    };\n  };\n\n  var sanitize = function (list) {\n    return sanitizer(getValue)(list);\n  };\n\n  var isGroup = function (item) {\n    return Object.prototype.hasOwnProperty.call(item, 'items');\n  };\n\n  var findEntryDelegate = function (list, value) {\n    return findMap(list, function (item) {\n      if (isGroup(item)) {\n        return findEntryDelegate(item.items, value);\n      } else if (item.value === value) {\n        return Optional.some(item);\n      } else {\n        return Optional.none();\n      }\n    });\n  };\n\n  var findEntry = function (optList, value) {\n    return optList.bind(function (list) {\n      return findEntryDelegate(list, value);\n    });\n  };\n\n  var ListUtils = {\n    sanitizer: sanitizer,\n    sanitize: sanitize,\n    findEntry: findEntry\n  };\n\n  var makeTab = function (_info) {\n    return {\n      title: 'Advanced',\n      name: 'advanced',\n      items: [{\n        type: 'input',\n        label: 'Style',\n        name: 'style'\n      }, {\n        type: 'grid',\n        columns: 2,\n        items: [{\n          type: 'input',\n          label: 'Vertical space',\n          name: 'vspace',\n          inputMode: 'numeric'\n        }, {\n          type: 'input',\n          label: 'Horizontal space',\n          name: 'hspace',\n          inputMode: 'numeric'\n        }, {\n          type: 'input',\n          label: 'Border width',\n          name: 'border',\n          inputMode: 'numeric'\n        }, {\n          type: 'listbox',\n          name: 'borderstyle',\n          label: 'Border style',\n          items: [{\n            text: 'Select...',\n            value: ''\n          }, {\n            text: 'Solid',\n            value: 'solid'\n          }, {\n            text: 'Dotted',\n            value: 'dotted'\n          }, {\n            text: 'Dashed',\n            value: 'dashed'\n          }, {\n            text: 'Double',\n            value: 'double'\n          }, {\n            text: 'Groove',\n            value: 'groove'\n          }, {\n            text: 'Ridge',\n            value: 'ridge'\n          }, {\n            text: 'Inset',\n            value: 'inset'\n          }, {\n            text: 'Outset',\n            value: 'outset'\n          }, {\n            text: 'None',\n            value: 'none'\n          }, {\n            text: 'Hidden',\n            value: 'hidden'\n          }]\n        }]\n      }]\n    };\n  };\n\n  var AdvTab = {\n    makeTab: makeTab\n  };\n\n  var collect = function (editor) {\n    var urlListSanitizer = ListUtils.sanitizer(function (item) {\n      return editor.convertURL(item.value || item.url, 'src');\n    });\n    var futureImageList = new global$2(function (completer) {\n      createImageList(editor, function (imageList) {\n        completer(urlListSanitizer(imageList).map(function (items) {\n          return flatten([[{\n            text: 'None',\n            value: ''\n          }], items]);\n        }));\n      });\n    });\n    var classList = ListUtils.sanitize(getClassList(editor));\n    var hasAdvTab$1 = hasAdvTab(editor);\n    var hasUploadTab$1 = hasUploadTab(editor);\n    var hasUploadUrl$1 = hasUploadUrl(editor);\n    var hasUploadHandler$1 = hasUploadHandler(editor);\n    var image = readImageDataFromSelection(editor);\n    var hasDescription$1 = hasDescription(editor);\n    var hasImageTitle$1 = hasImageTitle(editor);\n    var hasDimensions$1 = hasDimensions(editor);\n    var hasImageCaption$1 = hasImageCaption(editor);\n    var hasAccessibilityOptions = showAccessibilityOptions(editor);\n    var automaticUploads = isAutomaticUploadsEnabled(editor);\n    var prependURL = Optional.some(getPrependUrl(editor)).filter(function (preUrl) {\n      return isString(preUrl) && preUrl.length > 0;\n    });\n    return futureImageList.then(function (imageList) {\n      return {\n        image: image,\n        imageList: imageList,\n        classList: classList,\n        hasAdvTab: hasAdvTab$1,\n        hasUploadTab: hasUploadTab$1,\n        hasUploadUrl: hasUploadUrl$1,\n        hasUploadHandler: hasUploadHandler$1,\n        hasDescription: hasDescription$1,\n        hasImageTitle: hasImageTitle$1,\n        hasDimensions: hasDimensions$1,\n        hasImageCaption: hasImageCaption$1,\n        prependURL: prependURL,\n        hasAccessibilityOptions: hasAccessibilityOptions,\n        automaticUploads: automaticUploads\n      };\n    });\n  };\n\n  var makeItems = function (info) {\n    var imageUrl = {\n      name: 'src',\n      type: 'urlinput',\n      filetype: 'image',\n      label: 'Source'\n    };\n    var imageList = info.imageList.map(function (items) {\n      return {\n        name: 'images',\n        type: 'listbox',\n        label: 'Image list',\n        items: items\n      };\n    });\n    var imageDescription = {\n      name: 'alt',\n      type: 'input',\n      label: 'Alternative description',\n      disabled: info.hasAccessibilityOptions && info.image.isDecorative\n    };\n    var imageTitle = {\n      name: 'title',\n      type: 'input',\n      label: 'Image title'\n    };\n    var imageDimensions = {\n      name: 'dimensions',\n      type: 'sizeinput'\n    };\n    var isDecorative = {\n      type: 'label',\n      label: 'Accessibility',\n      items: [{\n        name: 'isDecorative',\n        type: 'checkbox',\n        label: 'Image is decorative'\n      }]\n    };\n    var classList = info.classList.map(function (items) {\n      return {\n        name: 'classes',\n        type: 'listbox',\n        label: 'Class',\n        items: items\n      };\n    });\n    var caption = {\n      type: 'label',\n      label: 'Caption',\n      items: [{\n        type: 'checkbox',\n        name: 'caption',\n        label: 'Show caption'\n      }]\n    };\n\n    var getDialogContainerType = function (useColumns) {\n      return useColumns ? {\n        type: 'grid',\n        columns: 2\n      } : {\n        type: 'panel'\n      };\n    };\n\n    return flatten([[imageUrl], imageList.toArray(), info.hasAccessibilityOptions && info.hasDescription ? [isDecorative] : [], info.hasDescription ? [imageDescription] : [], info.hasImageTitle ? [imageTitle] : [], info.hasDimensions ? [imageDimensions] : [], [__assign(__assign({}, getDialogContainerType(info.classList.isSome() && info.hasImageCaption)), {\n      items: flatten([classList.toArray(), info.hasImageCaption ? [caption] : []])\n    })]]);\n  };\n\n  var makeTab$1 = function (info) {\n    return {\n      title: 'General',\n      name: 'general',\n      items: makeItems(info)\n    };\n  };\n\n  var MainTab = {\n    makeTab: makeTab$1,\n    makeItems: makeItems\n  };\n\n  var makeTab$2 = function (_info) {\n    var items = [{\n      type: 'dropzone',\n      name: 'fileinput'\n    }];\n    return {\n      title: 'Upload',\n      name: 'upload',\n      items: items\n    };\n  };\n\n  var UploadTab = {\n    makeTab: makeTab$2\n  };\n\n  var createState = function (info) {\n    return {\n      prevImage: ListUtils.findEntry(info.imageList, info.image.src),\n      prevAlt: info.image.alt,\n      open: true\n    };\n  };\n\n  var fromImageData = function (image) {\n    return {\n      src: {\n        value: image.src,\n        meta: {}\n      },\n      images: image.src,\n      alt: image.alt,\n      title: image.title,\n      dimensions: {\n        width: image.width,\n        height: image.height\n      },\n      classes: image.class,\n      caption: image.caption,\n      style: image.style,\n      vspace: image.vspace,\n      border: image.border,\n      hspace: image.hspace,\n      borderstyle: image.borderStyle,\n      fileinput: [],\n      isDecorative: image.isDecorative\n    };\n  };\n\n  var toImageData = function (data, removeEmptyAlt) {\n    return {\n      src: data.src.value,\n      alt: data.alt.length === 0 && removeEmptyAlt ? null : data.alt,\n      title: data.title,\n      width: data.dimensions.width,\n      height: data.dimensions.height,\n      class: data.classes,\n      style: data.style,\n      caption: data.caption,\n      hspace: data.hspace,\n      vspace: data.vspace,\n      border: data.border,\n      borderStyle: data.borderstyle,\n      isDecorative: data.isDecorative\n    };\n  };\n\n  var addPrependUrl2 = function (info, srcURL) {\n    if (!/^(?:[a-zA-Z]+:)?\\/\\//.test(srcURL)) {\n      return info.prependURL.bind(function (prependUrl) {\n        if (srcURL.substring(0, prependUrl.length) !== prependUrl) {\n          return Optional.some(prependUrl + srcURL);\n        }\n\n        return Optional.none();\n      });\n    }\n\n    return Optional.none();\n  };\n\n  var addPrependUrl = function (info, api) {\n    var data = api.getData();\n    addPrependUrl2(info, data.src.value).each(function (srcURL) {\n      api.setData({\n        src: {\n          value: srcURL,\n          meta: data.src.meta\n        }\n      });\n    });\n  };\n\n  var formFillFromMeta2 = function (info, data, meta) {\n    if (info.hasDescription && isString(meta.alt)) {\n      data.alt = meta.alt;\n    }\n\n    if (info.hasAccessibilityOptions) {\n      data.isDecorative = meta.isDecorative || data.isDecorative || false;\n    }\n\n    if (info.hasImageTitle && isString(meta.title)) {\n      data.title = meta.title;\n    }\n\n    if (info.hasDimensions) {\n      if (isString(meta.width)) {\n        data.dimensions.width = meta.width;\n      }\n\n      if (isString(meta.height)) {\n        data.dimensions.height = meta.height;\n      }\n    }\n\n    if (isString(meta.class)) {\n      ListUtils.findEntry(info.classList, meta.class).each(function (entry) {\n        data.classes = entry.value;\n      });\n    }\n\n    if (info.hasImageCaption) {\n      if (isBoolean(meta.caption)) {\n        data.caption = meta.caption;\n      }\n    }\n\n    if (info.hasAdvTab) {\n      if (isString(meta.style)) {\n        data.style = meta.style;\n      }\n\n      if (isString(meta.vspace)) {\n        data.vspace = meta.vspace;\n      }\n\n      if (isString(meta.border)) {\n        data.border = meta.border;\n      }\n\n      if (isString(meta.hspace)) {\n        data.hspace = meta.hspace;\n      }\n\n      if (isString(meta.borderstyle)) {\n        data.borderstyle = meta.borderstyle;\n      }\n    }\n  };\n\n  var formFillFromMeta = function (info, api) {\n    var data = api.getData();\n    var meta = data.src.meta;\n\n    if (meta !== undefined) {\n      var newData = deepMerge({}, data);\n      formFillFromMeta2(info, newData, meta);\n      api.setData(newData);\n    }\n  };\n\n  var calculateImageSize = function (helpers, info, state, api) {\n    var data = api.getData();\n    var url = data.src.value;\n    var meta = data.src.meta || {};\n\n    if (!meta.width && !meta.height && info.hasDimensions) {\n      if (isNotEmpty(url)) {\n        helpers.imageSize(url).then(function (size) {\n          if (state.open) {\n            api.setData({\n              dimensions: size\n            });\n          }\n        }).catch(function (e) {\n          return console.error(e);\n        });\n      } else {\n        api.setData({\n          dimensions: {\n            width: '',\n            height: ''\n          }\n        });\n      }\n    }\n  };\n\n  var updateImagesDropdown = function (info, state, api) {\n    var data = api.getData();\n    var image = ListUtils.findEntry(info.imageList, data.src.value);\n    state.prevImage = image;\n    api.setData({\n      images: image.map(function (entry) {\n        return entry.value;\n      }).getOr('')\n    });\n  };\n\n  var changeSrc = function (helpers, info, state, api) {\n    addPrependUrl(info, api);\n    formFillFromMeta(info, api);\n    calculateImageSize(helpers, info, state, api);\n    updateImagesDropdown(info, state, api);\n  };\n\n  var changeImages = function (helpers, info, state, api) {\n    var data = api.getData();\n    var image = ListUtils.findEntry(info.imageList, data.images);\n    image.each(function (img) {\n      var updateAlt = data.alt === '' || state.prevImage.map(function (image) {\n        return image.text === data.alt;\n      }).getOr(false);\n\n      if (updateAlt) {\n        if (img.value === '') {\n          api.setData({\n            src: img,\n            alt: state.prevAlt\n          });\n        } else {\n          api.setData({\n            src: img,\n            alt: img.text\n          });\n        }\n      } else {\n        api.setData({\n          src: img\n        });\n      }\n    });\n    state.prevImage = image;\n    changeSrc(helpers, info, state, api);\n  };\n\n  var calcVSpace = function (css) {\n    var matchingTopBottom = css['margin-top'] && css['margin-bottom'] && css['margin-top'] === css['margin-bottom'];\n    return matchingTopBottom ? removePixelSuffix(String(css['margin-top'])) : '';\n  };\n\n  var calcHSpace = function (css) {\n    var matchingLeftRight = css['margin-right'] && css['margin-left'] && css['margin-right'] === css['margin-left'];\n    return matchingLeftRight ? removePixelSuffix(String(css['margin-right'])) : '';\n  };\n\n  var calcBorderWidth = function (css) {\n    return css['border-width'] ? removePixelSuffix(String(css['border-width'])) : '';\n  };\n\n  var calcBorderStyle = function (css) {\n    return css['border-style'] ? String(css['border-style']) : '';\n  };\n\n  var calcStyle = function (parseStyle, serializeStyle, css) {\n    return serializeStyle(parseStyle(serializeStyle(css)));\n  };\n\n  var changeStyle2 = function (parseStyle, serializeStyle, data) {\n    var css = mergeMargins(parseStyle(data.style));\n    var dataCopy = deepMerge({}, data);\n    dataCopy.vspace = calcVSpace(css);\n    dataCopy.hspace = calcHSpace(css);\n    dataCopy.border = calcBorderWidth(css);\n    dataCopy.borderstyle = calcBorderStyle(css);\n    dataCopy.style = calcStyle(parseStyle, serializeStyle, css);\n    return dataCopy;\n  };\n\n  var changeStyle = function (helpers, api) {\n    var data = api.getData();\n    var newData = changeStyle2(helpers.parseStyle, helpers.serializeStyle, data);\n    api.setData(newData);\n  };\n\n  var changeAStyle = function (helpers, info, api) {\n    var data = deepMerge(fromImageData(info.image), api.getData());\n    var style = getStyleValue(helpers.normalizeCss, toImageData(data, false));\n    api.setData({\n      style: style\n    });\n  };\n\n  var changeFileInput = function (helpers, info, state, api) {\n    var data = api.getData();\n    api.block('Uploading image');\n    head(data.fileinput).fold(function () {\n      api.unblock();\n    }, function (file) {\n      var blobUri = URL.createObjectURL(file);\n\n      var finalize = function () {\n        api.unblock();\n        URL.revokeObjectURL(blobUri);\n      };\n\n      var updateSrcAndSwitchTab = function (url) {\n        api.setData({\n          src: {\n            value: url,\n            meta: {}\n          }\n        });\n        api.showTab('general');\n        changeSrc(helpers, info, state, api);\n      };\n\n      blobToDataUri(file).then(function (dataUrl) {\n        var blobInfo = helpers.createBlobCache(file, blobUri, dataUrl);\n\n        if (info.automaticUploads) {\n          helpers.uploadImage(blobInfo).then(function (result) {\n            updateSrcAndSwitchTab(result.url);\n            finalize();\n          }).catch(function (err) {\n            finalize();\n            helpers.alertErr(err);\n          });\n        } else {\n          helpers.addToBlobCache(blobInfo);\n          updateSrcAndSwitchTab(blobInfo.blobUri());\n          api.unblock();\n        }\n      });\n    });\n  };\n\n  var changeHandler = function (helpers, info, state) {\n    return function (api, evt) {\n      if (evt.name === 'src') {\n        changeSrc(helpers, info, state, api);\n      } else if (evt.name === 'images') {\n        changeImages(helpers, info, state, api);\n      } else if (evt.name === 'alt') {\n        state.prevAlt = api.getData().alt;\n      } else if (evt.name === 'style') {\n        changeStyle(helpers, api);\n      } else if (evt.name === 'vspace' || evt.name === 'hspace' || evt.name === 'border' || evt.name === 'borderstyle') {\n        changeAStyle(helpers, info, api);\n      } else if (evt.name === 'fileinput') {\n        changeFileInput(helpers, info, state, api);\n      } else if (evt.name === 'isDecorative') {\n        if (api.getData().isDecorative) {\n          api.disable('alt');\n        } else {\n          api.enable('alt');\n        }\n      }\n    };\n  };\n\n  var closeHandler = function (state) {\n    return function () {\n      state.open = false;\n    };\n  };\n\n  var makeDialogBody = function (info) {\n    if (info.hasAdvTab || info.hasUploadUrl || info.hasUploadHandler) {\n      var tabPanel = {\n        type: 'tabpanel',\n        tabs: flatten([[MainTab.makeTab(info)], info.hasAdvTab ? [AdvTab.makeTab(info)] : [], info.hasUploadTab && (info.hasUploadUrl || info.hasUploadHandler) ? [UploadTab.makeTab(info)] : []])\n      };\n      return tabPanel;\n    } else {\n      var panel = {\n        type: 'panel',\n        items: MainTab.makeItems(info)\n      };\n      return panel;\n    }\n  };\n\n  var makeDialog = function (helpers) {\n    return function (info) {\n      var state = createState(info);\n      return {\n        title: 'Insert/Edit Image',\n        size: 'normal',\n        body: makeDialogBody(info),\n        buttons: [{\n          type: 'cancel',\n          name: 'cancel',\n          text: 'Cancel'\n        }, {\n          type: 'submit',\n          name: 'save',\n          text: 'Save',\n          primary: true\n        }],\n        initialData: fromImageData(info.image),\n        onSubmit: helpers.onSubmit(info),\n        onChange: changeHandler(helpers, info, state),\n        onClose: closeHandler(state)\n      };\n    };\n  };\n\n  var submitHandler = function (editor) {\n    return function (info) {\n      return function (api) {\n        var data = deepMerge(fromImageData(info.image), api.getData());\n        editor.execCommand('mceUpdateImage', false, toImageData(data, info.hasAccessibilityOptions));\n        editor.editorUpload.uploadImagesAuto();\n        api.close();\n      };\n    };\n  };\n\n  var imageSize = function (editor) {\n    return function (url) {\n      return getImageSize(editor.documentBaseURI.toAbsolute(url)).then(function (dimensions) {\n        return {\n          width: String(dimensions.width),\n          height: String(dimensions.height)\n        };\n      });\n    };\n  };\n\n  var createBlobCache = function (editor) {\n    return function (file, blobUri, dataUrl) {\n      return editor.editorUpload.blobCache.create({\n        blob: file,\n        blobUri: blobUri,\n        name: file.name ? file.name.replace(/\\.[^\\.]+$/, '') : null,\n        filename: file.name,\n        base64: dataUrl.split(',')[1]\n      });\n    };\n  };\n\n  var addToBlobCache = function (editor) {\n    return function (blobInfo) {\n      editor.editorUpload.blobCache.add(blobInfo);\n    };\n  };\n\n  var alertErr = function (editor) {\n    return function (message) {\n      editor.windowManager.alert(message);\n    };\n  };\n\n  var normalizeCss$1 = function (editor) {\n    return function (cssText) {\n      return normalizeCss(editor, cssText);\n    };\n  };\n\n  var parseStyle = function (editor) {\n    return function (cssText) {\n      return editor.dom.parseStyle(cssText);\n    };\n  };\n\n  var serializeStyle = function (editor) {\n    return function (stylesArg, name) {\n      return editor.dom.serializeStyle(stylesArg, name);\n    };\n  };\n\n  var uploadImage = function (editor) {\n    return function (blobInfo) {\n      return global$4(editor).upload([blobInfo], false).then(function (results) {\n        if (results.length === 0) {\n          return global$2.reject('Failed to upload image');\n        } else if (results[0].status === false) {\n          return global$2.reject(results[0].error.message);\n        } else {\n          return results[0];\n        }\n      });\n    };\n  };\n\n  var Dialog = function (editor) {\n    var helpers = {\n      onSubmit: submitHandler(editor),\n      imageSize: imageSize(editor),\n      addToBlobCache: addToBlobCache(editor),\n      createBlobCache: createBlobCache(editor),\n      alertErr: alertErr(editor),\n      normalizeCss: normalizeCss$1(editor),\n      parseStyle: parseStyle(editor),\n      serializeStyle: serializeStyle(editor),\n      uploadImage: uploadImage(editor)\n    };\n\n    var open = function () {\n      collect(editor).then(makeDialog(helpers)).then(editor.windowManager.open);\n    };\n\n    return {\n      open: open\n    };\n  };\n\n  var register = function (editor) {\n    editor.addCommand('mceImage', Dialog(editor).open);\n    editor.addCommand('mceUpdateImage', function (_ui, data) {\n      editor.undoManager.transact(function () {\n        return insertOrUpdateImage(editor, data);\n      });\n    });\n  };\n\n  var hasImageClass = function (node) {\n    var className = node.attr('class');\n    return className && /\\bimage\\b/.test(className);\n  };\n\n  var toggleContentEditableState = function (state) {\n    return function (nodes) {\n      var i = nodes.length;\n\n      var toggleContentEditable = function (node) {\n        node.attr('contenteditable', state ? 'true' : null);\n      };\n\n      while (i--) {\n        var node = nodes[i];\n\n        if (hasImageClass(node)) {\n          node.attr('contenteditable', state ? 'false' : null);\n          global$5.each(node.getAll('figcaption'), toggleContentEditable);\n        }\n      }\n    };\n  };\n\n  var setup = function (editor) {\n    editor.on('PreInit', function () {\n      editor.parser.addNodeFilter('figure', toggleContentEditableState(true));\n      editor.serializer.addNodeFilter('figure', toggleContentEditableState(false));\n    });\n  };\n\n  var register$1 = function (editor) {\n    editor.ui.registry.addToggleButton('image', {\n      icon: 'image',\n      tooltip: 'Insert/edit image',\n      onAction: Dialog(editor).open,\n      onSetup: function (buttonApi) {\n        return editor.selection.selectorChangedWithUnbind('img:not([data-mce-object],[data-mce-placeholder]),figure.image', buttonApi.setActive).unbind;\n      }\n    });\n    editor.ui.registry.addMenuItem('image', {\n      icon: 'image',\n      text: 'Image...',\n      onAction: Dialog(editor).open\n    });\n    editor.ui.registry.addContextMenu('image', {\n      update: function (element) {\n        return isFigure(element) || isImage(element) && !isPlaceholderImage(element) ? ['image'] : [];\n      }\n    });\n  };\n\n  function Plugin() {\n    global.add('image', function (editor) {\n      setup(editor);\n      register$1(editor);\n      register(editor);\n    });\n  }\n\n  Plugin();\n})();","map":{"version":3,"sources":["/home/lin/phase5/My-Place-Frontend/my-place/node_modules/tinymce/plugins/image/plugin.js"],"names":["global","tinymce","util","Tools","resolve","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","typeOf","x","Array","isPrototypeOf","constructor","name","String","isType","type","value","isSimpleType","eq","a","isString","isObject","isArray","isNull","isBoolean","isNullable","undefined","isNonNullable","isNumber","noop","constant","never","always","none","NONE","o","isNone","thunk","id","me","fold","_s","is","isSome","getOr","getOrThunk","getOrDie","msg","Error","getOrNull","getOrUndefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","some","constant_a","self","f","v","elementEq","b","from","Optional","keys","obj","props","k","len","objAcc","r","internalFilter","pred","onTrue","onFalse","has","key","hasNonNullableKey","nativePush","push","flatten","xs","get","head","findMap","arr","Global","window","Function","rawSet","dom","setAttribute","console","error","set","element","remove","removeAttribute","fromHtml","html","scope","doc","document","div","createElement","innerHTML","hasChildNodes","childNodes","fromDom","fromTag","tag","node","fromText","text","createTextNode","fromPoint","docElm","y","elementFromPoint","SugarElement","global$1","global$2","global$3","hasDimensions","editor","getParam","hasAdvTab","hasUploadTab","getPrependUrl","getClassList","hasDescription","hasImageTitle","hasImageCaption","getImageList","hasUploadUrl","hasUploadHandler","showAccessibilityOptions","isAutomaticUploadsEnabled","parseIntAndGetMax","val1","val2","Math","max","parseInt","getImageSize","url","callback","img","done","dimensions","parentNode","removeChild","onload","width","clientWidth","height","clientHeight","onerror","reject","style","visibility","position","bottom","left","body","appendChild","src","removePixelSuffix","replace","addPixelSuffix","test","mergeMargins","css","margin","splitMargin","split","createImageList","imageList","send","success","JSON","parse","waitLoadImage","data","imgElm","selectImage","selection","select","nodeChanged","setAttribs","blobToDataUri","blob","reader","FileReader","result","message","readAsDataURL","isPlaceholderImage","nodeName","hasAttribute","DOM","getHspace","image","marginLeft","marginRight","getVspace","marginTop","marginBottom","getBorder","borderWidth","getAttrib","getAttribute","getStyle","hasCaption","updateAttrib","wrapInFigure","figureElm","create","class","insertAfter","contentEditable","removeFigure","toggleCaption","normalizeStyle","normalizeCss","attrValue","setSize","getSize","setHspace","pxValue","setVspace","setBorder","setBorderStyle","borderStyle","getBorderStyle","isFigure","elm","isImage","getIsDecorative","getAlt","defaultData","alt","title","caption","hspace","vspace","border","isDecorative","getStyleValue","write","setAlt","figure","read","updateProp","oldData","newData","setAttrib","sugarImage","updateAlt","normalized","_name","_value","cssText","styles","mergedCss","compressed","serialize","getSelectedImage","getNode","getParent","splitTextBlock","textBlockElements","schema","getTextBlockElements","_","parentElm","isValidChild","textBlock","getBody","readImageDataFromSelection","insertImageAtCaret","focus","setContent","outerHTML","insertedElm","syncSrcAttr","deleteImage","isEmpty","setCursorLocation","writeImageDataToSelection","insertOrUpdateImage","partialData","selectedImageData","hasOwnProperty$1","deep","old","nu","bothObjects","deepMerge","baseMerge","merger","objects","_i","ret","j","curObject","isNotEmpty","global$4","global$5","getValue","item","getText","sanitizeList","list","extractValue","out","menu","items","sanitizer","extracter","sanitize","isGroup","findEntryDelegate","findEntry","optList","ListUtils","makeTab","_info","label","columns","inputMode","AdvTab","collect","urlListSanitizer","convertURL","futureImageList","completer","classList","hasAdvTab$1","hasUploadTab$1","hasUploadUrl$1","hasUploadHandler$1","hasDescription$1","hasImageTitle$1","hasDimensions$1","hasImageCaption$1","hasAccessibilityOptions","automaticUploads","prependURL","preUrl","then","makeItems","info","imageUrl","filetype","imageDescription","disabled","imageTitle","imageDimensions","getDialogContainerType","useColumns","makeTab$1","MainTab","makeTab$2","UploadTab","createState","prevImage","prevAlt","open","fromImageData","meta","images","classes","borderstyle","fileinput","toImageData","removeEmptyAlt","addPrependUrl2","srcURL","prependUrl","substring","addPrependUrl","api","getData","setData","formFillFromMeta2","entry","formFillFromMeta","calculateImageSize","helpers","state","imageSize","size","catch","e","updateImagesDropdown","changeSrc","changeImages","calcVSpace","matchingTopBottom","calcHSpace","matchingLeftRight","calcBorderWidth","calcBorderStyle","calcStyle","parseStyle","serializeStyle","changeStyle2","dataCopy","changeStyle","changeAStyle","changeFileInput","block","unblock","file","blobUri","URL","createObjectURL","finalize","revokeObjectURL","updateSrcAndSwitchTab","showTab","dataUrl","blobInfo","createBlobCache","uploadImage","err","alertErr","addToBlobCache","changeHandler","evt","disable","enable","closeHandler","makeDialogBody","tabPanel","tabs","panel","makeDialog","buttons","primary","initialData","onSubmit","onChange","onClose","submitHandler","execCommand","editorUpload","uploadImagesAuto","close","documentBaseURI","toAbsolute","blobCache","filename","base64","add","windowManager","alert","normalizeCss$1","stylesArg","upload","results","status","Dialog","register","addCommand","_ui","undoManager","transact","hasImageClass","className","attr","toggleContentEditableState","nodes","toggleContentEditable","getAll","setup","on","parser","addNodeFilter","serializer","register$1","ui","registry","addToggleButton","icon","tooltip","onAction","onSetup","buttonApi","selectorChangedWithUnbind","setActive","unbind","addMenuItem","addContextMenu","update","Plugin"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.8.2 (2021-06-23)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n\n    var typeOf = function (x) {\n      var t = typeof x;\n      if (x === null) {\n        return 'null';\n      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      } else {\n        return t;\n      }\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isSimpleType = function (type) {\n      return function (value) {\n        return typeof value === type;\n      };\n    };\n    var eq = function (t) {\n      return function (a) {\n        return t === a;\n      };\n    };\n    var isString = isType('string');\n    var isObject = isType('object');\n    var isArray = isType('array');\n    var isNull = eq(null);\n    var isBoolean = isSimpleType('boolean');\n    var isNullable = function (a) {\n      return a === null || a === undefined;\n    };\n    var isNonNullable = function (a) {\n      return !isNullable(a);\n    };\n    var isNumber = isSimpleType('number');\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, _s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Optional = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var keys = Object.keys;\n    var hasOwnProperty = Object.hasOwnProperty;\n    var each = function (obj, f) {\n      var props = keys(obj);\n      for (var k = 0, len = props.length; k < len; k++) {\n        var i = props[k];\n        var x = obj[i];\n        f(x, i);\n      }\n    };\n    var objAcc = function (r) {\n      return function (x, i) {\n        r[i] = x;\n      };\n    };\n    var internalFilter = function (obj, pred, onTrue, onFalse) {\n      var r = {};\n      each(obj, function (x, i) {\n        (pred(x, i) ? onTrue : onFalse)(x, i);\n      });\n      return r;\n    };\n    var filter = function (obj, pred) {\n      var t = {};\n      internalFilter(obj, pred, objAcc(t), noop);\n      return t;\n    };\n    var has = function (obj, key) {\n      return hasOwnProperty.call(obj, key);\n    };\n    var hasNonNullableKey = function (obj, key) {\n      return has(obj, key) && obj[key] !== undefined && obj[key] !== null;\n    };\n\n    var nativePush = Array.prototype.push;\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n    var get = function (xs, i) {\n      return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();\n    };\n    var head = function (xs) {\n      return get(xs, 0);\n    };\n    var findMap = function (arr, f) {\n      for (var i = 0; i < arr.length; i++) {\n        var r = f(arr[i], i);\n        if (r.isSome()) {\n          return r;\n        }\n      }\n      return Optional.none();\n    };\n\n    var Global = typeof window !== 'undefined' ? window : Function('return this;')();\n\n    var rawSet = function (dom, key, value) {\n      if (isString(value) || isBoolean(value) || isNumber(value)) {\n        dom.setAttribute(key, value + '');\n      } else {\n        console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n        throw new Error('Attribute value was not simple');\n      }\n    };\n    var set = function (element, key, value) {\n      rawSet(element.dom, key, value);\n    };\n    var remove = function (element, key) {\n      element.dom.removeAttribute(key);\n    };\n\n    var fromHtml = function (html, scope) {\n      var doc = scope || document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      if (!div.hasChildNodes() || div.childNodes.length > 1) {\n        console.error('HTML does not have a single root node', html);\n        throw new Error('HTML must have a single root node');\n      }\n      return fromDom(div.childNodes[0]);\n    };\n    var fromTag = function (tag, scope) {\n      var doc = scope || document;\n      var node = doc.createElement(tag);\n      return fromDom(node);\n    };\n    var fromText = function (text, scope) {\n      var doc = scope || document;\n      var node = doc.createTextNode(text);\n      return fromDom(node);\n    };\n    var fromDom = function (node) {\n      if (node === null || node === undefined) {\n        throw new Error('Node cannot be null or undefined');\n      }\n      return { dom: node };\n    };\n    var fromPoint = function (docElm, x, y) {\n      return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n    };\n    var SugarElement = {\n      fromHtml: fromHtml,\n      fromTag: fromTag,\n      fromText: fromText,\n      fromDom: fromDom,\n      fromPoint: fromPoint\n    };\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.util.XHR');\n\n    var hasDimensions = function (editor) {\n      return editor.getParam('image_dimensions', true, 'boolean');\n    };\n    var hasAdvTab = function (editor) {\n      return editor.getParam('image_advtab', false, 'boolean');\n    };\n    var hasUploadTab = function (editor) {\n      return editor.getParam('image_uploadtab', true, 'boolean');\n    };\n    var getPrependUrl = function (editor) {\n      return editor.getParam('image_prepend_url', '', 'string');\n    };\n    var getClassList = function (editor) {\n      return editor.getParam('image_class_list');\n    };\n    var hasDescription = function (editor) {\n      return editor.getParam('image_description', true, 'boolean');\n    };\n    var hasImageTitle = function (editor) {\n      return editor.getParam('image_title', false, 'boolean');\n    };\n    var hasImageCaption = function (editor) {\n      return editor.getParam('image_caption', false, 'boolean');\n    };\n    var getImageList = function (editor) {\n      return editor.getParam('image_list', false);\n    };\n    var hasUploadUrl = function (editor) {\n      return isNonNullable(editor.getParam('images_upload_url'));\n    };\n    var hasUploadHandler = function (editor) {\n      return isNonNullable(editor.getParam('images_upload_handler'));\n    };\n    var showAccessibilityOptions = function (editor) {\n      return editor.getParam('a11y_advanced_options', false, 'boolean');\n    };\n    var isAutomaticUploadsEnabled = function (editor) {\n      return editor.getParam('automatic_uploads', true, 'boolean');\n    };\n\n    var parseIntAndGetMax = function (val1, val2) {\n      return Math.max(parseInt(val1, 10), parseInt(val2, 10));\n    };\n    var getImageSize = function (url) {\n      return new global$2(function (callback) {\n        var img = document.createElement('img');\n        var done = function (dimensions) {\n          if (img.parentNode) {\n            img.parentNode.removeChild(img);\n          }\n          callback(dimensions);\n        };\n        img.onload = function () {\n          var width = parseIntAndGetMax(img.width, img.clientWidth);\n          var height = parseIntAndGetMax(img.height, img.clientHeight);\n          var dimensions = {\n            width: width,\n            height: height\n          };\n          done(global$2.resolve(dimensions));\n        };\n        img.onerror = function () {\n          done(global$2.reject('Failed to get image dimensions for: ' + url));\n        };\n        var style = img.style;\n        style.visibility = 'hidden';\n        style.position = 'fixed';\n        style.bottom = style.left = '0px';\n        style.width = style.height = 'auto';\n        document.body.appendChild(img);\n        img.src = url;\n      });\n    };\n    var removePixelSuffix = function (value) {\n      if (value) {\n        value = value.replace(/px$/, '');\n      }\n      return value;\n    };\n    var addPixelSuffix = function (value) {\n      if (value.length > 0 && /^[0-9]+$/.test(value)) {\n        value += 'px';\n      }\n      return value;\n    };\n    var mergeMargins = function (css) {\n      if (css.margin) {\n        var splitMargin = String(css.margin).split(' ');\n        switch (splitMargin.length) {\n        case 1:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[0];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[0];\n          css['margin-left'] = css['margin-left'] || splitMargin[0];\n          break;\n        case 2:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[0];\n          css['margin-left'] = css['margin-left'] || splitMargin[1];\n          break;\n        case 3:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[2];\n          css['margin-left'] = css['margin-left'] || splitMargin[1];\n          break;\n        case 4:\n          css['margin-top'] = css['margin-top'] || splitMargin[0];\n          css['margin-right'] = css['margin-right'] || splitMargin[1];\n          css['margin-bottom'] = css['margin-bottom'] || splitMargin[2];\n          css['margin-left'] = css['margin-left'] || splitMargin[3];\n        }\n        delete css.margin;\n      }\n      return css;\n    };\n    var createImageList = function (editor, callback) {\n      var imageList = getImageList(editor);\n      if (typeof imageList === 'string') {\n        global$3.send({\n          url: imageList,\n          success: function (text) {\n            callback(JSON.parse(text));\n          }\n        });\n      } else if (typeof imageList === 'function') {\n        imageList(callback);\n      } else {\n        callback(imageList);\n      }\n    };\n    var waitLoadImage = function (editor, data, imgElm) {\n      var selectImage = function () {\n        imgElm.onload = imgElm.onerror = null;\n        if (editor.selection) {\n          editor.selection.select(imgElm);\n          editor.nodeChanged();\n        }\n      };\n      imgElm.onload = function () {\n        if (!data.width && !data.height && hasDimensions(editor)) {\n          editor.dom.setAttribs(imgElm, {\n            width: String(imgElm.clientWidth),\n            height: String(imgElm.clientHeight)\n          });\n        }\n        selectImage();\n      };\n      imgElm.onerror = selectImage;\n    };\n    var blobToDataUri = function (blob) {\n      return new global$2(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onload = function () {\n          resolve(reader.result);\n        };\n        reader.onerror = function () {\n          reject(reader.error.message);\n        };\n        reader.readAsDataURL(blob);\n      });\n    };\n    var isPlaceholderImage = function (imgElm) {\n      return imgElm.nodeName === 'IMG' && (imgElm.hasAttribute('data-mce-object') || imgElm.hasAttribute('data-mce-placeholder'));\n    };\n\n    var DOM = global$1.DOM;\n    var getHspace = function (image) {\n      if (image.style.marginLeft && image.style.marginRight && image.style.marginLeft === image.style.marginRight) {\n        return removePixelSuffix(image.style.marginLeft);\n      } else {\n        return '';\n      }\n    };\n    var getVspace = function (image) {\n      if (image.style.marginTop && image.style.marginBottom && image.style.marginTop === image.style.marginBottom) {\n        return removePixelSuffix(image.style.marginTop);\n      } else {\n        return '';\n      }\n    };\n    var getBorder = function (image) {\n      if (image.style.borderWidth) {\n        return removePixelSuffix(image.style.borderWidth);\n      } else {\n        return '';\n      }\n    };\n    var getAttrib = function (image, name) {\n      if (image.hasAttribute(name)) {\n        return image.getAttribute(name);\n      } else {\n        return '';\n      }\n    };\n    var getStyle = function (image, name) {\n      return image.style[name] ? image.style[name] : '';\n    };\n    var hasCaption = function (image) {\n      return image.parentNode !== null && image.parentNode.nodeName === 'FIGURE';\n    };\n    var updateAttrib = function (image, name, value) {\n      if (value === '') {\n        image.removeAttribute(name);\n      } else {\n        image.setAttribute(name, value);\n      }\n    };\n    var wrapInFigure = function (image) {\n      var figureElm = DOM.create('figure', { class: 'image' });\n      DOM.insertAfter(figureElm, image);\n      figureElm.appendChild(image);\n      figureElm.appendChild(DOM.create('figcaption', { contentEditable: 'true' }, 'Caption'));\n      figureElm.contentEditable = 'false';\n    };\n    var removeFigure = function (image) {\n      var figureElm = image.parentNode;\n      DOM.insertAfter(image, figureElm);\n      DOM.remove(figureElm);\n    };\n    var toggleCaption = function (image) {\n      if (hasCaption(image)) {\n        removeFigure(image);\n      } else {\n        wrapInFigure(image);\n      }\n    };\n    var normalizeStyle = function (image, normalizeCss) {\n      var attrValue = image.getAttribute('style');\n      var value = normalizeCss(attrValue !== null ? attrValue : '');\n      if (value.length > 0) {\n        image.setAttribute('style', value);\n        image.setAttribute('data-mce-style', value);\n      } else {\n        image.removeAttribute('style');\n      }\n    };\n    var setSize = function (name, normalizeCss) {\n      return function (image, name, value) {\n        if (image.style[name]) {\n          image.style[name] = addPixelSuffix(value);\n          normalizeStyle(image, normalizeCss);\n        } else {\n          updateAttrib(image, name, value);\n        }\n      };\n    };\n    var getSize = function (image, name) {\n      if (image.style[name]) {\n        return removePixelSuffix(image.style[name]);\n      } else {\n        return getAttrib(image, name);\n      }\n    };\n    var setHspace = function (image, value) {\n      var pxValue = addPixelSuffix(value);\n      image.style.marginLeft = pxValue;\n      image.style.marginRight = pxValue;\n    };\n    var setVspace = function (image, value) {\n      var pxValue = addPixelSuffix(value);\n      image.style.marginTop = pxValue;\n      image.style.marginBottom = pxValue;\n    };\n    var setBorder = function (image, value) {\n      var pxValue = addPixelSuffix(value);\n      image.style.borderWidth = pxValue;\n    };\n    var setBorderStyle = function (image, value) {\n      image.style.borderStyle = value;\n    };\n    var getBorderStyle = function (image) {\n      return getStyle(image, 'borderStyle');\n    };\n    var isFigure = function (elm) {\n      return elm.nodeName === 'FIGURE';\n    };\n    var isImage = function (elm) {\n      return elm.nodeName === 'IMG';\n    };\n    var getIsDecorative = function (image) {\n      return DOM.getAttrib(image, 'alt').length === 0 && DOM.getAttrib(image, 'role') === 'presentation';\n    };\n    var getAlt = function (image) {\n      if (getIsDecorative(image)) {\n        return '';\n      } else {\n        return getAttrib(image, 'alt');\n      }\n    };\n    var defaultData = function () {\n      return {\n        src: '',\n        alt: '',\n        title: '',\n        width: '',\n        height: '',\n        class: '',\n        style: '',\n        caption: false,\n        hspace: '',\n        vspace: '',\n        border: '',\n        borderStyle: '',\n        isDecorative: false\n      };\n    };\n    var getStyleValue = function (normalizeCss, data) {\n      var image = document.createElement('img');\n      updateAttrib(image, 'style', data.style);\n      if (getHspace(image) || data.hspace !== '') {\n        setHspace(image, data.hspace);\n      }\n      if (getVspace(image) || data.vspace !== '') {\n        setVspace(image, data.vspace);\n      }\n      if (getBorder(image) || data.border !== '') {\n        setBorder(image, data.border);\n      }\n      if (getBorderStyle(image) || data.borderStyle !== '') {\n        setBorderStyle(image, data.borderStyle);\n      }\n      return normalizeCss(image.getAttribute('style'));\n    };\n    var create = function (normalizeCss, data) {\n      var image = document.createElement('img');\n      write(normalizeCss, __assign(__assign({}, data), { caption: false }), image);\n      setAlt(image, data.alt, data.isDecorative);\n      if (data.caption) {\n        var figure = DOM.create('figure', { class: 'image' });\n        figure.appendChild(image);\n        figure.appendChild(DOM.create('figcaption', { contentEditable: 'true' }, 'Caption'));\n        figure.contentEditable = 'false';\n        return figure;\n      } else {\n        return image;\n      }\n    };\n    var read = function (normalizeCss, image) {\n      return {\n        src: getAttrib(image, 'src'),\n        alt: getAlt(image),\n        title: getAttrib(image, 'title'),\n        width: getSize(image, 'width'),\n        height: getSize(image, 'height'),\n        class: getAttrib(image, 'class'),\n        style: normalizeCss(getAttrib(image, 'style')),\n        caption: hasCaption(image),\n        hspace: getHspace(image),\n        vspace: getVspace(image),\n        border: getBorder(image),\n        borderStyle: getStyle(image, 'borderStyle'),\n        isDecorative: getIsDecorative(image)\n      };\n    };\n    var updateProp = function (image, oldData, newData, name, set) {\n      if (newData[name] !== oldData[name]) {\n        set(image, name, newData[name]);\n      }\n    };\n    var setAlt = function (image, alt, isDecorative) {\n      if (isDecorative) {\n        DOM.setAttrib(image, 'role', 'presentation');\n        var sugarImage = SugarElement.fromDom(image);\n        set(sugarImage, 'alt', '');\n      } else {\n        if (isNull(alt)) {\n          var sugarImage = SugarElement.fromDom(image);\n          remove(sugarImage, 'alt');\n        } else {\n          var sugarImage = SugarElement.fromDom(image);\n          set(sugarImage, 'alt', alt);\n        }\n        if (DOM.getAttrib(image, 'role') === 'presentation') {\n          DOM.setAttrib(image, 'role', '');\n        }\n      }\n    };\n    var updateAlt = function (image, oldData, newData) {\n      if (newData.alt !== oldData.alt || newData.isDecorative !== oldData.isDecorative) {\n        setAlt(image, newData.alt, newData.isDecorative);\n      }\n    };\n    var normalized = function (set, normalizeCss) {\n      return function (image, name, value) {\n        set(image, value);\n        normalizeStyle(image, normalizeCss);\n      };\n    };\n    var write = function (normalizeCss, newData, image) {\n      var oldData = read(normalizeCss, image);\n      updateProp(image, oldData, newData, 'caption', function (image, _name, _value) {\n        return toggleCaption(image);\n      });\n      updateProp(image, oldData, newData, 'src', updateAttrib);\n      updateProp(image, oldData, newData, 'title', updateAttrib);\n      updateProp(image, oldData, newData, 'width', setSize('width', normalizeCss));\n      updateProp(image, oldData, newData, 'height', setSize('height', normalizeCss));\n      updateProp(image, oldData, newData, 'class', updateAttrib);\n      updateProp(image, oldData, newData, 'style', normalized(function (image, value) {\n        return updateAttrib(image, 'style', value);\n      }, normalizeCss));\n      updateProp(image, oldData, newData, 'hspace', normalized(setHspace, normalizeCss));\n      updateProp(image, oldData, newData, 'vspace', normalized(setVspace, normalizeCss));\n      updateProp(image, oldData, newData, 'border', normalized(setBorder, normalizeCss));\n      updateProp(image, oldData, newData, 'borderStyle', normalized(setBorderStyle, normalizeCss));\n      updateAlt(image, oldData, newData);\n    };\n\n    var normalizeCss = function (editor, cssText) {\n      var css = editor.dom.styles.parse(cssText);\n      var mergedCss = mergeMargins(css);\n      var compressed = editor.dom.styles.parse(editor.dom.styles.serialize(mergedCss));\n      return editor.dom.styles.serialize(compressed);\n    };\n    var getSelectedImage = function (editor) {\n      var imgElm = editor.selection.getNode();\n      var figureElm = editor.dom.getParent(imgElm, 'figure.image');\n      if (figureElm) {\n        return editor.dom.select('img', figureElm)[0];\n      }\n      if (imgElm && (imgElm.nodeName !== 'IMG' || isPlaceholderImage(imgElm))) {\n        return null;\n      }\n      return imgElm;\n    };\n    var splitTextBlock = function (editor, figure) {\n      var dom = editor.dom;\n      var textBlockElements = filter(editor.schema.getTextBlockElements(), function (_, parentElm) {\n        return !editor.schema.isValidChild(parentElm, 'figure');\n      });\n      var textBlock = dom.getParent(figure.parentNode, function (node) {\n        return hasNonNullableKey(textBlockElements, node.nodeName);\n      }, editor.getBody());\n      if (textBlock) {\n        return dom.split(textBlock, figure);\n      } else {\n        return figure;\n      }\n    };\n    var readImageDataFromSelection = function (editor) {\n      var image = getSelectedImage(editor);\n      return image ? read(function (css) {\n        return normalizeCss(editor, css);\n      }, image) : defaultData();\n    };\n    var insertImageAtCaret = function (editor, data) {\n      var elm = create(function (css) {\n        return normalizeCss(editor, css);\n      }, data);\n      editor.dom.setAttrib(elm, 'data-mce-id', '__mcenew');\n      editor.focus();\n      editor.selection.setContent(elm.outerHTML);\n      var insertedElm = editor.dom.select('*[data-mce-id=\"__mcenew\"]')[0];\n      editor.dom.setAttrib(insertedElm, 'data-mce-id', null);\n      if (isFigure(insertedElm)) {\n        var figure = splitTextBlock(editor, insertedElm);\n        editor.selection.select(figure);\n      } else {\n        editor.selection.select(insertedElm);\n      }\n    };\n    var syncSrcAttr = function (editor, image) {\n      editor.dom.setAttrib(image, 'src', image.getAttribute('src'));\n    };\n    var deleteImage = function (editor, image) {\n      if (image) {\n        var elm = editor.dom.is(image.parentNode, 'figure.image') ? image.parentNode : image;\n        editor.dom.remove(elm);\n        editor.focus();\n        editor.nodeChanged();\n        if (editor.dom.isEmpty(editor.getBody())) {\n          editor.setContent('');\n          editor.selection.setCursorLocation();\n        }\n      }\n    };\n    var writeImageDataToSelection = function (editor, data) {\n      var image = getSelectedImage(editor);\n      write(function (css) {\n        return normalizeCss(editor, css);\n      }, data, image);\n      syncSrcAttr(editor, image);\n      if (isFigure(image.parentNode)) {\n        var figure = image.parentNode;\n        splitTextBlock(editor, figure);\n        editor.selection.select(image.parentNode);\n      } else {\n        editor.selection.select(image);\n        waitLoadImage(editor, data, image);\n      }\n    };\n    var insertOrUpdateImage = function (editor, partialData) {\n      var image = getSelectedImage(editor);\n      if (image) {\n        var selectedImageData = read(function (css) {\n          return normalizeCss(editor, css);\n        }, image);\n        var data = __assign(__assign({}, selectedImageData), partialData);\n        if (data.src) {\n          writeImageDataToSelection(editor, data);\n        } else {\n          deleteImage(editor, image);\n        }\n      } else if (partialData.src) {\n        insertImageAtCaret(editor, __assign(__assign({}, defaultData()), partialData));\n      }\n    };\n\n    var hasOwnProperty$1 = Object.prototype.hasOwnProperty;\n    var deep = function (old, nu) {\n      var bothObjects = isObject(old) && isObject(nu);\n      return bothObjects ? deepMerge(old, nu) : nu;\n    };\n    var baseMerge = function (merger) {\n      return function () {\n        var objects = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          objects[_i] = arguments[_i];\n        }\n        if (objects.length === 0) {\n          throw new Error('Can\\'t merge zero objects');\n        }\n        var ret = {};\n        for (var j = 0; j < objects.length; j++) {\n          var curObject = objects[j];\n          for (var key in curObject) {\n            if (hasOwnProperty$1.call(curObject, key)) {\n              ret[key] = merger(ret[key], curObject[key]);\n            }\n          }\n        }\n        return ret;\n      };\n    };\n    var deepMerge = baseMerge(deep);\n\n    var isNotEmpty = function (s) {\n      return s.length > 0;\n    };\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.util.ImageUploader');\n\n    var global$5 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var getValue = function (item) {\n      return isString(item.value) ? item.value : '';\n    };\n    var getText = function (item) {\n      if (isString(item.text)) {\n        return item.text;\n      } else if (isString(item.title)) {\n        return item.title;\n      } else {\n        return '';\n      }\n    };\n    var sanitizeList = function (list, extractValue) {\n      var out = [];\n      global$5.each(list, function (item) {\n        var text = getText(item);\n        if (item.menu !== undefined) {\n          var items = sanitizeList(item.menu, extractValue);\n          out.push({\n            text: text,\n            items: items\n          });\n        } else {\n          var value = extractValue(item);\n          out.push({\n            text: text,\n            value: value\n          });\n        }\n      });\n      return out;\n    };\n    var sanitizer = function (extracter) {\n      if (extracter === void 0) {\n        extracter = getValue;\n      }\n      return function (list) {\n        if (list) {\n          return Optional.from(list).map(function (list) {\n            return sanitizeList(list, extracter);\n          });\n        } else {\n          return Optional.none();\n        }\n      };\n    };\n    var sanitize = function (list) {\n      return sanitizer(getValue)(list);\n    };\n    var isGroup = function (item) {\n      return Object.prototype.hasOwnProperty.call(item, 'items');\n    };\n    var findEntryDelegate = function (list, value) {\n      return findMap(list, function (item) {\n        if (isGroup(item)) {\n          return findEntryDelegate(item.items, value);\n        } else if (item.value === value) {\n          return Optional.some(item);\n        } else {\n          return Optional.none();\n        }\n      });\n    };\n    var findEntry = function (optList, value) {\n      return optList.bind(function (list) {\n        return findEntryDelegate(list, value);\n      });\n    };\n    var ListUtils = {\n      sanitizer: sanitizer,\n      sanitize: sanitize,\n      findEntry: findEntry\n    };\n\n    var makeTab = function (_info) {\n      return {\n        title: 'Advanced',\n        name: 'advanced',\n        items: [\n          {\n            type: 'input',\n            label: 'Style',\n            name: 'style'\n          },\n          {\n            type: 'grid',\n            columns: 2,\n            items: [\n              {\n                type: 'input',\n                label: 'Vertical space',\n                name: 'vspace',\n                inputMode: 'numeric'\n              },\n              {\n                type: 'input',\n                label: 'Horizontal space',\n                name: 'hspace',\n                inputMode: 'numeric'\n              },\n              {\n                type: 'input',\n                label: 'Border width',\n                name: 'border',\n                inputMode: 'numeric'\n              },\n              {\n                type: 'listbox',\n                name: 'borderstyle',\n                label: 'Border style',\n                items: [\n                  {\n                    text: 'Select...',\n                    value: ''\n                  },\n                  {\n                    text: 'Solid',\n                    value: 'solid'\n                  },\n                  {\n                    text: 'Dotted',\n                    value: 'dotted'\n                  },\n                  {\n                    text: 'Dashed',\n                    value: 'dashed'\n                  },\n                  {\n                    text: 'Double',\n                    value: 'double'\n                  },\n                  {\n                    text: 'Groove',\n                    value: 'groove'\n                  },\n                  {\n                    text: 'Ridge',\n                    value: 'ridge'\n                  },\n                  {\n                    text: 'Inset',\n                    value: 'inset'\n                  },\n                  {\n                    text: 'Outset',\n                    value: 'outset'\n                  },\n                  {\n                    text: 'None',\n                    value: 'none'\n                  },\n                  {\n                    text: 'Hidden',\n                    value: 'hidden'\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      };\n    };\n    var AdvTab = { makeTab: makeTab };\n\n    var collect = function (editor) {\n      var urlListSanitizer = ListUtils.sanitizer(function (item) {\n        return editor.convertURL(item.value || item.url, 'src');\n      });\n      var futureImageList = new global$2(function (completer) {\n        createImageList(editor, function (imageList) {\n          completer(urlListSanitizer(imageList).map(function (items) {\n            return flatten([\n              [{\n                  text: 'None',\n                  value: ''\n                }],\n              items\n            ]);\n          }));\n        });\n      });\n      var classList = ListUtils.sanitize(getClassList(editor));\n      var hasAdvTab$1 = hasAdvTab(editor);\n      var hasUploadTab$1 = hasUploadTab(editor);\n      var hasUploadUrl$1 = hasUploadUrl(editor);\n      var hasUploadHandler$1 = hasUploadHandler(editor);\n      var image = readImageDataFromSelection(editor);\n      var hasDescription$1 = hasDescription(editor);\n      var hasImageTitle$1 = hasImageTitle(editor);\n      var hasDimensions$1 = hasDimensions(editor);\n      var hasImageCaption$1 = hasImageCaption(editor);\n      var hasAccessibilityOptions = showAccessibilityOptions(editor);\n      var automaticUploads = isAutomaticUploadsEnabled(editor);\n      var prependURL = Optional.some(getPrependUrl(editor)).filter(function (preUrl) {\n        return isString(preUrl) && preUrl.length > 0;\n      });\n      return futureImageList.then(function (imageList) {\n        return {\n          image: image,\n          imageList: imageList,\n          classList: classList,\n          hasAdvTab: hasAdvTab$1,\n          hasUploadTab: hasUploadTab$1,\n          hasUploadUrl: hasUploadUrl$1,\n          hasUploadHandler: hasUploadHandler$1,\n          hasDescription: hasDescription$1,\n          hasImageTitle: hasImageTitle$1,\n          hasDimensions: hasDimensions$1,\n          hasImageCaption: hasImageCaption$1,\n          prependURL: prependURL,\n          hasAccessibilityOptions: hasAccessibilityOptions,\n          automaticUploads: automaticUploads\n        };\n      });\n    };\n\n    var makeItems = function (info) {\n      var imageUrl = {\n        name: 'src',\n        type: 'urlinput',\n        filetype: 'image',\n        label: 'Source'\n      };\n      var imageList = info.imageList.map(function (items) {\n        return {\n          name: 'images',\n          type: 'listbox',\n          label: 'Image list',\n          items: items\n        };\n      });\n      var imageDescription = {\n        name: 'alt',\n        type: 'input',\n        label: 'Alternative description',\n        disabled: info.hasAccessibilityOptions && info.image.isDecorative\n      };\n      var imageTitle = {\n        name: 'title',\n        type: 'input',\n        label: 'Image title'\n      };\n      var imageDimensions = {\n        name: 'dimensions',\n        type: 'sizeinput'\n      };\n      var isDecorative = {\n        type: 'label',\n        label: 'Accessibility',\n        items: [{\n            name: 'isDecorative',\n            type: 'checkbox',\n            label: 'Image is decorative'\n          }]\n      };\n      var classList = info.classList.map(function (items) {\n        return {\n          name: 'classes',\n          type: 'listbox',\n          label: 'Class',\n          items: items\n        };\n      });\n      var caption = {\n        type: 'label',\n        label: 'Caption',\n        items: [{\n            type: 'checkbox',\n            name: 'caption',\n            label: 'Show caption'\n          }]\n      };\n      var getDialogContainerType = function (useColumns) {\n        return useColumns ? {\n          type: 'grid',\n          columns: 2\n        } : { type: 'panel' };\n      };\n      return flatten([\n        [imageUrl],\n        imageList.toArray(),\n        info.hasAccessibilityOptions && info.hasDescription ? [isDecorative] : [],\n        info.hasDescription ? [imageDescription] : [],\n        info.hasImageTitle ? [imageTitle] : [],\n        info.hasDimensions ? [imageDimensions] : [],\n        [__assign(__assign({}, getDialogContainerType(info.classList.isSome() && info.hasImageCaption)), {\n            items: flatten([\n              classList.toArray(),\n              info.hasImageCaption ? [caption] : []\n            ])\n          })]\n      ]);\n    };\n    var makeTab$1 = function (info) {\n      return {\n        title: 'General',\n        name: 'general',\n        items: makeItems(info)\n      };\n    };\n    var MainTab = {\n      makeTab: makeTab$1,\n      makeItems: makeItems\n    };\n\n    var makeTab$2 = function (_info) {\n      var items = [{\n          type: 'dropzone',\n          name: 'fileinput'\n        }];\n      return {\n        title: 'Upload',\n        name: 'upload',\n        items: items\n      };\n    };\n    var UploadTab = { makeTab: makeTab$2 };\n\n    var createState = function (info) {\n      return {\n        prevImage: ListUtils.findEntry(info.imageList, info.image.src),\n        prevAlt: info.image.alt,\n        open: true\n      };\n    };\n    var fromImageData = function (image) {\n      return {\n        src: {\n          value: image.src,\n          meta: {}\n        },\n        images: image.src,\n        alt: image.alt,\n        title: image.title,\n        dimensions: {\n          width: image.width,\n          height: image.height\n        },\n        classes: image.class,\n        caption: image.caption,\n        style: image.style,\n        vspace: image.vspace,\n        border: image.border,\n        hspace: image.hspace,\n        borderstyle: image.borderStyle,\n        fileinput: [],\n        isDecorative: image.isDecorative\n      };\n    };\n    var toImageData = function (data, removeEmptyAlt) {\n      return {\n        src: data.src.value,\n        alt: data.alt.length === 0 && removeEmptyAlt ? null : data.alt,\n        title: data.title,\n        width: data.dimensions.width,\n        height: data.dimensions.height,\n        class: data.classes,\n        style: data.style,\n        caption: data.caption,\n        hspace: data.hspace,\n        vspace: data.vspace,\n        border: data.border,\n        borderStyle: data.borderstyle,\n        isDecorative: data.isDecorative\n      };\n    };\n    var addPrependUrl2 = function (info, srcURL) {\n      if (!/^(?:[a-zA-Z]+:)?\\/\\//.test(srcURL)) {\n        return info.prependURL.bind(function (prependUrl) {\n          if (srcURL.substring(0, prependUrl.length) !== prependUrl) {\n            return Optional.some(prependUrl + srcURL);\n          }\n          return Optional.none();\n        });\n      }\n      return Optional.none();\n    };\n    var addPrependUrl = function (info, api) {\n      var data = api.getData();\n      addPrependUrl2(info, data.src.value).each(function (srcURL) {\n        api.setData({\n          src: {\n            value: srcURL,\n            meta: data.src.meta\n          }\n        });\n      });\n    };\n    var formFillFromMeta2 = function (info, data, meta) {\n      if (info.hasDescription && isString(meta.alt)) {\n        data.alt = meta.alt;\n      }\n      if (info.hasAccessibilityOptions) {\n        data.isDecorative = meta.isDecorative || data.isDecorative || false;\n      }\n      if (info.hasImageTitle && isString(meta.title)) {\n        data.title = meta.title;\n      }\n      if (info.hasDimensions) {\n        if (isString(meta.width)) {\n          data.dimensions.width = meta.width;\n        }\n        if (isString(meta.height)) {\n          data.dimensions.height = meta.height;\n        }\n      }\n      if (isString(meta.class)) {\n        ListUtils.findEntry(info.classList, meta.class).each(function (entry) {\n          data.classes = entry.value;\n        });\n      }\n      if (info.hasImageCaption) {\n        if (isBoolean(meta.caption)) {\n          data.caption = meta.caption;\n        }\n      }\n      if (info.hasAdvTab) {\n        if (isString(meta.style)) {\n          data.style = meta.style;\n        }\n        if (isString(meta.vspace)) {\n          data.vspace = meta.vspace;\n        }\n        if (isString(meta.border)) {\n          data.border = meta.border;\n        }\n        if (isString(meta.hspace)) {\n          data.hspace = meta.hspace;\n        }\n        if (isString(meta.borderstyle)) {\n          data.borderstyle = meta.borderstyle;\n        }\n      }\n    };\n    var formFillFromMeta = function (info, api) {\n      var data = api.getData();\n      var meta = data.src.meta;\n      if (meta !== undefined) {\n        var newData = deepMerge({}, data);\n        formFillFromMeta2(info, newData, meta);\n        api.setData(newData);\n      }\n    };\n    var calculateImageSize = function (helpers, info, state, api) {\n      var data = api.getData();\n      var url = data.src.value;\n      var meta = data.src.meta || {};\n      if (!meta.width && !meta.height && info.hasDimensions) {\n        if (isNotEmpty(url)) {\n          helpers.imageSize(url).then(function (size) {\n            if (state.open) {\n              api.setData({ dimensions: size });\n            }\n          }).catch(function (e) {\n            return console.error(e);\n          });\n        } else {\n          api.setData({\n            dimensions: {\n              width: '',\n              height: ''\n            }\n          });\n        }\n      }\n    };\n    var updateImagesDropdown = function (info, state, api) {\n      var data = api.getData();\n      var image = ListUtils.findEntry(info.imageList, data.src.value);\n      state.prevImage = image;\n      api.setData({\n        images: image.map(function (entry) {\n          return entry.value;\n        }).getOr('')\n      });\n    };\n    var changeSrc = function (helpers, info, state, api) {\n      addPrependUrl(info, api);\n      formFillFromMeta(info, api);\n      calculateImageSize(helpers, info, state, api);\n      updateImagesDropdown(info, state, api);\n    };\n    var changeImages = function (helpers, info, state, api) {\n      var data = api.getData();\n      var image = ListUtils.findEntry(info.imageList, data.images);\n      image.each(function (img) {\n        var updateAlt = data.alt === '' || state.prevImage.map(function (image) {\n          return image.text === data.alt;\n        }).getOr(false);\n        if (updateAlt) {\n          if (img.value === '') {\n            api.setData({\n              src: img,\n              alt: state.prevAlt\n            });\n          } else {\n            api.setData({\n              src: img,\n              alt: img.text\n            });\n          }\n        } else {\n          api.setData({ src: img });\n        }\n      });\n      state.prevImage = image;\n      changeSrc(helpers, info, state, api);\n    };\n    var calcVSpace = function (css) {\n      var matchingTopBottom = css['margin-top'] && css['margin-bottom'] && css['margin-top'] === css['margin-bottom'];\n      return matchingTopBottom ? removePixelSuffix(String(css['margin-top'])) : '';\n    };\n    var calcHSpace = function (css) {\n      var matchingLeftRight = css['margin-right'] && css['margin-left'] && css['margin-right'] === css['margin-left'];\n      return matchingLeftRight ? removePixelSuffix(String(css['margin-right'])) : '';\n    };\n    var calcBorderWidth = function (css) {\n      return css['border-width'] ? removePixelSuffix(String(css['border-width'])) : '';\n    };\n    var calcBorderStyle = function (css) {\n      return css['border-style'] ? String(css['border-style']) : '';\n    };\n    var calcStyle = function (parseStyle, serializeStyle, css) {\n      return serializeStyle(parseStyle(serializeStyle(css)));\n    };\n    var changeStyle2 = function (parseStyle, serializeStyle, data) {\n      var css = mergeMargins(parseStyle(data.style));\n      var dataCopy = deepMerge({}, data);\n      dataCopy.vspace = calcVSpace(css);\n      dataCopy.hspace = calcHSpace(css);\n      dataCopy.border = calcBorderWidth(css);\n      dataCopy.borderstyle = calcBorderStyle(css);\n      dataCopy.style = calcStyle(parseStyle, serializeStyle, css);\n      return dataCopy;\n    };\n    var changeStyle = function (helpers, api) {\n      var data = api.getData();\n      var newData = changeStyle2(helpers.parseStyle, helpers.serializeStyle, data);\n      api.setData(newData);\n    };\n    var changeAStyle = function (helpers, info, api) {\n      var data = deepMerge(fromImageData(info.image), api.getData());\n      var style = getStyleValue(helpers.normalizeCss, toImageData(data, false));\n      api.setData({ style: style });\n    };\n    var changeFileInput = function (helpers, info, state, api) {\n      var data = api.getData();\n      api.block('Uploading image');\n      head(data.fileinput).fold(function () {\n        api.unblock();\n      }, function (file) {\n        var blobUri = URL.createObjectURL(file);\n        var finalize = function () {\n          api.unblock();\n          URL.revokeObjectURL(blobUri);\n        };\n        var updateSrcAndSwitchTab = function (url) {\n          api.setData({\n            src: {\n              value: url,\n              meta: {}\n            }\n          });\n          api.showTab('general');\n          changeSrc(helpers, info, state, api);\n        };\n        blobToDataUri(file).then(function (dataUrl) {\n          var blobInfo = helpers.createBlobCache(file, blobUri, dataUrl);\n          if (info.automaticUploads) {\n            helpers.uploadImage(blobInfo).then(function (result) {\n              updateSrcAndSwitchTab(result.url);\n              finalize();\n            }).catch(function (err) {\n              finalize();\n              helpers.alertErr(err);\n            });\n          } else {\n            helpers.addToBlobCache(blobInfo);\n            updateSrcAndSwitchTab(blobInfo.blobUri());\n            api.unblock();\n          }\n        });\n      });\n    };\n    var changeHandler = function (helpers, info, state) {\n      return function (api, evt) {\n        if (evt.name === 'src') {\n          changeSrc(helpers, info, state, api);\n        } else if (evt.name === 'images') {\n          changeImages(helpers, info, state, api);\n        } else if (evt.name === 'alt') {\n          state.prevAlt = api.getData().alt;\n        } else if (evt.name === 'style') {\n          changeStyle(helpers, api);\n        } else if (evt.name === 'vspace' || evt.name === 'hspace' || evt.name === 'border' || evt.name === 'borderstyle') {\n          changeAStyle(helpers, info, api);\n        } else if (evt.name === 'fileinput') {\n          changeFileInput(helpers, info, state, api);\n        } else if (evt.name === 'isDecorative') {\n          if (api.getData().isDecorative) {\n            api.disable('alt');\n          } else {\n            api.enable('alt');\n          }\n        }\n      };\n    };\n    var closeHandler = function (state) {\n      return function () {\n        state.open = false;\n      };\n    };\n    var makeDialogBody = function (info) {\n      if (info.hasAdvTab || info.hasUploadUrl || info.hasUploadHandler) {\n        var tabPanel = {\n          type: 'tabpanel',\n          tabs: flatten([\n            [MainTab.makeTab(info)],\n            info.hasAdvTab ? [AdvTab.makeTab(info)] : [],\n            info.hasUploadTab && (info.hasUploadUrl || info.hasUploadHandler) ? [UploadTab.makeTab(info)] : []\n          ])\n        };\n        return tabPanel;\n      } else {\n        var panel = {\n          type: 'panel',\n          items: MainTab.makeItems(info)\n        };\n        return panel;\n      }\n    };\n    var makeDialog = function (helpers) {\n      return function (info) {\n        var state = createState(info);\n        return {\n          title: 'Insert/Edit Image',\n          size: 'normal',\n          body: makeDialogBody(info),\n          buttons: [\n            {\n              type: 'cancel',\n              name: 'cancel',\n              text: 'Cancel'\n            },\n            {\n              type: 'submit',\n              name: 'save',\n              text: 'Save',\n              primary: true\n            }\n          ],\n          initialData: fromImageData(info.image),\n          onSubmit: helpers.onSubmit(info),\n          onChange: changeHandler(helpers, info, state),\n          onClose: closeHandler(state)\n        };\n      };\n    };\n    var submitHandler = function (editor) {\n      return function (info) {\n        return function (api) {\n          var data = deepMerge(fromImageData(info.image), api.getData());\n          editor.execCommand('mceUpdateImage', false, toImageData(data, info.hasAccessibilityOptions));\n          editor.editorUpload.uploadImagesAuto();\n          api.close();\n        };\n      };\n    };\n    var imageSize = function (editor) {\n      return function (url) {\n        return getImageSize(editor.documentBaseURI.toAbsolute(url)).then(function (dimensions) {\n          return {\n            width: String(dimensions.width),\n            height: String(dimensions.height)\n          };\n        });\n      };\n    };\n    var createBlobCache = function (editor) {\n      return function (file, blobUri, dataUrl) {\n        return editor.editorUpload.blobCache.create({\n          blob: file,\n          blobUri: blobUri,\n          name: file.name ? file.name.replace(/\\.[^\\.]+$/, '') : null,\n          filename: file.name,\n          base64: dataUrl.split(',')[1]\n        });\n      };\n    };\n    var addToBlobCache = function (editor) {\n      return function (blobInfo) {\n        editor.editorUpload.blobCache.add(blobInfo);\n      };\n    };\n    var alertErr = function (editor) {\n      return function (message) {\n        editor.windowManager.alert(message);\n      };\n    };\n    var normalizeCss$1 = function (editor) {\n      return function (cssText) {\n        return normalizeCss(editor, cssText);\n      };\n    };\n    var parseStyle = function (editor) {\n      return function (cssText) {\n        return editor.dom.parseStyle(cssText);\n      };\n    };\n    var serializeStyle = function (editor) {\n      return function (stylesArg, name) {\n        return editor.dom.serializeStyle(stylesArg, name);\n      };\n    };\n    var uploadImage = function (editor) {\n      return function (blobInfo) {\n        return global$4(editor).upload([blobInfo], false).then(function (results) {\n          if (results.length === 0) {\n            return global$2.reject('Failed to upload image');\n          } else if (results[0].status === false) {\n            return global$2.reject(results[0].error.message);\n          } else {\n            return results[0];\n          }\n        });\n      };\n    };\n    var Dialog = function (editor) {\n      var helpers = {\n        onSubmit: submitHandler(editor),\n        imageSize: imageSize(editor),\n        addToBlobCache: addToBlobCache(editor),\n        createBlobCache: createBlobCache(editor),\n        alertErr: alertErr(editor),\n        normalizeCss: normalizeCss$1(editor),\n        parseStyle: parseStyle(editor),\n        serializeStyle: serializeStyle(editor),\n        uploadImage: uploadImage(editor)\n      };\n      var open = function () {\n        collect(editor).then(makeDialog(helpers)).then(editor.windowManager.open);\n      };\n      return { open: open };\n    };\n\n    var register = function (editor) {\n      editor.addCommand('mceImage', Dialog(editor).open);\n      editor.addCommand('mceUpdateImage', function (_ui, data) {\n        editor.undoManager.transact(function () {\n          return insertOrUpdateImage(editor, data);\n        });\n      });\n    };\n\n    var hasImageClass = function (node) {\n      var className = node.attr('class');\n      return className && /\\bimage\\b/.test(className);\n    };\n    var toggleContentEditableState = function (state) {\n      return function (nodes) {\n        var i = nodes.length;\n        var toggleContentEditable = function (node) {\n          node.attr('contenteditable', state ? 'true' : null);\n        };\n        while (i--) {\n          var node = nodes[i];\n          if (hasImageClass(node)) {\n            node.attr('contenteditable', state ? 'false' : null);\n            global$5.each(node.getAll('figcaption'), toggleContentEditable);\n          }\n        }\n      };\n    };\n    var setup = function (editor) {\n      editor.on('PreInit', function () {\n        editor.parser.addNodeFilter('figure', toggleContentEditableState(true));\n        editor.serializer.addNodeFilter('figure', toggleContentEditableState(false));\n      });\n    };\n\n    var register$1 = function (editor) {\n      editor.ui.registry.addToggleButton('image', {\n        icon: 'image',\n        tooltip: 'Insert/edit image',\n        onAction: Dialog(editor).open,\n        onSetup: function (buttonApi) {\n          return editor.selection.selectorChangedWithUnbind('img:not([data-mce-object],[data-mce-placeholder]),figure.image', buttonApi.setActive).unbind;\n        }\n      });\n      editor.ui.registry.addMenuItem('image', {\n        icon: 'image',\n        text: 'Image...',\n        onAction: Dialog(editor).open\n      });\n      editor.ui.registry.addContextMenu('image', {\n        update: function (element) {\n          return isFigure(element) || isImage(element) && !isPlaceholderImage(element) ? ['image'] : [];\n        }\n      });\n    };\n\n    function Plugin () {\n      global.add('image', function (editor) {\n        setup(editor);\n        register$1(editor);\n        register(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]},"metadata":{},"sourceType":"script"}