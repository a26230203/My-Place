{"ast":null,"code":"/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.8.2 (2021-06-23)\n */\n(function () {\n  'use strict';\n\n  var typeOf = function (x) {\n    var t = typeof x;\n\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n\n  var isType = function (type) {\n    return function (value) {\n      return typeOf(value) === type;\n    };\n  };\n\n  var isSimpleType = function (type) {\n    return function (value) {\n      return typeof value === type;\n    };\n  };\n\n  var eq = function (t) {\n    return function (a) {\n      return t === a;\n    };\n  };\n\n  var isString = isType('string');\n  var isObject = isType('object');\n  var isArray = isType('array');\n  var isBoolean = isSimpleType('boolean');\n  var isUndefined = eq(undefined);\n\n  var isNullable = function (a) {\n    return a === null || a === undefined;\n  };\n\n  var isNonNullable = function (a) {\n    return !isNullable(a);\n  };\n\n  var isFunction = isSimpleType('function');\n  var isNumber = isSimpleType('number');\n\n  var noop = function () {};\n\n  var compose = function (fa, fb) {\n    return function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      return fa(fb.apply(null, args));\n    };\n  };\n\n  var compose1 = function (fbc, fab) {\n    return function (a) {\n      return fbc(fab(a));\n    };\n  };\n\n  var constant = function (value) {\n    return function () {\n      return value;\n    };\n  };\n\n  var identity = function (x) {\n    return x;\n  };\n\n  function curry(fn) {\n    var initialArgs = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      initialArgs[_i - 1] = arguments[_i];\n    }\n\n    return function () {\n      var restArgs = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        restArgs[_i] = arguments[_i];\n      }\n\n      var all = initialArgs.concat(restArgs);\n      return fn.apply(null, all);\n    };\n  }\n\n  var not = function (f) {\n    return function (t) {\n      return !f(t);\n    };\n  };\n\n  var die = function (msg) {\n    return function () {\n      throw new Error(msg);\n    };\n  };\n\n  var never = constant(false);\n  var always = constant(true);\n\n  var none = function () {\n    return NONE;\n  };\n\n  var NONE = function () {\n    var eq = function (o) {\n      return o.isNone();\n    };\n\n    var call = function (thunk) {\n      return thunk();\n    };\n\n    var id = function (n) {\n      return n;\n    };\n\n    var me = {\n      fold: function (n, _s) {\n        return n();\n      },\n      is: never,\n      isSome: never,\n      isNone: always,\n      getOr: id,\n      getOrThunk: call,\n      getOrDie: function (msg) {\n        throw new Error(msg || 'error: getOrDie called on none.');\n      },\n      getOrNull: constant(null),\n      getOrUndefined: constant(undefined),\n      or: id,\n      orThunk: call,\n      map: none,\n      each: noop,\n      bind: none,\n      exists: never,\n      forall: always,\n      filter: none,\n      equals: eq,\n      equals_: eq,\n      toArray: function () {\n        return [];\n      },\n      toString: constant('none()')\n    };\n    return me;\n  }();\n\n  var some = function (a) {\n    var constant_a = constant(a);\n\n    var self = function () {\n      return me;\n    };\n\n    var bind = function (f) {\n      return f(a);\n    };\n\n    var me = {\n      fold: function (n, s) {\n        return s(a);\n      },\n      is: function (v) {\n        return a === v;\n      },\n      isSome: always,\n      isNone: never,\n      getOr: constant_a,\n      getOrThunk: constant_a,\n      getOrDie: constant_a,\n      getOrNull: constant_a,\n      getOrUndefined: constant_a,\n      or: self,\n      orThunk: self,\n      map: function (f) {\n        return some(f(a));\n      },\n      each: function (f) {\n        f(a);\n      },\n      bind: bind,\n      exists: bind,\n      forall: bind,\n      filter: function (f) {\n        return f(a) ? me : NONE;\n      },\n      toArray: function () {\n        return [a];\n      },\n      toString: function () {\n        return 'some(' + a + ')';\n      },\n      equals: function (o) {\n        return o.is(a);\n      },\n      equals_: function (o, elementEq) {\n        return o.fold(never, function (b) {\n          return elementEq(a, b);\n        });\n      }\n    };\n    return me;\n  };\n\n  var from = function (value) {\n    return value === null || value === undefined ? NONE : some(value);\n  };\n\n  var Optional = {\n    some: some,\n    none: none,\n    from: from\n  };\n  var nativeSlice = Array.prototype.slice;\n  var nativeIndexOf = Array.prototype.indexOf;\n  var nativePush = Array.prototype.push;\n\n  var rawIndexOf = function (ts, t) {\n    return nativeIndexOf.call(ts, t);\n  };\n\n  var contains = function (xs, x) {\n    return rawIndexOf(xs, x) > -1;\n  };\n\n  var exists = function (xs, pred) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n\n      if (pred(x, i)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var range = function (num, f) {\n    var r = [];\n\n    for (var i = 0; i < num; i++) {\n      r.push(f(i));\n    }\n\n    return r;\n  };\n\n  var map = function (xs, f) {\n    var len = xs.length;\n    var r = new Array(len);\n\n    for (var i = 0; i < len; i++) {\n      var x = xs[i];\n      r[i] = f(x, i);\n    }\n\n    return r;\n  };\n\n  var each = function (xs, f) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n\n  var eachr = function (xs, f) {\n    for (var i = xs.length - 1; i >= 0; i--) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n\n  var partition = function (xs, pred) {\n    var pass = [];\n    var fail = [];\n\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      var arr = pred(x, i) ? pass : fail;\n      arr.push(x);\n    }\n\n    return {\n      pass: pass,\n      fail: fail\n    };\n  };\n\n  var filter = function (xs, pred) {\n    var r = [];\n\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n\n      if (pred(x, i)) {\n        r.push(x);\n      }\n    }\n\n    return r;\n  };\n\n  var foldr = function (xs, f, acc) {\n    eachr(xs, function (x) {\n      acc = f(acc, x);\n    });\n    return acc;\n  };\n\n  var foldl = function (xs, f, acc) {\n    each(xs, function (x) {\n      acc = f(acc, x);\n    });\n    return acc;\n  };\n\n  var findUntil = function (xs, pred, until) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n\n      if (pred(x, i)) {\n        return Optional.some(x);\n      } else if (until(x, i)) {\n        break;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var find = function (xs, pred) {\n    return findUntil(xs, pred, never);\n  };\n\n  var findIndex = function (xs, pred) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n\n      if (pred(x, i)) {\n        return Optional.some(i);\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var flatten = function (xs) {\n    var r = [];\n\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n\n      nativePush.apply(r, xs[i]);\n    }\n\n    return r;\n  };\n\n  var bind = function (xs, f) {\n    return flatten(map(xs, f));\n  };\n\n  var forall = function (xs, pred) {\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      var x = xs[i];\n\n      if (pred(x, i) !== true) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  var reverse = function (xs) {\n    var r = nativeSlice.call(xs, 0);\n    r.reverse();\n    return r;\n  };\n\n  var mapToObject = function (xs, f) {\n    var r = {};\n\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      r[String(x)] = f(x, i);\n    }\n\n    return r;\n  };\n\n  var pure = function (x) {\n    return [x];\n  };\n\n  var sort = function (xs, comparator) {\n    var copy = nativeSlice.call(xs, 0);\n    copy.sort(comparator);\n    return copy;\n  };\n\n  var get = function (xs, i) {\n    return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();\n  };\n\n  var head = function (xs) {\n    return get(xs, 0);\n  };\n\n  var last = function (xs) {\n    return get(xs, xs.length - 1);\n  };\n\n  var findMap = function (arr, f) {\n    for (var i = 0; i < arr.length; i++) {\n      var r = f(arr[i], i);\n\n      if (r.isSome()) {\n        return r;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var __assign = function () {\n    __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n\n      return t;\n    };\n\n    return __assign.apply(this, arguments);\n  };\n\n  function __spreadArrays() {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n    for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n    return r;\n  }\n\n  var cached = function (f) {\n    var called = false;\n    var r;\n    return function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      if (!called) {\n        called = true;\n        r = f.apply(null, args);\n      }\n\n      return r;\n    };\n  };\n\n  var DeviceType = function (os, browser, userAgent, mediaMatch) {\n    var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;\n    var isiPhone = os.isiOS() && !isiPad;\n    var isMobile = os.isiOS() || os.isAndroid();\n    var isTouch = isMobile || mediaMatch('(pointer:coarse)');\n    var isTablet = isiPad || !isiPhone && isMobile && mediaMatch('(min-device-width:768px)');\n    var isPhone = isiPhone || isMobile && !isTablet;\n    var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;\n    var isDesktop = !isPhone && !isTablet && !iOSwebview;\n    return {\n      isiPad: constant(isiPad),\n      isiPhone: constant(isiPhone),\n      isTablet: constant(isTablet),\n      isPhone: constant(isPhone),\n      isTouch: constant(isTouch),\n      isAndroid: os.isAndroid,\n      isiOS: os.isiOS,\n      isWebView: constant(iOSwebview),\n      isDesktop: constant(isDesktop)\n    };\n  };\n\n  var firstMatch = function (regexes, s) {\n    for (var i = 0; i < regexes.length; i++) {\n      var x = regexes[i];\n\n      if (x.test(s)) {\n        return x;\n      }\n    }\n\n    return undefined;\n  };\n\n  var find$1 = function (regexes, agent) {\n    var r = firstMatch(regexes, agent);\n\n    if (!r) {\n      return {\n        major: 0,\n        minor: 0\n      };\n    }\n\n    var group = function (i) {\n      return Number(agent.replace(r, '$' + i));\n    };\n\n    return nu(group(1), group(2));\n  };\n\n  var detect = function (versionRegexes, agent) {\n    var cleanedAgent = String(agent).toLowerCase();\n\n    if (versionRegexes.length === 0) {\n      return unknown();\n    }\n\n    return find$1(versionRegexes, cleanedAgent);\n  };\n\n  var unknown = function () {\n    return nu(0, 0);\n  };\n\n  var nu = function (major, minor) {\n    return {\n      major: major,\n      minor: minor\n    };\n  };\n\n  var Version = {\n    nu: nu,\n    detect: detect,\n    unknown: unknown\n  };\n\n  var detect$1 = function (candidates, userAgent) {\n    var agent = String(userAgent).toLowerCase();\n    return find(candidates, function (candidate) {\n      return candidate.search(agent);\n    });\n  };\n\n  var detectBrowser = function (browsers, userAgent) {\n    return detect$1(browsers, userAgent).map(function (browser) {\n      var version = Version.detect(browser.versionRegexes, userAgent);\n      return {\n        current: browser.name,\n        version: version\n      };\n    });\n  };\n\n  var detectOs = function (oses, userAgent) {\n    return detect$1(oses, userAgent).map(function (os) {\n      var version = Version.detect(os.versionRegexes, userAgent);\n      return {\n        current: os.name,\n        version: version\n      };\n    });\n  };\n\n  var UaString = {\n    detectBrowser: detectBrowser,\n    detectOs: detectOs\n  };\n\n  var checkRange = function (str, substr, start) {\n    return substr === '' || str.length >= substr.length && str.substr(start, start + substr.length) === substr;\n  };\n\n  var contains$1 = function (str, substr) {\n    return str.indexOf(substr) !== -1;\n  };\n\n  var startsWith = function (str, prefix) {\n    return checkRange(str, prefix, 0);\n  };\n\n  var endsWith = function (str, suffix) {\n    return checkRange(str, suffix, str.length - suffix.length);\n  };\n\n  var blank = function (r) {\n    return function (s) {\n      return s.replace(r, '');\n    };\n  };\n\n  var trim = blank(/^\\s+|\\s+$/g);\n\n  var isNotEmpty = function (s) {\n    return s.length > 0;\n  };\n\n  var normalVersionRegex = /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;\n\n  var checkContains = function (target) {\n    return function (uastring) {\n      return contains$1(uastring, target);\n    };\n  };\n\n  var browsers = [{\n    name: 'Edge',\n    versionRegexes: [/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],\n    search: function (uastring) {\n      return contains$1(uastring, 'edge/') && contains$1(uastring, 'chrome') && contains$1(uastring, 'safari') && contains$1(uastring, 'applewebkit');\n    }\n  }, {\n    name: 'Chrome',\n    versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/, normalVersionRegex],\n    search: function (uastring) {\n      return contains$1(uastring, 'chrome') && !contains$1(uastring, 'chromeframe');\n    }\n  }, {\n    name: 'IE',\n    versionRegexes: [/.*?msie\\ ?([0-9]+)\\.([0-9]+).*/, /.*?rv:([0-9]+)\\.([0-9]+).*/],\n    search: function (uastring) {\n      return contains$1(uastring, 'msie') || contains$1(uastring, 'trident');\n    }\n  }, {\n    name: 'Opera',\n    versionRegexes: [normalVersionRegex, /.*?opera\\/([0-9]+)\\.([0-9]+).*/],\n    search: checkContains('opera')\n  }, {\n    name: 'Firefox',\n    versionRegexes: [/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],\n    search: checkContains('firefox')\n  }, {\n    name: 'Safari',\n    versionRegexes: [normalVersionRegex, /.*?cpu os ([0-9]+)_([0-9]+).*/],\n    search: function (uastring) {\n      return (contains$1(uastring, 'safari') || contains$1(uastring, 'mobile/')) && contains$1(uastring, 'applewebkit');\n    }\n  }];\n  var oses = [{\n    name: 'Windows',\n    search: checkContains('win'),\n    versionRegexes: [/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]\n  }, {\n    name: 'iOS',\n    search: function (uastring) {\n      return contains$1(uastring, 'iphone') || contains$1(uastring, 'ipad');\n    },\n    versionRegexes: [/.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/, /.*cpu os ([0-9]+)_([0-9]+).*/, /.*cpu iphone os ([0-9]+)_([0-9]+).*/]\n  }, {\n    name: 'Android',\n    search: checkContains('android'),\n    versionRegexes: [/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]\n  }, {\n    name: 'OSX',\n    search: checkContains('mac os x'),\n    versionRegexes: [/.*?mac\\ os\\ x\\ ?([0-9]+)_([0-9]+).*/]\n  }, {\n    name: 'Linux',\n    search: checkContains('linux'),\n    versionRegexes: []\n  }, {\n    name: 'Solaris',\n    search: checkContains('sunos'),\n    versionRegexes: []\n  }, {\n    name: 'FreeBSD',\n    search: checkContains('freebsd'),\n    versionRegexes: []\n  }, {\n    name: 'ChromeOS',\n    search: checkContains('cros'),\n    versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/]\n  }];\n  var PlatformInfo = {\n    browsers: constant(browsers),\n    oses: constant(oses)\n  };\n  var edge = 'Edge';\n  var chrome = 'Chrome';\n  var ie = 'IE';\n  var opera = 'Opera';\n  var firefox = 'Firefox';\n  var safari = 'Safari';\n\n  var unknown$1 = function () {\n    return nu$1({\n      current: undefined,\n      version: Version.unknown()\n    });\n  };\n\n  var nu$1 = function (info) {\n    var current = info.current;\n    var version = info.version;\n\n    var isBrowser = function (name) {\n      return function () {\n        return current === name;\n      };\n    };\n\n    return {\n      current: current,\n      version: version,\n      isEdge: isBrowser(edge),\n      isChrome: isBrowser(chrome),\n      isIE: isBrowser(ie),\n      isOpera: isBrowser(opera),\n      isFirefox: isBrowser(firefox),\n      isSafari: isBrowser(safari)\n    };\n  };\n\n  var Browser = {\n    unknown: unknown$1,\n    nu: nu$1,\n    edge: constant(edge),\n    chrome: constant(chrome),\n    ie: constant(ie),\n    opera: constant(opera),\n    firefox: constant(firefox),\n    safari: constant(safari)\n  };\n  var windows = 'Windows';\n  var ios = 'iOS';\n  var android = 'Android';\n  var linux = 'Linux';\n  var osx = 'OSX';\n  var solaris = 'Solaris';\n  var freebsd = 'FreeBSD';\n  var chromeos = 'ChromeOS';\n\n  var unknown$2 = function () {\n    return nu$2({\n      current: undefined,\n      version: Version.unknown()\n    });\n  };\n\n  var nu$2 = function (info) {\n    var current = info.current;\n    var version = info.version;\n\n    var isOS = function (name) {\n      return function () {\n        return current === name;\n      };\n    };\n\n    return {\n      current: current,\n      version: version,\n      isWindows: isOS(windows),\n      isiOS: isOS(ios),\n      isAndroid: isOS(android),\n      isOSX: isOS(osx),\n      isLinux: isOS(linux),\n      isSolaris: isOS(solaris),\n      isFreeBSD: isOS(freebsd),\n      isChromeOS: isOS(chromeos)\n    };\n  };\n\n  var OperatingSystem = {\n    unknown: unknown$2,\n    nu: nu$2,\n    windows: constant(windows),\n    ios: constant(ios),\n    android: constant(android),\n    linux: constant(linux),\n    osx: constant(osx),\n    solaris: constant(solaris),\n    freebsd: constant(freebsd),\n    chromeos: constant(chromeos)\n  };\n\n  var detect$2 = function (userAgent, mediaMatch) {\n    var browsers = PlatformInfo.browsers();\n    var oses = PlatformInfo.oses();\n    var browser = UaString.detectBrowser(browsers, userAgent).fold(Browser.unknown, Browser.nu);\n    var os = UaString.detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);\n    var deviceType = DeviceType(os, browser, userAgent, mediaMatch);\n    return {\n      browser: browser,\n      os: os,\n      deviceType: deviceType\n    };\n  };\n\n  var PlatformDetection = {\n    detect: detect$2\n  };\n\n  var mediaMatch = function (query) {\n    return window.matchMedia(query).matches;\n  };\n\n  var platform = cached(function () {\n    return PlatformDetection.detect(navigator.userAgent, mediaMatch);\n  });\n\n  var detect$3 = function () {\n    return platform();\n  };\n\n  var compareDocumentPosition = function (a, b, match) {\n    return (a.compareDocumentPosition(b) & match) !== 0;\n  };\n\n  var documentPositionContainedBy = function (a, b) {\n    return compareDocumentPosition(a, b, Node.DOCUMENT_POSITION_CONTAINED_BY);\n  };\n\n  var COMMENT = 8;\n  var DOCUMENT = 9;\n  var DOCUMENT_FRAGMENT = 11;\n  var ELEMENT = 1;\n  var TEXT = 3;\n\n  var fromHtml = function (html, scope) {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n\n    if (!div.hasChildNodes() || div.childNodes.length > 1) {\n      console.error('HTML does not have a single root node', html);\n      throw new Error('HTML must have a single root node');\n    }\n\n    return fromDom(div.childNodes[0]);\n  };\n\n  var fromTag = function (tag, scope) {\n    var doc = scope || document;\n    var node = doc.createElement(tag);\n    return fromDom(node);\n  };\n\n  var fromText = function (text, scope) {\n    var doc = scope || document;\n    var node = doc.createTextNode(text);\n    return fromDom(node);\n  };\n\n  var fromDom = function (node) {\n    if (node === null || node === undefined) {\n      throw new Error('Node cannot be null or undefined');\n    }\n\n    return {\n      dom: node\n    };\n  };\n\n  var fromPoint = function (docElm, x, y) {\n    return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n  };\n\n  var SugarElement = {\n    fromHtml: fromHtml,\n    fromTag: fromTag,\n    fromText: fromText,\n    fromDom: fromDom,\n    fromPoint: fromPoint\n  };\n\n  var is = function (element, selector) {\n    var dom = element.dom;\n\n    if (dom.nodeType !== ELEMENT) {\n      return false;\n    } else {\n      var elem = dom;\n\n      if (elem.matches !== undefined) {\n        return elem.matches(selector);\n      } else if (elem.msMatchesSelector !== undefined) {\n        return elem.msMatchesSelector(selector);\n      } else if (elem.webkitMatchesSelector !== undefined) {\n        return elem.webkitMatchesSelector(selector);\n      } else if (elem.mozMatchesSelector !== undefined) {\n        return elem.mozMatchesSelector(selector);\n      } else {\n        throw new Error('Browser lacks native selectors');\n      }\n    }\n  };\n\n  var bypassSelector = function (dom) {\n    return dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT && dom.nodeType !== DOCUMENT_FRAGMENT || dom.childElementCount === 0;\n  };\n\n  var all = function (selector, scope) {\n    var base = scope === undefined ? document : scope.dom;\n    return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), SugarElement.fromDom);\n  };\n\n  var one = function (selector, scope) {\n    var base = scope === undefined ? document : scope.dom;\n    return bypassSelector(base) ? Optional.none() : Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);\n  };\n\n  var eq$1 = function (e1, e2) {\n    return e1.dom === e2.dom;\n  };\n\n  var regularContains = function (e1, e2) {\n    var d1 = e1.dom;\n    var d2 = e2.dom;\n    return d1 === d2 ? false : d1.contains(d2);\n  };\n\n  var ieContains = function (e1, e2) {\n    return documentPositionContainedBy(e1.dom, e2.dom);\n  };\n\n  var contains$2 = function (e1, e2) {\n    return detect$3().browser.isIE() ? ieContains(e1, e2) : regularContains(e1, e2);\n  };\n\n  var is$1 = is;\n  var keys = Object.keys;\n  var hasOwnProperty = Object.hasOwnProperty;\n\n  var each$1 = function (obj, f) {\n    var props = keys(obj);\n\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n\n  var map$1 = function (obj, f) {\n    return tupleMap(obj, function (x, i) {\n      return {\n        k: i,\n        v: f(x, i)\n      };\n    });\n  };\n\n  var tupleMap = function (obj, f) {\n    var r = {};\n    each$1(obj, function (x, i) {\n      var tuple = f(x, i);\n      r[tuple.k] = tuple.v;\n    });\n    return r;\n  };\n\n  var objAcc = function (r) {\n    return function (x, i) {\n      r[i] = x;\n    };\n  };\n\n  var internalFilter = function (obj, pred, onTrue, onFalse) {\n    var r = {};\n    each$1(obj, function (x, i) {\n      (pred(x, i) ? onTrue : onFalse)(x, i);\n    });\n    return r;\n  };\n\n  var filter$1 = function (obj, pred) {\n    var t = {};\n    internalFilter(obj, pred, objAcc(t), noop);\n    return t;\n  };\n\n  var mapToArray = function (obj, f) {\n    var r = [];\n    each$1(obj, function (value, name) {\n      r.push(f(value, name));\n    });\n    return r;\n  };\n\n  var values = function (obj) {\n    return mapToArray(obj, function (v) {\n      return v;\n    });\n  };\n\n  var size = function (obj) {\n    return keys(obj).length;\n  };\n\n  var get$1 = function (obj, key) {\n    return has(obj, key) ? Optional.from(obj[key]) : Optional.none();\n  };\n\n  var has = function (obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n\n  var hasNonNullableKey = function (obj, key) {\n    return has(obj, key) && obj[key] !== undefined && obj[key] !== null;\n  };\n\n  var isEmpty = function (r) {\n    for (var x in r) {\n      if (hasOwnProperty.call(r, x)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  var validSectionList = ['tfoot', 'thead', 'tbody', 'colgroup'];\n\n  var isValidSection = function (parentName) {\n    return contains(validSectionList, parentName);\n  };\n\n  var grid = function (rows, columns) {\n    return {\n      rows: rows,\n      columns: columns\n    };\n  };\n\n  var address = function (row, column) {\n    return {\n      row: row,\n      column: column\n    };\n  };\n\n  var detail = function (element, rowspan, colspan) {\n    return {\n      element: element,\n      rowspan: rowspan,\n      colspan: colspan\n    };\n  };\n\n  var detailnew = function (element, rowspan, colspan, isNew) {\n    return {\n      element: element,\n      rowspan: rowspan,\n      colspan: colspan,\n      isNew: isNew\n    };\n  };\n\n  var extended = function (element, rowspan, colspan, row, column, isLocked) {\n    return {\n      element: element,\n      rowspan: rowspan,\n      colspan: colspan,\n      row: row,\n      column: column,\n      isLocked: isLocked\n    };\n  };\n\n  var rowdata = function (element, cells, section) {\n    return {\n      element: element,\n      cells: cells,\n      section: section\n    };\n  };\n\n  var elementnew = function (element, isNew, isLocked) {\n    return {\n      element: element,\n      isNew: isNew,\n      isLocked: isLocked\n    };\n  };\n\n  var rowdatanew = function (element, cells, section, isNew) {\n    return {\n      element: element,\n      cells: cells,\n      section: section,\n      isNew: isNew\n    };\n  };\n\n  var rowcells = function (cells, section) {\n    return {\n      cells: cells,\n      section: section\n    };\n  };\n\n  var rowdetails = function (details, section) {\n    return {\n      details: details,\n      section: section\n    };\n  };\n\n  var bounds = function (startRow, startCol, finishRow, finishCol) {\n    return {\n      startRow: startRow,\n      startCol: startCol,\n      finishRow: finishRow,\n      finishCol: finishCol\n    };\n  };\n\n  var columnext = function (element, colspan, column) {\n    return {\n      element: element,\n      colspan: colspan,\n      column: column\n    };\n  };\n\n  var Global = typeof window !== 'undefined' ? window : Function('return this;')();\n\n  var name = function (element) {\n    var r = element.dom.nodeName;\n    return r.toLowerCase();\n  };\n\n  var type = function (element) {\n    return element.dom.nodeType;\n  };\n\n  var isType$1 = function (t) {\n    return function (element) {\n      return type(element) === t;\n    };\n  };\n\n  var isComment = function (element) {\n    return type(element) === COMMENT || name(element) === '#comment';\n  };\n\n  var isElement = isType$1(ELEMENT);\n  var isText = isType$1(TEXT);\n  var isDocument = isType$1(DOCUMENT);\n  var isDocumentFragment = isType$1(DOCUMENT_FRAGMENT);\n\n  var isTag = function (tag) {\n    return function (e) {\n      return isElement(e) && name(e) === tag;\n    };\n  };\n\n  var owner = function (element) {\n    return SugarElement.fromDom(element.dom.ownerDocument);\n  };\n\n  var documentOrOwner = function (dos) {\n    return isDocument(dos) ? dos : owner(dos);\n  };\n\n  var defaultView = function (element) {\n    return SugarElement.fromDom(documentOrOwner(element).dom.defaultView);\n  };\n\n  var parent = function (element) {\n    return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);\n  };\n\n  var parents = function (element, isRoot) {\n    var stop = isFunction(isRoot) ? isRoot : never;\n    var dom = element.dom;\n    var ret = [];\n\n    while (dom.parentNode !== null && dom.parentNode !== undefined) {\n      var rawParent = dom.parentNode;\n      var p = SugarElement.fromDom(rawParent);\n      ret.push(p);\n\n      if (stop(p) === true) {\n        break;\n      } else {\n        dom = rawParent;\n      }\n    }\n\n    return ret;\n  };\n\n  var offsetParent = function (element) {\n    return Optional.from(element.dom.offsetParent).map(SugarElement.fromDom);\n  };\n\n  var prevSibling = function (element) {\n    return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom);\n  };\n\n  var nextSibling = function (element) {\n    return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);\n  };\n\n  var children = function (element) {\n    return map(element.dom.childNodes, SugarElement.fromDom);\n  };\n\n  var child = function (element, index) {\n    var cs = element.dom.childNodes;\n    return Optional.from(cs[index]).map(SugarElement.fromDom);\n  };\n\n  var firstChild = function (element) {\n    return child(element, 0);\n  };\n\n  var isShadowRoot = function (dos) {\n    return isDocumentFragment(dos) && isNonNullable(dos.dom.host);\n  };\n\n  var supported = isFunction(Element.prototype.attachShadow) && isFunction(Node.prototype.getRootNode);\n  var isSupported = constant(supported);\n  var getRootNode = supported ? function (e) {\n    return SugarElement.fromDom(e.dom.getRootNode());\n  } : documentOrOwner;\n\n  var getShadowRoot = function (e) {\n    var r = getRootNode(e);\n    return isShadowRoot(r) ? Optional.some(r) : Optional.none();\n  };\n\n  var getShadowHost = function (e) {\n    return SugarElement.fromDom(e.dom.host);\n  };\n\n  var getOriginalEventTarget = function (event) {\n    if (isSupported() && isNonNullable(event.target)) {\n      var el = SugarElement.fromDom(event.target);\n\n      if (isElement(el) && isOpenShadowHost(el)) {\n        if (event.composed && event.composedPath) {\n          var composedPath = event.composedPath();\n\n          if (composedPath) {\n            return head(composedPath);\n          }\n        }\n      }\n    }\n\n    return Optional.from(event.target);\n  };\n\n  var isOpenShadowHost = function (element) {\n    return isNonNullable(element.dom.shadowRoot);\n  };\n\n  var inBody = function (element) {\n    var dom = isText(element) ? element.dom.parentNode : element.dom;\n\n    if (dom === undefined || dom === null || dom.ownerDocument === null) {\n      return false;\n    }\n\n    var doc = dom.ownerDocument;\n    return getShadowRoot(SugarElement.fromDom(dom)).fold(function () {\n      return doc.body.contains(dom);\n    }, compose1(inBody, getShadowHost));\n  };\n\n  var body = function () {\n    return getBody(SugarElement.fromDom(document));\n  };\n\n  var getBody = function (doc) {\n    var b = doc.dom.body;\n\n    if (b === null || b === undefined) {\n      throw new Error('Body is not available yet');\n    }\n\n    return SugarElement.fromDom(b);\n  };\n\n  var ancestors = function (scope, predicate, isRoot) {\n    return filter(parents(scope, isRoot), predicate);\n  };\n\n  var children$1 = function (scope, predicate) {\n    return filter(children(scope), predicate);\n  };\n\n  var descendants = function (scope, predicate) {\n    var result = [];\n    each(children(scope), function (x) {\n      if (predicate(x)) {\n        result = result.concat([x]);\n      }\n\n      result = result.concat(descendants(x, predicate));\n    });\n    return result;\n  };\n\n  var ancestors$1 = function (scope, selector, isRoot) {\n    return ancestors(scope, function (e) {\n      return is(e, selector);\n    }, isRoot);\n  };\n\n  var children$2 = function (scope, selector) {\n    return children$1(scope, function (e) {\n      return is(e, selector);\n    });\n  };\n\n  var descendants$1 = function (scope, selector) {\n    return all(selector, scope);\n  };\n\n  function ClosestOrAncestor(is, ancestor, scope, a, isRoot) {\n    if (is(scope, a)) {\n      return Optional.some(scope);\n    } else if (isFunction(isRoot) && isRoot(scope)) {\n      return Optional.none();\n    } else {\n      return ancestor(scope, a, isRoot);\n    }\n  }\n\n  var ancestor = function (scope, predicate, isRoot) {\n    var element = scope.dom;\n    var stop = isFunction(isRoot) ? isRoot : never;\n\n    while (element.parentNode) {\n      element = element.parentNode;\n      var el = SugarElement.fromDom(element);\n\n      if (predicate(el)) {\n        return Optional.some(el);\n      } else if (stop(el)) {\n        break;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var closest = function (scope, predicate, isRoot) {\n    var is = function (s, test) {\n      return test(s);\n    };\n\n    return ClosestOrAncestor(is, ancestor, scope, predicate, isRoot);\n  };\n\n  var child$1 = function (scope, predicate) {\n    var pred = function (node) {\n      return predicate(SugarElement.fromDom(node));\n    };\n\n    var result = find(scope.dom.childNodes, pred);\n    return result.map(SugarElement.fromDom);\n  };\n\n  var descendant = function (scope, predicate) {\n    var descend = function (node) {\n      for (var i = 0; i < node.childNodes.length; i++) {\n        var child_1 = SugarElement.fromDom(node.childNodes[i]);\n\n        if (predicate(child_1)) {\n          return Optional.some(child_1);\n        }\n\n        var res = descend(node.childNodes[i]);\n\n        if (res.isSome()) {\n          return res;\n        }\n      }\n\n      return Optional.none();\n    };\n\n    return descend(scope.dom);\n  };\n\n  var ancestor$1 = function (scope, selector, isRoot) {\n    return ancestor(scope, function (e) {\n      return is(e, selector);\n    }, isRoot);\n  };\n\n  var child$2 = function (scope, selector) {\n    return child$1(scope, function (e) {\n      return is(e, selector);\n    });\n  };\n\n  var descendant$1 = function (scope, selector) {\n    return one(selector, scope);\n  };\n\n  var closest$1 = function (scope, selector, isRoot) {\n    var is$1 = function (element, selector) {\n      return is(element, selector);\n    };\n\n    return ClosestOrAncestor(is$1, ancestor$1, scope, selector, isRoot);\n  };\n\n  var rawSet = function (dom, key, value) {\n    if (isString(value) || isBoolean(value) || isNumber(value)) {\n      dom.setAttribute(key, value + '');\n    } else {\n      console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n      throw new Error('Attribute value was not simple');\n    }\n  };\n\n  var set = function (element, key, value) {\n    rawSet(element.dom, key, value);\n  };\n\n  var setAll = function (element, attrs) {\n    var dom = element.dom;\n    each$1(attrs, function (v, k) {\n      rawSet(dom, k, v);\n    });\n  };\n\n  var get$2 = function (element, key) {\n    var v = element.dom.getAttribute(key);\n    return v === null ? undefined : v;\n  };\n\n  var getOpt = function (element, key) {\n    return Optional.from(get$2(element, key));\n  };\n\n  var remove = function (element, key) {\n    element.dom.removeAttribute(key);\n  };\n\n  var clone = function (element) {\n    return foldl(element.dom.attributes, function (acc, attr) {\n      acc[attr.name] = attr.value;\n      return acc;\n    }, {});\n  };\n\n  var isSupported$1 = function (dom) {\n    return dom.style !== undefined && isFunction(dom.style.getPropertyValue);\n  };\n\n  var internalSet = function (dom, property, value) {\n    if (!isString(value)) {\n      console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);\n      throw new Error('CSS value must be a string: ' + value);\n    }\n\n    if (isSupported$1(dom)) {\n      dom.style.setProperty(property, value);\n    }\n  };\n\n  var internalRemove = function (dom, property) {\n    if (isSupported$1(dom)) {\n      dom.style.removeProperty(property);\n    }\n  };\n\n  var set$1 = function (element, property, value) {\n    var dom = element.dom;\n    internalSet(dom, property, value);\n  };\n\n  var setAll$1 = function (element, css) {\n    var dom = element.dom;\n    each$1(css, function (v, k) {\n      internalSet(dom, k, v);\n    });\n  };\n\n  var get$3 = function (element, property) {\n    var dom = element.dom;\n    var styles = window.getComputedStyle(dom);\n    var r = styles.getPropertyValue(property);\n    return r === '' && !inBody(element) ? getUnsafeProperty(dom, property) : r;\n  };\n\n  var getUnsafeProperty = function (dom, property) {\n    return isSupported$1(dom) ? dom.style.getPropertyValue(property) : '';\n  };\n\n  var getRaw = function (element, property) {\n    var dom = element.dom;\n    var raw = getUnsafeProperty(dom, property);\n    return Optional.from(raw).filter(function (r) {\n      return r.length > 0;\n    });\n  };\n\n  var remove$1 = function (element, property) {\n    var dom = element.dom;\n    internalRemove(dom, property);\n\n    if (getOpt(element, 'style').map(trim).is('')) {\n      remove(element, 'style');\n    }\n  };\n\n  var copy = function (source, target) {\n    var sourceDom = source.dom;\n    var targetDom = target.dom;\n\n    if (isSupported$1(sourceDom) && isSupported$1(targetDom)) {\n      targetDom.style.cssText = sourceDom.style.cssText;\n    }\n  };\n\n  var getAttrValue = function (cell, name, fallback) {\n    if (fallback === void 0) {\n      fallback = 0;\n    }\n\n    return getOpt(cell, name).map(function (value) {\n      return parseInt(value, 10);\n    }).getOr(fallback);\n  };\n\n  var getSpan = function (cell, type) {\n    return getAttrValue(cell, type, 1);\n  };\n\n  var hasColspan = function (cell) {\n    return getSpan(cell, 'colspan') > 1;\n  };\n\n  var hasRowspan = function (cell) {\n    return getSpan(cell, 'rowspan') > 1;\n  };\n\n  var getCssValue = function (element, property) {\n    return parseInt(get$3(element, property), 10);\n  };\n\n  var minWidth = constant(10);\n  var minHeight = constant(10);\n\n  var firstLayer = function (scope, selector) {\n    return filterFirstLayer(scope, selector, always);\n  };\n\n  var filterFirstLayer = function (scope, selector, predicate) {\n    return bind(children(scope), function (x) {\n      if (is(x, selector)) {\n        return predicate(x) ? [x] : [];\n      } else {\n        return filterFirstLayer(x, selector, predicate);\n      }\n    });\n  };\n\n  var lookup = function (tags, element, isRoot) {\n    if (isRoot === void 0) {\n      isRoot = never;\n    }\n\n    if (isRoot(element)) {\n      return Optional.none();\n    }\n\n    if (contains(tags, name(element))) {\n      return Optional.some(element);\n    }\n\n    var isRootOrUpperTable = function (elm) {\n      return is(elm, 'table') || isRoot(elm);\n    };\n\n    return ancestor$1(element, tags.join(','), isRootOrUpperTable);\n  };\n\n  var cell = function (element, isRoot) {\n    return lookup(['td', 'th'], element, isRoot);\n  };\n\n  var cells = function (ancestor) {\n    return firstLayer(ancestor, 'th,td');\n  };\n\n  var columns = function (ancestor) {\n    if (is(ancestor, 'colgroup')) {\n      return children$2(ancestor, 'col');\n    } else {\n      return bind(columnGroups(ancestor), function (columnGroup) {\n        return children$2(columnGroup, 'col');\n      });\n    }\n  };\n\n  var table = function (element, isRoot) {\n    return closest$1(element, 'table', isRoot);\n  };\n\n  var rows = function (ancestor) {\n    return firstLayer(ancestor, 'tr');\n  };\n\n  var columnGroups = function (ancestor) {\n    return table(ancestor).fold(constant([]), function (table) {\n      return children$2(table, 'colgroup');\n    });\n  };\n\n  var fromRowsOrColGroups = function (elems, getSection) {\n    return map(elems, function (row) {\n      if (name(row) === 'colgroup') {\n        var cells$1 = map(columns(row), function (column) {\n          var colspan = getAttrValue(column, 'span', 1);\n          return detail(column, 1, colspan);\n        });\n        return rowdata(row, cells$1, 'colgroup');\n      } else {\n        var cells$1 = map(cells(row), function (cell) {\n          var rowspan = getAttrValue(cell, 'rowspan', 1);\n          var colspan = getAttrValue(cell, 'colspan', 1);\n          return detail(cell, rowspan, colspan);\n        });\n        return rowdata(row, cells$1, getSection(row));\n      }\n    });\n  };\n\n  var getParentSection = function (group) {\n    return parent(group).map(function (parent) {\n      var parentName = name(parent);\n      return isValidSection(parentName) ? parentName : 'tbody';\n    }).getOr('tbody');\n  };\n\n  var fromTable = function (table) {\n    var rows$1 = rows(table);\n    var columnGroups$1 = columnGroups(table);\n\n    var elems = __spreadArrays(columnGroups$1, rows$1);\n\n    return fromRowsOrColGroups(elems, getParentSection);\n  };\n\n  var fromPastedRows = function (elems, section) {\n    return fromRowsOrColGroups(elems, function () {\n      return section;\n    });\n  };\n\n  var addCells = function (gridRow, index, cells) {\n    var existingCells = gridRow.cells;\n    var before = existingCells.slice(0, index);\n    var after = existingCells.slice(index);\n    var newCells = before.concat(cells).concat(after);\n    return setCells(gridRow, newCells);\n  };\n\n  var addCell = function (gridRow, index, cell) {\n    return addCells(gridRow, index, [cell]);\n  };\n\n  var mutateCell = function (gridRow, index, cell) {\n    var cells = gridRow.cells;\n    cells[index] = cell;\n  };\n\n  var setCells = function (gridRow, cells) {\n    return rowcells(cells, gridRow.section);\n  };\n\n  var mapCells = function (gridRow, f) {\n    var cells = gridRow.cells;\n    var r = map(cells, f);\n    return rowcells(r, gridRow.section);\n  };\n\n  var getCell = function (gridRow, index) {\n    return gridRow.cells[index];\n  };\n\n  var getCellElement = function (gridRow, index) {\n    return getCell(gridRow, index).element;\n  };\n\n  var cellLength = function (gridRow) {\n    return gridRow.cells.length;\n  };\n\n  var extractGridDetails = function (grid) {\n    var result = partition(grid, function (row) {\n      return row.section === 'colgroup';\n    });\n    return {\n      rows: result.fail,\n      cols: result.pass\n    };\n  };\n\n  var LOCKED_COL_ATTR = 'data-snooker-locked-cols';\n\n  var getLockedColumnsFromTable = function (table) {\n    return getOpt(table, LOCKED_COL_ATTR).bind(function (lockedColStr) {\n      return Optional.from(lockedColStr.match(/\\d+/g));\n    }).map(function (lockedCols) {\n      return mapToObject(lockedCols, always);\n    });\n  };\n\n  var getLockedColumnsFromGrid = function (grid) {\n    var locked = foldl(extractGridDetails(grid).rows, function (acc, row) {\n      each(row.cells, function (cell, idx) {\n        if (cell.isLocked) {\n          acc[idx] = true;\n        }\n      });\n      return acc;\n    }, {});\n    var lockedArr = mapToArray(locked, function (_val, key) {\n      return parseInt(key, 10);\n    });\n    return sort(lockedArr);\n  };\n\n  var key = function (row, column) {\n    return row + ',' + column;\n  };\n\n  var getAt = function (warehouse, row, column) {\n    var raw = warehouse.access[key(row, column)];\n    return raw !== undefined ? Optional.some(raw) : Optional.none();\n  };\n\n  var findItem = function (warehouse, item, comparator) {\n    var filtered = filterItems(warehouse, function (detail) {\n      return comparator(item, detail.element);\n    });\n    return filtered.length > 0 ? Optional.some(filtered[0]) : Optional.none();\n  };\n\n  var filterItems = function (warehouse, predicate) {\n    var all = bind(warehouse.all, function (r) {\n      return r.cells;\n    });\n    return filter(all, predicate);\n  };\n\n  var generateColumns = function (rowData) {\n    var columnsGroup = {};\n    var index = 0;\n    each(rowData.cells, function (column) {\n      var colspan = column.colspan;\n      range(colspan, function (columnIndex) {\n        var colIndex = index + columnIndex;\n        columnsGroup[colIndex] = columnext(column.element, colspan, colIndex);\n      });\n      index += colspan;\n    });\n    return columnsGroup;\n  };\n\n  var generate = function (list) {\n    var access = {};\n    var cells = [];\n    var columns = {};\n    var tableOpt = head(list).map(function (rowData) {\n      return rowData.element;\n    }).bind(table);\n    var lockedColumns = tableOpt.bind(getLockedColumnsFromTable).getOr({});\n    var maxRows = 0;\n    var maxColumns = 0;\n    var rowCount = 0;\n    each(list, function (rowData) {\n      if (rowData.section === 'colgroup') {\n        columns = generateColumns(rowData);\n      } else {\n        var currentRow_1 = [];\n        each(rowData.cells, function (rowCell) {\n          var start = 0;\n\n          while (access[key(rowCount, start)] !== undefined) {\n            start++;\n          }\n\n          var isLocked = hasNonNullableKey(lockedColumns, start.toString());\n          var current = extended(rowCell.element, rowCell.rowspan, rowCell.colspan, rowCount, start, isLocked);\n\n          for (var occupiedColumnPosition = 0; occupiedColumnPosition < rowCell.colspan; occupiedColumnPosition++) {\n            for (var occupiedRowPosition = 0; occupiedRowPosition < rowCell.rowspan; occupiedRowPosition++) {\n              var rowPosition = rowCount + occupiedRowPosition;\n              var columnPosition = start + occupiedColumnPosition;\n              var newpos = key(rowPosition, columnPosition);\n              access[newpos] = current;\n              maxColumns = Math.max(maxColumns, columnPosition + 1);\n            }\n          }\n\n          currentRow_1.push(current);\n        });\n        maxRows++;\n        cells.push(rowdata(rowData.element, currentRow_1, rowData.section));\n        rowCount++;\n      }\n    });\n    var grid$1 = grid(maxRows, maxColumns);\n    return {\n      grid: grid$1,\n      access: access,\n      all: cells,\n      columns: columns\n    };\n  };\n\n  var fromTable$1 = function (table) {\n    var list = fromTable(table);\n    return generate(list);\n  };\n\n  var justCells = function (warehouse) {\n    return bind(warehouse.all, function (w) {\n      return w.cells;\n    });\n  };\n\n  var justColumns = function (warehouse) {\n    return values(warehouse.columns);\n  };\n\n  var hasColumns = function (warehouse) {\n    return keys(warehouse.columns).length > 0;\n  };\n\n  var getColumnAt = function (warehouse, columnIndex) {\n    return Optional.from(warehouse.columns[columnIndex]);\n  };\n\n  var Warehouse = {\n    fromTable: fromTable$1,\n    generate: generate,\n    getAt: getAt,\n    findItem: findItem,\n    filterItems: filterItems,\n    justCells: justCells,\n    justColumns: justColumns,\n    hasColumns: hasColumns,\n    getColumnAt: getColumnAt\n  };\n\n  var inSelection = function (bounds, detail) {\n    var leftEdge = detail.column;\n    var rightEdge = detail.column + detail.colspan - 1;\n    var topEdge = detail.row;\n    var bottomEdge = detail.row + detail.rowspan - 1;\n    return leftEdge <= bounds.finishCol && rightEdge >= bounds.startCol && topEdge <= bounds.finishRow && bottomEdge >= bounds.startRow;\n  };\n\n  var isWithin = function (bounds, detail) {\n    return detail.column >= bounds.startCol && detail.column + detail.colspan - 1 <= bounds.finishCol && detail.row >= bounds.startRow && detail.row + detail.rowspan - 1 <= bounds.finishRow;\n  };\n\n  var isRectangular = function (warehouse, bounds) {\n    var isRect = true;\n    var detailIsWithin = curry(isWithin, bounds);\n\n    for (var i = bounds.startRow; i <= bounds.finishRow; i++) {\n      for (var j = bounds.startCol; j <= bounds.finishCol; j++) {\n        isRect = isRect && Warehouse.getAt(warehouse, i, j).exists(detailIsWithin);\n      }\n    }\n\n    return isRect ? Optional.some(bounds) : Optional.none();\n  };\n\n  var getBounds = function (detailA, detailB) {\n    return bounds(Math.min(detailA.row, detailB.row), Math.min(detailA.column, detailB.column), Math.max(detailA.row + detailA.rowspan - 1, detailB.row + detailB.rowspan - 1), Math.max(detailA.column + detailA.colspan - 1, detailB.column + detailB.colspan - 1));\n  };\n\n  var getAnyBox = function (warehouse, startCell, finishCell) {\n    var startCoords = Warehouse.findItem(warehouse, startCell, eq$1);\n    var finishCoords = Warehouse.findItem(warehouse, finishCell, eq$1);\n    return startCoords.bind(function (sc) {\n      return finishCoords.map(function (fc) {\n        return getBounds(sc, fc);\n      });\n    });\n  };\n\n  var getBox = function (warehouse, startCell, finishCell) {\n    return getAnyBox(warehouse, startCell, finishCell).bind(function (bounds) {\n      return isRectangular(warehouse, bounds);\n    });\n  };\n\n  var moveBy = function (warehouse, cell, row, column) {\n    return Warehouse.findItem(warehouse, cell, eq$1).bind(function (detail) {\n      var startRow = row > 0 ? detail.row + detail.rowspan - 1 : detail.row;\n      var startCol = column > 0 ? detail.column + detail.colspan - 1 : detail.column;\n      var dest = Warehouse.getAt(warehouse, startRow + row, startCol + column);\n      return dest.map(function (d) {\n        return d.element;\n      });\n    });\n  };\n\n  var intercepts = function (warehouse, start, finish) {\n    return getAnyBox(warehouse, start, finish).map(function (bounds) {\n      var inside = Warehouse.filterItems(warehouse, curry(inSelection, bounds));\n      return map(inside, function (detail) {\n        return detail.element;\n      });\n    });\n  };\n\n  var parentCell = function (warehouse, innerCell) {\n    var isContainedBy = function (c1, c2) {\n      return contains$2(c2, c1);\n    };\n\n    return Warehouse.findItem(warehouse, innerCell, isContainedBy).map(function (detail) {\n      return detail.element;\n    });\n  };\n\n  var moveBy$1 = function (cell, deltaRow, deltaColumn) {\n    return table(cell).bind(function (table) {\n      var warehouse = getWarehouse(table);\n      return moveBy(warehouse, cell, deltaRow, deltaColumn);\n    });\n  };\n\n  var intercepts$1 = function (table, first, last) {\n    var warehouse = getWarehouse(table);\n    return intercepts(warehouse, first, last);\n  };\n\n  var nestedIntercepts = function (table, first, firstTable, last, lastTable) {\n    var warehouse = getWarehouse(table);\n    var optStartCell = eq$1(table, firstTable) ? Optional.some(first) : parentCell(warehouse, first);\n    var optLastCell = eq$1(table, lastTable) ? Optional.some(last) : parentCell(warehouse, last);\n    return optStartCell.bind(function (startCell) {\n      return optLastCell.bind(function (lastCell) {\n        return intercepts(warehouse, startCell, lastCell);\n      });\n    });\n  };\n\n  var getBox$1 = function (table, first, last) {\n    var warehouse = getWarehouse(table);\n    return getBox(warehouse, first, last);\n  };\n\n  var getWarehouse = Warehouse.fromTable;\n\n  var before = function (marker, element) {\n    var parent$1 = parent(marker);\n    parent$1.each(function (v) {\n      v.dom.insertBefore(element.dom, marker.dom);\n    });\n  };\n\n  var after = function (marker, element) {\n    var sibling = nextSibling(marker);\n    sibling.fold(function () {\n      var parent$1 = parent(marker);\n      parent$1.each(function (v) {\n        append(v, element);\n      });\n    }, function (v) {\n      before(v, element);\n    });\n  };\n\n  var prepend = function (parent, element) {\n    var firstChild$1 = firstChild(parent);\n    firstChild$1.fold(function () {\n      append(parent, element);\n    }, function (v) {\n      parent.dom.insertBefore(element.dom, v.dom);\n    });\n  };\n\n  var append = function (parent, element) {\n    parent.dom.appendChild(element.dom);\n  };\n\n  var wrap = function (element, wrapper) {\n    before(element, wrapper);\n    append(wrapper, element);\n  };\n\n  var before$1 = function (marker, elements) {\n    each(elements, function (x) {\n      before(marker, x);\n    });\n  };\n\n  var after$1 = function (marker, elements) {\n    each(elements, function (x, i) {\n      var e = i === 0 ? marker : elements[i - 1];\n      after(e, x);\n    });\n  };\n\n  var append$1 = function (parent, elements) {\n    each(elements, function (x) {\n      append(parent, x);\n    });\n  };\n\n  var empty = function (element) {\n    element.dom.textContent = '';\n    each(children(element), function (rogue) {\n      remove$2(rogue);\n    });\n  };\n\n  var remove$2 = function (element) {\n    var dom = element.dom;\n\n    if (dom.parentNode !== null) {\n      dom.parentNode.removeChild(dom);\n    }\n  };\n\n  var unwrap = function (wrapper) {\n    var children$1 = children(wrapper);\n\n    if (children$1.length > 0) {\n      before$1(wrapper, children$1);\n    }\n\n    remove$2(wrapper);\n  };\n\n  var NodeValue = function (is, name) {\n    var get = function (element) {\n      if (!is(element)) {\n        throw new Error('Can only get ' + name + ' value of a ' + name + ' node');\n      }\n\n      return getOption(element).getOr('');\n    };\n\n    var getOption = function (element) {\n      return is(element) ? Optional.from(element.dom.nodeValue) : Optional.none();\n    };\n\n    var set = function (element, value) {\n      if (!is(element)) {\n        throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');\n      }\n\n      element.dom.nodeValue = value;\n    };\n\n    return {\n      get: get,\n      getOption: getOption,\n      set: set\n    };\n  };\n\n  var api = NodeValue(isText, 'text');\n\n  var get$4 = function (element) {\n    return api.get(element);\n  };\n\n  var getOption = function (element) {\n    return api.getOption(element);\n  };\n\n  var set$2 = function (element, value) {\n    return api.set(element, value);\n  };\n\n  var TagBoundaries = ['body', 'p', 'div', 'article', 'aside', 'figcaption', 'figure', 'footer', 'header', 'nav', 'section', 'ol', 'ul', 'li', 'table', 'thead', 'tbody', 'tfoot', 'caption', 'tr', 'td', 'th', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre', 'address'];\n\n  function DomUniverse() {\n    var clone$1 = function (element) {\n      return SugarElement.fromDom(element.dom.cloneNode(false));\n    };\n\n    var document = function (element) {\n      return documentOrOwner(element).dom;\n    };\n\n    var isBoundary = function (element) {\n      if (!isElement(element)) {\n        return false;\n      }\n\n      if (name(element) === 'body') {\n        return true;\n      }\n\n      return contains(TagBoundaries, name(element));\n    };\n\n    var isEmptyTag = function (element) {\n      if (!isElement(element)) {\n        return false;\n      }\n\n      return contains(['br', 'img', 'hr', 'input'], name(element));\n    };\n\n    var isNonEditable = function (element) {\n      return isElement(element) && get$2(element, 'contenteditable') === 'false';\n    };\n\n    var comparePosition = function (element, other) {\n      return element.dom.compareDocumentPosition(other.dom);\n    };\n\n    var copyAttributesTo = function (source, destination) {\n      var as = clone(source);\n      setAll(destination, as);\n    };\n\n    var isSpecial = function (element) {\n      var tag = name(element);\n      return contains(['script', 'noscript', 'iframe', 'noframes', 'noembed', 'title', 'style', 'textarea', 'xmp'], tag);\n    };\n\n    return {\n      up: constant({\n        selector: ancestor$1,\n        closest: closest$1,\n        predicate: ancestor,\n        all: parents\n      }),\n      down: constant({\n        selector: descendants$1,\n        predicate: descendants\n      }),\n      styles: constant({\n        get: get$3,\n        getRaw: getRaw,\n        set: set$1,\n        remove: remove$1\n      }),\n      attrs: constant({\n        get: get$2,\n        set: set,\n        remove: remove,\n        copyTo: copyAttributesTo\n      }),\n      insert: constant({\n        before: before,\n        after: after,\n        afterAll: after$1,\n        append: append,\n        appendAll: append$1,\n        prepend: prepend,\n        wrap: wrap\n      }),\n      remove: constant({\n        unwrap: unwrap,\n        remove: remove$2\n      }),\n      create: constant({\n        nu: SugarElement.fromTag,\n        clone: clone$1,\n        text: SugarElement.fromText\n      }),\n      query: constant({\n        comparePosition: comparePosition,\n        prevSibling: prevSibling,\n        nextSibling: nextSibling\n      }),\n      property: constant({\n        children: children,\n        name: name,\n        parent: parent,\n        document: document,\n        isText: isText,\n        isComment: isComment,\n        isElement: isElement,\n        isSpecial: isSpecial,\n        getText: get$4,\n        setText: set$2,\n        isBoundary: isBoundary,\n        isEmptyTag: isEmptyTag,\n        isNonEditable: isNonEditable\n      }),\n      eq: eq$1,\n      is: is$1\n    };\n  }\n\n  var all$1 = function (universe, look, elements, f) {\n    var head = elements[0];\n    var tail = elements.slice(1);\n    return f(universe, look, head, tail);\n  };\n\n  var oneAll = function (universe, look, elements) {\n    return elements.length > 0 ? all$1(universe, look, elements, unsafeOne) : Optional.none();\n  };\n\n  var unsafeOne = function (universe, look, head, tail) {\n    var start = look(universe, head);\n    return foldr(tail, function (b, a) {\n      var current = look(universe, a);\n      return commonElement(universe, b, current);\n    }, start);\n  };\n\n  var commonElement = function (universe, start, end) {\n    return start.bind(function (s) {\n      return end.filter(curry(universe.eq, s));\n    });\n  };\n\n  var eq$2 = function (universe, item) {\n    return curry(universe.eq, item);\n  };\n\n  var ancestors$2 = function (universe, start, end, isRoot) {\n    if (isRoot === void 0) {\n      isRoot = never;\n    }\n\n    var ps1 = [start].concat(universe.up().all(start));\n    var ps2 = [end].concat(universe.up().all(end));\n\n    var prune = function (path) {\n      var index = findIndex(path, isRoot);\n      return index.fold(function () {\n        return path;\n      }, function (ind) {\n        return path.slice(0, ind + 1);\n      });\n    };\n\n    var pruned1 = prune(ps1);\n    var pruned2 = prune(ps2);\n    var shared = find(pruned1, function (x) {\n      return exists(pruned2, eq$2(universe, x));\n    });\n    return {\n      firstpath: pruned1,\n      secondpath: pruned2,\n      shared: shared\n    };\n  };\n\n  var sharedOne = oneAll;\n  var ancestors$3 = ancestors$2;\n  var universe = DomUniverse();\n\n  var sharedOne$1 = function (look, elements) {\n    return sharedOne(universe, function (_universe, element) {\n      return look(element);\n    }, elements);\n  };\n\n  var ancestors$4 = function (start, finish, isRoot) {\n    return ancestors$3(universe, start, finish, isRoot);\n  };\n\n  var lookupTable = function (container) {\n    return ancestor$1(container, 'table');\n  };\n\n  var identify = function (start, finish, isRoot) {\n    var getIsRoot = function (rootTable) {\n      return function (element) {\n        return isRoot !== undefined && isRoot(element) || eq$1(element, rootTable);\n      };\n    };\n\n    if (eq$1(start, finish)) {\n      return Optional.some({\n        boxes: Optional.some([start]),\n        start: start,\n        finish: finish\n      });\n    } else {\n      return lookupTable(start).bind(function (startTable) {\n        return lookupTable(finish).bind(function (finishTable) {\n          if (eq$1(startTable, finishTable)) {\n            return Optional.some({\n              boxes: intercepts$1(startTable, start, finish),\n              start: start,\n              finish: finish\n            });\n          } else if (contains$2(startTable, finishTable)) {\n            var ancestorCells = ancestors$1(finish, 'td,th', getIsRoot(startTable));\n            var finishCell = ancestorCells.length > 0 ? ancestorCells[ancestorCells.length - 1] : finish;\n            return Optional.some({\n              boxes: nestedIntercepts(startTable, start, startTable, finish, finishTable),\n              start: start,\n              finish: finishCell\n            });\n          } else if (contains$2(finishTable, startTable)) {\n            var ancestorCells = ancestors$1(start, 'td,th', getIsRoot(finishTable));\n            var startCell = ancestorCells.length > 0 ? ancestorCells[ancestorCells.length - 1] : start;\n            return Optional.some({\n              boxes: nestedIntercepts(finishTable, start, startTable, finish, finishTable),\n              start: start,\n              finish: startCell\n            });\n          } else {\n            return ancestors$4(start, finish).shared.bind(function (lca) {\n              return closest$1(lca, 'table', isRoot).bind(function (lcaTable) {\n                var finishAncestorCells = ancestors$1(finish, 'td,th', getIsRoot(lcaTable));\n                var finishCell = finishAncestorCells.length > 0 ? finishAncestorCells[finishAncestorCells.length - 1] : finish;\n                var startAncestorCells = ancestors$1(start, 'td,th', getIsRoot(lcaTable));\n                var startCell = startAncestorCells.length > 0 ? startAncestorCells[startAncestorCells.length - 1] : start;\n                return Optional.some({\n                  boxes: nestedIntercepts(lcaTable, start, startTable, finish, finishTable),\n                  start: startCell,\n                  finish: finishCell\n                });\n              });\n            });\n          }\n        });\n      });\n    }\n  };\n\n  var retrieve = function (container, selector) {\n    var sels = descendants$1(container, selector);\n    return sels.length > 0 ? Optional.some(sels) : Optional.none();\n  };\n\n  var getLast = function (boxes, lastSelectedSelector) {\n    return find(boxes, function (box) {\n      return is(box, lastSelectedSelector);\n    });\n  };\n\n  var getEdges = function (container, firstSelectedSelector, lastSelectedSelector) {\n    return descendant$1(container, firstSelectedSelector).bind(function (first) {\n      return descendant$1(container, lastSelectedSelector).bind(function (last) {\n        return sharedOne$1(lookupTable, [first, last]).map(function (table) {\n          return {\n            first: first,\n            last: last,\n            table: table\n          };\n        });\n      });\n    });\n  };\n\n  var expandTo = function (finish, firstSelectedSelector) {\n    return ancestor$1(finish, 'table').bind(function (table) {\n      return descendant$1(table, firstSelectedSelector).bind(function (start) {\n        return identify(start, finish).bind(function (identified) {\n          return identified.boxes.map(function (boxes) {\n            return {\n              boxes: boxes,\n              start: identified.start,\n              finish: identified.finish\n            };\n          });\n        });\n      });\n    });\n  };\n\n  var shiftSelection = function (boxes, deltaRow, deltaColumn, firstSelectedSelector, lastSelectedSelector) {\n    return getLast(boxes, lastSelectedSelector).bind(function (last) {\n      return moveBy$1(last, deltaRow, deltaColumn).bind(function (finish) {\n        return expandTo(finish, firstSelectedSelector);\n      });\n    });\n  };\n\n  var retrieve$1 = function (container, selector) {\n    return retrieve(container, selector);\n  };\n\n  var retrieveBox = function (container, firstSelectedSelector, lastSelectedSelector) {\n    return getEdges(container, firstSelectedSelector, lastSelectedSelector).bind(function (edges) {\n      var isRoot = function (ancestor) {\n        return eq$1(container, ancestor);\n      };\n\n      var sectionSelector = 'thead,tfoot,tbody,table';\n      var firstAncestor = ancestor$1(edges.first, sectionSelector, isRoot);\n      var lastAncestor = ancestor$1(edges.last, sectionSelector, isRoot);\n      return firstAncestor.bind(function (fA) {\n        return lastAncestor.bind(function (lA) {\n          return eq$1(fA, lA) ? getBox$1(edges.table, edges.first, edges.last) : Optional.none();\n        });\n      });\n    });\n  };\n\n  var generate$1 = function (cases) {\n    if (!isArray(cases)) {\n      throw new Error('cases must be an array');\n    }\n\n    if (cases.length === 0) {\n      throw new Error('there must be at least one case');\n    }\n\n    var constructors = [];\n    var adt = {};\n    each(cases, function (acase, count) {\n      var keys$1 = keys(acase);\n\n      if (keys$1.length !== 1) {\n        throw new Error('one and only one name per case');\n      }\n\n      var key = keys$1[0];\n      var value = acase[key];\n\n      if (adt[key] !== undefined) {\n        throw new Error('duplicate key detected:' + key);\n      } else if (key === 'cata') {\n        throw new Error('cannot have a case named cata (sorry)');\n      } else if (!isArray(value)) {\n        throw new Error('case arguments must be an array');\n      }\n\n      constructors.push(key);\n\n      adt[key] = function () {\n        var args = [];\n\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n\n        var argLength = args.length;\n\n        if (argLength !== value.length) {\n          throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);\n        }\n\n        var match = function (branches) {\n          var branchKeys = keys(branches);\n\n          if (constructors.length !== branchKeys.length) {\n            throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\\nActual: ' + branchKeys.join(','));\n          }\n\n          var allReqd = forall(constructors, function (reqKey) {\n            return contains(branchKeys, reqKey);\n          });\n\n          if (!allReqd) {\n            throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\\nRequired: ' + constructors.join(', '));\n          }\n\n          return branches[key].apply(null, args);\n        };\n\n        return {\n          fold: function () {\n            var foldArgs = [];\n\n            for (var _i = 0; _i < arguments.length; _i++) {\n              foldArgs[_i] = arguments[_i];\n            }\n\n            if (foldArgs.length !== cases.length) {\n              throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + foldArgs.length);\n            }\n\n            var target = foldArgs[count];\n            return target.apply(null, args);\n          },\n          match: match,\n          log: function (label) {\n            console.log(label, {\n              constructors: constructors,\n              constructor: key,\n              params: args\n            });\n          }\n        };\n      };\n    });\n    return adt;\n  };\n\n  var Adt = {\n    generate: generate$1\n  };\n  var type$1 = Adt.generate([{\n    none: []\n  }, {\n    multiple: ['elements']\n  }, {\n    single: ['element']\n  }]);\n\n  var cata = function (subject, onNone, onMultiple, onSingle) {\n    return subject.fold(onNone, onMultiple, onSingle);\n  };\n\n  var none$1 = type$1.none;\n  var multiple = type$1.multiple;\n  var single = type$1.single;\n\n  var Selections = function (lazyRoot, getStart, selectedSelector) {\n    var get = function () {\n      return retrieve$1(lazyRoot(), selectedSelector).fold(function () {\n        return getStart().map(single).getOrThunk(none$1);\n      }, function (cells) {\n        return multiple(cells);\n      });\n    };\n\n    return {\n      get: get\n    };\n  };\n\n  var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n  var clone$1 = function (original, isDeep) {\n    return SugarElement.fromDom(original.dom.cloneNode(isDeep));\n  };\n\n  var shallow = function (original) {\n    return clone$1(original, false);\n  };\n\n  var deep = function (original) {\n    return clone$1(original, true);\n  };\n\n  var shallowAs = function (original, tag) {\n    var nu = SugarElement.fromTag(tag);\n    var attributes = clone(original);\n    setAll(nu, attributes);\n    return nu;\n  };\n\n  var copy$1 = function (original, tag) {\n    var nu = shallowAs(original, tag);\n    var cloneChildren = children(deep(original));\n    append$1(nu, cloneChildren);\n    return nu;\n  };\n\n  var cat = function (arr) {\n    var r = [];\n\n    var push = function (x) {\n      r.push(x);\n    };\n\n    for (var i = 0; i < arr.length; i++) {\n      arr[i].each(push);\n    }\n\n    return r;\n  };\n\n  var lift2 = function (oa, ob, f) {\n    return oa.isSome() && ob.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie())) : Optional.none();\n  };\n\n  var bindFrom = function (a, f) {\n    return a !== undefined && a !== null ? f(a) : Optional.none();\n  };\n\n  var someIf = function (b, a) {\n    return b ? Optional.some(a) : Optional.none();\n  };\n\n  var Dimension = function (name, getOffset) {\n    var set = function (element, h) {\n      if (!isNumber(h) && !h.match(/^[0-9]+$/)) {\n        throw new Error(name + '.set accepts only positive integer values. Value was ' + h);\n      }\n\n      var dom = element.dom;\n\n      if (isSupported$1(dom)) {\n        dom.style[name] = h + 'px';\n      }\n    };\n\n    var get = function (element) {\n      var r = getOffset(element);\n\n      if (r <= 0 || r === null) {\n        var css = get$3(element, name);\n        return parseFloat(css) || 0;\n      }\n\n      return r;\n    };\n\n    var getOuter = get;\n\n    var aggregate = function (element, properties) {\n      return foldl(properties, function (acc, property) {\n        var val = get$3(element, property);\n        var value = val === undefined ? 0 : parseInt(val, 10);\n        return isNaN(value) ? acc : acc + value;\n      }, 0);\n    };\n\n    var max = function (element, value, properties) {\n      var cumulativeInclusions = aggregate(element, properties);\n      var absoluteMax = value > cumulativeInclusions ? value - cumulativeInclusions : 0;\n      return absoluteMax;\n    };\n\n    return {\n      set: set,\n      get: get,\n      getOuter: getOuter,\n      aggregate: aggregate,\n      max: max\n    };\n  };\n\n  var api$1 = Dimension('width', function (element) {\n    return element.dom.offsetWidth;\n  });\n\n  var get$5 = function (element) {\n    return api$1.get(element);\n  };\n\n  var getOuter = function (element) {\n    return api$1.getOuter(element);\n  };\n\n  var columns$1 = function (warehouse, isValidCell) {\n    if (isValidCell === void 0) {\n      isValidCell = always;\n    }\n\n    var grid = warehouse.grid;\n    var cols = range(grid.columns, identity);\n    var rowsArr = range(grid.rows, identity);\n    return map(cols, function (col) {\n      var getBlock = function () {\n        return bind(rowsArr, function (r) {\n          return Warehouse.getAt(warehouse, r, col).filter(function (detail) {\n            return detail.column === col;\n          }).toArray();\n        });\n      };\n\n      var isValid = function (detail) {\n        return detail.colspan === 1 && isValidCell(detail.element);\n      };\n\n      var getFallback = function () {\n        return Warehouse.getAt(warehouse, 0, col);\n      };\n\n      return decide(getBlock, isValid, getFallback);\n    });\n  };\n\n  var decide = function (getBlock, isValid, getFallback) {\n    var inBlock = getBlock();\n    var validInBlock = find(inBlock, isValid);\n    var detailOption = validInBlock.orThunk(function () {\n      return Optional.from(inBlock[0]).orThunk(getFallback);\n    });\n    return detailOption.map(function (detail) {\n      return detail.element;\n    });\n  };\n\n  var rows$1 = function (warehouse) {\n    var grid = warehouse.grid;\n    var rowsArr = range(grid.rows, identity);\n    var cols = range(grid.columns, identity);\n    return map(rowsArr, function (row) {\n      var getBlock = function () {\n        return bind(cols, function (c) {\n          return Warehouse.getAt(warehouse, row, c).filter(function (detail) {\n            return detail.row === row;\n          }).fold(constant([]), function (detail) {\n            return [detail];\n          });\n        });\n      };\n\n      var isSingle = function (detail) {\n        return detail.rowspan === 1;\n      };\n\n      var getFallback = function () {\n        return Warehouse.getAt(warehouse, row, 0);\n      };\n\n      return decide(getBlock, isSingle, getFallback);\n    });\n  };\n\n  var deduce = function (xs, index) {\n    if (index < 0 || index >= xs.length - 1) {\n      return Optional.none();\n    }\n\n    var current = xs[index].fold(function () {\n      var rest = reverse(xs.slice(0, index));\n      return findMap(rest, function (a, i) {\n        return a.map(function (aa) {\n          return {\n            value: aa,\n            delta: i + 1\n          };\n        });\n      });\n    }, function (c) {\n      return Optional.some({\n        value: c,\n        delta: 0\n      });\n    });\n    var next = xs[index + 1].fold(function () {\n      var rest = xs.slice(index + 1);\n      return findMap(rest, function (a, i) {\n        return a.map(function (aa) {\n          return {\n            value: aa,\n            delta: i + 1\n          };\n        });\n      });\n    }, function (n) {\n      return Optional.some({\n        value: n,\n        delta: 1\n      });\n    });\n    return current.bind(function (c) {\n      return next.map(function (n) {\n        var extras = n.delta + c.delta;\n        return Math.abs(n.value - c.value) / extras;\n      });\n    });\n  };\n\n  var onDirection = function (isLtr, isRtl) {\n    return function (element) {\n      return getDirection(element) === 'rtl' ? isRtl : isLtr;\n    };\n  };\n\n  var getDirection = function (element) {\n    return get$3(element, 'direction') === 'rtl' ? 'rtl' : 'ltr';\n  };\n\n  var api$2 = Dimension('height', function (element) {\n    var dom = element.dom;\n    return inBody(element) ? dom.getBoundingClientRect().height : dom.offsetHeight;\n  });\n\n  var get$6 = function (element) {\n    return api$2.get(element);\n  };\n\n  var getOuter$1 = function (element) {\n    return api$2.getOuter(element);\n  };\n\n  var r = function (left, top) {\n    var translate = function (x, y) {\n      return r(left + x, top + y);\n    };\n\n    return {\n      left: left,\n      top: top,\n      translate: translate\n    };\n  };\n\n  var SugarPosition = r;\n\n  var boxPosition = function (dom) {\n    var box = dom.getBoundingClientRect();\n    return SugarPosition(box.left, box.top);\n  };\n\n  var firstDefinedOrZero = function (a, b) {\n    if (a !== undefined) {\n      return a;\n    } else {\n      return b !== undefined ? b : 0;\n    }\n  };\n\n  var absolute = function (element) {\n    var doc = element.dom.ownerDocument;\n    var body = doc.body;\n    var win = doc.defaultView;\n    var html = doc.documentElement;\n\n    if (body === element.dom) {\n      return SugarPosition(body.offsetLeft, body.offsetTop);\n    }\n\n    var scrollTop = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageYOffset, html.scrollTop);\n    var scrollLeft = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageXOffset, html.scrollLeft);\n    var clientTop = firstDefinedOrZero(html.clientTop, body.clientTop);\n    var clientLeft = firstDefinedOrZero(html.clientLeft, body.clientLeft);\n    return viewport(element).translate(scrollLeft - clientLeft, scrollTop - clientTop);\n  };\n\n  var viewport = function (element) {\n    var dom = element.dom;\n    var doc = dom.ownerDocument;\n    var body = doc.body;\n\n    if (body === dom) {\n      return SugarPosition(body.offsetLeft, body.offsetTop);\n    }\n\n    if (!inBody(element)) {\n      return SugarPosition(0, 0);\n    }\n\n    return boxPosition(dom);\n  };\n\n  var rowInfo = function (row, y) {\n    return {\n      row: row,\n      y: y\n    };\n  };\n\n  var colInfo = function (col, x) {\n    return {\n      col: col,\n      x: x\n    };\n  };\n\n  var rtlEdge = function (cell) {\n    var pos = absolute(cell);\n    return pos.left + getOuter(cell);\n  };\n\n  var ltrEdge = function (cell) {\n    return absolute(cell).left;\n  };\n\n  var getLeftEdge = function (index, cell) {\n    return colInfo(index, ltrEdge(cell));\n  };\n\n  var getRightEdge = function (index, cell) {\n    return colInfo(index, rtlEdge(cell));\n  };\n\n  var getTop = function (cell) {\n    return absolute(cell).top;\n  };\n\n  var getTopEdge = function (index, cell) {\n    return rowInfo(index, getTop(cell));\n  };\n\n  var getBottomEdge = function (index, cell) {\n    return rowInfo(index, getTop(cell) + getOuter$1(cell));\n  };\n\n  var findPositions = function (getInnerEdge, getOuterEdge, array) {\n    if (array.length === 0) {\n      return [];\n    }\n\n    var lines = map(array.slice(1), function (cellOption, index) {\n      return cellOption.map(function (cell) {\n        return getInnerEdge(index, cell);\n      });\n    });\n    var lastLine = array[array.length - 1].map(function (cell) {\n      return getOuterEdge(array.length - 1, cell);\n    });\n    return lines.concat([lastLine]);\n  };\n\n  var negate = function (step) {\n    return -step;\n  };\n\n  var height = {\n    delta: identity,\n    positions: function (optElements) {\n      return findPositions(getTopEdge, getBottomEdge, optElements);\n    },\n    edge: getTop\n  };\n  var ltr = {\n    delta: identity,\n    edge: ltrEdge,\n    positions: function (optElements) {\n      return findPositions(getLeftEdge, getRightEdge, optElements);\n    }\n  };\n  var rtl = {\n    delta: negate,\n    edge: rtlEdge,\n    positions: function (optElements) {\n      return findPositions(getRightEdge, getLeftEdge, optElements);\n    }\n  };\n  var detect$4 = onDirection(ltr, rtl);\n  var width = {\n    delta: function (amount, table) {\n      return detect$4(table).delta(amount, table);\n    },\n    positions: function (cols, table) {\n      return detect$4(table).positions(cols, table);\n    },\n    edge: function (cell) {\n      return detect$4(cell).edge(cell);\n    }\n  };\n  var units = {\n    unsupportedLength: ['em', 'ex', 'cap', 'ch', 'ic', 'rem', 'lh', 'rlh', 'vw', 'vh', 'vi', 'vb', 'vmin', 'vmax', 'cm', 'mm', 'Q', 'in', 'pc', 'pt', 'px'],\n    fixed: ['px', 'pt'],\n    relative: ['%'],\n    empty: ['']\n  };\n\n  var pattern = function () {\n    var decimalDigits = '[0-9]+';\n    var signedInteger = '[+-]?' + decimalDigits;\n    var exponentPart = '[eE]' + signedInteger;\n    var dot = '\\\\.';\n\n    var opt = function (input) {\n      return '(?:' + input + ')?';\n    };\n\n    var unsignedDecimalLiteral = ['Infinity', decimalDigits + dot + opt(decimalDigits) + opt(exponentPart), dot + decimalDigits + opt(exponentPart), decimalDigits + opt(exponentPart)].join('|');\n    var float = '[+-]?(?:' + unsignedDecimalLiteral + ')';\n    return new RegExp('^(' + float + ')(.*)$');\n  }();\n\n  var isUnit = function (unit, accepted) {\n    return exists(accepted, function (acc) {\n      return exists(units[acc], function (check) {\n        return unit === check;\n      });\n    });\n  };\n\n  var parse = function (input, accepted) {\n    var match = Optional.from(pattern.exec(input));\n    return match.bind(function (array) {\n      var value = Number(array[1]);\n      var unitRaw = array[2];\n\n      if (isUnit(unitRaw, accepted)) {\n        return Optional.some({\n          value: value,\n          unit: unitRaw\n        });\n      } else {\n        return Optional.none();\n      }\n    });\n  };\n\n  var needManualCalc = function () {\n    var browser = detect$3().browser;\n    return browser.isIE() || browser.isEdge();\n  };\n\n  var toNumber = function (px, fallback) {\n    var num = parseFloat(px);\n    return isNaN(num) ? fallback : num;\n  };\n\n  var getProp = function (elm, name, fallback) {\n    return toNumber(get$3(elm, name), fallback);\n  };\n\n  var getCalculatedHeight = function (cell) {\n    var height = cell.dom.getBoundingClientRect().height;\n    var boxSizing = get$3(cell, 'box-sizing');\n\n    if (boxSizing === 'border-box') {\n      return height;\n    } else {\n      var paddingTop = getProp(cell, 'padding-top', 0);\n      var paddingBottom = getProp(cell, 'padding-bottom', 0);\n      var borderTop = getProp(cell, 'border-top-width', 0);\n      var borderBottom = getProp(cell, 'border-bottom-width', 0);\n      var borders = borderTop + borderBottom;\n      return height - paddingTop - paddingBottom - borders;\n    }\n  };\n\n  var getCalculatedWidth = function (cell) {\n    var width = cell.dom.getBoundingClientRect().width;\n    var boxSizing = get$3(cell, 'box-sizing');\n\n    if (boxSizing === 'border-box') {\n      return width;\n    } else {\n      var paddingLeft = getProp(cell, 'padding-left', 0);\n      var paddingRight = getProp(cell, 'padding-right', 0);\n      var borderLeft = getProp(cell, 'border-left-width', 0);\n      var borderRight = getProp(cell, 'border-right-width', 0);\n      var borders = borderLeft + borderRight;\n      return width - paddingLeft - paddingRight - borders;\n    }\n  };\n\n  var getHeight = function (cell) {\n    return needManualCalc() ? getCalculatedHeight(cell) : getProp(cell, 'height', get$6(cell));\n  };\n\n  var getWidth = function (cell) {\n    return needManualCalc() ? getCalculatedWidth(cell) : getProp(cell, 'width', get$5(cell));\n  };\n\n  var rPercentageBasedSizeRegex = /(\\d+(\\.\\d+)?)%/;\n  var rPixelBasedSizeRegex = /(\\d+(\\.\\d+)?)px|em/;\n\n  var getPercentSize = function (elm, getter) {\n    var relativeParent = offsetParent(elm).getOr(getBody(owner(elm)));\n    return getter(elm) / getter(relativeParent) * 100;\n  };\n\n  var setPixelWidth = function (cell, amount) {\n    set$1(cell, 'width', amount + 'px');\n  };\n\n  var setPercentageWidth = function (cell, amount) {\n    set$1(cell, 'width', amount + '%');\n  };\n\n  var setHeight = function (cell, amount) {\n    set$1(cell, 'height', amount + 'px');\n  };\n\n  var getHeightValue = function (cell) {\n    return getRaw(cell, 'height').getOrThunk(function () {\n      return getHeight(cell) + 'px';\n    });\n  };\n\n  var convert = function (cell, number, getter, setter) {\n    var newSize = table(cell).map(function (table) {\n      var total = getter(table);\n      return Math.floor(number / 100 * total);\n    }).getOr(number);\n    setter(cell, newSize);\n    return newSize;\n  };\n\n  var normalizePixelSize = function (value, cell, getter, setter) {\n    var number = parseInt(value, 10);\n    return endsWith(value, '%') && name(cell) !== 'table' ? convert(cell, number, getter, setter) : number;\n  };\n\n  var getTotalHeight = function (cell) {\n    var value = getHeightValue(cell);\n\n    if (!value) {\n      return get$6(cell);\n    }\n\n    return normalizePixelSize(value, cell, get$6, setHeight);\n  };\n\n  var get$7 = function (cell, type, f) {\n    var v = f(cell);\n    var span = getSpan(cell, type);\n    return v / span;\n  };\n\n  var getRawWidth = function (element) {\n    var cssWidth = getRaw(element, 'width');\n    return cssWidth.fold(function () {\n      return Optional.from(get$2(element, 'width'));\n    }, function (width) {\n      return Optional.some(width);\n    });\n  };\n\n  var normalizePercentageWidth = function (cellWidth, tableSize) {\n    return cellWidth / tableSize.pixelWidth() * 100;\n  };\n\n  var choosePercentageSize = function (element, width, tableSize) {\n    var percentMatch = rPercentageBasedSizeRegex.exec(width);\n\n    if (percentMatch !== null) {\n      return parseFloat(percentMatch[1]);\n    } else {\n      var intWidth = getWidth(element);\n      return normalizePercentageWidth(intWidth, tableSize);\n    }\n  };\n\n  var getPercentageWidth = function (cell, tableSize) {\n    var width = getRawWidth(cell);\n    return width.fold(function () {\n      var intWidth = get$5(cell);\n      return normalizePercentageWidth(intWidth, tableSize);\n    }, function (w) {\n      return choosePercentageSize(cell, w, tableSize);\n    });\n  };\n\n  var normalizePixelWidth = function (cellWidth, tableSize) {\n    return cellWidth / 100 * tableSize.pixelWidth();\n  };\n\n  var choosePixelSize = function (element, width, tableSize) {\n    var pixelMatch = rPixelBasedSizeRegex.exec(width);\n\n    if (pixelMatch !== null) {\n      return parseInt(pixelMatch[1], 10);\n    }\n\n    var percentMatch = rPercentageBasedSizeRegex.exec(width);\n\n    if (percentMatch !== null) {\n      var floatWidth = parseFloat(percentMatch[1]);\n      return normalizePixelWidth(floatWidth, tableSize);\n    }\n\n    return getWidth(element);\n  };\n\n  var getPixelWidth = function (cell, tableSize) {\n    var width = getRawWidth(cell);\n    return width.fold(function () {\n      return getWidth(cell);\n    }, function (w) {\n      return choosePixelSize(cell, w, tableSize);\n    });\n  };\n\n  var getHeight$1 = function (cell) {\n    return get$7(cell, 'rowspan', getTotalHeight);\n  };\n\n  var getGenericWidth = function (cell) {\n    var width = getRawWidth(cell);\n    return width.bind(function (w) {\n      return parse(w, ['fixed', 'relative', 'empty']);\n    });\n  };\n\n  var setGenericWidth = function (cell, amount, unit) {\n    set$1(cell, 'width', amount + unit);\n  };\n\n  var getPixelTableWidth = function (table) {\n    return get$5(table) + 'px';\n  };\n\n  var getPercentTableWidth = function (table) {\n    return getPercentSize(table, get$5) + '%';\n  };\n\n  var isPercentSizing = function (table) {\n    return getRawWidth(table).exists(function (size) {\n      return rPercentageBasedSizeRegex.test(size);\n    });\n  };\n\n  var isPixelSizing = function (table) {\n    return getRawWidth(table).exists(function (size) {\n      return rPixelBasedSizeRegex.test(size);\n    });\n  };\n\n  var isNoneSizing = function (table) {\n    return getRawWidth(table).isNone();\n  };\n\n  var percentageBasedSizeRegex = constant(rPercentageBasedSizeRegex);\n  var pixelBasedSizeRegex = constant(rPixelBasedSizeRegex);\n  var isCol = isTag('col');\n\n  var getRaw$1 = function (cell, property, getter) {\n    return getRaw(cell, property).fold(function () {\n      return getter(cell) + 'px';\n    }, function (raw) {\n      return raw;\n    });\n  };\n\n  var getRawW = function (cell, tableSize) {\n    var fallback = function (e) {\n      return isCol(e) ? get$5(e) : getPixelWidth(e, tableSize);\n    };\n\n    return getRaw$1(cell, 'width', fallback);\n  };\n\n  var getRawH = function (cell) {\n    return getRaw$1(cell, 'height', getHeight$1);\n  };\n\n  var justCols = function (warehouse) {\n    return map(Warehouse.justColumns(warehouse), function (column) {\n      return Optional.from(column.element);\n    });\n  };\n\n  var hasRawStyle = function (cell, prop) {\n    return getRaw(cell, prop).isSome();\n  };\n\n  var isValidColumn = function (cell) {\n    return !isCol(cell) || hasRawStyle(cell, 'width');\n  };\n\n  var getDimension = function (cellOpt, index, backups, filter, getter, fallback) {\n    return cellOpt.filter(filter).fold(function () {\n      return fallback(deduce(backups, index));\n    }, function (cell) {\n      return getter(cell);\n    });\n  };\n\n  var getWidthFrom = function (warehouse, table, getWidth, fallback, tableSize) {\n    var columnCells = columns$1(warehouse, function (cell) {\n      return hasRawStyle(cell, 'width');\n    });\n    var columns = Warehouse.hasColumns(warehouse) ? justCols(warehouse) : columnCells;\n    var backups = [Optional.some(width.edge(table))].concat(map(width.positions(columnCells, table), function (pos) {\n      return pos.map(function (p) {\n        return p.x;\n      });\n    }));\n    var colFilter = not(hasColspan);\n    return map(columns, function (cellOption, c) {\n      return getDimension(cellOption, c, backups, colFilter, function (column) {\n        if (isValidColumn(column)) {\n          return getWidth(column, tableSize);\n        } else {\n          var cell = bindFrom(columnCells[c], identity);\n          return getDimension(cell, c, backups, colFilter, function (cell) {\n            return fallback(Optional.some(get$5(cell)));\n          }, fallback);\n        }\n      }, fallback);\n    });\n  };\n\n  var getDeduced = function (deduced) {\n    return deduced.map(function (d) {\n      return d + 'px';\n    }).getOr('');\n  };\n\n  var getRawWidths = function (warehouse, table, tableSize) {\n    return getWidthFrom(warehouse, table, getRawW, getDeduced, tableSize);\n  };\n\n  var getPercentageWidths = function (warehouse, table, tableSize) {\n    return getWidthFrom(warehouse, table, getPercentageWidth, function (deduced) {\n      return deduced.fold(function () {\n        return tableSize.minCellWidth();\n      }, function (cellWidth) {\n        return cellWidth / tableSize.pixelWidth() * 100;\n      });\n    }, tableSize);\n  };\n\n  var getPixelWidths = function (warehouse, table, tableSize) {\n    return getWidthFrom(warehouse, table, getPixelWidth, function (deduced) {\n      return deduced.getOrThunk(tableSize.minCellWidth);\n    }, tableSize);\n  };\n\n  var getHeightFrom = function (warehouse, table, direction, getHeight, fallback) {\n    var rows = rows$1(warehouse);\n    var backups = [Optional.some(direction.edge(table))].concat(map(direction.positions(rows, table), function (pos) {\n      return pos.map(function (p) {\n        return p.y;\n      });\n    }));\n    return map(rows, function (cellOption, c) {\n      return getDimension(cellOption, c, backups, not(hasRowspan), getHeight, fallback);\n    });\n  };\n\n  var getPixelHeights = function (warehouse, table, direction) {\n    return getHeightFrom(warehouse, table, direction, getHeight$1, function (deduced) {\n      return deduced.getOrThunk(minHeight);\n    });\n  };\n\n  var getRawHeights = function (warehouse, table, direction) {\n    return getHeightFrom(warehouse, table, direction, getRawH, getDeduced);\n  };\n\n  var Cell = function (initial) {\n    var value = initial;\n\n    var get = function () {\n      return value;\n    };\n\n    var set = function (v) {\n      value = v;\n    };\n\n    return {\n      get: get,\n      set: set\n    };\n  };\n\n  var noneSize = function (table) {\n    var getWidth = function () {\n      return get$5(table);\n    };\n\n    var zero = constant(0);\n\n    var getWidths = function (warehouse, tableSize) {\n      return getPixelWidths(warehouse, table, tableSize);\n    };\n\n    return {\n      width: getWidth,\n      pixelWidth: getWidth,\n      getWidths: getWidths,\n      getCellDelta: zero,\n      singleColumnWidth: constant([0]),\n      minCellWidth: zero,\n      setElementWidth: noop,\n      adjustTableWidth: noop,\n      isRelative: true,\n      label: 'none'\n    };\n  };\n\n  var percentageSize = function (initialWidth, table) {\n    var floatWidth = Cell(parseFloat(initialWidth));\n    var pixelWidth = Cell(get$5(table));\n\n    var getCellDelta = function (delta) {\n      return delta / pixelWidth.get() * 100;\n    };\n\n    var singleColumnWidth = function (w, _delta) {\n      return [100 - w];\n    };\n\n    var minCellWidth = function () {\n      return minWidth() / pixelWidth.get() * 100;\n    };\n\n    var adjustTableWidth = function (delta) {\n      var currentWidth = floatWidth.get();\n      var change = delta / 100 * currentWidth;\n      var newWidth = currentWidth + change;\n      setPercentageWidth(table, newWidth);\n      floatWidth.set(newWidth);\n      pixelWidth.set(get$5(table));\n    };\n\n    var getWidths = function (warehouse, tableSize) {\n      return getPercentageWidths(warehouse, table, tableSize);\n    };\n\n    return {\n      width: floatWidth.get,\n      pixelWidth: pixelWidth.get,\n      getWidths: getWidths,\n      getCellDelta: getCellDelta,\n      singleColumnWidth: singleColumnWidth,\n      minCellWidth: minCellWidth,\n      setElementWidth: setPercentageWidth,\n      adjustTableWidth: adjustTableWidth,\n      isRelative: true,\n      label: 'percent'\n    };\n  };\n\n  var pixelSize = function (initialWidth, table) {\n    var width = Cell(initialWidth);\n    var getWidth = width.get;\n    var getCellDelta = identity;\n\n    var singleColumnWidth = function (w, delta) {\n      var newNext = Math.max(minWidth(), w + delta);\n      return [newNext - w];\n    };\n\n    var adjustTableWidth = function (delta) {\n      var newWidth = getWidth() + delta;\n      setPixelWidth(table, newWidth);\n      width.set(newWidth);\n    };\n\n    var getWidths = function (warehouse, tableSize) {\n      return getPixelWidths(warehouse, table, tableSize);\n    };\n\n    return {\n      width: getWidth,\n      pixelWidth: getWidth,\n      getWidths: getWidths,\n      getCellDelta: getCellDelta,\n      singleColumnWidth: singleColumnWidth,\n      minCellWidth: minWidth,\n      setElementWidth: setPixelWidth,\n      adjustTableWidth: adjustTableWidth,\n      isRelative: false,\n      label: 'pixel'\n    };\n  };\n\n  var chooseSize = function (element, width) {\n    var percentMatch = percentageBasedSizeRegex().exec(width);\n\n    if (percentMatch !== null) {\n      return percentageSize(percentMatch[1], element);\n    }\n\n    var pixelMatch = pixelBasedSizeRegex().exec(width);\n\n    if (pixelMatch !== null) {\n      var intWidth = parseInt(pixelMatch[1], 10);\n      return pixelSize(intWidth, element);\n    }\n\n    var fallbackWidth = get$5(element);\n    return pixelSize(fallbackWidth, element);\n  };\n\n  var getTableSize = function (table) {\n    var width = getRawWidth(table);\n    return width.fold(function () {\n      return noneSize(table);\n    }, function (w) {\n      return chooseSize(table, w);\n    });\n  };\n\n  var TableSize = {\n    getTableSize: getTableSize,\n    pixelSize: pixelSize,\n    percentageSize: percentageSize,\n    noneSize: noneSize\n  };\n\n  var statsStruct = function (minRow, minCol, maxRow, maxCol, allCells, selectedCells) {\n    return {\n      minRow: minRow,\n      minCol: minCol,\n      maxRow: maxRow,\n      maxCol: maxCol,\n      allCells: allCells,\n      selectedCells: selectedCells\n    };\n  };\n\n  var findSelectedStats = function (house, isSelected) {\n    var totalColumns = house.grid.columns;\n    var totalRows = house.grid.rows;\n    var minRow = totalRows;\n    var minCol = totalColumns;\n    var maxRow = 0;\n    var maxCol = 0;\n    var allCells = [];\n    var selectedCells = [];\n    each$1(house.access, function (detail) {\n      allCells.push(detail);\n\n      if (isSelected(detail)) {\n        selectedCells.push(detail);\n        var startRow = detail.row;\n        var endRow = startRow + detail.rowspan - 1;\n        var startCol = detail.column;\n        var endCol = startCol + detail.colspan - 1;\n\n        if (startRow < minRow) {\n          minRow = startRow;\n        } else if (endRow > maxRow) {\n          maxRow = endRow;\n        }\n\n        if (startCol < minCol) {\n          minCol = startCol;\n        } else if (endCol > maxCol) {\n          maxCol = endCol;\n        }\n      }\n    });\n    return statsStruct(minRow, minCol, maxRow, maxCol, allCells, selectedCells);\n  };\n\n  var makeCell = function (list, seenSelected, rowIndex) {\n    var row = list[rowIndex].element;\n    var td = SugarElement.fromTag('td');\n    append(td, SugarElement.fromTag('br'));\n    var f = seenSelected ? append : prepend;\n    f(row, td);\n  };\n\n  var fillInGaps = function (list, house, stats, isSelected) {\n    var totalColumns = house.grid.columns;\n    var totalRows = house.grid.rows;\n\n    for (var i = 0; i < totalRows; i++) {\n      var seenSelected = false;\n\n      for (var j = 0; j < totalColumns; j++) {\n        if (!(i < stats.minRow || i > stats.maxRow || j < stats.minCol || j > stats.maxCol)) {\n          var needCell = Warehouse.getAt(house, i, j).filter(isSelected).isNone();\n\n          if (needCell) {\n            makeCell(list, seenSelected, i);\n          } else {\n            seenSelected = true;\n          }\n        }\n      }\n    }\n  };\n\n  var clean = function (replica, stats, house, widthDelta) {\n    each$1(house.columns, function (col) {\n      if (col.column < stats.minCol || col.column > stats.maxCol) {\n        remove$2(col.element);\n      }\n    });\n    var emptyRows = filter(firstLayer(replica, 'tr'), function (row) {\n      return row.dom.childElementCount === 0;\n    });\n    each(emptyRows, remove$2);\n\n    if (stats.minCol === stats.maxCol || stats.minRow === stats.maxRow) {\n      each(firstLayer(replica, 'th,td'), function (cell) {\n        remove(cell, 'rowspan');\n        remove(cell, 'colspan');\n      });\n    }\n\n    remove(replica, LOCKED_COL_ATTR);\n    remove(replica, 'data-snooker-col-series');\n    var tableSize = TableSize.getTableSize(replica);\n    tableSize.adjustTableWidth(widthDelta);\n  };\n\n  var getTableWidthDelta = function (table, warehouse, tableSize, stats) {\n    if (stats.minCol === 0 && warehouse.grid.columns === stats.maxCol + 1) {\n      return 0;\n    }\n\n    var colWidths = getPixelWidths(warehouse, table, tableSize);\n    var allColsWidth = foldl(colWidths, function (acc, width) {\n      return acc + width;\n    }, 0);\n    var selectedColsWidth = foldl(colWidths.slice(stats.minCol, stats.maxCol + 1), function (acc, width) {\n      return acc + width;\n    }, 0);\n    var newWidth = selectedColsWidth / allColsWidth * tableSize.pixelWidth();\n    var delta = newWidth - tableSize.pixelWidth();\n    return tableSize.getCellDelta(delta);\n  };\n\n  var extract = function (table, selectedSelector) {\n    var isSelected = function (detail) {\n      return is(detail.element, selectedSelector);\n    };\n\n    var replica = deep(table);\n    var list = fromTable(replica);\n    var tableSize = TableSize.getTableSize(table);\n    var replicaHouse = Warehouse.generate(list);\n    var replicaStats = findSelectedStats(replicaHouse, isSelected);\n    var selector = 'th:not(' + selectedSelector + ')' + ',td:not(' + selectedSelector + ')';\n    var unselectedCells = filterFirstLayer(replica, 'th,td', function (cell) {\n      return is(cell, selector);\n    });\n    each(unselectedCells, remove$2);\n    fillInGaps(list, replicaHouse, replicaStats, isSelected);\n    var house = Warehouse.fromTable(table);\n    var widthDelta = getTableWidthDelta(table, house, tableSize, replicaStats);\n    clean(replica, replicaStats, replicaHouse, widthDelta);\n    return replica;\n  };\n\n  var nbsp = '\\xA0';\n\n  var getEnd = function (element) {\n    return name(element) === 'img' ? 1 : getOption(element).fold(function () {\n      return children(element).length;\n    }, function (v) {\n      return v.length;\n    });\n  };\n\n  var isTextNodeWithCursorPosition = function (el) {\n    return getOption(el).filter(function (text) {\n      return text.trim().length !== 0 || text.indexOf(nbsp) > -1;\n    }).isSome();\n  };\n\n  var elementsWithCursorPosition = ['img', 'br'];\n\n  var isCursorPosition = function (elem) {\n    var hasCursorPosition = isTextNodeWithCursorPosition(elem);\n    return hasCursorPosition || contains(elementsWithCursorPosition, name(elem));\n  };\n\n  var first = function (element) {\n    return descendant(element, isCursorPosition);\n  };\n\n  var last$1 = function (element) {\n    return descendantRtl(element, isCursorPosition);\n  };\n\n  var descendantRtl = function (scope, predicate) {\n    var descend = function (element) {\n      var children$1 = children(element);\n\n      for (var i = children$1.length - 1; i >= 0; i--) {\n        var child = children$1[i];\n\n        if (predicate(child)) {\n          return Optional.some(child);\n        }\n\n        var res = descend(child);\n\n        if (res.isSome()) {\n          return res;\n        }\n      }\n\n      return Optional.none();\n    };\n\n    return descend(scope);\n  };\n\n  var transferableAttributes = {\n    scope: ['row', 'col']\n  };\n\n  var createCell = function () {\n    var td = SugarElement.fromTag('td');\n    append(td, SugarElement.fromTag('br'));\n    return td;\n  };\n\n  var createCol = function () {\n    return SugarElement.fromTag('col');\n  };\n\n  var createColgroup = function () {\n    return SugarElement.fromTag('colgroup');\n  };\n\n  var replace = function (cell, tag, attrs) {\n    var replica = copy$1(cell, tag);\n    each$1(attrs, function (v, k) {\n      if (v === null) {\n        remove(replica, k);\n      } else {\n        set(replica, k, v);\n      }\n    });\n    return replica;\n  };\n\n  var pasteReplace = function (cell) {\n    return cell;\n  };\n\n  var newRow = function (doc) {\n    return function () {\n      return SugarElement.fromTag('tr', doc.dom);\n    };\n  };\n\n  var cloneFormats = function (oldCell, newCell, formats) {\n    var first$1 = first(oldCell);\n    return first$1.map(function (firstText) {\n      var formatSelector = formats.join(',');\n      var parents = ancestors$1(firstText, formatSelector, function (element) {\n        return eq$1(element, oldCell);\n      });\n      return foldr(parents, function (last, parent) {\n        var clonedFormat = shallow(parent);\n        remove(clonedFormat, 'contenteditable');\n        append(last, clonedFormat);\n        return clonedFormat;\n      }, newCell);\n    }).getOr(newCell);\n  };\n\n  var cloneAppropriateAttributes = function (original, clone) {\n    each$1(transferableAttributes, function (validAttributes, attributeName) {\n      return getOpt(original, attributeName).filter(function (attribute) {\n        return contains(validAttributes, attribute);\n      }).each(function (attribute) {\n        return set(clone, attributeName, attribute);\n      });\n    });\n  };\n\n  var cellOperations = function (mutate, doc, formatsToClone) {\n    var cloneCss = function (prev, clone) {\n      copy(prev.element, clone);\n      remove$1(clone, 'height');\n\n      if (prev.colspan !== 1) {\n        remove$1(clone, 'width');\n      }\n    };\n\n    var newCell = function (prev) {\n      var docu = owner(prev.element);\n      var td = SugarElement.fromTag(name(prev.element), docu.dom);\n      var formats = formatsToClone.getOr(['strong', 'em', 'b', 'i', 'span', 'font', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'div']);\n      var lastNode = formats.length > 0 ? cloneFormats(prev.element, td, formats) : td;\n      append(lastNode, SugarElement.fromTag('br'));\n      cloneCss(prev, td);\n      cloneAppropriateAttributes(prev.element, td);\n      mutate(prev.element, td);\n      return td;\n    };\n\n    var newCol = function (prev) {\n      var doc = owner(prev.element);\n      var col = SugarElement.fromTag(name(prev.element), doc.dom);\n      cloneCss(prev, col);\n      mutate(prev.element, col);\n      return col;\n    };\n\n    return {\n      col: newCol,\n      colgroup: createColgroup,\n      row: newRow(doc),\n      cell: newCell,\n      replace: replace,\n      gap: createCell\n    };\n  };\n\n  var paste = function (doc) {\n    return {\n      col: createCol,\n      colgroup: createColgroup,\n      row: newRow(doc),\n      cell: createCell,\n      replace: pasteReplace,\n      gap: createCell\n    };\n  };\n\n  var fromHtml$1 = function (html, scope) {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n    return children(SugarElement.fromDom(div));\n  };\n\n  var fromDom$1 = function (nodes) {\n    return map(nodes, SugarElement.fromDom);\n  };\n\n  var getNodeName = function (elm) {\n    return elm.nodeName.toLowerCase();\n  };\n\n  var getBody$1 = function (editor) {\n    return SugarElement.fromDom(editor.getBody());\n  };\n\n  var getPixelWidth$1 = function (elm) {\n    return elm.getBoundingClientRect().width;\n  };\n\n  var getPixelHeight = function (elm) {\n    return elm.getBoundingClientRect().height;\n  };\n\n  var getIsRoot = function (editor) {\n    return function (element) {\n      return eq$1(element, getBody$1(editor));\n    };\n  };\n\n  var removePxSuffix = function (size) {\n    return size ? size.replace(/px$/, '') : '';\n  };\n\n  var addPxSuffix = function (size) {\n    return /^\\d+(\\.\\d+)?$/.test(size) ? size + 'px' : size;\n  };\n\n  var removeDataStyle = function (table) {\n    remove(table, 'data-mce-style');\n\n    var removeStyleAttribute = function (element) {\n      return remove(element, 'data-mce-style');\n    };\n\n    each(cells(table), removeStyleAttribute);\n    each(columns(table), removeStyleAttribute);\n  };\n\n  var getRawWidth$1 = function (editor, elm) {\n    var raw = editor.dom.getStyle(elm, 'width') || editor.dom.getAttrib(elm, 'width');\n    return Optional.from(raw).filter(isNotEmpty);\n  };\n\n  var isPercentage = function (value) {\n    return /^(\\d+(\\.\\d+)?)%$/.test(value);\n  };\n\n  var isPixel = function (value) {\n    return /^(\\d+(\\.\\d+)?)px$/.test(value);\n  };\n\n  var getSelectionStart = function (editor) {\n    return SugarElement.fromDom(editor.selection.getStart());\n  };\n\n  var selection = function (selections) {\n    return cata(selections.get(), constant([]), identity, pure);\n  };\n\n  var unmergable = function (selections) {\n    var hasSpan = function (elem, type) {\n      return getOpt(elem, type).exists(function (span) {\n        return parseInt(span, 10) > 1;\n      });\n    };\n\n    var hasRowOrColSpan = function (elem) {\n      return hasSpan(elem, 'rowspan') || hasSpan(elem, 'colspan');\n    };\n\n    var candidates = selection(selections);\n    return candidates.length > 0 && forall(candidates, hasRowOrColSpan) ? Optional.some(candidates) : Optional.none();\n  };\n\n  var mergable = function (table, selections, ephemera) {\n    return cata(selections.get(), Optional.none, function (cells) {\n      if (cells.length <= 1) {\n        return Optional.none();\n      } else {\n        return retrieveBox(table, ephemera.firstSelectedSelector, ephemera.lastSelectedSelector).map(function (bounds) {\n          return {\n            bounds: bounds,\n            cells: cells\n          };\n        });\n      }\n    }, Optional.none);\n  };\n\n  var strSelected = 'data-mce-selected';\n  var strSelectedSelector = 'td[' + strSelected + '],th[' + strSelected + ']';\n  var strAttributeSelector = '[' + strSelected + ']';\n  var strFirstSelected = 'data-mce-first-selected';\n  var strFirstSelectedSelector = 'td[' + strFirstSelected + '],th[' + strFirstSelected + ']';\n  var strLastSelected = 'data-mce-last-selected';\n  var strLastSelectedSelector = 'td[' + strLastSelected + '],th[' + strLastSelected + ']';\n  var attributeSelector = strAttributeSelector;\n  var ephemera = {\n    selected: strSelected,\n    selectedSelector: strSelectedSelector,\n    firstSelected: strFirstSelected,\n    firstSelectedSelector: strFirstSelectedSelector,\n    lastSelected: strLastSelected,\n    lastSelectedSelector: strLastSelectedSelector\n  };\n\n  var noMenu = function (cell) {\n    return {\n      element: cell,\n      mergable: Optional.none(),\n      unmergable: Optional.none(),\n      selection: [cell]\n    };\n  };\n\n  var forMenu = function (selections, table, cell) {\n    return {\n      element: cell,\n      mergable: mergable(table, selections, ephemera),\n      unmergable: unmergable(selections),\n      selection: selection(selections)\n    };\n  };\n\n  var paste$1 = function (element, clipboard, generators) {\n    return {\n      element: element,\n      clipboard: clipboard,\n      generators: generators\n    };\n  };\n\n  var pasteRows = function (selections, cell, clipboard, generators) {\n    return {\n      selection: selection(selections),\n      clipboard: clipboard,\n      generators: generators\n    };\n  };\n\n  var extractSelected = function (cells) {\n    return table(cells[0]).map(function (table) {\n      var replica = extract(table, attributeSelector);\n      removeDataStyle(replica);\n      return [replica];\n    });\n  };\n\n  var serializeElements = function (editor, elements) {\n    return map(elements, function (elm) {\n      return editor.selection.serializer.serialize(elm.dom, {});\n    }).join('');\n  };\n\n  var getTextContent = function (elements) {\n    return map(elements, function (element) {\n      return element.dom.innerText;\n    }).join('');\n  };\n\n  var registerEvents = function (editor, selections, actions, cellSelection) {\n    editor.on('BeforeGetContent', function (e) {\n      var multiCellContext = function (cells) {\n        e.preventDefault();\n        extractSelected(cells).each(function (elements) {\n          e.content = e.format === 'text' ? getTextContent(elements) : serializeElements(editor, elements);\n        });\n      };\n\n      if (e.selection === true) {\n        cata(selections.get(), noop, multiCellContext, noop);\n      }\n    });\n    editor.on('BeforeSetContent', function (e) {\n      if (e.selection === true && e.paste === true) {\n        var cellOpt = Optional.from(editor.dom.getParent(editor.selection.getStart(), 'th,td'));\n        cellOpt.each(function (domCell) {\n          var cell = SugarElement.fromDom(domCell);\n          table(cell).each(function (table) {\n            var elements = filter(fromHtml$1(e.content), function (content) {\n              return name(content) !== 'meta';\n            });\n\n            var isTable = function (elm) {\n              return name(elm) === 'table';\n            };\n\n            if (elements.length === 1 && isTable(elements[0])) {\n              e.preventDefault();\n              var doc = SugarElement.fromDom(editor.getDoc());\n              var generators = paste(doc);\n              var targets = paste$1(cell, elements[0], generators);\n              actions.pasteCells(table, targets).each(function (data) {\n                editor.selection.setRng(data.rng);\n                editor.focus();\n                cellSelection.clear(table);\n              });\n            }\n          });\n        });\n      }\n    });\n  };\n\n  var adt = Adt.generate([{\n    none: []\n  }, {\n    only: ['index']\n  }, {\n    left: ['index', 'next']\n  }, {\n    middle: ['prev', 'index', 'next']\n  }, {\n    right: ['prev', 'index']\n  }]);\n\n  var ColumnContext = __assign({}, adt);\n\n  var neighbours = function (input, index) {\n    if (input.length === 0) {\n      return ColumnContext.none();\n    }\n\n    if (input.length === 1) {\n      return ColumnContext.only(0);\n    }\n\n    if (index === 0) {\n      return ColumnContext.left(0, 1);\n    }\n\n    if (index === input.length - 1) {\n      return ColumnContext.right(index - 1, index);\n    }\n\n    if (index > 0 && index < input.length - 1) {\n      return ColumnContext.middle(index - 1, index, index + 1);\n    }\n\n    return ColumnContext.none();\n  };\n\n  var determine = function (input, column, step, tableSize, resize) {\n    var result = input.slice(0);\n    var context = neighbours(input, column);\n    var onNone = constant(map(result, constant(0)));\n\n    var onOnly = function (index) {\n      return tableSize.singleColumnWidth(result[index], step);\n    };\n\n    var onLeft = function (index, next) {\n      return resize.calcLeftEdgeDeltas(result, index, next, step, tableSize.minCellWidth(), tableSize.isRelative);\n    };\n\n    var onMiddle = function (prev, index, next) {\n      return resize.calcMiddleDeltas(result, prev, index, next, step, tableSize.minCellWidth(), tableSize.isRelative);\n    };\n\n    var onRight = function (prev, index) {\n      return resize.calcRightEdgeDeltas(result, prev, index, step, tableSize.minCellWidth(), tableSize.isRelative);\n    };\n\n    return context.fold(onNone, onOnly, onLeft, onMiddle, onRight);\n  };\n\n  var total = function (start, end, measures) {\n    var r = 0;\n\n    for (var i = start; i < end; i++) {\n      r += measures[i] !== undefined ? measures[i] : 0;\n    }\n\n    return r;\n  };\n\n  var recalculateWidthForCells = function (warehouse, widths) {\n    var all = Warehouse.justCells(warehouse);\n    return map(all, function (cell) {\n      var width = total(cell.column, cell.column + cell.colspan, widths);\n      return {\n        element: cell.element,\n        width: width,\n        colspan: cell.colspan\n      };\n    });\n  };\n\n  var recalculateWidthForColumns = function (warehouse, widths) {\n    var groups = Warehouse.justColumns(warehouse);\n    return map(groups, function (column, index) {\n      return {\n        element: column.element,\n        width: widths[index],\n        colspan: column.colspan\n      };\n    });\n  };\n\n  var recalculateHeightForCells = function (warehouse, heights) {\n    var all = Warehouse.justCells(warehouse);\n    return map(all, function (cell) {\n      var height = total(cell.row, cell.row + cell.rowspan, heights);\n      return {\n        element: cell.element,\n        height: height,\n        rowspan: cell.rowspan\n      };\n    });\n  };\n\n  var matchRowHeight = function (warehouse, heights) {\n    return map(warehouse.all, function (row, i) {\n      return {\n        element: row.element,\n        height: heights[i]\n      };\n    });\n  };\n\n  var sumUp = function (newSize) {\n    return foldr(newSize, function (b, a) {\n      return b + a;\n    }, 0);\n  };\n\n  var recalculate = function (warehouse, widths) {\n    if (Warehouse.hasColumns(warehouse)) {\n      return recalculateWidthForColumns(warehouse, widths);\n    } else {\n      return recalculateWidthForCells(warehouse, widths);\n    }\n  };\n\n  var recalculateAndApply = function (warehouse, widths, tableSize) {\n    var newSizes = recalculate(warehouse, widths);\n    each(newSizes, function (cell) {\n      tableSize.setElementWidth(cell.element, cell.width);\n    });\n  };\n\n  var adjustWidth = function (table, delta, index, resizing, tableSize) {\n    var warehouse = Warehouse.fromTable(table);\n    var step = tableSize.getCellDelta(delta);\n    var widths = tableSize.getWidths(warehouse, tableSize);\n    var isLastColumn = index === warehouse.grid.columns - 1;\n    var clampedStep = resizing.clampTableDelta(widths, index, step, tableSize.minCellWidth(), isLastColumn);\n    var deltas = determine(widths, index, clampedStep, tableSize, resizing);\n    var newWidths = map(deltas, function (dx, i) {\n      return dx + widths[i];\n    });\n    recalculateAndApply(warehouse, newWidths, tableSize);\n    resizing.resizeTable(tableSize.adjustTableWidth, clampedStep, isLastColumn);\n  };\n\n  var adjustHeight = function (table, delta, index, direction) {\n    var warehouse = Warehouse.fromTable(table);\n    var heights = getPixelHeights(warehouse, table, direction);\n    var newHeights = map(heights, function (dy, i) {\n      return index === i ? Math.max(delta + dy, minHeight()) : dy;\n    });\n    var newCellSizes = recalculateHeightForCells(warehouse, newHeights);\n    var newRowSizes = matchRowHeight(warehouse, newHeights);\n    each(newRowSizes, function (row) {\n      setHeight(row.element, row.height);\n    });\n    each(newCellSizes, function (cell) {\n      setHeight(cell.element, cell.height);\n    });\n    var total = sumUp(newHeights);\n    setHeight(table, total);\n  };\n\n  var adjustAndRedistributeWidths = function (_table, list, details, tableSize, resizeBehaviour) {\n    var warehouse = Warehouse.generate(list);\n    var sizes = tableSize.getWidths(warehouse, tableSize);\n    var tablePixelWidth = tableSize.pixelWidth();\n\n    var _a = resizeBehaviour.calcRedestributedWidths(sizes, tablePixelWidth, details.pixelDelta, tableSize.isRelative),\n        newSizes = _a.newSizes,\n        delta = _a.delta;\n\n    recalculateAndApply(warehouse, newSizes, tableSize);\n    tableSize.adjustTableWidth(delta);\n  };\n\n  var adjustWidthTo = function (_table, list, _info, tableSize) {\n    var warehouse = Warehouse.generate(list);\n    var widths = tableSize.getWidths(warehouse, tableSize);\n    recalculateAndApply(warehouse, widths, tableSize);\n  };\n\n  var zero = function (array) {\n    return map(array, constant(0));\n  };\n\n  var surround = function (sizes, startIndex, endIndex, results, f) {\n    return f(sizes.slice(0, startIndex)).concat(results).concat(f(sizes.slice(endIndex)));\n  };\n\n  var clampDeltaHelper = function (predicate) {\n    return function (sizes, index, delta, minCellSize) {\n      if (!predicate(delta)) {\n        return delta;\n      } else {\n        var newSize = Math.max(minCellSize, sizes[index] - Math.abs(delta));\n        var diff = Math.abs(newSize - sizes[index]);\n        return delta >= 0 ? diff : -diff;\n      }\n    };\n  };\n\n  var clampNegativeDelta = clampDeltaHelper(function (delta) {\n    return delta < 0;\n  });\n  var clampDelta = clampDeltaHelper(always);\n\n  var resizeTable = function () {\n    var calcFixedDeltas = function (sizes, index, next, delta, minCellSize) {\n      var clampedDelta = clampNegativeDelta(sizes, index, delta, minCellSize);\n      return surround(sizes, index, next + 1, [clampedDelta, 0], zero);\n    };\n\n    var calcRelativeDeltas = function (sizes, index, delta, minCellSize) {\n      var ratio = (100 + delta) / 100;\n      var newThis = Math.max(minCellSize, (sizes[index] + delta) / ratio);\n      return map(sizes, function (size, idx) {\n        var newSize = idx === index ? newThis : size / ratio;\n        return newSize - size;\n      });\n    };\n\n    var calcLeftEdgeDeltas = function (sizes, index, next, delta, minCellSize, isRelative) {\n      if (isRelative) {\n        return calcRelativeDeltas(sizes, index, delta, minCellSize);\n      } else {\n        return calcFixedDeltas(sizes, index, next, delta, minCellSize);\n      }\n    };\n\n    var calcMiddleDeltas = function (sizes, _prev, index, next, delta, minCellSize, isRelative) {\n      return calcLeftEdgeDeltas(sizes, index, next, delta, minCellSize, isRelative);\n    };\n\n    var resizeTable = function (resizer, delta) {\n      return resizer(delta);\n    };\n\n    var calcRightEdgeDeltas = function (sizes, _prev, index, delta, minCellSize, isRelative) {\n      if (isRelative) {\n        return calcRelativeDeltas(sizes, index, delta, minCellSize);\n      } else {\n        var clampedDelta = clampNegativeDelta(sizes, index, delta, minCellSize);\n        return zero(sizes.slice(0, index)).concat([clampedDelta]);\n      }\n    };\n\n    var calcRedestributedWidths = function (sizes, totalWidth, pixelDelta, isRelative) {\n      if (isRelative) {\n        var tableWidth = totalWidth + pixelDelta;\n        var ratio_1 = tableWidth / totalWidth;\n        var newSizes = map(sizes, function (size) {\n          return size / ratio_1;\n        });\n        return {\n          delta: ratio_1 * 100 - 100,\n          newSizes: newSizes\n        };\n      } else {\n        return {\n          delta: pixelDelta,\n          newSizes: sizes\n        };\n      }\n    };\n\n    return {\n      resizeTable: resizeTable,\n      clampTableDelta: clampNegativeDelta,\n      calcLeftEdgeDeltas: calcLeftEdgeDeltas,\n      calcMiddleDeltas: calcMiddleDeltas,\n      calcRightEdgeDeltas: calcRightEdgeDeltas,\n      calcRedestributedWidths: calcRedestributedWidths\n    };\n  };\n\n  var preserveTable = function () {\n    var calcLeftEdgeDeltas = function (sizes, index, next, delta, minCellSize) {\n      var idx = delta >= 0 ? next : index;\n      var clampedDelta = clampDelta(sizes, idx, delta, minCellSize);\n      return surround(sizes, index, next + 1, [clampedDelta, -clampedDelta], zero);\n    };\n\n    var calcMiddleDeltas = function (sizes, _prev, index, next, delta, minCellSize) {\n      return calcLeftEdgeDeltas(sizes, index, next, delta, minCellSize);\n    };\n\n    var resizeTable = function (resizer, delta, isLastColumn) {\n      if (isLastColumn) {\n        resizer(delta);\n      }\n    };\n\n    var calcRightEdgeDeltas = function (sizes, _prev, _index, delta, _minCellSize, isRelative) {\n      if (isRelative) {\n        return zero(sizes);\n      } else {\n        var diff = delta / sizes.length;\n        return map(sizes, constant(diff));\n      }\n    };\n\n    var clampTableDelta = function (sizes, index, delta, minCellSize, isLastColumn) {\n      if (isLastColumn) {\n        if (delta >= 0) {\n          return delta;\n        } else {\n          var maxDelta = foldl(sizes, function (a, b) {\n            return a + b - minCellSize;\n          }, 0);\n          return Math.max(-maxDelta, delta);\n        }\n      } else {\n        return clampNegativeDelta(sizes, index, delta, minCellSize);\n      }\n    };\n\n    var calcRedestributedWidths = function (sizes, _totalWidth, _pixelDelta, _isRelative) {\n      return {\n        delta: 0,\n        newSizes: sizes\n      };\n    };\n\n    return {\n      resizeTable: resizeTable,\n      clampTableDelta: clampTableDelta,\n      calcLeftEdgeDeltas: calcLeftEdgeDeltas,\n      calcMiddleDeltas: calcMiddleDeltas,\n      calcRightEdgeDeltas: calcRightEdgeDeltas,\n      calcRedestributedWidths: calcRedestributedWidths\n    };\n  };\n\n  var only = function (element, isResizable) {\n    var parent = Optional.from(element.dom.documentElement).map(SugarElement.fromDom).getOr(element);\n    return {\n      parent: constant(parent),\n      view: constant(element),\n      origin: constant(SugarPosition(0, 0)),\n      isResizable: isResizable\n    };\n  };\n\n  var detached = function (editable, chrome, isResizable) {\n    var origin = function () {\n      return absolute(chrome);\n    };\n\n    return {\n      parent: constant(chrome),\n      view: constant(editable),\n      origin: origin,\n      isResizable: isResizable\n    };\n  };\n\n  var body$1 = function (editable, chrome, isResizable) {\n    return {\n      parent: constant(chrome),\n      view: constant(editable),\n      origin: constant(SugarPosition(0, 0)),\n      isResizable: isResizable\n    };\n  };\n\n  var ResizeWire = {\n    only: only,\n    detached: detached,\n    body: body$1\n  };\n  var adt$1 = Adt.generate([{\n    invalid: ['raw']\n  }, {\n    pixels: ['value']\n  }, {\n    percent: ['value']\n  }]);\n\n  var validateFor = function (suffix, type, value) {\n    var rawAmount = value.substring(0, value.length - suffix.length);\n    var amount = parseFloat(rawAmount);\n    return rawAmount === amount.toString() ? type(amount) : adt$1.invalid(value);\n  };\n\n  var from$1 = function (value) {\n    if (endsWith(value, '%')) {\n      return validateFor('%', adt$1.percent, value);\n    }\n\n    if (endsWith(value, 'px')) {\n      return validateFor('px', adt$1.pixels, value);\n    }\n\n    return adt$1.invalid(value);\n  };\n\n  var Size = __assign(__assign({}, adt$1), {\n    from: from$1\n  });\n\n  var redistributeToPercent = function (widths, totalWidth) {\n    return map(widths, function (w) {\n      var colType = Size.from(w);\n      return colType.fold(function () {\n        return w;\n      }, function (px) {\n        var ratio = px / totalWidth * 100;\n        return ratio + '%';\n      }, function (pc) {\n        return pc + '%';\n      });\n    });\n  };\n\n  var redistributeToPx = function (widths, totalWidth, newTotalWidth) {\n    var scale = newTotalWidth / totalWidth;\n    return map(widths, function (w) {\n      var colType = Size.from(w);\n      return colType.fold(function () {\n        return w;\n      }, function (px) {\n        return px * scale + 'px';\n      }, function (pc) {\n        return pc / 100 * newTotalWidth + 'px';\n      });\n    });\n  };\n\n  var redistributeEmpty = function (newWidthType, columns) {\n    var f = newWidthType.fold(function () {\n      return constant('');\n    }, function (pixels) {\n      var num = pixels / columns;\n      return constant(num + 'px');\n    }, function () {\n      var num = 100 / columns;\n      return constant(num + '%');\n    });\n    return range(columns, f);\n  };\n\n  var redistributeValues = function (newWidthType, widths, totalWidth) {\n    return newWidthType.fold(function () {\n      return widths;\n    }, function (px) {\n      return redistributeToPx(widths, totalWidth, px);\n    }, function (_pc) {\n      return redistributeToPercent(widths, totalWidth);\n    });\n  };\n\n  var redistribute = function (widths, totalWidth, newWidth) {\n    var newType = Size.from(newWidth);\n    var floats = forall(widths, function (s) {\n      return s === '0px';\n    }) ? redistributeEmpty(newType, widths.length) : redistributeValues(newType, widths, totalWidth);\n    return normalize(floats);\n  };\n\n  var sum = function (values, fallback) {\n    if (values.length === 0) {\n      return fallback;\n    }\n\n    return foldr(values, function (rest, v) {\n      return Size.from(v).fold(constant(0), identity, identity) + rest;\n    }, 0);\n  };\n\n  var roundDown = function (num, unit) {\n    var floored = Math.floor(num);\n    return {\n      value: floored + unit,\n      remainder: num - floored\n    };\n  };\n\n  var add = function (value, amount) {\n    return Size.from(value).fold(constant(value), function (px) {\n      return px + amount + 'px';\n    }, function (pc) {\n      return pc + amount + '%';\n    });\n  };\n\n  var normalize = function (values) {\n    if (values.length === 0) {\n      return values;\n    }\n\n    var scan = foldr(values, function (rest, value) {\n      var info = Size.from(value).fold(function () {\n        return {\n          value: value,\n          remainder: 0\n        };\n      }, function (num) {\n        return roundDown(num, 'px');\n      }, function (num) {\n        return {\n          value: num + '%',\n          remainder: 0\n        };\n      });\n      return {\n        output: [info.value].concat(rest.output),\n        remainder: rest.remainder + info.remainder\n      };\n    }, {\n      output: [],\n      remainder: 0\n    });\n    var r = scan.output;\n    return r.slice(0, r.length - 1).concat([add(r[r.length - 1], Math.round(scan.remainder))]);\n  };\n\n  var validate = Size.from;\n\n  var redistributeToW = function (newWidths, cells, unit) {\n    each(cells, function (cell) {\n      var widths = newWidths.slice(cell.column, cell.colspan + cell.column);\n      var w = sum(widths, minWidth());\n      set$1(cell.element, 'width', w + unit);\n    });\n  };\n\n  var redistributeToColumns = function (newWidths, columns, unit) {\n    each(columns, function (column, index) {\n      var width = sum([newWidths[index]], minWidth());\n      set$1(column.element, 'width', width + unit);\n    });\n  };\n\n  var redistributeToH = function (newHeights, rows, cells, unit) {\n    each(cells, function (cell) {\n      var heights = newHeights.slice(cell.row, cell.rowspan + cell.row);\n      var h = sum(heights, minHeight());\n      set$1(cell.element, 'height', h + unit);\n    });\n    each(rows, function (row, i) {\n      set$1(row.element, 'height', newHeights[i]);\n    });\n  };\n\n  var getUnit = function (newSize) {\n    return validate(newSize).fold(constant('px'), constant('px'), constant('%'));\n  };\n\n  var redistribute$1 = function (table, optWidth, optHeight, tableSize) {\n    var warehouse = Warehouse.fromTable(table);\n    var rows = warehouse.all;\n    var cells = Warehouse.justCells(warehouse);\n    var columns = Warehouse.justColumns(warehouse);\n    optWidth.each(function (newWidth) {\n      var widthUnit = getUnit(newWidth);\n      var totalWidth = get$5(table);\n      var oldWidths = getRawWidths(warehouse, table, tableSize);\n      var nuWidths = redistribute(oldWidths, totalWidth, newWidth);\n\n      if (Warehouse.hasColumns(warehouse)) {\n        redistributeToColumns(nuWidths, columns, widthUnit);\n      } else {\n        redistributeToW(nuWidths, cells, widthUnit);\n      }\n\n      set$1(table, 'width', newWidth);\n    });\n    optHeight.each(function (newHeight) {\n      var hUnit = getUnit(newHeight);\n      var totalHeight = get$6(table);\n      var oldHeights = getRawHeights(warehouse, table, height);\n      var nuHeights = redistribute(oldHeights, totalHeight, newHeight);\n      redistributeToH(nuHeights, rows, cells, hUnit);\n      set$1(table, 'height', newHeight);\n    });\n  };\n\n  var isPercentSizing$1 = isPercentSizing;\n  var isPixelSizing$1 = isPixelSizing;\n  var isNoneSizing$1 = isNoneSizing;\n  var getPercentTableWidth$1 = getPercentTableWidth;\n\n  var getGridSize = function (table) {\n    var warehouse = Warehouse.fromTable(table);\n    return warehouse.grid;\n  };\n\n  var Event = function (fields) {\n    var handlers = [];\n\n    var bind = function (handler) {\n      if (handler === undefined) {\n        throw new Error('Event bind error: undefined handler');\n      }\n\n      handlers.push(handler);\n    };\n\n    var unbind = function (handler) {\n      handlers = filter(handlers, function (h) {\n        return h !== handler;\n      });\n    };\n\n    var trigger = function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      var event = {};\n      each(fields, function (name, i) {\n        event[name] = args[i];\n      });\n      each(handlers, function (handler) {\n        handler(event);\n      });\n    };\n\n    return {\n      bind: bind,\n      unbind: unbind,\n      trigger: trigger\n    };\n  };\n\n  var create = function (typeDefs) {\n    var registry = map$1(typeDefs, function (event) {\n      return {\n        bind: event.bind,\n        unbind: event.unbind\n      };\n    });\n    var trigger = map$1(typeDefs, function (event) {\n      return event.trigger;\n    });\n    return {\n      registry: registry,\n      trigger: trigger\n    };\n  };\n\n  var last$2 = function (fn, rate) {\n    var timer = null;\n\n    var cancel = function () {\n      if (timer !== null) {\n        clearTimeout(timer);\n        timer = null;\n      }\n    };\n\n    var throttle = function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      if (timer !== null) {\n        clearTimeout(timer);\n      }\n\n      timer = setTimeout(function () {\n        fn.apply(null, args);\n        timer = null;\n      }, rate);\n    };\n\n    return {\n      cancel: cancel,\n      throttle: throttle\n    };\n  };\n\n  var sort$1 = function (arr) {\n    return arr.slice(0).sort();\n  };\n\n  var reqMessage = function (required, keys) {\n    throw new Error('All required keys (' + sort$1(required).join(', ') + ') were not specified. Specified keys were: ' + sort$1(keys).join(', ') + '.');\n  };\n\n  var unsuppMessage = function (unsupported) {\n    throw new Error('Unsupported keys for object: ' + sort$1(unsupported).join(', '));\n  };\n\n  var validateStrArr = function (label, array) {\n    if (!isArray(array)) {\n      throw new Error('The ' + label + ' fields must be an array. Was: ' + array + '.');\n    }\n\n    each(array, function (a) {\n      if (!isString(a)) {\n        throw new Error('The value ' + a + ' in the ' + label + ' fields was not a string.');\n      }\n    });\n  };\n\n  var invalidTypeMessage = function (incorrect, type) {\n    throw new Error('All values need to be of type: ' + type + '. Keys (' + sort$1(incorrect).join(', ') + ') were not.');\n  };\n\n  var checkDupes = function (everything) {\n    var sorted = sort$1(everything);\n    var dupe = find(sorted, function (s, i) {\n      return i < sorted.length - 1 && s === sorted[i + 1];\n    });\n    dupe.each(function (d) {\n      throw new Error('The field: ' + d + ' occurs more than once in the combined fields: [' + sorted.join(', ') + '].');\n    });\n  };\n\n  var base = function (handleUnsupported, required) {\n    return baseWith(handleUnsupported, required, {\n      validate: isFunction,\n      label: 'function'\n    });\n  };\n\n  var baseWith = function (handleUnsupported, required, pred) {\n    if (required.length === 0) {\n      throw new Error('You must specify at least one required field.');\n    }\n\n    validateStrArr('required', required);\n    checkDupes(required);\n    return function (obj) {\n      var keys$1 = keys(obj);\n      var allReqd = forall(required, function (req) {\n        return contains(keys$1, req);\n      });\n\n      if (!allReqd) {\n        reqMessage(required, keys$1);\n      }\n\n      handleUnsupported(required, keys$1);\n      var invalidKeys = filter(required, function (key) {\n        return !pred.validate(obj[key], key);\n      });\n\n      if (invalidKeys.length > 0) {\n        invalidTypeMessage(invalidKeys, pred.label);\n      }\n\n      return obj;\n    };\n  };\n\n  var handleExact = function (required, keys) {\n    var unsupported = filter(keys, function (key) {\n      return !contains(required, key);\n    });\n\n    if (unsupported.length > 0) {\n      unsuppMessage(unsupported);\n    }\n  };\n\n  var exactly = function (required) {\n    return base(handleExact, required);\n  };\n\n  var DragMode = exactly(['compare', 'extract', 'mutate', 'sink']);\n  var DragSink = exactly(['element', 'start', 'stop', 'destroy']);\n  var DragApi = exactly(['forceDrop', 'drop', 'move', 'delayDrop']);\n\n  var InDrag = function () {\n    var previous = Optional.none();\n\n    var reset = function () {\n      previous = Optional.none();\n    };\n\n    var update = function (mode, nu) {\n      var result = previous.map(function (old) {\n        return mode.compare(old, nu);\n      });\n      previous = Optional.some(nu);\n      return result;\n    };\n\n    var onEvent = function (event, mode) {\n      var dataOption = mode.extract(event);\n      dataOption.each(function (data) {\n        var offset = update(mode, data);\n        offset.each(function (d) {\n          events.trigger.move(d);\n        });\n      });\n    };\n\n    var events = create({\n      move: Event(['info'])\n    });\n    return {\n      onEvent: onEvent,\n      reset: reset,\n      events: events.registry\n    };\n  };\n\n  var NoDrag = function () {\n    var events = create({\n      move: Event(['info'])\n    });\n    return {\n      onEvent: noop,\n      reset: noop,\n      events: events.registry\n    };\n  };\n\n  var Movement = function () {\n    var noDragState = NoDrag();\n    var inDragState = InDrag();\n    var dragState = noDragState;\n\n    var on = function () {\n      dragState.reset();\n      dragState = inDragState;\n    };\n\n    var off = function () {\n      dragState.reset();\n      dragState = noDragState;\n    };\n\n    var onEvent = function (event, mode) {\n      dragState.onEvent(event, mode);\n    };\n\n    var isOn = function () {\n      return dragState === inDragState;\n    };\n\n    return {\n      on: on,\n      off: off,\n      isOn: isOn,\n      onEvent: onEvent,\n      events: inDragState.events\n    };\n  };\n\n  var setup = function (mutation, mode, settings) {\n    var active = false;\n    var events = create({\n      start: Event([]),\n      stop: Event([])\n    });\n    var movement = Movement();\n\n    var drop = function () {\n      sink.stop();\n\n      if (movement.isOn()) {\n        movement.off();\n        events.trigger.stop();\n      }\n    };\n\n    var throttledDrop = last$2(drop, 200);\n\n    var go = function (parent) {\n      sink.start(parent);\n      movement.on();\n      events.trigger.start();\n    };\n\n    var mousemove = function (event) {\n      throttledDrop.cancel();\n      movement.onEvent(event, mode);\n    };\n\n    movement.events.move.bind(function (event) {\n      mode.mutate(mutation, event.info);\n    });\n\n    var on = function () {\n      active = true;\n    };\n\n    var off = function () {\n      active = false;\n    };\n\n    var runIfActive = function (f) {\n      return function () {\n        var args = [];\n\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n\n        if (active) {\n          f.apply(null, args);\n        }\n      };\n    };\n\n    var sink = mode.sink(DragApi({\n      forceDrop: drop,\n      drop: runIfActive(drop),\n      move: runIfActive(mousemove),\n      delayDrop: runIfActive(throttledDrop.throttle)\n    }), settings);\n\n    var destroy = function () {\n      sink.destroy();\n    };\n\n    return {\n      element: sink.element,\n      go: go,\n      on: on,\n      off: off,\n      destroy: destroy,\n      events: events.registry\n    };\n  };\n\n  var mkEvent = function (target, x, y, stop, prevent, kill, raw) {\n    return {\n      target: target,\n      x: x,\n      y: y,\n      stop: stop,\n      prevent: prevent,\n      kill: kill,\n      raw: raw\n    };\n  };\n\n  var fromRawEvent = function (rawEvent) {\n    var target = SugarElement.fromDom(getOriginalEventTarget(rawEvent).getOr(rawEvent.target));\n\n    var stop = function () {\n      return rawEvent.stopPropagation();\n    };\n\n    var prevent = function () {\n      return rawEvent.preventDefault();\n    };\n\n    var kill = compose(prevent, stop);\n    return mkEvent(target, rawEvent.clientX, rawEvent.clientY, stop, prevent, kill, rawEvent);\n  };\n\n  var handle = function (filter, handler) {\n    return function (rawEvent) {\n      if (filter(rawEvent)) {\n        handler(fromRawEvent(rawEvent));\n      }\n    };\n  };\n\n  var binder = function (element, event, filter, handler, useCapture) {\n    var wrapped = handle(filter, handler);\n    element.dom.addEventListener(event, wrapped, useCapture);\n    return {\n      unbind: curry(unbind, element, event, wrapped, useCapture)\n    };\n  };\n\n  var bind$1 = function (element, event, filter, handler) {\n    return binder(element, event, filter, handler, false);\n  };\n\n  var unbind = function (element, event, handler, useCapture) {\n    element.dom.removeEventListener(event, handler, useCapture);\n  };\n\n  var filter$2 = always;\n\n  var bind$2 = function (element, event, handler) {\n    return bind$1(element, event, filter$2, handler);\n  };\n\n  var fromRawEvent$1 = fromRawEvent;\n\n  var read = function (element, attr) {\n    var value = get$2(element, attr);\n    return value === undefined || value === '' ? [] : value.split(' ');\n  };\n\n  var add$1 = function (element, attr, id) {\n    var old = read(element, attr);\n    var nu = old.concat([id]);\n    set(element, attr, nu.join(' '));\n    return true;\n  };\n\n  var remove$3 = function (element, attr, id) {\n    var nu = filter(read(element, attr), function (v) {\n      return v !== id;\n    });\n\n    if (nu.length > 0) {\n      set(element, attr, nu.join(' '));\n    } else {\n      remove(element, attr);\n    }\n\n    return false;\n  };\n\n  var supports = function (element) {\n    return element.dom.classList !== undefined;\n  };\n\n  var get$8 = function (element) {\n    return read(element, 'class');\n  };\n\n  var add$2 = function (element, clazz) {\n    return add$1(element, 'class', clazz);\n  };\n\n  var remove$4 = function (element, clazz) {\n    return remove$3(element, 'class', clazz);\n  };\n\n  var add$3 = function (element, clazz) {\n    if (supports(element)) {\n      element.dom.classList.add(clazz);\n    } else {\n      add$2(element, clazz);\n    }\n  };\n\n  var cleanClass = function (element) {\n    var classList = supports(element) ? element.dom.classList : get$8(element);\n\n    if (classList.length === 0) {\n      remove(element, 'class');\n    }\n  };\n\n  var remove$5 = function (element, clazz) {\n    if (supports(element)) {\n      var classList = element.dom.classList;\n      classList.remove(clazz);\n    } else {\n      remove$4(element, clazz);\n    }\n\n    cleanClass(element);\n  };\n\n  var has$1 = function (element, clazz) {\n    return supports(element) && element.dom.classList.contains(clazz);\n  };\n\n  var css = function (namespace) {\n    var dashNamespace = namespace.replace(/\\./g, '-');\n\n    var resolve = function (str) {\n      return dashNamespace + '-' + str;\n    };\n\n    return {\n      resolve: resolve\n    };\n  };\n\n  var styles = css('ephox-dragster');\n  var resolve = styles.resolve;\n\n  var Blocker = function (options) {\n    var settings = __assign({\n      layerClass: resolve('blocker')\n    }, options);\n\n    var div = SugarElement.fromTag('div');\n    set(div, 'role', 'presentation');\n    setAll$1(div, {\n      position: 'fixed',\n      left: '0px',\n      top: '0px',\n      width: '100%',\n      height: '100%'\n    });\n    add$3(div, resolve('blocker'));\n    add$3(div, settings.layerClass);\n\n    var element = function () {\n      return div;\n    };\n\n    var destroy = function () {\n      remove$2(div);\n    };\n\n    return {\n      element: element,\n      destroy: destroy\n    };\n  };\n\n  var compare = function (old, nu) {\n    return SugarPosition(nu.left - old.left, nu.top - old.top);\n  };\n\n  var extract$1 = function (event) {\n    return Optional.some(SugarPosition(event.x, event.y));\n  };\n\n  var mutate = function (mutation, info) {\n    mutation.mutate(info.left, info.top);\n  };\n\n  var sink = function (dragApi, settings) {\n    var blocker = Blocker(settings);\n    var mdown = bind$2(blocker.element(), 'mousedown', dragApi.forceDrop);\n    var mup = bind$2(blocker.element(), 'mouseup', dragApi.drop);\n    var mmove = bind$2(blocker.element(), 'mousemove', dragApi.move);\n    var mout = bind$2(blocker.element(), 'mouseout', dragApi.delayDrop);\n\n    var destroy = function () {\n      blocker.destroy();\n      mup.unbind();\n      mmove.unbind();\n      mout.unbind();\n      mdown.unbind();\n    };\n\n    var start = function (parent) {\n      append(parent, blocker.element());\n    };\n\n    var stop = function () {\n      remove$2(blocker.element());\n    };\n\n    return DragSink({\n      element: blocker.element,\n      start: start,\n      stop: stop,\n      destroy: destroy\n    });\n  };\n\n  var MouseDrag = DragMode({\n    compare: compare,\n    extract: extract$1,\n    sink: sink,\n    mutate: mutate\n  });\n\n  var transform = function (mutation, settings) {\n    if (settings === void 0) {\n      settings = {};\n    }\n\n    var mode = settings.mode !== undefined ? settings.mode : MouseDrag;\n    return setup(mutation, mode, settings);\n  };\n\n  var isContentEditableTrue = function (elm) {\n    return get$2(elm, 'contenteditable') === 'true';\n  };\n\n  var findClosestContentEditable = function (target, isRoot) {\n    return closest$1(target, '[contenteditable]', isRoot);\n  };\n\n  var styles$1 = css('ephox-snooker');\n  var resolve$1 = styles$1.resolve;\n\n  var Mutation = function () {\n    var events = create({\n      drag: Event(['xDelta', 'yDelta'])\n    });\n\n    var mutate = function (x, y) {\n      events.trigger.drag(x, y);\n    };\n\n    return {\n      mutate: mutate,\n      events: events.registry\n    };\n  };\n\n  var BarMutation = function () {\n    var events = create({\n      drag: Event(['xDelta', 'yDelta', 'target'])\n    });\n    var target = Optional.none();\n    var delegate = Mutation();\n    delegate.events.drag.bind(function (event) {\n      target.each(function (t) {\n        events.trigger.drag(event.xDelta, event.yDelta, t);\n      });\n    });\n\n    var assign = function (t) {\n      target = Optional.some(t);\n    };\n\n    var get = function () {\n      return target;\n    };\n\n    return {\n      assign: assign,\n      get: get,\n      mutate: delegate.mutate,\n      events: events.registry\n    };\n  };\n\n  var col = function (column, x, y, w, h) {\n    var bar = SugarElement.fromTag('div');\n    setAll$1(bar, {\n      position: 'absolute',\n      left: x - w / 2 + 'px',\n      top: y + 'px',\n      height: h + 'px',\n      width: w + 'px'\n    });\n    setAll(bar, {\n      'data-column': column,\n      'role': 'presentation'\n    });\n    return bar;\n  };\n\n  var row = function (r, x, y, w, h) {\n    var bar = SugarElement.fromTag('div');\n    setAll$1(bar, {\n      position: 'absolute',\n      left: x + 'px',\n      top: y - h / 2 + 'px',\n      height: h + 'px',\n      width: w + 'px'\n    });\n    setAll(bar, {\n      'data-row': r,\n      'role': 'presentation'\n    });\n    return bar;\n  };\n\n  var resizeBar = resolve$1('resizer-bar');\n  var resizeRowBar = resolve$1('resizer-rows');\n  var resizeColBar = resolve$1('resizer-cols');\n  var BAR_THICKNESS = 7;\n\n  var resizableRows = function (warehouse, isResizable) {\n    return bind(warehouse.all, function (row, i) {\n      return isResizable(row.element) ? [i] : [];\n    });\n  };\n\n  var resizableColumns = function (warehouse, isResizable) {\n    var resizableCols = [];\n    range(warehouse.grid.columns, function (index) {\n      var colElmOpt = Warehouse.getColumnAt(warehouse, index).map(function (col) {\n        return col.element;\n      });\n\n      if (colElmOpt.forall(isResizable)) {\n        resizableCols.push(index);\n      }\n    });\n    return filter(resizableCols, function (colIndex) {\n      var columnCells = Warehouse.filterItems(warehouse, function (cell) {\n        return cell.column === colIndex;\n      });\n      return forall(columnCells, function (cell) {\n        return isResizable(cell.element);\n      });\n    });\n  };\n\n  var destroy = function (wire) {\n    var previous = descendants$1(wire.parent(), '.' + resizeBar);\n    each(previous, remove$2);\n  };\n\n  var drawBar = function (wire, positions, create) {\n    var origin = wire.origin();\n    each(positions, function (cpOption) {\n      cpOption.each(function (cp) {\n        var bar = create(origin, cp);\n        add$3(bar, resizeBar);\n        append(wire.parent(), bar);\n      });\n    });\n  };\n\n  var refreshCol = function (wire, colPositions, position, tableHeight) {\n    drawBar(wire, colPositions, function (origin, cp) {\n      var colBar = col(cp.col, cp.x - origin.left, position.top - origin.top, BAR_THICKNESS, tableHeight);\n      add$3(colBar, resizeColBar);\n      return colBar;\n    });\n  };\n\n  var refreshRow = function (wire, rowPositions, position, tableWidth) {\n    drawBar(wire, rowPositions, function (origin, cp) {\n      var rowBar = row(cp.row, position.left - origin.left, cp.y - origin.top, tableWidth, BAR_THICKNESS);\n      add$3(rowBar, resizeRowBar);\n      return rowBar;\n    });\n  };\n\n  var refreshGrid = function (warhouse, wire, table, rows, cols) {\n    var position = absolute(table);\n    var isResizable = wire.isResizable;\n    var rowPositions = rows.length > 0 ? height.positions(rows, table) : [];\n    var resizableRowBars = rowPositions.length > 0 ? resizableRows(warhouse, isResizable) : [];\n    var resizableRowPositions = filter(rowPositions, function (_pos, i) {\n      return exists(resizableRowBars, function (barIndex) {\n        return i === barIndex;\n      });\n    });\n    refreshRow(wire, resizableRowPositions, position, getOuter(table));\n    var colPositions = cols.length > 0 ? width.positions(cols, table) : [];\n    var resizableColBars = colPositions.length > 0 ? resizableColumns(warhouse, isResizable) : [];\n    var resizableColPositions = filter(colPositions, function (_pos, i) {\n      return exists(resizableColBars, function (barIndex) {\n        return i === barIndex;\n      });\n    });\n    refreshCol(wire, resizableColPositions, position, getOuter$1(table));\n  };\n\n  var refresh = function (wire, table) {\n    destroy(wire);\n\n    if (wire.isResizable(table)) {\n      var warehouse = Warehouse.fromTable(table);\n      var rows = rows$1(warehouse);\n      var cols = columns$1(warehouse);\n      refreshGrid(warehouse, wire, table, rows, cols);\n    }\n  };\n\n  var each$2 = function (wire, f) {\n    var bars = descendants$1(wire.parent(), '.' + resizeBar);\n    each(bars, f);\n  };\n\n  var hide = function (wire) {\n    each$2(wire, function (bar) {\n      set$1(bar, 'display', 'none');\n    });\n  };\n\n  var show = function (wire) {\n    each$2(wire, function (bar) {\n      set$1(bar, 'display', 'block');\n    });\n  };\n\n  var isRowBar = function (element) {\n    return has$1(element, resizeRowBar);\n  };\n\n  var isColBar = function (element) {\n    return has$1(element, resizeColBar);\n  };\n\n  var resizeBarDragging = resolve$1('resizer-bar-dragging');\n\n  var BarManager = function (wire) {\n    var mutation = BarMutation();\n    var resizing = transform(mutation, {});\n    var hoverTable = Optional.none();\n\n    var getResizer = function (element, type) {\n      return Optional.from(get$2(element, type));\n    };\n\n    mutation.events.drag.bind(function (event) {\n      getResizer(event.target, 'data-row').each(function (_dataRow) {\n        var currentRow = getCssValue(event.target, 'top');\n        set$1(event.target, 'top', currentRow + event.yDelta + 'px');\n      });\n      getResizer(event.target, 'data-column').each(function (_dataCol) {\n        var currentCol = getCssValue(event.target, 'left');\n        set$1(event.target, 'left', currentCol + event.xDelta + 'px');\n      });\n    });\n\n    var getDelta = function (target, dir) {\n      var newX = getCssValue(target, dir);\n      var oldX = getAttrValue(target, 'data-initial-' + dir, 0);\n      return newX - oldX;\n    };\n\n    resizing.events.stop.bind(function () {\n      mutation.get().each(function (target) {\n        hoverTable.each(function (table) {\n          getResizer(target, 'data-row').each(function (row) {\n            var delta = getDelta(target, 'top');\n            remove(target, 'data-initial-top');\n            events.trigger.adjustHeight(table, delta, parseInt(row, 10));\n          });\n          getResizer(target, 'data-column').each(function (column) {\n            var delta = getDelta(target, 'left');\n            remove(target, 'data-initial-left');\n            events.trigger.adjustWidth(table, delta, parseInt(column, 10));\n          });\n          refresh(wire, table);\n        });\n      });\n    });\n\n    var handler = function (target, dir) {\n      events.trigger.startAdjust();\n      mutation.assign(target);\n      set(target, 'data-initial-' + dir, getCssValue(target, dir));\n      add$3(target, resizeBarDragging);\n      set$1(target, 'opacity', '0.2');\n      resizing.go(wire.parent());\n    };\n\n    var mousedown = bind$2(wire.parent(), 'mousedown', function (event) {\n      if (isRowBar(event.target)) {\n        handler(event.target, 'top');\n      }\n\n      if (isColBar(event.target)) {\n        handler(event.target, 'left');\n      }\n    });\n\n    var isRoot = function (e) {\n      return eq$1(e, wire.view());\n    };\n\n    var findClosestEditableTable = function (target) {\n      return closest$1(target, 'table', isRoot).filter(function (table) {\n        return findClosestContentEditable(table, isRoot).exists(isContentEditableTrue);\n      });\n    };\n\n    var mouseover = bind$2(wire.view(), 'mouseover', function (event) {\n      findClosestEditableTable(event.target).fold(function () {\n        if (inBody(event.target)) {\n          destroy(wire);\n        }\n      }, function (table) {\n        hoverTable = Optional.some(table);\n        refresh(wire, table);\n      });\n    });\n\n    var destroy$1 = function () {\n      mousedown.unbind();\n      mouseover.unbind();\n      resizing.destroy();\n      destroy(wire);\n    };\n\n    var refresh$1 = function (tbl) {\n      refresh(wire, tbl);\n    };\n\n    var events = create({\n      adjustHeight: Event(['table', 'delta', 'row']),\n      adjustWidth: Event(['table', 'delta', 'column']),\n      startAdjust: Event([])\n    });\n    return {\n      destroy: destroy$1,\n      refresh: refresh$1,\n      on: resizing.on,\n      off: resizing.off,\n      hideBars: curry(hide, wire),\n      showBars: curry(show, wire),\n      events: events.registry\n    };\n  };\n\n  var create$1 = function (wire, resizing, lazySizing) {\n    var hdirection = height;\n    var vdirection = width;\n    var manager = BarManager(wire);\n    var events = create({\n      beforeResize: Event(['table', 'type']),\n      afterResize: Event(['table', 'type']),\n      startDrag: Event([])\n    });\n    manager.events.adjustHeight.bind(function (event) {\n      var table = event.table;\n      events.trigger.beforeResize(table, 'row');\n      var delta = hdirection.delta(event.delta, table);\n      adjustHeight(table, delta, event.row, hdirection);\n      events.trigger.afterResize(table, 'row');\n    });\n    manager.events.startAdjust.bind(function (_event) {\n      events.trigger.startDrag();\n    });\n    manager.events.adjustWidth.bind(function (event) {\n      var table = event.table;\n      events.trigger.beforeResize(table, 'col');\n      var delta = vdirection.delta(event.delta, table);\n      var tableSize = lazySizing(table);\n      adjustWidth(table, delta, event.column, resizing, tableSize);\n      events.trigger.afterResize(table, 'col');\n    });\n    return {\n      on: manager.on,\n      off: manager.off,\n      hideBars: manager.hideBars,\n      showBars: manager.showBars,\n      destroy: manager.destroy,\n      events: events.registry\n    };\n  };\n\n  var TableResize = {\n    create: create$1\n  };\n\n  var fireNewRow = function (editor, row) {\n    return editor.fire('newrow', {\n      node: row\n    });\n  };\n\n  var fireNewCell = function (editor, cell) {\n    return editor.fire('newcell', {\n      node: cell\n    });\n  };\n\n  var fireObjectResizeStart = function (editor, target, width, height, origin) {\n    editor.fire('ObjectResizeStart', {\n      target: target,\n      width: width,\n      height: height,\n      origin: origin\n    });\n  };\n\n  var fireObjectResized = function (editor, target, width, height, origin) {\n    editor.fire('ObjectResized', {\n      target: target,\n      width: width,\n      height: height,\n      origin: origin\n    });\n  };\n\n  var fireTableSelectionChange = function (editor, cells, start, finish, otherCells) {\n    editor.fire('TableSelectionChange', {\n      cells: cells,\n      start: start,\n      finish: finish,\n      otherCells: otherCells\n    });\n  };\n\n  var fireTableSelectionClear = function (editor) {\n    editor.fire('TableSelectionClear');\n  };\n\n  var fireTableModified = function (editor, table, data) {\n    editor.fire('TableModified', __assign(__assign({}, data), {\n      table: table\n    }));\n  };\n\n  var styleModified = {\n    structure: false,\n    style: true\n  };\n  var structureModified = {\n    structure: true,\n    style: false\n  };\n  var defaultTableToolbar = 'tableprops tabledelete | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol';\n  var defaultStyles = {\n    'border-collapse': 'collapse',\n    'width': '100%'\n  };\n\n  var determineDefaultStyles = function (editor) {\n    if (isPixelsForced(editor)) {\n      var editorWidth = editor.getBody().offsetWidth;\n      return __assign(__assign({}, defaultStyles), {\n        width: editorWidth + 'px'\n      });\n    } else if (isResponsiveForced(editor)) {\n      return filter$1(defaultStyles, function (_value, key) {\n        return key !== 'width';\n      });\n    } else {\n      return defaultStyles;\n    }\n  };\n\n  var defaultAttributes = {\n    border: '1'\n  };\n  var defaultColumnResizingBehaviour = 'preservetable';\n\n  var getTableSizingMode = function (editor) {\n    return editor.getParam('table_sizing_mode', 'auto');\n  };\n\n  var getTableResponseWidth = function (editor) {\n    return editor.getParam('table_responsive_width');\n  };\n\n  var getDefaultAttributes = function (editor) {\n    return editor.getParam('table_default_attributes', defaultAttributes, 'object');\n  };\n\n  var getDefaultStyles = function (editor) {\n    return editor.getParam('table_default_styles', determineDefaultStyles(editor), 'object');\n  };\n\n  var hasTableResizeBars = function (editor) {\n    return editor.getParam('table_resize_bars', true, 'boolean');\n  };\n\n  var hasTabNavigation = function (editor) {\n    return editor.getParam('table_tab_navigation', true, 'boolean');\n  };\n\n  var hasAdvancedCellTab = function (editor) {\n    return editor.getParam('table_cell_advtab', true, 'boolean');\n  };\n\n  var hasAdvancedRowTab = function (editor) {\n    return editor.getParam('table_row_advtab', true, 'boolean');\n  };\n\n  var hasAdvancedTableTab = function (editor) {\n    return editor.getParam('table_advtab', true, 'boolean');\n  };\n\n  var hasAppearanceOptions = function (editor) {\n    return editor.getParam('table_appearance_options', true, 'boolean');\n  };\n\n  var hasTableGrid = function (editor) {\n    return editor.getParam('table_grid', true, 'boolean');\n  };\n\n  var shouldStyleWithCss = function (editor) {\n    return editor.getParam('table_style_by_css', false, 'boolean');\n  };\n\n  var getCellClassList = function (editor) {\n    return editor.getParam('table_cell_class_list', [], 'array');\n  };\n\n  var getRowClassList = function (editor) {\n    return editor.getParam('table_row_class_list', [], 'array');\n  };\n\n  var getTableClassList = function (editor) {\n    return editor.getParam('table_class_list', [], 'array');\n  };\n\n  var isPercentagesForced = function (editor) {\n    return getTableSizingMode(editor) === 'relative' || getTableResponseWidth(editor) === true;\n  };\n\n  var isPixelsForced = function (editor) {\n    return getTableSizingMode(editor) === 'fixed' || getTableResponseWidth(editor) === false;\n  };\n\n  var isResponsiveForced = function (editor) {\n    return getTableSizingMode(editor) === 'responsive';\n  };\n\n  var getToolbar = function (editor) {\n    return editor.getParam('table_toolbar', defaultTableToolbar);\n  };\n\n  var useColumnGroup = function (editor) {\n    return editor.getParam('table_use_colgroups', false, 'boolean');\n  };\n\n  var getTableHeaderType = function (editor) {\n    var defaultValue = 'section';\n    var value = editor.getParam('table_header_type', defaultValue, 'string');\n    var validValues = ['section', 'cells', 'sectionCells', 'auto'];\n\n    if (!contains(validValues, value)) {\n      return defaultValue;\n    } else {\n      return value;\n    }\n  };\n\n  var getColumnResizingBehaviour = function (editor) {\n    var validModes = ['preservetable', 'resizetable'];\n    var givenMode = editor.getParam('table_column_resizing', defaultColumnResizingBehaviour, 'string');\n    return find(validModes, function (mode) {\n      return mode === givenMode;\n    }).getOr(defaultColumnResizingBehaviour);\n  };\n\n  var isPreserveTableColumnResizing = function (editor) {\n    return getColumnResizingBehaviour(editor) === 'preservetable';\n  };\n\n  var isResizeTableColumnResizing = function (editor) {\n    return getColumnResizingBehaviour(editor) === 'resizetable';\n  };\n\n  var getCloneElements = function (editor) {\n    var cloneElements = editor.getParam('table_clone_elements');\n\n    if (isString(cloneElements)) {\n      return Optional.some(cloneElements.split(/[ ,]/));\n    } else if (Array.isArray(cloneElements)) {\n      return Optional.some(cloneElements);\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var hasObjectResizing = function (editor) {\n    var objectResizing = editor.getParam('object_resizing', true);\n    return isString(objectResizing) ? objectResizing === 'table' : objectResizing;\n  };\n\n  var get$9 = function (editor, table) {\n    if (isPercentagesForced(editor)) {\n      var width = getRawWidth$1(editor, table.dom).filter(isPercentage).getOrThunk(function () {\n        return getPercentTableWidth$1(table);\n      });\n      return TableSize.percentageSize(width, table);\n    } else if (isPixelsForced(editor)) {\n      return TableSize.pixelSize(get$5(table), table);\n    } else {\n      return TableSize.getTableSize(table);\n    }\n  };\n\n  var cleanupLegacyAttributes = function (element) {\n    remove(element, 'width');\n  };\n\n  var convertToPercentSize = function (table, tableSize) {\n    var newWidth = getPercentTableWidth(table);\n    redistribute$1(table, Optional.some(newWidth), Optional.none(), tableSize);\n    cleanupLegacyAttributes(table);\n  };\n\n  var convertToPixelSize = function (table, tableSize) {\n    var newWidth = getPixelTableWidth(table);\n    redistribute$1(table, Optional.some(newWidth), Optional.none(), tableSize);\n    cleanupLegacyAttributes(table);\n  };\n\n  var convertToNoneSize = function (table) {\n    remove$1(table, 'width');\n    var columns$1 = columns(table);\n    var rowElements = columns$1.length > 0 ? columns$1 : cells(table);\n    each(rowElements, function (cell) {\n      remove$1(cell, 'width');\n      cleanupLegacyAttributes(cell);\n    });\n    cleanupLegacyAttributes(table);\n  };\n\n  var enforcePercentage = function (editor, table) {\n    var tableSizing = get$9(editor, table);\n    convertToPercentSize(table, tableSizing);\n  };\n\n  var enforcePixels = function (editor, table) {\n    var tableSizing = get$9(editor, table);\n    convertToPixelSize(table, tableSizing);\n  };\n\n  var enforceNone = convertToNoneSize;\n\n  var syncPixels = function (table) {\n    var warehouse = Warehouse.fromTable(table);\n\n    if (!Warehouse.hasColumns(warehouse)) {\n      each(cells(table), function (cell) {\n        var computedWidth = get$3(cell, 'width');\n        set$1(cell, 'width', computedWidth);\n        remove(cell, 'width');\n      });\n    }\n  };\n\n  var createContainer = function () {\n    var container = SugarElement.fromTag('div');\n    setAll$1(container, {\n      position: 'static',\n      height: '0',\n      width: '0',\n      padding: '0',\n      margin: '0',\n      border: '0'\n    });\n    append(body(), container);\n    return container;\n  };\n\n  var get$a = function (editor, isResizable) {\n    return editor.inline ? ResizeWire.body(getBody$1(editor), createContainer(), isResizable) : ResizeWire.only(SugarElement.fromDom(editor.getDoc()), isResizable);\n  };\n\n  var remove$6 = function (editor, wire) {\n    if (editor.inline) {\n      remove$2(wire.parent());\n    }\n  };\n\n  var barResizerPrefix = 'bar-';\n\n  var isResizable = function (elm) {\n    return get$2(elm, 'data-mce-resize') !== 'false';\n  };\n\n  var getResizeHandler = function (editor) {\n    var selectionRng = Optional.none();\n    var resize = Optional.none();\n    var wire = Optional.none();\n    var startW;\n    var startRawW;\n\n    var isTable = function (elm) {\n      return elm.nodeName === 'TABLE';\n    };\n\n    var lazyResize = function () {\n      return resize;\n    };\n\n    var lazyWire = function () {\n      return wire.getOr(ResizeWire.only(SugarElement.fromDom(editor.getBody()), isResizable));\n    };\n\n    var lazySizing = function (table) {\n      return get$9(editor, table);\n    };\n\n    var lazyResizingBehaviour = function () {\n      return isPreserveTableColumnResizing(editor) ? preserveTable() : resizeTable();\n    };\n\n    var getNumColumns = function (table) {\n      return getGridSize(table).columns;\n    };\n\n    var afterCornerResize = function (table, origin, width) {\n      var isRightEdgeResize = endsWith(origin, 'e');\n\n      if (startRawW === '') {\n        enforcePercentage(editor, table);\n      }\n\n      if (width !== startW && startRawW !== '') {\n        set$1(table, 'width', startRawW);\n        var resizing = lazyResizingBehaviour();\n        var tableSize = lazySizing(table);\n        var col = isPreserveTableColumnResizing(editor) || isRightEdgeResize ? getNumColumns(table) - 1 : 0;\n        adjustWidth(table, width - startW, col, resizing, tableSize);\n      } else if (isPercentage(startRawW)) {\n        var percentW = parseFloat(startRawW.replace('%', ''));\n        var targetPercentW = width * percentW / startW;\n        set$1(table, 'width', targetPercentW + '%');\n      }\n\n      if (isPixel(startRawW)) {\n        syncPixels(table);\n      }\n    };\n\n    var destroy = function () {\n      resize.each(function (sz) {\n        sz.destroy();\n      });\n      wire.each(function (w) {\n        remove$6(editor, w);\n      });\n    };\n\n    editor.on('init', function () {\n      var rawWire = get$a(editor, isResizable);\n      wire = Optional.some(rawWire);\n\n      if (hasObjectResizing(editor) && hasTableResizeBars(editor)) {\n        var resizing = lazyResizingBehaviour();\n        var sz = TableResize.create(rawWire, resizing, lazySizing);\n        sz.on();\n        sz.events.startDrag.bind(function (_event) {\n          selectionRng = Optional.some(editor.selection.getRng());\n        });\n        sz.events.beforeResize.bind(function (event) {\n          var rawTable = event.table.dom;\n          fireObjectResizeStart(editor, rawTable, getPixelWidth$1(rawTable), getPixelHeight(rawTable), barResizerPrefix + event.type);\n        });\n        sz.events.afterResize.bind(function (event) {\n          var table = event.table;\n          var rawTable = table.dom;\n          removeDataStyle(table);\n          selectionRng.each(function (rng) {\n            editor.selection.setRng(rng);\n            editor.focus();\n          });\n          fireObjectResized(editor, rawTable, getPixelWidth$1(rawTable), getPixelHeight(rawTable), barResizerPrefix + event.type);\n          editor.undoManager.add();\n        });\n        resize = Optional.some(sz);\n      }\n    });\n    editor.on('ObjectResizeStart', function (e) {\n      var targetElm = e.target;\n\n      if (isTable(targetElm)) {\n        var table = SugarElement.fromDom(targetElm);\n        each(editor.dom.select('.mce-clonedresizable'), function (clone) {\n          editor.dom.addClass(clone, 'mce-' + getColumnResizingBehaviour(editor) + '-columns');\n        });\n\n        if (!isPixelSizing$1(table) && isPixelsForced(editor)) {\n          enforcePixels(editor, table);\n        } else if (!isPercentSizing$1(table) && isPercentagesForced(editor)) {\n          enforcePercentage(editor, table);\n        }\n\n        if (isNoneSizing$1(table) && startsWith(e.origin, barResizerPrefix)) {\n          enforcePercentage(editor, table);\n        }\n\n        startW = e.width;\n        startRawW = isResponsiveForced(editor) ? '' : getRawWidth$1(editor, targetElm).getOr('');\n      }\n    });\n    editor.on('ObjectResized', function (e) {\n      var targetElm = e.target;\n\n      if (isTable(targetElm)) {\n        var table = SugarElement.fromDom(targetElm);\n        var origin_1 = e.origin;\n\n        if (startsWith(origin_1, 'corner-')) {\n          afterCornerResize(table, origin_1, e.width);\n        }\n\n        removeDataStyle(table);\n        fireTableModified(editor, table.dom, styleModified);\n      }\n    });\n    editor.on('SwitchMode', function () {\n      lazyResize().each(function (resize) {\n        if (editor.mode.isReadOnly()) {\n          resize.hideBars();\n        } else {\n          resize.showBars();\n        }\n      });\n    });\n    return {\n      lazyResize: lazyResize,\n      lazyWire: lazyWire,\n      destroy: destroy\n    };\n  };\n\n  var point = function (element, offset) {\n    return {\n      element: element,\n      offset: offset\n    };\n  };\n\n  var scan = function (universe, element, direction) {\n    if (universe.property().isText(element) && universe.property().getText(element).trim().length === 0 || universe.property().isComment(element)) {\n      return direction(element).bind(function (elem) {\n        return scan(universe, elem, direction).orThunk(function () {\n          return Optional.some(elem);\n        });\n      });\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var toEnd = function (universe, element) {\n    if (universe.property().isText(element)) {\n      return universe.property().getText(element).length;\n    }\n\n    var children = universe.property().children(element);\n    return children.length;\n  };\n\n  var freefallRtl = function (universe, element) {\n    var candidate = scan(universe, element, universe.query().prevSibling).getOr(element);\n\n    if (universe.property().isText(candidate)) {\n      return point(candidate, toEnd(universe, candidate));\n    }\n\n    var children = universe.property().children(candidate);\n    return children.length > 0 ? freefallRtl(universe, children[children.length - 1]) : point(candidate, toEnd(universe, candidate));\n  };\n\n  var freefallRtl$1 = freefallRtl;\n  var universe$1 = DomUniverse();\n\n  var freefallRtl$2 = function (element) {\n    return freefallRtl$1(universe$1, element);\n  };\n\n  var halve = function (main, other) {\n    var colspan = getSpan(main, 'colspan');\n\n    if (colspan === 1) {\n      var width = getGenericWidth(main);\n      width.each(function (w) {\n        var newWidth = w.value / 2;\n        setGenericWidth(main, newWidth, w.unit);\n        setGenericWidth(other, newWidth, w.unit);\n      });\n    }\n  };\n\n  var setIfNot = function (element, property, value, ignore) {\n    if (value === ignore) {\n      remove(element, property);\n    } else {\n      set(element, property, value);\n    }\n  };\n\n  var insert = function (table, selector, element) {\n    last(children$2(table, selector)).fold(function () {\n      return prepend(table, element);\n    }, function (child) {\n      return after(child, element);\n    });\n  };\n\n  var generateSection = function (table, sectionName) {\n    var section = child$2(table, sectionName).getOrThunk(function () {\n      var newSection = SugarElement.fromTag(sectionName, owner(table).dom);\n\n      if (sectionName === 'thead') {\n        insert(table, 'caption,colgroup', newSection);\n      } else if (sectionName === 'colgroup') {\n        insert(table, 'caption', newSection);\n      } else {\n        append(table, newSection);\n      }\n\n      return newSection;\n    });\n    empty(section);\n    return section;\n  };\n\n  var render = function (table, grid) {\n    var newRows = [];\n    var newCells = [];\n\n    var syncRows = function (gridSection) {\n      return map(gridSection, function (row) {\n        if (row.isNew) {\n          newRows.push(row.element);\n        }\n\n        var tr = row.element;\n        empty(tr);\n        each(row.cells, function (cell) {\n          if (cell.isNew) {\n            newCells.push(cell.element);\n          }\n\n          setIfNot(cell.element, 'colspan', cell.colspan, 1);\n          setIfNot(cell.element, 'rowspan', cell.rowspan, 1);\n          append(tr, cell.element);\n        });\n        return tr;\n      });\n    };\n\n    var syncColGroup = function (gridSection) {\n      return bind(gridSection, function (colGroup) {\n        return map(colGroup.cells, function (col) {\n          setIfNot(col.element, 'span', col.colspan, 1);\n          return col.element;\n        });\n      });\n    };\n\n    var renderSection = function (gridSection, sectionName) {\n      var section = generateSection(table, sectionName);\n      var sync = sectionName === 'colgroup' ? syncColGroup : syncRows;\n      var sectionElems = sync(gridSection);\n      append$1(section, sectionElems);\n    };\n\n    var removeSection = function (sectionName) {\n      child$2(table, sectionName).each(remove$2);\n    };\n\n    var renderOrRemoveSection = function (gridSection, sectionName) {\n      if (gridSection.length > 0) {\n        renderSection(gridSection, sectionName);\n      } else {\n        removeSection(sectionName);\n      }\n    };\n\n    var headSection = [];\n    var bodySection = [];\n    var footSection = [];\n    var columnGroupsSection = [];\n    each(grid, function (row) {\n      switch (row.section) {\n        case 'thead':\n          headSection.push(row);\n          break;\n\n        case 'tbody':\n          bodySection.push(row);\n          break;\n\n        case 'tfoot':\n          footSection.push(row);\n          break;\n\n        case 'colgroup':\n          columnGroupsSection.push(row);\n          break;\n      }\n    });\n    renderOrRemoveSection(columnGroupsSection, 'colgroup');\n    renderOrRemoveSection(headSection, 'thead');\n    renderOrRemoveSection(bodySection, 'tbody');\n    renderOrRemoveSection(footSection, 'tfoot');\n    return {\n      newRows: newRows,\n      newCells: newCells\n    };\n  };\n\n  var copy$2 = function (grid) {\n    return map(grid, function (row) {\n      var tr = shallow(row.element);\n      each(row.cells, function (cell) {\n        var clonedCell = deep(cell.element);\n        setIfNot(clonedCell, 'colspan', cell.colspan, 1);\n        setIfNot(clonedCell, 'rowspan', cell.rowspan, 1);\n        append(tr, clonedCell);\n      });\n      return tr;\n    });\n  };\n\n  var getColumn = function (grid, index) {\n    return map(grid, function (row) {\n      return getCell(row, index);\n    });\n  };\n\n  var getRow = function (grid, index) {\n    return grid[index];\n  };\n\n  var findDiff = function (xs, comp) {\n    if (xs.length === 0) {\n      return 0;\n    }\n\n    var first = xs[0];\n    var index = findIndex(xs, function (x) {\n      return !comp(first.element, x.element);\n    });\n    return index.fold(function () {\n      return xs.length;\n    }, function (ind) {\n      return ind;\n    });\n  };\n\n  var subgrid = function (grid, row, column, comparator) {\n    var restOfRow = getRow(grid, row).cells.slice(column);\n    var endColIndex = findDiff(restOfRow, comparator);\n    var restOfColumn = getColumn(grid, column).slice(row);\n    var endRowIndex = findDiff(restOfColumn, comparator);\n    return {\n      colspan: endColIndex,\n      rowspan: endRowIndex\n    };\n  };\n\n  var toDetails = function (grid, comparator) {\n    var seen = map(grid, function (row) {\n      return map(row.cells, never);\n    });\n\n    var updateSeen = function (rowIndex, columnIndex, rowspan, colspan) {\n      for (var row = rowIndex; row < rowIndex + rowspan; row++) {\n        for (var column = columnIndex; column < columnIndex + colspan; column++) {\n          seen[row][column] = true;\n        }\n      }\n    };\n\n    return map(grid, function (row, rowIndex) {\n      var details = bind(row.cells, function (cell, columnIndex) {\n        if (seen[rowIndex][columnIndex] === false) {\n          var result = subgrid(grid, rowIndex, columnIndex, comparator);\n          updateSeen(rowIndex, columnIndex, result.rowspan, result.colspan);\n          return [detailnew(cell.element, result.rowspan, result.colspan, cell.isNew)];\n        } else {\n          return [];\n        }\n      });\n      return rowdetails(details, row.section);\n    });\n  };\n\n  var toGrid = function (warehouse, generators, isNew) {\n    var grid = [];\n\n    if (Warehouse.hasColumns(warehouse)) {\n      var groupElementNew = map(Warehouse.justColumns(warehouse), function (column) {\n        return elementnew(column.element, isNew, false);\n      });\n      grid.push(rowcells(groupElementNew, 'colgroup'));\n    }\n\n    for (var rowIndex = 0; rowIndex < warehouse.grid.rows; rowIndex++) {\n      var rowCells = [];\n\n      for (var columnIndex = 0; columnIndex < warehouse.grid.columns; columnIndex++) {\n        var element = Warehouse.getAt(warehouse, rowIndex, columnIndex).map(function (item) {\n          return elementnew(item.element, isNew, item.isLocked);\n        }).getOrThunk(function () {\n          return elementnew(generators.gap(), true, false);\n        });\n        rowCells.push(element);\n      }\n\n      var row = rowcells(rowCells, warehouse.all[rowIndex].section);\n      grid.push(row);\n    }\n\n    return grid;\n  };\n\n  var fromWarehouse = function (warehouse, generators) {\n    return toGrid(warehouse, generators, false);\n  };\n\n  var deriveRows = function (rendered, generators) {\n    var findRow = function (details) {\n      var rowOfCells = findMap(details, function (detail) {\n        return parent(detail.element).map(function (row) {\n          var isNew = parent(row).isNone();\n          return elementnew(row, isNew, false);\n        });\n      });\n      return rowOfCells.getOrThunk(function () {\n        return elementnew(generators.row(), true, false);\n      });\n    };\n\n    return map(rendered, function (details) {\n      var row = findRow(details.details);\n      return rowdatanew(row.element, details.details, details.section, row.isNew);\n    });\n  };\n\n  var toDetailList = function (grid, generators) {\n    var rendered = toDetails(grid, eq$1);\n    return deriveRows(rendered, generators);\n  };\n\n  var findInWarehouse = function (warehouse, element) {\n    return findMap(warehouse.all, function (r) {\n      return find(r.cells, function (e) {\n        return eq$1(element, e.element);\n      });\n    });\n  };\n\n  var extractCells = function (warehouse, target, predicate) {\n    var details = map(target.selection, function (cell$1) {\n      return cell(cell$1).bind(function (lc) {\n        return findInWarehouse(warehouse, lc);\n      }).filter(predicate);\n    });\n    var cells = cat(details);\n    return someIf(cells.length > 0, cells);\n  };\n\n  var run = function (operation, extract, adjustment, postAction, genWrappers) {\n    return function (wire, table, target, generators, sizing, resizeBehaviour) {\n      var warehouse = Warehouse.fromTable(table);\n      var output = extract(warehouse, target).map(function (info) {\n        var model = fromWarehouse(warehouse, generators);\n        var result = operation(model, info, eq$1, genWrappers(generators));\n        var lockedColumns = getLockedColumnsFromGrid(result.grid);\n        var grid = toDetailList(result.grid, generators);\n        return {\n          info: info,\n          grid: grid,\n          cursor: result.cursor,\n          lockedColumns: lockedColumns\n        };\n      });\n      return output.bind(function (out) {\n        var newElements = render(table, out.grid);\n        var tableSizing = Optional.from(sizing).getOrThunk(function () {\n          return TableSize.getTableSize(table);\n        });\n        var resizing = Optional.from(resizeBehaviour).getOrThunk(preserveTable);\n        adjustment(table, out.grid, out.info, tableSizing, resizing);\n        postAction(table);\n        refresh(wire, table);\n        remove(table, LOCKED_COL_ATTR);\n\n        if (out.lockedColumns.length > 0) {\n          set(table, LOCKED_COL_ATTR, out.lockedColumns.join(','));\n        }\n\n        return Optional.some({\n          cursor: out.cursor,\n          newRows: newElements.newRows,\n          newCells: newElements.newCells\n        });\n      });\n    };\n  };\n\n  var onCell = function (warehouse, target) {\n    return cell(target.element).bind(function (cell) {\n      return findInWarehouse(warehouse, cell);\n    });\n  };\n\n  var onPaste = function (warehouse, target) {\n    return cell(target.element).bind(function (cell) {\n      return findInWarehouse(warehouse, cell).map(function (details) {\n        var value = __assign(__assign({}, details), {\n          generators: target.generators,\n          clipboard: target.clipboard\n        });\n\n        return value;\n      });\n    });\n  };\n\n  var onPasteByEditor = function (warehouse, target) {\n    return extractCells(warehouse, target, always).map(function (cells) {\n      return {\n        cells: cells,\n        generators: target.generators,\n        clipboard: target.clipboard\n      };\n    });\n  };\n\n  var onMergable = function (_warehouse, target) {\n    return target.mergable;\n  };\n\n  var onUnmergable = function (_warehouse, target) {\n    return target.unmergable;\n  };\n\n  var onCells = function (warehouse, target) {\n    return extractCells(warehouse, target, always);\n  };\n\n  var onUnlockedCell = function (warehouse, target) {\n    return onCell(warehouse, target).filter(function (detail) {\n      return !detail.isLocked;\n    });\n  };\n\n  var onUnlockedCells = function (warehouse, target) {\n    return extractCells(warehouse, target, function (detail) {\n      return !detail.isLocked;\n    });\n  };\n\n  var isUnlockedTableCell = function (warehouse, cell) {\n    return findInWarehouse(warehouse, cell).exists(function (detail) {\n      return !detail.isLocked;\n    });\n  };\n\n  var allUnlocked = function (warehouse, cells) {\n    return forall(cells, function (cell) {\n      return isUnlockedTableCell(warehouse, cell);\n    });\n  };\n\n  var onUnlockedMergable = function (warehouse, target) {\n    return onMergable(warehouse, target).filter(function (mergeable) {\n      return allUnlocked(warehouse, mergeable.cells);\n    });\n  };\n\n  var onUnlockedUnmergable = function (warehouse, target) {\n    return onUnmergable(warehouse, target).filter(function (cells) {\n      return allUnlocked(warehouse, cells);\n    });\n  };\n\n  var merge = function (grid, bounds, comparator, substitution) {\n    var rows = extractGridDetails(grid).rows;\n\n    if (rows.length === 0) {\n      return grid;\n    }\n\n    for (var i = bounds.startRow; i <= bounds.finishRow; i++) {\n      for (var j = bounds.startCol; j <= bounds.finishCol; j++) {\n        var row = rows[i];\n        var isLocked = getCell(row, j).isLocked;\n        mutateCell(row, j, elementnew(substitution(), false, isLocked));\n      }\n    }\n\n    return grid;\n  };\n\n  var unmerge = function (grid, target, comparator, substitution) {\n    var rows = extractGridDetails(grid).rows;\n    var first = true;\n\n    for (var i = 0; i < rows.length; i++) {\n      for (var j = 0; j < cellLength(rows[0]); j++) {\n        var row = rows[i];\n        var currentCell = getCell(row, j);\n        var currentCellElm = currentCell.element;\n        var isToReplace = comparator(currentCellElm, target);\n\n        if (isToReplace === true && first === false) {\n          mutateCell(row, j, elementnew(substitution(), true, currentCell.isLocked));\n        } else if (isToReplace === true) {\n          first = false;\n        }\n      }\n    }\n\n    return grid;\n  };\n\n  var uniqueCells = function (row, comparator) {\n    return foldl(row, function (rest, cell) {\n      return exists(rest, function (currentCell) {\n        return comparator(currentCell.element, cell.element);\n      }) ? rest : rest.concat([cell]);\n    }, []);\n  };\n\n  var splitCols = function (grid, index, comparator, substitution) {\n    if (index > 0 && index < grid[0].cells.length) {\n      each(grid, function (row) {\n        var prevCell = row.cells[index - 1];\n        var current = row.cells[index];\n        var isToReplace = comparator(current.element, prevCell.element);\n\n        if (isToReplace) {\n          mutateCell(row, index, elementnew(substitution(), true, current.isLocked));\n        }\n      });\n    }\n\n    return grid;\n  };\n\n  var splitRows = function (grid, index, comparator, substitution) {\n    var rows = extractGridDetails(grid).rows;\n\n    if (index > 0 && index < rows.length) {\n      var rowPrevCells = rows[index - 1].cells;\n      var cells = uniqueCells(rowPrevCells, comparator);\n      each(cells, function (cell) {\n        var replacement = Optional.none();\n\n        for (var i = index; i < rows.length; i++) {\n          var _loop_1 = function (j) {\n            var row = rows[i];\n            var current = getCell(row, j);\n            var isToReplace = comparator(current.element, cell.element);\n\n            if (isToReplace) {\n              if (replacement.isNone()) {\n                replacement = Optional.some(substitution());\n              }\n\n              replacement.each(function (sub) {\n                mutateCell(row, j, elementnew(sub, true, current.isLocked));\n              });\n            }\n          };\n\n          for (var j = 0; j < cellLength(rows[0]); j++) {\n            _loop_1(j);\n          }\n        }\n      });\n    }\n\n    return grid;\n  };\n\n  var value = function (o) {\n    var is = function (v) {\n      return o === v;\n    };\n\n    var or = function (_opt) {\n      return value(o);\n    };\n\n    var orThunk = function (_f) {\n      return value(o);\n    };\n\n    var map = function (f) {\n      return value(f(o));\n    };\n\n    var mapError = function (_f) {\n      return value(o);\n    };\n\n    var each = function (f) {\n      f(o);\n    };\n\n    var bind = function (f) {\n      return f(o);\n    };\n\n    var fold = function (_, onValue) {\n      return onValue(o);\n    };\n\n    var exists = function (f) {\n      return f(o);\n    };\n\n    var forall = function (f) {\n      return f(o);\n    };\n\n    var toOptional = function () {\n      return Optional.some(o);\n    };\n\n    return {\n      is: is,\n      isValue: always,\n      isError: never,\n      getOr: constant(o),\n      getOrThunk: constant(o),\n      getOrDie: constant(o),\n      or: or,\n      orThunk: orThunk,\n      fold: fold,\n      map: map,\n      mapError: mapError,\n      each: each,\n      bind: bind,\n      exists: exists,\n      forall: forall,\n      toOptional: toOptional\n    };\n  };\n\n  var error = function (message) {\n    var getOrThunk = function (f) {\n      return f();\n    };\n\n    var getOrDie = function () {\n      return die(String(message))();\n    };\n\n    var or = function (opt) {\n      return opt;\n    };\n\n    var orThunk = function (f) {\n      return f();\n    };\n\n    var map = function (_f) {\n      return error(message);\n    };\n\n    var mapError = function (f) {\n      return error(f(message));\n    };\n\n    var bind = function (_f) {\n      return error(message);\n    };\n\n    var fold = function (onError, _) {\n      return onError(message);\n    };\n\n    return {\n      is: never,\n      isValue: never,\n      isError: always,\n      getOr: identity,\n      getOrThunk: getOrThunk,\n      getOrDie: getOrDie,\n      or: or,\n      orThunk: orThunk,\n      fold: fold,\n      map: map,\n      mapError: mapError,\n      each: noop,\n      bind: bind,\n      exists: never,\n      forall: always,\n      toOptional: Optional.none\n    };\n  };\n\n  var fromOption = function (opt, err) {\n    return opt.fold(function () {\n      return error(err);\n    }, value);\n  };\n\n  var Result = {\n    value: value,\n    error: error,\n    fromOption: fromOption\n  };\n\n  var measure = function (startAddress, gridA, gridB) {\n    if (startAddress.row >= gridA.length || startAddress.column > cellLength(gridA[0])) {\n      return Result.error('invalid start address out of table bounds, row: ' + startAddress.row + ', column: ' + startAddress.column);\n    }\n\n    var rowRemainder = gridA.slice(startAddress.row);\n    var colRemainder = rowRemainder[0].cells.slice(startAddress.column);\n    var colRequired = cellLength(gridB[0]);\n    var rowRequired = gridB.length;\n    return Result.value({\n      rowDelta: rowRemainder.length - rowRequired,\n      colDelta: colRemainder.length - colRequired\n    });\n  };\n\n  var measureWidth = function (gridA, gridB) {\n    var colLengthA = cellLength(gridA[0]);\n    var colLengthB = cellLength(gridB[0]);\n    return {\n      rowDelta: 0,\n      colDelta: colLengthA - colLengthB\n    };\n  };\n\n  var measureHeight = function (gridA, gridB) {\n    var rowLengthA = gridA.length;\n    var rowLengthB = gridB.length;\n    return {\n      rowDelta: rowLengthA - rowLengthB,\n      colDelta: 0\n    };\n  };\n\n  var generateElements = function (amount, row, generators, isLocked) {\n    var generator = row.section === 'colgroup' ? generators.col : generators.cell;\n    return range(amount, function (idx) {\n      return elementnew(generator(), true, isLocked(idx));\n    });\n  };\n\n  var rowFill = function (grid, amount, generators, lockedColumns) {\n    return grid.concat(range(amount, function () {\n      var row = grid[grid.length - 1];\n      var elements = generateElements(row.cells.length, row, generators, function (idx) {\n        return has(lockedColumns, idx.toString());\n      });\n      return setCells(row, elements);\n    }));\n  };\n\n  var colFill = function (grid, amount, generators, startIndex) {\n    return map(grid, function (row) {\n      var newChildren = generateElements(amount, row, generators, never);\n      return addCells(row, startIndex, newChildren);\n    });\n  };\n\n  var lockedColFill = function (grid, generators, lockedColumns) {\n    return map(grid, function (row) {\n      return foldl(lockedColumns, function (acc, colNum) {\n        var newChild = generateElements(1, row, generators, always)[0];\n        return addCell(acc, colNum, newChild);\n      }, row);\n    });\n  };\n\n  var tailor = function (gridA, delta, generators) {\n    var fillCols = delta.colDelta < 0 ? colFill : identity;\n    var fillRows = delta.rowDelta < 0 ? rowFill : identity;\n    var lockedColumns = getLockedColumnsFromGrid(gridA);\n    var gridWidth = cellLength(gridA[0]);\n    var isLastColLocked = exists(lockedColumns, function (locked) {\n      return locked === gridWidth - 1;\n    });\n    var modifiedCols = fillCols(gridA, Math.abs(delta.colDelta), generators, isLastColLocked ? gridWidth - 1 : gridWidth);\n    var newLockedColumns = getLockedColumnsFromGrid(modifiedCols);\n    return fillRows(modifiedCols, Math.abs(delta.rowDelta), generators, mapToObject(newLockedColumns, always));\n  };\n\n  var isSpanning = function (grid, row, col, comparator) {\n    var candidate = getCell(grid[row], col);\n    var matching = curry(comparator, candidate.element);\n    var currentRow = grid[row];\n    return grid.length > 1 && cellLength(currentRow) > 1 && (col > 0 && matching(getCellElement(currentRow, col - 1)) || col < currentRow.cells.length - 1 && matching(getCellElement(currentRow, col + 1)) || row > 0 && matching(getCellElement(grid[row - 1], col)) || row < grid.length - 1 && matching(getCellElement(grid[row + 1], col)));\n  };\n\n  var mergeTables = function (startAddress, gridA, gridB, generator, comparator, lockedColumns) {\n    var startRow = startAddress.row;\n    var startCol = startAddress.column;\n    var mergeHeight = gridB.length;\n    var mergeWidth = cellLength(gridB[0]);\n    var endRow = startRow + mergeHeight;\n    var endCol = startCol + mergeWidth + lockedColumns.length;\n    var lockedColumnObj = mapToObject(lockedColumns, always);\n\n    for (var r = startRow; r < endRow; r++) {\n      var skippedCol = 0;\n\n      for (var c = startCol; c < endCol; c++) {\n        if (lockedColumnObj[c]) {\n          skippedCol++;\n          continue;\n        }\n\n        if (isSpanning(gridA, r, c, comparator)) {\n          unmerge(gridA, getCellElement(gridA[r], c), comparator, generator.cell);\n        }\n\n        var gridBColIndex = c - startCol - skippedCol;\n        var newCell = getCell(gridB[r - startRow], gridBColIndex);\n        var newCellElm = newCell.element;\n        var replacement = generator.replace(newCellElm);\n        mutateCell(gridA[r], c, elementnew(replacement, true, newCell.isLocked));\n      }\n    }\n\n    return gridA;\n  };\n\n  var getValidStartAddress = function (currentStartAddress, grid, lockedColumns) {\n    var gridColLength = cellLength(grid[0]);\n    var adjustedRowAddress = extractGridDetails(grid).cols.length + currentStartAddress.row;\n    var possibleColAddresses = range(gridColLength - currentStartAddress.column, function (num) {\n      return num + currentStartAddress.column;\n    });\n    var validColAddress = find(possibleColAddresses, function (num) {\n      return forall(lockedColumns, function (col) {\n        return col !== num;\n      });\n    }).getOr(gridColLength - 1);\n    return {\n      row: adjustedRowAddress,\n      column: validColAddress\n    };\n  };\n\n  var getLockedColumnsWithinBounds = function (startAddress, grid, lockedColumns) {\n    return filter(lockedColumns, function (colNum) {\n      return colNum >= startAddress.column && colNum <= cellLength(grid[0]) + startAddress.column;\n    });\n  };\n\n  var merge$1 = function (startAddress, gridA, gridB, generator, comparator) {\n    var lockedColumns = getLockedColumnsFromGrid(gridA);\n    var validStartAddress = getValidStartAddress(startAddress, gridA, lockedColumns);\n    var gridBRows = extractGridDetails(gridB).rows;\n    var lockedColumnsWithinBounds = getLockedColumnsWithinBounds(validStartAddress, gridBRows, lockedColumns);\n    var result = measure(validStartAddress, gridA, gridBRows);\n    return result.map(function (diff) {\n      var delta = __assign(__assign({}, diff), {\n        colDelta: diff.colDelta - lockedColumnsWithinBounds.length\n      });\n\n      var fittedGrid = tailor(gridA, delta, generator);\n      var newLockedColumns = getLockedColumnsFromGrid(fittedGrid);\n      var newLockedColumnsWithinBounds = getLockedColumnsWithinBounds(validStartAddress, gridBRows, newLockedColumns);\n      return mergeTables(validStartAddress, fittedGrid, gridBRows, generator, comparator, newLockedColumnsWithinBounds);\n    });\n  };\n\n  var insertCols = function (index, gridA, gridB, generator, comparator) {\n    splitCols(gridA, index, comparator, generator.cell);\n    var delta = measureHeight(gridB, gridA);\n    var fittedNewGrid = tailor(gridB, delta, generator);\n    var secondDelta = measureHeight(gridA, fittedNewGrid);\n    var fittedOldGrid = tailor(gridA, secondDelta, generator);\n    return map(fittedOldGrid, function (gridRow, i) {\n      return addCells(gridRow, index, fittedNewGrid[i].cells);\n    });\n  };\n\n  var insertRows = function (index, gridA, gridB, generator, comparator) {\n    splitRows(gridA, index, comparator, generator.cell);\n    var locked = getLockedColumnsFromGrid(gridA);\n    var diff = measureWidth(gridA, gridB);\n\n    var delta = __assign(__assign({}, diff), {\n      colDelta: diff.colDelta - locked.length\n    });\n\n    var fittedOldGrid = tailor(gridA, delta, generator);\n\n    var _a = extractGridDetails(fittedOldGrid),\n        oldCols = _a.cols,\n        oldRows = _a.rows;\n\n    var newLocked = getLockedColumnsFromGrid(fittedOldGrid);\n    var secondDiff = measureWidth(gridB, gridA);\n\n    var secondDelta = __assign(__assign({}, secondDiff), {\n      colDelta: secondDiff.colDelta + newLocked.length\n    });\n\n    var fittedGridB = lockedColFill(gridB, generator, newLocked);\n    var fittedNewGrid = tailor(fittedGridB, secondDelta, generator);\n    return oldCols.concat(oldRows.slice(0, index)).concat(fittedNewGrid).concat(oldRows.slice(index, oldRows.length));\n  };\n\n  var insertRowAt = function (grid, index, example, comparator, substitution) {\n    var _a = extractGridDetails(grid),\n        rows = _a.rows,\n        cols = _a.cols;\n\n    var before = rows.slice(0, index);\n    var after = rows.slice(index);\n    var between = mapCells(rows[example], function (ex, c) {\n      var withinSpan = index > 0 && index < rows.length && comparator(getCellElement(rows[index - 1], c), getCellElement(rows[index], c));\n      var ret = withinSpan ? getCell(rows[index], c) : elementnew(substitution(ex.element, comparator), true, ex.isLocked);\n      return ret;\n    });\n    return cols.concat(before).concat([between]).concat(after);\n  };\n\n  var getElementFor = function (row, column, section, withinSpan, example, comparator, substitution) {\n    if (section === 'colgroup' || !withinSpan) {\n      var cell = getCell(row, example);\n      return elementnew(substitution(cell.element, comparator), true, false);\n    } else {\n      return getCell(row, column);\n    }\n  };\n\n  var insertColumnAt = function (grid, index, example, comparator, substitution) {\n    return map(grid, function (row) {\n      var withinSpan = index > 0 && index < cellLength(row) && comparator(getCellElement(row, index - 1), getCellElement(row, index));\n      var sub = getElementFor(row, index, row.section, withinSpan, example, comparator, substitution);\n      return addCell(row, index, sub);\n    });\n  };\n\n  var deleteColumnsAt = function (grid, columns) {\n    return bind(grid, function (row) {\n      var existingCells = row.cells;\n      var cells = foldr(columns, function (acc, column) {\n        return column >= 0 && column < acc.length ? acc.slice(0, column).concat(acc.slice(column + 1)) : acc;\n      }, existingCells);\n      return cells.length > 0 ? [rowcells(cells, row.section)] : [];\n    });\n  };\n\n  var deleteRowsAt = function (grid, start, finish) {\n    var _a = extractGridDetails(grid),\n        rows = _a.rows,\n        cols = _a.cols;\n\n    return cols.concat(rows.slice(0, start)).concat(rows.slice(finish + 1));\n  };\n\n  var replaceIn = function (grid, targets, comparator, substitution) {\n    var isTarget = function (cell) {\n      return exists(targets, function (target) {\n        return comparator(cell.element, target.element);\n      });\n    };\n\n    return map(grid, function (row) {\n      return mapCells(row, function (cell) {\n        return isTarget(cell) ? elementnew(substitution(cell.element, comparator), true, cell.isLocked) : cell;\n      });\n    });\n  };\n\n  var notStartRow = function (grid, rowIndex, colIndex, comparator) {\n    return getCellElement(grid[rowIndex], colIndex) !== undefined && rowIndex > 0 && comparator(getCellElement(grid[rowIndex - 1], colIndex), getCellElement(grid[rowIndex], colIndex));\n  };\n\n  var notStartColumn = function (row, index, comparator) {\n    return index > 0 && comparator(getCellElement(row, index - 1), getCellElement(row, index));\n  };\n\n  var replaceColumn = function (grid, index, comparator, substitution) {\n    var rows = extractGridDetails(grid).rows;\n    var targets = bind(rows, function (row, i) {\n      var alreadyAdded = notStartRow(grid, i, index, comparator) || notStartColumn(row, index, comparator);\n      return alreadyAdded ? [] : [getCell(row, index)];\n    });\n    return replaceIn(grid, targets, comparator, substitution);\n  };\n\n  var replaceRow = function (grid, index, comparator, substitution) {\n    var rows = extractGridDetails(grid).rows;\n    var targetRow = rows[index];\n    var targets = bind(targetRow.cells, function (item, i) {\n      var alreadyAdded = notStartRow(rows, index, i, comparator) || notStartColumn(targetRow, i, comparator);\n      return alreadyAdded ? [] : [item];\n    });\n    return replaceIn(grid, targets, comparator, substitution);\n  };\n\n  var uniqueColumns = function (details) {\n    var uniqueCheck = function (rest, detail) {\n      var columnExists = exists(rest, function (currentDetail) {\n        return currentDetail.column === detail.column;\n      });\n      return columnExists ? rest : rest.concat([detail]);\n    };\n\n    return foldl(details, uniqueCheck, []).sort(function (detailA, detailB) {\n      return detailA.column - detailB.column;\n    });\n  };\n\n  var elementToData = function (element) {\n    var colspan = getAttrValue(element, 'colspan', 1);\n    var rowspan = getAttrValue(element, 'rowspan', 1);\n    return {\n      element: element,\n      colspan: colspan,\n      rowspan: rowspan\n    };\n  };\n\n  var modification = function (generators, toData) {\n    if (toData === void 0) {\n      toData = elementToData;\n    }\n\n    var position = Cell(Optional.none());\n\n    var nu = function (data) {\n      switch (name(data.element)) {\n        case 'col':\n          return generators.col(data);\n\n        default:\n          return generators.cell(data);\n      }\n    };\n\n    var nuFrom = function (element) {\n      var data = toData(element);\n      return nu(data);\n    };\n\n    var add = function (element) {\n      var replacement = nuFrom(element);\n\n      if (position.get().isNone()) {\n        position.set(Optional.some(replacement));\n      }\n\n      recent = Optional.some({\n        item: element,\n        replacement: replacement\n      });\n      return replacement;\n    };\n\n    var recent = Optional.none();\n\n    var getOrInit = function (element, comparator) {\n      return recent.fold(function () {\n        return add(element);\n      }, function (p) {\n        return comparator(element, p.item) ? p.replacement : add(element);\n      });\n    };\n\n    return {\n      getOrInit: getOrInit,\n      cursor: position.get\n    };\n  };\n\n  var transform$1 = function (scope, tag) {\n    return function (generators) {\n      var position = Cell(Optional.none());\n      var list = [];\n\n      var find$1 = function (element, comparator) {\n        return find(list, function (x) {\n          return comparator(x.item, element);\n        });\n      };\n\n      var makeNew = function (element) {\n        var attrs = {\n          scope: scope\n        };\n        var cell = generators.replace(element, tag, attrs);\n        list.push({\n          item: element,\n          sub: cell\n        });\n\n        if (position.get().isNone()) {\n          position.set(Optional.some(cell));\n        }\n\n        return cell;\n      };\n\n      var replaceOrInit = function (element, comparator) {\n        if (name(element) === 'col') {\n          return element;\n        } else {\n          return find$1(element, comparator).fold(function () {\n            return makeNew(element);\n          }, function (p) {\n            return comparator(element, p.item) ? p.sub : makeNew(element);\n          });\n        }\n      };\n\n      return {\n        replaceOrInit: replaceOrInit,\n        cursor: position.get\n      };\n    };\n  };\n\n  var getScopeAttribute = function (cell) {\n    return getOpt(cell, 'scope').map(function (attribute) {\n      return attribute.substr(0, 3);\n    });\n  };\n\n  var merging = function (generators) {\n    var position = Cell(Optional.none());\n\n    var unmerge = function (cell) {\n      if (position.get().isNone()) {\n        position.set(Optional.some(cell));\n      }\n\n      var scope = getScopeAttribute(cell);\n      scope.each(function (attribute) {\n        return set(cell, 'scope', attribute);\n      });\n      return function () {\n        var raw = generators.cell({\n          element: cell,\n          colspan: 1,\n          rowspan: 1\n        });\n        remove$1(raw, 'width');\n        remove$1(cell, 'width');\n        scope.each(function (attribute) {\n          return set(raw, 'scope', attribute);\n        });\n        return raw;\n      };\n    };\n\n    var merge = function (cells) {\n      var getScopeProperty = function () {\n        var stringAttributes = cat(map(cells, getScopeAttribute));\n\n        if (stringAttributes.length === 0) {\n          return Optional.none();\n        } else {\n          var baseScope_1 = stringAttributes[0];\n          var scopes_1 = ['row', 'col'];\n          var isMixed = exists(stringAttributes, function (attribute) {\n            return attribute !== baseScope_1 && contains(scopes_1, attribute);\n          });\n          return isMixed ? Optional.none() : Optional.from(baseScope_1);\n        }\n      };\n\n      remove$1(cells[0], 'width');\n      getScopeProperty().fold(function () {\n        return remove(cells[0], 'scope');\n      }, function (attribute) {\n        return set(cells[0], 'scope', attribute + 'group');\n      });\n      return constant(cells[0]);\n    };\n\n    return {\n      unmerge: unmerge,\n      merge: merge,\n      cursor: position.get\n    };\n  };\n\n  var Generators = {\n    modification: modification,\n    transform: transform$1,\n    merging: merging\n  };\n  var blockList = ['body', 'p', 'div', 'article', 'aside', 'figcaption', 'figure', 'footer', 'header', 'nav', 'section', 'ol', 'ul', 'table', 'thead', 'tfoot', 'tbody', 'caption', 'tr', 'td', 'th', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre', 'address'];\n\n  var isList = function (universe, item) {\n    var tagName = universe.property().name(item);\n    return contains(['ol', 'ul'], tagName);\n  };\n\n  var isBlock = function (universe, item) {\n    var tagName = universe.property().name(item);\n    return contains(blockList, tagName);\n  };\n\n  var isEmptyTag = function (universe, item) {\n    return contains(['br', 'img', 'hr', 'input'], universe.property().name(item));\n  };\n\n  var universe$2 = DomUniverse();\n\n  var isBlock$1 = function (element) {\n    return isBlock(universe$2, element);\n  };\n\n  var isList$1 = function (element) {\n    return isList(universe$2, element);\n  };\n\n  var isEmptyTag$1 = function (element) {\n    return isEmptyTag(universe$2, element);\n  };\n\n  var merge$2 = function (cells) {\n    var isBr = function (el) {\n      return name(el) === 'br';\n    };\n\n    var advancedBr = function (children) {\n      return forall(children, function (c) {\n        return isBr(c) || isText(c) && get$4(c).trim().length === 0;\n      });\n    };\n\n    var isListItem = function (el) {\n      return name(el) === 'li' || ancestor(el, isList$1).isSome();\n    };\n\n    var siblingIsBlock = function (el) {\n      return nextSibling(el).map(function (rightSibling) {\n        if (isBlock$1(rightSibling)) {\n          return true;\n        }\n\n        if (isEmptyTag$1(rightSibling)) {\n          return name(rightSibling) === 'img' ? false : true;\n        }\n\n        return false;\n      }).getOr(false);\n    };\n\n    var markCell = function (cell) {\n      return last$1(cell).bind(function (rightEdge) {\n        var rightSiblingIsBlock = siblingIsBlock(rightEdge);\n        return parent(rightEdge).map(function (parent) {\n          return rightSiblingIsBlock === true || isListItem(parent) || isBr(rightEdge) || isBlock$1(parent) && !eq$1(cell, parent) ? [] : [SugarElement.fromTag('br')];\n        });\n      }).getOr([]);\n    };\n\n    var markContent = function () {\n      var content = bind(cells, function (cell) {\n        var children$1 = children(cell);\n        return advancedBr(children$1) ? [] : children$1.concat(markCell(cell));\n      });\n      return content.length === 0 ? [SugarElement.fromTag('br')] : content;\n    };\n\n    var contents = markContent();\n    empty(cells[0]);\n    append$1(cells[0], contents);\n  };\n\n  var prune = function (table) {\n    var cells$1 = cells(table);\n\n    if (cells$1.length === 0) {\n      remove$2(table);\n    }\n  };\n\n  var outcome = function (grid, cursor) {\n    return {\n      grid: grid,\n      cursor: cursor\n    };\n  };\n\n  var elementFromGrid = function (grid, row, column) {\n    var rows = extractGridDetails(grid).rows;\n    return findIn(rows, row, column).orThunk(function () {\n      return findIn(rows, 0, 0);\n    });\n  };\n\n  var findIn = function (grid, row, column) {\n    return Optional.from(grid[row]).bind(function (r) {\n      return Optional.from(r.cells[column]).bind(function (c) {\n        return Optional.from(c.element);\n      });\n    });\n  };\n\n  var bundle = function (grid, row, column) {\n    var rows = extractGridDetails(grid).rows;\n    return outcome(grid, findIn(rows, row, column));\n  };\n\n  var uniqueRows = function (details) {\n    var rowCompilation = function (rest, detail) {\n      var rowExists = exists(rest, function (currentDetail) {\n        return currentDetail.row === detail.row;\n      });\n      return rowExists ? rest : rest.concat([detail]);\n    };\n\n    return foldl(details, rowCompilation, []).sort(function (detailA, detailB) {\n      return detailA.row - detailB.row;\n    });\n  };\n\n  var opInsertRowsBefore = function (grid, details, comparator, genWrappers) {\n    var targetIndex = details[0].row;\n    var rows = uniqueRows(details);\n    var newGrid = foldr(rows, function (acc, row) {\n      var newG = insertRowAt(acc.grid, targetIndex, row.row + acc.delta, comparator, genWrappers.getOrInit);\n      return {\n        grid: newG,\n        delta: acc.delta + 1\n      };\n    }, {\n      grid: grid,\n      delta: 0\n    }).grid;\n    return bundle(newGrid, targetIndex, details[0].column);\n  };\n\n  var opInsertRowsAfter = function (grid, details, comparator, genWrappers) {\n    var rows = uniqueRows(details);\n    var target = rows[rows.length - 1];\n    var targetIndex = target.row + target.rowspan;\n    var newGrid = foldr(rows, function (newG, row) {\n      return insertRowAt(newG, targetIndex, row.row, comparator, genWrappers.getOrInit);\n    }, grid);\n    return bundle(newGrid, targetIndex, details[0].column);\n  };\n\n  var opInsertColumnsBefore = function (grid, extractDetail, comparator, genWrappers) {\n    var details = extractDetail.details;\n    var columns = uniqueColumns(details);\n    var targetIndex = columns[0].column;\n    var newGrid = foldr(columns, function (acc, col) {\n      var newG = insertColumnAt(acc.grid, targetIndex, col.column + acc.delta, comparator, genWrappers.getOrInit);\n      return {\n        grid: newG,\n        delta: acc.delta + 1\n      };\n    }, {\n      grid: grid,\n      delta: 0\n    }).grid;\n    return bundle(newGrid, details[0].row, targetIndex);\n  };\n\n  var opInsertColumnsAfter = function (grid, extractDetail, comparator, genWrappers) {\n    var details = extractDetail.details;\n    var target = details[details.length - 1];\n    var targetIndex = target.column + target.colspan;\n    var columns = uniqueColumns(details);\n    var newGrid = foldr(columns, function (newG, col) {\n      return insertColumnAt(newG, targetIndex, col.column, comparator, genWrappers.getOrInit);\n    }, grid);\n    return bundle(newGrid, details[0].row, targetIndex);\n  };\n\n  var opMakeRowHeader = function (grid, detail, comparator, genWrappers) {\n    var newGrid = replaceRow(grid, detail.row, comparator, genWrappers.replaceOrInit);\n    return bundle(newGrid, detail.row, detail.column);\n  };\n\n  var opMakeRowsHeader = function (initialGrid, details, comparator, genWrappers) {\n    var rows = uniqueRows(details);\n\n    var replacer = function (currentGrid, row) {\n      return replaceRow(currentGrid, row.row, comparator, genWrappers.replaceOrInit);\n    };\n\n    var newGrid = foldl(rows, replacer, initialGrid);\n    return bundle(newGrid, details[0].row, details[0].column);\n  };\n\n  var opMakeColumnHeader = function (initialGrid, detail, comparator, genWrappers) {\n    var newGrid = replaceColumn(initialGrid, detail.column, comparator, genWrappers.replaceOrInit);\n    return bundle(newGrid, detail.row, detail.column);\n  };\n\n  var opMakeColumnsHeader = function (initialGrid, details, comparator, genWrappers) {\n    var columns = uniqueColumns(details);\n\n    var replacer = function (currentGrid, column) {\n      return replaceColumn(currentGrid, column.column, comparator, genWrappers.replaceOrInit);\n    };\n\n    var newGrid = foldl(columns, replacer, initialGrid);\n    return bundle(newGrid, details[0].row, details[0].column);\n  };\n\n  var opUnmakeRowHeader = function (grid, detail, comparator, genWrappers) {\n    var newGrid = replaceRow(grid, detail.row, comparator, genWrappers.replaceOrInit);\n    return bundle(newGrid, detail.row, detail.column);\n  };\n\n  var opUnmakeRowsHeader = function (initialGrid, details, comparator, genWrappers) {\n    var rows = uniqueRows(details);\n\n    var replacer = function (currentGrid, row) {\n      return replaceRow(currentGrid, row.row, comparator, genWrappers.replaceOrInit);\n    };\n\n    var newGrid = foldl(rows, replacer, initialGrid);\n    return bundle(newGrid, details[0].row, details[0].column);\n  };\n\n  var opUnmakeColumnHeader = function (initialGrid, detail, comparator, genWrappers) {\n    var newGrid = replaceColumn(initialGrid, detail.column, comparator, genWrappers.replaceOrInit);\n    return bundle(newGrid, detail.row, detail.column);\n  };\n\n  var opUnmakeColumnsHeader = function (initialGrid, details, comparator, genWrappers) {\n    var columns = uniqueColumns(details);\n\n    var replacer = function (currentGrid, column) {\n      return replaceColumn(currentGrid, column.column, comparator, genWrappers.replaceOrInit);\n    };\n\n    var newGrid = foldl(columns, replacer, initialGrid);\n    return bundle(newGrid, details[0].row, details[0].column);\n  };\n\n  var opEraseColumns = function (grid, extractDetail, _comparator, _genWrappers) {\n    var columns = uniqueColumns(extractDetail.details);\n    var newGrid = deleteColumnsAt(grid, map(columns, function (column) {\n      return column.column;\n    }));\n    var cursor = elementFromGrid(newGrid, columns[0].row, columns[0].column);\n    return outcome(newGrid, cursor);\n  };\n\n  var opEraseRows = function (grid, details, _comparator, _genWrappers) {\n    var rows = uniqueRows(details);\n    var newGrid = deleteRowsAt(grid, rows[0].row, rows[rows.length - 1].row);\n    var cursor = elementFromGrid(newGrid, details[0].row, details[0].column);\n    return outcome(newGrid, cursor);\n  };\n\n  var opMergeCells = function (grid, mergable, comparator, genWrappers) {\n    var cells = mergable.cells;\n    merge$2(cells);\n    var newGrid = merge(grid, mergable.bounds, comparator, genWrappers.merge(cells));\n    return outcome(newGrid, Optional.from(cells[0]));\n  };\n\n  var opUnmergeCells = function (grid, unmergable, comparator, genWrappers) {\n    var unmerge$1 = function (b, cell) {\n      return unmerge(b, cell, comparator, genWrappers.unmerge(cell));\n    };\n\n    var newGrid = foldr(unmergable, unmerge$1, grid);\n    return outcome(newGrid, Optional.from(unmergable[0]));\n  };\n\n  var opPasteCells = function (grid, pasteDetails, comparator, _genWrappers) {\n    var gridify = function (table, generators) {\n      var wh = Warehouse.fromTable(table);\n      return toGrid(wh, generators, true);\n    };\n\n    var gridB = gridify(pasteDetails.clipboard, pasteDetails.generators);\n    var startAddress = address(pasteDetails.row, pasteDetails.column);\n    var mergedGrid = merge$1(startAddress, grid, gridB, pasteDetails.generators, comparator);\n    return mergedGrid.fold(function () {\n      return outcome(grid, Optional.some(pasteDetails.element));\n    }, function (newGrid) {\n      var cursor = elementFromGrid(newGrid, pasteDetails.row, pasteDetails.column);\n      return outcome(newGrid, cursor);\n    });\n  };\n\n  var gridifyRows = function (rows, generators, context) {\n    var pasteDetails = fromPastedRows(rows, context.section);\n    var wh = Warehouse.generate(pasteDetails);\n    return toGrid(wh, generators, true);\n  };\n\n  var opPasteColsBefore = function (grid, pasteDetails, comparator, _genWrappers) {\n    var rows = extractGridDetails(grid).rows;\n    var index = pasteDetails.cells[0].column;\n    var context = rows[pasteDetails.cells[0].row];\n    var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n    var mergedGrid = insertCols(index, grid, gridB, pasteDetails.generators, comparator);\n    var cursor = elementFromGrid(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n    return outcome(mergedGrid, cursor);\n  };\n\n  var opPasteColsAfter = function (grid, pasteDetails, comparator, _genWrappers) {\n    var rows = extractGridDetails(grid).rows;\n    var index = pasteDetails.cells[pasteDetails.cells.length - 1].column + pasteDetails.cells[pasteDetails.cells.length - 1].colspan;\n    var context = rows[pasteDetails.cells[0].row];\n    var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n    var mergedGrid = insertCols(index, grid, gridB, pasteDetails.generators, comparator);\n    var cursor = elementFromGrid(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n    return outcome(mergedGrid, cursor);\n  };\n\n  var opPasteRowsBefore = function (grid, pasteDetails, comparator, _genWrappers) {\n    var rows = extractGridDetails(grid).rows;\n    var index = pasteDetails.cells[0].row;\n    var context = rows[index];\n    var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n    var mergedGrid = insertRows(index, grid, gridB, pasteDetails.generators, comparator);\n    var cursor = elementFromGrid(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n    return outcome(mergedGrid, cursor);\n  };\n\n  var opPasteRowsAfter = function (grid, pasteDetails, comparator, _genWrappers) {\n    var rows = extractGridDetails(grid).rows;\n    var index = pasteDetails.cells[pasteDetails.cells.length - 1].row + pasteDetails.cells[pasteDetails.cells.length - 1].rowspan;\n    var context = rows[pasteDetails.cells[0].row];\n    var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n    var mergedGrid = insertRows(index, grid, gridB, pasteDetails.generators, comparator);\n    var cursor = elementFromGrid(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n    return outcome(mergedGrid, cursor);\n  };\n\n  var opGetColumnType = function (table, target) {\n    var house = Warehouse.fromTable(table);\n    var details = onCells(house, target);\n    return details.bind(function (selectedCells) {\n      var lastSelectedCell = selectedCells[selectedCells.length - 1];\n      var minColRange = selectedCells[0].column;\n      var maxColRange = lastSelectedCell.column + lastSelectedCell.colspan;\n      var selectedColumnCells = flatten(map(house.all, function (row) {\n        return filter(row.cells, function (cell) {\n          return cell.column >= minColRange && cell.column < maxColRange;\n        });\n      }));\n      return getCellsType(selectedColumnCells, function (cell) {\n        return name(cell.element) === 'th';\n      });\n    }).getOr('');\n  };\n\n  var getCellsType = function (cells, headerPred) {\n    var headerCells = filter(cells, headerPred);\n\n    if (headerCells.length === 0) {\n      return Optional.some('td');\n    } else if (headerCells.length === cells.length) {\n      return Optional.some('th');\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var resize = adjustWidthTo;\n  var adjustAndRedistributeWidths$1 = adjustAndRedistributeWidths;\n\n  var firstColumnIsLocked = function (_warehouse, details) {\n    return exists(details, function (detail) {\n      return detail.column === 0 && detail.isLocked;\n    });\n  };\n\n  var lastColumnIsLocked = function (warehouse, details) {\n    return exists(details, function (detail) {\n      return detail.column + detail.colspan >= warehouse.grid.columns && detail.isLocked;\n    });\n  };\n\n  var getColumnsWidth = function (warehouse, details) {\n    var columns = columns$1(warehouse);\n    var uniqueCols = uniqueColumns(details);\n    return foldl(uniqueCols, function (acc, detail) {\n      var column = columns[detail.column];\n      var colWidth = column.map(getOuter).getOr(0);\n      return acc + colWidth;\n    }, 0);\n  };\n\n  var insertColumnsExtractor = function (before) {\n    return function (warehouse, target) {\n      return onCells(warehouse, target).filter(function (details) {\n        var checkLocked = before ? firstColumnIsLocked : lastColumnIsLocked;\n        return !checkLocked(warehouse, details);\n      }).map(function (details) {\n        return {\n          details: details,\n          pixelDelta: getColumnsWidth(warehouse, details)\n        };\n      });\n    };\n  };\n\n  var eraseColumnsExtractor = function (warehouse, target) {\n    return onUnlockedCells(warehouse, target).map(function (details) {\n      return {\n        details: details,\n        pixelDelta: -getColumnsWidth(warehouse, details)\n      };\n    });\n  };\n\n  var pasteColumnsExtractor = function (before) {\n    return function (warehouse, target) {\n      return onPasteByEditor(warehouse, target).filter(function (details) {\n        var checkLocked = before ? firstColumnIsLocked : lastColumnIsLocked;\n        return !checkLocked(warehouse, details.cells);\n      });\n    };\n  };\n\n  var insertRowsBefore = run(opInsertRowsBefore, onCells, noop, noop, Generators.modification);\n  var insertRowsAfter = run(opInsertRowsAfter, onCells, noop, noop, Generators.modification);\n  var insertColumnsBefore = run(opInsertColumnsBefore, insertColumnsExtractor(true), adjustAndRedistributeWidths$1, noop, Generators.modification);\n  var insertColumnsAfter = run(opInsertColumnsAfter, insertColumnsExtractor(false), adjustAndRedistributeWidths$1, noop, Generators.modification);\n  var eraseColumns = run(opEraseColumns, eraseColumnsExtractor, adjustAndRedistributeWidths$1, prune, Generators.modification);\n  var eraseRows = run(opEraseRows, onCells, noop, prune, Generators.modification);\n  var makeColumnHeader = run(opMakeColumnHeader, onUnlockedCell, noop, noop, Generators.transform('row', 'th'));\n  var makeColumnsHeader = run(opMakeColumnsHeader, onUnlockedCells, noop, noop, Generators.transform('row', 'th'));\n  var unmakeColumnHeader = run(opUnmakeColumnHeader, onUnlockedCell, noop, noop, Generators.transform(null, 'td'));\n  var unmakeColumnsHeader = run(opUnmakeColumnsHeader, onUnlockedCells, noop, noop, Generators.transform(null, 'td'));\n  var makeRowHeader = run(opMakeRowHeader, onCell, noop, noop, Generators.transform('col', 'th'));\n  var makeRowsHeader = run(opMakeRowsHeader, onCells, noop, noop, Generators.transform('col', 'th'));\n  var unmakeRowHeader = run(opUnmakeRowHeader, onCell, noop, noop, Generators.transform(null, 'td'));\n  var unmakeRowsHeader = run(opUnmakeRowsHeader, onCells, noop, noop, Generators.transform(null, 'td'));\n  var mergeCells = run(opMergeCells, onUnlockedMergable, resize, noop, Generators.merging);\n  var unmergeCells = run(opUnmergeCells, onUnlockedUnmergable, resize, noop, Generators.merging);\n  var pasteCells = run(opPasteCells, onPaste, resize, noop, Generators.modification);\n  var pasteColsBefore = run(opPasteColsBefore, pasteColumnsExtractor(true), noop, noop, Generators.modification);\n  var pasteColsAfter = run(opPasteColsAfter, pasteColumnsExtractor(false), noop, noop, Generators.modification);\n  var pasteRowsBefore = run(opPasteRowsBefore, onPasteByEditor, noop, noop, Generators.modification);\n  var pasteRowsAfter = run(opPasteRowsAfter, onPasteByEditor, noop, noop, Generators.modification);\n  var getColumnType = opGetColumnType;\n\n  var getSection = function (elm) {\n    return getNodeName(elm.parentNode);\n  };\n\n  var mapSectionNameToType = function (section) {\n    if (section === 'thead') {\n      return 'header';\n    } else if (section === 'tfoot') {\n      return 'footer';\n    } else {\n      return 'body';\n    }\n  };\n\n  var detectHeaderRow = function (editor, elm) {\n    var isThead = getSection(elm) === 'thead';\n    var areAllCellsThs = !exists(elm.cells, function (c) {\n      return getNodeName(c) !== 'th';\n    });\n    return isThead || areAllCellsThs ? Optional.some({\n      thead: isThead,\n      ths: areAllCellsThs\n    }) : Optional.none();\n  };\n\n  var getRowType = function (editor, elm) {\n    return mapSectionNameToType(detectHeaderRow(editor, elm).fold(function () {\n      return getSection(elm);\n    }, function (_rowConfig) {\n      return 'thead';\n    }));\n  };\n\n  var switchRowSection = function (dom, rowElm, newSectionName) {\n    var tableElm = dom.getParent(rowElm, 'table');\n    var oldSectionElm = rowElm.parentNode;\n    var oldSectionName = getNodeName(oldSectionElm);\n\n    if (newSectionName !== oldSectionName) {\n      var sectionElm_1 = dom.select(newSectionName, tableElm)[0];\n\n      if (!sectionElm_1) {\n        sectionElm_1 = dom.create(newSectionName);\n        var firstTableChild_1 = tableElm.firstChild;\n\n        if (newSectionName === 'thead') {\n          last(children$2(SugarElement.fromDom(tableElm), 'caption,colgroup')).fold(function () {\n            return tableElm.insertBefore(sectionElm_1, firstTableChild_1);\n          }, function (c) {\n            return dom.insertAfter(sectionElm_1, c.dom);\n          });\n        } else {\n          tableElm.appendChild(sectionElm_1);\n        }\n      }\n\n      if (newSectionName === 'tbody' && oldSectionName === 'thead' && sectionElm_1.firstChild) {\n        sectionElm_1.insertBefore(rowElm, sectionElm_1.firstChild);\n      } else {\n        sectionElm_1.appendChild(rowElm);\n      }\n\n      if (!oldSectionElm.hasChildNodes()) {\n        dom.remove(oldSectionElm);\n      }\n    }\n  };\n\n  var renameCell = function (editor, cell, newCellType) {\n    if (isNonNullable(newCellType) && getNodeName(cell) !== newCellType) {\n      var newCellElm = editor.dom.rename(cell, newCellType);\n      fireNewCell(editor, newCellElm);\n      return newCellElm;\n    } else {\n      return cell;\n    }\n  };\n\n  var switchCellType = function (editor, cell, newCellType, scope) {\n    var dom = editor.dom;\n    var newCell = renameCell(editor, cell, newCellType);\n\n    if (!isUndefined(scope)) {\n      dom.setAttrib(newCell, 'scope', scope);\n    }\n\n    return newCell;\n  };\n\n  var switchCellsType = function (editor, cells, newCellType, scope) {\n    return each(cells, function (c) {\n      return switchCellType(editor, c, newCellType, scope);\n    });\n  };\n\n  var switchSectionType = function (editor, rowElm, newType) {\n    var determineHeaderRowType = function () {\n      var allTableRows = table(SugarElement.fromDom(rowElm.cells[0])).map(function (table) {\n        return rows(table);\n      }).getOr([]);\n      return findMap(allTableRows, function (row) {\n        return detectHeaderRow(editor, row.dom);\n      }).map(function (detectedType) {\n        if (detectedType.thead && detectedType.ths) {\n          return 'sectionCells';\n        } else {\n          return detectedType.thead ? 'section' : 'cells';\n        }\n      }).getOr('section');\n    };\n\n    var dom = editor.dom;\n\n    if (newType === 'header') {\n      var headerRowTypeSetting = getTableHeaderType(editor);\n      var headerRowType = headerRowTypeSetting === 'auto' ? determineHeaderRowType() : headerRowTypeSetting;\n      switchCellsType(editor, rowElm.cells, headerRowType === 'section' ? 'td' : 'th', 'col');\n      switchRowSection(dom, rowElm, headerRowType === 'cells' ? 'tbody' : 'thead');\n    } else {\n      switchCellsType(editor, rowElm.cells, 'td', null);\n      switchRowSection(dom, rowElm, newType === 'footer' ? 'tfoot' : 'tbody');\n    }\n  };\n\n  var getSelectionStartCellFallback = function (start) {\n    return table(start).bind(function (table) {\n      return retrieve$1(table, ephemera.firstSelectedSelector);\n    }).fold(function () {\n      return start;\n    }, function (cells) {\n      return cells[0];\n    });\n  };\n\n  var getSelectionStartFromSelector = function (selector) {\n    return function (start, isRoot) {\n      var startCellName = name(start);\n      var startCell = startCellName === 'col' || startCellName === 'colgroup' ? getSelectionStartCellFallback(start) : start;\n      return closest$1(startCell, selector, isRoot);\n    };\n  };\n\n  var getSelectionStartCell = getSelectionStartFromSelector('th,td');\n  var getSelectionStartCellOrCaption = getSelectionStartFromSelector('th,td,caption');\n\n  var getCellsFromSelection = function (start, selections, isRoot) {\n    return getSelectionStartCell(start, isRoot).map(function (_cell) {\n      return selection(selections);\n    }).getOr([]);\n  };\n\n  var getRowsFromSelection = function (start, selector) {\n    var cellOpt = getSelectionStartCell(start);\n    var rowsOpt = cellOpt.bind(function (cell) {\n      return table(cell);\n    }).map(function (table) {\n      return rows(table);\n    });\n    return lift2(cellOpt, rowsOpt, function (cell, rows) {\n      return filter(rows, function (row) {\n        return exists(fromDom$1(row.dom.cells), function (rowCell) {\n          return get$2(rowCell, selector) === '1' || eq$1(rowCell, cell);\n        });\n      });\n    }).getOr([]);\n  };\n\n  var TableActions = function (editor, lazyWire, selections) {\n    var isTableBody = function (editor) {\n      return name(getBody$1(editor)) === 'table';\n    };\n\n    var lastRowGuard = function (table) {\n      return isTableBody(editor) === false || getGridSize(table).rows > 1;\n    };\n\n    var lastColumnGuard = function (table) {\n      return isTableBody(editor) === false || getGridSize(table).columns > 1;\n    };\n\n    var cloneFormats = getCloneElements(editor);\n    var colMutationOp = isResizeTableColumnResizing(editor) ? noop : halve;\n\n    var execute = function (operation, guard, mutate, lazyWire, effect) {\n      return function (table, target) {\n        removeDataStyle(table);\n        var wire = lazyWire();\n        var doc = SugarElement.fromDom(editor.getDoc());\n        var generators = cellOperations(mutate, doc, cloneFormats);\n        var sizing = get$9(editor, table);\n        var resizeBehaviour = isResizeTableColumnResizing(editor) ? resizeTable() : preserveTable();\n        return guard(table) ? operation(wire, table, target, generators, sizing, resizeBehaviour).bind(function (result) {\n          each(result.newRows, function (row) {\n            fireNewRow(editor, row.dom);\n          });\n          each(result.newCells, function (cell) {\n            fireNewCell(editor, cell.dom);\n          });\n          return result.cursor.map(function (cell) {\n            var des = freefallRtl$2(cell);\n            var rng = editor.dom.createRng();\n            rng.setStart(des.element.dom, des.offset);\n            rng.setEnd(des.element.dom, des.offset);\n            return {\n              rng: rng,\n              effect: effect\n            };\n          });\n        }) : Optional.none();\n      };\n    };\n\n    var deleteRow = execute(eraseRows, lastRowGuard, noop, lazyWire, structureModified);\n    var deleteColumn = execute(eraseColumns, lastColumnGuard, noop, lazyWire, structureModified);\n    var insertRowsBefore$1 = execute(insertRowsBefore, always, noop, lazyWire, structureModified);\n    var insertRowsAfter$1 = execute(insertRowsAfter, always, noop, lazyWire, structureModified);\n    var insertColumnsBefore$1 = execute(insertColumnsBefore, always, colMutationOp, lazyWire, structureModified);\n    var insertColumnsAfter$1 = execute(insertColumnsAfter, always, colMutationOp, lazyWire, structureModified);\n    var mergeCells$1 = execute(mergeCells, always, noop, lazyWire, structureModified);\n    var unmergeCells$1 = execute(unmergeCells, always, noop, lazyWire, structureModified);\n    var pasteColsBefore$1 = execute(pasteColsBefore, always, noop, lazyWire, structureModified);\n    var pasteColsAfter$1 = execute(pasteColsAfter, always, noop, lazyWire, structureModified);\n    var pasteRowsBefore$1 = execute(pasteRowsBefore, always, noop, lazyWire, structureModified);\n    var pasteRowsAfter$1 = execute(pasteRowsAfter, always, noop, lazyWire, structureModified);\n    var pasteCells$1 = execute(pasteCells, always, noop, lazyWire, structureModified);\n\n    var extractType = function (args, validTypes) {\n      return get$1(args, 'type').filter(function (type) {\n        return contains(validTypes, type);\n      });\n    };\n\n    var setTableCellType = function (editor, args) {\n      return extractType(args, ['td', 'th']).each(function (type) {\n        var cells = map(getCellsFromSelection(getSelectionStart(editor), selections), function (c) {\n          return c.dom;\n        });\n        switchCellsType(editor, cells, type, null);\n      });\n    };\n\n    var setTableRowType = function (editor, args) {\n      return extractType(args, ['header', 'body', 'footer']).each(function (type) {\n        map(getRowsFromSelection(getSelectionStart(editor), ephemera.selected), function (row) {\n          return switchSectionType(editor, row.dom, type);\n        });\n      });\n    };\n\n    var makeColumnsHeader$1 = execute(makeColumnsHeader, always, noop, lazyWire, structureModified);\n    var unmakeColumnsHeader$1 = execute(unmakeColumnsHeader, always, noop, lazyWire, structureModified);\n\n    var getTableRowType = function (editor) {\n      var rows = getRowsFromSelection(getSelectionStart(editor), ephemera.selected);\n\n      if (rows.length > 0) {\n        var rowTypes = map(rows, function (r) {\n          return getRowType(editor, r.dom);\n        });\n        var hasHeader = contains(rowTypes, 'header');\n        var hasFooter = contains(rowTypes, 'footer');\n\n        if (!hasHeader && !hasFooter) {\n          return 'body';\n        } else {\n          var hasBody = contains(rowTypes, 'body');\n\n          if (hasHeader && !hasBody && !hasFooter) {\n            return 'header';\n          } else if (!hasHeader && !hasBody && hasFooter) {\n            return 'footer';\n          } else {\n            return '';\n          }\n        }\n      }\n    };\n\n    var getTableCellType = function (editor) {\n      return getCellsType(getCellsFromSelection(getSelectionStart(editor), selections), function (cell) {\n        return name(cell) === 'th';\n      }).getOr('');\n    };\n\n    var getTableColType = getColumnType;\n    return {\n      deleteRow: deleteRow,\n      deleteColumn: deleteColumn,\n      insertRowsBefore: insertRowsBefore$1,\n      insertRowsAfter: insertRowsAfter$1,\n      insertColumnsBefore: insertColumnsBefore$1,\n      insertColumnsAfter: insertColumnsAfter$1,\n      mergeCells: mergeCells$1,\n      unmergeCells: unmergeCells$1,\n      pasteColsBefore: pasteColsBefore$1,\n      pasteColsAfter: pasteColsAfter$1,\n      pasteRowsBefore: pasteRowsBefore$1,\n      pasteRowsAfter: pasteRowsAfter$1,\n      pasteCells: pasteCells$1,\n      setTableCellType: setTableCellType,\n      setTableRowType: setTableRowType,\n      makeColumnsHeader: makeColumnsHeader$1,\n      unmakeColumnsHeader: unmakeColumnsHeader$1,\n      getTableRowType: getTableRowType,\n      getTableCellType: getTableCellType,\n      getTableColType: getTableColType\n    };\n  };\n\n  var DefaultRenderOptions = {\n    styles: {\n      'border-collapse': 'collapse',\n      'width': '100%'\n    },\n    attributes: {\n      border: '1'\n    },\n    colGroups: false\n  };\n\n  var tableHeaderCell = function () {\n    return SugarElement.fromTag('th');\n  };\n\n  var tableCell = function () {\n    return SugarElement.fromTag('td');\n  };\n\n  var tableColumn = function () {\n    return SugarElement.fromTag('col');\n  };\n\n  var createRow = function (columns, rowHeaders, columnHeaders, rowIndex) {\n    var tr = SugarElement.fromTag('tr');\n\n    for (var j = 0; j < columns; j++) {\n      var td = rowIndex < rowHeaders || j < columnHeaders ? tableHeaderCell() : tableCell();\n\n      if (j < columnHeaders) {\n        set(td, 'scope', 'row');\n      }\n\n      if (rowIndex < rowHeaders) {\n        set(td, 'scope', 'col');\n      }\n\n      append(td, SugarElement.fromTag('br'));\n      append(tr, td);\n    }\n\n    return tr;\n  };\n\n  var createGroupRow = function (columns) {\n    var columnGroup = SugarElement.fromTag('colgroup');\n    range(columns, function () {\n      return append(columnGroup, tableColumn());\n    });\n    return columnGroup;\n  };\n\n  var createRows = function (rows, columns, rowHeaders, columnHeaders) {\n    return range(rows, function (r) {\n      return createRow(columns, rowHeaders, columnHeaders, r);\n    });\n  };\n\n  var render$1 = function (rows, columns, rowHeaders, columnHeaders, headerType, renderOpts) {\n    if (renderOpts === void 0) {\n      renderOpts = DefaultRenderOptions;\n    }\n\n    var table = SugarElement.fromTag('table');\n    var rowHeadersGoInThead = headerType !== 'cells';\n    setAll$1(table, renderOpts.styles);\n    setAll(table, renderOpts.attributes);\n\n    if (renderOpts.colGroups) {\n      append(table, createGroupRow(columns));\n    }\n\n    var actualRowHeaders = Math.min(rows, rowHeaders);\n\n    if (rowHeadersGoInThead && rowHeaders > 0) {\n      var thead = SugarElement.fromTag('thead');\n      append(table, thead);\n      var theadRowHeaders = headerType === 'sectionCells' ? actualRowHeaders : 0;\n      var theadRows = createRows(rowHeaders, columns, theadRowHeaders, columnHeaders);\n      append$1(thead, theadRows);\n    }\n\n    var tbody = SugarElement.fromTag('tbody');\n    append(table, tbody);\n    var numRows = rowHeadersGoInThead ? rows - actualRowHeaders : rows;\n    var numRowHeaders = rowHeadersGoInThead ? 0 : rowHeaders;\n    var tbodyRows = createRows(numRows, columns, numRowHeaders, columnHeaders);\n    append$1(tbody, tbodyRows);\n    return table;\n  };\n\n  var get$b = function (element) {\n    return element.dom.innerHTML;\n  };\n\n  var getOuter$2 = function (element) {\n    var container = SugarElement.fromTag('div');\n    var clone = SugarElement.fromDom(element.dom.cloneNode(true));\n    append(container, clone);\n    return get$b(container);\n  };\n\n  var placeCaretInCell = function (editor, cell) {\n    editor.selection.select(cell.dom, true);\n    editor.selection.collapse(true);\n  };\n\n  var selectFirstCellInTable = function (editor, tableElm) {\n    descendant$1(tableElm, 'td,th').each(curry(placeCaretInCell, editor));\n  };\n\n  var fireEvents = function (editor, table) {\n    each(descendants$1(table, 'tr'), function (row) {\n      fireNewRow(editor, row.dom);\n      each(descendants$1(row, 'th,td'), function (cell) {\n        fireNewCell(editor, cell.dom);\n      });\n    });\n  };\n\n  var isPercentage$1 = function (width) {\n    return isString(width) && width.indexOf('%') !== -1;\n  };\n\n  var insert$1 = function (editor, columns, rows, colHeaders, rowHeaders) {\n    var defaultStyles = getDefaultStyles(editor);\n    var options = {\n      styles: defaultStyles,\n      attributes: getDefaultAttributes(editor),\n      colGroups: useColumnGroup(editor)\n    };\n    editor.undoManager.ignore(function () {\n      var table = render$1(rows, columns, rowHeaders, colHeaders, getTableHeaderType(editor), options);\n      set(table, 'data-mce-id', '__mce');\n      var html = getOuter$2(table);\n      editor.insertContent(html);\n      editor.addVisual();\n    });\n    return descendant$1(getBody$1(editor), 'table[data-mce-id=\"__mce\"]').map(function (table) {\n      if (isPixelsForced(editor)) {\n        enforcePixels(editor, table);\n      } else if (isResponsiveForced(editor)) {\n        enforceNone(table);\n      } else if (isPercentagesForced(editor) || isPercentage$1(defaultStyles.width)) {\n        enforcePercentage(editor, table);\n      }\n\n      removeDataStyle(table);\n      remove(table, 'data-mce-id');\n      fireEvents(editor, table);\n      selectFirstCellInTable(editor, table);\n      return table.dom;\n    }).getOr(null);\n  };\n\n  var insertTableWithDataValidation = function (editor, rows, columns, options, errorMsg) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    var checkInput = function (val) {\n      return isNumber(val) && val > 0;\n    };\n\n    if (checkInput(rows) && checkInput(columns)) {\n      var headerRows = options.headerRows || 0;\n      var headerColumns = options.headerColumns || 0;\n      return insert$1(editor, columns, rows, headerColumns, headerRows);\n    } else {\n      console.error(errorMsg);\n      return null;\n    }\n  };\n\n  var getClipboardElements = function (getClipboard) {\n    return function () {\n      return getClipboard().fold(function () {\n        return [];\n      }, function (elems) {\n        return map(elems, function (e) {\n          return e.dom;\n        });\n      });\n    };\n  };\n\n  var setClipboardElements = function (setClipboard) {\n    return function (elems) {\n      var elmsOpt = elems.length > 0 ? Optional.some(fromDom$1(elems)) : Optional.none();\n      setClipboard(elmsOpt);\n    };\n  };\n\n  var insertTable = function (editor) {\n    return function (columns, rows, options) {\n      if (options === void 0) {\n        options = {};\n      }\n\n      var table = insertTableWithDataValidation(editor, rows, columns, options, 'Invalid values for insertTable - rows and columns values are required to insert a table.');\n      editor.undoManager.add();\n      return table;\n    };\n  };\n\n  var getApi = function (editor, clipboard, resizeHandler, selectionTargets) {\n    return {\n      insertTable: insertTable(editor),\n      setClipboardRows: setClipboardElements(clipboard.setRows),\n      getClipboardRows: getClipboardElements(clipboard.getRows),\n      setClipboardCols: setClipboardElements(clipboard.setColumns),\n      getClipboardCols: getClipboardElements(clipboard.getColumns),\n      resizeHandler: resizeHandler,\n      selectionTargets: selectionTargets\n    };\n  };\n\n  var constrainSpan = function (element, property, value) {\n    var currentColspan = getAttrValue(element, property, 1);\n\n    if (value === 1 || currentColspan <= 1) {\n      remove(element, property);\n    } else {\n      set(element, property, Math.min(value, currentColspan));\n    }\n  };\n\n  var generateColGroup = function (house, minColRange, maxColRange) {\n    if (Warehouse.hasColumns(house)) {\n      var colsToCopy = filter(Warehouse.justColumns(house), function (col) {\n        return col.column >= minColRange && col.column < maxColRange;\n      });\n      var copiedCols = map(colsToCopy, function (c) {\n        var clonedCol = deep(c.element);\n        constrainSpan(clonedCol, 'span', maxColRange - minColRange);\n        return clonedCol;\n      });\n      var fakeColgroup = SugarElement.fromTag('colgroup');\n      append$1(fakeColgroup, copiedCols);\n      return [fakeColgroup];\n    } else {\n      return [];\n    }\n  };\n\n  var generateRows = function (house, minColRange, maxColRange) {\n    return map(house.all, function (row) {\n      var cellsToCopy = filter(row.cells, function (cell) {\n        return cell.column >= minColRange && cell.column < maxColRange;\n      });\n      var copiedCells = map(cellsToCopy, function (cell) {\n        var clonedCell = deep(cell.element);\n        constrainSpan(clonedCell, 'colspan', maxColRange - minColRange);\n        return clonedCell;\n      });\n      var fakeTR = SugarElement.fromTag('tr');\n      append$1(fakeTR, copiedCells);\n      return fakeTR;\n    });\n  };\n\n  var copyCols = function (table, target) {\n    var house = Warehouse.fromTable(table);\n    var details = onUnlockedCells(house, target);\n    return details.map(function (selectedCells) {\n      var lastSelectedCell = selectedCells[selectedCells.length - 1];\n      var minColRange = selectedCells[0].column;\n      var maxColRange = lastSelectedCell.column + lastSelectedCell.colspan;\n      var fakeColGroups = generateColGroup(house, minColRange, maxColRange);\n      var fakeRows = generateRows(house, minColRange, maxColRange);\n      return __spreadArrays(fakeColGroups, fakeRows);\n    });\n  };\n\n  var copyRows = function (table, target, generators) {\n    var warehouse = Warehouse.fromTable(table);\n    var details = onCells(warehouse, target);\n    return details.bind(function (selectedCells) {\n      var grid = toGrid(warehouse, generators, false);\n      var rows = extractGridDetails(grid).rows;\n      var slicedGrid = rows.slice(selectedCells[0].row, selectedCells[selectedCells.length - 1].row + selectedCells[selectedCells.length - 1].rowspan);\n      var filteredGrid = bind(slicedGrid, function (row) {\n        var newCells = filter(row.cells, function (cell) {\n          return !cell.isLocked;\n        });\n        return newCells.length > 0 ? [__assign(__assign({}, row), {\n          cells: newCells\n        })] : [];\n      });\n      var slicedDetails = toDetailList(filteredGrid, generators);\n      return someIf(slicedDetails.length > 0, slicedDetails);\n    }).map(function (slicedDetails) {\n      return copy$2(slicedDetails);\n    });\n  };\n\n  var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n  var getTDTHOverallStyle = function (dom, elm, name) {\n    var cells = dom.select('td,th', elm);\n    var firstChildStyle;\n\n    var checkChildren = function (firstChildStyle, elms) {\n      for (var i = 0; i < elms.length; i++) {\n        var currentStyle = dom.getStyle(elms[i], name);\n\n        if (typeof firstChildStyle === 'undefined') {\n          firstChildStyle = currentStyle;\n        }\n\n        if (firstChildStyle !== currentStyle) {\n          return '';\n        }\n      }\n\n      return firstChildStyle;\n    };\n\n    return checkChildren(firstChildStyle, cells);\n  };\n\n  var applyAlign = function (editor, elm, name) {\n    if (name) {\n      editor.formatter.apply('align' + name, {}, elm);\n    }\n  };\n\n  var applyVAlign = function (editor, elm, name) {\n    if (name) {\n      editor.formatter.apply('valign' + name, {}, elm);\n    }\n  };\n\n  var unApplyAlign = function (editor, elm) {\n    global$1.each('left center right'.split(' '), function (name) {\n      editor.formatter.remove('align' + name, {}, elm);\n    });\n  };\n\n  var unApplyVAlign = function (editor, elm) {\n    global$1.each('top middle bottom'.split(' '), function (name) {\n      editor.formatter.remove('valign' + name, {}, elm);\n    });\n  };\n\n  var isListGroup = function (item) {\n    return hasNonNullableKey(item, 'menu');\n  };\n\n  var buildListItems = function (inputList, startItems) {\n    var appendItems = function (values, acc) {\n      return acc.concat(map(values, function (item) {\n        var text = item.text || item.title;\n\n        if (isListGroup(item)) {\n          return {\n            text: text,\n            items: buildListItems(item.menu)\n          };\n        } else {\n          return {\n            text: text,\n            value: item.value\n          };\n        }\n      }));\n    };\n\n    return appendItems(inputList, startItems || []);\n  };\n\n  var rgbToHex = function (dom) {\n    return function (value) {\n      return startsWith(value, 'rgb') ? dom.toHex(value) : value;\n    };\n  };\n\n  var extractAdvancedStyles = function (dom, elm) {\n    var element = SugarElement.fromDom(elm);\n    return {\n      borderwidth: getRaw(element, 'border-width').getOr(''),\n      borderstyle: getRaw(element, 'border-style').getOr(''),\n      bordercolor: getRaw(element, 'border-color').map(rgbToHex(dom)).getOr(''),\n      backgroundcolor: getRaw(element, 'background-color').map(rgbToHex(dom)).getOr('')\n    };\n  };\n\n  var getSharedValues = function (data) {\n    var baseData = data[0];\n    var comparisonData = data.slice(1);\n    each(comparisonData, function (items) {\n      each(keys(baseData), function (key) {\n        each$1(items, function (itemValue, itemKey) {\n          var comparisonValue = baseData[key];\n\n          if (comparisonValue !== '' && key === itemKey) {\n            if (comparisonValue !== itemValue) {\n              baseData[key] = '';\n            }\n          }\n        });\n      });\n    });\n    return baseData;\n  };\n\n  var getAdvancedTab = function (dialogName) {\n    var advTabItems = [{\n      name: 'borderstyle',\n      type: 'listbox',\n      label: 'Border style',\n      items: [{\n        text: 'Select...',\n        value: ''\n      }, {\n        text: 'Solid',\n        value: 'solid'\n      }, {\n        text: 'Dotted',\n        value: 'dotted'\n      }, {\n        text: 'Dashed',\n        value: 'dashed'\n      }, {\n        text: 'Double',\n        value: 'double'\n      }, {\n        text: 'Groove',\n        value: 'groove'\n      }, {\n        text: 'Ridge',\n        value: 'ridge'\n      }, {\n        text: 'Inset',\n        value: 'inset'\n      }, {\n        text: 'Outset',\n        value: 'outset'\n      }, {\n        text: 'None',\n        value: 'none'\n      }, {\n        text: 'Hidden',\n        value: 'hidden'\n      }]\n    }, {\n      name: 'bordercolor',\n      type: 'colorinput',\n      label: 'Border color'\n    }, {\n      name: 'backgroundcolor',\n      type: 'colorinput',\n      label: 'Background color'\n    }];\n    var borderWidth = {\n      name: 'borderwidth',\n      type: 'input',\n      label: 'Border width'\n    };\n    var items = dialogName === 'cell' ? [borderWidth].concat(advTabItems) : advTabItems;\n    return {\n      title: 'Advanced',\n      name: 'advanced',\n      items: items\n    };\n  };\n\n  var getAlignment = function (formats, formatName, editor, elm) {\n    return find(formats, function (name) {\n      return editor.formatter.matchNode(elm, formatName + name);\n    }).getOr('');\n  };\n\n  var getHAlignment = curry(getAlignment, ['left', 'center', 'right'], 'align');\n  var getVAlignment = curry(getAlignment, ['top', 'middle', 'bottom'], 'valign');\n\n  var extractDataFromSettings = function (editor, hasAdvTableTab) {\n    var style = getDefaultStyles(editor);\n    var attrs = getDefaultAttributes(editor);\n\n    var extractAdvancedStyleData = function (dom) {\n      return {\n        borderstyle: get$1(style, 'border-style').getOr(''),\n        bordercolor: rgbToHex(dom)(get$1(style, 'border-color').getOr('')),\n        backgroundcolor: rgbToHex(dom)(get$1(style, 'background-color').getOr(''))\n      };\n    };\n\n    var defaultData = {\n      height: '',\n      width: '100%',\n      cellspacing: '',\n      cellpadding: '',\n      caption: false,\n      class: '',\n      align: '',\n      border: ''\n    };\n\n    var getBorder = function () {\n      var borderWidth = style['border-width'];\n\n      if (shouldStyleWithCss(editor) && borderWidth) {\n        return {\n          border: borderWidth\n        };\n      }\n\n      return get$1(attrs, 'border').fold(function () {\n        return {};\n      }, function (border) {\n        return {\n          border: border\n        };\n      });\n    };\n\n    var advStyle = hasAdvTableTab ? extractAdvancedStyleData(editor.dom) : {};\n\n    var getCellPaddingCellSpacing = function () {\n      var spacing = get$1(style, 'border-spacing').or(get$1(attrs, 'cellspacing')).fold(function () {\n        return {};\n      }, function (cellspacing) {\n        return {\n          cellspacing: cellspacing\n        };\n      });\n      var padding = get$1(style, 'border-padding').or(get$1(attrs, 'cellpadding')).fold(function () {\n        return {};\n      }, function (cellpadding) {\n        return {\n          cellpadding: cellpadding\n        };\n      });\n      return __assign(__assign({}, spacing), padding);\n    };\n\n    var data = __assign(__assign(__assign(__assign(__assign(__assign({}, defaultData), style), attrs), advStyle), getBorder()), getCellPaddingCellSpacing());\n\n    return data;\n  };\n\n  var extractDataFromTableElement = function (editor, elm, hasAdvTableTab) {\n    var getBorder = function (dom, elm) {\n      var optBorderWidth = getRaw(SugarElement.fromDom(elm), 'border-width');\n\n      if (shouldStyleWithCss(editor) && optBorderWidth.isSome()) {\n        return optBorderWidth.getOr('');\n      }\n\n      return dom.getAttrib(elm, 'border') || getTDTHOverallStyle(editor.dom, elm, 'border-width') || getTDTHOverallStyle(editor.dom, elm, 'border');\n    };\n\n    var dom = editor.dom;\n    return __assign({\n      width: dom.getStyle(elm, 'width') || dom.getAttrib(elm, 'width'),\n      height: dom.getStyle(elm, 'height') || dom.getAttrib(elm, 'height'),\n      cellspacing: dom.getStyle(elm, 'border-spacing') || dom.getAttrib(elm, 'cellspacing'),\n      cellpadding: dom.getAttrib(elm, 'cellpadding') || getTDTHOverallStyle(editor.dom, elm, 'padding'),\n      border: getBorder(dom, elm),\n      caption: !!dom.select('caption', elm)[0],\n      class: dom.getAttrib(elm, 'class', ''),\n      align: getHAlignment(editor, elm)\n    }, hasAdvTableTab ? extractAdvancedStyles(dom, elm) : {});\n  };\n\n  var extractDataFromRowElement = function (editor, elm, hasAdvancedRowTab) {\n    var dom = editor.dom;\n    return __assign({\n      height: dom.getStyle(elm, 'height') || dom.getAttrib(elm, 'height'),\n      class: dom.getAttrib(elm, 'class', ''),\n      type: getRowType(editor, elm),\n      align: getHAlignment(editor, elm)\n    }, hasAdvancedRowTab ? extractAdvancedStyles(dom, elm) : {});\n  };\n\n  var extractDataFromCellElement = function (editor, cell, hasAdvancedCellTab, column) {\n    var dom = editor.dom;\n    var colElm = column.getOr(cell);\n\n    var getStyle = function (element, style) {\n      return dom.getStyle(element, style) || dom.getAttrib(element, style);\n    };\n\n    return __assign({\n      width: getStyle(colElm, 'width'),\n      height: getStyle(cell, 'height'),\n      scope: dom.getAttrib(cell, 'scope'),\n      celltype: getNodeName(cell),\n      class: dom.getAttrib(cell, 'class', ''),\n      halign: getHAlignment(editor, cell),\n      valign: getVAlignment(editor, cell)\n    }, hasAdvancedCellTab ? extractAdvancedStyles(dom, cell) : {});\n  };\n\n  var getClassList = function (editor) {\n    var classes = buildListItems(getCellClassList(editor));\n\n    if (classes.length > 0) {\n      return Optional.some({\n        name: 'class',\n        type: 'listbox',\n        label: 'Class',\n        items: classes\n      });\n    }\n\n    return Optional.none();\n  };\n\n  var children$3 = [{\n    name: 'width',\n    type: 'input',\n    label: 'Width'\n  }, {\n    name: 'height',\n    type: 'input',\n    label: 'Height'\n  }, {\n    name: 'celltype',\n    type: 'listbox',\n    label: 'Cell type',\n    items: [{\n      text: 'Cell',\n      value: 'td'\n    }, {\n      text: 'Header cell',\n      value: 'th'\n    }]\n  }, {\n    name: 'scope',\n    type: 'listbox',\n    label: 'Scope',\n    items: [{\n      text: 'None',\n      value: ''\n    }, {\n      text: 'Row',\n      value: 'row'\n    }, {\n      text: 'Column',\n      value: 'col'\n    }, {\n      text: 'Row group',\n      value: 'rowgroup'\n    }, {\n      text: 'Column group',\n      value: 'colgroup'\n    }]\n  }, {\n    name: 'halign',\n    type: 'listbox',\n    label: 'Horizontal align',\n    items: [{\n      text: 'None',\n      value: ''\n    }, {\n      text: 'Left',\n      value: 'left'\n    }, {\n      text: 'Center',\n      value: 'center'\n    }, {\n      text: 'Right',\n      value: 'right'\n    }]\n  }, {\n    name: 'valign',\n    type: 'listbox',\n    label: 'Vertical align',\n    items: [{\n      text: 'None',\n      value: ''\n    }, {\n      text: 'Top',\n      value: 'top'\n    }, {\n      text: 'Middle',\n      value: 'middle'\n    }, {\n      text: 'Bottom',\n      value: 'bottom'\n    }]\n  }];\n\n  var getItems = function (editor) {\n    return children$3.concat(getClassList(editor).toArray());\n  };\n\n  var modifiers = function (testTruthy) {\n    return function (editor, node) {\n      var dom = editor.dom;\n\n      var setAttrib = function (attr, value) {\n        if (!testTruthy || value) {\n          dom.setAttrib(node, attr, value);\n        }\n      };\n\n      var setStyle = function (prop, value) {\n        if (!testTruthy || value) {\n          dom.setStyle(node, prop, value);\n        }\n      };\n\n      var setFormat = function (formatName, value) {\n        if (!testTruthy || value) {\n          if (value === '') {\n            editor.formatter.remove(formatName, {\n              value: null\n            }, node, true);\n          } else {\n            editor.formatter.apply(formatName, {\n              value: value\n            }, node);\n          }\n        }\n      };\n\n      return {\n        setAttrib: setAttrib,\n        setStyle: setStyle,\n        setFormat: setFormat\n      };\n    };\n  };\n\n  var DomModifier = {\n    normal: modifiers(false),\n    ifTruthy: modifiers(true)\n  };\n\n  var getSelectedCells = function (cells) {\n    return table(cells[0]).map(function (table) {\n      var warehouse = Warehouse.fromTable(table);\n      var allCells = Warehouse.justCells(warehouse);\n      var filtered = filter(allCells, function (cellA) {\n        return exists(cells, function (cellB) {\n          return eq$1(cellA.element, cellB);\n        });\n      });\n      return map(filtered, function (cell) {\n        return {\n          element: cell.element.dom,\n          column: Warehouse.getColumnAt(warehouse, cell.column).map(function (col) {\n            return col.element.dom;\n          })\n        };\n      });\n    });\n  };\n\n  var updateSimpleProps = function (modifier, colModifier, data) {\n    modifier.setAttrib('scope', data.scope);\n    modifier.setAttrib('class', data.class);\n    modifier.setStyle('height', addPxSuffix(data.height));\n    colModifier.setStyle('width', addPxSuffix(data.width));\n  };\n\n  var updateAdvancedProps = function (modifier, data) {\n    modifier.setFormat('tablecellbackgroundcolor', data.backgroundcolor);\n    modifier.setFormat('tablecellbordercolor', data.bordercolor);\n    modifier.setFormat('tablecellborderstyle', data.borderstyle);\n    modifier.setFormat('tablecellborderwidth', addPxSuffix(data.borderwidth));\n  };\n\n  var applyCellData = function (editor, cells, oldData, data) {\n    var isSingleCell = cells.length === 1;\n    var modifiedData = filter$1(data, function (value, key) {\n      return oldData[key] !== value;\n    });\n\n    if (size(modifiedData) > 0 && cells.length >= 1) {\n      var tableOpt = table(cells[0]);\n      getSelectedCells(cells).each(function (selectedCells) {\n        each(selectedCells, function (item) {\n          var cellElm = switchCellType(editor, item.element, data.celltype);\n          var modifier = isSingleCell ? DomModifier.normal(editor, cellElm) : DomModifier.ifTruthy(editor, cellElm);\n          var colModifier = item.column.map(function (col) {\n            return isSingleCell ? DomModifier.normal(editor, col) : DomModifier.ifTruthy(editor, col);\n          }).getOr(modifier);\n          updateSimpleProps(modifier, colModifier, data);\n\n          if (hasAdvancedCellTab(editor)) {\n            updateAdvancedProps(modifier, data);\n          }\n\n          if (isSingleCell) {\n            unApplyAlign(editor, cellElm);\n            unApplyVAlign(editor, cellElm);\n          }\n\n          if (data.halign) {\n            applyAlign(editor, cellElm, data.halign);\n          }\n\n          if (data.valign) {\n            applyVAlign(editor, cellElm, data.valign);\n          }\n        });\n      });\n      var styleModified_1 = size(filter$1(modifiedData, function (_value, key) {\n        return key !== 'scope' && key !== 'celltype';\n      })) > 0;\n      tableOpt.each(function (table) {\n        return fireTableModified(editor, table.dom, {\n          structure: has(modifiedData, 'celltype'),\n          style: styleModified_1\n        });\n      });\n    }\n  };\n\n  var onSubmitCellForm = function (editor, cells, oldData, api) {\n    var data = api.getData();\n    api.close();\n    editor.undoManager.transact(function () {\n      applyCellData(editor, cells, oldData, data);\n      editor.focus();\n    });\n  };\n\n  var getData = function (editor, cells) {\n    var cellsData = getSelectedCells(cells).map(function (selectedCells) {\n      return map(selectedCells, function (item) {\n        return extractDataFromCellElement(editor, item.element, hasAdvancedCellTab(editor), item.column);\n      });\n    });\n    return getSharedValues(cellsData.getOrDie());\n  };\n\n  var open = function (editor, selections) {\n    var cells = getCellsFromSelection(getSelectionStart(editor), selections);\n\n    if (cells.length === 0) {\n      return;\n    }\n\n    var data = getData(editor, cells);\n    var dialogTabPanel = {\n      type: 'tabpanel',\n      tabs: [{\n        title: 'General',\n        name: 'general',\n        items: getItems(editor)\n      }, getAdvancedTab('cell')]\n    };\n    var dialogPanel = {\n      type: 'panel',\n      items: [{\n        type: 'grid',\n        columns: 2,\n        items: getItems(editor)\n      }]\n    };\n    editor.windowManager.open({\n      title: 'Cell Properties',\n      size: 'normal',\n      body: hasAdvancedCellTab(editor) ? dialogTabPanel : dialogPanel,\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      initialData: data,\n      onSubmit: curry(onSubmitCellForm, editor, cells, data)\n    });\n  };\n\n  var getClassList$1 = function (editor) {\n    var classes = buildListItems(getRowClassList(editor));\n\n    if (classes.length > 0) {\n      return Optional.some({\n        name: 'class',\n        type: 'listbox',\n        label: 'Class',\n        items: classes\n      });\n    }\n\n    return Optional.none();\n  };\n\n  var formChildren = [{\n    type: 'listbox',\n    name: 'type',\n    label: 'Row type',\n    items: [{\n      text: 'Header',\n      value: 'header'\n    }, {\n      text: 'Body',\n      value: 'body'\n    }, {\n      text: 'Footer',\n      value: 'footer'\n    }]\n  }, {\n    type: 'listbox',\n    name: 'align',\n    label: 'Alignment',\n    items: [{\n      text: 'None',\n      value: ''\n    }, {\n      text: 'Left',\n      value: 'left'\n    }, {\n      text: 'Center',\n      value: 'center'\n    }, {\n      text: 'Right',\n      value: 'right'\n    }]\n  }, {\n    label: 'Height',\n    name: 'height',\n    type: 'input'\n  }];\n\n  var getItems$1 = function (editor) {\n    return formChildren.concat(getClassList$1(editor).toArray());\n  };\n\n  var updateSimpleProps$1 = function (modifier, data) {\n    modifier.setAttrib('class', data.class);\n    modifier.setStyle('height', addPxSuffix(data.height));\n  };\n\n  var updateAdvancedProps$1 = function (modifier, data) {\n    modifier.setStyle('background-color', data.backgroundcolor);\n    modifier.setStyle('border-color', data.bordercolor);\n    modifier.setStyle('border-style', data.borderstyle);\n  };\n\n  var applyRowData = function (editor, rows, oldData, data) {\n    var isSingleRow = rows.length === 1;\n    var modifiedData = filter$1(data, function (value, key) {\n      return oldData[key] !== value;\n    });\n\n    if (size(modifiedData) > 0) {\n      each(rows, function (rowElm) {\n        if (data.type !== getNodeName(rowElm.parentNode)) {\n          switchSectionType(editor, rowElm, data.type);\n        }\n\n        var modifier = isSingleRow ? DomModifier.normal(editor, rowElm) : DomModifier.ifTruthy(editor, rowElm);\n        updateSimpleProps$1(modifier, data);\n\n        if (hasAdvancedRowTab(editor)) {\n          updateAdvancedProps$1(modifier, data);\n        }\n\n        if (data.align !== oldData.align) {\n          unApplyAlign(editor, rowElm);\n          applyAlign(editor, rowElm, data.align);\n        }\n      });\n      var typeModified_1 = has(modifiedData, 'type');\n      var styleModified_1 = typeModified_1 ? size(modifiedData) > 1 : true;\n      table(SugarElement.fromDom(rows[0])).each(function (table) {\n        return fireTableModified(editor, table.dom, {\n          structure: typeModified_1,\n          style: styleModified_1\n        });\n      });\n    }\n  };\n\n  var onSubmitRowForm = function (editor, rows, oldData, api) {\n    var data = api.getData();\n    api.close();\n    editor.undoManager.transact(function () {\n      applyRowData(editor, rows, oldData, data);\n      editor.focus();\n    });\n  };\n\n  var open$1 = function (editor) {\n    var rows = getRowsFromSelection(getSelectionStart(editor), ephemera.selected);\n\n    if (rows.length === 0) {\n      return;\n    }\n\n    var rowsData = map(rows, function (rowElm) {\n      return extractDataFromRowElement(editor, rowElm.dom, hasAdvancedRowTab(editor));\n    });\n    var data = getSharedValues(rowsData);\n    var dialogTabPanel = {\n      type: 'tabpanel',\n      tabs: [{\n        title: 'General',\n        name: 'general',\n        items: getItems$1(editor)\n      }, getAdvancedTab('row')]\n    };\n    var dialogPanel = {\n      type: 'panel',\n      items: [{\n        type: 'grid',\n        columns: 2,\n        items: getItems$1(editor)\n      }]\n    };\n    editor.windowManager.open({\n      title: 'Row Properties',\n      size: 'normal',\n      body: hasAdvancedRowTab(editor) ? dialogTabPanel : dialogPanel,\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      initialData: data,\n      onSubmit: curry(onSubmitRowForm, editor, map(rows, function (r) {\n        return r.dom;\n      }), data)\n    });\n  };\n\n  var global$2 = tinymce.util.Tools.resolve('tinymce.Env');\n\n  var getItems$2 = function (editor, classes, insertNewTable) {\n    var rowColCountItems = !insertNewTable ? [] : [{\n      type: 'input',\n      name: 'cols',\n      label: 'Cols',\n      inputMode: 'numeric'\n    }, {\n      type: 'input',\n      name: 'rows',\n      label: 'Rows',\n      inputMode: 'numeric'\n    }];\n    var alwaysItems = [{\n      type: 'input',\n      name: 'width',\n      label: 'Width'\n    }, {\n      type: 'input',\n      name: 'height',\n      label: 'Height'\n    }];\n    var appearanceItems = hasAppearanceOptions(editor) ? [{\n      type: 'input',\n      name: 'cellspacing',\n      label: 'Cell spacing',\n      inputMode: 'numeric'\n    }, {\n      type: 'input',\n      name: 'cellpadding',\n      label: 'Cell padding',\n      inputMode: 'numeric'\n    }, {\n      type: 'input',\n      name: 'border',\n      label: 'Border width'\n    }, {\n      type: 'label',\n      label: 'Caption',\n      items: [{\n        type: 'checkbox',\n        name: 'caption',\n        label: 'Show caption'\n      }]\n    }] : [];\n    var alignmentItem = [{\n      type: 'listbox',\n      name: 'align',\n      label: 'Alignment',\n      items: [{\n        text: 'None',\n        value: ''\n      }, {\n        text: 'Left',\n        value: 'left'\n      }, {\n        text: 'Center',\n        value: 'center'\n      }, {\n        text: 'Right',\n        value: 'right'\n      }]\n    }];\n    var classListItem = classes.length > 0 ? [{\n      type: 'listbox',\n      name: 'class',\n      label: 'Class',\n      items: classes\n    }] : [];\n    return rowColCountItems.concat(alwaysItems).concat(appearanceItems).concat(alignmentItem).concat(classListItem);\n  };\n\n  var styleTDTH = function (dom, elm, name, value) {\n    if (elm.tagName === 'TD' || elm.tagName === 'TH') {\n      if (isString(name)) {\n        dom.setStyle(elm, name, value);\n      } else {\n        dom.setStyle(elm, name);\n      }\n    } else {\n      if (elm.children) {\n        for (var i = 0; i < elm.children.length; i++) {\n          styleTDTH(dom, elm.children[i], name, value);\n        }\n      }\n    }\n  };\n\n  var applyDataToElement = function (editor, tableElm, data) {\n    var dom = editor.dom;\n    var attrs = {};\n    var styles = {};\n    attrs.class = data.class;\n    styles.height = addPxSuffix(data.height);\n\n    if (dom.getAttrib(tableElm, 'width') && !shouldStyleWithCss(editor)) {\n      attrs.width = removePxSuffix(data.width);\n    } else {\n      styles.width = addPxSuffix(data.width);\n    }\n\n    if (shouldStyleWithCss(editor)) {\n      styles['border-width'] = addPxSuffix(data.border);\n      styles['border-spacing'] = addPxSuffix(data.cellspacing);\n    } else {\n      attrs.border = data.border;\n      attrs.cellpadding = data.cellpadding;\n      attrs.cellspacing = data.cellspacing;\n    }\n\n    if (shouldStyleWithCss(editor) && tableElm.children) {\n      for (var i = 0; i < tableElm.children.length; i++) {\n        styleTDTH(dom, tableElm.children[i], {\n          'border-width': addPxSuffix(data.border),\n          'padding': addPxSuffix(data.cellpadding)\n        });\n\n        if (hasAdvancedTableTab(editor)) {\n          styleTDTH(dom, tableElm.children[i], {\n            'border-color': data.bordercolor\n          });\n        }\n      }\n    }\n\n    if (hasAdvancedTableTab(editor)) {\n      styles['background-color'] = data.backgroundcolor;\n      styles['border-color'] = data.bordercolor;\n      styles['border-style'] = data.borderstyle;\n    }\n\n    attrs.style = dom.serializeStyle(__assign(__assign({}, getDefaultStyles(editor)), styles));\n    dom.setAttribs(tableElm, __assign(__assign({}, getDefaultAttributes(editor)), attrs));\n  };\n\n  var onSubmitTableForm = function (editor, tableElm, oldData, api) {\n    var dom = editor.dom;\n    var captionElm;\n    var data = api.getData();\n    var modifiedData = filter$1(data, function (value, key) {\n      return oldData[key] !== value;\n    });\n    api.close();\n\n    if (data.class === '') {\n      delete data.class;\n    }\n\n    editor.undoManager.transact(function () {\n      if (!tableElm) {\n        var cols = parseInt(data.cols, 10) || 1;\n        var rows = parseInt(data.rows, 10) || 1;\n        tableElm = insert$1(editor, cols, rows, 0, 0);\n      }\n\n      if (size(modifiedData) > 0) {\n        applyDataToElement(editor, tableElm, data);\n        captionElm = dom.select('caption', tableElm)[0];\n\n        if (captionElm && !data.caption) {\n          dom.remove(captionElm);\n        }\n\n        if (!captionElm && data.caption) {\n          captionElm = dom.create('caption');\n          captionElm.innerHTML = !global$2.ie ? '<br data-mce-bogus=\"1\"/>' : nbsp;\n          tableElm.insertBefore(captionElm, tableElm.firstChild);\n        }\n\n        if (data.align === '') {\n          unApplyAlign(editor, tableElm);\n        } else {\n          applyAlign(editor, tableElm, data.align);\n        }\n      }\n\n      editor.focus();\n      editor.addVisual();\n\n      if (size(modifiedData) > 0) {\n        var captionModified = has(modifiedData, 'caption');\n        var styleModified = captionModified ? size(modifiedData) > 1 : true;\n        fireTableModified(editor, tableElm, {\n          structure: captionModified,\n          style: styleModified\n        });\n      }\n    });\n  };\n\n  var open$2 = function (editor, insertNewTable) {\n    var dom = editor.dom;\n    var tableElm;\n    var data = extractDataFromSettings(editor, hasAdvancedTableTab(editor));\n\n    if (insertNewTable === false) {\n      tableElm = dom.getParent(editor.selection.getStart(), 'table', editor.getBody());\n\n      if (tableElm) {\n        data = extractDataFromTableElement(editor, tableElm, hasAdvancedTableTab(editor));\n      } else {\n        if (hasAdvancedTableTab(editor)) {\n          data.borderstyle = '';\n          data.bordercolor = '';\n          data.backgroundcolor = '';\n        }\n      }\n    } else {\n      data.cols = '1';\n      data.rows = '1';\n\n      if (hasAdvancedTableTab(editor)) {\n        data.borderstyle = '';\n        data.bordercolor = '';\n        data.backgroundcolor = '';\n      }\n    }\n\n    var classes = buildListItems(getTableClassList(editor));\n\n    if (classes.length > 0) {\n      if (data.class) {\n        data.class = data.class.replace(/\\s*mce\\-item\\-table\\s*/g, '');\n      }\n    }\n\n    var generalPanel = {\n      type: 'grid',\n      columns: 2,\n      items: getItems$2(editor, classes, insertNewTable)\n    };\n\n    var nonAdvancedForm = function () {\n      return {\n        type: 'panel',\n        items: [generalPanel]\n      };\n    };\n\n    var advancedForm = function () {\n      return {\n        type: 'tabpanel',\n        tabs: [{\n          title: 'General',\n          name: 'general',\n          items: [generalPanel]\n        }, getAdvancedTab('table')]\n      };\n    };\n\n    var dialogBody = hasAdvancedTableTab(editor) ? advancedForm() : nonAdvancedForm();\n    editor.windowManager.open({\n      title: 'Table Properties',\n      size: 'normal',\n      body: dialogBody,\n      onSubmit: curry(onSubmitTableForm, editor, tableElm, data),\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      initialData: data\n    });\n  };\n\n  var getSelectionStartCellOrCaption$1 = function (editor) {\n    return getSelectionStartCellOrCaption(getSelectionStart(editor), getIsRoot(editor));\n  };\n\n  var getSelectionStartCell$1 = function (editor) {\n    return getSelectionStartCell(getSelectionStart(editor), getIsRoot(editor));\n  };\n\n  var registerCommands = function (editor, actions, cellSelection, selections, clipboard) {\n    var isRoot = getIsRoot(editor);\n\n    var eraseTable = function () {\n      return getSelectionStartCellOrCaption$1(editor).each(function (cellOrCaption) {\n        table(cellOrCaption, isRoot).filter(not(isRoot)).each(function (table) {\n          var cursor = SugarElement.fromText('');\n          after(table, cursor);\n          remove$2(table);\n\n          if (editor.dom.isEmpty(editor.getBody())) {\n            editor.setContent('');\n            editor.selection.setCursorLocation();\n          } else {\n            var rng = editor.dom.createRng();\n            rng.setStart(cursor.dom, 0);\n            rng.setEnd(cursor.dom, 0);\n            editor.selection.setRng(rng);\n            editor.nodeChanged();\n          }\n        });\n      });\n    };\n\n    var setSizingMode = function (sizing) {\n      return getSelectionStartCellOrCaption$1(editor).each(function (cellOrCaption) {\n        var isForcedSizing = isResponsiveForced(editor) || isPixelsForced(editor) || isPercentagesForced(editor);\n\n        if (!isForcedSizing) {\n          table(cellOrCaption, isRoot).each(function (table) {\n            if (sizing === 'relative' && !isPercentSizing$1(table)) {\n              enforcePercentage(editor, table);\n            } else if (sizing === 'fixed' && !isPixelSizing$1(table)) {\n              enforcePixels(editor, table);\n            } else if (sizing === 'responsive' && !isNoneSizing$1(table)) {\n              enforceNone(table);\n            }\n\n            removeDataStyle(table);\n            fireTableModified(editor, table.dom, structureModified);\n          });\n        }\n      });\n    };\n\n    var getTableFromCell = function (cell) {\n      return table(cell, isRoot);\n    };\n\n    var postExecute = function (table) {\n      return function (data) {\n        editor.selection.setRng(data.rng);\n        editor.focus();\n        cellSelection.clear(table);\n        removeDataStyle(table);\n        fireTableModified(editor, table.dom, data.effect);\n      };\n    };\n\n    var actOnSelection = function (execute) {\n      return getSelectionStartCell$1(editor).each(function (cell) {\n        getTableFromCell(cell).each(function (table) {\n          var targets = forMenu(selections, table, cell);\n          execute(table, targets).each(postExecute(table));\n        });\n      });\n    };\n\n    var copyRowSelection = function () {\n      return getSelectionStartCell$1(editor).map(function (cell) {\n        return getTableFromCell(cell).bind(function (table) {\n          var targets = forMenu(selections, table, cell);\n          var generators = cellOperations(noop, SugarElement.fromDom(editor.getDoc()), Optional.none());\n          return copyRows(table, targets, generators);\n        });\n      });\n    };\n\n    var copyColSelection = function () {\n      return getSelectionStartCell$1(editor).map(function (cell) {\n        return getTableFromCell(cell).bind(function (table) {\n          var targets = forMenu(selections, table, cell);\n          return copyCols(table, targets);\n        });\n      });\n    };\n\n    var pasteOnSelection = function (execute, getRows) {\n      return getRows().each(function (rows) {\n        var clonedRows = map(rows, function (row) {\n          return deep(row);\n        });\n        getSelectionStartCell$1(editor).each(function (cell) {\n          return getTableFromCell(cell).each(function (table) {\n            var generators = paste(SugarElement.fromDom(editor.getDoc()));\n            var targets = pasteRows(selections, cell, clonedRows, generators);\n            execute(table, targets).each(postExecute(table));\n          });\n        });\n      });\n    };\n\n    each$1({\n      mceTableSplitCells: function () {\n        return actOnSelection(actions.unmergeCells);\n      },\n      mceTableMergeCells: function () {\n        return actOnSelection(actions.mergeCells);\n      },\n      mceTableInsertRowBefore: function () {\n        return actOnSelection(actions.insertRowsBefore);\n      },\n      mceTableInsertRowAfter: function () {\n        return actOnSelection(actions.insertRowsAfter);\n      },\n      mceTableInsertColBefore: function () {\n        return actOnSelection(actions.insertColumnsBefore);\n      },\n      mceTableInsertColAfter: function () {\n        return actOnSelection(actions.insertColumnsAfter);\n      },\n      mceTableDeleteCol: function () {\n        return actOnSelection(actions.deleteColumn);\n      },\n      mceTableDeleteRow: function () {\n        return actOnSelection(actions.deleteRow);\n      },\n      mceTableCutCol: function (_grid) {\n        return copyColSelection().each(function (selection) {\n          clipboard.setColumns(selection);\n          actOnSelection(actions.deleteColumn);\n        });\n      },\n      mceTableCutRow: function (_grid) {\n        return copyRowSelection().each(function (selection) {\n          clipboard.setRows(selection);\n          actOnSelection(actions.deleteRow);\n        });\n      },\n      mceTableCopyCol: function (_grid) {\n        return copyColSelection().each(function (selection) {\n          return clipboard.setColumns(selection);\n        });\n      },\n      mceTableCopyRow: function (_grid) {\n        return copyRowSelection().each(function (selection) {\n          return clipboard.setRows(selection);\n        });\n      },\n      mceTablePasteColBefore: function (_grid) {\n        return pasteOnSelection(actions.pasteColsBefore, clipboard.getColumns);\n      },\n      mceTablePasteColAfter: function (_grid) {\n        return pasteOnSelection(actions.pasteColsAfter, clipboard.getColumns);\n      },\n      mceTablePasteRowBefore: function (_grid) {\n        return pasteOnSelection(actions.pasteRowsBefore, clipboard.getRows);\n      },\n      mceTablePasteRowAfter: function (_grid) {\n        return pasteOnSelection(actions.pasteRowsAfter, clipboard.getRows);\n      },\n      mceTableDelete: eraseTable,\n      mceTableSizingMode: function (ui, sizing) {\n        return setSizingMode(sizing);\n      }\n    }, function (func, name) {\n      return editor.addCommand(name, func);\n    });\n\n    var fireTableModifiedForSelection = function (editor, tableOpt) {\n      tableOpt.each(function (table) {\n        fireTableModified(editor, table.dom, structureModified);\n      });\n    };\n\n    each$1({\n      mceTableCellType: function (_ui, args) {\n        var tableOpt = table(getSelectionStart(editor), isRoot);\n        actions.setTableCellType(editor, args);\n        fireTableModifiedForSelection(editor, tableOpt);\n      },\n      mceTableRowType: function (_ui, args) {\n        var tableOpt = table(getSelectionStart(editor), isRoot);\n        actions.setTableRowType(editor, args);\n        fireTableModifiedForSelection(editor, tableOpt);\n      }\n    }, function (func, name) {\n      return editor.addCommand(name, func);\n    });\n    editor.addCommand('mceTableColType', function (_ui, args) {\n      return get$1(args, 'type').each(function (type) {\n        return actOnSelection(type === 'th' ? actions.makeColumnsHeader : actions.unmakeColumnsHeader);\n      });\n    });\n    each$1({\n      mceTableProps: curry(open$2, editor, false),\n      mceTableRowProps: curry(open$1, editor),\n      mceTableCellProps: curry(open, editor, selections)\n    }, function (func, name) {\n      return editor.addCommand(name, function () {\n        return func();\n      });\n    });\n    editor.addCommand('mceInsertTable', function (_ui, args) {\n      if (isObject(args) && keys(args).length > 0) {\n        insertTableWithDataValidation(editor, args.rows, args.columns, args.options, 'Invalid values for mceInsertTable - rows and columns values are required to insert a table.');\n      } else {\n        open$2(editor, true);\n      }\n    });\n    editor.addCommand('mceTableApplyCellStyle', function (_ui, args) {\n      var getFormatName = function (style) {\n        return 'tablecell' + style.toLowerCase().replace('-', '');\n      };\n\n      if (!isObject(args)) {\n        return;\n      }\n\n      var cells = getCellsFromSelection(getSelectionStart(editor), selections, isRoot);\n\n      if (cells.length === 0) {\n        return;\n      }\n\n      var validArgs = filter$1(args, function (value, style) {\n        return editor.formatter.has(getFormatName(style)) && isString(value);\n      });\n\n      if (isEmpty(validArgs)) {\n        return;\n      }\n\n      each$1(validArgs, function (value, style) {\n        each(cells, function (cell) {\n          DomModifier.normal(editor, cell.dom).setFormat(getFormatName(style), value);\n        });\n      });\n      getTableFromCell(cells[0]).each(function (table) {\n        return fireTableModified(editor, table.dom, styleModified);\n      });\n    });\n  };\n\n  var registerQueryCommands = function (editor, actions, selections) {\n    var isRoot = getIsRoot(editor);\n\n    var getTableFromCell = function (cell) {\n      return table(cell, isRoot);\n    };\n\n    each$1({\n      mceTableRowType: function () {\n        return actions.getTableRowType(editor);\n      },\n      mceTableCellType: function () {\n        return actions.getTableCellType(editor);\n      },\n      mceTableColType: function () {\n        return getSelectionStartCell(getSelectionStart(editor)).bind(function (cell) {\n          return getTableFromCell(cell).map(function (table) {\n            var targets = forMenu(selections, table, cell);\n            return actions.getTableColType(table, targets);\n          });\n        }).getOr('');\n      }\n    }, function (func, name) {\n      return editor.addQueryValueHandler(name, func);\n    });\n  };\n\n  var Clipboard = function () {\n    var rows = Cell(Optional.none());\n    var cols = Cell(Optional.none());\n\n    var clearClipboard = function (clipboard) {\n      clipboard.set(Optional.none());\n    };\n\n    return {\n      getRows: rows.get,\n      setRows: function (r) {\n        rows.set(r);\n        clearClipboard(cols);\n      },\n      clearRows: function () {\n        return clearClipboard(rows);\n      },\n      getColumns: cols.get,\n      setColumns: function (c) {\n        cols.set(c);\n        clearClipboard(rows);\n      },\n      clearColumns: function () {\n        return clearClipboard(cols);\n      }\n    };\n  };\n\n  var cellFormats = {\n    tablecellbackgroundcolor: {\n      selector: 'td,th',\n      styles: {\n        backgroundColor: '%value'\n      },\n      remove_similar: true\n    },\n    tablecellbordercolor: {\n      selector: 'td,th',\n      styles: {\n        borderColor: '%value'\n      },\n      remove_similar: true\n    },\n    tablecellborderstyle: {\n      selector: 'td,th',\n      styles: {\n        borderStyle: '%value'\n      },\n      remove_similar: true\n    },\n    tablecellborderwidth: {\n      selector: 'td,th',\n      styles: {\n        borderWidth: '%value'\n      },\n      remove_similar: true\n    }\n  };\n\n  var registerFormats = function (editor) {\n    editor.formatter.register(cellFormats);\n  };\n\n  var adt$2 = Adt.generate([{\n    none: ['current']\n  }, {\n    first: ['current']\n  }, {\n    middle: ['current', 'target']\n  }, {\n    last: ['current']\n  }]);\n\n  var none$2 = function (current) {\n    if (current === void 0) {\n      current = undefined;\n    }\n\n    return adt$2.none(current);\n  };\n\n  var CellLocation = __assign(__assign({}, adt$2), {\n    none: none$2\n  });\n\n  var detect$5 = function (current, isRoot) {\n    return table(current, isRoot).bind(function (table) {\n      var all = cells(table);\n      var index = findIndex(all, function (x) {\n        return eq$1(current, x);\n      });\n      return index.map(function (index) {\n        return {\n          index: index,\n          all: all\n        };\n      });\n    });\n  };\n\n  var next = function (current, isRoot) {\n    var detection = detect$5(current, isRoot);\n    return detection.fold(function () {\n      return CellLocation.none(current);\n    }, function (info) {\n      return info.index + 1 < info.all.length ? CellLocation.middle(current, info.all[info.index + 1]) : CellLocation.last(current);\n    });\n  };\n\n  var prev = function (current, isRoot) {\n    var detection = detect$5(current, isRoot);\n    return detection.fold(function () {\n      return CellLocation.none();\n    }, function (info) {\n      return info.index - 1 >= 0 ? CellLocation.middle(current, info.all[info.index - 1]) : CellLocation.first(current);\n    });\n  };\n\n  var create$2 = function (start, soffset, finish, foffset) {\n    return {\n      start: start,\n      soffset: soffset,\n      finish: finish,\n      foffset: foffset\n    };\n  };\n\n  var SimRange = {\n    create: create$2\n  };\n  var adt$3 = Adt.generate([{\n    before: ['element']\n  }, {\n    on: ['element', 'offset']\n  }, {\n    after: ['element']\n  }]);\n\n  var cata$1 = function (subject, onBefore, onOn, onAfter) {\n    return subject.fold(onBefore, onOn, onAfter);\n  };\n\n  var getStart = function (situ) {\n    return situ.fold(identity, identity, identity);\n  };\n\n  var before$2 = adt$3.before;\n  var on = adt$3.on;\n  var after$2 = adt$3.after;\n  var Situ = {\n    before: before$2,\n    on: on,\n    after: after$2,\n    cata: cata$1,\n    getStart: getStart\n  };\n  var adt$4 = Adt.generate([{\n    domRange: ['rng']\n  }, {\n    relative: ['startSitu', 'finishSitu']\n  }, {\n    exact: ['start', 'soffset', 'finish', 'foffset']\n  }]);\n\n  var exactFromRange = function (simRange) {\n    return adt$4.exact(simRange.start, simRange.soffset, simRange.finish, simRange.foffset);\n  };\n\n  var getStart$1 = function (selection) {\n    return selection.match({\n      domRange: function (rng) {\n        return SugarElement.fromDom(rng.startContainer);\n      },\n      relative: function (startSitu, _finishSitu) {\n        return Situ.getStart(startSitu);\n      },\n      exact: function (start, _soffset, _finish, _foffset) {\n        return start;\n      }\n    });\n  };\n\n  var domRange = adt$4.domRange;\n  var relative = adt$4.relative;\n  var exact = adt$4.exact;\n\n  var getWin = function (selection) {\n    var start = getStart$1(selection);\n    return defaultView(start);\n  };\n\n  var range$1 = SimRange.create;\n  var SimSelection = {\n    domRange: domRange,\n    relative: relative,\n    exact: exact,\n    exactFromRange: exactFromRange,\n    getWin: getWin,\n    range: range$1\n  };\n\n  var selectNodeContents = function (win, element) {\n    var rng = win.document.createRange();\n    selectNodeContentsUsing(rng, element);\n    return rng;\n  };\n\n  var selectNodeContentsUsing = function (rng, element) {\n    return rng.selectNodeContents(element.dom);\n  };\n\n  var setStart = function (rng, situ) {\n    situ.fold(function (e) {\n      rng.setStartBefore(e.dom);\n    }, function (e, o) {\n      rng.setStart(e.dom, o);\n    }, function (e) {\n      rng.setStartAfter(e.dom);\n    });\n  };\n\n  var setFinish = function (rng, situ) {\n    situ.fold(function (e) {\n      rng.setEndBefore(e.dom);\n    }, function (e, o) {\n      rng.setEnd(e.dom, o);\n    }, function (e) {\n      rng.setEndAfter(e.dom);\n    });\n  };\n\n  var relativeToNative = function (win, startSitu, finishSitu) {\n    var range = win.document.createRange();\n    setStart(range, startSitu);\n    setFinish(range, finishSitu);\n    return range;\n  };\n\n  var exactToNative = function (win, start, soffset, finish, foffset) {\n    var rng = win.document.createRange();\n    rng.setStart(start.dom, soffset);\n    rng.setEnd(finish.dom, foffset);\n    return rng;\n  };\n\n  var toRect = function (rect) {\n    return {\n      left: rect.left,\n      top: rect.top,\n      right: rect.right,\n      bottom: rect.bottom,\n      width: rect.width,\n      height: rect.height\n    };\n  };\n\n  var getFirstRect = function (rng) {\n    var rects = rng.getClientRects();\n    var rect = rects.length > 0 ? rects[0] : rng.getBoundingClientRect();\n    return rect.width > 0 || rect.height > 0 ? Optional.some(rect).map(toRect) : Optional.none();\n  };\n\n  var adt$5 = Adt.generate([{\n    ltr: ['start', 'soffset', 'finish', 'foffset']\n  }, {\n    rtl: ['start', 'soffset', 'finish', 'foffset']\n  }]);\n\n  var fromRange = function (win, type, range) {\n    return type(SugarElement.fromDom(range.startContainer), range.startOffset, SugarElement.fromDom(range.endContainer), range.endOffset);\n  };\n\n  var getRanges = function (win, selection) {\n    return selection.match({\n      domRange: function (rng) {\n        return {\n          ltr: constant(rng),\n          rtl: Optional.none\n        };\n      },\n      relative: function (startSitu, finishSitu) {\n        return {\n          ltr: cached(function () {\n            return relativeToNative(win, startSitu, finishSitu);\n          }),\n          rtl: cached(function () {\n            return Optional.some(relativeToNative(win, finishSitu, startSitu));\n          })\n        };\n      },\n      exact: function (start, soffset, finish, foffset) {\n        return {\n          ltr: cached(function () {\n            return exactToNative(win, start, soffset, finish, foffset);\n          }),\n          rtl: cached(function () {\n            return Optional.some(exactToNative(win, finish, foffset, start, soffset));\n          })\n        };\n      }\n    });\n  };\n\n  var doDiagnose = function (win, ranges) {\n    var rng = ranges.ltr();\n\n    if (rng.collapsed) {\n      var reversed = ranges.rtl().filter(function (rev) {\n        return rev.collapsed === false;\n      });\n      return reversed.map(function (rev) {\n        return adt$5.rtl(SugarElement.fromDom(rev.endContainer), rev.endOffset, SugarElement.fromDom(rev.startContainer), rev.startOffset);\n      }).getOrThunk(function () {\n        return fromRange(win, adt$5.ltr, rng);\n      });\n    } else {\n      return fromRange(win, adt$5.ltr, rng);\n    }\n  };\n\n  var diagnose = function (win, selection) {\n    var ranges = getRanges(win, selection);\n    return doDiagnose(win, ranges);\n  };\n\n  var asLtrRange = function (win, selection) {\n    var diagnosis = diagnose(win, selection);\n    return diagnosis.match({\n      ltr: function (start, soffset, finish, foffset) {\n        var rng = win.document.createRange();\n        rng.setStart(start.dom, soffset);\n        rng.setEnd(finish.dom, foffset);\n        return rng;\n      },\n      rtl: function (start, soffset, finish, foffset) {\n        var rng = win.document.createRange();\n        rng.setStart(finish.dom, foffset);\n        rng.setEnd(start.dom, soffset);\n        return rng;\n      }\n    });\n  };\n\n  var ltr$1 = adt$5.ltr;\n  var rtl$1 = adt$5.rtl;\n\n  var searchForPoint = function (rectForOffset, x, y, maxX, length) {\n    if (length === 0) {\n      return 0;\n    } else if (x === maxX) {\n      return length - 1;\n    }\n\n    var xDelta = maxX;\n\n    for (var i = 1; i < length; i++) {\n      var rect = rectForOffset(i);\n      var curDeltaX = Math.abs(x - rect.left);\n\n      if (y <= rect.bottom) {\n        if (y < rect.top || curDeltaX > xDelta) {\n          return i - 1;\n        } else {\n          xDelta = curDeltaX;\n        }\n      }\n    }\n\n    return 0;\n  };\n\n  var inRect = function (rect, x, y) {\n    return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;\n  };\n\n  var locateOffset = function (doc, textnode, x, y, rect) {\n    var rangeForOffset = function (o) {\n      var r = doc.dom.createRange();\n      r.setStart(textnode.dom, o);\n      r.collapse(true);\n      return r;\n    };\n\n    var rectForOffset = function (o) {\n      var r = rangeForOffset(o);\n      return r.getBoundingClientRect();\n    };\n\n    var length = get$4(textnode).length;\n    var offset = searchForPoint(rectForOffset, x, y, rect.right, length);\n    return rangeForOffset(offset);\n  };\n\n  var locate = function (doc, node, x, y) {\n    var r = doc.dom.createRange();\n    r.selectNode(node.dom);\n    var rects = r.getClientRects();\n    var foundRect = findMap(rects, function (rect) {\n      return inRect(rect, x, y) ? Optional.some(rect) : Optional.none();\n    });\n    return foundRect.map(function (rect) {\n      return locateOffset(doc, node, x, y, rect);\n    });\n  };\n\n  var searchInChildren = function (doc, node, x, y) {\n    var r = doc.dom.createRange();\n    var nodes = children(node);\n    return findMap(nodes, function (n) {\n      r.selectNode(n.dom);\n      return inRect(r.getBoundingClientRect(), x, y) ? locateNode(doc, n, x, y) : Optional.none();\n    });\n  };\n\n  var locateNode = function (doc, node, x, y) {\n    return isText(node) ? locate(doc, node, x, y) : searchInChildren(doc, node, x, y);\n  };\n\n  var locate$1 = function (doc, node, x, y) {\n    var r = doc.dom.createRange();\n    r.selectNode(node.dom);\n    var rect = r.getBoundingClientRect();\n    var boundedX = Math.max(rect.left, Math.min(rect.right, x));\n    var boundedY = Math.max(rect.top, Math.min(rect.bottom, y));\n    return locateNode(doc, node, boundedX, boundedY);\n  };\n\n  var COLLAPSE_TO_LEFT = true;\n  var COLLAPSE_TO_RIGHT = false;\n\n  var getCollapseDirection = function (rect, x) {\n    return x - rect.left < rect.right - x ? COLLAPSE_TO_LEFT : COLLAPSE_TO_RIGHT;\n  };\n\n  var createCollapsedNode = function (doc, target, collapseDirection) {\n    var r = doc.dom.createRange();\n    r.selectNode(target.dom);\n    r.collapse(collapseDirection);\n    return r;\n  };\n\n  var locateInElement = function (doc, node, x) {\n    var cursorRange = doc.dom.createRange();\n    cursorRange.selectNode(node.dom);\n    var rect = cursorRange.getBoundingClientRect();\n    var collapseDirection = getCollapseDirection(rect, x);\n    var f = collapseDirection === COLLAPSE_TO_LEFT ? first : last$1;\n    return f(node).map(function (target) {\n      return createCollapsedNode(doc, target, collapseDirection);\n    });\n  };\n\n  var locateInEmpty = function (doc, node, x) {\n    var rect = node.dom.getBoundingClientRect();\n    var collapseDirection = getCollapseDirection(rect, x);\n    return Optional.some(createCollapsedNode(doc, node, collapseDirection));\n  };\n\n  var search = function (doc, node, x) {\n    var f = children(node).length === 0 ? locateInEmpty : locateInElement;\n    return f(doc, node, x);\n  };\n\n  var caretPositionFromPoint = function (doc, x, y) {\n    return Optional.from(doc.dom.caretPositionFromPoint(x, y)).bind(function (pos) {\n      if (pos.offsetNode === null) {\n        return Optional.none();\n      }\n\n      var r = doc.dom.createRange();\n      r.setStart(pos.offsetNode, pos.offset);\n      r.collapse();\n      return Optional.some(r);\n    });\n  };\n\n  var caretRangeFromPoint = function (doc, x, y) {\n    return Optional.from(doc.dom.caretRangeFromPoint(x, y));\n  };\n\n  var searchTextNodes = function (doc, node, x, y) {\n    var r = doc.dom.createRange();\n    r.selectNode(node.dom);\n    var rect = r.getBoundingClientRect();\n    var boundedX = Math.max(rect.left, Math.min(rect.right, x));\n    var boundedY = Math.max(rect.top, Math.min(rect.bottom, y));\n    return locate$1(doc, node, boundedX, boundedY);\n  };\n\n  var searchFromPoint = function (doc, x, y) {\n    return SugarElement.fromPoint(doc, x, y).bind(function (elem) {\n      var fallback = function () {\n        return search(doc, elem, x);\n      };\n\n      return children(elem).length === 0 ? fallback() : searchTextNodes(doc, elem, x, y).orThunk(fallback);\n    });\n  };\n\n  var availableSearch = function () {\n    if (document.caretPositionFromPoint) {\n      return caretPositionFromPoint;\n    } else if (document.caretRangeFromPoint) {\n      return caretRangeFromPoint;\n    } else {\n      return searchFromPoint;\n    }\n  }();\n\n  var fromPoint$1 = function (win, x, y) {\n    var doc = SugarElement.fromDom(win.document);\n    return availableSearch(doc, x, y).map(function (rng) {\n      return SimRange.create(SugarElement.fromDom(rng.startContainer), rng.startOffset, SugarElement.fromDom(rng.endContainer), rng.endOffset);\n    });\n  };\n\n  var beforeSpecial = function (element, offset) {\n    var name$1 = name(element);\n\n    if ('input' === name$1) {\n      return Situ.after(element);\n    } else if (!contains(['br', 'img'], name$1)) {\n      return Situ.on(element, offset);\n    } else {\n      return offset === 0 ? Situ.before(element) : Situ.after(element);\n    }\n  };\n\n  var preprocessRelative = function (startSitu, finishSitu) {\n    var start = startSitu.fold(Situ.before, beforeSpecial, Situ.after);\n    var finish = finishSitu.fold(Situ.before, beforeSpecial, Situ.after);\n    return SimSelection.relative(start, finish);\n  };\n\n  var preprocessExact = function (start, soffset, finish, foffset) {\n    var startSitu = beforeSpecial(start, soffset);\n    var finishSitu = beforeSpecial(finish, foffset);\n    return SimSelection.relative(startSitu, finishSitu);\n  };\n\n  var preprocess = function (selection) {\n    return selection.match({\n      domRange: function (rng) {\n        var start = SugarElement.fromDom(rng.startContainer);\n        var finish = SugarElement.fromDom(rng.endContainer);\n        return preprocessExact(start, rng.startOffset, finish, rng.endOffset);\n      },\n      relative: preprocessRelative,\n      exact: preprocessExact\n    });\n  };\n\n  var makeRange = function (start, soffset, finish, foffset) {\n    var doc = owner(start);\n    var rng = doc.dom.createRange();\n    rng.setStart(start.dom, soffset);\n    rng.setEnd(finish.dom, foffset);\n    return rng;\n  };\n\n  var after$3 = function (start, soffset, finish, foffset) {\n    var r = makeRange(start, soffset, finish, foffset);\n    var same = eq$1(start, finish) && soffset === foffset;\n    return r.collapsed && !same;\n  };\n\n  var getNativeSelection = function (win) {\n    return Optional.from(win.getSelection());\n  };\n\n  var doSetNativeRange = function (win, rng) {\n    getNativeSelection(win).each(function (selection) {\n      selection.removeAllRanges();\n      selection.addRange(rng);\n    });\n  };\n\n  var doSetRange = function (win, start, soffset, finish, foffset) {\n    var rng = exactToNative(win, start, soffset, finish, foffset);\n    doSetNativeRange(win, rng);\n  };\n\n  var setLegacyRtlRange = function (win, selection, start, soffset, finish, foffset) {\n    selection.collapse(start.dom, soffset);\n    selection.extend(finish.dom, foffset);\n  };\n\n  var setRangeFromRelative = function (win, relative) {\n    return diagnose(win, relative).match({\n      ltr: function (start, soffset, finish, foffset) {\n        doSetRange(win, start, soffset, finish, foffset);\n      },\n      rtl: function (start, soffset, finish, foffset) {\n        getNativeSelection(win).each(function (selection) {\n          if (selection.setBaseAndExtent) {\n            selection.setBaseAndExtent(start.dom, soffset, finish.dom, foffset);\n          } else if (selection.extend) {\n            try {\n              setLegacyRtlRange(win, selection, start, soffset, finish, foffset);\n            } catch (e) {\n              doSetRange(win, finish, foffset, start, soffset);\n            }\n          } else {\n            doSetRange(win, finish, foffset, start, soffset);\n          }\n        });\n      }\n    });\n  };\n\n  var setExact = function (win, start, soffset, finish, foffset) {\n    var relative = preprocessExact(start, soffset, finish, foffset);\n    setRangeFromRelative(win, relative);\n  };\n\n  var setRelative = function (win, startSitu, finishSitu) {\n    var relative = preprocessRelative(startSitu, finishSitu);\n    setRangeFromRelative(win, relative);\n  };\n\n  var toNative = function (selection) {\n    var win = SimSelection.getWin(selection).dom;\n\n    var getDomRange = function (start, soffset, finish, foffset) {\n      return exactToNative(win, start, soffset, finish, foffset);\n    };\n\n    var filtered = preprocess(selection);\n    return diagnose(win, filtered).match({\n      ltr: getDomRange,\n      rtl: getDomRange\n    });\n  };\n\n  var readRange = function (selection) {\n    if (selection.rangeCount > 0) {\n      var firstRng = selection.getRangeAt(0);\n      var lastRng = selection.getRangeAt(selection.rangeCount - 1);\n      return Optional.some(SimRange.create(SugarElement.fromDom(firstRng.startContainer), firstRng.startOffset, SugarElement.fromDom(lastRng.endContainer), lastRng.endOffset));\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var doGetExact = function (selection) {\n    if (selection.anchorNode === null || selection.focusNode === null) {\n      return readRange(selection);\n    } else {\n      var anchor = SugarElement.fromDom(selection.anchorNode);\n      var focus_1 = SugarElement.fromDom(selection.focusNode);\n      return after$3(anchor, selection.anchorOffset, focus_1, selection.focusOffset) ? Optional.some(SimRange.create(anchor, selection.anchorOffset, focus_1, selection.focusOffset)) : readRange(selection);\n    }\n  };\n\n  var setToElement = function (win, element) {\n    var rng = selectNodeContents(win, element);\n    doSetNativeRange(win, rng);\n  };\n\n  var getExact = function (win) {\n    return getNativeSelection(win).filter(function (sel) {\n      return sel.rangeCount > 0;\n    }).bind(doGetExact);\n  };\n\n  var get$c = function (win) {\n    return getExact(win).map(function (range) {\n      return SimSelection.exact(range.start, range.soffset, range.finish, range.foffset);\n    });\n  };\n\n  var getFirstRect$1 = function (win, selection) {\n    var rng = asLtrRange(win, selection);\n    return getFirstRect(rng);\n  };\n\n  var getAtPoint = function (win, x, y) {\n    return fromPoint$1(win, x, y);\n  };\n\n  var clear = function (win) {\n    getNativeSelection(win).each(function (selection) {\n      return selection.removeAllRanges();\n    });\n  };\n\n  var global$3 = tinymce.util.Tools.resolve('tinymce.util.VK');\n\n  var forward = function (editor, isRoot, cell) {\n    return go(editor, isRoot, next(cell));\n  };\n\n  var backward = function (editor, isRoot, cell) {\n    return go(editor, isRoot, prev(cell));\n  };\n\n  var getCellFirstCursorPosition = function (editor, cell) {\n    var selection = SimSelection.exact(cell, 0, cell, 0);\n    return toNative(selection);\n  };\n\n  var getNewRowCursorPosition = function (editor, table) {\n    var rows = descendants$1(table, 'tr');\n    return last(rows).bind(function (last) {\n      return descendant$1(last, 'td,th').map(function (first) {\n        return getCellFirstCursorPosition(editor, first);\n      });\n    });\n  };\n\n  var go = function (editor, isRoot, cell) {\n    return cell.fold(Optional.none, Optional.none, function (current, next) {\n      return first(next).map(function (cell) {\n        return getCellFirstCursorPosition(editor, cell);\n      });\n    }, function (current) {\n      return table(current, isRoot).bind(function (table) {\n        editor.execCommand('mceTableInsertRowAfter');\n        return getNewRowCursorPosition(editor, table);\n      });\n    });\n  };\n\n  var rootElements = ['table', 'li', 'dl'];\n\n  var handle$1 = function (event, editor, cellSelection) {\n    if (event.keyCode === global$3.TAB) {\n      var body_1 = getBody$1(editor);\n\n      var isRoot_1 = function (element) {\n        var name$1 = name(element);\n        return eq$1(element, body_1) || contains(rootElements, name$1);\n      };\n\n      var rng = editor.selection.getRng();\n      var container = SugarElement.fromDom(event.shiftKey ? rng.startContainer : rng.endContainer);\n      cell(container, isRoot_1).each(function (cell) {\n        event.preventDefault();\n        table(cell, isRoot_1).each(cellSelection.clear);\n        editor.selection.collapse(event.shiftKey);\n        var navigation = event.shiftKey ? backward : forward;\n        var rng = navigation(editor, isRoot_1, cell);\n        rng.each(function (range) {\n          editor.selection.setRng(range);\n        });\n      });\n    }\n  };\n\n  var create$3 = function (selection, kill) {\n    return {\n      selection: selection,\n      kill: kill\n    };\n  };\n\n  var Response = {\n    create: create$3\n  };\n\n  var create$4 = function (start, soffset, finish, foffset) {\n    return {\n      start: Situ.on(start, soffset),\n      finish: Situ.on(finish, foffset)\n    };\n  };\n\n  var Situs = {\n    create: create$4\n  };\n\n  var convertToRange = function (win, selection) {\n    var rng = asLtrRange(win, selection);\n    return SimRange.create(SugarElement.fromDom(rng.startContainer), rng.startOffset, SugarElement.fromDom(rng.endContainer), rng.endOffset);\n  };\n\n  var makeSitus = Situs.create;\n\n  var sync = function (container, isRoot, start, soffset, finish, foffset, selectRange) {\n    if (!(eq$1(start, finish) && soffset === foffset)) {\n      return closest$1(start, 'td,th', isRoot).bind(function (s) {\n        return closest$1(finish, 'td,th', isRoot).bind(function (f) {\n          return detect$6(container, isRoot, s, f, selectRange);\n        });\n      });\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var detect$6 = function (container, isRoot, start, finish, selectRange) {\n    if (!eq$1(start, finish)) {\n      return identify(start, finish, isRoot).bind(function (cellSel) {\n        var boxes = cellSel.boxes.getOr([]);\n\n        if (boxes.length > 0) {\n          selectRange(container, boxes, cellSel.start, cellSel.finish);\n          return Optional.some(Response.create(Optional.some(makeSitus(start, 0, start, getEnd(start))), true));\n        } else {\n          return Optional.none();\n        }\n      });\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var update = function (rows, columns, container, selected, annotations) {\n    var updateSelection = function (newSels) {\n      annotations.clearBeforeUpdate(container);\n      annotations.selectRange(container, newSels.boxes, newSels.start, newSels.finish);\n      return newSels.boxes;\n    };\n\n    return shiftSelection(selected, rows, columns, annotations.firstSelectedSelector, annotations.lastSelectedSelector).map(updateSelection);\n  };\n\n  var traverse = function (item, mode) {\n    return {\n      item: item,\n      mode: mode\n    };\n  };\n\n  var backtrack = function (universe, item, _direction, transition) {\n    if (transition === void 0) {\n      transition = sidestep;\n    }\n\n    return universe.property().parent(item).map(function (p) {\n      return traverse(p, transition);\n    });\n  };\n\n  var sidestep = function (universe, item, direction, transition) {\n    if (transition === void 0) {\n      transition = advance;\n    }\n\n    return direction.sibling(universe, item).map(function (p) {\n      return traverse(p, transition);\n    });\n  };\n\n  var advance = function (universe, item, direction, transition) {\n    if (transition === void 0) {\n      transition = advance;\n    }\n\n    var children = universe.property().children(item);\n    var result = direction.first(children);\n    return result.map(function (r) {\n      return traverse(r, transition);\n    });\n  };\n\n  var successors = [{\n    current: backtrack,\n    next: sidestep,\n    fallback: Optional.none()\n  }, {\n    current: sidestep,\n    next: advance,\n    fallback: Optional.some(backtrack)\n  }, {\n    current: advance,\n    next: advance,\n    fallback: Optional.some(sidestep)\n  }];\n\n  var go$1 = function (universe, item, mode, direction, rules) {\n    if (rules === void 0) {\n      rules = successors;\n    }\n\n    var ruleOpt = find(rules, function (succ) {\n      return succ.current === mode;\n    });\n    return ruleOpt.bind(function (rule) {\n      return rule.current(universe, item, direction, rule.next).orThunk(function () {\n        return rule.fallback.bind(function (fb) {\n          return go$1(universe, item, fb, direction);\n        });\n      });\n    });\n  };\n\n  var left = function () {\n    var sibling = function (universe, item) {\n      return universe.query().prevSibling(item);\n    };\n\n    var first = function (children) {\n      return children.length > 0 ? Optional.some(children[children.length - 1]) : Optional.none();\n    };\n\n    return {\n      sibling: sibling,\n      first: first\n    };\n  };\n\n  var right = function () {\n    var sibling = function (universe, item) {\n      return universe.query().nextSibling(item);\n    };\n\n    var first = function (children) {\n      return children.length > 0 ? Optional.some(children[0]) : Optional.none();\n    };\n\n    return {\n      sibling: sibling,\n      first: first\n    };\n  };\n\n  var Walkers = {\n    left: left,\n    right: right\n  };\n\n  var hone = function (universe, item, predicate, mode, direction, isRoot) {\n    var next = go$1(universe, item, mode, direction);\n    return next.bind(function (n) {\n      if (isRoot(n.item)) {\n        return Optional.none();\n      } else {\n        return predicate(n.item) ? Optional.some(n.item) : hone(universe, n.item, predicate, n.mode, direction, isRoot);\n      }\n    });\n  };\n\n  var left$1 = function (universe, item, predicate, isRoot) {\n    return hone(universe, item, predicate, sidestep, Walkers.left(), isRoot);\n  };\n\n  var right$1 = function (universe, item, predicate, isRoot) {\n    return hone(universe, item, predicate, sidestep, Walkers.right(), isRoot);\n  };\n\n  var isLeaf = function (universe) {\n    return function (element) {\n      return universe.property().children(element).length === 0;\n    };\n  };\n\n  var before$3 = function (universe, item, isRoot) {\n    return seekLeft(universe, item, isLeaf(universe), isRoot);\n  };\n\n  var after$4 = function (universe, item, isRoot) {\n    return seekRight(universe, item, isLeaf(universe), isRoot);\n  };\n\n  var seekLeft = left$1;\n  var seekRight = right$1;\n  var universe$3 = DomUniverse();\n\n  var before$4 = function (element, isRoot) {\n    return before$3(universe$3, element, isRoot);\n  };\n\n  var after$5 = function (element, isRoot) {\n    return after$4(universe$3, element, isRoot);\n  };\n\n  var seekLeft$1 = function (element, predicate, isRoot) {\n    return seekLeft(universe$3, element, predicate, isRoot);\n  };\n\n  var seekRight$1 = function (element, predicate, isRoot) {\n    return seekRight(universe$3, element, predicate, isRoot);\n  };\n\n  var ancestor$2 = function (scope, predicate, isRoot) {\n    return ancestor(scope, predicate, isRoot).isSome();\n  };\n\n  var adt$6 = Adt.generate([{\n    none: ['message']\n  }, {\n    success: []\n  }, {\n    failedUp: ['cell']\n  }, {\n    failedDown: ['cell']\n  }]);\n\n  var isOverlapping = function (bridge, before, after) {\n    var beforeBounds = bridge.getRect(before);\n    var afterBounds = bridge.getRect(after);\n    return afterBounds.right > beforeBounds.left && afterBounds.left < beforeBounds.right;\n  };\n\n  var isRow = function (elem) {\n    return closest$1(elem, 'tr');\n  };\n\n  var verify = function (bridge, before, beforeOffset, after, afterOffset, failure, isRoot) {\n    return closest$1(after, 'td,th', isRoot).bind(function (afterCell) {\n      return closest$1(before, 'td,th', isRoot).map(function (beforeCell) {\n        if (!eq$1(afterCell, beforeCell)) {\n          return sharedOne$1(isRow, [afterCell, beforeCell]).fold(function () {\n            return isOverlapping(bridge, beforeCell, afterCell) ? adt$6.success() : failure(beforeCell);\n          }, function (_sharedRow) {\n            return failure(beforeCell);\n          });\n        } else {\n          return eq$1(after, afterCell) && getEnd(afterCell) === afterOffset ? failure(beforeCell) : adt$6.none('in same cell');\n        }\n      });\n    }).getOr(adt$6.none('default'));\n  };\n\n  var cata$2 = function (subject, onNone, onSuccess, onFailedUp, onFailedDown) {\n    return subject.fold(onNone, onSuccess, onFailedUp, onFailedDown);\n  };\n\n  var BeforeAfter = __assign(__assign({}, adt$6), {\n    verify: verify,\n    cata: cata$2\n  });\n\n  var inParent = function (parent, children, element, index) {\n    return {\n      parent: parent,\n      children: children,\n      element: element,\n      index: index\n    };\n  };\n\n  var indexInParent = function (element) {\n    return parent(element).bind(function (parent) {\n      var children$1 = children(parent);\n      return indexOf(children$1, element).map(function (index) {\n        return inParent(parent, children$1, element, index);\n      });\n    });\n  };\n\n  var indexOf = function (elements, element) {\n    return findIndex(elements, curry(eq$1, element));\n  };\n\n  var isBr = function (elem) {\n    return name(elem) === 'br';\n  };\n\n  var gatherer = function (cand, gather, isRoot) {\n    return gather(cand, isRoot).bind(function (target) {\n      return isText(target) && get$4(target).trim().length === 0 ? gatherer(target, gather, isRoot) : Optional.some(target);\n    });\n  };\n\n  var handleBr = function (isRoot, element, direction) {\n    return direction.traverse(element).orThunk(function () {\n      return gatherer(element, direction.gather, isRoot);\n    }).map(direction.relative);\n  };\n\n  var findBr = function (element, offset) {\n    return child(element, offset).filter(isBr).orThunk(function () {\n      return child(element, offset - 1).filter(isBr);\n    });\n  };\n\n  var handleParent = function (isRoot, element, offset, direction) {\n    return findBr(element, offset).bind(function (br) {\n      return direction.traverse(br).fold(function () {\n        return gatherer(br, direction.gather, isRoot).map(direction.relative);\n      }, function (adjacent) {\n        return indexInParent(adjacent).map(function (info) {\n          return Situ.on(info.parent, info.index);\n        });\n      });\n    });\n  };\n\n  var tryBr = function (isRoot, element, offset, direction) {\n    var target = isBr(element) ? handleBr(isRoot, element, direction) : handleParent(isRoot, element, offset, direction);\n    return target.map(function (tgt) {\n      return {\n        start: tgt,\n        finish: tgt\n      };\n    });\n  };\n\n  var process = function (analysis) {\n    return BeforeAfter.cata(analysis, function (_message) {\n      return Optional.none();\n    }, function () {\n      return Optional.none();\n    }, function (cell) {\n      return Optional.some(point(cell, 0));\n    }, function (cell) {\n      return Optional.some(point(cell, getEnd(cell)));\n    });\n  };\n\n  var moveDown = function (caret, amount) {\n    return {\n      left: caret.left,\n      top: caret.top + amount,\n      right: caret.right,\n      bottom: caret.bottom + amount\n    };\n  };\n\n  var moveUp = function (caret, amount) {\n    return {\n      left: caret.left,\n      top: caret.top - amount,\n      right: caret.right,\n      bottom: caret.bottom - amount\n    };\n  };\n\n  var translate = function (caret, xDelta, yDelta) {\n    return {\n      left: caret.left + xDelta,\n      top: caret.top + yDelta,\n      right: caret.right + xDelta,\n      bottom: caret.bottom + yDelta\n    };\n  };\n\n  var getTop$1 = function (caret) {\n    return caret.top;\n  };\n\n  var getBottom = function (caret) {\n    return caret.bottom;\n  };\n\n  var getPartialBox = function (bridge, element, offset) {\n    if (offset >= 0 && offset < getEnd(element)) {\n      return bridge.getRangedRect(element, offset, element, offset + 1);\n    } else if (offset > 0) {\n      return bridge.getRangedRect(element, offset - 1, element, offset);\n    }\n\n    return Optional.none();\n  };\n\n  var toCaret = function (rect) {\n    return {\n      left: rect.left,\n      top: rect.top,\n      right: rect.right,\n      bottom: rect.bottom\n    };\n  };\n\n  var getElemBox = function (bridge, element) {\n    return Optional.some(bridge.getRect(element));\n  };\n\n  var getBoxAt = function (bridge, element, offset) {\n    if (isElement(element)) {\n      return getElemBox(bridge, element).map(toCaret);\n    } else if (isText(element)) {\n      return getPartialBox(bridge, element, offset).map(toCaret);\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var getEntireBox = function (bridge, element) {\n    if (isElement(element)) {\n      return getElemBox(bridge, element).map(toCaret);\n    } else if (isText(element)) {\n      return bridge.getRangedRect(element, 0, element, getEnd(element)).map(toCaret);\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var JUMP_SIZE = 5;\n  var NUM_RETRIES = 100;\n  var adt$7 = Adt.generate([{\n    none: []\n  }, {\n    retry: ['caret']\n  }]);\n\n  var isOutside = function (caret, box) {\n    return caret.left < box.left || Math.abs(box.right - caret.left) < 1 || caret.left > box.right;\n  };\n\n  var inOutsideBlock = function (bridge, element, caret) {\n    return closest(element, isBlock$1).fold(never, function (cell) {\n      return getEntireBox(bridge, cell).exists(function (box) {\n        return isOutside(caret, box);\n      });\n    });\n  };\n\n  var adjustDown = function (bridge, element, guessBox, original, caret) {\n    var lowerCaret = moveDown(caret, JUMP_SIZE);\n\n    if (Math.abs(guessBox.bottom - original.bottom) < 1) {\n      return adt$7.retry(lowerCaret);\n    } else if (guessBox.top > caret.bottom) {\n      return adt$7.retry(lowerCaret);\n    } else if (guessBox.top === caret.bottom) {\n      return adt$7.retry(moveDown(caret, 1));\n    } else {\n      return inOutsideBlock(bridge, element, caret) ? adt$7.retry(translate(lowerCaret, JUMP_SIZE, 0)) : adt$7.none();\n    }\n  };\n\n  var adjustUp = function (bridge, element, guessBox, original, caret) {\n    var higherCaret = moveUp(caret, JUMP_SIZE);\n\n    if (Math.abs(guessBox.top - original.top) < 1) {\n      return adt$7.retry(higherCaret);\n    } else if (guessBox.bottom < caret.top) {\n      return adt$7.retry(higherCaret);\n    } else if (guessBox.bottom === caret.top) {\n      return adt$7.retry(moveUp(caret, 1));\n    } else {\n      return inOutsideBlock(bridge, element, caret) ? adt$7.retry(translate(higherCaret, JUMP_SIZE, 0)) : adt$7.none();\n    }\n  };\n\n  var upMovement = {\n    point: getTop$1,\n    adjuster: adjustUp,\n    move: moveUp,\n    gather: before$4\n  };\n  var downMovement = {\n    point: getBottom,\n    adjuster: adjustDown,\n    move: moveDown,\n    gather: after$5\n  };\n\n  var isAtTable = function (bridge, x, y) {\n    return bridge.elementFromPoint(x, y).filter(function (elm) {\n      return name(elm) === 'table';\n    }).isSome();\n  };\n\n  var adjustForTable = function (bridge, movement, original, caret, numRetries) {\n    return adjustTil(bridge, movement, original, movement.move(caret, JUMP_SIZE), numRetries);\n  };\n\n  var adjustTil = function (bridge, movement, original, caret, numRetries) {\n    if (numRetries === 0) {\n      return Optional.some(caret);\n    }\n\n    if (isAtTable(bridge, caret.left, movement.point(caret))) {\n      return adjustForTable(bridge, movement, original, caret, numRetries - 1);\n    }\n\n    return bridge.situsFromPoint(caret.left, movement.point(caret)).bind(function (guess) {\n      return guess.start.fold(Optional.none, function (element) {\n        return getEntireBox(bridge, element).bind(function (guessBox) {\n          return movement.adjuster(bridge, element, guessBox, original, caret).fold(Optional.none, function (newCaret) {\n            return adjustTil(bridge, movement, original, newCaret, numRetries - 1);\n          });\n        }).orThunk(function () {\n          return Optional.some(caret);\n        });\n      }, Optional.none);\n    });\n  };\n\n  var ieTryDown = function (bridge, caret) {\n    return bridge.situsFromPoint(caret.left, caret.bottom + JUMP_SIZE);\n  };\n\n  var ieTryUp = function (bridge, caret) {\n    return bridge.situsFromPoint(caret.left, caret.top - JUMP_SIZE);\n  };\n\n  var checkScroll = function (movement, adjusted, bridge) {\n    if (movement.point(adjusted) > bridge.getInnerHeight()) {\n      return Optional.some(movement.point(adjusted) - bridge.getInnerHeight());\n    } else if (movement.point(adjusted) < 0) {\n      return Optional.some(-movement.point(adjusted));\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var retry = function (movement, bridge, caret) {\n    var moved = movement.move(caret, JUMP_SIZE);\n    var adjusted = adjustTil(bridge, movement, caret, moved, NUM_RETRIES).getOr(moved);\n    return checkScroll(movement, adjusted, bridge).fold(function () {\n      return bridge.situsFromPoint(adjusted.left, movement.point(adjusted));\n    }, function (delta) {\n      bridge.scrollBy(0, delta);\n      return bridge.situsFromPoint(adjusted.left, movement.point(adjusted) - delta);\n    });\n  };\n\n  var Retries = {\n    tryUp: curry(retry, upMovement),\n    tryDown: curry(retry, downMovement),\n    ieTryUp: ieTryUp,\n    ieTryDown: ieTryDown,\n    getJumpSize: constant(JUMP_SIZE)\n  };\n  var MAX_RETRIES = 20;\n\n  var findSpot = function (bridge, isRoot, direction) {\n    return bridge.getSelection().bind(function (sel) {\n      return tryBr(isRoot, sel.finish, sel.foffset, direction).fold(function () {\n        return Optional.some(point(sel.finish, sel.foffset));\n      }, function (brNeighbour) {\n        var range = bridge.fromSitus(brNeighbour);\n        var analysis = BeforeAfter.verify(bridge, sel.finish, sel.foffset, range.finish, range.foffset, direction.failure, isRoot);\n        return process(analysis);\n      });\n    });\n  };\n\n  var scan$1 = function (bridge, isRoot, element, offset, direction, numRetries) {\n    if (numRetries === 0) {\n      return Optional.none();\n    }\n\n    return tryCursor(bridge, isRoot, element, offset, direction).bind(function (situs) {\n      var range = bridge.fromSitus(situs);\n      var analysis = BeforeAfter.verify(bridge, element, offset, range.finish, range.foffset, direction.failure, isRoot);\n      return BeforeAfter.cata(analysis, function () {\n        return Optional.none();\n      }, function () {\n        return Optional.some(situs);\n      }, function (cell) {\n        if (eq$1(element, cell) && offset === 0) {\n          return tryAgain(bridge, element, offset, moveUp, direction);\n        } else {\n          return scan$1(bridge, isRoot, cell, 0, direction, numRetries - 1);\n        }\n      }, function (cell) {\n        if (eq$1(element, cell) && offset === getEnd(cell)) {\n          return tryAgain(bridge, element, offset, moveDown, direction);\n        } else {\n          return scan$1(bridge, isRoot, cell, getEnd(cell), direction, numRetries - 1);\n        }\n      });\n    });\n  };\n\n  var tryAgain = function (bridge, element, offset, move, direction) {\n    return getBoxAt(bridge, element, offset).bind(function (box) {\n      return tryAt(bridge, direction, move(box, Retries.getJumpSize()));\n    });\n  };\n\n  var tryAt = function (bridge, direction, box) {\n    var browser = detect$3().browser;\n\n    if (browser.isChrome() || browser.isSafari() || browser.isFirefox() || browser.isEdge()) {\n      return direction.otherRetry(bridge, box);\n    } else if (browser.isIE()) {\n      return direction.ieRetry(bridge, box);\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var tryCursor = function (bridge, isRoot, element, offset, direction) {\n    return getBoxAt(bridge, element, offset).bind(function (box) {\n      return tryAt(bridge, direction, box);\n    });\n  };\n\n  var handle$2 = function (bridge, isRoot, direction) {\n    return findSpot(bridge, isRoot, direction).bind(function (spot) {\n      return scan$1(bridge, isRoot, spot.element, spot.offset, direction, MAX_RETRIES).map(bridge.fromSitus);\n    });\n  };\n\n  var inSameTable = function (elem, table) {\n    return ancestor$2(elem, function (e) {\n      return parent(e).exists(function (p) {\n        return eq$1(p, table);\n      });\n    });\n  };\n\n  var simulate = function (bridge, isRoot, direction, initial, anchor) {\n    return closest$1(initial, 'td,th', isRoot).bind(function (start) {\n      return closest$1(start, 'table', isRoot).bind(function (table) {\n        if (!inSameTable(anchor, table)) {\n          return Optional.none();\n        }\n\n        return handle$2(bridge, isRoot, direction).bind(function (range) {\n          return closest$1(range.finish, 'td,th', isRoot).map(function (finish) {\n            return {\n              start: start,\n              finish: finish,\n              range: range\n            };\n          });\n        });\n      });\n    });\n  };\n\n  var navigate = function (bridge, isRoot, direction, initial, anchor, precheck) {\n    if (detect$3().browser.isIE()) {\n      return Optional.none();\n    } else {\n      return precheck(initial, isRoot).orThunk(function () {\n        return simulate(bridge, isRoot, direction, initial, anchor).map(function (info) {\n          var range = info.range;\n          return Response.create(Optional.some(makeSitus(range.start, range.soffset, range.finish, range.foffset)), true);\n        });\n      });\n    }\n  };\n\n  var firstUpCheck = function (initial, isRoot) {\n    return closest$1(initial, 'tr', isRoot).bind(function (startRow) {\n      return closest$1(startRow, 'table', isRoot).bind(function (table) {\n        var rows = descendants$1(table, 'tr');\n\n        if (eq$1(startRow, rows[0])) {\n          return seekLeft$1(table, function (element) {\n            return last$1(element).isSome();\n          }, isRoot).map(function (last) {\n            var lastOffset = getEnd(last);\n            return Response.create(Optional.some(makeSitus(last, lastOffset, last, lastOffset)), true);\n          });\n        } else {\n          return Optional.none();\n        }\n      });\n    });\n  };\n\n  var lastDownCheck = function (initial, isRoot) {\n    return closest$1(initial, 'tr', isRoot).bind(function (startRow) {\n      return closest$1(startRow, 'table', isRoot).bind(function (table) {\n        var rows = descendants$1(table, 'tr');\n\n        if (eq$1(startRow, rows[rows.length - 1])) {\n          return seekRight$1(table, function (element) {\n            return first(element).isSome();\n          }, isRoot).map(function (first) {\n            return Response.create(Optional.some(makeSitus(first, 0, first, 0)), true);\n          });\n        } else {\n          return Optional.none();\n        }\n      });\n    });\n  };\n\n  var select = function (bridge, container, isRoot, direction, initial, anchor, selectRange) {\n    return simulate(bridge, isRoot, direction, initial, anchor).bind(function (info) {\n      return detect$6(container, isRoot, info.start, info.finish, selectRange);\n    });\n  };\n\n  var value$1 = function () {\n    var subject = Cell(Optional.none());\n\n    var clear = function () {\n      return subject.set(Optional.none());\n    };\n\n    var set = function (s) {\n      return subject.set(Optional.some(s));\n    };\n\n    var isSet = function () {\n      return subject.get().isSome();\n    };\n\n    var on = function (f) {\n      return subject.get().each(f);\n    };\n\n    return {\n      clear: clear,\n      set: set,\n      isSet: isSet,\n      on: on\n    };\n  };\n\n  var findCell = function (target, isRoot) {\n    return closest$1(target, 'td,th', isRoot);\n  };\n\n  var MouseSelection = function (bridge, container, isRoot, annotations) {\n    var cursor = value$1();\n    var clearstate = cursor.clear;\n\n    var applySelection = function (event) {\n      cursor.on(function (start) {\n        annotations.clearBeforeUpdate(container);\n        findCell(event.target, isRoot).each(function (finish) {\n          identify(start, finish, isRoot).each(function (cellSel) {\n            var boxes = cellSel.boxes.getOr([]);\n\n            if (boxes.length > 1 || boxes.length === 1 && !eq$1(start, finish)) {\n              annotations.selectRange(container, boxes, cellSel.start, cellSel.finish);\n              bridge.selectContents(finish);\n            }\n          });\n        });\n      });\n    };\n\n    var mousedown = function (event) {\n      annotations.clear(container);\n      findCell(event.target, isRoot).each(cursor.set);\n    };\n\n    var mouseover = function (event) {\n      applySelection(event);\n    };\n\n    var mouseup = function (event) {\n      applySelection(event);\n      clearstate();\n    };\n\n    return {\n      clearstate: clearstate,\n      mousedown: mousedown,\n      mouseover: mouseover,\n      mouseup: mouseup\n    };\n  };\n\n  var down = {\n    traverse: nextSibling,\n    gather: after$5,\n    relative: Situ.before,\n    otherRetry: Retries.tryDown,\n    ieRetry: Retries.ieTryDown,\n    failure: BeforeAfter.failedDown\n  };\n  var up = {\n    traverse: prevSibling,\n    gather: before$4,\n    relative: Situ.before,\n    otherRetry: Retries.tryUp,\n    ieRetry: Retries.ieTryUp,\n    failure: BeforeAfter.failedUp\n  };\n\n  var isKey = function (key) {\n    return function (keycode) {\n      return keycode === key;\n    };\n  };\n\n  var isUp = isKey(38);\n  var isDown = isKey(40);\n\n  var isNavigation = function (keycode) {\n    return keycode >= 37 && keycode <= 40;\n  };\n\n  var ltr$2 = {\n    isBackward: isKey(37),\n    isForward: isKey(39)\n  };\n  var rtl$2 = {\n    isBackward: isKey(39),\n    isForward: isKey(37)\n  };\n\n  var get$d = function (_DOC) {\n    var doc = _DOC !== undefined ? _DOC.dom : document;\n    var x = doc.body.scrollLeft || doc.documentElement.scrollLeft;\n    var y = doc.body.scrollTop || doc.documentElement.scrollTop;\n    return SugarPosition(x, y);\n  };\n\n  var by = function (x, y, _DOC) {\n    var doc = _DOC !== undefined ? _DOC.dom : document;\n    var win = doc.defaultView;\n\n    if (win) {\n      win.scrollBy(x, y);\n    }\n  };\n\n  var WindowBridge = function (win) {\n    var elementFromPoint = function (x, y) {\n      return SugarElement.fromPoint(SugarElement.fromDom(win.document), x, y);\n    };\n\n    var getRect = function (element) {\n      return element.dom.getBoundingClientRect();\n    };\n\n    var getRangedRect = function (start, soffset, finish, foffset) {\n      var sel = SimSelection.exact(start, soffset, finish, foffset);\n      return getFirstRect$1(win, sel);\n    };\n\n    var getSelection = function () {\n      return get$c(win).map(function (exactAdt) {\n        return convertToRange(win, exactAdt);\n      });\n    };\n\n    var fromSitus = function (situs) {\n      var relative = SimSelection.relative(situs.start, situs.finish);\n      return convertToRange(win, relative);\n    };\n\n    var situsFromPoint = function (x, y) {\n      return getAtPoint(win, x, y).map(function (exact) {\n        return Situs.create(exact.start, exact.soffset, exact.finish, exact.foffset);\n      });\n    };\n\n    var clearSelection = function () {\n      clear(win);\n    };\n\n    var collapseSelection = function (toStart) {\n      if (toStart === void 0) {\n        toStart = false;\n      }\n\n      get$c(win).each(function (sel) {\n        return sel.fold(function (rng) {\n          return rng.collapse(toStart);\n        }, function (startSitu, finishSitu) {\n          var situ = toStart ? startSitu : finishSitu;\n          setRelative(win, situ, situ);\n        }, function (start, soffset, finish, foffset) {\n          var node = toStart ? start : finish;\n          var offset = toStart ? soffset : foffset;\n          setExact(win, node, offset, node, offset);\n        });\n      });\n    };\n\n    var selectContents = function (element) {\n      setToElement(win, element);\n    };\n\n    var setSelection = function (sel) {\n      setExact(win, sel.start, sel.soffset, sel.finish, sel.foffset);\n    };\n\n    var setRelativeSelection = function (start, finish) {\n      setRelative(win, start, finish);\n    };\n\n    var getInnerHeight = function () {\n      return win.innerHeight;\n    };\n\n    var getScrollY = function () {\n      var pos = get$d(SugarElement.fromDom(win.document));\n      return pos.top;\n    };\n\n    var scrollBy = function (x, y) {\n      by(x, y, SugarElement.fromDom(win.document));\n    };\n\n    return {\n      elementFromPoint: elementFromPoint,\n      getRect: getRect,\n      getRangedRect: getRangedRect,\n      getSelection: getSelection,\n      fromSitus: fromSitus,\n      situsFromPoint: situsFromPoint,\n      clearSelection: clearSelection,\n      collapseSelection: collapseSelection,\n      setSelection: setSelection,\n      setRelativeSelection: setRelativeSelection,\n      selectContents: selectContents,\n      getInnerHeight: getInnerHeight,\n      getScrollY: getScrollY,\n      scrollBy: scrollBy\n    };\n  };\n\n  var rc = function (rows, cols) {\n    return {\n      rows: rows,\n      cols: cols\n    };\n  };\n\n  var mouse = function (win, container, isRoot, annotations) {\n    var bridge = WindowBridge(win);\n    var handlers = MouseSelection(bridge, container, isRoot, annotations);\n    return {\n      clearstate: handlers.clearstate,\n      mousedown: handlers.mousedown,\n      mouseover: handlers.mouseover,\n      mouseup: handlers.mouseup\n    };\n  };\n\n  var keyboard = function (win, container, isRoot, annotations) {\n    var bridge = WindowBridge(win);\n\n    var clearToNavigate = function () {\n      annotations.clear(container);\n      return Optional.none();\n    };\n\n    var keydown = function (event, start, soffset, finish, foffset, direction) {\n      var realEvent = event.raw;\n      var keycode = realEvent.which;\n      var shiftKey = realEvent.shiftKey === true;\n      var handler = retrieve(container, annotations.selectedSelector).fold(function () {\n        if (isDown(keycode) && shiftKey) {\n          return curry(select, bridge, container, isRoot, down, finish, start, annotations.selectRange);\n        } else if (isUp(keycode) && shiftKey) {\n          return curry(select, bridge, container, isRoot, up, finish, start, annotations.selectRange);\n        } else if (isDown(keycode)) {\n          return curry(navigate, bridge, isRoot, down, finish, start, lastDownCheck);\n        } else if (isUp(keycode)) {\n          return curry(navigate, bridge, isRoot, up, finish, start, firstUpCheck);\n        } else {\n          return Optional.none;\n        }\n      }, function (selected) {\n        var update$1 = function (attempts) {\n          return function () {\n            var navigation = findMap(attempts, function (delta) {\n              return update(delta.rows, delta.cols, container, selected, annotations);\n            });\n            return navigation.fold(function () {\n              return getEdges(container, annotations.firstSelectedSelector, annotations.lastSelectedSelector).map(function (edges) {\n                var relative = isDown(keycode) || direction.isForward(keycode) ? Situ.after : Situ.before;\n                bridge.setRelativeSelection(Situ.on(edges.first, 0), relative(edges.table));\n                annotations.clear(container);\n                return Response.create(Optional.none(), true);\n              });\n            }, function (_) {\n              return Optional.some(Response.create(Optional.none(), true));\n            });\n          };\n        };\n\n        if (isDown(keycode) && shiftKey) {\n          return update$1([rc(+1, 0)]);\n        } else if (isUp(keycode) && shiftKey) {\n          return update$1([rc(-1, 0)]);\n        } else if (direction.isBackward(keycode) && shiftKey) {\n          return update$1([rc(0, -1), rc(-1, 0)]);\n        } else if (direction.isForward(keycode) && shiftKey) {\n          return update$1([rc(0, +1), rc(+1, 0)]);\n        } else if (isNavigation(keycode) && shiftKey === false) {\n          return clearToNavigate;\n        } else {\n          return Optional.none;\n        }\n      });\n      return handler();\n    };\n\n    var keyup = function (event, start, soffset, finish, foffset) {\n      return retrieve(container, annotations.selectedSelector).fold(function () {\n        var realEvent = event.raw;\n        var keycode = realEvent.which;\n        var shiftKey = realEvent.shiftKey === true;\n\n        if (shiftKey === false) {\n          return Optional.none();\n        }\n\n        if (isNavigation(keycode)) {\n          return sync(container, isRoot, start, soffset, finish, foffset, annotations.selectRange);\n        } else {\n          return Optional.none();\n        }\n      }, Optional.none);\n    };\n\n    return {\n      keydown: keydown,\n      keyup: keyup\n    };\n  };\n\n  var external = function (win, container, isRoot, annotations) {\n    var bridge = WindowBridge(win);\n    return function (start, finish) {\n      annotations.clearBeforeUpdate(container);\n      identify(start, finish, isRoot).each(function (cellSel) {\n        var boxes = cellSel.boxes.getOr([]);\n        annotations.selectRange(container, boxes, cellSel.start, cellSel.finish);\n        bridge.selectContents(finish);\n        bridge.collapseSelection();\n      });\n    };\n  };\n\n  var remove$7 = function (element, classes) {\n    each(classes, function (x) {\n      remove$5(element, x);\n    });\n  };\n\n  var addClass = function (clazz) {\n    return function (element) {\n      add$3(element, clazz);\n    };\n  };\n\n  var removeClasses = function (classes) {\n    return function (element) {\n      remove$7(element, classes);\n    };\n  };\n\n  var byClass = function (ephemera) {\n    var addSelectionClass = addClass(ephemera.selected);\n    var removeSelectionClasses = removeClasses([ephemera.selected, ephemera.lastSelected, ephemera.firstSelected]);\n\n    var clear = function (container) {\n      var sels = descendants$1(container, ephemera.selectedSelector);\n      each(sels, removeSelectionClasses);\n    };\n\n    var selectRange = function (container, cells, start, finish) {\n      clear(container);\n      each(cells, addSelectionClass);\n      add$3(start, ephemera.firstSelected);\n      add$3(finish, ephemera.lastSelected);\n    };\n\n    return {\n      clearBeforeUpdate: clear,\n      clear: clear,\n      selectRange: selectRange,\n      selectedSelector: ephemera.selectedSelector,\n      firstSelectedSelector: ephemera.firstSelectedSelector,\n      lastSelectedSelector: ephemera.lastSelectedSelector\n    };\n  };\n\n  var byAttr = function (ephemera, onSelection, onClear) {\n    var removeSelectionAttributes = function (element) {\n      remove(element, ephemera.selected);\n      remove(element, ephemera.firstSelected);\n      remove(element, ephemera.lastSelected);\n    };\n\n    var addSelectionAttribute = function (element) {\n      set(element, ephemera.selected, '1');\n    };\n\n    var clear = function (container) {\n      clearBeforeUpdate(container);\n      onClear();\n    };\n\n    var clearBeforeUpdate = function (container) {\n      var sels = descendants$1(container, ephemera.selectedSelector);\n      each(sels, removeSelectionAttributes);\n    };\n\n    var selectRange = function (container, cells, start, finish) {\n      clear(container);\n      each(cells, addSelectionAttribute);\n      set(start, ephemera.firstSelected, '1');\n      set(finish, ephemera.lastSelected, '1');\n      onSelection(cells, start, finish);\n    };\n\n    return {\n      clearBeforeUpdate: clearBeforeUpdate,\n      clear: clear,\n      selectRange: selectRange,\n      selectedSelector: ephemera.selectedSelector,\n      firstSelectedSelector: ephemera.firstSelectedSelector,\n      lastSelectedSelector: ephemera.lastSelectedSelector\n    };\n  };\n\n  var SelectionAnnotation = {\n    byClass: byClass,\n    byAttr: byAttr\n  };\n\n  var getUpOrLeftCells = function (grid, selectedCells, generators) {\n    var upGrid = grid.slice(0, selectedCells[selectedCells.length - 1].row + 1);\n    var upDetails = toDetailList(upGrid, generators);\n    return bind(upDetails, function (detail) {\n      var slicedCells = detail.cells.slice(0, selectedCells[selectedCells.length - 1].column + 1);\n      return map(slicedCells, function (cell) {\n        return cell.element;\n      });\n    });\n  };\n\n  var getDownOrRightCells = function (grid, selectedCells, generators) {\n    var downGrid = grid.slice(selectedCells[0].row + selectedCells[0].rowspan - 1, grid.length);\n    var downDetails = toDetailList(downGrid, generators);\n    return bind(downDetails, function (detail) {\n      var slicedCells = detail.cells.slice(selectedCells[0].column + selectedCells[0].colspan - 1, detail.cells.length);\n      return map(slicedCells, function (cell) {\n        return cell.element;\n      });\n    });\n  };\n\n  var getOtherCells = function (table, target, generators) {\n    var warehouse = Warehouse.fromTable(table);\n    var details = onCells(warehouse, target);\n    return details.map(function (selectedCells) {\n      var grid = toGrid(warehouse, generators, false);\n      var upOrLeftCells = getUpOrLeftCells(grid, selectedCells, generators);\n      var downOrRightCells = getDownOrRightCells(grid, selectedCells, generators);\n      return {\n        upOrLeftCells: upOrLeftCells,\n        downOrRightCells: downOrRightCells\n      };\n    });\n  };\n\n  var hasInternalTarget = function (e) {\n    return has$1(SugarElement.fromDom(e.target), 'ephox-snooker-resizer-bar') === false;\n  };\n\n  function CellSelection(editor, lazyResize, selectionTargets) {\n    var onSelection = function (cells, start, finish) {\n      selectionTargets.targets().each(function (targets) {\n        var tableOpt = table(start);\n        tableOpt.each(function (table) {\n          var cloneFormats = getCloneElements(editor);\n          var generators = cellOperations(noop, SugarElement.fromDom(editor.getDoc()), cloneFormats);\n          var otherCells = getOtherCells(table, targets, generators);\n          fireTableSelectionChange(editor, cells, start, finish, otherCells);\n        });\n      });\n    };\n\n    var onClear = function () {\n      return fireTableSelectionClear(editor);\n    };\n\n    var annotations = SelectionAnnotation.byAttr(ephemera, onSelection, onClear);\n    editor.on('init', function (_e) {\n      var win = editor.getWin();\n      var body = getBody$1(editor);\n      var isRoot = getIsRoot(editor);\n\n      var syncSelection = function () {\n        var sel = editor.selection;\n        var start = SugarElement.fromDom(sel.getStart());\n        var end = SugarElement.fromDom(sel.getEnd());\n        var shared = sharedOne$1(table, [start, end]);\n        shared.fold(function () {\n          return annotations.clear(body);\n        }, noop);\n      };\n\n      var mouseHandlers = mouse(win, body, isRoot, annotations);\n      var keyHandlers = keyboard(win, body, isRoot, annotations);\n      var external$1 = external(win, body, isRoot, annotations);\n\n      var hasShiftKey = function (event) {\n        return event.raw.shiftKey === true;\n      };\n\n      editor.on('TableSelectorChange', function (e) {\n        return external$1(e.start, e.finish);\n      });\n\n      var handleResponse = function (event, response) {\n        if (!hasShiftKey(event)) {\n          return;\n        }\n\n        if (response.kill) {\n          event.kill();\n        }\n\n        response.selection.each(function (ns) {\n          var relative = SimSelection.relative(ns.start, ns.finish);\n          var rng = asLtrRange(win, relative);\n          editor.selection.setRng(rng);\n        });\n      };\n\n      var keyup = function (event) {\n        var wrappedEvent = fromRawEvent$1(event);\n\n        if (wrappedEvent.raw.shiftKey && isNavigation(wrappedEvent.raw.which)) {\n          var rng = editor.selection.getRng();\n          var start = SugarElement.fromDom(rng.startContainer);\n          var end = SugarElement.fromDom(rng.endContainer);\n          keyHandlers.keyup(wrappedEvent, start, rng.startOffset, end, rng.endOffset).each(function (response) {\n            handleResponse(wrappedEvent, response);\n          });\n        }\n      };\n\n      var keydown = function (event) {\n        var wrappedEvent = fromRawEvent$1(event);\n        lazyResize().each(function (resize) {\n          return resize.hideBars();\n        });\n        var rng = editor.selection.getRng();\n        var start = SugarElement.fromDom(rng.startContainer);\n        var end = SugarElement.fromDom(rng.endContainer);\n        var direction = onDirection(ltr$2, rtl$2)(SugarElement.fromDom(editor.selection.getStart()));\n        keyHandlers.keydown(wrappedEvent, start, rng.startOffset, end, rng.endOffset, direction).each(function (response) {\n          handleResponse(wrappedEvent, response);\n        });\n        lazyResize().each(function (resize) {\n          return resize.showBars();\n        });\n      };\n\n      var isLeftMouse = function (raw) {\n        return raw.button === 0;\n      };\n\n      var isLeftButtonPressed = function (raw) {\n        if (raw.buttons === undefined) {\n          return true;\n        }\n\n        if (global$2.browser.isEdge() && raw.buttons === 0) {\n          return true;\n        }\n\n        return (raw.buttons & 1) !== 0;\n      };\n\n      var dragStart = function (_e) {\n        mouseHandlers.clearstate();\n      };\n\n      var mouseDown = function (e) {\n        if (isLeftMouse(e) && hasInternalTarget(e)) {\n          mouseHandlers.mousedown(fromRawEvent$1(e));\n        }\n      };\n\n      var mouseOver = function (e) {\n        if (isLeftButtonPressed(e) && hasInternalTarget(e)) {\n          mouseHandlers.mouseover(fromRawEvent$1(e));\n        }\n      };\n\n      var mouseUp = function (e) {\n        if (isLeftMouse(e) && hasInternalTarget(e)) {\n          mouseHandlers.mouseup(fromRawEvent$1(e));\n        }\n      };\n\n      var getDoubleTap = function () {\n        var lastTarget = Cell(SugarElement.fromDom(body));\n        var lastTimeStamp = Cell(0);\n\n        var touchEnd = function (t) {\n          var target = SugarElement.fromDom(t.target);\n\n          if (name(target) === 'td' || name(target) === 'th') {\n            var lT = lastTarget.get();\n            var lTS = lastTimeStamp.get();\n\n            if (eq$1(lT, target) && t.timeStamp - lTS < 300) {\n              t.preventDefault();\n              external$1(target, target);\n            }\n          }\n\n          lastTarget.set(target);\n          lastTimeStamp.set(t.timeStamp);\n        };\n\n        return {\n          touchEnd: touchEnd\n        };\n      };\n\n      var doubleTap = getDoubleTap();\n      editor.on('dragstart', dragStart);\n      editor.on('mousedown', mouseDown);\n      editor.on('mouseover', mouseOver);\n      editor.on('mouseup', mouseUp);\n      editor.on('touchend', doubleTap.touchEnd);\n      editor.on('keyup', keyup);\n      editor.on('keydown', keydown);\n      editor.on('NodeChange', syncSelection);\n    });\n    return {\n      clear: annotations.clear\n    };\n  }\n\n  var getSelectionTargets = function (editor, selections) {\n    var targets = Cell(Optional.none());\n    var changeHandlers = Cell([]);\n    var selectionDetails = Optional.none();\n    var isCaption = isTag('caption');\n\n    var isDisabledForSelection = function (key) {\n      return selectionDetails.forall(function (details) {\n        return !details[key];\n      });\n    };\n\n    var findTargets = function () {\n      return getSelectionStartCellOrCaption(getSelectionStart(editor), getIsRoot(editor)).bind(function (cellOrCaption) {\n        var table$1 = table(cellOrCaption);\n        return table$1.map(function (table) {\n          if (isCaption(cellOrCaption)) {\n            return noMenu(cellOrCaption);\n          } else {\n            return forMenu(selections, table, cellOrCaption);\n          }\n        });\n      });\n    };\n\n    var getExtractedDetails = function (targets) {\n      var tableOpt = table(targets.element);\n      return tableOpt.map(function (table) {\n        var warehouse = Warehouse.fromTable(table);\n        var selectedCells = onCells(warehouse, targets).getOr([]);\n        var locked = foldl(selectedCells, function (acc, cell) {\n          if (cell.isLocked) {\n            acc.onAny = true;\n\n            if (cell.column === 0) {\n              acc.onFirst = true;\n            } else if (cell.column + cell.colspan >= warehouse.grid.columns) {\n              acc.onLast = true;\n            }\n          }\n\n          return acc;\n        }, {\n          onAny: false,\n          onFirst: false,\n          onLast: false\n        });\n        return {\n          mergeable: onUnlockedMergable(warehouse, targets).isSome(),\n          unmergeable: onUnlockedUnmergable(warehouse, targets).isSome(),\n          locked: locked\n        };\n      });\n    };\n\n    var resetTargets = function () {\n      targets.set(cached(findTargets)());\n      selectionDetails = targets.get().bind(getExtractedDetails);\n      each(changeHandlers.get(), function (handler) {\n        return handler();\n      });\n    };\n\n    var onSetup = function (api, isDisabled) {\n      var handler = function () {\n        return targets.get().fold(function () {\n          api.setDisabled(true);\n        }, function (targets) {\n          api.setDisabled(isDisabled(targets));\n        });\n      };\n\n      handler();\n      changeHandlers.set(changeHandlers.get().concat([handler]));\n      return function () {\n        changeHandlers.set(filter(changeHandlers.get(), function (h) {\n          return h !== handler;\n        }));\n      };\n    };\n\n    var isDisabledFromLocked = function (lockedDisable) {\n      return selectionDetails.exists(function (details) {\n        return details.locked[lockedDisable];\n      });\n    };\n\n    var onSetupTable = function (api) {\n      return onSetup(api, function (_) {\n        return false;\n      });\n    };\n\n    var onSetupCellOrRow = function (api) {\n      return onSetup(api, function (targets) {\n        return isCaption(targets.element);\n      });\n    };\n\n    var onSetupColumn = function (lockedDisable) {\n      return function (api) {\n        return onSetup(api, function (targets) {\n          return isCaption(targets.element) || isDisabledFromLocked(lockedDisable);\n        });\n      };\n    };\n\n    var onSetupPasteable = function (getClipboardData) {\n      return function (api) {\n        return onSetup(api, function (targets) {\n          return isCaption(targets.element) || getClipboardData().isNone();\n        });\n      };\n    };\n\n    var onSetupPasteableColumn = function (getClipboardData, lockedDisable) {\n      return function (api) {\n        return onSetup(api, function (targets) {\n          return isCaption(targets.element) || getClipboardData().isNone() || isDisabledFromLocked(lockedDisable);\n        });\n      };\n    };\n\n    var onSetupMergeable = function (api) {\n      return onSetup(api, function (_targets) {\n        return isDisabledForSelection('mergeable');\n      });\n    };\n\n    var onSetupUnmergeable = function (api) {\n      return onSetup(api, function (_targets) {\n        return isDisabledForSelection('unmergeable');\n      });\n    };\n\n    editor.on('NodeChange ExecCommand TableSelectorChange', resetTargets);\n    return {\n      onSetupTable: onSetupTable,\n      onSetupCellOrRow: onSetupCellOrRow,\n      onSetupColumn: onSetupColumn,\n      onSetupPasteable: onSetupPasteable,\n      onSetupPasteableColumn: onSetupPasteableColumn,\n      onSetupMergeable: onSetupMergeable,\n      onSetupUnmergeable: onSetupUnmergeable,\n      resetTargets: resetTargets,\n      targets: function () {\n        return targets.get();\n      }\n    };\n  };\n\n  var addButtons = function (editor, selectionTargets, clipboard) {\n    editor.ui.registry.addMenuButton('table', {\n      tooltip: 'Table',\n      icon: 'table',\n      fetch: function (callback) {\n        return callback('inserttable | cell row column | advtablesort | tableprops deletetable');\n      }\n    });\n\n    var cmd = function (command) {\n      return function () {\n        return editor.execCommand(command);\n      };\n    };\n\n    editor.ui.registry.addButton('tableprops', {\n      tooltip: 'Table properties',\n      onAction: cmd('mceTableProps'),\n      icon: 'table',\n      onSetup: selectionTargets.onSetupTable\n    });\n    editor.ui.registry.addButton('tabledelete', {\n      tooltip: 'Delete table',\n      onAction: cmd('mceTableDelete'),\n      icon: 'table-delete-table',\n      onSetup: selectionTargets.onSetupTable\n    });\n    editor.ui.registry.addButton('tablecellprops', {\n      tooltip: 'Cell properties',\n      onAction: cmd('mceTableCellProps'),\n      icon: 'table-cell-properties',\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addButton('tablemergecells', {\n      tooltip: 'Merge cells',\n      onAction: cmd('mceTableMergeCells'),\n      icon: 'table-merge-cells',\n      onSetup: selectionTargets.onSetupMergeable\n    });\n    editor.ui.registry.addButton('tablesplitcells', {\n      tooltip: 'Split cell',\n      onAction: cmd('mceTableSplitCells'),\n      icon: 'table-split-cells',\n      onSetup: selectionTargets.onSetupUnmergeable\n    });\n    editor.ui.registry.addButton('tableinsertrowbefore', {\n      tooltip: 'Insert row before',\n      onAction: cmd('mceTableInsertRowBefore'),\n      icon: 'table-insert-row-above',\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addButton('tableinsertrowafter', {\n      tooltip: 'Insert row after',\n      onAction: cmd('mceTableInsertRowAfter'),\n      icon: 'table-insert-row-after',\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addButton('tabledeleterow', {\n      tooltip: 'Delete row',\n      onAction: cmd('mceTableDeleteRow'),\n      icon: 'table-delete-row',\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addButton('tablerowprops', {\n      tooltip: 'Row properties',\n      onAction: cmd('mceTableRowProps'),\n      icon: 'table-row-properties',\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addButton('tableinsertcolbefore', {\n      tooltip: 'Insert column before',\n      onAction: cmd('mceTableInsertColBefore'),\n      icon: 'table-insert-column-before',\n      onSetup: selectionTargets.onSetupColumn('onFirst')\n    });\n    editor.ui.registry.addButton('tableinsertcolafter', {\n      tooltip: 'Insert column after',\n      onAction: cmd('mceTableInsertColAfter'),\n      icon: 'table-insert-column-after',\n      onSetup: selectionTargets.onSetupColumn('onLast')\n    });\n    editor.ui.registry.addButton('tabledeletecol', {\n      tooltip: 'Delete column',\n      onAction: cmd('mceTableDeleteCol'),\n      icon: 'table-delete-column',\n      onSetup: selectionTargets.onSetupColumn('onAny')\n    });\n    editor.ui.registry.addButton('tablecutrow', {\n      tooltip: 'Cut row',\n      icon: 'cut-row',\n      onAction: cmd('mceTableCutRow'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addButton('tablecopyrow', {\n      tooltip: 'Copy row',\n      icon: 'duplicate-row',\n      onAction: cmd('mceTableCopyRow'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addButton('tablepasterowbefore', {\n      tooltip: 'Paste row before',\n      icon: 'paste-row-before',\n      onAction: cmd('mceTablePasteRowBefore'),\n      onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)\n    });\n    editor.ui.registry.addButton('tablepasterowafter', {\n      tooltip: 'Paste row after',\n      icon: 'paste-row-after',\n      onAction: cmd('mceTablePasteRowAfter'),\n      onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)\n    });\n    editor.ui.registry.addButton('tablecutcol', {\n      tooltip: 'Cut column',\n      icon: 'cut-column',\n      onAction: cmd('mceTableCutCol'),\n      onSetup: selectionTargets.onSetupColumn('onAny')\n    });\n    editor.ui.registry.addButton('tablecopycol', {\n      tooltip: 'Copy column',\n      icon: 'duplicate-column',\n      onAction: cmd('mceTableCopyCol'),\n      onSetup: selectionTargets.onSetupColumn('onAny')\n    });\n    editor.ui.registry.addButton('tablepastecolbefore', {\n      tooltip: 'Paste column before',\n      icon: 'paste-column-before',\n      onAction: cmd('mceTablePasteColBefore'),\n      onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onFirst')\n    });\n    editor.ui.registry.addButton('tablepastecolafter', {\n      tooltip: 'Paste column after',\n      icon: 'paste-column-after',\n      onAction: cmd('mceTablePasteColAfter'),\n      onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onLast')\n    });\n    editor.ui.registry.addButton('tableinsertdialog', {\n      tooltip: 'Insert table',\n      onAction: cmd('mceInsertTable'),\n      icon: 'table'\n    });\n  };\n\n  var addToolbars = function (editor) {\n    var isTable = function (table) {\n      return editor.dom.is(table, 'table') && editor.getBody().contains(table);\n    };\n\n    var toolbar = getToolbar(editor);\n\n    if (toolbar.length > 0) {\n      editor.ui.registry.addContextToolbar('table', {\n        predicate: isTable,\n        items: toolbar,\n        scope: 'node',\n        position: 'node'\n      });\n    }\n  };\n\n  var addMenuItems = function (editor, selectionTargets, clipboard) {\n    var cmd = function (command) {\n      return function () {\n        return editor.execCommand(command);\n      };\n    };\n\n    var insertTableAction = function (data) {\n      editor.execCommand('mceInsertTable', false, {\n        rows: data.numRows,\n        columns: data.numColumns\n      });\n    };\n\n    var tableProperties = {\n      text: 'Table properties',\n      onSetup: selectionTargets.onSetupTable,\n      onAction: cmd('mceTableProps')\n    };\n    var deleteTable = {\n      text: 'Delete table',\n      icon: 'table-delete-table',\n      onSetup: selectionTargets.onSetupTable,\n      onAction: cmd('mceTableDelete')\n    };\n    editor.ui.registry.addMenuItem('tableinsertrowbefore', {\n      text: 'Insert row before',\n      icon: 'table-insert-row-above',\n      onAction: cmd('mceTableInsertRowBefore'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuItem('tableinsertrowafter', {\n      text: 'Insert row after',\n      icon: 'table-insert-row-after',\n      onAction: cmd('mceTableInsertRowAfter'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuItem('tabledeleterow', {\n      text: 'Delete row',\n      icon: 'table-delete-row',\n      onAction: cmd('mceTableDeleteRow'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuItem('tablerowprops', {\n      text: 'Row properties',\n      icon: 'table-row-properties',\n      onAction: cmd('mceTableRowProps'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuItem('tablecutrow', {\n      text: 'Cut row',\n      icon: 'cut-row',\n      onAction: cmd('mceTableCutRow'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuItem('tablecopyrow', {\n      text: 'Copy row',\n      icon: 'duplicate-row',\n      onAction: cmd('mceTableCopyRow'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuItem('tablepasterowbefore', {\n      text: 'Paste row before',\n      icon: 'paste-row-before',\n      onAction: cmd('mceTablePasteRowBefore'),\n      onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)\n    });\n    editor.ui.registry.addMenuItem('tablepasterowafter', {\n      text: 'Paste row after',\n      icon: 'paste-row-after',\n      onAction: cmd('mceTablePasteRowAfter'),\n      onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)\n    });\n    var row = {\n      type: 'nestedmenuitem',\n      text: 'Row',\n      getSubmenuItems: function () {\n        return 'tableinsertrowbefore tableinsertrowafter tabledeleterow tablerowprops | tablecutrow tablecopyrow tablepasterowbefore tablepasterowafter';\n      }\n    };\n    editor.ui.registry.addMenuItem('tableinsertcolumnbefore', {\n      text: 'Insert column before',\n      icon: 'table-insert-column-before',\n      onAction: cmd('mceTableInsertColBefore'),\n      onSetup: selectionTargets.onSetupColumn('onFirst')\n    });\n    editor.ui.registry.addMenuItem('tableinsertcolumnafter', {\n      text: 'Insert column after',\n      icon: 'table-insert-column-after',\n      onAction: cmd('mceTableInsertColAfter'),\n      onSetup: selectionTargets.onSetupColumn('onLast')\n    });\n    editor.ui.registry.addMenuItem('tabledeletecolumn', {\n      text: 'Delete column',\n      icon: 'table-delete-column',\n      onAction: cmd('mceTableDeleteCol'),\n      onSetup: selectionTargets.onSetupColumn('onAny')\n    });\n    editor.ui.registry.addMenuItem('tablecutcolumn', {\n      text: 'Cut column',\n      icon: 'cut-column',\n      onAction: cmd('mceTableCutCol'),\n      onSetup: selectionTargets.onSetupColumn('onAny')\n    });\n    editor.ui.registry.addMenuItem('tablecopycolumn', {\n      text: 'Copy column',\n      icon: 'duplicate-column',\n      onAction: cmd('mceTableCopyCol'),\n      onSetup: selectionTargets.onSetupColumn('onAny')\n    });\n    editor.ui.registry.addMenuItem('tablepastecolumnbefore', {\n      text: 'Paste column before',\n      icon: 'paste-column-before',\n      onAction: cmd('mceTablePasteColBefore'),\n      onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onFirst')\n    });\n    editor.ui.registry.addMenuItem('tablepastecolumnafter', {\n      text: 'Paste column after',\n      icon: 'paste-column-after',\n      onAction: cmd('mceTablePasteColAfter'),\n      onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onLast')\n    });\n    var column = {\n      type: 'nestedmenuitem',\n      text: 'Column',\n      getSubmenuItems: function () {\n        return 'tableinsertcolumnbefore tableinsertcolumnafter tabledeletecolumn | tablecutcolumn tablecopycolumn tablepastecolumnbefore tablepastecolumnafter';\n      }\n    };\n    editor.ui.registry.addMenuItem('tablecellprops', {\n      text: 'Cell properties',\n      icon: 'table-cell-properties',\n      onAction: cmd('mceTableCellProps'),\n      onSetup: selectionTargets.onSetupCellOrRow\n    });\n    editor.ui.registry.addMenuItem('tablemergecells', {\n      text: 'Merge cells',\n      icon: 'table-merge-cells',\n      onAction: cmd('mceTableMergeCells'),\n      onSetup: selectionTargets.onSetupMergeable\n    });\n    editor.ui.registry.addMenuItem('tablesplitcells', {\n      text: 'Split cell',\n      icon: 'table-split-cells',\n      onAction: cmd('mceTableSplitCells'),\n      onSetup: selectionTargets.onSetupUnmergeable\n    });\n    var cell = {\n      type: 'nestedmenuitem',\n      text: 'Cell',\n      getSubmenuItems: function () {\n        return 'tablecellprops tablemergecells tablesplitcells';\n      }\n    };\n\n    if (hasTableGrid(editor) === false) {\n      editor.ui.registry.addMenuItem('inserttable', {\n        text: 'Table',\n        icon: 'table',\n        onAction: cmd('mceInsertTable')\n      });\n    } else {\n      editor.ui.registry.addNestedMenuItem('inserttable', {\n        text: 'Table',\n        icon: 'table',\n        getSubmenuItems: function () {\n          return [{\n            type: 'fancymenuitem',\n            fancytype: 'inserttable',\n            onAction: insertTableAction\n          }];\n        }\n      });\n    }\n\n    editor.ui.registry.addMenuItem('inserttabledialog', {\n      text: 'Insert table',\n      icon: 'table',\n      onAction: cmd('mceInsertTable')\n    });\n    editor.ui.registry.addMenuItem('tableprops', tableProperties);\n    editor.ui.registry.addMenuItem('deletetable', deleteTable);\n    editor.ui.registry.addNestedMenuItem('row', row);\n    editor.ui.registry.addNestedMenuItem('column', column);\n    editor.ui.registry.addNestedMenuItem('cell', cell);\n    editor.ui.registry.addContextMenu('table', {\n      update: function () {\n        selectionTargets.resetTargets();\n        return selectionTargets.targets().fold(function () {\n          return '';\n        }, function (targets) {\n          if (name(targets.element) === 'caption') {\n            return 'tableprops deletetable';\n          } else {\n            return 'cell row column | advtablesort | tableprops deletetable';\n          }\n        });\n      }\n    });\n  };\n\n  var Plugin = function (editor) {\n    var selections = Selections(function () {\n      return getBody$1(editor);\n    }, function () {\n      return getSelectionStartCellOrCaption(getSelectionStart(editor));\n    }, ephemera.selectedSelector);\n    var selectionTargets = getSelectionTargets(editor, selections);\n    var resizeHandler = getResizeHandler(editor);\n    var cellSelection = CellSelection(editor, resizeHandler.lazyResize, selectionTargets);\n    var actions = TableActions(editor, resizeHandler.lazyWire, selections);\n    var clipboard = Clipboard();\n    registerCommands(editor, actions, cellSelection, selections, clipboard);\n    registerQueryCommands(editor, actions, selections);\n    registerEvents(editor, selections, actions, cellSelection);\n    addMenuItems(editor, selectionTargets, clipboard);\n    addButtons(editor, selectionTargets, clipboard);\n    addToolbars(editor);\n    editor.on('PreInit', function () {\n      editor.serializer.addTempAttr(ephemera.firstSelected);\n      editor.serializer.addTempAttr(ephemera.lastSelected);\n      registerFormats(editor);\n    });\n\n    if (hasTabNavigation(editor)) {\n      editor.on('keydown', function (e) {\n        handle$1(e, editor, cellSelection);\n      });\n    }\n\n    editor.on('remove', function () {\n      resizeHandler.destroy();\n    });\n    return getApi(editor, clipboard, resizeHandler, selectionTargets);\n  };\n\n  function Plugin$1() {\n    global.add('table', Plugin);\n  }\n\n  Plugin$1();\n})();","map":{"version":3,"sources":["/home/lin/phase5/My-Place-Frontend/my-place/node_modules/tinymce/plugins/table/plugin.js"],"names":["typeOf","x","t","Array","prototype","isPrototypeOf","constructor","name","String","isType","type","value","isSimpleType","eq","a","isString","isObject","isArray","isBoolean","isUndefined","undefined","isNullable","isNonNullable","isFunction","isNumber","noop","compose","fa","fb","args","_i","arguments","length","apply","compose1","fbc","fab","constant","identity","curry","fn","initialArgs","restArgs","all","concat","not","f","die","msg","Error","never","always","none","NONE","o","isNone","call","thunk","id","n","me","fold","_s","is","isSome","getOr","getOrThunk","getOrDie","getOrNull","getOrUndefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","some","constant_a","self","s","v","elementEq","b","from","Optional","nativeSlice","slice","nativeIndexOf","indexOf","nativePush","push","rawIndexOf","ts","contains","xs","pred","i","len","range","num","r","eachr","partition","pass","fail","arr","foldr","acc","foldl","findUntil","until","find","findIndex","flatten","reverse","mapToObject","pure","sort","comparator","copy","get","head","last","findMap","__assign","Object","assign","p","hasOwnProperty","__spreadArrays","il","k","j","jl","cached","called","DeviceType","os","browser","userAgent","mediaMatch","isiPad","isiOS","test","isiPhone","isMobile","isAndroid","isTouch","isTablet","isPhone","iOSwebview","isSafari","isDesktop","isWebView","firstMatch","regexes","find$1","agent","major","minor","group","Number","replace","nu","detect","versionRegexes","cleanedAgent","toLowerCase","unknown","Version","detect$1","candidates","candidate","search","detectBrowser","browsers","version","current","detectOs","oses","UaString","checkRange","str","substr","start","contains$1","startsWith","prefix","endsWith","suffix","blank","trim","isNotEmpty","normalVersionRegex","checkContains","target","uastring","PlatformInfo","edge","chrome","ie","opera","firefox","safari","unknown$1","nu$1","info","isBrowser","isEdge","isChrome","isIE","isOpera","isFirefox","Browser","windows","ios","android","linux","osx","solaris","freebsd","chromeos","unknown$2","nu$2","isOS","isWindows","isOSX","isLinux","isSolaris","isFreeBSD","isChromeOS","OperatingSystem","detect$2","deviceType","PlatformDetection","query","window","matchMedia","matches","platform","navigator","detect$3","compareDocumentPosition","match","documentPositionContainedBy","Node","DOCUMENT_POSITION_CONTAINED_BY","COMMENT","DOCUMENT","DOCUMENT_FRAGMENT","ELEMENT","TEXT","fromHtml","html","scope","doc","document","div","createElement","innerHTML","hasChildNodes","childNodes","console","error","fromDom","fromTag","tag","node","fromText","text","createTextNode","dom","fromPoint","docElm","y","elementFromPoint","SugarElement","element","selector","nodeType","elem","msMatchesSelector","webkitMatchesSelector","mozMatchesSelector","bypassSelector","childElementCount","base","querySelectorAll","one","querySelector","eq$1","e1","e2","regularContains","d1","d2","ieContains","contains$2","is$1","keys","each$1","obj","props","map$1","tupleMap","tuple","objAcc","internalFilter","onTrue","onFalse","filter$1","mapToArray","values","size","get$1","key","has","hasNonNullableKey","isEmpty","validSectionList","isValidSection","parentName","grid","rows","columns","address","row","column","detail","rowspan","colspan","detailnew","isNew","extended","isLocked","rowdata","cells","section","elementnew","rowdatanew","rowcells","rowdetails","details","bounds","startRow","startCol","finishRow","finishCol","columnext","Global","Function","nodeName","isType$1","isComment","isElement","isText","isDocument","isDocumentFragment","isTag","e","owner","ownerDocument","documentOrOwner","dos","defaultView","parent","parentNode","parents","isRoot","stop","ret","rawParent","offsetParent","prevSibling","previousSibling","nextSibling","children","child","index","cs","firstChild","isShadowRoot","host","supported","Element","attachShadow","getRootNode","isSupported","getShadowRoot","getShadowHost","getOriginalEventTarget","event","el","isOpenShadowHost","composed","composedPath","shadowRoot","inBody","body","getBody","ancestors","predicate","children$1","descendants","result","ancestors$1","children$2","descendants$1","ClosestOrAncestor","ancestor","closest","child$1","descendant","descend","child_1","res","ancestor$1","child$2","descendant$1","closest$1","rawSet","setAttribute","set","setAll","attrs","get$2","getAttribute","getOpt","remove","removeAttribute","clone","attributes","attr","isSupported$1","style","getPropertyValue","internalSet","property","setProperty","internalRemove","removeProperty","set$1","setAll$1","css","get$3","styles","getComputedStyle","getUnsafeProperty","getRaw","raw","remove$1","source","sourceDom","targetDom","cssText","getAttrValue","cell","fallback","parseInt","getSpan","hasColspan","hasRowspan","getCssValue","minWidth","minHeight","firstLayer","filterFirstLayer","lookup","tags","isRootOrUpperTable","elm","join","columnGroups","columnGroup","table","fromRowsOrColGroups","elems","getSection","cells$1","getParentSection","fromTable","rows$1","columnGroups$1","fromPastedRows","addCells","gridRow","existingCells","before","after","newCells","setCells","addCell","mutateCell","mapCells","getCell","getCellElement","cellLength","extractGridDetails","cols","LOCKED_COL_ATTR","getLockedColumnsFromTable","lockedColStr","lockedCols","getLockedColumnsFromGrid","locked","idx","lockedArr","_val","getAt","warehouse","access","findItem","item","filtered","filterItems","generateColumns","rowData","columnsGroup","columnIndex","colIndex","generate","list","tableOpt","lockedColumns","maxRows","maxColumns","rowCount","currentRow_1","rowCell","occupiedColumnPosition","occupiedRowPosition","rowPosition","columnPosition","newpos","Math","max","grid$1","fromTable$1","justCells","w","justColumns","hasColumns","getColumnAt","Warehouse","inSelection","leftEdge","rightEdge","topEdge","bottomEdge","isWithin","isRectangular","isRect","detailIsWithin","getBounds","detailA","detailB","min","getAnyBox","startCell","finishCell","startCoords","finishCoords","sc","fc","getBox","moveBy","dest","d","intercepts","finish","inside","parentCell","innerCell","isContainedBy","c1","c2","moveBy$1","deltaRow","deltaColumn","getWarehouse","intercepts$1","first","nestedIntercepts","firstTable","lastTable","optStartCell","optLastCell","lastCell","getBox$1","marker","parent$1","insertBefore","sibling","append","prepend","firstChild$1","appendChild","wrap","wrapper","before$1","elements","after$1","append$1","empty","textContent","rogue","remove$2","removeChild","unwrap","NodeValue","getOption","nodeValue","api","get$4","set$2","TagBoundaries","DomUniverse","clone$1","cloneNode","isBoundary","isEmptyTag","isNonEditable","comparePosition","other","copyAttributesTo","destination","as","isSpecial","up","down","copyTo","insert","afterAll","appendAll","create","getText","setText","all$1","universe","look","tail","oneAll","unsafeOne","commonElement","end","eq$2","ancestors$2","ps1","ps2","prune","path","ind","pruned1","pruned2","shared","firstpath","secondpath","sharedOne","ancestors$3","sharedOne$1","_universe","ancestors$4","lookupTable","container","identify","getIsRoot","rootTable","boxes","startTable","finishTable","ancestorCells","lca","lcaTable","finishAncestorCells","startAncestorCells","retrieve","sels","getLast","lastSelectedSelector","box","getEdges","firstSelectedSelector","expandTo","identified","shiftSelection","retrieve$1","retrieveBox","edges","sectionSelector","firstAncestor","lastAncestor","fA","lA","generate$1","cases","constructors","adt","acase","count","keys$1","argLength","branches","branchKeys","allReqd","reqKey","foldArgs","log","label","params","Adt","type$1","multiple","single","cata","subject","onNone","onMultiple","onSingle","none$1","Selections","lazyRoot","getStart","selectedSelector","global","tinymce","util","Tools","resolve","original","isDeep","shallow","deep","shallowAs","copy$1","cloneChildren","cat","lift2","oa","ob","bindFrom","someIf","Dimension","getOffset","h","parseFloat","getOuter","aggregate","properties","val","isNaN","cumulativeInclusions","absoluteMax","api$1","offsetWidth","get$5","columns$1","isValidCell","rowsArr","col","getBlock","isValid","getFallback","decide","inBlock","validInBlock","detailOption","c","isSingle","deduce","rest","aa","delta","next","extras","abs","onDirection","isLtr","isRtl","getDirection","api$2","getBoundingClientRect","height","offsetHeight","get$6","getOuter$1","left","top","translate","SugarPosition","boxPosition","firstDefinedOrZero","absolute","win","documentElement","offsetLeft","offsetTop","scrollTop","pageYOffset","scrollLeft","pageXOffset","clientTop","clientLeft","viewport","rowInfo","colInfo","rtlEdge","pos","ltrEdge","getLeftEdge","getRightEdge","getTop","getTopEdge","getBottomEdge","findPositions","getInnerEdge","getOuterEdge","array","lines","cellOption","lastLine","negate","step","positions","optElements","ltr","rtl","detect$4","width","amount","units","unsupportedLength","fixed","relative","pattern","decimalDigits","signedInteger","exponentPart","dot","opt","input","unsignedDecimalLiteral","float","RegExp","isUnit","unit","accepted","check","parse","exec","unitRaw","needManualCalc","toNumber","px","getProp","getCalculatedHeight","boxSizing","paddingTop","paddingBottom","borderTop","borderBottom","borders","getCalculatedWidth","paddingLeft","paddingRight","borderLeft","borderRight","getHeight","getWidth","rPercentageBasedSizeRegex","rPixelBasedSizeRegex","getPercentSize","getter","relativeParent","setPixelWidth","setPercentageWidth","setHeight","getHeightValue","convert","number","setter","newSize","total","floor","normalizePixelSize","getTotalHeight","get$7","span","getRawWidth","cssWidth","normalizePercentageWidth","cellWidth","tableSize","pixelWidth","choosePercentageSize","percentMatch","intWidth","getPercentageWidth","normalizePixelWidth","choosePixelSize","pixelMatch","floatWidth","getPixelWidth","getHeight$1","getGenericWidth","setGenericWidth","getPixelTableWidth","getPercentTableWidth","isPercentSizing","isPixelSizing","isNoneSizing","percentageBasedSizeRegex","pixelBasedSizeRegex","isCol","getRaw$1","getRawW","getRawH","justCols","hasRawStyle","prop","isValidColumn","getDimension","cellOpt","backups","getWidthFrom","columnCells","colFilter","getDeduced","deduced","getRawWidths","getPercentageWidths","minCellWidth","getPixelWidths","getHeightFrom","direction","getPixelHeights","getRawHeights","Cell","initial","noneSize","zero","getWidths","getCellDelta","singleColumnWidth","setElementWidth","adjustTableWidth","isRelative","percentageSize","initialWidth","_delta","currentWidth","change","newWidth","pixelSize","newNext","chooseSize","fallbackWidth","getTableSize","TableSize","statsStruct","minRow","minCol","maxRow","maxCol","allCells","selectedCells","findSelectedStats","house","isSelected","totalColumns","totalRows","endRow","endCol","makeCell","seenSelected","rowIndex","td","fillInGaps","stats","needCell","clean","replica","widthDelta","emptyRows","getTableWidthDelta","colWidths","allColsWidth","selectedColsWidth","extract","replicaHouse","replicaStats","unselectedCells","nbsp","getEnd","isTextNodeWithCursorPosition","elementsWithCursorPosition","isCursorPosition","hasCursorPosition","last$1","descendantRtl","transferableAttributes","createCell","createCol","createColgroup","pasteReplace","newRow","cloneFormats","oldCell","newCell","formats","first$1","firstText","formatSelector","clonedFormat","cloneAppropriateAttributes","validAttributes","attributeName","attribute","cellOperations","mutate","formatsToClone","cloneCss","prev","docu","lastNode","newCol","colgroup","gap","paste","fromHtml$1","fromDom$1","nodes","getNodeName","getBody$1","editor","getPixelWidth$1","getPixelHeight","removePxSuffix","addPxSuffix","removeDataStyle","removeStyleAttribute","getRawWidth$1","getStyle","getAttrib","isPercentage","isPixel","getSelectionStart","selection","selections","unmergable","hasSpan","hasRowOrColSpan","mergable","ephemera","strSelected","strSelectedSelector","strAttributeSelector","strFirstSelected","strFirstSelectedSelector","strLastSelected","strLastSelectedSelector","attributeSelector","selected","firstSelected","lastSelected","noMenu","forMenu","paste$1","clipboard","generators","pasteRows","extractSelected","serializeElements","serializer","serialize","getTextContent","innerText","registerEvents","actions","cellSelection","on","multiCellContext","preventDefault","content","format","getParent","domCell","isTable","getDoc","targets","pasteCells","data","setRng","rng","focus","clear","only","middle","right","ColumnContext","neighbours","determine","resize","context","onOnly","onLeft","calcLeftEdgeDeltas","onMiddle","calcMiddleDeltas","onRight","calcRightEdgeDeltas","measures","recalculateWidthForCells","widths","recalculateWidthForColumns","groups","recalculateHeightForCells","heights","matchRowHeight","sumUp","recalculate","recalculateAndApply","newSizes","adjustWidth","resizing","isLastColumn","clampedStep","clampTableDelta","deltas","newWidths","dx","resizeTable","adjustHeight","newHeights","dy","newCellSizes","newRowSizes","adjustAndRedistributeWidths","_table","resizeBehaviour","sizes","tablePixelWidth","_a","calcRedestributedWidths","pixelDelta","adjustWidthTo","_info","surround","startIndex","endIndex","results","clampDeltaHelper","minCellSize","diff","clampNegativeDelta","clampDelta","calcFixedDeltas","clampedDelta","calcRelativeDeltas","ratio","newThis","_prev","resizer","totalWidth","tableWidth","ratio_1","preserveTable","_index","_minCellSize","maxDelta","_totalWidth","_pixelDelta","_isRelative","isResizable","view","origin","detached","editable","body$1","ResizeWire","adt$1","invalid","pixels","percent","validateFor","rawAmount","substring","from$1","Size","redistributeToPercent","colType","pc","redistributeToPx","newTotalWidth","scale","redistributeEmpty","newWidthType","redistributeValues","_pc","redistribute","newType","floats","normalize","sum","roundDown","floored","remainder","add","scan","output","round","validate","redistributeToW","redistributeToColumns","redistributeToH","getUnit","redistribute$1","optWidth","optHeight","widthUnit","oldWidths","nuWidths","newHeight","hUnit","totalHeight","oldHeights","nuHeights","isPercentSizing$1","isPixelSizing$1","isNoneSizing$1","getPercentTableWidth$1","getGridSize","Event","fields","handlers","handler","unbind","trigger","typeDefs","registry","last$2","rate","timer","cancel","clearTimeout","throttle","setTimeout","sort$1","reqMessage","required","unsuppMessage","unsupported","validateStrArr","invalidTypeMessage","incorrect","checkDupes","everything","sorted","dupe","handleUnsupported","baseWith","req","invalidKeys","handleExact","exactly","DragMode","DragSink","DragApi","InDrag","previous","reset","update","mode","old","compare","onEvent","dataOption","offset","events","move","NoDrag","Movement","noDragState","inDragState","dragState","off","isOn","setup","mutation","settings","active","movement","drop","sink","throttledDrop","go","mousemove","runIfActive","forceDrop","delayDrop","destroy","mkEvent","prevent","kill","fromRawEvent","rawEvent","stopPropagation","clientX","clientY","handle","binder","useCapture","wrapped","addEventListener","bind$1","removeEventListener","filter$2","bind$2","fromRawEvent$1","read","split","add$1","remove$3","supports","classList","get$8","add$2","clazz","remove$4","add$3","cleanClass","remove$5","has$1","namespace","dashNamespace","Blocker","options","layerClass","position","extract$1","dragApi","blocker","mdown","mup","mmove","mout","MouseDrag","transform","isContentEditableTrue","findClosestContentEditable","styles$1","resolve$1","Mutation","drag","BarMutation","delegate","xDelta","yDelta","bar","resizeBar","resizeRowBar","resizeColBar","BAR_THICKNESS","resizableRows","resizableColumns","resizableCols","colElmOpt","wire","drawBar","cpOption","cp","refreshCol","colPositions","tableHeight","colBar","refreshRow","rowPositions","rowBar","refreshGrid","warhouse","resizableRowBars","resizableRowPositions","_pos","barIndex","resizableColBars","resizableColPositions","refresh","each$2","bars","hide","show","isRowBar","isColBar","resizeBarDragging","BarManager","hoverTable","getResizer","_dataRow","currentRow","_dataCol","currentCol","getDelta","dir","newX","oldX","startAdjust","mousedown","findClosestEditableTable","mouseover","destroy$1","refresh$1","tbl","hideBars","showBars","create$1","lazySizing","hdirection","vdirection","manager","beforeResize","afterResize","startDrag","_event","TableResize","fireNewRow","fire","fireNewCell","fireObjectResizeStart","fireObjectResized","fireTableSelectionChange","otherCells","fireTableSelectionClear","fireTableModified","styleModified","structure","structureModified","defaultTableToolbar","defaultStyles","determineDefaultStyles","isPixelsForced","editorWidth","isResponsiveForced","_value","defaultAttributes","border","defaultColumnResizingBehaviour","getTableSizingMode","getParam","getTableResponseWidth","getDefaultAttributes","getDefaultStyles","hasTableResizeBars","hasTabNavigation","hasAdvancedCellTab","hasAdvancedRowTab","hasAdvancedTableTab","hasAppearanceOptions","hasTableGrid","shouldStyleWithCss","getCellClassList","getRowClassList","getTableClassList","isPercentagesForced","getToolbar","useColumnGroup","getTableHeaderType","defaultValue","validValues","getColumnResizingBehaviour","validModes","givenMode","isPreserveTableColumnResizing","isResizeTableColumnResizing","getCloneElements","cloneElements","hasObjectResizing","objectResizing","get$9","cleanupLegacyAttributes","convertToPercentSize","convertToPixelSize","convertToNoneSize","rowElements","enforcePercentage","tableSizing","enforcePixels","enforceNone","syncPixels","computedWidth","createContainer","padding","margin","get$a","inline","remove$6","barResizerPrefix","getResizeHandler","selectionRng","startW","startRawW","lazyResize","lazyWire","lazyResizingBehaviour","getNumColumns","afterCornerResize","isRightEdgeResize","percentW","targetPercentW","sz","rawWire","getRng","rawTable","undoManager","targetElm","select","addClass","origin_1","isReadOnly","point","toEnd","freefallRtl","freefallRtl$1","universe$1","freefallRtl$2","halve","main","setIfNot","ignore","generateSection","sectionName","newSection","render","newRows","syncRows","gridSection","tr","syncColGroup","colGroup","renderSection","sync","sectionElems","removeSection","renderOrRemoveSection","headSection","bodySection","footSection","columnGroupsSection","copy$2","clonedCell","getColumn","getRow","findDiff","comp","subgrid","restOfRow","endColIndex","restOfColumn","endRowIndex","toDetails","seen","updateSeen","toGrid","groupElementNew","rowCells","fromWarehouse","deriveRows","rendered","findRow","rowOfCells","toDetailList","findInWarehouse","extractCells","cell$1","lc","run","operation","adjustment","postAction","genWrappers","sizing","model","cursor","out","newElements","onCell","onPaste","onPasteByEditor","onMergable","_warehouse","onUnmergable","onCells","onUnlockedCell","onUnlockedCells","isUnlockedTableCell","allUnlocked","onUnlockedMergable","mergeable","onUnlockedUnmergable","merge","substitution","unmerge","currentCell","currentCellElm","isToReplace","uniqueCells","splitCols","prevCell","splitRows","rowPrevCells","replacement","_loop_1","sub","_opt","_f","mapError","_","onValue","toOptional","isValue","isError","message","onError","fromOption","err","Result","measure","startAddress","gridA","gridB","rowRemainder","colRemainder","colRequired","rowRequired","rowDelta","colDelta","measureWidth","colLengthA","colLengthB","measureHeight","rowLengthA","rowLengthB","generateElements","generator","rowFill","colFill","newChildren","lockedColFill","colNum","newChild","tailor","fillCols","fillRows","gridWidth","isLastColLocked","modifiedCols","newLockedColumns","isSpanning","matching","mergeTables","mergeHeight","mergeWidth","lockedColumnObj","skippedCol","gridBColIndex","newCellElm","getValidStartAddress","currentStartAddress","gridColLength","adjustedRowAddress","possibleColAddresses","validColAddress","getLockedColumnsWithinBounds","merge$1","validStartAddress","gridBRows","lockedColumnsWithinBounds","fittedGrid","newLockedColumnsWithinBounds","insertCols","fittedNewGrid","secondDelta","fittedOldGrid","insertRows","oldCols","oldRows","newLocked","secondDiff","fittedGridB","insertRowAt","example","between","ex","withinSpan","getElementFor","insertColumnAt","deleteColumnsAt","deleteRowsAt","replaceIn","isTarget","notStartRow","notStartColumn","replaceColumn","alreadyAdded","replaceRow","targetRow","uniqueColumns","uniqueCheck","columnExists","currentDetail","elementToData","modification","toData","nuFrom","recent","getOrInit","transform$1","makeNew","replaceOrInit","getScopeAttribute","merging","getScopeProperty","stringAttributes","baseScope_1","scopes_1","isMixed","Generators","blockList","isList","tagName","isBlock","universe$2","isBlock$1","isList$1","isEmptyTag$1","merge$2","isBr","advancedBr","isListItem","siblingIsBlock","rightSibling","markCell","rightSiblingIsBlock","markContent","contents","outcome","elementFromGrid","findIn","bundle","uniqueRows","rowCompilation","rowExists","opInsertRowsBefore","targetIndex","newGrid","newG","opInsertRowsAfter","opInsertColumnsBefore","extractDetail","opInsertColumnsAfter","opMakeRowHeader","opMakeRowsHeader","initialGrid","replacer","currentGrid","opMakeColumnHeader","opMakeColumnsHeader","opUnmakeRowHeader","opUnmakeRowsHeader","opUnmakeColumnHeader","opUnmakeColumnsHeader","opEraseColumns","_comparator","_genWrappers","opEraseRows","opMergeCells","opUnmergeCells","unmerge$1","opPasteCells","pasteDetails","gridify","wh","mergedGrid","gridifyRows","opPasteColsBefore","opPasteColsAfter","opPasteRowsBefore","opPasteRowsAfter","opGetColumnType","lastSelectedCell","minColRange","maxColRange","selectedColumnCells","getCellsType","headerPred","headerCells","adjustAndRedistributeWidths$1","firstColumnIsLocked","lastColumnIsLocked","getColumnsWidth","uniqueCols","colWidth","insertColumnsExtractor","checkLocked","eraseColumnsExtractor","pasteColumnsExtractor","insertRowsBefore","insertRowsAfter","insertColumnsBefore","insertColumnsAfter","eraseColumns","eraseRows","makeColumnHeader","makeColumnsHeader","unmakeColumnHeader","unmakeColumnsHeader","makeRowHeader","makeRowsHeader","unmakeRowHeader","unmakeRowsHeader","mergeCells","unmergeCells","pasteColsBefore","pasteColsAfter","pasteRowsBefore","pasteRowsAfter","getColumnType","mapSectionNameToType","detectHeaderRow","isThead","areAllCellsThs","thead","ths","getRowType","_rowConfig","switchRowSection","rowElm","newSectionName","tableElm","oldSectionElm","oldSectionName","sectionElm_1","firstTableChild_1","insertAfter","renameCell","newCellType","rename","switchCellType","setAttrib","switchCellsType","switchSectionType","determineHeaderRowType","allTableRows","detectedType","headerRowTypeSetting","headerRowType","getSelectionStartCellFallback","getSelectionStartFromSelector","startCellName","getSelectionStartCell","getSelectionStartCellOrCaption","getCellsFromSelection","_cell","getRowsFromSelection","rowsOpt","TableActions","isTableBody","lastRowGuard","lastColumnGuard","colMutationOp","execute","guard","effect","des","createRng","setStart","setEnd","deleteRow","deleteColumn","insertRowsBefore$1","insertRowsAfter$1","insertColumnsBefore$1","insertColumnsAfter$1","mergeCells$1","unmergeCells$1","pasteColsBefore$1","pasteColsAfter$1","pasteRowsBefore$1","pasteRowsAfter$1","pasteCells$1","extractType","validTypes","setTableCellType","setTableRowType","makeColumnsHeader$1","unmakeColumnsHeader$1","getTableRowType","rowTypes","hasHeader","hasFooter","hasBody","getTableCellType","getTableColType","DefaultRenderOptions","colGroups","tableHeaderCell","tableCell","tableColumn","createRow","rowHeaders","columnHeaders","createGroupRow","createRows","render$1","headerType","renderOpts","rowHeadersGoInThead","actualRowHeaders","theadRowHeaders","theadRows","tbody","numRows","numRowHeaders","tbodyRows","get$b","getOuter$2","placeCaretInCell","collapse","selectFirstCellInTable","fireEvents","isPercentage$1","insert$1","colHeaders","insertContent","addVisual","insertTableWithDataValidation","errorMsg","checkInput","headerRows","headerColumns","getClipboardElements","getClipboard","setClipboardElements","setClipboard","elmsOpt","insertTable","getApi","resizeHandler","selectionTargets","setClipboardRows","setRows","getClipboardRows","getRows","setClipboardCols","setColumns","getClipboardCols","getColumns","constrainSpan","currentColspan","generateColGroup","colsToCopy","copiedCols","clonedCol","fakeColgroup","generateRows","cellsToCopy","copiedCells","fakeTR","copyCols","fakeColGroups","fakeRows","copyRows","slicedGrid","filteredGrid","slicedDetails","global$1","getTDTHOverallStyle","firstChildStyle","checkChildren","elms","currentStyle","applyAlign","formatter","applyVAlign","unApplyAlign","unApplyVAlign","isListGroup","buildListItems","inputList","startItems","appendItems","title","items","menu","rgbToHex","toHex","extractAdvancedStyles","borderwidth","borderstyle","bordercolor","backgroundcolor","getSharedValues","baseData","comparisonData","itemValue","itemKey","comparisonValue","getAdvancedTab","dialogName","advTabItems","borderWidth","getAlignment","formatName","matchNode","getHAlignment","getVAlignment","extractDataFromSettings","hasAdvTableTab","extractAdvancedStyleData","defaultData","cellspacing","cellpadding","caption","class","align","getBorder","advStyle","getCellPaddingCellSpacing","spacing","extractDataFromTableElement","optBorderWidth","extractDataFromRowElement","extractDataFromCellElement","colElm","celltype","halign","valign","getClassList","classes","children$3","getItems","modifiers","testTruthy","setStyle","setFormat","DomModifier","normal","ifTruthy","getSelectedCells","cellA","cellB","updateSimpleProps","modifier","colModifier","updateAdvancedProps","applyCellData","oldData","isSingleCell","modifiedData","cellElm","styleModified_1","onSubmitCellForm","getData","close","transact","cellsData","open","dialogTabPanel","tabs","dialogPanel","windowManager","buttons","primary","initialData","onSubmit","getClassList$1","formChildren","getItems$1","updateSimpleProps$1","updateAdvancedProps$1","applyRowData","isSingleRow","typeModified_1","onSubmitRowForm","open$1","rowsData","global$2","getItems$2","insertNewTable","rowColCountItems","inputMode","alwaysItems","appearanceItems","alignmentItem","classListItem","styleTDTH","applyDataToElement","serializeStyle","setAttribs","onSubmitTableForm","captionElm","captionModified","open$2","generalPanel","nonAdvancedForm","advancedForm","dialogBody","getSelectionStartCellOrCaption$1","getSelectionStartCell$1","registerCommands","eraseTable","cellOrCaption","setContent","setCursorLocation","nodeChanged","setSizingMode","isForcedSizing","getTableFromCell","postExecute","actOnSelection","copyRowSelection","copyColSelection","pasteOnSelection","clonedRows","mceTableSplitCells","mceTableMergeCells","mceTableInsertRowBefore","mceTableInsertRowAfter","mceTableInsertColBefore","mceTableInsertColAfter","mceTableDeleteCol","mceTableDeleteRow","mceTableCutCol","_grid","mceTableCutRow","mceTableCopyCol","mceTableCopyRow","mceTablePasteColBefore","mceTablePasteColAfter","mceTablePasteRowBefore","mceTablePasteRowAfter","mceTableDelete","mceTableSizingMode","ui","func","addCommand","fireTableModifiedForSelection","mceTableCellType","_ui","mceTableRowType","mceTableProps","mceTableRowProps","mceTableCellProps","getFormatName","validArgs","registerQueryCommands","mceTableColType","addQueryValueHandler","Clipboard","clearClipboard","clearRows","clearColumns","cellFormats","tablecellbackgroundcolor","backgroundColor","remove_similar","tablecellbordercolor","borderColor","tablecellborderstyle","borderStyle","tablecellborderwidth","registerFormats","register","adt$2","none$2","CellLocation","detect$5","detection","create$2","soffset","foffset","SimRange","adt$3","cata$1","onBefore","onOn","onAfter","situ","before$2","after$2","Situ","adt$4","domRange","exact","exactFromRange","simRange","getStart$1","startContainer","startSitu","_finishSitu","_soffset","_finish","_foffset","getWin","range$1","SimSelection","selectNodeContents","createRange","selectNodeContentsUsing","setStartBefore","setStartAfter","setFinish","setEndBefore","setEndAfter","relativeToNative","finishSitu","exactToNative","toRect","rect","bottom","getFirstRect","rects","getClientRects","adt$5","fromRange","startOffset","endContainer","endOffset","getRanges","doDiagnose","ranges","collapsed","reversed","rev","diagnose","asLtrRange","diagnosis","ltr$1","rtl$1","searchForPoint","rectForOffset","maxX","curDeltaX","inRect","locateOffset","textnode","rangeForOffset","locate","selectNode","foundRect","searchInChildren","locateNode","locate$1","boundedX","boundedY","COLLAPSE_TO_LEFT","COLLAPSE_TO_RIGHT","getCollapseDirection","createCollapsedNode","collapseDirection","locateInElement","cursorRange","locateInEmpty","caretPositionFromPoint","offsetNode","caretRangeFromPoint","searchTextNodes","searchFromPoint","availableSearch","fromPoint$1","beforeSpecial","name$1","preprocessRelative","preprocessExact","preprocess","makeRange","after$3","same","getNativeSelection","getSelection","doSetNativeRange","removeAllRanges","addRange","doSetRange","setLegacyRtlRange","extend","setRangeFromRelative","setBaseAndExtent","setExact","setRelative","toNative","getDomRange","readRange","rangeCount","firstRng","getRangeAt","lastRng","doGetExact","anchorNode","focusNode","anchor","focus_1","anchorOffset","focusOffset","setToElement","getExact","sel","get$c","getFirstRect$1","getAtPoint","global$3","forward","backward","getCellFirstCursorPosition","getNewRowCursorPosition","execCommand","rootElements","handle$1","keyCode","TAB","body_1","isRoot_1","shiftKey","navigation","create$3","Response","create$4","Situs","convertToRange","makeSitus","selectRange","detect$6","cellSel","annotations","updateSelection","newSels","clearBeforeUpdate","traverse","backtrack","_direction","transition","sidestep","advance","successors","go$1","rules","ruleOpt","succ","rule","Walkers","hone","left$1","right$1","isLeaf","before$3","seekLeft","after$4","seekRight","universe$3","before$4","after$5","seekLeft$1","seekRight$1","ancestor$2","adt$6","success","failedUp","failedDown","isOverlapping","bridge","beforeBounds","getRect","afterBounds","isRow","verify","beforeOffset","afterOffset","failure","afterCell","beforeCell","_sharedRow","cata$2","onSuccess","onFailedUp","onFailedDown","BeforeAfter","inParent","indexInParent","gatherer","cand","gather","handleBr","findBr","handleParent","br","adjacent","tryBr","tgt","process","analysis","_message","moveDown","caret","moveUp","getTop$1","getBottom","getPartialBox","getRangedRect","toCaret","getElemBox","getBoxAt","getEntireBox","JUMP_SIZE","NUM_RETRIES","adt$7","retry","isOutside","inOutsideBlock","adjustDown","guessBox","lowerCaret","adjustUp","higherCaret","upMovement","adjuster","downMovement","isAtTable","adjustForTable","numRetries","adjustTil","situsFromPoint","guess","newCaret","ieTryDown","ieTryUp","checkScroll","adjusted","getInnerHeight","moved","scrollBy","Retries","tryUp","tryDown","getJumpSize","MAX_RETRIES","findSpot","brNeighbour","fromSitus","scan$1","tryCursor","situs","tryAgain","tryAt","otherRetry","ieRetry","handle$2","spot","inSameTable","simulate","navigate","precheck","firstUpCheck","lastOffset","lastDownCheck","value$1","isSet","findCell","MouseSelection","clearstate","applySelection","selectContents","mouseup","isKey","keycode","isUp","isDown","isNavigation","ltr$2","isBackward","isForward","rtl$2","get$d","_DOC","by","WindowBridge","exactAdt","clearSelection","collapseSelection","toStart","setSelection","setRelativeSelection","innerHeight","getScrollY","rc","mouse","keyboard","clearToNavigate","keydown","realEvent","which","update$1","attempts","keyup","external","remove$7","removeClasses","byClass","addSelectionClass","removeSelectionClasses","byAttr","onSelection","onClear","removeSelectionAttributes","addSelectionAttribute","SelectionAnnotation","getUpOrLeftCells","upGrid","upDetails","slicedCells","getDownOrRightCells","downGrid","downDetails","getOtherCells","upOrLeftCells","downOrRightCells","hasInternalTarget","CellSelection","_e","syncSelection","mouseHandlers","keyHandlers","external$1","hasShiftKey","handleResponse","response","ns","wrappedEvent","isLeftMouse","button","isLeftButtonPressed","dragStart","mouseDown","mouseOver","mouseUp","getDoubleTap","lastTarget","lastTimeStamp","touchEnd","lT","lTS","timeStamp","doubleTap","getSelectionTargets","changeHandlers","selectionDetails","isCaption","isDisabledForSelection","findTargets","table$1","getExtractedDetails","onAny","onFirst","onLast","unmergeable","resetTargets","onSetup","isDisabled","setDisabled","isDisabledFromLocked","lockedDisable","onSetupTable","onSetupCellOrRow","onSetupColumn","onSetupPasteable","getClipboardData","onSetupPasteableColumn","onSetupMergeable","_targets","onSetupUnmergeable","addButtons","addMenuButton","tooltip","icon","fetch","callback","cmd","command","addButton","onAction","addToolbars","toolbar","addContextToolbar","addMenuItems","insertTableAction","numColumns","tableProperties","deleteTable","addMenuItem","getSubmenuItems","addNestedMenuItem","fancytype","addContextMenu","Plugin","addTempAttr","Plugin$1"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACC,aAAY;AACT;;AAEA,MAAIA,MAAM,GAAG,UAAUC,CAAV,EAAa;AACxB,QAAIC,CAAC,GAAG,OAAOD,CAAf;;AACA,QAAIA,CAAC,KAAK,IAAV,EAAgB;AACd,aAAO,MAAP;AACD,KAFD,MAEO,IAAIC,CAAC,KAAK,QAAN,KAAmBC,KAAK,CAACC,SAAN,CAAgBC,aAAhB,CAA8BJ,CAA9B,KAAoCA,CAAC,CAACK,WAAF,IAAiBL,CAAC,CAACK,WAAF,CAAcC,IAAd,KAAuB,OAA/F,CAAJ,EAA6G;AAClH,aAAO,OAAP;AACD,KAFM,MAEA,IAAIL,CAAC,KAAK,QAAN,KAAmBM,MAAM,CAACJ,SAAP,CAAiBC,aAAjB,CAA+BJ,CAA/B,KAAqCA,CAAC,CAACK,WAAF,IAAiBL,CAAC,CAACK,WAAF,CAAcC,IAAd,KAAuB,QAAhG,CAAJ,EAA+G;AACpH,aAAO,QAAP;AACD,KAFM,MAEA;AACL,aAAOL,CAAP;AACD;AACF,GAXD;;AAYA,MAAIO,MAAM,GAAG,UAAUC,IAAV,EAAgB;AAC3B,WAAO,UAAUC,KAAV,EAAiB;AACtB,aAAOX,MAAM,CAACW,KAAD,CAAN,KAAkBD,IAAzB;AACD,KAFD;AAGD,GAJD;;AAKA,MAAIE,YAAY,GAAG,UAAUF,IAAV,EAAgB;AACjC,WAAO,UAAUC,KAAV,EAAiB;AACtB,aAAO,OAAOA,KAAP,KAAiBD,IAAxB;AACD,KAFD;AAGD,GAJD;;AAKA,MAAIG,EAAE,GAAG,UAAUX,CAAV,EAAa;AACpB,WAAO,UAAUY,CAAV,EAAa;AAClB,aAAOZ,CAAC,KAAKY,CAAb;AACD,KAFD;AAGD,GAJD;;AAKA,MAAIC,QAAQ,GAAGN,MAAM,CAAC,QAAD,CAArB;AACA,MAAIO,QAAQ,GAAGP,MAAM,CAAC,QAAD,CAArB;AACA,MAAIQ,OAAO,GAAGR,MAAM,CAAC,OAAD,CAApB;AACA,MAAIS,SAAS,GAAGN,YAAY,CAAC,SAAD,CAA5B;AACA,MAAIO,WAAW,GAAGN,EAAE,CAACO,SAAD,CAApB;;AACA,MAAIC,UAAU,GAAG,UAAUP,CAAV,EAAa;AAC5B,WAAOA,CAAC,KAAK,IAAN,IAAcA,CAAC,KAAKM,SAA3B;AACD,GAFD;;AAGA,MAAIE,aAAa,GAAG,UAAUR,CAAV,EAAa;AAC/B,WAAO,CAACO,UAAU,CAACP,CAAD,CAAlB;AACD,GAFD;;AAGA,MAAIS,UAAU,GAAGX,YAAY,CAAC,UAAD,CAA7B;AACA,MAAIY,QAAQ,GAAGZ,YAAY,CAAC,QAAD,CAA3B;;AAEA,MAAIa,IAAI,GAAG,YAAY,CACtB,CADD;;AAEA,MAAIC,OAAO,GAAG,UAAUC,EAAV,EAAcC,EAAd,EAAkB;AAC9B,WAAO,YAAY;AACjB,UAAIC,IAAI,GAAG,EAAX;;AACA,WAAK,IAAIC,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAACC,MAAhC,EAAwCF,EAAE,EAA1C,EAA8C;AAC5CD,QAAAA,IAAI,CAACC,EAAD,CAAJ,GAAWC,SAAS,CAACD,EAAD,CAApB;AACD;;AACD,aAAOH,EAAE,CAACC,EAAE,CAACK,KAAH,CAAS,IAAT,EAAeJ,IAAf,CAAD,CAAT;AACD,KAND;AAOD,GARD;;AASA,MAAIK,QAAQ,GAAG,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACjC,WAAO,UAAUtB,CAAV,EAAa;AAClB,aAAOqB,GAAG,CAACC,GAAG,CAACtB,CAAD,CAAJ,CAAV;AACD,KAFD;AAGD,GAJD;;AAKA,MAAIuB,QAAQ,GAAG,UAAU1B,KAAV,EAAiB;AAC9B,WAAO,YAAY;AACjB,aAAOA,KAAP;AACD,KAFD;AAGD,GAJD;;AAKA,MAAI2B,QAAQ,GAAG,UAAUrC,CAAV,EAAa;AAC1B,WAAOA,CAAP;AACD,GAFD;;AAGA,WAASsC,KAAT,CAAeC,EAAf,EAAmB;AACjB,QAAIC,WAAW,GAAG,EAAlB;;AACA,SAAK,IAAIX,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAACC,MAAhC,EAAwCF,EAAE,EAA1C,EAA8C;AAC5CW,MAAAA,WAAW,CAACX,EAAE,GAAG,CAAN,CAAX,GAAsBC,SAAS,CAACD,EAAD,CAA/B;AACD;;AACD,WAAO,YAAY;AACjB,UAAIY,QAAQ,GAAG,EAAf;;AACA,WAAK,IAAIZ,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAACC,MAAhC,EAAwCF,EAAE,EAA1C,EAA8C;AAC5CY,QAAAA,QAAQ,CAACZ,EAAD,CAAR,GAAeC,SAAS,CAACD,EAAD,CAAxB;AACD;;AACD,UAAIa,GAAG,GAAGF,WAAW,CAACG,MAAZ,CAAmBF,QAAnB,CAAV;AACA,aAAOF,EAAE,CAACP,KAAH,CAAS,IAAT,EAAeU,GAAf,CAAP;AACD,KAPD;AAQD;;AACD,MAAIE,GAAG,GAAG,UAAUC,CAAV,EAAa;AACrB,WAAO,UAAU5C,CAAV,EAAa;AAClB,aAAO,CAAC4C,CAAC,CAAC5C,CAAD,CAAT;AACD,KAFD;AAGD,GAJD;;AAKA,MAAI6C,GAAG,GAAG,UAAUC,GAAV,EAAe;AACvB,WAAO,YAAY;AACjB,YAAM,IAAIC,KAAJ,CAAUD,GAAV,CAAN;AACD,KAFD;AAGD,GAJD;;AAKA,MAAIE,KAAK,GAAGb,QAAQ,CAAC,KAAD,CAApB;AACA,MAAIc,MAAM,GAAGd,QAAQ,CAAC,IAAD,CAArB;;AAEA,MAAIe,IAAI,GAAG,YAAY;AACrB,WAAOC,IAAP;AACD,GAFD;;AAGA,MAAIA,IAAI,GAAG,YAAY;AACrB,QAAIxC,EAAE,GAAG,UAAUyC,CAAV,EAAa;AACpB,aAAOA,CAAC,CAACC,MAAF,EAAP;AACD,KAFD;;AAGA,QAAIC,IAAI,GAAG,UAAUC,KAAV,EAAiB;AAC1B,aAAOA,KAAK,EAAZ;AACD,KAFD;;AAGA,QAAIC,EAAE,GAAG,UAAUC,CAAV,EAAa;AACpB,aAAOA,CAAP;AACD,KAFD;;AAGA,QAAIC,EAAE,GAAG;AACPC,MAAAA,IAAI,EAAE,UAAUF,CAAV,EAAaG,EAAb,EAAiB;AACrB,eAAOH,CAAC,EAAR;AACD,OAHM;AAIPI,MAAAA,EAAE,EAAEb,KAJG;AAKPc,MAAAA,MAAM,EAAEd,KALD;AAMPK,MAAAA,MAAM,EAAEJ,MAND;AAOPc,MAAAA,KAAK,EAAEP,EAPA;AAQPQ,MAAAA,UAAU,EAAEV,IARL;AASPW,MAAAA,QAAQ,EAAE,UAAUnB,GAAV,EAAe;AACvB,cAAM,IAAIC,KAAJ,CAAUD,GAAG,IAAI,iCAAjB,CAAN;AACD,OAXM;AAYPoB,MAAAA,SAAS,EAAE/B,QAAQ,CAAC,IAAD,CAZZ;AAaPgC,MAAAA,cAAc,EAAEhC,QAAQ,CAACjB,SAAD,CAbjB;AAcPkD,MAAAA,EAAE,EAAEZ,EAdG;AAePa,MAAAA,OAAO,EAAEf,IAfF;AAgBPgB,MAAAA,GAAG,EAAEpB,IAhBE;AAiBPqB,MAAAA,IAAI,EAAEhD,IAjBC;AAkBPiD,MAAAA,IAAI,EAAEtB,IAlBC;AAmBPuB,MAAAA,MAAM,EAAEzB,KAnBD;AAoBP0B,MAAAA,MAAM,EAAEzB,MApBD;AAqBP0B,MAAAA,MAAM,EAAEzB,IArBD;AAsBP0B,MAAAA,MAAM,EAAEjE,EAtBD;AAuBPkE,MAAAA,OAAO,EAAElE,EAvBF;AAwBPmE,MAAAA,OAAO,EAAE,YAAY;AACnB,eAAO,EAAP;AACD,OA1BM;AA2BPC,MAAAA,QAAQ,EAAE5C,QAAQ,CAAC,QAAD;AA3BX,KAAT;AA6BA,WAAOuB,EAAP;AACD,GAxCU,EAAX;;AAyCA,MAAIsB,IAAI,GAAG,UAAUpE,CAAV,EAAa;AACtB,QAAIqE,UAAU,GAAG9C,QAAQ,CAACvB,CAAD,CAAzB;;AACA,QAAIsE,IAAI,GAAG,YAAY;AACrB,aAAOxB,EAAP;AACD,KAFD;;AAGA,QAAIc,IAAI,GAAG,UAAU5B,CAAV,EAAa;AACtB,aAAOA,CAAC,CAAChC,CAAD,CAAR;AACD,KAFD;;AAGA,QAAI8C,EAAE,GAAG;AACPC,MAAAA,IAAI,EAAE,UAAUF,CAAV,EAAa0B,CAAb,EAAgB;AACpB,eAAOA,CAAC,CAACvE,CAAD,CAAR;AACD,OAHM;AAIPiD,MAAAA,EAAE,EAAE,UAAUuB,CAAV,EAAa;AACf,eAAOxE,CAAC,KAAKwE,CAAb;AACD,OANM;AAOPtB,MAAAA,MAAM,EAAEb,MAPD;AAQPI,MAAAA,MAAM,EAAEL,KARD;AASPe,MAAAA,KAAK,EAAEkB,UATA;AAUPjB,MAAAA,UAAU,EAAEiB,UAVL;AAWPhB,MAAAA,QAAQ,EAAEgB,UAXH;AAYPf,MAAAA,SAAS,EAAEe,UAZJ;AAaPd,MAAAA,cAAc,EAAEc,UAbT;AAcPb,MAAAA,EAAE,EAAEc,IAdG;AAePb,MAAAA,OAAO,EAAEa,IAfF;AAgBPZ,MAAAA,GAAG,EAAE,UAAU1B,CAAV,EAAa;AAChB,eAAOoC,IAAI,CAACpC,CAAC,CAAChC,CAAD,CAAF,CAAX;AACD,OAlBM;AAmBP2D,MAAAA,IAAI,EAAE,UAAU3B,CAAV,EAAa;AACjBA,QAAAA,CAAC,CAAChC,CAAD,CAAD;AACD,OArBM;AAsBP4D,MAAAA,IAAI,EAAEA,IAtBC;AAuBPC,MAAAA,MAAM,EAAED,IAvBD;AAwBPE,MAAAA,MAAM,EAAEF,IAxBD;AAyBPG,MAAAA,MAAM,EAAE,UAAU/B,CAAV,EAAa;AACnB,eAAOA,CAAC,CAAChC,CAAD,CAAD,GAAO8C,EAAP,GAAYP,IAAnB;AACD,OA3BM;AA4BP2B,MAAAA,OAAO,EAAE,YAAY;AACnB,eAAO,CAAClE,CAAD,CAAP;AACD,OA9BM;AA+BPmE,MAAAA,QAAQ,EAAE,YAAY;AACpB,eAAO,UAAUnE,CAAV,GAAc,GAArB;AACD,OAjCM;AAkCPgE,MAAAA,MAAM,EAAE,UAAUxB,CAAV,EAAa;AACnB,eAAOA,CAAC,CAACS,EAAF,CAAKjD,CAAL,CAAP;AACD,OApCM;AAqCPiE,MAAAA,OAAO,EAAE,UAAUzB,CAAV,EAAaiC,SAAb,EAAwB;AAC/B,eAAOjC,CAAC,CAACO,IAAF,CAAOX,KAAP,EAAc,UAAUsC,CAAV,EAAa;AAChC,iBAAOD,SAAS,CAACzE,CAAD,EAAI0E,CAAJ,CAAhB;AACD,SAFM,CAAP;AAGD;AAzCM,KAAT;AA2CA,WAAO5B,EAAP;AACD,GApDD;;AAqDA,MAAI6B,IAAI,GAAG,UAAU9E,KAAV,EAAiB;AAC1B,WAAOA,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAKS,SAA5B,GAAwCiC,IAAxC,GAA+C6B,IAAI,CAACvE,KAAD,CAA1D;AACD,GAFD;;AAGA,MAAI+E,QAAQ,GAAG;AACbR,IAAAA,IAAI,EAAEA,IADO;AAEb9B,IAAAA,IAAI,EAAEA,IAFO;AAGbqC,IAAAA,IAAI,EAAEA;AAHO,GAAf;AAMA,MAAIE,WAAW,GAAGxF,KAAK,CAACC,SAAN,CAAgBwF,KAAlC;AACA,MAAIC,aAAa,GAAG1F,KAAK,CAACC,SAAN,CAAgB0F,OAApC;AACA,MAAIC,UAAU,GAAG5F,KAAK,CAACC,SAAN,CAAgB4F,IAAjC;;AACA,MAAIC,UAAU,GAAG,UAAUC,EAAV,EAAchG,CAAd,EAAiB;AAChC,WAAO2F,aAAa,CAACrC,IAAd,CAAmB0C,EAAnB,EAAuBhG,CAAvB,CAAP;AACD,GAFD;;AAGA,MAAIiG,QAAQ,GAAG,UAAUC,EAAV,EAAcnG,CAAd,EAAiB;AAC9B,WAAOgG,UAAU,CAACG,EAAD,EAAKnG,CAAL,CAAV,GAAoB,CAAC,CAA5B;AACD,GAFD;;AAGA,MAAI0E,MAAM,GAAG,UAAUyB,EAAV,EAAcC,IAAd,EAAoB;AAC/B,SAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,EAAE,CAACpE,MAAzB,EAAiCsE,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC7C,UAAIrG,CAAC,GAAGmG,EAAE,CAACE,CAAD,CAAV;;AACA,UAAID,IAAI,CAACpG,CAAD,EAAIqG,CAAJ,CAAR,EAAgB;AACd,eAAO,IAAP;AACD;AACF;;AACD,WAAO,KAAP;AACD,GARD;;AASA,MAAIE,KAAK,GAAG,UAAUC,GAAV,EAAe3D,CAAf,EAAkB;AAC5B,QAAI4D,CAAC,GAAG,EAAR;;AACA,SAAK,IAAIJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGG,GAApB,EAAyBH,CAAC,EAA1B,EAA8B;AAC5BI,MAAAA,CAAC,CAACV,IAAF,CAAOlD,CAAC,CAACwD,CAAD,CAAR;AACD;;AACD,WAAOI,CAAP;AACD,GAND;;AAOA,MAAIlC,GAAG,GAAG,UAAU4B,EAAV,EAActD,CAAd,EAAiB;AACzB,QAAIyD,GAAG,GAAGH,EAAE,CAACpE,MAAb;AACA,QAAI0E,CAAC,GAAG,IAAIvG,KAAJ,CAAUoG,GAAV,CAAR;;AACA,SAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGC,GAApB,EAAyBD,CAAC,EAA1B,EAA8B;AAC5B,UAAIrG,CAAC,GAAGmG,EAAE,CAACE,CAAD,CAAV;AACAI,MAAAA,CAAC,CAACJ,CAAD,CAAD,GAAOxD,CAAC,CAAC7C,CAAD,EAAIqG,CAAJ,CAAR;AACD;;AACD,WAAOI,CAAP;AACD,GARD;;AASA,MAAIjC,IAAI,GAAG,UAAU2B,EAAV,EAActD,CAAd,EAAiB;AAC1B,SAAK,IAAIwD,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,EAAE,CAACpE,MAAzB,EAAiCsE,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC7C,UAAIrG,CAAC,GAAGmG,EAAE,CAACE,CAAD,CAAV;AACAxD,MAAAA,CAAC,CAAC7C,CAAD,EAAIqG,CAAJ,CAAD;AACD;AACF,GALD;;AAMA,MAAIK,KAAK,GAAG,UAAUP,EAAV,EAActD,CAAd,EAAiB;AAC3B,SAAK,IAAIwD,CAAC,GAAGF,EAAE,CAACpE,MAAH,GAAY,CAAzB,EAA4BsE,CAAC,IAAI,CAAjC,EAAoCA,CAAC,EAArC,EAAyC;AACvC,UAAIrG,CAAC,GAAGmG,EAAE,CAACE,CAAD,CAAV;AACAxD,MAAAA,CAAC,CAAC7C,CAAD,EAAIqG,CAAJ,CAAD;AACD;AACF,GALD;;AAMA,MAAIM,SAAS,GAAG,UAAUR,EAAV,EAAcC,IAAd,EAAoB;AAClC,QAAIQ,IAAI,GAAG,EAAX;AACA,QAAIC,IAAI,GAAG,EAAX;;AACA,SAAK,IAAIR,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,EAAE,CAACpE,MAAzB,EAAiCsE,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC7C,UAAIrG,CAAC,GAAGmG,EAAE,CAACE,CAAD,CAAV;AACA,UAAIS,GAAG,GAAGV,IAAI,CAACpG,CAAD,EAAIqG,CAAJ,CAAJ,GAAaO,IAAb,GAAoBC,IAA9B;AACAC,MAAAA,GAAG,CAACf,IAAJ,CAAS/F,CAAT;AACD;;AACD,WAAO;AACL4G,MAAAA,IAAI,EAAEA,IADD;AAELC,MAAAA,IAAI,EAAEA;AAFD,KAAP;AAID,GAZD;;AAaA,MAAIjC,MAAM,GAAG,UAAUuB,EAAV,EAAcC,IAAd,EAAoB;AAC/B,QAAIK,CAAC,GAAG,EAAR;;AACA,SAAK,IAAIJ,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,EAAE,CAACpE,MAAzB,EAAiCsE,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC7C,UAAIrG,CAAC,GAAGmG,EAAE,CAACE,CAAD,CAAV;;AACA,UAAID,IAAI,CAACpG,CAAD,EAAIqG,CAAJ,CAAR,EAAgB;AACdI,QAAAA,CAAC,CAACV,IAAF,CAAO/F,CAAP;AACD;AACF;;AACD,WAAOyG,CAAP;AACD,GATD;;AAUA,MAAIM,KAAK,GAAG,UAAUZ,EAAV,EAActD,CAAd,EAAiBmE,GAAjB,EAAsB;AAChCN,IAAAA,KAAK,CAACP,EAAD,EAAK,UAAUnG,CAAV,EAAa;AACrBgH,MAAAA,GAAG,GAAGnE,CAAC,CAACmE,GAAD,EAAMhH,CAAN,CAAP;AACD,KAFI,CAAL;AAGA,WAAOgH,GAAP;AACD,GALD;;AAMA,MAAIC,KAAK,GAAG,UAAUd,EAAV,EAActD,CAAd,EAAiBmE,GAAjB,EAAsB;AAChCxC,IAAAA,IAAI,CAAC2B,EAAD,EAAK,UAAUnG,CAAV,EAAa;AACpBgH,MAAAA,GAAG,GAAGnE,CAAC,CAACmE,GAAD,EAAMhH,CAAN,CAAP;AACD,KAFG,CAAJ;AAGA,WAAOgH,GAAP;AACD,GALD;;AAMA,MAAIE,SAAS,GAAG,UAAUf,EAAV,EAAcC,IAAd,EAAoBe,KAApB,EAA2B;AACzC,SAAK,IAAId,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,EAAE,CAACpE,MAAzB,EAAiCsE,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC7C,UAAIrG,CAAC,GAAGmG,EAAE,CAACE,CAAD,CAAV;;AACA,UAAID,IAAI,CAACpG,CAAD,EAAIqG,CAAJ,CAAR,EAAgB;AACd,eAAOZ,QAAQ,CAACR,IAAT,CAAcjF,CAAd,CAAP;AACD,OAFD,MAEO,IAAImH,KAAK,CAACnH,CAAD,EAAIqG,CAAJ,CAAT,EAAiB;AACtB;AACD;AACF;;AACD,WAAOZ,QAAQ,CAACtC,IAAT,EAAP;AACD,GAVD;;AAWA,MAAIiE,IAAI,GAAG,UAAUjB,EAAV,EAAcC,IAAd,EAAoB;AAC7B,WAAOc,SAAS,CAACf,EAAD,EAAKC,IAAL,EAAWnD,KAAX,CAAhB;AACD,GAFD;;AAGA,MAAIoE,SAAS,GAAG,UAAUlB,EAAV,EAAcC,IAAd,EAAoB;AAClC,SAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,EAAE,CAACpE,MAAzB,EAAiCsE,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC7C,UAAIrG,CAAC,GAAGmG,EAAE,CAACE,CAAD,CAAV;;AACA,UAAID,IAAI,CAACpG,CAAD,EAAIqG,CAAJ,CAAR,EAAgB;AACd,eAAOZ,QAAQ,CAACR,IAAT,CAAcoB,CAAd,CAAP;AACD;AACF;;AACD,WAAOZ,QAAQ,CAACtC,IAAT,EAAP;AACD,GARD;;AASA,MAAImE,OAAO,GAAG,UAAUnB,EAAV,EAAc;AAC1B,QAAIM,CAAC,GAAG,EAAR;;AACA,SAAK,IAAIJ,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,EAAE,CAACpE,MAAzB,EAAiCsE,CAAC,GAAGC,GAArC,EAA0C,EAAED,CAA5C,EAA+C;AAC7C,UAAI,CAACrF,OAAO,CAACmF,EAAE,CAACE,CAAD,CAAH,CAAZ,EAAqB;AACnB,cAAM,IAAIrD,KAAJ,CAAU,sBAAsBqD,CAAtB,GAA0B,4BAA1B,GAAyDF,EAAnE,CAAN;AACD;;AACDL,MAAAA,UAAU,CAAC9D,KAAX,CAAiByE,CAAjB,EAAoBN,EAAE,CAACE,CAAD,CAAtB;AACD;;AACD,WAAOI,CAAP;AACD,GATD;;AAUA,MAAIhC,IAAI,GAAG,UAAU0B,EAAV,EAActD,CAAd,EAAiB;AAC1B,WAAOyE,OAAO,CAAC/C,GAAG,CAAC4B,EAAD,EAAKtD,CAAL,CAAJ,CAAd;AACD,GAFD;;AAGA,MAAI8B,MAAM,GAAG,UAAUwB,EAAV,EAAcC,IAAd,EAAoB;AAC/B,SAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,EAAE,CAACpE,MAAzB,EAAiCsE,CAAC,GAAGC,GAArC,EAA0C,EAAED,CAA5C,EAA+C;AAC7C,UAAIrG,CAAC,GAAGmG,EAAE,CAACE,CAAD,CAAV;;AACA,UAAID,IAAI,CAACpG,CAAD,EAAIqG,CAAJ,CAAJ,KAAe,IAAnB,EAAyB;AACvB,eAAO,KAAP;AACD;AACF;;AACD,WAAO,IAAP;AACD,GARD;;AASA,MAAIkB,OAAO,GAAG,UAAUpB,EAAV,EAAc;AAC1B,QAAIM,CAAC,GAAGf,WAAW,CAACnC,IAAZ,CAAiB4C,EAAjB,EAAqB,CAArB,CAAR;AACAM,IAAAA,CAAC,CAACc,OAAF;AACA,WAAOd,CAAP;AACD,GAJD;;AAKA,MAAIe,WAAW,GAAG,UAAUrB,EAAV,EAActD,CAAd,EAAiB;AACjC,QAAI4D,CAAC,GAAG,EAAR;;AACA,SAAK,IAAIJ,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,EAAE,CAACpE,MAAzB,EAAiCsE,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC7C,UAAIrG,CAAC,GAAGmG,EAAE,CAACE,CAAD,CAAV;AACAI,MAAAA,CAAC,CAAClG,MAAM,CAACP,CAAD,CAAP,CAAD,GAAe6C,CAAC,CAAC7C,CAAD,EAAIqG,CAAJ,CAAhB;AACD;;AACD,WAAOI,CAAP;AACD,GAPD;;AAQA,MAAIgB,IAAI,GAAG,UAAUzH,CAAV,EAAa;AACtB,WAAO,CAACA,CAAD,CAAP;AACD,GAFD;;AAGA,MAAI0H,IAAI,GAAG,UAAUvB,EAAV,EAAcwB,UAAd,EAA0B;AACnC,QAAIC,IAAI,GAAGlC,WAAW,CAACnC,IAAZ,CAAiB4C,EAAjB,EAAqB,CAArB,CAAX;AACAyB,IAAAA,IAAI,CAACF,IAAL,CAAUC,UAAV;AACA,WAAOC,IAAP;AACD,GAJD;;AAKA,MAAIC,GAAG,GAAG,UAAU1B,EAAV,EAAcE,CAAd,EAAiB;AACzB,WAAOA,CAAC,IAAI,CAAL,IAAUA,CAAC,GAAGF,EAAE,CAACpE,MAAjB,GAA0B0D,QAAQ,CAACR,IAAT,CAAckB,EAAE,CAACE,CAAD,CAAhB,CAA1B,GAAiDZ,QAAQ,CAACtC,IAAT,EAAxD;AACD,GAFD;;AAGA,MAAI2E,IAAI,GAAG,UAAU3B,EAAV,EAAc;AACvB,WAAO0B,GAAG,CAAC1B,EAAD,EAAK,CAAL,CAAV;AACD,GAFD;;AAGA,MAAI4B,IAAI,GAAG,UAAU5B,EAAV,EAAc;AACvB,WAAO0B,GAAG,CAAC1B,EAAD,EAAKA,EAAE,CAACpE,MAAH,GAAY,CAAjB,CAAV;AACD,GAFD;;AAGA,MAAIiG,OAAO,GAAG,UAAUlB,GAAV,EAAejE,CAAf,EAAkB;AAC9B,SAAK,IAAIwD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGS,GAAG,CAAC/E,MAAxB,EAAgCsE,CAAC,EAAjC,EAAqC;AACnC,UAAII,CAAC,GAAG5D,CAAC,CAACiE,GAAG,CAACT,CAAD,CAAJ,EAASA,CAAT,CAAT;;AACA,UAAII,CAAC,CAAC1C,MAAF,EAAJ,EAAgB;AACd,eAAO0C,CAAP;AACD;AACF;;AACD,WAAOhB,QAAQ,CAACtC,IAAT,EAAP;AACD,GARD;;AAUA,MAAI8E,QAAQ,GAAG,YAAY;AACzBA,IAAAA,QAAQ,GAAGC,MAAM,CAACC,MAAP,IAAiB,SAASF,QAAT,CAAkBhI,CAAlB,EAAqB;AAC/C,WAAK,IAAImF,CAAJ,EAAOiB,CAAC,GAAG,CAAX,EAAc3C,CAAC,GAAG5B,SAAS,CAACC,MAAjC,EAAyCsE,CAAC,GAAG3C,CAA7C,EAAgD2C,CAAC,EAAjD,EAAqD;AACnDjB,QAAAA,CAAC,GAAGtD,SAAS,CAACuE,CAAD,CAAb;;AACA,aAAK,IAAI+B,CAAT,IAAchD,CAAd,EACE,IAAI8C,MAAM,CAAC/H,SAAP,CAAiBkI,cAAjB,CAAgC9E,IAAhC,CAAqC6B,CAArC,EAAwCgD,CAAxC,CAAJ,EACEnI,CAAC,CAACmI,CAAD,CAAD,GAAOhD,CAAC,CAACgD,CAAD,CAAR;AACL;;AACD,aAAOnI,CAAP;AACD,KARD;;AASA,WAAOgI,QAAQ,CAACjG,KAAT,CAAe,IAAf,EAAqBF,SAArB,CAAP;AACD,GAXD;;AAYA,WAASwG,cAAT,GAA0B;AACxB,SAAK,IAAIlD,CAAC,GAAG,CAAR,EAAWiB,CAAC,GAAG,CAAf,EAAkBkC,EAAE,GAAGzG,SAAS,CAACC,MAAtC,EAA8CsE,CAAC,GAAGkC,EAAlD,EAAsDlC,CAAC,EAAvD,EACEjB,CAAC,IAAItD,SAAS,CAACuE,CAAD,CAAT,CAAatE,MAAlB;;AACF,SAAK,IAAI0E,CAAC,GAAGvG,KAAK,CAACkF,CAAD,CAAb,EAAkBoD,CAAC,GAAG,CAAtB,EAAyBnC,CAAC,GAAG,CAAlC,EAAqCA,CAAC,GAAGkC,EAAzC,EAA6ClC,CAAC,EAA9C,EACE,KAAK,IAAIxF,CAAC,GAAGiB,SAAS,CAACuE,CAAD,CAAjB,EAAsBoC,CAAC,GAAG,CAA1B,EAA6BC,EAAE,GAAG7H,CAAC,CAACkB,MAAzC,EAAiD0G,CAAC,GAAGC,EAArD,EAAyDD,CAAC,IAAID,CAAC,EAA/D,EACE/B,CAAC,CAAC+B,CAAD,CAAD,GAAO3H,CAAC,CAAC4H,CAAD,CAAR;;AACJ,WAAOhC,CAAP;AACD;;AAED,MAAIkC,MAAM,GAAG,UAAU9F,CAAV,EAAa;AACxB,QAAI+F,MAAM,GAAG,KAAb;AACA,QAAInC,CAAJ;AACA,WAAO,YAAY;AACjB,UAAI7E,IAAI,GAAG,EAAX;;AACA,WAAK,IAAIC,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAACC,MAAhC,EAAwCF,EAAE,EAA1C,EAA8C;AAC5CD,QAAAA,IAAI,CAACC,EAAD,CAAJ,GAAWC,SAAS,CAACD,EAAD,CAApB;AACD;;AACD,UAAI,CAAC+G,MAAL,EAAa;AACXA,QAAAA,MAAM,GAAG,IAAT;AACAnC,QAAAA,CAAC,GAAG5D,CAAC,CAACb,KAAF,CAAQ,IAAR,EAAcJ,IAAd,CAAJ;AACD;;AACD,aAAO6E,CAAP;AACD,KAVD;AAWD,GAdD;;AAgBA,MAAIoC,UAAU,GAAG,UAAUC,EAAV,EAAcC,OAAd,EAAuBC,SAAvB,EAAkCC,UAAlC,EAA8C;AAC7D,QAAIC,MAAM,GAAGJ,EAAE,CAACK,KAAH,MAAc,QAAQC,IAAR,CAAaJ,SAAb,MAA4B,IAAvD;AACA,QAAIK,QAAQ,GAAGP,EAAE,CAACK,KAAH,MAAc,CAACD,MAA9B;AACA,QAAII,QAAQ,GAAGR,EAAE,CAACK,KAAH,MAAcL,EAAE,CAACS,SAAH,EAA7B;AACA,QAAIC,OAAO,GAAGF,QAAQ,IAAIL,UAAU,CAAC,kBAAD,CAApC;AACA,QAAIQ,QAAQ,GAAGP,MAAM,IAAI,CAACG,QAAD,IAAaC,QAAb,IAAyBL,UAAU,CAAC,0BAAD,CAA5D;AACA,QAAIS,OAAO,GAAGL,QAAQ,IAAIC,QAAQ,IAAI,CAACG,QAAvC;AACA,QAAIE,UAAU,GAAGZ,OAAO,CAACa,QAAR,MAAsBd,EAAE,CAACK,KAAH,EAAtB,IAAoC,UAAUC,IAAV,CAAeJ,SAAf,MAA8B,KAAnF;AACA,QAAIa,SAAS,GAAG,CAACH,OAAD,IAAY,CAACD,QAAb,IAAyB,CAACE,UAA1C;AACA,WAAO;AACLT,MAAAA,MAAM,EAAE9G,QAAQ,CAAC8G,MAAD,CADX;AAELG,MAAAA,QAAQ,EAAEjH,QAAQ,CAACiH,QAAD,CAFb;AAGLI,MAAAA,QAAQ,EAAErH,QAAQ,CAACqH,QAAD,CAHb;AAILC,MAAAA,OAAO,EAAEtH,QAAQ,CAACsH,OAAD,CAJZ;AAKLF,MAAAA,OAAO,EAAEpH,QAAQ,CAACoH,OAAD,CALZ;AAMLD,MAAAA,SAAS,EAAET,EAAE,CAACS,SANT;AAOLJ,MAAAA,KAAK,EAAEL,EAAE,CAACK,KAPL;AAQLW,MAAAA,SAAS,EAAE1H,QAAQ,CAACuH,UAAD,CARd;AASLE,MAAAA,SAAS,EAAEzH,QAAQ,CAACyH,SAAD;AATd,KAAP;AAWD,GApBD;;AAsBA,MAAIE,UAAU,GAAG,UAAUC,OAAV,EAAmB5E,CAAnB,EAAsB;AACrC,SAAK,IAAIiB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2D,OAAO,CAACjI,MAA5B,EAAoCsE,CAAC,EAArC,EAAyC;AACvC,UAAIrG,CAAC,GAAGgK,OAAO,CAAC3D,CAAD,CAAf;;AACA,UAAIrG,CAAC,CAACoJ,IAAF,CAAOhE,CAAP,CAAJ,EAAe;AACb,eAAOpF,CAAP;AACD;AACF;;AACD,WAAOmB,SAAP;AACD,GARD;;AASA,MAAI8I,MAAM,GAAG,UAAUD,OAAV,EAAmBE,KAAnB,EAA0B;AACrC,QAAIzD,CAAC,GAAGsD,UAAU,CAACC,OAAD,EAAUE,KAAV,CAAlB;;AACA,QAAI,CAACzD,CAAL,EAAQ;AACN,aAAO;AACL0D,QAAAA,KAAK,EAAE,CADF;AAELC,QAAAA,KAAK,EAAE;AAFF,OAAP;AAID;;AACD,QAAIC,KAAK,GAAG,UAAUhE,CAAV,EAAa;AACvB,aAAOiE,MAAM,CAACJ,KAAK,CAACK,OAAN,CAAc9D,CAAd,EAAiB,MAAMJ,CAAvB,CAAD,CAAb;AACD,KAFD;;AAGA,WAAOmE,EAAE,CAACH,KAAK,CAAC,CAAD,CAAN,EAAWA,KAAK,CAAC,CAAD,CAAhB,CAAT;AACD,GAZD;;AAaA,MAAII,MAAM,GAAG,UAAUC,cAAV,EAA0BR,KAA1B,EAAiC;AAC5C,QAAIS,YAAY,GAAGpK,MAAM,CAAC2J,KAAD,CAAN,CAAcU,WAAd,EAAnB;;AACA,QAAIF,cAAc,CAAC3I,MAAf,KAA0B,CAA9B,EAAiC;AAC/B,aAAO8I,OAAO,EAAd;AACD;;AACD,WAAOZ,MAAM,CAACS,cAAD,EAAiBC,YAAjB,CAAb;AACD,GAND;;AAOA,MAAIE,OAAO,GAAG,YAAY;AACxB,WAAOL,EAAE,CAAC,CAAD,EAAI,CAAJ,CAAT;AACD,GAFD;;AAGA,MAAIA,EAAE,GAAG,UAAUL,KAAV,EAAiBC,KAAjB,EAAwB;AAC/B,WAAO;AACLD,MAAAA,KAAK,EAAEA,KADF;AAELC,MAAAA,KAAK,EAAEA;AAFF,KAAP;AAID,GALD;;AAMA,MAAIU,OAAO,GAAG;AACZN,IAAAA,EAAE,EAAEA,EADQ;AAEZC,IAAAA,MAAM,EAAEA,MAFI;AAGZI,IAAAA,OAAO,EAAEA;AAHG,GAAd;;AAMA,MAAIE,QAAQ,GAAG,UAAUC,UAAV,EAAsBhC,SAAtB,EAAiC;AAC9C,QAAIkB,KAAK,GAAG3J,MAAM,CAACyI,SAAD,CAAN,CAAkB4B,WAAlB,EAAZ;AACA,WAAOxD,IAAI,CAAC4D,UAAD,EAAa,UAAUC,SAAV,EAAqB;AAC3C,aAAOA,SAAS,CAACC,MAAV,CAAiBhB,KAAjB,CAAP;AACD,KAFU,CAAX;AAGD,GALD;;AAMA,MAAIiB,aAAa,GAAG,UAAUC,QAAV,EAAoBpC,SAApB,EAA+B;AACjD,WAAO+B,QAAQ,CAACK,QAAD,EAAWpC,SAAX,CAAR,CAA8BzE,GAA9B,CAAkC,UAAUwE,OAAV,EAAmB;AAC1D,UAAIsC,OAAO,GAAGP,OAAO,CAACL,MAAR,CAAe1B,OAAO,CAAC2B,cAAvB,EAAuC1B,SAAvC,CAAd;AACA,aAAO;AACLsC,QAAAA,OAAO,EAAEvC,OAAO,CAACzI,IADZ;AAEL+K,QAAAA,OAAO,EAAEA;AAFJ,OAAP;AAID,KANM,CAAP;AAOD,GARD;;AASA,MAAIE,QAAQ,GAAG,UAAUC,IAAV,EAAgBxC,SAAhB,EAA2B;AACxC,WAAO+B,QAAQ,CAACS,IAAD,EAAOxC,SAAP,CAAR,CAA0BzE,GAA1B,CAA8B,UAAUuE,EAAV,EAAc;AACjD,UAAIuC,OAAO,GAAGP,OAAO,CAACL,MAAR,CAAe3B,EAAE,CAAC4B,cAAlB,EAAkC1B,SAAlC,CAAd;AACA,aAAO;AACLsC,QAAAA,OAAO,EAAExC,EAAE,CAACxI,IADP;AAEL+K,QAAAA,OAAO,EAAEA;AAFJ,OAAP;AAID,KANM,CAAP;AAOD,GARD;;AASA,MAAII,QAAQ,GAAG;AACbN,IAAAA,aAAa,EAAEA,aADF;AAEbI,IAAAA,QAAQ,EAAEA;AAFG,GAAf;;AAKA,MAAIG,UAAU,GAAG,UAAUC,GAAV,EAAeC,MAAf,EAAuBC,KAAvB,EAA8B;AAC7C,WAAOD,MAAM,KAAK,EAAX,IAAiBD,GAAG,CAAC5J,MAAJ,IAAc6J,MAAM,CAAC7J,MAArB,IAA+B4J,GAAG,CAACC,MAAJ,CAAWC,KAAX,EAAkBA,KAAK,GAAGD,MAAM,CAAC7J,MAAjC,MAA6C6J,MAApG;AACD,GAFD;;AAGA,MAAIE,UAAU,GAAG,UAAUH,GAAV,EAAeC,MAAf,EAAuB;AACtC,WAAOD,GAAG,CAAC9F,OAAJ,CAAY+F,MAAZ,MAAwB,CAAC,CAAhC;AACD,GAFD;;AAGA,MAAIG,UAAU,GAAG,UAAUJ,GAAV,EAAeK,MAAf,EAAuB;AACtC,WAAON,UAAU,CAACC,GAAD,EAAMK,MAAN,EAAc,CAAd,CAAjB;AACD,GAFD;;AAGA,MAAIC,QAAQ,GAAG,UAAUN,GAAV,EAAeO,MAAf,EAAuB;AACpC,WAAOR,UAAU,CAACC,GAAD,EAAMO,MAAN,EAAcP,GAAG,CAAC5J,MAAJ,GAAamK,MAAM,CAACnK,MAAlC,CAAjB;AACD,GAFD;;AAGA,MAAIoK,KAAK,GAAG,UAAU1F,CAAV,EAAa;AACvB,WAAO,UAAUrB,CAAV,EAAa;AAClB,aAAOA,CAAC,CAACmF,OAAF,CAAU9D,CAAV,EAAa,EAAb,CAAP;AACD,KAFD;AAGD,GAJD;;AAKA,MAAI2F,IAAI,GAAGD,KAAK,CAAC,YAAD,CAAhB;;AACA,MAAIE,UAAU,GAAG,UAAUjH,CAAV,EAAa;AAC5B,WAAOA,CAAC,CAACrD,MAAF,GAAW,CAAlB;AACD,GAFD;;AAIA,MAAIuK,kBAAkB,GAAG,qCAAzB;;AACA,MAAIC,aAAa,GAAG,UAAUC,MAAV,EAAkB;AACpC,WAAO,UAAUC,QAAV,EAAoB;AACzB,aAAOX,UAAU,CAACW,QAAD,EAAWD,MAAX,CAAjB;AACD,KAFD;AAGD,GAJD;;AAKA,MAAIpB,QAAQ,GAAG,CACb;AACE9K,IAAAA,IAAI,EAAE,MADR;AAEEoK,IAAAA,cAAc,EAAE,CAAC,gCAAD,CAFlB;AAGEQ,IAAAA,MAAM,EAAE,UAAUuB,QAAV,EAAoB;AAC1B,aAAOX,UAAU,CAACW,QAAD,EAAW,OAAX,CAAV,IAAiCX,UAAU,CAACW,QAAD,EAAW,QAAX,CAA3C,IAAmEX,UAAU,CAACW,QAAD,EAAW,QAAX,CAA7E,IAAqGX,UAAU,CAACW,QAAD,EAAW,aAAX,CAAtH;AACD;AALH,GADa,EAQb;AACEnM,IAAAA,IAAI,EAAE,QADR;AAEEoK,IAAAA,cAAc,EAAE,CACd,iCADc,EAEd4B,kBAFc,CAFlB;AAMEpB,IAAAA,MAAM,EAAE,UAAUuB,QAAV,EAAoB;AAC1B,aAAOX,UAAU,CAACW,QAAD,EAAW,QAAX,CAAV,IAAkC,CAACX,UAAU,CAACW,QAAD,EAAW,aAAX,CAApD;AACD;AARH,GARa,EAkBb;AACEnM,IAAAA,IAAI,EAAE,IADR;AAEEoK,IAAAA,cAAc,EAAE,CACd,gCADc,EAEd,4BAFc,CAFlB;AAMEQ,IAAAA,MAAM,EAAE,UAAUuB,QAAV,EAAoB;AAC1B,aAAOX,UAAU,CAACW,QAAD,EAAW,MAAX,CAAV,IAAgCX,UAAU,CAACW,QAAD,EAAW,SAAX,CAAjD;AACD;AARH,GAlBa,EA4Bb;AACEnM,IAAAA,IAAI,EAAE,OADR;AAEEoK,IAAAA,cAAc,EAAE,CACd4B,kBADc,EAEd,gCAFc,CAFlB;AAMEpB,IAAAA,MAAM,EAAEqB,aAAa,CAAC,OAAD;AANvB,GA5Ba,EAoCb;AACEjM,IAAAA,IAAI,EAAE,SADR;AAEEoK,IAAAA,cAAc,EAAE,CAAC,qCAAD,CAFlB;AAGEQ,IAAAA,MAAM,EAAEqB,aAAa,CAAC,SAAD;AAHvB,GApCa,EAyCb;AACEjM,IAAAA,IAAI,EAAE,QADR;AAEEoK,IAAAA,cAAc,EAAE,CACd4B,kBADc,EAEd,+BAFc,CAFlB;AAMEpB,IAAAA,MAAM,EAAE,UAAUuB,QAAV,EAAoB;AAC1B,aAAO,CAACX,UAAU,CAACW,QAAD,EAAW,QAAX,CAAV,IAAkCX,UAAU,CAACW,QAAD,EAAW,SAAX,CAA7C,KAAuEX,UAAU,CAACW,QAAD,EAAW,aAAX,CAAxF;AACD;AARH,GAzCa,CAAf;AAoDA,MAAIjB,IAAI,GAAG,CACT;AACElL,IAAAA,IAAI,EAAE,SADR;AAEE4K,IAAAA,MAAM,EAAEqB,aAAa,CAAC,KAAD,CAFvB;AAGE7B,IAAAA,cAAc,EAAE,CAAC,uCAAD;AAHlB,GADS,EAMT;AACEpK,IAAAA,IAAI,EAAE,KADR;AAEE4K,IAAAA,MAAM,EAAE,UAAUuB,QAAV,EAAoB;AAC1B,aAAOX,UAAU,CAACW,QAAD,EAAW,QAAX,CAAV,IAAkCX,UAAU,CAACW,QAAD,EAAW,MAAX,CAAnD;AACD,KAJH;AAKE/B,IAAAA,cAAc,EAAE,CACd,qCADc,EAEd,8BAFc,EAGd,qCAHc;AALlB,GANS,EAiBT;AACEpK,IAAAA,IAAI,EAAE,SADR;AAEE4K,IAAAA,MAAM,EAAEqB,aAAa,CAAC,SAAD,CAFvB;AAGE7B,IAAAA,cAAc,EAAE,CAAC,mCAAD;AAHlB,GAjBS,EAsBT;AACEpK,IAAAA,IAAI,EAAE,KADR;AAEE4K,IAAAA,MAAM,EAAEqB,aAAa,CAAC,UAAD,CAFvB;AAGE7B,IAAAA,cAAc,EAAE,CAAC,qCAAD;AAHlB,GAtBS,EA2BT;AACEpK,IAAAA,IAAI,EAAE,OADR;AAEE4K,IAAAA,MAAM,EAAEqB,aAAa,CAAC,OAAD,CAFvB;AAGE7B,IAAAA,cAAc,EAAE;AAHlB,GA3BS,EAgCT;AACEpK,IAAAA,IAAI,EAAE,SADR;AAEE4K,IAAAA,MAAM,EAAEqB,aAAa,CAAC,OAAD,CAFvB;AAGE7B,IAAAA,cAAc,EAAE;AAHlB,GAhCS,EAqCT;AACEpK,IAAAA,IAAI,EAAE,SADR;AAEE4K,IAAAA,MAAM,EAAEqB,aAAa,CAAC,SAAD,CAFvB;AAGE7B,IAAAA,cAAc,EAAE;AAHlB,GArCS,EA0CT;AACEpK,IAAAA,IAAI,EAAE,UADR;AAEE4K,IAAAA,MAAM,EAAEqB,aAAa,CAAC,MAAD,CAFvB;AAGE7B,IAAAA,cAAc,EAAE,CAAC,iCAAD;AAHlB,GA1CS,CAAX;AAgDA,MAAIgC,YAAY,GAAG;AACjBtB,IAAAA,QAAQ,EAAEhJ,QAAQ,CAACgJ,QAAD,CADD;AAEjBI,IAAAA,IAAI,EAAEpJ,QAAQ,CAACoJ,IAAD;AAFG,GAAnB;AAKA,MAAImB,IAAI,GAAG,MAAX;AACA,MAAIC,MAAM,GAAG,QAAb;AACA,MAAIC,EAAE,GAAG,IAAT;AACA,MAAIC,KAAK,GAAG,OAAZ;AACA,MAAIC,OAAO,GAAG,SAAd;AACA,MAAIC,MAAM,GAAG,QAAb;;AACA,MAAIC,SAAS,GAAG,YAAY;AAC1B,WAAOC,IAAI,CAAC;AACV5B,MAAAA,OAAO,EAAEnK,SADC;AAEVkK,MAAAA,OAAO,EAAEP,OAAO,CAACD,OAAR;AAFC,KAAD,CAAX;AAID,GALD;;AAMA,MAAIqC,IAAI,GAAG,UAAUC,IAAV,EAAgB;AACzB,QAAI7B,OAAO,GAAG6B,IAAI,CAAC7B,OAAnB;AACA,QAAID,OAAO,GAAG8B,IAAI,CAAC9B,OAAnB;;AACA,QAAI+B,SAAS,GAAG,UAAU9M,IAAV,EAAgB;AAC9B,aAAO,YAAY;AACjB,eAAOgL,OAAO,KAAKhL,IAAnB;AACD,OAFD;AAGD,KAJD;;AAKA,WAAO;AACLgL,MAAAA,OAAO,EAAEA,OADJ;AAELD,MAAAA,OAAO,EAAEA,OAFJ;AAGLgC,MAAAA,MAAM,EAAED,SAAS,CAACT,IAAD,CAHZ;AAILW,MAAAA,QAAQ,EAAEF,SAAS,CAACR,MAAD,CAJd;AAKLW,MAAAA,IAAI,EAAEH,SAAS,CAACP,EAAD,CALV;AAMLW,MAAAA,OAAO,EAAEJ,SAAS,CAACN,KAAD,CANb;AAOLW,MAAAA,SAAS,EAAEL,SAAS,CAACL,OAAD,CAPf;AAQLnD,MAAAA,QAAQ,EAAEwD,SAAS,CAACJ,MAAD;AARd,KAAP;AAUD,GAlBD;;AAmBA,MAAIU,OAAO,GAAG;AACZ7C,IAAAA,OAAO,EAAEoC,SADG;AAEZzC,IAAAA,EAAE,EAAE0C,IAFQ;AAGZP,IAAAA,IAAI,EAAEvK,QAAQ,CAACuK,IAAD,CAHF;AAIZC,IAAAA,MAAM,EAAExK,QAAQ,CAACwK,MAAD,CAJJ;AAKZC,IAAAA,EAAE,EAAEzK,QAAQ,CAACyK,EAAD,CALA;AAMZC,IAAAA,KAAK,EAAE1K,QAAQ,CAAC0K,KAAD,CANH;AAOZC,IAAAA,OAAO,EAAE3K,QAAQ,CAAC2K,OAAD,CAPL;AAQZC,IAAAA,MAAM,EAAE5K,QAAQ,CAAC4K,MAAD;AARJ,GAAd;AAWA,MAAIW,OAAO,GAAG,SAAd;AACA,MAAIC,GAAG,GAAG,KAAV;AACA,MAAIC,OAAO,GAAG,SAAd;AACA,MAAIC,KAAK,GAAG,OAAZ;AACA,MAAIC,GAAG,GAAG,KAAV;AACA,MAAIC,OAAO,GAAG,SAAd;AACA,MAAIC,OAAO,GAAG,SAAd;AACA,MAAIC,QAAQ,GAAG,UAAf;;AACA,MAAIC,SAAS,GAAG,YAAY;AAC1B,WAAOC,IAAI,CAAC;AACV9C,MAAAA,OAAO,EAAEnK,SADC;AAEVkK,MAAAA,OAAO,EAAEP,OAAO,CAACD,OAAR;AAFC,KAAD,CAAX;AAID,GALD;;AAMA,MAAIuD,IAAI,GAAG,UAAUjB,IAAV,EAAgB;AACzB,QAAI7B,OAAO,GAAG6B,IAAI,CAAC7B,OAAnB;AACA,QAAID,OAAO,GAAG8B,IAAI,CAAC9B,OAAnB;;AACA,QAAIgD,IAAI,GAAG,UAAU/N,IAAV,EAAgB;AACzB,aAAO,YAAY;AACjB,eAAOgL,OAAO,KAAKhL,IAAnB;AACD,OAFD;AAGD,KAJD;;AAKA,WAAO;AACLgL,MAAAA,OAAO,EAAEA,OADJ;AAELD,MAAAA,OAAO,EAAEA,OAFJ;AAGLiD,MAAAA,SAAS,EAAED,IAAI,CAACV,OAAD,CAHV;AAILxE,MAAAA,KAAK,EAAEkF,IAAI,CAACT,GAAD,CAJN;AAKLrE,MAAAA,SAAS,EAAE8E,IAAI,CAACR,OAAD,CALV;AAMLU,MAAAA,KAAK,EAAEF,IAAI,CAACN,GAAD,CANN;AAOLS,MAAAA,OAAO,EAAEH,IAAI,CAACP,KAAD,CAPR;AAQLW,MAAAA,SAAS,EAAEJ,IAAI,CAACL,OAAD,CARV;AASLU,MAAAA,SAAS,EAAEL,IAAI,CAACJ,OAAD,CATV;AAULU,MAAAA,UAAU,EAAEN,IAAI,CAACH,QAAD;AAVX,KAAP;AAYD,GApBD;;AAqBA,MAAIU,eAAe,GAAG;AACpB/D,IAAAA,OAAO,EAAEsD,SADW;AAEpB3D,IAAAA,EAAE,EAAE4D,IAFgB;AAGpBT,IAAAA,OAAO,EAAEvL,QAAQ,CAACuL,OAAD,CAHG;AAIpBC,IAAAA,GAAG,EAAExL,QAAQ,CAACwL,GAAD,CAJO;AAKpBC,IAAAA,OAAO,EAAEzL,QAAQ,CAACyL,OAAD,CALG;AAMpBC,IAAAA,KAAK,EAAE1L,QAAQ,CAAC0L,KAAD,CANK;AAOpBC,IAAAA,GAAG,EAAE3L,QAAQ,CAAC2L,GAAD,CAPO;AAQpBC,IAAAA,OAAO,EAAE5L,QAAQ,CAAC4L,OAAD,CARG;AASpBC,IAAAA,OAAO,EAAE7L,QAAQ,CAAC6L,OAAD,CATG;AAUpBC,IAAAA,QAAQ,EAAE9L,QAAQ,CAAC8L,QAAD;AAVE,GAAtB;;AAaA,MAAIW,QAAQ,GAAG,UAAU7F,SAAV,EAAqBC,UAArB,EAAiC;AAC9C,QAAImC,QAAQ,GAAGsB,YAAY,CAACtB,QAAb,EAAf;AACA,QAAII,IAAI,GAAGkB,YAAY,CAAClB,IAAb,EAAX;AACA,QAAIzC,OAAO,GAAG0C,QAAQ,CAACN,aAAT,CAAuBC,QAAvB,EAAiCpC,SAAjC,EAA4CpF,IAA5C,CAAiD8J,OAAO,CAAC7C,OAAzD,EAAkE6C,OAAO,CAAClD,EAA1E,CAAd;AACA,QAAI1B,EAAE,GAAG2C,QAAQ,CAACF,QAAT,CAAkBC,IAAlB,EAAwBxC,SAAxB,EAAmCpF,IAAnC,CAAwCgL,eAAe,CAAC/D,OAAxD,EAAiE+D,eAAe,CAACpE,EAAjF,CAAT;AACA,QAAIsE,UAAU,GAAGjG,UAAU,CAACC,EAAD,EAAKC,OAAL,EAAcC,SAAd,EAAyBC,UAAzB,CAA3B;AACA,WAAO;AACLF,MAAAA,OAAO,EAAEA,OADJ;AAELD,MAAAA,EAAE,EAAEA,EAFC;AAGLgG,MAAAA,UAAU,EAAEA;AAHP,KAAP;AAKD,GAXD;;AAYA,MAAIC,iBAAiB,GAAG;AAAEtE,IAAAA,MAAM,EAAEoE;AAAV,GAAxB;;AAEA,MAAI5F,UAAU,GAAG,UAAU+F,KAAV,EAAiB;AAChC,WAAOC,MAAM,CAACC,UAAP,CAAkBF,KAAlB,EAAyBG,OAAhC;AACD,GAFD;;AAGA,MAAIC,QAAQ,GAAGzG,MAAM,CAAC,YAAY;AAChC,WAAOoG,iBAAiB,CAACtE,MAAlB,CAAyB4E,SAAS,CAACrG,SAAnC,EAA8CC,UAA9C,CAAP;AACD,GAFoB,CAArB;;AAGA,MAAIqG,QAAQ,GAAG,YAAY;AACzB,WAAOF,QAAQ,EAAf;AACD,GAFD;;AAIA,MAAIG,uBAAuB,GAAG,UAAU1O,CAAV,EAAa0E,CAAb,EAAgBiK,KAAhB,EAAuB;AACnD,WAAO,CAAC3O,CAAC,CAAC0O,uBAAF,CAA0BhK,CAA1B,IAA+BiK,KAAhC,MAA2C,CAAlD;AACD,GAFD;;AAGA,MAAIC,2BAA2B,GAAG,UAAU5O,CAAV,EAAa0E,CAAb,EAAgB;AAChD,WAAOgK,uBAAuB,CAAC1O,CAAD,EAAI0E,CAAJ,EAAOmK,IAAI,CAACC,8BAAZ,CAA9B;AACD,GAFD;;AAIA,MAAIC,OAAO,GAAG,CAAd;AACA,MAAIC,QAAQ,GAAG,CAAf;AACA,MAAIC,iBAAiB,GAAG,EAAxB;AACA,MAAIC,OAAO,GAAG,CAAd;AACA,MAAIC,IAAI,GAAG,CAAX;;AAEA,MAAIC,QAAQ,GAAG,UAAUC,IAAV,EAAgBC,KAAhB,EAAuB;AACpC,QAAIC,GAAG,GAAGD,KAAK,IAAIE,QAAnB;AACA,QAAIC,GAAG,GAAGF,GAAG,CAACG,aAAJ,CAAkB,KAAlB,CAAV;AACAD,IAAAA,GAAG,CAACE,SAAJ,GAAgBN,IAAhB;;AACA,QAAI,CAACI,GAAG,CAACG,aAAJ,EAAD,IAAwBH,GAAG,CAACI,UAAJ,CAAe3O,MAAf,GAAwB,CAApD,EAAuD;AACrD4O,MAAAA,OAAO,CAACC,KAAR,CAAc,uCAAd,EAAuDV,IAAvD;AACA,YAAM,IAAIlN,KAAJ,CAAU,mCAAV,CAAN;AACD;;AACD,WAAO6N,OAAO,CAACP,GAAG,CAACI,UAAJ,CAAe,CAAf,CAAD,CAAd;AACD,GATD;;AAUA,MAAII,OAAO,GAAG,UAAUC,GAAV,EAAeZ,KAAf,EAAsB;AAClC,QAAIC,GAAG,GAAGD,KAAK,IAAIE,QAAnB;AACA,QAAIW,IAAI,GAAGZ,GAAG,CAACG,aAAJ,CAAkBQ,GAAlB,CAAX;AACA,WAAOF,OAAO,CAACG,IAAD,CAAd;AACD,GAJD;;AAKA,MAAIC,QAAQ,GAAG,UAAUC,IAAV,EAAgBf,KAAhB,EAAuB;AACpC,QAAIC,GAAG,GAAGD,KAAK,IAAIE,QAAnB;AACA,QAAIW,IAAI,GAAGZ,GAAG,CAACe,cAAJ,CAAmBD,IAAnB,CAAX;AACA,WAAOL,OAAO,CAACG,IAAD,CAAd;AACD,GAJD;;AAKA,MAAIH,OAAO,GAAG,UAAUG,IAAV,EAAgB;AAC5B,QAAIA,IAAI,KAAK,IAAT,IAAiBA,IAAI,KAAK7P,SAA9B,EAAyC;AACvC,YAAM,IAAI6B,KAAJ,CAAU,kCAAV,CAAN;AACD;;AACD,WAAO;AAAEoO,MAAAA,GAAG,EAAEJ;AAAP,KAAP;AACD,GALD;;AAMA,MAAIK,SAAS,GAAG,UAAUC,MAAV,EAAkBtR,CAAlB,EAAqBuR,CAArB,EAAwB;AACtC,WAAO9L,QAAQ,CAACD,IAAT,CAAc8L,MAAM,CAACF,GAAP,CAAWI,gBAAX,CAA4BxR,CAA5B,EAA+BuR,CAA/B,CAAd,EAAiDhN,GAAjD,CAAqDsM,OAArD,CAAP;AACD,GAFD;;AAGA,MAAIY,YAAY,GAAG;AACjBxB,IAAAA,QAAQ,EAAEA,QADO;AAEjBa,IAAAA,OAAO,EAAEA,OAFQ;AAGjBG,IAAAA,QAAQ,EAAEA,QAHO;AAIjBJ,IAAAA,OAAO,EAAEA,OAJQ;AAKjBQ,IAAAA,SAAS,EAAEA;AALM,GAAnB;;AAQA,MAAIvN,EAAE,GAAG,UAAU4N,OAAV,EAAmBC,QAAnB,EAA6B;AACpC,QAAIP,GAAG,GAAGM,OAAO,CAACN,GAAlB;;AACA,QAAIA,GAAG,CAACQ,QAAJ,KAAiB7B,OAArB,EAA8B;AAC5B,aAAO,KAAP;AACD,KAFD,MAEO;AACL,UAAI8B,IAAI,GAAGT,GAAX;;AACA,UAAIS,IAAI,CAAC1C,OAAL,KAAiBhO,SAArB,EAAgC;AAC9B,eAAO0Q,IAAI,CAAC1C,OAAL,CAAawC,QAAb,CAAP;AACD,OAFD,MAEO,IAAIE,IAAI,CAACC,iBAAL,KAA2B3Q,SAA/B,EAA0C;AAC/C,eAAO0Q,IAAI,CAACC,iBAAL,CAAuBH,QAAvB,CAAP;AACD,OAFM,MAEA,IAAIE,IAAI,CAACE,qBAAL,KAA+B5Q,SAAnC,EAA8C;AACnD,eAAO0Q,IAAI,CAACE,qBAAL,CAA2BJ,QAA3B,CAAP;AACD,OAFM,MAEA,IAAIE,IAAI,CAACG,kBAAL,KAA4B7Q,SAAhC,EAA2C;AAChD,eAAO0Q,IAAI,CAACG,kBAAL,CAAwBL,QAAxB,CAAP;AACD,OAFM,MAEA;AACL,cAAM,IAAI3O,KAAJ,CAAU,gCAAV,CAAN;AACD;AACF;AACF,GAlBD;;AAmBA,MAAIiP,cAAc,GAAG,UAAUb,GAAV,EAAe;AAClC,WAAOA,GAAG,CAACQ,QAAJ,KAAiB7B,OAAjB,IAA4BqB,GAAG,CAACQ,QAAJ,KAAiB/B,QAA7C,IAAyDuB,GAAG,CAACQ,QAAJ,KAAiB9B,iBAA1E,IAA+FsB,GAAG,CAACc,iBAAJ,KAA0B,CAAhI;AACD,GAFD;;AAGA,MAAIxP,GAAG,GAAG,UAAUiP,QAAV,EAAoBxB,KAApB,EAA2B;AACnC,QAAIgC,IAAI,GAAGhC,KAAK,KAAKhP,SAAV,GAAsBkP,QAAtB,GAAiCF,KAAK,CAACiB,GAAlD;AACA,WAAOa,cAAc,CAACE,IAAD,CAAd,GAAuB,EAAvB,GAA4B5N,GAAG,CAAC4N,IAAI,CAACC,gBAAL,CAAsBT,QAAtB,CAAD,EAAkCF,YAAY,CAACZ,OAA/C,CAAtC;AACD,GAHD;;AAIA,MAAIwB,GAAG,GAAG,UAAUV,QAAV,EAAoBxB,KAApB,EAA2B;AACnC,QAAIgC,IAAI,GAAGhC,KAAK,KAAKhP,SAAV,GAAsBkP,QAAtB,GAAiCF,KAAK,CAACiB,GAAlD;AACA,WAAOa,cAAc,CAACE,IAAD,CAAd,GAAuB1M,QAAQ,CAACtC,IAAT,EAAvB,GAAyCsC,QAAQ,CAACD,IAAT,CAAc2M,IAAI,CAACG,aAAL,CAAmBX,QAAnB,CAAd,EAA4CpN,GAA5C,CAAgDkN,YAAY,CAACZ,OAA7D,CAAhD;AACD,GAHD;;AAKA,MAAI0B,IAAI,GAAG,UAAUC,EAAV,EAAcC,EAAd,EAAkB;AAC3B,WAAOD,EAAE,CAACpB,GAAH,KAAWqB,EAAE,CAACrB,GAArB;AACD,GAFD;;AAGA,MAAIsB,eAAe,GAAG,UAAUF,EAAV,EAAcC,EAAd,EAAkB;AACtC,QAAIE,EAAE,GAAGH,EAAE,CAACpB,GAAZ;AACA,QAAIwB,EAAE,GAAGH,EAAE,CAACrB,GAAZ;AACA,WAAOuB,EAAE,KAAKC,EAAP,GAAY,KAAZ,GAAoBD,EAAE,CAACzM,QAAH,CAAY0M,EAAZ,CAA3B;AACD,GAJD;;AAKA,MAAIC,UAAU,GAAG,UAAUL,EAAV,EAAcC,EAAd,EAAkB;AACjC,WAAOhD,2BAA2B,CAAC+C,EAAE,CAACpB,GAAJ,EAASqB,EAAE,CAACrB,GAAZ,CAAlC;AACD,GAFD;;AAGA,MAAI0B,UAAU,GAAG,UAAUN,EAAV,EAAcC,EAAd,EAAkB;AACjC,WAAOnD,QAAQ,GAAGvG,OAAX,CAAmBwE,IAAnB,KAA4BsF,UAAU,CAACL,EAAD,EAAKC,EAAL,CAAtC,GAAiDC,eAAe,CAACF,EAAD,EAAKC,EAAL,CAAvE;AACD,GAFD;;AAGA,MAAIM,IAAI,GAAGjP,EAAX;AAEA,MAAIkP,IAAI,GAAG9K,MAAM,CAAC8K,IAAlB;AACA,MAAI3K,cAAc,GAAGH,MAAM,CAACG,cAA5B;;AACA,MAAI4K,MAAM,GAAG,UAAUC,GAAV,EAAerQ,CAAf,EAAkB;AAC7B,QAAIsQ,KAAK,GAAGH,IAAI,CAACE,GAAD,CAAhB;;AACA,SAAK,IAAI1K,CAAC,GAAG,CAAR,EAAWlC,GAAG,GAAG6M,KAAK,CAACpR,MAA5B,EAAoCyG,CAAC,GAAGlC,GAAxC,EAA6CkC,CAAC,EAA9C,EAAkD;AAChD,UAAInC,CAAC,GAAG8M,KAAK,CAAC3K,CAAD,CAAb;AACA,UAAIxI,CAAC,GAAGkT,GAAG,CAAC7M,CAAD,CAAX;AACAxD,MAAAA,CAAC,CAAC7C,CAAD,EAAIqG,CAAJ,CAAD;AACD;AACF,GAPD;;AAQA,MAAI+M,KAAK,GAAG,UAAUF,GAAV,EAAerQ,CAAf,EAAkB;AAC5B,WAAOwQ,QAAQ,CAACH,GAAD,EAAM,UAAUlT,CAAV,EAAaqG,CAAb,EAAgB;AACnC,aAAO;AACLmC,QAAAA,CAAC,EAAEnC,CADE;AAELhB,QAAAA,CAAC,EAAExC,CAAC,CAAC7C,CAAD,EAAIqG,CAAJ;AAFC,OAAP;AAID,KALc,CAAf;AAMD,GAPD;;AAQA,MAAIgN,QAAQ,GAAG,UAAUH,GAAV,EAAerQ,CAAf,EAAkB;AAC/B,QAAI4D,CAAC,GAAG,EAAR;AACAwM,IAAAA,MAAM,CAACC,GAAD,EAAM,UAAUlT,CAAV,EAAaqG,CAAb,EAAgB;AAC1B,UAAIiN,KAAK,GAAGzQ,CAAC,CAAC7C,CAAD,EAAIqG,CAAJ,CAAb;AACAI,MAAAA,CAAC,CAAC6M,KAAK,CAAC9K,CAAP,CAAD,GAAa8K,KAAK,CAACjO,CAAnB;AACD,KAHK,CAAN;AAIA,WAAOoB,CAAP;AACD,GAPD;;AAQA,MAAI8M,MAAM,GAAG,UAAU9M,CAAV,EAAa;AACxB,WAAO,UAAUzG,CAAV,EAAaqG,CAAb,EAAgB;AACrBI,MAAAA,CAAC,CAACJ,CAAD,CAAD,GAAOrG,CAAP;AACD,KAFD;AAGD,GAJD;;AAKA,MAAIwT,cAAc,GAAG,UAAUN,GAAV,EAAe9M,IAAf,EAAqBqN,MAArB,EAA6BC,OAA7B,EAAsC;AACzD,QAAIjN,CAAC,GAAG,EAAR;AACAwM,IAAAA,MAAM,CAACC,GAAD,EAAM,UAAUlT,CAAV,EAAaqG,CAAb,EAAgB;AAC1B,OAACD,IAAI,CAACpG,CAAD,EAAIqG,CAAJ,CAAJ,GAAaoN,MAAb,GAAsBC,OAAvB,EAAgC1T,CAAhC,EAAmCqG,CAAnC;AACD,KAFK,CAAN;AAGA,WAAOI,CAAP;AACD,GAND;;AAOA,MAAIkN,QAAQ,GAAG,UAAUT,GAAV,EAAe9M,IAAf,EAAqB;AAClC,QAAInG,CAAC,GAAG,EAAR;AACAuT,IAAAA,cAAc,CAACN,GAAD,EAAM9M,IAAN,EAAYmN,MAAM,CAACtT,CAAD,CAAlB,EAAuBuB,IAAvB,CAAd;AACA,WAAOvB,CAAP;AACD,GAJD;;AAKA,MAAI2T,UAAU,GAAG,UAAUV,GAAV,EAAerQ,CAAf,EAAkB;AACjC,QAAI4D,CAAC,GAAG,EAAR;AACAwM,IAAAA,MAAM,CAACC,GAAD,EAAM,UAAUxS,KAAV,EAAiBJ,IAAjB,EAAuB;AACjCmG,MAAAA,CAAC,CAACV,IAAF,CAAOlD,CAAC,CAACnC,KAAD,EAAQJ,IAAR,CAAR;AACD,KAFK,CAAN;AAGA,WAAOmG,CAAP;AACD,GAND;;AAOA,MAAIoN,MAAM,GAAG,UAAUX,GAAV,EAAe;AAC1B,WAAOU,UAAU,CAACV,GAAD,EAAM,UAAU7N,CAAV,EAAa;AAClC,aAAOA,CAAP;AACD,KAFgB,CAAjB;AAGD,GAJD;;AAKA,MAAIyO,IAAI,GAAG,UAAUZ,GAAV,EAAe;AACxB,WAAOF,IAAI,CAACE,GAAD,CAAJ,CAAUnR,MAAjB;AACD,GAFD;;AAGA,MAAIgS,KAAK,GAAG,UAAUb,GAAV,EAAec,GAAf,EAAoB;AAC9B,WAAOC,GAAG,CAACf,GAAD,EAAMc,GAAN,CAAH,GAAgBvO,QAAQ,CAACD,IAAT,CAAc0N,GAAG,CAACc,GAAD,CAAjB,CAAhB,GAA0CvO,QAAQ,CAACtC,IAAT,EAAjD;AACD,GAFD;;AAGA,MAAI8Q,GAAG,GAAG,UAAUf,GAAV,EAAec,GAAf,EAAoB;AAC5B,WAAO3L,cAAc,CAAC9E,IAAf,CAAoB2P,GAApB,EAAyBc,GAAzB,CAAP;AACD,GAFD;;AAGA,MAAIE,iBAAiB,GAAG,UAAUhB,GAAV,EAAec,GAAf,EAAoB;AAC1C,WAAOC,GAAG,CAACf,GAAD,EAAMc,GAAN,CAAH,IAAiBd,GAAG,CAACc,GAAD,CAAH,KAAa7S,SAA9B,IAA2C+R,GAAG,CAACc,GAAD,CAAH,KAAa,IAA/D;AACD,GAFD;;AAGA,MAAIG,OAAO,GAAG,UAAU1N,CAAV,EAAa;AACzB,SAAK,IAAIzG,CAAT,IAAcyG,CAAd,EAAiB;AACf,UAAI4B,cAAc,CAAC9E,IAAf,CAAoBkD,CAApB,EAAuBzG,CAAvB,CAAJ,EAA+B;AAC7B,eAAO,KAAP;AACD;AACF;;AACD,WAAO,IAAP;AACD,GAPD;;AASA,MAAIoU,gBAAgB,GAAG,CACrB,OADqB,EAErB,OAFqB,EAGrB,OAHqB,EAIrB,UAJqB,CAAvB;;AAMA,MAAIC,cAAc,GAAG,UAAUC,UAAV,EAAsB;AACzC,WAAOpO,QAAQ,CAACkO,gBAAD,EAAmBE,UAAnB,CAAf;AACD,GAFD;;AAGA,MAAIC,IAAI,GAAG,UAAUC,IAAV,EAAgBC,OAAhB,EAAyB;AAClC,WAAO;AACLD,MAAAA,IAAI,EAAEA,IADD;AAELC,MAAAA,OAAO,EAAEA;AAFJ,KAAP;AAID,GALD;;AAMA,MAAIC,OAAO,GAAG,UAAUC,GAAV,EAAeC,MAAf,EAAuB;AACnC,WAAO;AACLD,MAAAA,GAAG,EAAEA,GADA;AAELC,MAAAA,MAAM,EAAEA;AAFH,KAAP;AAID,GALD;;AAMA,MAAIC,MAAM,GAAG,UAAUnD,OAAV,EAAmBoD,OAAnB,EAA4BC,OAA5B,EAAqC;AAChD,WAAO;AACLrD,MAAAA,OAAO,EAAEA,OADJ;AAELoD,MAAAA,OAAO,EAAEA,OAFJ;AAGLC,MAAAA,OAAO,EAAEA;AAHJ,KAAP;AAKD,GAND;;AAOA,MAAIC,SAAS,GAAG,UAAUtD,OAAV,EAAmBoD,OAAnB,EAA4BC,OAA5B,EAAqCE,KAArC,EAA4C;AAC1D,WAAO;AACLvD,MAAAA,OAAO,EAAEA,OADJ;AAELoD,MAAAA,OAAO,EAAEA,OAFJ;AAGLC,MAAAA,OAAO,EAAEA,OAHJ;AAILE,MAAAA,KAAK,EAAEA;AAJF,KAAP;AAMD,GAPD;;AAQA,MAAIC,QAAQ,GAAG,UAAUxD,OAAV,EAAmBoD,OAAnB,EAA4BC,OAA5B,EAAqCJ,GAArC,EAA0CC,MAA1C,EAAkDO,QAAlD,EAA4D;AACzE,WAAO;AACLzD,MAAAA,OAAO,EAAEA,OADJ;AAELoD,MAAAA,OAAO,EAAEA,OAFJ;AAGLC,MAAAA,OAAO,EAAEA,OAHJ;AAILJ,MAAAA,GAAG,EAAEA,GAJA;AAKLC,MAAAA,MAAM,EAAEA,MALH;AAMLO,MAAAA,QAAQ,EAAEA;AANL,KAAP;AAQD,GATD;;AAUA,MAAIC,OAAO,GAAG,UAAU1D,OAAV,EAAmB2D,KAAnB,EAA0BC,OAA1B,EAAmC;AAC/C,WAAO;AACL5D,MAAAA,OAAO,EAAEA,OADJ;AAEL2D,MAAAA,KAAK,EAAEA,KAFF;AAGLC,MAAAA,OAAO,EAAEA;AAHJ,KAAP;AAKD,GAND;;AAOA,MAAIC,UAAU,GAAG,UAAU7D,OAAV,EAAmBuD,KAAnB,EAA0BE,QAA1B,EAAoC;AACnD,WAAO;AACLzD,MAAAA,OAAO,EAAEA,OADJ;AAELuD,MAAAA,KAAK,EAAEA,KAFF;AAGLE,MAAAA,QAAQ,EAAEA;AAHL,KAAP;AAKD,GAND;;AAOA,MAAIK,UAAU,GAAG,UAAU9D,OAAV,EAAmB2D,KAAnB,EAA0BC,OAA1B,EAAmCL,KAAnC,EAA0C;AACzD,WAAO;AACLvD,MAAAA,OAAO,EAAEA,OADJ;AAEL2D,MAAAA,KAAK,EAAEA,KAFF;AAGLC,MAAAA,OAAO,EAAEA,OAHJ;AAILL,MAAAA,KAAK,EAAEA;AAJF,KAAP;AAMD,GAPD;;AAQA,MAAIQ,QAAQ,GAAG,UAAUJ,KAAV,EAAiBC,OAAjB,EAA0B;AACvC,WAAO;AACLD,MAAAA,KAAK,EAAEA,KADF;AAELC,MAAAA,OAAO,EAAEA;AAFJ,KAAP;AAID,GALD;;AAMA,MAAII,UAAU,GAAG,UAAUC,OAAV,EAAmBL,OAAnB,EAA4B;AAC3C,WAAO;AACLK,MAAAA,OAAO,EAAEA,OADJ;AAELL,MAAAA,OAAO,EAAEA;AAFJ,KAAP;AAID,GALD;;AAMA,MAAIM,MAAM,GAAG,UAAUC,QAAV,EAAoBC,QAApB,EAA8BC,SAA9B,EAAyCC,SAAzC,EAAoD;AAC/D,WAAO;AACLH,MAAAA,QAAQ,EAAEA,QADL;AAELC,MAAAA,QAAQ,EAAEA,QAFL;AAGLC,MAAAA,SAAS,EAAEA,SAHN;AAILC,MAAAA,SAAS,EAAEA;AAJN,KAAP;AAMD,GAPD;;AAQA,MAAIC,SAAS,GAAG,UAAUvE,OAAV,EAAmBqD,OAAnB,EAA4BH,MAA5B,EAAoC;AAClD,WAAO;AACLlD,MAAAA,OAAO,EAAEA,OADJ;AAELqD,MAAAA,OAAO,EAAEA,OAFJ;AAGLH,MAAAA,MAAM,EAAEA;AAHH,KAAP;AAKD,GAND;;AAQA,MAAIsB,MAAM,GAAG,OAAOjH,MAAP,KAAkB,WAAlB,GAAgCA,MAAhC,GAAyCkH,QAAQ,CAAC,cAAD,CAAR,EAAtD;;AAEA,MAAI7V,IAAI,GAAG,UAAUoR,OAAV,EAAmB;AAC5B,QAAIjL,CAAC,GAAGiL,OAAO,CAACN,GAAR,CAAYgF,QAApB;AACA,WAAO3P,CAAC,CAACmE,WAAF,EAAP;AACD,GAHD;;AAIA,MAAInK,IAAI,GAAG,UAAUiR,OAAV,EAAmB;AAC5B,WAAOA,OAAO,CAACN,GAAR,CAAYQ,QAAnB;AACD,GAFD;;AAGA,MAAIyE,QAAQ,GAAG,UAAUpW,CAAV,EAAa;AAC1B,WAAO,UAAUyR,OAAV,EAAmB;AACxB,aAAOjR,IAAI,CAACiR,OAAD,CAAJ,KAAkBzR,CAAzB;AACD,KAFD;AAGD,GAJD;;AAKA,MAAIqW,SAAS,GAAG,UAAU5E,OAAV,EAAmB;AACjC,WAAOjR,IAAI,CAACiR,OAAD,CAAJ,KAAkB9B,OAAlB,IAA6BtP,IAAI,CAACoR,OAAD,CAAJ,KAAkB,UAAtD;AACD,GAFD;;AAGA,MAAI6E,SAAS,GAAGF,QAAQ,CAACtG,OAAD,CAAxB;AACA,MAAIyG,MAAM,GAAGH,QAAQ,CAACrG,IAAD,CAArB;AACA,MAAIyG,UAAU,GAAGJ,QAAQ,CAACxG,QAAD,CAAzB;AACA,MAAI6G,kBAAkB,GAAGL,QAAQ,CAACvG,iBAAD,CAAjC;;AACA,MAAI6G,KAAK,GAAG,UAAU5F,GAAV,EAAe;AACzB,WAAO,UAAU6F,CAAV,EAAa;AAClB,aAAOL,SAAS,CAACK,CAAD,CAAT,IAAgBtW,IAAI,CAACsW,CAAD,CAAJ,KAAY7F,GAAnC;AACD,KAFD;AAGD,GAJD;;AAMA,MAAI8F,KAAK,GAAG,UAAUnF,OAAV,EAAmB;AAC7B,WAAOD,YAAY,CAACZ,OAAb,CAAqBa,OAAO,CAACN,GAAR,CAAY0F,aAAjC,CAAP;AACD,GAFD;;AAGA,MAAIC,eAAe,GAAG,UAAUC,GAAV,EAAe;AACnC,WAAOP,UAAU,CAACO,GAAD,CAAV,GAAkBA,GAAlB,GAAwBH,KAAK,CAACG,GAAD,CAApC;AACD,GAFD;;AAGA,MAAIC,WAAW,GAAG,UAAUvF,OAAV,EAAmB;AACnC,WAAOD,YAAY,CAACZ,OAAb,CAAqBkG,eAAe,CAACrF,OAAD,CAAf,CAAyBN,GAAzB,CAA6B6F,WAAlD,CAAP;AACD,GAFD;;AAGA,MAAIC,MAAM,GAAG,UAAUxF,OAAV,EAAmB;AAC9B,WAAOjM,QAAQ,CAACD,IAAT,CAAckM,OAAO,CAACN,GAAR,CAAY+F,UAA1B,EAAsC5S,GAAtC,CAA0CkN,YAAY,CAACZ,OAAvD,CAAP;AACD,GAFD;;AAGA,MAAIuG,OAAO,GAAG,UAAU1F,OAAV,EAAmB2F,MAAnB,EAA2B;AACvC,QAAIC,IAAI,GAAGhW,UAAU,CAAC+V,MAAD,CAAV,GAAqBA,MAArB,GAA8BpU,KAAzC;AACA,QAAImO,GAAG,GAAGM,OAAO,CAACN,GAAlB;AACA,QAAImG,GAAG,GAAG,EAAV;;AACA,WAAOnG,GAAG,CAAC+F,UAAJ,KAAmB,IAAnB,IAA2B/F,GAAG,CAAC+F,UAAJ,KAAmBhW,SAArD,EAAgE;AAC9D,UAAIqW,SAAS,GAAGpG,GAAG,CAAC+F,UAApB;AACA,UAAI/O,CAAC,GAAGqJ,YAAY,CAACZ,OAAb,CAAqB2G,SAArB,CAAR;AACAD,MAAAA,GAAG,CAACxR,IAAJ,CAASqC,CAAT;;AACA,UAAIkP,IAAI,CAAClP,CAAD,CAAJ,KAAY,IAAhB,EAAsB;AACpB;AACD,OAFD,MAEO;AACLgJ,QAAAA,GAAG,GAAGoG,SAAN;AACD;AACF;;AACD,WAAOD,GAAP;AACD,GAfD;;AAgBA,MAAIE,YAAY,GAAG,UAAU/F,OAAV,EAAmB;AACpC,WAAOjM,QAAQ,CAACD,IAAT,CAAckM,OAAO,CAACN,GAAR,CAAYqG,YAA1B,EAAwClT,GAAxC,CAA4CkN,YAAY,CAACZ,OAAzD,CAAP;AACD,GAFD;;AAGA,MAAI6G,WAAW,GAAG,UAAUhG,OAAV,EAAmB;AACnC,WAAOjM,QAAQ,CAACD,IAAT,CAAckM,OAAO,CAACN,GAAR,CAAYuG,eAA1B,EAA2CpT,GAA3C,CAA+CkN,YAAY,CAACZ,OAA5D,CAAP;AACD,GAFD;;AAGA,MAAI+G,WAAW,GAAG,UAAUlG,OAAV,EAAmB;AACnC,WAAOjM,QAAQ,CAACD,IAAT,CAAckM,OAAO,CAACN,GAAR,CAAYwG,WAA1B,EAAuCrT,GAAvC,CAA2CkN,YAAY,CAACZ,OAAxD,CAAP;AACD,GAFD;;AAGA,MAAIgH,QAAQ,GAAG,UAAUnG,OAAV,EAAmB;AAChC,WAAOnN,GAAG,CAACmN,OAAO,CAACN,GAAR,CAAYV,UAAb,EAAyBe,YAAY,CAACZ,OAAtC,CAAV;AACD,GAFD;;AAGA,MAAIiH,KAAK,GAAG,UAAUpG,OAAV,EAAmBqG,KAAnB,EAA0B;AACpC,QAAIC,EAAE,GAAGtG,OAAO,CAACN,GAAR,CAAYV,UAArB;AACA,WAAOjL,QAAQ,CAACD,IAAT,CAAcwS,EAAE,CAACD,KAAD,CAAhB,EAAyBxT,GAAzB,CAA6BkN,YAAY,CAACZ,OAA1C,CAAP;AACD,GAHD;;AAIA,MAAIoH,UAAU,GAAG,UAAUvG,OAAV,EAAmB;AAClC,WAAOoG,KAAK,CAACpG,OAAD,EAAU,CAAV,CAAZ;AACD,GAFD;;AAIA,MAAIwG,YAAY,GAAG,UAAUlB,GAAV,EAAe;AAChC,WAAON,kBAAkB,CAACM,GAAD,CAAlB,IAA2B3V,aAAa,CAAC2V,GAAG,CAAC5F,GAAJ,CAAQ+G,IAAT,CAA/C;AACD,GAFD;;AAGA,MAAIC,SAAS,GAAG9W,UAAU,CAAC+W,OAAO,CAAClY,SAAR,CAAkBmY,YAAnB,CAAV,IAA8ChX,UAAU,CAACoO,IAAI,CAACvP,SAAL,CAAeoY,WAAhB,CAAxE;AACA,MAAIC,WAAW,GAAGpW,QAAQ,CAACgW,SAAD,CAA1B;AACA,MAAIG,WAAW,GAAGH,SAAS,GAAG,UAAUxB,CAAV,EAAa;AACzC,WAAOnF,YAAY,CAACZ,OAAb,CAAqB+F,CAAC,CAACxF,GAAF,CAAMmH,WAAN,EAArB,CAAP;AACD,GAF0B,GAEvBxB,eAFJ;;AAGA,MAAI0B,aAAa,GAAG,UAAU7B,CAAV,EAAa;AAC/B,QAAInQ,CAAC,GAAG8R,WAAW,CAAC3B,CAAD,CAAnB;AACA,WAAOsB,YAAY,CAACzR,CAAD,CAAZ,GAAkBhB,QAAQ,CAACR,IAAT,CAAcwB,CAAd,CAAlB,GAAqChB,QAAQ,CAACtC,IAAT,EAA5C;AACD,GAHD;;AAIA,MAAIuV,aAAa,GAAG,UAAU9B,CAAV,EAAa;AAC/B,WAAOnF,YAAY,CAACZ,OAAb,CAAqB+F,CAAC,CAACxF,GAAF,CAAM+G,IAA3B,CAAP;AACD,GAFD;;AAGA,MAAIQ,sBAAsB,GAAG,UAAUC,KAAV,EAAiB;AAC5C,QAAIJ,WAAW,MAAMnX,aAAa,CAACuX,KAAK,CAACpM,MAAP,CAAlC,EAAkD;AAChD,UAAIqM,EAAE,GAAGpH,YAAY,CAACZ,OAAb,CAAqB+H,KAAK,CAACpM,MAA3B,CAAT;;AACA,UAAI+J,SAAS,CAACsC,EAAD,CAAT,IAAiBC,gBAAgB,CAACD,EAAD,CAArC,EAA2C;AACzC,YAAID,KAAK,CAACG,QAAN,IAAkBH,KAAK,CAACI,YAA5B,EAA0C;AACxC,cAAIA,YAAY,GAAGJ,KAAK,CAACI,YAAN,EAAnB;;AACA,cAAIA,YAAJ,EAAkB;AAChB,mBAAOlR,IAAI,CAACkR,YAAD,CAAX;AACD;AACF;AACF;AACF;;AACD,WAAOvT,QAAQ,CAACD,IAAT,CAAcoT,KAAK,CAACpM,MAApB,CAAP;AACD,GAbD;;AAcA,MAAIsM,gBAAgB,GAAG,UAAUpH,OAAV,EAAmB;AACxC,WAAOrQ,aAAa,CAACqQ,OAAO,CAACN,GAAR,CAAY6H,UAAb,CAApB;AACD,GAFD;;AAIA,MAAIC,MAAM,GAAG,UAAUxH,OAAV,EAAmB;AAC9B,QAAIN,GAAG,GAAGoF,MAAM,CAAC9E,OAAD,CAAN,GAAkBA,OAAO,CAACN,GAAR,CAAY+F,UAA9B,GAA2CzF,OAAO,CAACN,GAA7D;;AACA,QAAIA,GAAG,KAAKjQ,SAAR,IAAqBiQ,GAAG,KAAK,IAA7B,IAAqCA,GAAG,CAAC0F,aAAJ,KAAsB,IAA/D,EAAqE;AACnE,aAAO,KAAP;AACD;;AACD,QAAI1G,GAAG,GAAGgB,GAAG,CAAC0F,aAAd;AACA,WAAO2B,aAAa,CAAChH,YAAY,CAACZ,OAAb,CAAqBO,GAArB,CAAD,CAAb,CAAyCxN,IAAzC,CAA8C,YAAY;AAC/D,aAAOwM,GAAG,CAAC+I,IAAJ,CAASjT,QAAT,CAAkBkL,GAAlB,CAAP;AACD,KAFM,EAEJnP,QAAQ,CAACiX,MAAD,EAASR,aAAT,CAFJ,CAAP;AAGD,GATD;;AAUA,MAAIS,IAAI,GAAG,YAAY;AACrB,WAAOC,OAAO,CAAC3H,YAAY,CAACZ,OAAb,CAAqBR,QAArB,CAAD,CAAd;AACD,GAFD;;AAGA,MAAI+I,OAAO,GAAG,UAAUhJ,GAAV,EAAe;AAC3B,QAAI7K,CAAC,GAAG6K,GAAG,CAACgB,GAAJ,CAAQ+H,IAAhB;;AACA,QAAI5T,CAAC,KAAK,IAAN,IAAcA,CAAC,KAAKpE,SAAxB,EAAmC;AACjC,YAAM,IAAI6B,KAAJ,CAAU,2BAAV,CAAN;AACD;;AACD,WAAOyO,YAAY,CAACZ,OAAb,CAAqBtL,CAArB,CAAP;AACD,GAND;;AAQA,MAAI8T,SAAS,GAAG,UAAUlJ,KAAV,EAAiBmJ,SAAjB,EAA4BjC,MAA5B,EAAoC;AAClD,WAAOzS,MAAM,CAACwS,OAAO,CAACjH,KAAD,EAAQkH,MAAR,CAAR,EAAyBiC,SAAzB,CAAb;AACD,GAFD;;AAGA,MAAIC,UAAU,GAAG,UAAUpJ,KAAV,EAAiBmJ,SAAjB,EAA4B;AAC3C,WAAO1U,MAAM,CAACiT,QAAQ,CAAC1H,KAAD,CAAT,EAAkBmJ,SAAlB,CAAb;AACD,GAFD;;AAGA,MAAIE,WAAW,GAAG,UAAUrJ,KAAV,EAAiBmJ,SAAjB,EAA4B;AAC5C,QAAIG,MAAM,GAAG,EAAb;AACAjV,IAAAA,IAAI,CAACqT,QAAQ,CAAC1H,KAAD,CAAT,EAAkB,UAAUnQ,CAAV,EAAa;AACjC,UAAIsZ,SAAS,CAACtZ,CAAD,CAAb,EAAkB;AAChByZ,QAAAA,MAAM,GAAGA,MAAM,CAAC9W,MAAP,CAAc,CAAC3C,CAAD,CAAd,CAAT;AACD;;AACDyZ,MAAAA,MAAM,GAAGA,MAAM,CAAC9W,MAAP,CAAc6W,WAAW,CAACxZ,CAAD,EAAIsZ,SAAJ,CAAzB,CAAT;AACD,KALG,CAAJ;AAMA,WAAOG,MAAP;AACD,GATD;;AAWA,MAAIC,WAAW,GAAG,UAAUvJ,KAAV,EAAiBwB,QAAjB,EAA2B0F,MAA3B,EAAmC;AACnD,WAAOgC,SAAS,CAAClJ,KAAD,EAAQ,UAAUyG,CAAV,EAAa;AACnC,aAAO9S,EAAE,CAAC8S,CAAD,EAAIjF,QAAJ,CAAT;AACD,KAFe,EAEb0F,MAFa,CAAhB;AAGD,GAJD;;AAKA,MAAIsC,UAAU,GAAG,UAAUxJ,KAAV,EAAiBwB,QAAjB,EAA2B;AAC1C,WAAO4H,UAAU,CAACpJ,KAAD,EAAQ,UAAUyG,CAAV,EAAa;AACpC,aAAO9S,EAAE,CAAC8S,CAAD,EAAIjF,QAAJ,CAAT;AACD,KAFgB,CAAjB;AAGD,GAJD;;AAKA,MAAIiI,aAAa,GAAG,UAAUzJ,KAAV,EAAiBwB,QAAjB,EAA2B;AAC7C,WAAOjP,GAAG,CAACiP,QAAD,EAAWxB,KAAX,CAAV;AACD,GAFD;;AAIA,WAAS0J,iBAAT,CAA4B/V,EAA5B,EAAgCgW,QAAhC,EAA0C3J,KAA1C,EAAiDtP,CAAjD,EAAoDwW,MAApD,EAA4D;AAC1D,QAAIvT,EAAE,CAACqM,KAAD,EAAQtP,CAAR,CAAN,EAAkB;AAChB,aAAO4E,QAAQ,CAACR,IAAT,CAAckL,KAAd,CAAP;AACD,KAFD,MAEO,IAAI7O,UAAU,CAAC+V,MAAD,CAAV,IAAsBA,MAAM,CAAClH,KAAD,CAAhC,EAAyC;AAC9C,aAAO1K,QAAQ,CAACtC,IAAT,EAAP;AACD,KAFM,MAEA;AACL,aAAO2W,QAAQ,CAAC3J,KAAD,EAAQtP,CAAR,EAAWwW,MAAX,CAAf;AACD;AACF;;AAED,MAAIyC,QAAQ,GAAG,UAAU3J,KAAV,EAAiBmJ,SAAjB,EAA4BjC,MAA5B,EAAoC;AACjD,QAAI3F,OAAO,GAAGvB,KAAK,CAACiB,GAApB;AACA,QAAIkG,IAAI,GAAGhW,UAAU,CAAC+V,MAAD,CAAV,GAAqBA,MAArB,GAA8BpU,KAAzC;;AACA,WAAOyO,OAAO,CAACyF,UAAf,EAA2B;AACzBzF,MAAAA,OAAO,GAAGA,OAAO,CAACyF,UAAlB;AACA,UAAI0B,EAAE,GAAGpH,YAAY,CAACZ,OAAb,CAAqBa,OAArB,CAAT;;AACA,UAAI4H,SAAS,CAACT,EAAD,CAAb,EAAmB;AACjB,eAAOpT,QAAQ,CAACR,IAAT,CAAc4T,EAAd,CAAP;AACD,OAFD,MAEO,IAAIvB,IAAI,CAACuB,EAAD,CAAR,EAAc;AACnB;AACD;AACF;;AACD,WAAOpT,QAAQ,CAACtC,IAAT,EAAP;AACD,GAbD;;AAcA,MAAI4W,OAAO,GAAG,UAAU5J,KAAV,EAAiBmJ,SAAjB,EAA4BjC,MAA5B,EAAoC;AAChD,QAAIvT,EAAE,GAAG,UAAUsB,CAAV,EAAagE,IAAb,EAAmB;AAC1B,aAAOA,IAAI,CAAChE,CAAD,CAAX;AACD,KAFD;;AAGA,WAAOyU,iBAAiB,CAAC/V,EAAD,EAAKgW,QAAL,EAAe3J,KAAf,EAAsBmJ,SAAtB,EAAiCjC,MAAjC,CAAxB;AACD,GALD;;AAMA,MAAI2C,OAAO,GAAG,UAAU7J,KAAV,EAAiBmJ,SAAjB,EAA4B;AACxC,QAAIlT,IAAI,GAAG,UAAU4K,IAAV,EAAgB;AACzB,aAAOsI,SAAS,CAAC7H,YAAY,CAACZ,OAAb,CAAqBG,IAArB,CAAD,CAAhB;AACD,KAFD;;AAGA,QAAIyI,MAAM,GAAGrS,IAAI,CAAC+I,KAAK,CAACiB,GAAN,CAAUV,UAAX,EAAuBtK,IAAvB,CAAjB;AACA,WAAOqT,MAAM,CAAClV,GAAP,CAAWkN,YAAY,CAACZ,OAAxB,CAAP;AACD,GAND;;AAOA,MAAIoJ,UAAU,GAAG,UAAU9J,KAAV,EAAiBmJ,SAAjB,EAA4B;AAC3C,QAAIY,OAAO,GAAG,UAAUlJ,IAAV,EAAgB;AAC5B,WAAK,IAAI3K,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2K,IAAI,CAACN,UAAL,CAAgB3O,MAApC,EAA4CsE,CAAC,EAA7C,EAAiD;AAC/C,YAAI8T,OAAO,GAAG1I,YAAY,CAACZ,OAAb,CAAqBG,IAAI,CAACN,UAAL,CAAgBrK,CAAhB,CAArB,CAAd;;AACA,YAAIiT,SAAS,CAACa,OAAD,CAAb,EAAwB;AACtB,iBAAO1U,QAAQ,CAACR,IAAT,CAAckV,OAAd,CAAP;AACD;;AACD,YAAIC,GAAG,GAAGF,OAAO,CAAClJ,IAAI,CAACN,UAAL,CAAgBrK,CAAhB,CAAD,CAAjB;;AACA,YAAI+T,GAAG,CAACrW,MAAJ,EAAJ,EAAkB;AAChB,iBAAOqW,GAAP;AACD;AACF;;AACD,aAAO3U,QAAQ,CAACtC,IAAT,EAAP;AACD,KAZD;;AAaA,WAAO+W,OAAO,CAAC/J,KAAK,CAACiB,GAAP,CAAd;AACD,GAfD;;AAiBA,MAAIiJ,UAAU,GAAG,UAAUlK,KAAV,EAAiBwB,QAAjB,EAA2B0F,MAA3B,EAAmC;AAClD,WAAOyC,QAAQ,CAAC3J,KAAD,EAAQ,UAAUyG,CAAV,EAAa;AAClC,aAAO9S,EAAE,CAAC8S,CAAD,EAAIjF,QAAJ,CAAT;AACD,KAFc,EAEZ0F,MAFY,CAAf;AAGD,GAJD;;AAKA,MAAIiD,OAAO,GAAG,UAAUnK,KAAV,EAAiBwB,QAAjB,EAA2B;AACvC,WAAOqI,OAAO,CAAC7J,KAAD,EAAQ,UAAUyG,CAAV,EAAa;AACjC,aAAO9S,EAAE,CAAC8S,CAAD,EAAIjF,QAAJ,CAAT;AACD,KAFa,CAAd;AAGD,GAJD;;AAKA,MAAI4I,YAAY,GAAG,UAAUpK,KAAV,EAAiBwB,QAAjB,EAA2B;AAC5C,WAAOU,GAAG,CAACV,QAAD,EAAWxB,KAAX,CAAV;AACD,GAFD;;AAGA,MAAIqK,SAAS,GAAG,UAAUrK,KAAV,EAAiBwB,QAAjB,EAA2B0F,MAA3B,EAAmC;AACjD,QAAItE,IAAI,GAAG,UAAUrB,OAAV,EAAmBC,QAAnB,EAA6B;AACtC,aAAO7N,EAAE,CAAC4N,OAAD,EAAUC,QAAV,CAAT;AACD,KAFD;;AAGA,WAAOkI,iBAAiB,CAAC9G,IAAD,EAAOsH,UAAP,EAAmBlK,KAAnB,EAA0BwB,QAA1B,EAAoC0F,MAApC,CAAxB;AACD,GALD;;AAOA,MAAIoD,MAAM,GAAG,UAAUrJ,GAAV,EAAe4C,GAAf,EAAoBtT,KAApB,EAA2B;AACtC,QAAII,QAAQ,CAACJ,KAAD,CAAR,IAAmBO,SAAS,CAACP,KAAD,CAA5B,IAAuCa,QAAQ,CAACb,KAAD,CAAnD,EAA4D;AAC1D0Q,MAAAA,GAAG,CAACsJ,YAAJ,CAAiB1G,GAAjB,EAAsBtT,KAAK,GAAG,EAA9B;AACD,KAFD,MAEO;AACLiQ,MAAAA,OAAO,CAACC,KAAR,CAAc,qCAAd,EAAqDoD,GAArD,EAA0D,WAA1D,EAAuEtT,KAAvE,EAA8E,aAA9E,EAA6F0Q,GAA7F;AACA,YAAM,IAAIpO,KAAJ,CAAU,gCAAV,CAAN;AACD;AACF,GAPD;;AAQA,MAAI2X,GAAG,GAAG,UAAUjJ,OAAV,EAAmBsC,GAAnB,EAAwBtT,KAAxB,EAA+B;AACvC+Z,IAAAA,MAAM,CAAC/I,OAAO,CAACN,GAAT,EAAc4C,GAAd,EAAmBtT,KAAnB,CAAN;AACD,GAFD;;AAGA,MAAIka,MAAM,GAAG,UAAUlJ,OAAV,EAAmBmJ,KAAnB,EAA0B;AACrC,QAAIzJ,GAAG,GAAGM,OAAO,CAACN,GAAlB;AACA6B,IAAAA,MAAM,CAAC4H,KAAD,EAAQ,UAAUxV,CAAV,EAAamD,CAAb,EAAgB;AAC5BiS,MAAAA,MAAM,CAACrJ,GAAD,EAAM5I,CAAN,EAASnD,CAAT,CAAN;AACD,KAFK,CAAN;AAGD,GALD;;AAMA,MAAIyV,KAAK,GAAG,UAAUpJ,OAAV,EAAmBsC,GAAnB,EAAwB;AAClC,QAAI3O,CAAC,GAAGqM,OAAO,CAACN,GAAR,CAAY2J,YAAZ,CAAyB/G,GAAzB,CAAR;AACA,WAAO3O,CAAC,KAAK,IAAN,GAAalE,SAAb,GAAyBkE,CAAhC;AACD,GAHD;;AAIA,MAAI2V,MAAM,GAAG,UAAUtJ,OAAV,EAAmBsC,GAAnB,EAAwB;AACnC,WAAOvO,QAAQ,CAACD,IAAT,CAAcsV,KAAK,CAACpJ,OAAD,EAAUsC,GAAV,CAAnB,CAAP;AACD,GAFD;;AAGA,MAAIiH,MAAM,GAAG,UAAUvJ,OAAV,EAAmBsC,GAAnB,EAAwB;AACnCtC,IAAAA,OAAO,CAACN,GAAR,CAAY8J,eAAZ,CAA4BlH,GAA5B;AACD,GAFD;;AAGA,MAAImH,KAAK,GAAG,UAAUzJ,OAAV,EAAmB;AAC7B,WAAOzK,KAAK,CAACyK,OAAO,CAACN,GAAR,CAAYgK,UAAb,EAAyB,UAAUpU,GAAV,EAAeqU,IAAf,EAAqB;AACxDrU,MAAAA,GAAG,CAACqU,IAAI,CAAC/a,IAAN,CAAH,GAAiB+a,IAAI,CAAC3a,KAAtB;AACA,aAAOsG,GAAP;AACD,KAHW,EAGT,EAHS,CAAZ;AAID,GALD;;AAOA,MAAIsU,aAAa,GAAG,UAAUlK,GAAV,EAAe;AACjC,WAAOA,GAAG,CAACmK,KAAJ,KAAcpa,SAAd,IAA2BG,UAAU,CAAC8P,GAAG,CAACmK,KAAJ,CAAUC,gBAAX,CAA5C;AACD,GAFD;;AAIA,MAAIC,WAAW,GAAG,UAAUrK,GAAV,EAAesK,QAAf,EAAyBhb,KAAzB,EAAgC;AAChD,QAAI,CAACI,QAAQ,CAACJ,KAAD,CAAb,EAAsB;AACpBiQ,MAAAA,OAAO,CAACC,KAAR,CAAc,oCAAd,EAAoD8K,QAApD,EAA8D,WAA9D,EAA2Ehb,KAA3E,EAAkF,aAAlF,EAAiG0Q,GAAjG;AACA,YAAM,IAAIpO,KAAJ,CAAU,iCAAiCtC,KAA3C,CAAN;AACD;;AACD,QAAI4a,aAAa,CAAClK,GAAD,CAAjB,EAAwB;AACtBA,MAAAA,GAAG,CAACmK,KAAJ,CAAUI,WAAV,CAAsBD,QAAtB,EAAgChb,KAAhC;AACD;AACF,GARD;;AASA,MAAIkb,cAAc,GAAG,UAAUxK,GAAV,EAAesK,QAAf,EAAyB;AAC5C,QAAIJ,aAAa,CAAClK,GAAD,CAAjB,EAAwB;AACtBA,MAAAA,GAAG,CAACmK,KAAJ,CAAUM,cAAV,CAAyBH,QAAzB;AACD;AACF,GAJD;;AAKA,MAAII,KAAK,GAAG,UAAUpK,OAAV,EAAmBgK,QAAnB,EAA6Bhb,KAA7B,EAAoC;AAC9C,QAAI0Q,GAAG,GAAGM,OAAO,CAACN,GAAlB;AACAqK,IAAAA,WAAW,CAACrK,GAAD,EAAMsK,QAAN,EAAgBhb,KAAhB,CAAX;AACD,GAHD;;AAIA,MAAIqb,QAAQ,GAAG,UAAUrK,OAAV,EAAmBsK,GAAnB,EAAwB;AACrC,QAAI5K,GAAG,GAAGM,OAAO,CAACN,GAAlB;AACA6B,IAAAA,MAAM,CAAC+I,GAAD,EAAM,UAAU3W,CAAV,EAAamD,CAAb,EAAgB;AAC1BiT,MAAAA,WAAW,CAACrK,GAAD,EAAM5I,CAAN,EAASnD,CAAT,CAAX;AACD,KAFK,CAAN;AAGD,GALD;;AAMA,MAAI4W,KAAK,GAAG,UAAUvK,OAAV,EAAmBgK,QAAnB,EAA6B;AACvC,QAAItK,GAAG,GAAGM,OAAO,CAACN,GAAlB;AACA,QAAI8K,MAAM,GAAGjN,MAAM,CAACkN,gBAAP,CAAwB/K,GAAxB,CAAb;AACA,QAAI3K,CAAC,GAAGyV,MAAM,CAACV,gBAAP,CAAwBE,QAAxB,CAAR;AACA,WAAOjV,CAAC,KAAK,EAAN,IAAY,CAACyS,MAAM,CAACxH,OAAD,CAAnB,GAA+B0K,iBAAiB,CAAChL,GAAD,EAAMsK,QAAN,CAAhD,GAAkEjV,CAAzE;AACD,GALD;;AAMA,MAAI2V,iBAAiB,GAAG,UAAUhL,GAAV,EAAesK,QAAf,EAAyB;AAC/C,WAAOJ,aAAa,CAAClK,GAAD,CAAb,GAAqBA,GAAG,CAACmK,KAAJ,CAAUC,gBAAV,CAA2BE,QAA3B,CAArB,GAA4D,EAAnE;AACD,GAFD;;AAGA,MAAIW,MAAM,GAAG,UAAU3K,OAAV,EAAmBgK,QAAnB,EAA6B;AACxC,QAAItK,GAAG,GAAGM,OAAO,CAACN,GAAlB;AACA,QAAIkL,GAAG,GAAGF,iBAAiB,CAAChL,GAAD,EAAMsK,QAAN,CAA3B;AACA,WAAOjW,QAAQ,CAACD,IAAT,CAAc8W,GAAd,EAAmB1X,MAAnB,CAA0B,UAAU6B,CAAV,EAAa;AAC5C,aAAOA,CAAC,CAAC1E,MAAF,GAAW,CAAlB;AACD,KAFM,CAAP;AAGD,GAND;;AAOA,MAAIwa,QAAQ,GAAG,UAAU7K,OAAV,EAAmBgK,QAAnB,EAA6B;AAC1C,QAAItK,GAAG,GAAGM,OAAO,CAACN,GAAlB;AACAwK,IAAAA,cAAc,CAACxK,GAAD,EAAMsK,QAAN,CAAd;;AACA,QAAIV,MAAM,CAACtJ,OAAD,EAAU,OAAV,CAAN,CAAyBnN,GAAzB,CAA6B6H,IAA7B,EAAmCtI,EAAnC,CAAsC,EAAtC,CAAJ,EAA+C;AAC7CmX,MAAAA,MAAM,CAACvJ,OAAD,EAAU,OAAV,CAAN;AACD;AACF,GAND;;AAOA,MAAI9J,IAAI,GAAG,UAAU4U,MAAV,EAAkBhQ,MAAlB,EAA0B;AACnC,QAAIiQ,SAAS,GAAGD,MAAM,CAACpL,GAAvB;AACA,QAAIsL,SAAS,GAAGlQ,MAAM,CAAC4E,GAAvB;;AACA,QAAIkK,aAAa,CAACmB,SAAD,CAAb,IAA4BnB,aAAa,CAACoB,SAAD,CAA7C,EAA0D;AACxDA,MAAAA,SAAS,CAACnB,KAAV,CAAgBoB,OAAhB,GAA0BF,SAAS,CAAClB,KAAV,CAAgBoB,OAA1C;AACD;AACF,GAND;;AAQA,MAAIC,YAAY,GAAG,UAAUC,IAAV,EAAgBvc,IAAhB,EAAsBwc,QAAtB,EAAgC;AACjD,QAAIA,QAAQ,KAAK,KAAK,CAAtB,EAAyB;AACvBA,MAAAA,QAAQ,GAAG,CAAX;AACD;;AACD,WAAO9B,MAAM,CAAC6B,IAAD,EAAOvc,IAAP,CAAN,CAAmBiE,GAAnB,CAAuB,UAAU7D,KAAV,EAAiB;AAC7C,aAAOqc,QAAQ,CAACrc,KAAD,EAAQ,EAAR,CAAf;AACD,KAFM,EAEJsD,KAFI,CAEE8Y,QAFF,CAAP;AAGD,GAPD;;AAQA,MAAIE,OAAO,GAAG,UAAUH,IAAV,EAAgBpc,IAAhB,EAAsB;AAClC,WAAOmc,YAAY,CAACC,IAAD,EAAOpc,IAAP,EAAa,CAAb,CAAnB;AACD,GAFD;;AAGA,MAAIwc,UAAU,GAAG,UAAUJ,IAAV,EAAgB;AAC/B,WAAOG,OAAO,CAACH,IAAD,EAAO,SAAP,CAAP,GAA2B,CAAlC;AACD,GAFD;;AAGA,MAAIK,UAAU,GAAG,UAAUL,IAAV,EAAgB;AAC/B,WAAOG,OAAO,CAACH,IAAD,EAAO,SAAP,CAAP,GAA2B,CAAlC;AACD,GAFD;;AAGA,MAAIM,WAAW,GAAG,UAAUzL,OAAV,EAAmBgK,QAAnB,EAA6B;AAC7C,WAAOqB,QAAQ,CAACd,KAAK,CAACvK,OAAD,EAAUgK,QAAV,CAAN,EAA2B,EAA3B,CAAf;AACD,GAFD;;AAGA,MAAI0B,QAAQ,GAAGhb,QAAQ,CAAC,EAAD,CAAvB;AACA,MAAIib,SAAS,GAAGjb,QAAQ,CAAC,EAAD,CAAxB;;AAEA,MAAIkb,UAAU,GAAG,UAAUnN,KAAV,EAAiBwB,QAAjB,EAA2B;AAC1C,WAAO4L,gBAAgB,CAACpN,KAAD,EAAQwB,QAAR,EAAkBzO,MAAlB,CAAvB;AACD,GAFD;;AAGA,MAAIqa,gBAAgB,GAAG,UAAUpN,KAAV,EAAiBwB,QAAjB,EAA2B2H,SAA3B,EAAsC;AAC3D,WAAO7U,IAAI,CAACoT,QAAQ,CAAC1H,KAAD,CAAT,EAAkB,UAAUnQ,CAAV,EAAa;AACxC,UAAI8D,EAAE,CAAC9D,CAAD,EAAI2R,QAAJ,CAAN,EAAqB;AACnB,eAAO2H,SAAS,CAACtZ,CAAD,CAAT,GAAe,CAACA,CAAD,CAAf,GAAqB,EAA5B;AACD,OAFD,MAEO;AACL,eAAOud,gBAAgB,CAACvd,CAAD,EAAI2R,QAAJ,EAAc2H,SAAd,CAAvB;AACD;AACF,KANU,CAAX;AAOD,GARD;;AAUA,MAAIkE,MAAM,GAAG,UAAUC,IAAV,EAAgB/L,OAAhB,EAAyB2F,MAAzB,EAAiC;AAC5C,QAAIA,MAAM,KAAK,KAAK,CAApB,EAAuB;AACrBA,MAAAA,MAAM,GAAGpU,KAAT;AACD;;AACD,QAAIoU,MAAM,CAAC3F,OAAD,CAAV,EAAqB;AACnB,aAAOjM,QAAQ,CAACtC,IAAT,EAAP;AACD;;AACD,QAAI+C,QAAQ,CAACuX,IAAD,EAAOnd,IAAI,CAACoR,OAAD,CAAX,CAAZ,EAAmC;AACjC,aAAOjM,QAAQ,CAACR,IAAT,CAAcyM,OAAd,CAAP;AACD;;AACD,QAAIgM,kBAAkB,GAAG,UAAUC,GAAV,EAAe;AACtC,aAAO7Z,EAAE,CAAC6Z,GAAD,EAAM,OAAN,CAAF,IAAoBtG,MAAM,CAACsG,GAAD,CAAjC;AACD,KAFD;;AAGA,WAAOtD,UAAU,CAAC3I,OAAD,EAAU+L,IAAI,CAACG,IAAL,CAAU,GAAV,CAAV,EAA0BF,kBAA1B,CAAjB;AACD,GAdD;;AAeA,MAAIb,IAAI,GAAG,UAAUnL,OAAV,EAAmB2F,MAAnB,EAA2B;AACpC,WAAOmG,MAAM,CAAC,CACZ,IADY,EAEZ,IAFY,CAAD,EAGV9L,OAHU,EAGD2F,MAHC,CAAb;AAID,GALD;;AAMA,MAAIhC,KAAK,GAAG,UAAUyE,QAAV,EAAoB;AAC9B,WAAOwD,UAAU,CAACxD,QAAD,EAAW,OAAX,CAAjB;AACD,GAFD;;AAGA,MAAIrF,OAAO,GAAG,UAAUqF,QAAV,EAAoB;AAChC,QAAIhW,EAAE,CAACgW,QAAD,EAAW,UAAX,CAAN,EAA8B;AAC5B,aAAOH,UAAU,CAACG,QAAD,EAAW,KAAX,CAAjB;AACD,KAFD,MAEO;AACL,aAAOrV,IAAI,CAACoZ,YAAY,CAAC/D,QAAD,CAAb,EAAyB,UAAUgE,WAAV,EAAuB;AACzD,eAAOnE,UAAU,CAACmE,WAAD,EAAc,KAAd,CAAjB;AACD,OAFU,CAAX;AAGD;AACF,GARD;;AASA,MAAIC,KAAK,GAAG,UAAUrM,OAAV,EAAmB2F,MAAnB,EAA2B;AACrC,WAAOmD,SAAS,CAAC9I,OAAD,EAAU,OAAV,EAAmB2F,MAAnB,CAAhB;AACD,GAFD;;AAGA,MAAI7C,IAAI,GAAG,UAAUsF,QAAV,EAAoB;AAC7B,WAAOwD,UAAU,CAACxD,QAAD,EAAW,IAAX,CAAjB;AACD,GAFD;;AAGA,MAAI+D,YAAY,GAAG,UAAU/D,QAAV,EAAoB;AACrC,WAAOiE,KAAK,CAACjE,QAAD,CAAL,CAAgBlW,IAAhB,CAAqBxB,QAAQ,CAAC,EAAD,CAA7B,EAAmC,UAAU2b,KAAV,EAAiB;AACzD,aAAOpE,UAAU,CAACoE,KAAD,EAAQ,UAAR,CAAjB;AACD,KAFM,CAAP;AAGD,GAJD;;AAMA,MAAIC,mBAAmB,GAAG,UAAUC,KAAV,EAAiBC,UAAjB,EAA6B;AACrD,WAAO3Z,GAAG,CAAC0Z,KAAD,EAAQ,UAAUtJ,GAAV,EAAe;AAC/B,UAAIrU,IAAI,CAACqU,GAAD,CAAJ,KAAc,UAAlB,EAA8B;AAC5B,YAAIwJ,OAAO,GAAG5Z,GAAG,CAACkQ,OAAO,CAACE,GAAD,CAAR,EAAe,UAAUC,MAAV,EAAkB;AAChD,cAAIG,OAAO,GAAG6H,YAAY,CAAChI,MAAD,EAAS,MAAT,EAAiB,CAAjB,CAA1B;AACA,iBAAOC,MAAM,CAACD,MAAD,EAAS,CAAT,EAAYG,OAAZ,CAAb;AACD,SAHgB,CAAjB;AAIA,eAAOK,OAAO,CAACT,GAAD,EAAMwJ,OAAN,EAAe,UAAf,CAAd;AACD,OAND,MAMO;AACL,YAAIA,OAAO,GAAG5Z,GAAG,CAAC8Q,KAAK,CAACV,GAAD,CAAN,EAAa,UAAUkI,IAAV,EAAgB;AAC5C,cAAI/H,OAAO,GAAG8H,YAAY,CAACC,IAAD,EAAO,SAAP,EAAkB,CAAlB,CAA1B;AACA,cAAI9H,OAAO,GAAG6H,YAAY,CAACC,IAAD,EAAO,SAAP,EAAkB,CAAlB,CAA1B;AACA,iBAAOhI,MAAM,CAACgI,IAAD,EAAO/H,OAAP,EAAgBC,OAAhB,CAAb;AACD,SAJgB,CAAjB;AAKA,eAAOK,OAAO,CAACT,GAAD,EAAMwJ,OAAN,EAAeD,UAAU,CAACvJ,GAAD,CAAzB,CAAd;AACD;AACF,KAfS,CAAV;AAgBD,GAjBD;;AAkBA,MAAIyJ,gBAAgB,GAAG,UAAU/T,KAAV,EAAiB;AACtC,WAAO6M,MAAM,CAAC7M,KAAD,CAAN,CAAc9F,GAAd,CAAkB,UAAU2S,MAAV,EAAkB;AACzC,UAAI5C,UAAU,GAAGhU,IAAI,CAAC4W,MAAD,CAArB;AACA,aAAO7C,cAAc,CAACC,UAAD,CAAd,GAA6BA,UAA7B,GAA0C,OAAjD;AACD,KAHM,EAGJtQ,KAHI,CAGE,OAHF,CAAP;AAID,GALD;;AAMA,MAAIqa,SAAS,GAAG,UAAUN,KAAV,EAAiB;AAC/B,QAAIO,MAAM,GAAG9J,IAAI,CAACuJ,KAAD,CAAjB;AACA,QAAIQ,cAAc,GAAGV,YAAY,CAACE,KAAD,CAAjC;;AACA,QAAIE,KAAK,GAAG3V,cAAc,CAACiW,cAAD,EAAiBD,MAAjB,CAA1B;;AACA,WAAON,mBAAmB,CAACC,KAAD,EAAQG,gBAAR,CAA1B;AACD,GALD;;AAMA,MAAII,cAAc,GAAG,UAAUP,KAAV,EAAiB3I,OAAjB,EAA0B;AAC7C,WAAO0I,mBAAmB,CAACC,KAAD,EAAQ,YAAY;AAC5C,aAAO3I,OAAP;AACD,KAFyB,CAA1B;AAGD,GAJD;;AAMA,MAAImJ,QAAQ,GAAG,UAAUC,OAAV,EAAmB3G,KAAnB,EAA0B1C,KAA1B,EAAiC;AAC9C,QAAIsJ,aAAa,GAAGD,OAAO,CAACrJ,KAA5B;AACA,QAAIuJ,MAAM,GAAGD,aAAa,CAAChZ,KAAd,CAAoB,CAApB,EAAuBoS,KAAvB,CAAb;AACA,QAAI8G,KAAK,GAAGF,aAAa,CAAChZ,KAAd,CAAoBoS,KAApB,CAAZ;AACA,QAAI+G,QAAQ,GAAGF,MAAM,CAACjc,MAAP,CAAc0S,KAAd,EAAqB1S,MAArB,CAA4Bkc,KAA5B,CAAf;AACA,WAAOE,QAAQ,CAACL,OAAD,EAAUI,QAAV,CAAf;AACD,GAND;;AAOA,MAAIE,OAAO,GAAG,UAAUN,OAAV,EAAmB3G,KAAnB,EAA0B8E,IAA1B,EAAgC;AAC5C,WAAO4B,QAAQ,CAACC,OAAD,EAAU3G,KAAV,EAAiB,CAAC8E,IAAD,CAAjB,CAAf;AACD,GAFD;;AAGA,MAAIoC,UAAU,GAAG,UAAUP,OAAV,EAAmB3G,KAAnB,EAA0B8E,IAA1B,EAAgC;AAC/C,QAAIxH,KAAK,GAAGqJ,OAAO,CAACrJ,KAApB;AACAA,IAAAA,KAAK,CAAC0C,KAAD,CAAL,GAAe8E,IAAf;AACD,GAHD;;AAIA,MAAIkC,QAAQ,GAAG,UAAUL,OAAV,EAAmBrJ,KAAnB,EAA0B;AACvC,WAAOI,QAAQ,CAACJ,KAAD,EAAQqJ,OAAO,CAACpJ,OAAhB,CAAf;AACD,GAFD;;AAGA,MAAI4J,QAAQ,GAAG,UAAUR,OAAV,EAAmB7b,CAAnB,EAAsB;AACnC,QAAIwS,KAAK,GAAGqJ,OAAO,CAACrJ,KAApB;AACA,QAAI5O,CAAC,GAAGlC,GAAG,CAAC8Q,KAAD,EAAQxS,CAAR,CAAX;AACA,WAAO4S,QAAQ,CAAChP,CAAD,EAAIiY,OAAO,CAACpJ,OAAZ,CAAf;AACD,GAJD;;AAKA,MAAI6J,OAAO,GAAG,UAAUT,OAAV,EAAmB3G,KAAnB,EAA0B;AACtC,WAAO2G,OAAO,CAACrJ,KAAR,CAAc0C,KAAd,CAAP;AACD,GAFD;;AAGA,MAAIqH,cAAc,GAAG,UAAUV,OAAV,EAAmB3G,KAAnB,EAA0B;AAC7C,WAAOoH,OAAO,CAACT,OAAD,EAAU3G,KAAV,CAAP,CAAwBrG,OAA/B;AACD,GAFD;;AAGA,MAAI2N,UAAU,GAAG,UAAUX,OAAV,EAAmB;AAClC,WAAOA,OAAO,CAACrJ,KAAR,CAActT,MAArB;AACD,GAFD;;AAGA,MAAIud,kBAAkB,GAAG,UAAU/K,IAAV,EAAgB;AACvC,QAAIkF,MAAM,GAAG9S,SAAS,CAAC4N,IAAD,EAAO,UAAUI,GAAV,EAAe;AAC1C,aAAOA,GAAG,CAACW,OAAJ,KAAgB,UAAvB;AACD,KAFqB,CAAtB;AAGA,WAAO;AACLd,MAAAA,IAAI,EAAEiF,MAAM,CAAC5S,IADR;AAEL0Y,MAAAA,IAAI,EAAE9F,MAAM,CAAC7S;AAFR,KAAP;AAID,GARD;;AAUA,MAAI4Y,eAAe,GAAG,0BAAtB;;AACA,MAAIC,yBAAyB,GAAG,UAAU1B,KAAV,EAAiB;AAC/C,WAAO/C,MAAM,CAAC+C,KAAD,EAAQyB,eAAR,CAAN,CAA+B/a,IAA/B,CAAoC,UAAUib,YAAV,EAAwB;AACjE,aAAOja,QAAQ,CAACD,IAAT,CAAcka,YAAY,CAAClQ,KAAb,CAAmB,MAAnB,CAAd,CAAP;AACD,KAFM,EAEJjL,GAFI,CAEA,UAAUob,UAAV,EAAsB;AAC3B,aAAOnY,WAAW,CAACmY,UAAD,EAAazc,MAAb,CAAlB;AACD,KAJM,CAAP;AAKD,GAND;;AAOA,MAAI0c,wBAAwB,GAAG,UAAUrL,IAAV,EAAgB;AAC7C,QAAIsL,MAAM,GAAG5Y,KAAK,CAACqY,kBAAkB,CAAC/K,IAAD,CAAlB,CAAyBC,IAA1B,EAAgC,UAAUxN,GAAV,EAAe2N,GAAf,EAAoB;AACpEnQ,MAAAA,IAAI,CAACmQ,GAAG,CAACU,KAAL,EAAY,UAAUwH,IAAV,EAAgBiD,GAAhB,EAAqB;AACnC,YAAIjD,IAAI,CAAC1H,QAAT,EAAmB;AACjBnO,UAAAA,GAAG,CAAC8Y,GAAD,CAAH,GAAW,IAAX;AACD;AACF,OAJG,CAAJ;AAKA,aAAO9Y,GAAP;AACD,KAPiB,EAOf,EAPe,CAAlB;AAQA,QAAI+Y,SAAS,GAAGnM,UAAU,CAACiM,MAAD,EAAS,UAAUG,IAAV,EAAgBhM,GAAhB,EAAqB;AACtD,aAAO+I,QAAQ,CAAC/I,GAAD,EAAM,EAAN,CAAf;AACD,KAFyB,CAA1B;AAGA,WAAOtM,IAAI,CAACqY,SAAD,CAAX;AACD,GAbD;;AAeA,MAAI/L,GAAG,GAAG,UAAUW,GAAV,EAAeC,MAAf,EAAuB;AAC/B,WAAOD,GAAG,GAAG,GAAN,GAAYC,MAAnB;AACD,GAFD;;AAGA,MAAIqL,KAAK,GAAG,UAAUC,SAAV,EAAqBvL,GAArB,EAA0BC,MAA1B,EAAkC;AAC5C,QAAI0H,GAAG,GAAG4D,SAAS,CAACC,MAAV,CAAiBnM,GAAG,CAACW,GAAD,EAAMC,MAAN,CAApB,CAAV;AACA,WAAO0H,GAAG,KAAKnb,SAAR,GAAoBsE,QAAQ,CAACR,IAAT,CAAcqX,GAAd,CAApB,GAAyC7W,QAAQ,CAACtC,IAAT,EAAhD;AACD,GAHD;;AAIA,MAAIid,QAAQ,GAAG,UAAUF,SAAV,EAAqBG,IAArB,EAA2B1Y,UAA3B,EAAuC;AACpD,QAAI2Y,QAAQ,GAAGC,WAAW,CAACL,SAAD,EAAY,UAAUrL,MAAV,EAAkB;AACtD,aAAOlN,UAAU,CAAC0Y,IAAD,EAAOxL,MAAM,CAACnD,OAAd,CAAjB;AACD,KAFyB,CAA1B;AAGA,WAAO4O,QAAQ,CAACve,MAAT,GAAkB,CAAlB,GAAsB0D,QAAQ,CAACR,IAAT,CAAcqb,QAAQ,CAAC,CAAD,CAAtB,CAAtB,GAAmD7a,QAAQ,CAACtC,IAAT,EAA1D;AACD,GALD;;AAMA,MAAIod,WAAW,GAAG,UAAUL,SAAV,EAAqB5G,SAArB,EAAgC;AAChD,QAAI5W,GAAG,GAAG+B,IAAI,CAACyb,SAAS,CAACxd,GAAX,EAAgB,UAAU+D,CAAV,EAAa;AACzC,aAAOA,CAAC,CAAC4O,KAAT;AACD,KAFa,CAAd;AAGA,WAAOzQ,MAAM,CAAClC,GAAD,EAAM4W,SAAN,CAAb;AACD,GALD;;AAMA,MAAIkH,eAAe,GAAG,UAAUC,OAAV,EAAmB;AACvC,QAAIC,YAAY,GAAG,EAAnB;AACA,QAAI3I,KAAK,GAAG,CAAZ;AACAvT,IAAAA,IAAI,CAACic,OAAO,CAACpL,KAAT,EAAgB,UAAUT,MAAV,EAAkB;AACpC,UAAIG,OAAO,GAAGH,MAAM,CAACG,OAArB;AACAxO,MAAAA,KAAK,CAACwO,OAAD,EAAU,UAAU4L,WAAV,EAAuB;AACpC,YAAIC,QAAQ,GAAG7I,KAAK,GAAG4I,WAAvB;AACAD,QAAAA,YAAY,CAACE,QAAD,CAAZ,GAAyB3K,SAAS,CAACrB,MAAM,CAAClD,OAAR,EAAiBqD,OAAjB,EAA0B6L,QAA1B,CAAlC;AACD,OAHI,CAAL;AAIA7I,MAAAA,KAAK,IAAIhD,OAAT;AACD,KAPG,CAAJ;AAQA,WAAO2L,YAAP;AACD,GAZD;;AAaA,MAAIG,QAAQ,GAAG,UAAUC,IAAV,EAAgB;AAC7B,QAAIX,MAAM,GAAG,EAAb;AACA,QAAI9K,KAAK,GAAG,EAAZ;AACA,QAAIZ,OAAO,GAAG,EAAd;AACA,QAAIsM,QAAQ,GAAGjZ,IAAI,CAACgZ,IAAD,CAAJ,CAAWvc,GAAX,CAAe,UAAUkc,OAAV,EAAmB;AAC/C,aAAOA,OAAO,CAAC/O,OAAf;AACD,KAFc,EAEZjN,IAFY,CAEPsZ,KAFO,CAAf;AAGA,QAAIiD,aAAa,GAAGD,QAAQ,CAACtc,IAAT,CAAcgb,yBAAd,EAAyCzb,KAAzC,CAA+C,EAA/C,CAApB;AACA,QAAIid,OAAO,GAAG,CAAd;AACA,QAAIC,UAAU,GAAG,CAAjB;AACA,QAAIC,QAAQ,GAAG,CAAf;AACA3c,IAAAA,IAAI,CAACsc,IAAD,EAAO,UAAUL,OAAV,EAAmB;AAC5B,UAAIA,OAAO,CAACnL,OAAR,KAAoB,UAAxB,EAAoC;AAClCb,QAAAA,OAAO,GAAG+L,eAAe,CAACC,OAAD,CAAzB;AACD,OAFD,MAEO;AACL,YAAIW,YAAY,GAAG,EAAnB;AACA5c,QAAAA,IAAI,CAACic,OAAO,CAACpL,KAAT,EAAgB,UAAUgM,OAAV,EAAmB;AACrC,cAAIxV,KAAK,GAAG,CAAZ;;AACA,iBAAOsU,MAAM,CAACnM,GAAG,CAACmN,QAAD,EAAWtV,KAAX,CAAJ,CAAN,KAAiC1K,SAAxC,EAAmD;AACjD0K,YAAAA,KAAK;AACN;;AACD,cAAIsJ,QAAQ,GAAGjB,iBAAiB,CAAC8M,aAAD,EAAgBnV,KAAK,CAAC7G,QAAN,EAAhB,CAAhC;AACA,cAAIsG,OAAO,GAAG4J,QAAQ,CAACmM,OAAO,CAAC3P,OAAT,EAAkB2P,OAAO,CAACvM,OAA1B,EAAmCuM,OAAO,CAACtM,OAA3C,EAAoDoM,QAApD,EAA8DtV,KAA9D,EAAqEsJ,QAArE,CAAtB;;AACA,eAAK,IAAImM,sBAAsB,GAAG,CAAlC,EAAqCA,sBAAsB,GAAGD,OAAO,CAACtM,OAAtE,EAA+EuM,sBAAsB,EAArG,EAAyG;AACvG,iBAAK,IAAIC,mBAAmB,GAAG,CAA/B,EAAkCA,mBAAmB,GAAGF,OAAO,CAACvM,OAAhE,EAAyEyM,mBAAmB,EAA5F,EAAgG;AAC9F,kBAAIC,WAAW,GAAGL,QAAQ,GAAGI,mBAA7B;AACA,kBAAIE,cAAc,GAAG5V,KAAK,GAAGyV,sBAA7B;AACA,kBAAII,MAAM,GAAG1N,GAAG,CAACwN,WAAD,EAAcC,cAAd,CAAhB;AACAtB,cAAAA,MAAM,CAACuB,MAAD,CAAN,GAAiBpW,OAAjB;AACA4V,cAAAA,UAAU,GAAGS,IAAI,CAACC,GAAL,CAASV,UAAT,EAAqBO,cAAc,GAAG,CAAtC,CAAb;AACD;AACF;;AACDL,UAAAA,YAAY,CAACrb,IAAb,CAAkBuF,OAAlB;AACD,SAjBG,CAAJ;AAkBA2V,QAAAA,OAAO;AACP5L,QAAAA,KAAK,CAACtP,IAAN,CAAWqP,OAAO,CAACqL,OAAO,CAAC/O,OAAT,EAAkB0P,YAAlB,EAAgCX,OAAO,CAACnL,OAAxC,CAAlB;AACA6L,QAAAA,QAAQ;AACT;AACF,KA3BG,CAAJ;AA4BA,QAAIU,MAAM,GAAGtN,IAAI,CAAC0M,OAAD,EAAUC,UAAV,CAAjB;AACA,WAAO;AACL3M,MAAAA,IAAI,EAAEsN,MADD;AAEL1B,MAAAA,MAAM,EAAEA,MAFH;AAGLzd,MAAAA,GAAG,EAAE2S,KAHA;AAILZ,MAAAA,OAAO,EAAEA;AAJJ,KAAP;AAMD,GA9CD;;AA+CA,MAAIqN,WAAW,GAAG,UAAU/D,KAAV,EAAiB;AACjC,QAAI+C,IAAI,GAAGzC,SAAS,CAACN,KAAD,CAApB;AACA,WAAO8C,QAAQ,CAACC,IAAD,CAAf;AACD,GAHD;;AAIA,MAAIiB,SAAS,GAAG,UAAU7B,SAAV,EAAqB;AACnC,WAAOzb,IAAI,CAACyb,SAAS,CAACxd,GAAX,EAAgB,UAAUsf,CAAV,EAAa;AACtC,aAAOA,CAAC,CAAC3M,KAAT;AACD,KAFU,CAAX;AAGD,GAJD;;AAKA,MAAI4M,WAAW,GAAG,UAAU/B,SAAV,EAAqB;AACrC,WAAOrM,MAAM,CAACqM,SAAS,CAACzL,OAAX,CAAb;AACD,GAFD;;AAGA,MAAIyN,UAAU,GAAG,UAAUhC,SAAV,EAAqB;AACpC,WAAOlN,IAAI,CAACkN,SAAS,CAACzL,OAAX,CAAJ,CAAwB1S,MAAxB,GAAiC,CAAxC;AACD,GAFD;;AAGA,MAAIogB,WAAW,GAAG,UAAUjC,SAAV,EAAqBS,WAArB,EAAkC;AAClD,WAAOlb,QAAQ,CAACD,IAAT,CAAc0a,SAAS,CAACzL,OAAV,CAAkBkM,WAAlB,CAAd,CAAP;AACD,GAFD;;AAGA,MAAIyB,SAAS,GAAG;AACd/D,IAAAA,SAAS,EAAEyD,WADG;AAEdjB,IAAAA,QAAQ,EAAEA,QAFI;AAGdZ,IAAAA,KAAK,EAAEA,KAHO;AAIdG,IAAAA,QAAQ,EAAEA,QAJI;AAKdG,IAAAA,WAAW,EAAEA,WALC;AAMdwB,IAAAA,SAAS,EAAEA,SANG;AAOdE,IAAAA,WAAW,EAAEA,WAPC;AAQdC,IAAAA,UAAU,EAAEA,UARE;AASdC,IAAAA,WAAW,EAAEA;AATC,GAAhB;;AAYA,MAAIE,WAAW,GAAG,UAAUzM,MAAV,EAAkBf,MAAlB,EAA0B;AAC1C,QAAIyN,QAAQ,GAAGzN,MAAM,CAACD,MAAtB;AACA,QAAI2N,SAAS,GAAG1N,MAAM,CAACD,MAAP,GAAgBC,MAAM,CAACE,OAAvB,GAAiC,CAAjD;AACA,QAAIyN,OAAO,GAAG3N,MAAM,CAACF,GAArB;AACA,QAAI8N,UAAU,GAAG5N,MAAM,CAACF,GAAP,GAAaE,MAAM,CAACC,OAApB,GAA8B,CAA/C;AACA,WAAOwN,QAAQ,IAAI1M,MAAM,CAACI,SAAnB,IAAgCuM,SAAS,IAAI3M,MAAM,CAACE,QAApD,IAAiE0M,OAAO,IAAI5M,MAAM,CAACG,SAAlB,IAA+B0M,UAAU,IAAI7M,MAAM,CAACC,QAA5H;AACD,GAND;;AAOA,MAAI6M,QAAQ,GAAG,UAAU9M,MAAV,EAAkBf,MAAlB,EAA0B;AACvC,WAAOA,MAAM,CAACD,MAAP,IAAiBgB,MAAM,CAACE,QAAxB,IAAoCjB,MAAM,CAACD,MAAP,GAAgBC,MAAM,CAACE,OAAvB,GAAiC,CAAjC,IAAsCa,MAAM,CAACI,SAAjF,IAA8FnB,MAAM,CAACF,GAAP,IAAciB,MAAM,CAACC,QAAnH,IAA+HhB,MAAM,CAACF,GAAP,GAAaE,MAAM,CAACC,OAApB,GAA8B,CAA9B,IAAmCc,MAAM,CAACG,SAAhL;AACD,GAFD;;AAGA,MAAI4M,aAAa,GAAG,UAAUzC,SAAV,EAAqBtK,MAArB,EAA6B;AAC/C,QAAIgN,MAAM,GAAG,IAAb;AACA,QAAIC,cAAc,GAAGvgB,KAAK,CAACogB,QAAD,EAAW9M,MAAX,CAA1B;;AACA,SAAK,IAAIvP,CAAC,GAAGuP,MAAM,CAACC,QAApB,EAA8BxP,CAAC,IAAIuP,MAAM,CAACG,SAA1C,EAAqD1P,CAAC,EAAtD,EAA0D;AACxD,WAAK,IAAIoC,CAAC,GAAGmN,MAAM,CAACE,QAApB,EAA8BrN,CAAC,IAAImN,MAAM,CAACI,SAA1C,EAAqDvN,CAAC,EAAtD,EAA0D;AACxDma,QAAAA,MAAM,GAAGA,MAAM,IAAIR,SAAS,CAACnC,KAAV,CAAgBC,SAAhB,EAA2B7Z,CAA3B,EAA8BoC,CAA9B,EAAiC/D,MAAjC,CAAwCme,cAAxC,CAAnB;AACD;AACF;;AACD,WAAOD,MAAM,GAAGnd,QAAQ,CAACR,IAAT,CAAc2Q,MAAd,CAAH,GAA2BnQ,QAAQ,CAACtC,IAAT,EAAxC;AACD,GATD;;AAWA,MAAI2f,SAAS,GAAG,UAAUC,OAAV,EAAmBC,OAAnB,EAA4B;AAC1C,WAAOpN,MAAM,CAAC+L,IAAI,CAACsB,GAAL,CAASF,OAAO,CAACpO,GAAjB,EAAsBqO,OAAO,CAACrO,GAA9B,CAAD,EAAqCgN,IAAI,CAACsB,GAAL,CAASF,OAAO,CAACnO,MAAjB,EAAyBoO,OAAO,CAACpO,MAAjC,CAArC,EAA+E+M,IAAI,CAACC,GAAL,CAASmB,OAAO,CAACpO,GAAR,GAAcoO,OAAO,CAACjO,OAAtB,GAAgC,CAAzC,EAA4CkO,OAAO,CAACrO,GAAR,GAAcqO,OAAO,CAAClO,OAAtB,GAAgC,CAA5E,CAA/E,EAA+J6M,IAAI,CAACC,GAAL,CAASmB,OAAO,CAACnO,MAAR,GAAiBmO,OAAO,CAAChO,OAAzB,GAAmC,CAA5C,EAA+CiO,OAAO,CAACpO,MAAR,GAAiBoO,OAAO,CAACjO,OAAzB,GAAmC,CAAlF,CAA/J,CAAb;AACD,GAFD;;AAGA,MAAImO,SAAS,GAAG,UAAUhD,SAAV,EAAqBiD,SAArB,EAAgCC,UAAhC,EAA4C;AAC1D,QAAIC,WAAW,GAAGjB,SAAS,CAAChC,QAAV,CAAmBF,SAAnB,EAA8BiD,SAA9B,EAAyC5Q,IAAzC,CAAlB;AACA,QAAI+Q,YAAY,GAAGlB,SAAS,CAAChC,QAAV,CAAmBF,SAAnB,EAA8BkD,UAA9B,EAA0C7Q,IAA1C,CAAnB;AACA,WAAO8Q,WAAW,CAAC5e,IAAZ,CAAiB,UAAU8e,EAAV,EAAc;AACpC,aAAOD,YAAY,CAAC/e,GAAb,CAAiB,UAAUif,EAAV,EAAc;AACpC,eAAOV,SAAS,CAACS,EAAD,EAAKC,EAAL,CAAhB;AACD,OAFM,CAAP;AAGD,KAJM,CAAP;AAKD,GARD;;AASA,MAAIC,MAAM,GAAG,UAAUvD,SAAV,EAAqBiD,SAArB,EAAgCC,UAAhC,EAA4C;AACvD,WAAOF,SAAS,CAAChD,SAAD,EAAYiD,SAAZ,EAAuBC,UAAvB,CAAT,CAA4C3e,IAA5C,CAAiD,UAAUmR,MAAV,EAAkB;AACxE,aAAO+M,aAAa,CAACzC,SAAD,EAAYtK,MAAZ,CAApB;AACD,KAFM,CAAP;AAGD,GAJD;;AAMA,MAAI8N,MAAM,GAAG,UAAUxD,SAAV,EAAqBrD,IAArB,EAA2BlI,GAA3B,EAAgCC,MAAhC,EAAwC;AACnD,WAAOwN,SAAS,CAAChC,QAAV,CAAmBF,SAAnB,EAA8BrD,IAA9B,EAAoCtK,IAApC,EAA0C9N,IAA1C,CAA+C,UAAUoQ,MAAV,EAAkB;AACtE,UAAIgB,QAAQ,GAAGlB,GAAG,GAAG,CAAN,GAAUE,MAAM,CAACF,GAAP,GAAaE,MAAM,CAACC,OAApB,GAA8B,CAAxC,GAA4CD,MAAM,CAACF,GAAlE;AACA,UAAImB,QAAQ,GAAGlB,MAAM,GAAG,CAAT,GAAaC,MAAM,CAACD,MAAP,GAAgBC,MAAM,CAACE,OAAvB,GAAiC,CAA9C,GAAkDF,MAAM,CAACD,MAAxE;AACA,UAAI+O,IAAI,GAAGvB,SAAS,CAACnC,KAAV,CAAgBC,SAAhB,EAA2BrK,QAAQ,GAAGlB,GAAtC,EAA2CmB,QAAQ,GAAGlB,MAAtD,CAAX;AACA,aAAO+O,IAAI,CAACpf,GAAL,CAAS,UAAUqf,CAAV,EAAa;AAC3B,eAAOA,CAAC,CAAClS,OAAT;AACD,OAFM,CAAP;AAGD,KAPM,CAAP;AAQD,GATD;;AAUA,MAAImS,UAAU,GAAG,UAAU3D,SAAV,EAAqBrU,KAArB,EAA4BiY,MAA5B,EAAoC;AACnD,WAAOZ,SAAS,CAAChD,SAAD,EAAYrU,KAAZ,EAAmBiY,MAAnB,CAAT,CAAoCvf,GAApC,CAAwC,UAAUqR,MAAV,EAAkB;AAC/D,UAAImO,MAAM,GAAG3B,SAAS,CAAC7B,WAAV,CAAsBL,SAAtB,EAAiC5d,KAAK,CAAC+f,WAAD,EAAczM,MAAd,CAAtC,CAAb;AACA,aAAOrR,GAAG,CAACwf,MAAD,EAAS,UAAUlP,MAAV,EAAkB;AACnC,eAAOA,MAAM,CAACnD,OAAd;AACD,OAFS,CAAV;AAGD,KALM,CAAP;AAMD,GAPD;;AAQA,MAAIsS,UAAU,GAAG,UAAU9D,SAAV,EAAqB+D,SAArB,EAAgC;AAC/C,QAAIC,aAAa,GAAG,UAAUC,EAAV,EAAcC,EAAd,EAAkB;AACpC,aAAOtR,UAAU,CAACsR,EAAD,EAAKD,EAAL,CAAjB;AACD,KAFD;;AAGA,WAAO/B,SAAS,CAAChC,QAAV,CAAmBF,SAAnB,EAA8B+D,SAA9B,EAAyCC,aAAzC,EAAwD3f,GAAxD,CAA4D,UAAUsQ,MAAV,EAAkB;AACnF,aAAOA,MAAM,CAACnD,OAAd;AACD,KAFM,CAAP;AAGD,GAPD;;AASA,MAAI2S,QAAQ,GAAG,UAAUxH,IAAV,EAAgByH,QAAhB,EAA0BC,WAA1B,EAAuC;AACpD,WAAOxG,KAAK,CAAClB,IAAD,CAAL,CAAYpY,IAAZ,CAAiB,UAAUsZ,KAAV,EAAiB;AACvC,UAAImC,SAAS,GAAGsE,YAAY,CAACzG,KAAD,CAA5B;AACA,aAAO2F,MAAM,CAACxD,SAAD,EAAYrD,IAAZ,EAAkByH,QAAlB,EAA4BC,WAA5B,CAAb;AACD,KAHM,CAAP;AAID,GALD;;AAMA,MAAIE,YAAY,GAAG,UAAU1G,KAAV,EAAiB2G,KAAjB,EAAwB3c,IAAxB,EAA8B;AAC/C,QAAImY,SAAS,GAAGsE,YAAY,CAACzG,KAAD,CAA5B;AACA,WAAO8F,UAAU,CAAC3D,SAAD,EAAYwE,KAAZ,EAAmB3c,IAAnB,CAAjB;AACD,GAHD;;AAIA,MAAI4c,gBAAgB,GAAG,UAAU5G,KAAV,EAAiB2G,KAAjB,EAAwBE,UAAxB,EAAoC7c,IAApC,EAA0C8c,SAA1C,EAAqD;AAC1E,QAAI3E,SAAS,GAAGsE,YAAY,CAACzG,KAAD,CAA5B;AACA,QAAI+G,YAAY,GAAGvS,IAAI,CAACwL,KAAD,EAAQ6G,UAAR,CAAJ,GAA0Bnf,QAAQ,CAACR,IAAT,CAAcyf,KAAd,CAA1B,GAAiDV,UAAU,CAAC9D,SAAD,EAAYwE,KAAZ,CAA9E;AACA,QAAIK,WAAW,GAAGxS,IAAI,CAACwL,KAAD,EAAQ8G,SAAR,CAAJ,GAAyBpf,QAAQ,CAACR,IAAT,CAAc8C,IAAd,CAAzB,GAA+Cic,UAAU,CAAC9D,SAAD,EAAYnY,IAAZ,CAA3E;AACA,WAAO+c,YAAY,CAACrgB,IAAb,CAAkB,UAAU0e,SAAV,EAAqB;AAC5C,aAAO4B,WAAW,CAACtgB,IAAZ,CAAiB,UAAUugB,QAAV,EAAoB;AAC1C,eAAOnB,UAAU,CAAC3D,SAAD,EAAYiD,SAAZ,EAAuB6B,QAAvB,CAAjB;AACD,OAFM,CAAP;AAGD,KAJM,CAAP;AAKD,GATD;;AAUA,MAAIC,QAAQ,GAAG,UAAUlH,KAAV,EAAiB2G,KAAjB,EAAwB3c,IAAxB,EAA8B;AAC3C,QAAImY,SAAS,GAAGsE,YAAY,CAACzG,KAAD,CAA5B;AACA,WAAO0F,MAAM,CAACvD,SAAD,EAAYwE,KAAZ,EAAmB3c,IAAnB,CAAb;AACD,GAHD;;AAIA,MAAIyc,YAAY,GAAGpC,SAAS,CAAC/D,SAA7B;;AAEA,MAAIO,MAAM,GAAG,UAAUsG,MAAV,EAAkBxT,OAAlB,EAA2B;AACtC,QAAIyT,QAAQ,GAAGjO,MAAM,CAACgO,MAAD,CAArB;AACAC,IAAAA,QAAQ,CAAC3gB,IAAT,CAAc,UAAUa,CAAV,EAAa;AACzBA,MAAAA,CAAC,CAAC+L,GAAF,CAAMgU,YAAN,CAAmB1T,OAAO,CAACN,GAA3B,EAAgC8T,MAAM,CAAC9T,GAAvC;AACD,KAFD;AAGD,GALD;;AAMA,MAAIyN,KAAK,GAAG,UAAUqG,MAAV,EAAkBxT,OAAlB,EAA2B;AACrC,QAAI2T,OAAO,GAAGzN,WAAW,CAACsN,MAAD,CAAzB;AACAG,IAAAA,OAAO,CAACzhB,IAAR,CAAa,YAAY;AACvB,UAAIuhB,QAAQ,GAAGjO,MAAM,CAACgO,MAAD,CAArB;AACAC,MAAAA,QAAQ,CAAC3gB,IAAT,CAAc,UAAUa,CAAV,EAAa;AACzBigB,QAAAA,MAAM,CAACjgB,CAAD,EAAIqM,OAAJ,CAAN;AACD,OAFD;AAGD,KALD,EAKG,UAAUrM,CAAV,EAAa;AACduZ,MAAAA,MAAM,CAACvZ,CAAD,EAAIqM,OAAJ,CAAN;AACD,KAPD;AAQD,GAVD;;AAWA,MAAI6T,OAAO,GAAG,UAAUrO,MAAV,EAAkBxF,OAAlB,EAA2B;AACvC,QAAI8T,YAAY,GAAGvN,UAAU,CAACf,MAAD,CAA7B;AACAsO,IAAAA,YAAY,CAAC5hB,IAAb,CAAkB,YAAY;AAC5B0hB,MAAAA,MAAM,CAACpO,MAAD,EAASxF,OAAT,CAAN;AACD,KAFD,EAEG,UAAUrM,CAAV,EAAa;AACd6R,MAAAA,MAAM,CAAC9F,GAAP,CAAWgU,YAAX,CAAwB1T,OAAO,CAACN,GAAhC,EAAqC/L,CAAC,CAAC+L,GAAvC;AACD,KAJD;AAKD,GAPD;;AAQA,MAAIkU,MAAM,GAAG,UAAUpO,MAAV,EAAkBxF,OAAlB,EAA2B;AACtCwF,IAAAA,MAAM,CAAC9F,GAAP,CAAWqU,WAAX,CAAuB/T,OAAO,CAACN,GAA/B;AACD,GAFD;;AAGA,MAAIsU,IAAI,GAAG,UAAUhU,OAAV,EAAmBiU,OAAnB,EAA4B;AACrC/G,IAAAA,MAAM,CAAClN,OAAD,EAAUiU,OAAV,CAAN;AACAL,IAAAA,MAAM,CAACK,OAAD,EAAUjU,OAAV,CAAN;AACD,GAHD;;AAKA,MAAIkU,QAAQ,GAAG,UAAUV,MAAV,EAAkBW,QAAlB,EAA4B;AACzCrhB,IAAAA,IAAI,CAACqhB,QAAD,EAAW,UAAU7lB,CAAV,EAAa;AAC1B4e,MAAAA,MAAM,CAACsG,MAAD,EAASllB,CAAT,CAAN;AACD,KAFG,CAAJ;AAGD,GAJD;;AAKA,MAAI8lB,OAAO,GAAG,UAAUZ,MAAV,EAAkBW,QAAlB,EAA4B;AACxCrhB,IAAAA,IAAI,CAACqhB,QAAD,EAAW,UAAU7lB,CAAV,EAAaqG,CAAb,EAAgB;AAC7B,UAAIuQ,CAAC,GAAGvQ,CAAC,KAAK,CAAN,GAAU6e,MAAV,GAAmBW,QAAQ,CAACxf,CAAC,GAAG,CAAL,CAAnC;AACAwY,MAAAA,KAAK,CAACjI,CAAD,EAAI5W,CAAJ,CAAL;AACD,KAHG,CAAJ;AAID,GALD;;AAMA,MAAI+lB,QAAQ,GAAG,UAAU7O,MAAV,EAAkB2O,QAAlB,EAA4B;AACzCrhB,IAAAA,IAAI,CAACqhB,QAAD,EAAW,UAAU7lB,CAAV,EAAa;AAC1BslB,MAAAA,MAAM,CAACpO,MAAD,EAASlX,CAAT,CAAN;AACD,KAFG,CAAJ;AAGD,GAJD;;AAMA,MAAIgmB,KAAK,GAAG,UAAUtU,OAAV,EAAmB;AAC7BA,IAAAA,OAAO,CAACN,GAAR,CAAY6U,WAAZ,GAA0B,EAA1B;AACAzhB,IAAAA,IAAI,CAACqT,QAAQ,CAACnG,OAAD,CAAT,EAAoB,UAAUwU,KAAV,EAAiB;AACvCC,MAAAA,QAAQ,CAACD,KAAD,CAAR;AACD,KAFG,CAAJ;AAGD,GALD;;AAMA,MAAIC,QAAQ,GAAG,UAAUzU,OAAV,EAAmB;AAChC,QAAIN,GAAG,GAAGM,OAAO,CAACN,GAAlB;;AACA,QAAIA,GAAG,CAAC+F,UAAJ,KAAmB,IAAvB,EAA6B;AAC3B/F,MAAAA,GAAG,CAAC+F,UAAJ,CAAeiP,WAAf,CAA2BhV,GAA3B;AACD;AACF,GALD;;AAMA,MAAIiV,MAAM,GAAG,UAAUV,OAAV,EAAmB;AAC9B,QAAIpM,UAAU,GAAG1B,QAAQ,CAAC8N,OAAD,CAAzB;;AACA,QAAIpM,UAAU,CAACxX,MAAX,GAAoB,CAAxB,EAA2B;AACzB6jB,MAAAA,QAAQ,CAACD,OAAD,EAAUpM,UAAV,CAAR;AACD;;AACD4M,IAAAA,QAAQ,CAACR,OAAD,CAAR;AACD,GAND;;AAQA,MAAIW,SAAS,GAAG,UAAUxiB,EAAV,EAAcxD,IAAd,EAAoB;AAClC,QAAIuH,GAAG,GAAG,UAAU6J,OAAV,EAAmB;AAC3B,UAAI,CAAC5N,EAAE,CAAC4N,OAAD,CAAP,EAAkB;AAChB,cAAM,IAAI1O,KAAJ,CAAU,kBAAkB1C,IAAlB,GAAyB,cAAzB,GAA0CA,IAA1C,GAAiD,OAA3D,CAAN;AACD;;AACD,aAAOimB,SAAS,CAAC7U,OAAD,CAAT,CAAmB1N,KAAnB,CAAyB,EAAzB,CAAP;AACD,KALD;;AAMA,QAAIuiB,SAAS,GAAG,UAAU7U,OAAV,EAAmB;AACjC,aAAO5N,EAAE,CAAC4N,OAAD,CAAF,GAAcjM,QAAQ,CAACD,IAAT,CAAckM,OAAO,CAACN,GAAR,CAAYoV,SAA1B,CAAd,GAAqD/gB,QAAQ,CAACtC,IAAT,EAA5D;AACD,KAFD;;AAGA,QAAIwX,GAAG,GAAG,UAAUjJ,OAAV,EAAmBhR,KAAnB,EAA0B;AAClC,UAAI,CAACoD,EAAE,CAAC4N,OAAD,CAAP,EAAkB;AAChB,cAAM,IAAI1O,KAAJ,CAAU,sBAAsB1C,IAAtB,GAA6B,cAA7B,GAA8CA,IAA9C,GAAqD,OAA/D,CAAN;AACD;;AACDoR,MAAAA,OAAO,CAACN,GAAR,CAAYoV,SAAZ,GAAwB9lB,KAAxB;AACD,KALD;;AAMA,WAAO;AACLmH,MAAAA,GAAG,EAAEA,GADA;AAEL0e,MAAAA,SAAS,EAAEA,SAFN;AAGL5L,MAAAA,GAAG,EAAEA;AAHA,KAAP;AAKD,GArBD;;AAuBA,MAAI8L,GAAG,GAAGH,SAAS,CAAC9P,MAAD,EAAS,MAAT,CAAnB;;AACA,MAAIkQ,KAAK,GAAG,UAAUhV,OAAV,EAAmB;AAC7B,WAAO+U,GAAG,CAAC5e,GAAJ,CAAQ6J,OAAR,CAAP;AACD,GAFD;;AAGA,MAAI6U,SAAS,GAAG,UAAU7U,OAAV,EAAmB;AACjC,WAAO+U,GAAG,CAACF,SAAJ,CAAc7U,OAAd,CAAP;AACD,GAFD;;AAGA,MAAIiV,KAAK,GAAG,UAAUjV,OAAV,EAAmBhR,KAAnB,EAA0B;AACpC,WAAO+lB,GAAG,CAAC9L,GAAJ,CAAQjJ,OAAR,EAAiBhR,KAAjB,CAAP;AACD,GAFD;;AAIA,MAAIkmB,aAAa,GAAG,CAClB,MADkB,EAElB,GAFkB,EAGlB,KAHkB,EAIlB,SAJkB,EAKlB,OALkB,EAMlB,YANkB,EAOlB,QAPkB,EAQlB,QARkB,EASlB,QATkB,EAUlB,KAVkB,EAWlB,SAXkB,EAYlB,IAZkB,EAalB,IAbkB,EAclB,IAdkB,EAelB,OAfkB,EAgBlB,OAhBkB,EAiBlB,OAjBkB,EAkBlB,OAlBkB,EAmBlB,SAnBkB,EAoBlB,IApBkB,EAqBlB,IArBkB,EAsBlB,IAtBkB,EAuBlB,IAvBkB,EAwBlB,IAxBkB,EAyBlB,IAzBkB,EA0BlB,IA1BkB,EA2BlB,IA3BkB,EA4BlB,IA5BkB,EA6BlB,YA7BkB,EA8BlB,KA9BkB,EA+BlB,SA/BkB,CAApB;;AAkCA,WAASC,WAAT,GAAwB;AACtB,QAAIC,OAAO,GAAG,UAAUpV,OAAV,EAAmB;AAC/B,aAAOD,YAAY,CAACZ,OAAb,CAAqBa,OAAO,CAACN,GAAR,CAAY2V,SAAZ,CAAsB,KAAtB,CAArB,CAAP;AACD,KAFD;;AAGA,QAAI1W,QAAQ,GAAG,UAAUqB,OAAV,EAAmB;AAChC,aAAOqF,eAAe,CAACrF,OAAD,CAAf,CAAyBN,GAAhC;AACD,KAFD;;AAGA,QAAI4V,UAAU,GAAG,UAAUtV,OAAV,EAAmB;AAClC,UAAI,CAAC6E,SAAS,CAAC7E,OAAD,CAAd,EAAyB;AACvB,eAAO,KAAP;AACD;;AACD,UAAIpR,IAAI,CAACoR,OAAD,CAAJ,KAAkB,MAAtB,EAA8B;AAC5B,eAAO,IAAP;AACD;;AACD,aAAOxL,QAAQ,CAAC0gB,aAAD,EAAgBtmB,IAAI,CAACoR,OAAD,CAApB,CAAf;AACD,KARD;;AASA,QAAIuV,UAAU,GAAG,UAAUvV,OAAV,EAAmB;AAClC,UAAI,CAAC6E,SAAS,CAAC7E,OAAD,CAAd,EAAyB;AACvB,eAAO,KAAP;AACD;;AACD,aAAOxL,QAAQ,CAAC,CACd,IADc,EAEd,KAFc,EAGd,IAHc,EAId,OAJc,CAAD,EAKZ5F,IAAI,CAACoR,OAAD,CALQ,CAAf;AAMD,KAVD;;AAWA,QAAIwV,aAAa,GAAG,UAAUxV,OAAV,EAAmB;AACrC,aAAO6E,SAAS,CAAC7E,OAAD,CAAT,IAAsBoJ,KAAK,CAACpJ,OAAD,EAAU,iBAAV,CAAL,KAAsC,OAAnE;AACD,KAFD;;AAGA,QAAIyV,eAAe,GAAG,UAAUzV,OAAV,EAAmB0V,KAAnB,EAA0B;AAC9C,aAAO1V,OAAO,CAACN,GAAR,CAAY7B,uBAAZ,CAAoC6X,KAAK,CAAChW,GAA1C,CAAP;AACD,KAFD;;AAGA,QAAIiW,gBAAgB,GAAG,UAAU7K,MAAV,EAAkB8K,WAAlB,EAA+B;AACpD,UAAIC,EAAE,GAAGpM,KAAK,CAACqB,MAAD,CAAd;AACA5B,MAAAA,MAAM,CAAC0M,WAAD,EAAcC,EAAd,CAAN;AACD,KAHD;;AAIA,QAAIC,SAAS,GAAG,UAAU9V,OAAV,EAAmB;AACjC,UAAIX,GAAG,GAAGzQ,IAAI,CAACoR,OAAD,CAAd;AACA,aAAOxL,QAAQ,CAAC,CACd,QADc,EAEd,UAFc,EAGd,QAHc,EAId,UAJc,EAKd,SALc,EAMd,OANc,EAOd,OAPc,EAQd,UARc,EASd,KATc,CAAD,EAUZ6K,GAVY,CAAf;AAWD,KAbD;;AAcA,WAAO;AACL0W,MAAAA,EAAE,EAAErlB,QAAQ,CAAC;AACXuP,QAAAA,QAAQ,EAAE0I,UADC;AAEXN,QAAAA,OAAO,EAAES,SAFE;AAGXlB,QAAAA,SAAS,EAAEQ,QAHA;AAIXpX,QAAAA,GAAG,EAAE0U;AAJM,OAAD,CADP;AAOLsQ,MAAAA,IAAI,EAAEtlB,QAAQ,CAAC;AACbuP,QAAAA,QAAQ,EAAEiI,aADG;AAEbN,QAAAA,SAAS,EAAEE;AAFE,OAAD,CAPT;AAWL0C,MAAAA,MAAM,EAAE9Z,QAAQ,CAAC;AACfyF,QAAAA,GAAG,EAAEoU,KADU;AAEfI,QAAAA,MAAM,EAAEA,MAFO;AAGf1B,QAAAA,GAAG,EAAEmB,KAHU;AAIfb,QAAAA,MAAM,EAAEsB;AAJO,OAAD,CAXX;AAiBL1B,MAAAA,KAAK,EAAEzY,QAAQ,CAAC;AACdyF,QAAAA,GAAG,EAAEiT,KADS;AAEdH,QAAAA,GAAG,EAAEA,GAFS;AAGdM,QAAAA,MAAM,EAAEA,MAHM;AAId0M,QAAAA,MAAM,EAAEN;AAJM,OAAD,CAjBV;AAuBLO,MAAAA,MAAM,EAAExlB,QAAQ,CAAC;AACfwc,QAAAA,MAAM,EAAEA,MADO;AAEfC,QAAAA,KAAK,EAAEA,KAFQ;AAGfgJ,QAAAA,QAAQ,EAAE/B,OAHK;AAIfR,QAAAA,MAAM,EAAEA,MAJO;AAKfwC,QAAAA,SAAS,EAAE/B,QALI;AAMfR,QAAAA,OAAO,EAAEA,OANM;AAOfG,QAAAA,IAAI,EAAEA;AAPS,OAAD,CAvBX;AAgCLzK,MAAAA,MAAM,EAAE7Y,QAAQ,CAAC;AACfikB,QAAAA,MAAM,EAAEA,MADO;AAEfpL,QAAAA,MAAM,EAAEkL;AAFO,OAAD,CAhCX;AAoCL4B,MAAAA,MAAM,EAAE3lB,QAAQ,CAAC;AACfoI,QAAAA,EAAE,EAAEiH,YAAY,CAACX,OADF;AAEfqK,QAAAA,KAAK,EAAE2L,OAFQ;AAGf5V,QAAAA,IAAI,EAAEO,YAAY,CAACR;AAHJ,OAAD,CApCX;AAyCLjC,MAAAA,KAAK,EAAE5M,QAAQ,CAAC;AACd+kB,QAAAA,eAAe,EAAEA,eADH;AAEdzP,QAAAA,WAAW,EAAEA,WAFC;AAGdE,QAAAA,WAAW,EAAEA;AAHC,OAAD,CAzCV;AA8CL8D,MAAAA,QAAQ,EAAEtZ,QAAQ,CAAC;AACjByV,QAAAA,QAAQ,EAAEA,QADO;AAEjBvX,QAAAA,IAAI,EAAEA,IAFW;AAGjB4W,QAAAA,MAAM,EAAEA,MAHS;AAIjB7G,QAAAA,QAAQ,EAAEA,QAJO;AAKjBmG,QAAAA,MAAM,EAAEA,MALS;AAMjBF,QAAAA,SAAS,EAAEA,SANM;AAOjBC,QAAAA,SAAS,EAAEA,SAPM;AAQjBiR,QAAAA,SAAS,EAAEA,SARM;AASjBQ,QAAAA,OAAO,EAAEtB,KATQ;AAUjBuB,QAAAA,OAAO,EAAEtB,KAVQ;AAWjBK,QAAAA,UAAU,EAAEA,UAXK;AAYjBC,QAAAA,UAAU,EAAEA,UAZK;AAajBC,QAAAA,aAAa,EAAEA;AAbE,OAAD,CA9Cb;AA6DLtmB,MAAAA,EAAE,EAAE2R,IA7DC;AA8DLzO,MAAAA,EAAE,EAAEiP;AA9DC,KAAP;AAgED;;AAED,MAAImV,KAAK,GAAG,UAAUC,QAAV,EAAoBC,IAApB,EAA0BvC,QAA1B,EAAoChjB,CAApC,EAAuC;AACjD,QAAIiF,IAAI,GAAG+d,QAAQ,CAAC,CAAD,CAAnB;AACA,QAAIwC,IAAI,GAAGxC,QAAQ,CAAClgB,KAAT,CAAe,CAAf,CAAX;AACA,WAAO9C,CAAC,CAACslB,QAAD,EAAWC,IAAX,EAAiBtgB,IAAjB,EAAuBugB,IAAvB,CAAR;AACD,GAJD;;AAKA,MAAIC,MAAM,GAAG,UAAUH,QAAV,EAAoBC,IAApB,EAA0BvC,QAA1B,EAAoC;AAC/C,WAAOA,QAAQ,CAAC9jB,MAAT,GAAkB,CAAlB,GAAsBmmB,KAAK,CAACC,QAAD,EAAWC,IAAX,EAAiBvC,QAAjB,EAA2B0C,SAA3B,CAA3B,GAAmE9iB,QAAQ,CAACtC,IAAT,EAA1E;AACD,GAFD;;AAGA,MAAIolB,SAAS,GAAG,UAAUJ,QAAV,EAAoBC,IAApB,EAA0BtgB,IAA1B,EAAgCugB,IAAhC,EAAsC;AACpD,QAAIxc,KAAK,GAAGuc,IAAI,CAACD,QAAD,EAAWrgB,IAAX,CAAhB;AACA,WAAOf,KAAK,CAACshB,IAAD,EAAO,UAAU9iB,CAAV,EAAa1E,CAAb,EAAgB;AACjC,UAAIyK,OAAO,GAAG8c,IAAI,CAACD,QAAD,EAAWtnB,CAAX,CAAlB;AACA,aAAO2nB,aAAa,CAACL,QAAD,EAAW5iB,CAAX,EAAc+F,OAAd,CAApB;AACD,KAHW,EAGTO,KAHS,CAAZ;AAID,GAND;;AAOA,MAAI2c,aAAa,GAAG,UAAUL,QAAV,EAAoBtc,KAApB,EAA2B4c,GAA3B,EAAgC;AAClD,WAAO5c,KAAK,CAACpH,IAAN,CAAW,UAAUW,CAAV,EAAa;AAC7B,aAAOqjB,GAAG,CAAC7jB,MAAJ,CAAWtC,KAAK,CAAC6lB,QAAQ,CAACvnB,EAAV,EAAcwE,CAAd,CAAhB,CAAP;AACD,KAFM,CAAP;AAGD,GAJD;;AAMA,MAAIsjB,IAAI,GAAG,UAAUP,QAAV,EAAoB9H,IAApB,EAA0B;AACnC,WAAO/d,KAAK,CAAC6lB,QAAQ,CAACvnB,EAAV,EAAcyf,IAAd,CAAZ;AACD,GAFD;;AAGA,MAAIsI,WAAW,GAAG,UAAUR,QAAV,EAAoBtc,KAApB,EAA2B4c,GAA3B,EAAgCpR,MAAhC,EAAwC;AACxD,QAAIA,MAAM,KAAK,KAAK,CAApB,EAAuB;AACrBA,MAAAA,MAAM,GAAGpU,KAAT;AACD;;AACD,QAAI2lB,GAAG,GAAG,CAAC/c,KAAD,EAAQlJ,MAAR,CAAewlB,QAAQ,CAACV,EAAT,GAAc/kB,GAAd,CAAkBmJ,KAAlB,CAAf,CAAV;AACA,QAAIgd,GAAG,GAAG,CAACJ,GAAD,EAAM9lB,MAAN,CAAawlB,QAAQ,CAACV,EAAT,GAAc/kB,GAAd,CAAkB+lB,GAAlB,CAAb,CAAV;;AACA,QAAIK,KAAK,GAAG,UAAUC,IAAV,EAAgB;AAC1B,UAAIhR,KAAK,GAAG1Q,SAAS,CAAC0hB,IAAD,EAAO1R,MAAP,CAArB;AACA,aAAOU,KAAK,CAACnU,IAAN,CAAW,YAAY;AAC5B,eAAOmlB,IAAP;AACD,OAFM,EAEJ,UAAUC,GAAV,EAAe;AAChB,eAAOD,IAAI,CAACpjB,KAAL,CAAW,CAAX,EAAcqjB,GAAG,GAAG,CAApB,CAAP;AACD,OAJM,CAAP;AAKD,KAPD;;AAQA,QAAIC,OAAO,GAAGH,KAAK,CAACF,GAAD,CAAnB;AACA,QAAIM,OAAO,GAAGJ,KAAK,CAACD,GAAD,CAAnB;AACA,QAAIM,MAAM,GAAG/hB,IAAI,CAAC6hB,OAAD,EAAU,UAAUjpB,CAAV,EAAa;AACtC,aAAO0E,MAAM,CAACwkB,OAAD,EAAUR,IAAI,CAACP,QAAD,EAAWnoB,CAAX,CAAd,CAAb;AACD,KAFgB,CAAjB;AAGA,WAAO;AACLopB,MAAAA,SAAS,EAAEH,OADN;AAELI,MAAAA,UAAU,EAAEH,OAFP;AAGLC,MAAAA,MAAM,EAAEA;AAHH,KAAP;AAKD,GAxBD;;AA0BA,MAAIG,SAAS,GAAGhB,MAAhB;AACA,MAAIiB,WAAW,GAAGZ,WAAlB;AAEA,MAAIR,QAAQ,GAAGtB,WAAW,EAA1B;;AACA,MAAI2C,WAAW,GAAG,UAAUpB,IAAV,EAAgBvC,QAAhB,EAA0B;AAC1C,WAAOyD,SAAS,CAACnB,QAAD,EAAW,UAAUsB,SAAV,EAAqB/X,OAArB,EAA8B;AACvD,aAAO0W,IAAI,CAAC1W,OAAD,CAAX;AACD,KAFe,EAEbmU,QAFa,CAAhB;AAGD,GAJD;;AAKA,MAAI6D,WAAW,GAAG,UAAU7d,KAAV,EAAiBiY,MAAjB,EAAyBzM,MAAzB,EAAiC;AACjD,WAAOkS,WAAW,CAACpB,QAAD,EAAWtc,KAAX,EAAkBiY,MAAlB,EAA0BzM,MAA1B,CAAlB;AACD,GAFD;;AAIA,MAAIsS,WAAW,GAAG,UAAUC,SAAV,EAAqB;AACrC,WAAOvP,UAAU,CAACuP,SAAD,EAAY,OAAZ,CAAjB;AACD,GAFD;;AAGA,MAAIC,QAAQ,GAAG,UAAUhe,KAAV,EAAiBiY,MAAjB,EAAyBzM,MAAzB,EAAiC;AAC9C,QAAIyS,SAAS,GAAG,UAAUC,SAAV,EAAqB;AACnC,aAAO,UAAUrY,OAAV,EAAmB;AACxB,eAAO2F,MAAM,KAAKlW,SAAX,IAAwBkW,MAAM,CAAC3F,OAAD,CAA9B,IAA2Ca,IAAI,CAACb,OAAD,EAAUqY,SAAV,CAAtD;AACD,OAFD;AAGD,KAJD;;AAKA,QAAIxX,IAAI,CAAC1G,KAAD,EAAQiY,MAAR,CAAR,EAAyB;AACvB,aAAOre,QAAQ,CAACR,IAAT,CAAc;AACnB+kB,QAAAA,KAAK,EAAEvkB,QAAQ,CAACR,IAAT,CAAc,CAAC4G,KAAD,CAAd,CADY;AAEnBA,QAAAA,KAAK,EAAEA,KAFY;AAGnBiY,QAAAA,MAAM,EAAEA;AAHW,OAAd,CAAP;AAKD,KAND,MAMO;AACL,aAAO6F,WAAW,CAAC9d,KAAD,CAAX,CAAmBpH,IAAnB,CAAwB,UAAUwlB,UAAV,EAAsB;AACnD,eAAON,WAAW,CAAC7F,MAAD,CAAX,CAAoBrf,IAApB,CAAyB,UAAUylB,WAAV,EAAuB;AACrD,cAAI3X,IAAI,CAAC0X,UAAD,EAAaC,WAAb,CAAR,EAAmC;AACjC,mBAAOzkB,QAAQ,CAACR,IAAT,CAAc;AACnB+kB,cAAAA,KAAK,EAAEvF,YAAY,CAACwF,UAAD,EAAape,KAAb,EAAoBiY,MAApB,CADA;AAEnBjY,cAAAA,KAAK,EAAEA,KAFY;AAGnBiY,cAAAA,MAAM,EAAEA;AAHW,aAAd,CAAP;AAKD,WAND,MAMO,IAAIhR,UAAU,CAACmX,UAAD,EAAaC,WAAb,CAAd,EAAyC;AAC9C,gBAAIC,aAAa,GAAGzQ,WAAW,CAACoK,MAAD,EAAS,OAAT,EAAkBgG,SAAS,CAACG,UAAD,CAA3B,CAA/B;AACA,gBAAI7G,UAAU,GAAG+G,aAAa,CAACpoB,MAAd,GAAuB,CAAvB,GAA2BooB,aAAa,CAACA,aAAa,CAACpoB,MAAd,GAAuB,CAAxB,CAAxC,GAAqE+hB,MAAtF;AACA,mBAAOre,QAAQ,CAACR,IAAT,CAAc;AACnB+kB,cAAAA,KAAK,EAAErF,gBAAgB,CAACsF,UAAD,EAAape,KAAb,EAAoBoe,UAApB,EAAgCnG,MAAhC,EAAwCoG,WAAxC,CADJ;AAEnBre,cAAAA,KAAK,EAAEA,KAFY;AAGnBiY,cAAAA,MAAM,EAAEV;AAHW,aAAd,CAAP;AAKD,WARM,MAQA,IAAItQ,UAAU,CAACoX,WAAD,EAAcD,UAAd,CAAd,EAAyC;AAC9C,gBAAIE,aAAa,GAAGzQ,WAAW,CAAC7N,KAAD,EAAQ,OAAR,EAAiBie,SAAS,CAACI,WAAD,CAA1B,CAA/B;AACA,gBAAI/G,SAAS,GAAGgH,aAAa,CAACpoB,MAAd,GAAuB,CAAvB,GAA2BooB,aAAa,CAACA,aAAa,CAACpoB,MAAd,GAAuB,CAAxB,CAAxC,GAAqE8J,KAArF;AACA,mBAAOpG,QAAQ,CAACR,IAAT,CAAc;AACnB+kB,cAAAA,KAAK,EAAErF,gBAAgB,CAACuF,WAAD,EAAcre,KAAd,EAAqBoe,UAArB,EAAiCnG,MAAjC,EAAyCoG,WAAzC,CADJ;AAEnBre,cAAAA,KAAK,EAAEA,KAFY;AAGnBiY,cAAAA,MAAM,EAAEX;AAHW,aAAd,CAAP;AAKD,WARM,MAQA;AACL,mBAAOuG,WAAW,CAAC7d,KAAD,EAAQiY,MAAR,CAAX,CAA2BqF,MAA3B,CAAkC1kB,IAAlC,CAAuC,UAAU2lB,GAAV,EAAe;AAC3D,qBAAO5P,SAAS,CAAC4P,GAAD,EAAM,OAAN,EAAe/S,MAAf,CAAT,CAAgC5S,IAAhC,CAAqC,UAAU4lB,QAAV,EAAoB;AAC9D,oBAAIC,mBAAmB,GAAG5Q,WAAW,CAACoK,MAAD,EAAS,OAAT,EAAkBgG,SAAS,CAACO,QAAD,CAA3B,CAArC;AACA,oBAAIjH,UAAU,GAAGkH,mBAAmB,CAACvoB,MAApB,GAA6B,CAA7B,GAAiCuoB,mBAAmB,CAACA,mBAAmB,CAACvoB,MAApB,GAA6B,CAA9B,CAApD,GAAuF+hB,MAAxG;AACA,oBAAIyG,kBAAkB,GAAG7Q,WAAW,CAAC7N,KAAD,EAAQ,OAAR,EAAiBie,SAAS,CAACO,QAAD,CAA1B,CAApC;AACA,oBAAIlH,SAAS,GAAGoH,kBAAkB,CAACxoB,MAAnB,GAA4B,CAA5B,GAAgCwoB,kBAAkB,CAACA,kBAAkB,CAACxoB,MAAnB,GAA4B,CAA7B,CAAlD,GAAoF8J,KAApG;AACA,uBAAOpG,QAAQ,CAACR,IAAT,CAAc;AACnB+kB,kBAAAA,KAAK,EAAErF,gBAAgB,CAAC0F,QAAD,EAAWxe,KAAX,EAAkBoe,UAAlB,EAA8BnG,MAA9B,EAAsCoG,WAAtC,CADJ;AAEnBre,kBAAAA,KAAK,EAAEsX,SAFY;AAGnBW,kBAAAA,MAAM,EAAEV;AAHW,iBAAd,CAAP;AAKD,eAVM,CAAP;AAWD,aAZM,CAAP;AAaD;AACF,SAtCM,CAAP;AAuCD,OAxCM,CAAP;AAyCD;AACF,GAvDD;;AAwDA,MAAIoH,QAAQ,GAAG,UAAUZ,SAAV,EAAqBjY,QAArB,EAA+B;AAC5C,QAAI8Y,IAAI,GAAG7Q,aAAa,CAACgQ,SAAD,EAAYjY,QAAZ,CAAxB;AACA,WAAO8Y,IAAI,CAAC1oB,MAAL,GAAc,CAAd,GAAkB0D,QAAQ,CAACR,IAAT,CAAcwlB,IAAd,CAAlB,GAAwChlB,QAAQ,CAACtC,IAAT,EAA/C;AACD,GAHD;;AAIA,MAAIunB,OAAO,GAAG,UAAUV,KAAV,EAAiBW,oBAAjB,EAAuC;AACnD,WAAOvjB,IAAI,CAAC4iB,KAAD,EAAQ,UAAUY,GAAV,EAAe;AAChC,aAAO9mB,EAAE,CAAC8mB,GAAD,EAAMD,oBAAN,CAAT;AACD,KAFU,CAAX;AAGD,GAJD;;AAKA,MAAIE,QAAQ,GAAG,UAAUjB,SAAV,EAAqBkB,qBAArB,EAA4CH,oBAA5C,EAAkE;AAC/E,WAAOpQ,YAAY,CAACqP,SAAD,EAAYkB,qBAAZ,CAAZ,CAA+CrmB,IAA/C,CAAoD,UAAUigB,KAAV,EAAiB;AAC1E,aAAOnK,YAAY,CAACqP,SAAD,EAAYe,oBAAZ,CAAZ,CAA8ClmB,IAA9C,CAAmD,UAAUsD,IAAV,EAAgB;AACxE,eAAOyhB,WAAW,CAACG,WAAD,EAAc,CAC9BjF,KAD8B,EAE9B3c,IAF8B,CAAd,CAAX,CAGJxD,GAHI,CAGA,UAAUwZ,KAAV,EAAiB;AACtB,iBAAO;AACL2G,YAAAA,KAAK,EAAEA,KADF;AAEL3c,YAAAA,IAAI,EAAEA,IAFD;AAGLgW,YAAAA,KAAK,EAAEA;AAHF,WAAP;AAKD,SATM,CAAP;AAUD,OAXM,CAAP;AAYD,KAbM,CAAP;AAcD,GAfD;;AAgBA,MAAIgN,QAAQ,GAAG,UAAUjH,MAAV,EAAkBgH,qBAAlB,EAAyC;AACtD,WAAOzQ,UAAU,CAACyJ,MAAD,EAAS,OAAT,CAAV,CAA4Brf,IAA5B,CAAiC,UAAUsZ,KAAV,EAAiB;AACvD,aAAOxD,YAAY,CAACwD,KAAD,EAAQ+M,qBAAR,CAAZ,CAA2CrmB,IAA3C,CAAgD,UAAUoH,KAAV,EAAiB;AACtE,eAAOge,QAAQ,CAAChe,KAAD,EAAQiY,MAAR,CAAR,CAAwBrf,IAAxB,CAA6B,UAAUumB,UAAV,EAAsB;AACxD,iBAAOA,UAAU,CAAChB,KAAX,CAAiBzlB,GAAjB,CAAqB,UAAUylB,KAAV,EAAiB;AAC3C,mBAAO;AACLA,cAAAA,KAAK,EAAEA,KADF;AAELne,cAAAA,KAAK,EAAEmf,UAAU,CAACnf,KAFb;AAGLiY,cAAAA,MAAM,EAAEkH,UAAU,CAAClH;AAHd,aAAP;AAKD,WANM,CAAP;AAOD,SARM,CAAP;AASD,OAVM,CAAP;AAWD,KAZM,CAAP;AAaD,GAdD;;AAeA,MAAImH,cAAc,GAAG,UAAUjB,KAAV,EAAiB1F,QAAjB,EAA2BC,WAA3B,EAAwCuG,qBAAxC,EAA+DH,oBAA/D,EAAqF;AACxG,WAAOD,OAAO,CAACV,KAAD,EAAQW,oBAAR,CAAP,CAAqClmB,IAArC,CAA0C,UAAUsD,IAAV,EAAgB;AAC/D,aAAOsc,QAAQ,CAACtc,IAAD,EAAOuc,QAAP,EAAiBC,WAAjB,CAAR,CAAsC9f,IAAtC,CAA2C,UAAUqf,MAAV,EAAkB;AAClE,eAAOiH,QAAQ,CAACjH,MAAD,EAASgH,qBAAT,CAAf;AACD,OAFM,CAAP;AAGD,KAJM,CAAP;AAKD,GAND;;AAQA,MAAII,UAAU,GAAG,UAAUtB,SAAV,EAAqBjY,QAArB,EAA+B;AAC9C,WAAO6Y,QAAQ,CAACZ,SAAD,EAAYjY,QAAZ,CAAf;AACD,GAFD;;AAGA,MAAIwZ,WAAW,GAAG,UAAUvB,SAAV,EAAqBkB,qBAArB,EAA4CH,oBAA5C,EAAkE;AAClF,WAAOE,QAAQ,CAACjB,SAAD,EAAYkB,qBAAZ,EAAmCH,oBAAnC,CAAR,CAAiElmB,IAAjE,CAAsE,UAAU2mB,KAAV,EAAiB;AAC5F,UAAI/T,MAAM,GAAG,UAAUyC,QAAV,EAAoB;AAC/B,eAAOvH,IAAI,CAACqX,SAAD,EAAY9P,QAAZ,CAAX;AACD,OAFD;;AAGA,UAAIuR,eAAe,GAAG,yBAAtB;AACA,UAAIC,aAAa,GAAGjR,UAAU,CAAC+Q,KAAK,CAAC1G,KAAP,EAAc2G,eAAd,EAA+BhU,MAA/B,CAA9B;AACA,UAAIkU,YAAY,GAAGlR,UAAU,CAAC+Q,KAAK,CAACrjB,IAAP,EAAasjB,eAAb,EAA8BhU,MAA9B,CAA7B;AACA,aAAOiU,aAAa,CAAC7mB,IAAd,CAAmB,UAAU+mB,EAAV,EAAc;AACtC,eAAOD,YAAY,CAAC9mB,IAAb,CAAkB,UAAUgnB,EAAV,EAAc;AACrC,iBAAOlZ,IAAI,CAACiZ,EAAD,EAAKC,EAAL,CAAJ,GAAexG,QAAQ,CAACmG,KAAK,CAACrN,KAAP,EAAcqN,KAAK,CAAC1G,KAApB,EAA2B0G,KAAK,CAACrjB,IAAjC,CAAvB,GAAgEtC,QAAQ,CAACtC,IAAT,EAAvE;AACD,SAFM,CAAP;AAGD,OAJM,CAAP;AAKD,KAZM,CAAP;AAaD,GAdD;;AAgBA,MAAIuoB,UAAU,GAAG,UAAUC,KAAV,EAAiB;AAChC,QAAI,CAAC3qB,OAAO,CAAC2qB,KAAD,CAAZ,EAAqB;AACnB,YAAM,IAAI3oB,KAAJ,CAAU,wBAAV,CAAN;AACD;;AACD,QAAI2oB,KAAK,CAAC5pB,MAAN,KAAiB,CAArB,EAAwB;AACtB,YAAM,IAAIiB,KAAJ,CAAU,iCAAV,CAAN;AACD;;AACD,QAAI4oB,YAAY,GAAG,EAAnB;AACA,QAAIC,GAAG,GAAG,EAAV;AACArnB,IAAAA,IAAI,CAACmnB,KAAD,EAAQ,UAAUG,KAAV,EAAiBC,KAAjB,EAAwB;AAClC,UAAIC,MAAM,GAAGhZ,IAAI,CAAC8Y,KAAD,CAAjB;;AACA,UAAIE,MAAM,CAACjqB,MAAP,KAAkB,CAAtB,EAAyB;AACvB,cAAM,IAAIiB,KAAJ,CAAU,gCAAV,CAAN;AACD;;AACD,UAAIgR,GAAG,GAAGgY,MAAM,CAAC,CAAD,CAAhB;AACA,UAAItrB,KAAK,GAAGorB,KAAK,CAAC9X,GAAD,CAAjB;;AACA,UAAI6X,GAAG,CAAC7X,GAAD,CAAH,KAAa7S,SAAjB,EAA4B;AAC1B,cAAM,IAAI6B,KAAJ,CAAU,4BAA4BgR,GAAtC,CAAN;AACD,OAFD,MAEO,IAAIA,GAAG,KAAK,MAAZ,EAAoB;AACzB,cAAM,IAAIhR,KAAJ,CAAU,uCAAV,CAAN;AACD,OAFM,MAEA,IAAI,CAAChC,OAAO,CAACN,KAAD,CAAZ,EAAqB;AAC1B,cAAM,IAAIsC,KAAJ,CAAU,iCAAV,CAAN;AACD;;AACD4oB,MAAAA,YAAY,CAAC7lB,IAAb,CAAkBiO,GAAlB;;AACA6X,MAAAA,GAAG,CAAC7X,GAAD,CAAH,GAAW,YAAY;AACrB,YAAIpS,IAAI,GAAG,EAAX;;AACA,aAAK,IAAIC,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAACC,MAAhC,EAAwCF,EAAE,EAA1C,EAA8C;AAC5CD,UAAAA,IAAI,CAACC,EAAD,CAAJ,GAAWC,SAAS,CAACD,EAAD,CAApB;AACD;;AACD,YAAIoqB,SAAS,GAAGrqB,IAAI,CAACG,MAArB;;AACA,YAAIkqB,SAAS,KAAKvrB,KAAK,CAACqB,MAAxB,EAAgC;AAC9B,gBAAM,IAAIiB,KAAJ,CAAU,uCAAuCgR,GAAvC,GAA6C,aAA7C,GAA6DtT,KAAK,CAACqB,MAAnE,GAA4E,IAA5E,GAAmFrB,KAAnF,GAA2F,SAA3F,GAAuGurB,SAAjH,CAAN;AACD;;AACD,YAAIzc,KAAK,GAAG,UAAU0c,QAAV,EAAoB;AAC9B,cAAIC,UAAU,GAAGnZ,IAAI,CAACkZ,QAAD,CAArB;;AACA,cAAIN,YAAY,CAAC7pB,MAAb,KAAwBoqB,UAAU,CAACpqB,MAAvC,EAA+C;AAC7C,kBAAM,IAAIiB,KAAJ,CAAU,mDAAmD4oB,YAAY,CAAChO,IAAb,CAAkB,GAAlB,CAAnD,GAA4E,YAA5E,GAA2FuO,UAAU,CAACvO,IAAX,CAAgB,GAAhB,CAArG,CAAN;AACD;;AACD,cAAIwO,OAAO,GAAGznB,MAAM,CAACinB,YAAD,EAAe,UAAUS,MAAV,EAAkB;AACnD,mBAAOnmB,QAAQ,CAACimB,UAAD,EAAaE,MAAb,CAAf;AACD,WAFmB,CAApB;;AAGA,cAAI,CAACD,OAAL,EAAc;AACZ,kBAAM,IAAIppB,KAAJ,CAAU,kEAAkEmpB,UAAU,CAACvO,IAAX,CAAgB,IAAhB,CAAlE,GAA0F,cAA1F,GAA2GgO,YAAY,CAAChO,IAAb,CAAkB,IAAlB,CAArH,CAAN;AACD;;AACD,iBAAOsO,QAAQ,CAAClY,GAAD,CAAR,CAAchS,KAAd,CAAoB,IAApB,EAA0BJ,IAA1B,CAAP;AACD,SAZD;;AAaA,eAAO;AACLgC,UAAAA,IAAI,EAAE,YAAY;AAChB,gBAAI0oB,QAAQ,GAAG,EAAf;;AACA,iBAAK,IAAIzqB,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAACC,MAAhC,EAAwCF,EAAE,EAA1C,EAA8C;AAC5CyqB,cAAAA,QAAQ,CAACzqB,EAAD,CAAR,GAAeC,SAAS,CAACD,EAAD,CAAxB;AACD;;AACD,gBAAIyqB,QAAQ,CAACvqB,MAAT,KAAoB4pB,KAAK,CAAC5pB,MAA9B,EAAsC;AACpC,oBAAM,IAAIiB,KAAJ,CAAU,iDAAiD2oB,KAAK,CAAC5pB,MAAvD,GAAgE,QAAhE,GAA2EuqB,QAAQ,CAACvqB,MAA9F,CAAN;AACD;;AACD,gBAAIyK,MAAM,GAAG8f,QAAQ,CAACP,KAAD,CAArB;AACA,mBAAOvf,MAAM,CAACxK,KAAP,CAAa,IAAb,EAAmBJ,IAAnB,CAAP;AACD,WAXI;AAYL4N,UAAAA,KAAK,EAAEA,KAZF;AAaL+c,UAAAA,GAAG,EAAE,UAAUC,KAAV,EAAiB;AACpB7b,YAAAA,OAAO,CAAC4b,GAAR,CAAYC,KAAZ,EAAmB;AACjBZ,cAAAA,YAAY,EAAEA,YADG;AAEjBvrB,cAAAA,WAAW,EAAE2T,GAFI;AAGjByY,cAAAA,MAAM,EAAE7qB;AAHS,aAAnB;AAKD;AAnBI,SAAP;AAqBD,OA3CD;AA4CD,KA3DG,CAAJ;AA4DA,WAAOiqB,GAAP;AACD,GAtED;;AAuEA,MAAIa,GAAG,GAAG;AAAE7L,IAAAA,QAAQ,EAAE6K;AAAZ,GAAV;AAEA,MAAIiB,MAAM,GAAGD,GAAG,CAAC7L,QAAJ,CAAa,CACxB;AAAE1d,IAAAA,IAAI,EAAE;AAAR,GADwB,EAExB;AAAEypB,IAAAA,QAAQ,EAAE,CAAC,UAAD;AAAZ,GAFwB,EAGxB;AAAEC,IAAAA,MAAM,EAAE,CAAC,SAAD;AAAV,GAHwB,CAAb,CAAb;;AAKA,MAAIC,IAAI,GAAG,UAAUC,OAAV,EAAmBC,MAAnB,EAA2BC,UAA3B,EAAuCC,QAAvC,EAAiD;AAC1D,WAAOH,OAAO,CAACnpB,IAAR,CAAaopB,MAAb,EAAqBC,UAArB,EAAiCC,QAAjC,CAAP;AACD,GAFD;;AAGA,MAAIC,MAAM,GAAGR,MAAM,CAACxpB,IAApB;AACA,MAAIypB,QAAQ,GAAGD,MAAM,CAACC,QAAtB;AACA,MAAIC,MAAM,GAAGF,MAAM,CAACE,MAApB;;AAEA,MAAIO,UAAU,GAAG,UAAUC,QAAV,EAAoBC,QAApB,EAA8BC,gBAA9B,EAAgD;AAC/D,QAAI1lB,GAAG,GAAG,YAAY;AACpB,aAAOqjB,UAAU,CAACmC,QAAQ,EAAT,EAAaE,gBAAb,CAAV,CAAyC3pB,IAAzC,CAA8C,YAAY;AAC/D,eAAO0pB,QAAQ,GAAG/oB,GAAX,CAAesoB,MAAf,EAAuB5oB,UAAvB,CAAkCkpB,MAAlC,CAAP;AACD,OAFM,EAEJ,UAAU9X,KAAV,EAAiB;AAClB,eAAOuX,QAAQ,CAACvX,KAAD,CAAf;AACD,OAJM,CAAP;AAKD,KAND;;AAOA,WAAO;AAAExN,MAAAA,GAAG,EAAEA;AAAP,KAAP;AACD,GATD;;AAWA,MAAI2lB,MAAM,GAAGC,OAAO,CAACC,IAAR,CAAaC,KAAb,CAAmBC,OAAnB,CAA2B,uBAA3B,CAAb;;AAEA,MAAI9G,OAAO,GAAG,UAAU+G,QAAV,EAAoBC,MAApB,EAA4B;AACxC,WAAOrc,YAAY,CAACZ,OAAb,CAAqBgd,QAAQ,CAACzc,GAAT,CAAa2V,SAAb,CAAuB+G,MAAvB,CAArB,CAAP;AACD,GAFD;;AAGA,MAAIC,OAAO,GAAG,UAAUF,QAAV,EAAoB;AAChC,WAAO/G,OAAO,CAAC+G,QAAD,EAAW,KAAX,CAAd;AACD,GAFD;;AAGA,MAAIG,IAAI,GAAG,UAAUH,QAAV,EAAoB;AAC7B,WAAO/G,OAAO,CAAC+G,QAAD,EAAW,IAAX,CAAd;AACD,GAFD;;AAGA,MAAII,SAAS,GAAG,UAAUJ,QAAV,EAAoB9c,GAApB,EAAyB;AACvC,QAAIvG,EAAE,GAAGiH,YAAY,CAACX,OAAb,CAAqBC,GAArB,CAAT;AACA,QAAIqK,UAAU,GAAGD,KAAK,CAAC0S,QAAD,CAAtB;AACAjT,IAAAA,MAAM,CAACpQ,EAAD,EAAK4Q,UAAL,CAAN;AACA,WAAO5Q,EAAP;AACD,GALD;;AAMA,MAAI0jB,MAAM,GAAG,UAAUL,QAAV,EAAoB9c,GAApB,EAAyB;AACpC,QAAIvG,EAAE,GAAGyjB,SAAS,CAACJ,QAAD,EAAW9c,GAAX,CAAlB;AACA,QAAIod,aAAa,GAAGtW,QAAQ,CAACmW,IAAI,CAACH,QAAD,CAAL,CAA5B;AACA9H,IAAAA,QAAQ,CAACvb,EAAD,EAAK2jB,aAAL,CAAR;AACA,WAAO3jB,EAAP;AACD,GALD;;AAOA,MAAI4jB,GAAG,GAAG,UAAUtnB,GAAV,EAAe;AACvB,QAAIL,CAAC,GAAG,EAAR;;AACA,QAAIV,IAAI,GAAG,UAAU/F,CAAV,EAAa;AACtByG,MAAAA,CAAC,CAACV,IAAF,CAAO/F,CAAP;AACD,KAFD;;AAGA,SAAK,IAAIqG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGS,GAAG,CAAC/E,MAAxB,EAAgCsE,CAAC,EAAjC,EAAqC;AACnCS,MAAAA,GAAG,CAACT,CAAD,CAAH,CAAO7B,IAAP,CAAYuB,IAAZ;AACD;;AACD,WAAOU,CAAP;AACD,GATD;;AAUA,MAAI4nB,KAAK,GAAG,UAAUC,EAAV,EAAcC,EAAd,EAAkB1rB,CAAlB,EAAqB;AAC/B,WAAOyrB,EAAE,CAACvqB,MAAH,MAAewqB,EAAE,CAACxqB,MAAH,EAAf,GAA6B0B,QAAQ,CAACR,IAAT,CAAcpC,CAAC,CAACyrB,EAAE,CAACpqB,QAAH,EAAD,EAAgBqqB,EAAE,CAACrqB,QAAH,EAAhB,CAAf,CAA7B,GAA8EuB,QAAQ,CAACtC,IAAT,EAArF;AACD,GAFD;;AAGA,MAAIqrB,QAAQ,GAAG,UAAU3tB,CAAV,EAAagC,CAAb,EAAgB;AAC7B,WAAOhC,CAAC,KAAKM,SAAN,IAAmBN,CAAC,KAAK,IAAzB,GAAgCgC,CAAC,CAAChC,CAAD,CAAjC,GAAuC4E,QAAQ,CAACtC,IAAT,EAA9C;AACD,GAFD;;AAGA,MAAIsrB,MAAM,GAAG,UAAUlpB,CAAV,EAAa1E,CAAb,EAAgB;AAC3B,WAAO0E,CAAC,GAAGE,QAAQ,CAACR,IAAT,CAAcpE,CAAd,CAAH,GAAsB4E,QAAQ,CAACtC,IAAT,EAA9B;AACD,GAFD;;AAIA,MAAIurB,SAAS,GAAG,UAAUpuB,IAAV,EAAgBquB,SAAhB,EAA2B;AACzC,QAAIhU,GAAG,GAAG,UAAUjJ,OAAV,EAAmBkd,CAAnB,EAAsB;AAC9B,UAAI,CAACrtB,QAAQ,CAACqtB,CAAD,CAAT,IAAgB,CAACA,CAAC,CAACpf,KAAF,CAAQ,UAAR,CAArB,EAA0C;AACxC,cAAM,IAAIxM,KAAJ,CAAU1C,IAAI,GAAG,uDAAP,GAAiEsuB,CAA3E,CAAN;AACD;;AACD,UAAIxd,GAAG,GAAGM,OAAO,CAACN,GAAlB;;AACA,UAAIkK,aAAa,CAAClK,GAAD,CAAjB,EAAwB;AACtBA,QAAAA,GAAG,CAACmK,KAAJ,CAAUjb,IAAV,IAAkBsuB,CAAC,GAAG,IAAtB;AACD;AACF,KARD;;AASA,QAAI/mB,GAAG,GAAG,UAAU6J,OAAV,EAAmB;AAC3B,UAAIjL,CAAC,GAAGkoB,SAAS,CAACjd,OAAD,CAAjB;;AACA,UAAIjL,CAAC,IAAI,CAAL,IAAUA,CAAC,KAAK,IAApB,EAA0B;AACxB,YAAIuV,GAAG,GAAGC,KAAK,CAACvK,OAAD,EAAUpR,IAAV,CAAf;AACA,eAAOuuB,UAAU,CAAC7S,GAAD,CAAV,IAAmB,CAA1B;AACD;;AACD,aAAOvV,CAAP;AACD,KAPD;;AAQA,QAAIqoB,QAAQ,GAAGjnB,GAAf;;AACA,QAAIknB,SAAS,GAAG,UAAUrd,OAAV,EAAmBsd,UAAnB,EAA+B;AAC7C,aAAO/nB,KAAK,CAAC+nB,UAAD,EAAa,UAAUhoB,GAAV,EAAe0U,QAAf,EAAyB;AAChD,YAAIuT,GAAG,GAAGhT,KAAK,CAACvK,OAAD,EAAUgK,QAAV,CAAf;AACA,YAAIhb,KAAK,GAAGuuB,GAAG,KAAK9tB,SAAR,GAAoB,CAApB,GAAwB4b,QAAQ,CAACkS,GAAD,EAAM,EAAN,CAA5C;AACA,eAAOC,KAAK,CAACxuB,KAAD,CAAL,GAAesG,GAAf,GAAqBA,GAAG,GAAGtG,KAAlC;AACD,OAJW,EAIT,CAJS,CAAZ;AAKD,KAND;;AAOA,QAAIkhB,GAAG,GAAG,UAAUlQ,OAAV,EAAmBhR,KAAnB,EAA0BsuB,UAA1B,EAAsC;AAC9C,UAAIG,oBAAoB,GAAGJ,SAAS,CAACrd,OAAD,EAAUsd,UAAV,CAApC;AACA,UAAII,WAAW,GAAG1uB,KAAK,GAAGyuB,oBAAR,GAA+BzuB,KAAK,GAAGyuB,oBAAvC,GAA8D,CAAhF;AACA,aAAOC,WAAP;AACD,KAJD;;AAKA,WAAO;AACLzU,MAAAA,GAAG,EAAEA,GADA;AAEL9S,MAAAA,GAAG,EAAEA,GAFA;AAGLinB,MAAAA,QAAQ,EAAEA,QAHL;AAILC,MAAAA,SAAS,EAAEA,SAJN;AAKLnN,MAAAA,GAAG,EAAEA;AALA,KAAP;AAOD,GAtCD;;AAwCA,MAAIyN,KAAK,GAAGX,SAAS,CAAC,OAAD,EAAU,UAAUhd,OAAV,EAAmB;AAChD,WAAOA,OAAO,CAACN,GAAR,CAAYke,WAAnB;AACD,GAFoB,CAArB;;AAGA,MAAIC,KAAK,GAAG,UAAU7d,OAAV,EAAmB;AAC7B,WAAO2d,KAAK,CAACxnB,GAAN,CAAU6J,OAAV,CAAP;AACD,GAFD;;AAGA,MAAIod,QAAQ,GAAG,UAAUpd,OAAV,EAAmB;AAChC,WAAO2d,KAAK,CAACP,QAAN,CAAepd,OAAf,CAAP;AACD,GAFD;;AAIA,MAAI8d,SAAS,GAAG,UAAUtP,SAAV,EAAqBuP,WAArB,EAAkC;AAChD,QAAIA,WAAW,KAAK,KAAK,CAAzB,EAA4B;AAC1BA,MAAAA,WAAW,GAAGvsB,MAAd;AACD;;AACD,QAAIqR,IAAI,GAAG2L,SAAS,CAAC3L,IAArB;AACA,QAAIgL,IAAI,GAAGhZ,KAAK,CAACgO,IAAI,CAACE,OAAN,EAAepS,QAAf,CAAhB;AACA,QAAIqtB,OAAO,GAAGnpB,KAAK,CAACgO,IAAI,CAACC,IAAN,EAAYnS,QAAZ,CAAnB;AACA,WAAOkC,GAAG,CAACgb,IAAD,EAAO,UAAUoQ,GAAV,EAAe;AAC9B,UAAIC,QAAQ,GAAG,YAAY;AACzB,eAAOnrB,IAAI,CAACirB,OAAD,EAAU,UAAUjpB,CAAV,EAAa;AAChC,iBAAO2b,SAAS,CAACnC,KAAV,CAAgBC,SAAhB,EAA2BzZ,CAA3B,EAA8BkpB,GAA9B,EAAmC/qB,MAAnC,CAA0C,UAAUiQ,MAAV,EAAkB;AACjE,mBAAOA,MAAM,CAACD,MAAP,KAAkB+a,GAAzB;AACD,WAFM,EAEJ5qB,OAFI,EAAP;AAGD,SAJU,CAAX;AAKD,OAND;;AAOA,UAAI8qB,OAAO,GAAG,UAAUhb,MAAV,EAAkB;AAC9B,eAAOA,MAAM,CAACE,OAAP,KAAmB,CAAnB,IAAwB0a,WAAW,CAAC5a,MAAM,CAACnD,OAAR,CAA1C;AACD,OAFD;;AAGA,UAAIoe,WAAW,GAAG,YAAY;AAC5B,eAAO1N,SAAS,CAACnC,KAAV,CAAgBC,SAAhB,EAA2B,CAA3B,EAA8ByP,GAA9B,CAAP;AACD,OAFD;;AAGA,aAAOI,MAAM,CAACH,QAAD,EAAWC,OAAX,EAAoBC,WAApB,CAAb;AACD,KAfS,CAAV;AAgBD,GAvBD;;AAwBA,MAAIC,MAAM,GAAG,UAAUH,QAAV,EAAoBC,OAApB,EAA6BC,WAA7B,EAA0C;AACrD,QAAIE,OAAO,GAAGJ,QAAQ,EAAtB;AACA,QAAIK,YAAY,GAAG7oB,IAAI,CAAC4oB,OAAD,EAAUH,OAAV,CAAvB;AACA,QAAIK,YAAY,GAAGD,YAAY,CAAC3rB,OAAb,CAAqB,YAAY;AAClD,aAAOmB,QAAQ,CAACD,IAAT,CAAcwqB,OAAO,CAAC,CAAD,CAArB,EAA0B1rB,OAA1B,CAAkCwrB,WAAlC,CAAP;AACD,KAFkB,CAAnB;AAGA,WAAOI,YAAY,CAAC3rB,GAAb,CAAiB,UAAUsQ,MAAV,EAAkB;AACxC,aAAOA,MAAM,CAACnD,OAAd;AACD,KAFM,CAAP;AAGD,GATD;;AAUA,MAAI4M,MAAM,GAAG,UAAU4B,SAAV,EAAqB;AAChC,QAAI3L,IAAI,GAAG2L,SAAS,CAAC3L,IAArB;AACA,QAAImb,OAAO,GAAGnpB,KAAK,CAACgO,IAAI,CAACC,IAAN,EAAYnS,QAAZ,CAAnB;AACA,QAAIkd,IAAI,GAAGhZ,KAAK,CAACgO,IAAI,CAACE,OAAN,EAAepS,QAAf,CAAhB;AACA,WAAOkC,GAAG,CAACmrB,OAAD,EAAU,UAAU/a,GAAV,EAAe;AACjC,UAAIib,QAAQ,GAAG,YAAY;AACzB,eAAOnrB,IAAI,CAAC8a,IAAD,EAAO,UAAU4Q,CAAV,EAAa;AAC7B,iBAAO/N,SAAS,CAACnC,KAAV,CAAgBC,SAAhB,EAA2BvL,GAA3B,EAAgCwb,CAAhC,EAAmCvrB,MAAnC,CAA0C,UAAUiQ,MAAV,EAAkB;AACjE,mBAAOA,MAAM,CAACF,GAAP,KAAeA,GAAtB;AACD,WAFM,EAEJ/Q,IAFI,CAECxB,QAAQ,CAAC,EAAD,CAFT,EAEe,UAAUyS,MAAV,EAAkB;AACtC,mBAAO,CAACA,MAAD,CAAP;AACD,WAJM,CAAP;AAKD,SANU,CAAX;AAOD,OARD;;AASA,UAAIub,QAAQ,GAAG,UAAUvb,MAAV,EAAkB;AAC/B,eAAOA,MAAM,CAACC,OAAP,KAAmB,CAA1B;AACD,OAFD;;AAGA,UAAIgb,WAAW,GAAG,YAAY;AAC5B,eAAO1N,SAAS,CAACnC,KAAV,CAAgBC,SAAhB,EAA2BvL,GAA3B,EAAgC,CAAhC,CAAP;AACD,OAFD;;AAGA,aAAOob,MAAM,CAACH,QAAD,EAAWQ,QAAX,EAAqBN,WAArB,CAAb;AACD,KAjBS,CAAV;AAkBD,GAtBD;;AAwBA,MAAIO,MAAM,GAAG,UAAUlqB,EAAV,EAAc4R,KAAd,EAAqB;AAChC,QAAIA,KAAK,GAAG,CAAR,IAAaA,KAAK,IAAI5R,EAAE,CAACpE,MAAH,GAAY,CAAtC,EAAyC;AACvC,aAAO0D,QAAQ,CAACtC,IAAT,EAAP;AACD;;AACD,QAAImI,OAAO,GAAGnF,EAAE,CAAC4R,KAAD,CAAF,CAAUnU,IAAV,CAAe,YAAY;AACvC,UAAI0sB,IAAI,GAAG/oB,OAAO,CAACpB,EAAE,CAACR,KAAH,CAAS,CAAT,EAAYoS,KAAZ,CAAD,CAAlB;AACA,aAAO/P,OAAO,CAACsoB,IAAD,EAAO,UAAUzvB,CAAV,EAAawF,CAAb,EAAgB;AACnC,eAAOxF,CAAC,CAAC0D,GAAF,CAAM,UAAUgsB,EAAV,EAAc;AACzB,iBAAO;AACL7vB,YAAAA,KAAK,EAAE6vB,EADF;AAELC,YAAAA,KAAK,EAAEnqB,CAAC,GAAG;AAFN,WAAP;AAID,SALM,CAAP;AAMD,OAPa,CAAd;AAQD,KAVa,EAUX,UAAU8pB,CAAV,EAAa;AACd,aAAO1qB,QAAQ,CAACR,IAAT,CAAc;AACnBvE,QAAAA,KAAK,EAAEyvB,CADY;AAEnBK,QAAAA,KAAK,EAAE;AAFY,OAAd,CAAP;AAID,KAfa,CAAd;AAgBA,QAAIC,IAAI,GAAGtqB,EAAE,CAAC4R,KAAK,GAAG,CAAT,CAAF,CAAcnU,IAAd,CAAmB,YAAY;AACxC,UAAI0sB,IAAI,GAAGnqB,EAAE,CAACR,KAAH,CAASoS,KAAK,GAAG,CAAjB,CAAX;AACA,aAAO/P,OAAO,CAACsoB,IAAD,EAAO,UAAUzvB,CAAV,EAAawF,CAAb,EAAgB;AACnC,eAAOxF,CAAC,CAAC0D,GAAF,CAAM,UAAUgsB,EAAV,EAAc;AACzB,iBAAO;AACL7vB,YAAAA,KAAK,EAAE6vB,EADF;AAELC,YAAAA,KAAK,EAAEnqB,CAAC,GAAG;AAFN,WAAP;AAID,SALM,CAAP;AAMD,OAPa,CAAd;AAQD,KAVU,EAUR,UAAU3C,CAAV,EAAa;AACd,aAAO+B,QAAQ,CAACR,IAAT,CAAc;AACnBvE,QAAAA,KAAK,EAAEgD,CADY;AAEnB8sB,QAAAA,KAAK,EAAE;AAFY,OAAd,CAAP;AAID,KAfU,CAAX;AAgBA,WAAOllB,OAAO,CAAC7G,IAAR,CAAa,UAAU0rB,CAAV,EAAa;AAC/B,aAAOM,IAAI,CAAClsB,GAAL,CAAS,UAAUb,CAAV,EAAa;AAC3B,YAAIgtB,MAAM,GAAGhtB,CAAC,CAAC8sB,KAAF,GAAUL,CAAC,CAACK,KAAzB;AACA,eAAO7O,IAAI,CAACgP,GAAL,CAASjtB,CAAC,CAAChD,KAAF,GAAUyvB,CAAC,CAACzvB,KAArB,IAA8BgwB,MAArC;AACD,OAHM,CAAP;AAID,KALM,CAAP;AAMD,GA1CD;;AA4CA,MAAIE,WAAW,GAAG,UAAUC,KAAV,EAAiBC,KAAjB,EAAwB;AACxC,WAAO,UAAUpf,OAAV,EAAmB;AACxB,aAAOqf,YAAY,CAACrf,OAAD,CAAZ,KAA0B,KAA1B,GAAkCof,KAAlC,GAA0CD,KAAjD;AACD,KAFD;AAGD,GAJD;;AAKA,MAAIE,YAAY,GAAG,UAAUrf,OAAV,EAAmB;AACpC,WAAOuK,KAAK,CAACvK,OAAD,EAAU,WAAV,CAAL,KAAgC,KAAhC,GAAwC,KAAxC,GAAgD,KAAvD;AACD,GAFD;;AAIA,MAAIsf,KAAK,GAAGtC,SAAS,CAAC,QAAD,EAAW,UAAUhd,OAAV,EAAmB;AACjD,QAAIN,GAAG,GAAGM,OAAO,CAACN,GAAlB;AACA,WAAO8H,MAAM,CAACxH,OAAD,CAAN,GAAkBN,GAAG,CAAC6f,qBAAJ,GAA4BC,MAA9C,GAAuD9f,GAAG,CAAC+f,YAAlE;AACD,GAHoB,CAArB;;AAIA,MAAIC,KAAK,GAAG,UAAU1f,OAAV,EAAmB;AAC7B,WAAOsf,KAAK,CAACnpB,GAAN,CAAU6J,OAAV,CAAP;AACD,GAFD;;AAGA,MAAI2f,UAAU,GAAG,UAAU3f,OAAV,EAAmB;AAClC,WAAOsf,KAAK,CAAClC,QAAN,CAAepd,OAAf,CAAP;AACD,GAFD;;AAIA,MAAIjL,CAAC,GAAG,UAAU6qB,IAAV,EAAgBC,GAAhB,EAAqB;AAC3B,QAAIC,SAAS,GAAG,UAAUxxB,CAAV,EAAauR,CAAb,EAAgB;AAC9B,aAAO9K,CAAC,CAAC6qB,IAAI,GAAGtxB,CAAR,EAAWuxB,GAAG,GAAGhgB,CAAjB,CAAR;AACD,KAFD;;AAGA,WAAO;AACL+f,MAAAA,IAAI,EAAEA,IADD;AAELC,MAAAA,GAAG,EAAEA,GAFA;AAGLC,MAAAA,SAAS,EAAEA;AAHN,KAAP;AAKD,GATD;;AAUA,MAAIC,aAAa,GAAGhrB,CAApB;;AAEA,MAAIirB,WAAW,GAAG,UAAUtgB,GAAV,EAAe;AAC/B,QAAIwZ,GAAG,GAAGxZ,GAAG,CAAC6f,qBAAJ,EAAV;AACA,WAAOQ,aAAa,CAAC7G,GAAG,CAAC0G,IAAL,EAAW1G,GAAG,CAAC2G,GAAf,CAApB;AACD,GAHD;;AAIA,MAAII,kBAAkB,GAAG,UAAU9wB,CAAV,EAAa0E,CAAb,EAAgB;AACvC,QAAI1E,CAAC,KAAKM,SAAV,EAAqB;AACnB,aAAON,CAAP;AACD,KAFD,MAEO;AACL,aAAO0E,CAAC,KAAKpE,SAAN,GAAkBoE,CAAlB,GAAsB,CAA7B;AACD;AACF,GAND;;AAOA,MAAIqsB,QAAQ,GAAG,UAAUlgB,OAAV,EAAmB;AAChC,QAAItB,GAAG,GAAGsB,OAAO,CAACN,GAAR,CAAY0F,aAAtB;AACA,QAAIqC,IAAI,GAAG/I,GAAG,CAAC+I,IAAf;AACA,QAAI0Y,GAAG,GAAGzhB,GAAG,CAAC6G,WAAd;AACA,QAAI/G,IAAI,GAAGE,GAAG,CAAC0hB,eAAf;;AACA,QAAI3Y,IAAI,KAAKzH,OAAO,CAACN,GAArB,EAA0B;AACxB,aAAOqgB,aAAa,CAACtY,IAAI,CAAC4Y,UAAN,EAAkB5Y,IAAI,CAAC6Y,SAAvB,CAApB;AACD;;AACD,QAAIC,SAAS,GAAGN,kBAAkB,CAACE,GAAG,KAAK,IAAR,IAAgBA,GAAG,KAAK,KAAK,CAA7B,GAAiC,KAAK,CAAtC,GAA0CA,GAAG,CAACK,WAA/C,EAA4DhiB,IAAI,CAAC+hB,SAAjE,CAAlC;AACA,QAAIE,UAAU,GAAGR,kBAAkB,CAACE,GAAG,KAAK,IAAR,IAAgBA,GAAG,KAAK,KAAK,CAA7B,GAAiC,KAAK,CAAtC,GAA0CA,GAAG,CAACO,WAA/C,EAA4DliB,IAAI,CAACiiB,UAAjE,CAAnC;AACA,QAAIE,SAAS,GAAGV,kBAAkB,CAACzhB,IAAI,CAACmiB,SAAN,EAAiBlZ,IAAI,CAACkZ,SAAtB,CAAlC;AACA,QAAIC,UAAU,GAAGX,kBAAkB,CAACzhB,IAAI,CAACoiB,UAAN,EAAkBnZ,IAAI,CAACmZ,UAAvB,CAAnC;AACA,WAAOC,QAAQ,CAAC7gB,OAAD,CAAR,CAAkB8f,SAAlB,CAA4BW,UAAU,GAAGG,UAAzC,EAAqDL,SAAS,GAAGI,SAAjE,CAAP;AACD,GAbD;;AAcA,MAAIE,QAAQ,GAAG,UAAU7gB,OAAV,EAAmB;AAChC,QAAIN,GAAG,GAAGM,OAAO,CAACN,GAAlB;AACA,QAAIhB,GAAG,GAAGgB,GAAG,CAAC0F,aAAd;AACA,QAAIqC,IAAI,GAAG/I,GAAG,CAAC+I,IAAf;;AACA,QAAIA,IAAI,KAAK/H,GAAb,EAAkB;AAChB,aAAOqgB,aAAa,CAACtY,IAAI,CAAC4Y,UAAN,EAAkB5Y,IAAI,CAAC6Y,SAAvB,CAApB;AACD;;AACD,QAAI,CAAC9Y,MAAM,CAACxH,OAAD,CAAX,EAAsB;AACpB,aAAO+f,aAAa,CAAC,CAAD,EAAI,CAAJ,CAApB;AACD;;AACD,WAAOC,WAAW,CAACtgB,GAAD,CAAlB;AACD,GAXD;;AAaA,MAAIohB,OAAO,GAAG,UAAU7d,GAAV,EAAepD,CAAf,EAAkB;AAC9B,WAAO;AACLoD,MAAAA,GAAG,EAAEA,GADA;AAELpD,MAAAA,CAAC,EAAEA;AAFE,KAAP;AAID,GALD;;AAMA,MAAIkhB,OAAO,GAAG,UAAU9C,GAAV,EAAe3vB,CAAf,EAAkB;AAC9B,WAAO;AACL2vB,MAAAA,GAAG,EAAEA,GADA;AAEL3vB,MAAAA,CAAC,EAAEA;AAFE,KAAP;AAID,GALD;;AAMA,MAAI0yB,OAAO,GAAG,UAAU7V,IAAV,EAAgB;AAC5B,QAAI8V,GAAG,GAAGf,QAAQ,CAAC/U,IAAD,CAAlB;AACA,WAAO8V,GAAG,CAACrB,IAAJ,GAAWxC,QAAQ,CAACjS,IAAD,CAA1B;AACD,GAHD;;AAIA,MAAI+V,OAAO,GAAG,UAAU/V,IAAV,EAAgB;AAC5B,WAAO+U,QAAQ,CAAC/U,IAAD,CAAR,CAAeyU,IAAtB;AACD,GAFD;;AAGA,MAAIuB,WAAW,GAAG,UAAU9a,KAAV,EAAiB8E,IAAjB,EAAuB;AACvC,WAAO4V,OAAO,CAAC1a,KAAD,EAAQ6a,OAAO,CAAC/V,IAAD,CAAf,CAAd;AACD,GAFD;;AAGA,MAAIiW,YAAY,GAAG,UAAU/a,KAAV,EAAiB8E,IAAjB,EAAuB;AACxC,WAAO4V,OAAO,CAAC1a,KAAD,EAAQ2a,OAAO,CAAC7V,IAAD,CAAf,CAAd;AACD,GAFD;;AAGA,MAAIkW,MAAM,GAAG,UAAUlW,IAAV,EAAgB;AAC3B,WAAO+U,QAAQ,CAAC/U,IAAD,CAAR,CAAe0U,GAAtB;AACD,GAFD;;AAGA,MAAIyB,UAAU,GAAG,UAAUjb,KAAV,EAAiB8E,IAAjB,EAAuB;AACtC,WAAO2V,OAAO,CAACza,KAAD,EAAQgb,MAAM,CAAClW,IAAD,CAAd,CAAd;AACD,GAFD;;AAGA,MAAIoW,aAAa,GAAG,UAAUlb,KAAV,EAAiB8E,IAAjB,EAAuB;AACzC,WAAO2V,OAAO,CAACza,KAAD,EAAQgb,MAAM,CAAClW,IAAD,CAAN,GAAewU,UAAU,CAACxU,IAAD,CAAjC,CAAd;AACD,GAFD;;AAGA,MAAIqW,aAAa,GAAG,UAAUC,YAAV,EAAwBC,YAAxB,EAAsCC,KAAtC,EAA6C;AAC/D,QAAIA,KAAK,CAACtxB,MAAN,KAAiB,CAArB,EAAwB;AACtB,aAAO,EAAP;AACD;;AACD,QAAIuxB,KAAK,GAAG/uB,GAAG,CAAC8uB,KAAK,CAAC1tB,KAAN,CAAY,CAAZ,CAAD,EAAiB,UAAU4tB,UAAV,EAAsBxb,KAAtB,EAA6B;AAC3D,aAAOwb,UAAU,CAAChvB,GAAX,CAAe,UAAUsY,IAAV,EAAgB;AACpC,eAAOsW,YAAY,CAACpb,KAAD,EAAQ8E,IAAR,CAAnB;AACD,OAFM,CAAP;AAGD,KAJc,CAAf;AAKA,QAAI2W,QAAQ,GAAGH,KAAK,CAACA,KAAK,CAACtxB,MAAN,GAAe,CAAhB,CAAL,CAAwBwC,GAAxB,CAA4B,UAAUsY,IAAV,EAAgB;AACzD,aAAOuW,YAAY,CAACC,KAAK,CAACtxB,MAAN,GAAe,CAAhB,EAAmB8a,IAAnB,CAAnB;AACD,KAFc,CAAf;AAGA,WAAOyW,KAAK,CAAC3wB,MAAN,CAAa,CAAC6wB,QAAD,CAAb,CAAP;AACD,GAbD;;AAcA,MAAIC,MAAM,GAAG,UAAUC,IAAV,EAAgB;AAC3B,WAAO,CAACA,IAAR;AACD,GAFD;;AAGA,MAAIxC,MAAM,GAAG;AACXV,IAAAA,KAAK,EAAEnuB,QADI;AAEXsxB,IAAAA,SAAS,EAAE,UAAUC,WAAV,EAAuB;AAChC,aAAOV,aAAa,CAACF,UAAD,EAAaC,aAAb,EAA4BW,WAA5B,CAApB;AACD,KAJU;AAKXjnB,IAAAA,IAAI,EAAEomB;AALK,GAAb;AAOA,MAAIc,GAAG,GAAG;AACRrD,IAAAA,KAAK,EAAEnuB,QADC;AAERsK,IAAAA,IAAI,EAAEimB,OAFE;AAGRe,IAAAA,SAAS,EAAE,UAAUC,WAAV,EAAuB;AAChC,aAAOV,aAAa,CAACL,WAAD,EAAcC,YAAd,EAA4Bc,WAA5B,CAApB;AACD;AALO,GAAV;AAOA,MAAIE,GAAG,GAAG;AACRtD,IAAAA,KAAK,EAAEiD,MADC;AAER9mB,IAAAA,IAAI,EAAE+lB,OAFE;AAGRiB,IAAAA,SAAS,EAAE,UAAUC,WAAV,EAAuB;AAChC,aAAOV,aAAa,CAACJ,YAAD,EAAeD,WAAf,EAA4Be,WAA5B,CAApB;AACD;AALO,GAAV;AAOA,MAAIG,QAAQ,GAAGnD,WAAW,CAACiD,GAAD,EAAMC,GAAN,CAA1B;AACA,MAAIE,KAAK,GAAG;AACVxD,IAAAA,KAAK,EAAE,UAAUyD,MAAV,EAAkBlW,KAAlB,EAAyB;AAC9B,aAAOgW,QAAQ,CAAChW,KAAD,CAAR,CAAgByS,KAAhB,CAAsByD,MAAtB,EAA8BlW,KAA9B,CAAP;AACD,KAHS;AAIV4V,IAAAA,SAAS,EAAE,UAAUpU,IAAV,EAAgBxB,KAAhB,EAAuB;AAChC,aAAOgW,QAAQ,CAAChW,KAAD,CAAR,CAAgB4V,SAAhB,CAA0BpU,IAA1B,EAAgCxB,KAAhC,CAAP;AACD,KANS;AAOVpR,IAAAA,IAAI,EAAE,UAAUkQ,IAAV,EAAgB;AACpB,aAAOkX,QAAQ,CAAClX,IAAD,CAAR,CAAelQ,IAAf,CAAoBkQ,IAApB,CAAP;AACD;AATS,GAAZ;AAYA,MAAIqX,KAAK,GAAG;AACVC,IAAAA,iBAAiB,EAAE,CACjB,IADiB,EAEjB,IAFiB,EAGjB,KAHiB,EAIjB,IAJiB,EAKjB,IALiB,EAMjB,KANiB,EAOjB,IAPiB,EAQjB,KARiB,EASjB,IATiB,EAUjB,IAViB,EAWjB,IAXiB,EAYjB,IAZiB,EAajB,MAbiB,EAcjB,MAdiB,EAejB,IAfiB,EAgBjB,IAhBiB,EAiBjB,GAjBiB,EAkBjB,IAlBiB,EAmBjB,IAnBiB,EAoBjB,IApBiB,EAqBjB,IArBiB,CADT;AAwBVC,IAAAA,KAAK,EAAE,CACL,IADK,EAEL,IAFK,CAxBG;AA4BVC,IAAAA,QAAQ,EAAE,CAAC,GAAD,CA5BA;AA6BVrO,IAAAA,KAAK,EAAE,CAAC,EAAD;AA7BG,GAAZ;;AA+BA,MAAIsO,OAAO,GAAG,YAAY;AACxB,QAAIC,aAAa,GAAG,QAApB;AACA,QAAIC,aAAa,GAAG,UAAUD,aAA9B;AACA,QAAIE,YAAY,GAAG,SAASD,aAA5B;AACA,QAAIE,GAAG,GAAG,KAAV;;AACA,QAAIC,GAAG,GAAG,UAAUC,KAAV,EAAiB;AACzB,aAAO,QAAQA,KAAR,GAAgB,IAAvB;AACD,KAFD;;AAGA,QAAIC,sBAAsB,GAAG,CAC3B,UAD2B,EAE3BN,aAAa,GAAGG,GAAhB,GAAsBC,GAAG,CAACJ,aAAD,CAAzB,GAA2CI,GAAG,CAACF,YAAD,CAFnB,EAG3BC,GAAG,GAAGH,aAAN,GAAsBI,GAAG,CAACF,YAAD,CAHE,EAI3BF,aAAa,GAAGI,GAAG,CAACF,YAAD,CAJQ,EAK3B7W,IAL2B,CAKtB,GALsB,CAA7B;AAMA,QAAIkX,KAAK,GAAG,aAAaD,sBAAb,GAAsC,GAAlD;AACA,WAAO,IAAIE,MAAJ,CAAW,OAAOD,KAAP,GAAe,QAA1B,CAAP;AACD,GAhBa,EAAd;;AAiBA,MAAIE,MAAM,GAAG,UAAUC,IAAV,EAAgBC,QAAhB,EAA0B;AACrC,WAAOxwB,MAAM,CAACwwB,QAAD,EAAW,UAAUluB,GAAV,EAAe;AACrC,aAAOtC,MAAM,CAACwvB,KAAK,CAACltB,GAAD,CAAN,EAAa,UAAUmuB,KAAV,EAAiB;AACzC,eAAOF,IAAI,KAAKE,KAAhB;AACD,OAFY,CAAb;AAGD,KAJY,CAAb;AAKD,GAND;;AAOA,MAAIC,KAAK,GAAG,UAAUR,KAAV,EAAiBM,QAAjB,EAA2B;AACrC,QAAI1lB,KAAK,GAAG/J,QAAQ,CAACD,IAAT,CAAc8uB,OAAO,CAACe,IAAR,CAAaT,KAAb,CAAd,CAAZ;AACA,WAAOplB,KAAK,CAAC/K,IAAN,CAAW,UAAU4uB,KAAV,EAAiB;AACjC,UAAI3yB,KAAK,GAAG4J,MAAM,CAAC+oB,KAAK,CAAC,CAAD,CAAN,CAAlB;AACA,UAAIiC,OAAO,GAAGjC,KAAK,CAAC,CAAD,CAAnB;;AACA,UAAI2B,MAAM,CAACM,OAAD,EAAUJ,QAAV,CAAV,EAA+B;AAC7B,eAAOzvB,QAAQ,CAACR,IAAT,CAAc;AACnBvE,UAAAA,KAAK,EAAEA,KADY;AAEnBu0B,UAAAA,IAAI,EAAEK;AAFa,SAAd,CAAP;AAID,OALD,MAKO;AACL,eAAO7vB,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,KAXM,CAAP;AAYD,GAdD;;AAgBA,MAAIoyB,cAAc,GAAG,YAAY;AAC/B,QAAIxsB,OAAO,GAAGuG,QAAQ,GAAGvG,OAAzB;AACA,WAAOA,OAAO,CAACwE,IAAR,MAAkBxE,OAAO,CAACsE,MAAR,EAAzB;AACD,GAHD;;AAIA,MAAImoB,QAAQ,GAAG,UAAUC,EAAV,EAAc3Y,QAAd,EAAwB;AACrC,QAAItW,GAAG,GAAGqoB,UAAU,CAAC4G,EAAD,CAApB;AACA,WAAOvG,KAAK,CAAC1oB,GAAD,CAAL,GAAasW,QAAb,GAAwBtW,GAA/B;AACD,GAHD;;AAIA,MAAIkvB,OAAO,GAAG,UAAU/X,GAAV,EAAerd,IAAf,EAAqBwc,QAArB,EAA+B;AAC3C,WAAO0Y,QAAQ,CAACvZ,KAAK,CAAC0B,GAAD,EAAMrd,IAAN,CAAN,EAAmBwc,QAAnB,CAAf;AACD,GAFD;;AAGA,MAAI6Y,mBAAmB,GAAG,UAAU9Y,IAAV,EAAgB;AACxC,QAAIqU,MAAM,GAAGrU,IAAI,CAACzL,GAAL,CAAS6f,qBAAT,GAAiCC,MAA9C;AACA,QAAI0E,SAAS,GAAG3Z,KAAK,CAACY,IAAD,EAAO,YAAP,CAArB;;AACA,QAAI+Y,SAAS,KAAK,YAAlB,EAAgC;AAC9B,aAAO1E,MAAP;AACD,KAFD,MAEO;AACL,UAAI2E,UAAU,GAAGH,OAAO,CAAC7Y,IAAD,EAAO,aAAP,EAAsB,CAAtB,CAAxB;AACA,UAAIiZ,aAAa,GAAGJ,OAAO,CAAC7Y,IAAD,EAAO,gBAAP,EAAyB,CAAzB,CAA3B;AACA,UAAIkZ,SAAS,GAAGL,OAAO,CAAC7Y,IAAD,EAAO,kBAAP,EAA2B,CAA3B,CAAvB;AACA,UAAImZ,YAAY,GAAGN,OAAO,CAAC7Y,IAAD,EAAO,qBAAP,EAA8B,CAA9B,CAA1B;AACA,UAAIoZ,OAAO,GAAGF,SAAS,GAAGC,YAA1B;AACA,aAAO9E,MAAM,GAAG2E,UAAT,GAAsBC,aAAtB,GAAsCG,OAA7C;AACD;AACF,GAbD;;AAcA,MAAIC,kBAAkB,GAAG,UAAUrZ,IAAV,EAAgB;AACvC,QAAImX,KAAK,GAAGnX,IAAI,CAACzL,GAAL,CAAS6f,qBAAT,GAAiC+C,KAA7C;AACA,QAAI4B,SAAS,GAAG3Z,KAAK,CAACY,IAAD,EAAO,YAAP,CAArB;;AACA,QAAI+Y,SAAS,KAAK,YAAlB,EAAgC;AAC9B,aAAO5B,KAAP;AACD,KAFD,MAEO;AACL,UAAImC,WAAW,GAAGT,OAAO,CAAC7Y,IAAD,EAAO,cAAP,EAAuB,CAAvB,CAAzB;AACA,UAAIuZ,YAAY,GAAGV,OAAO,CAAC7Y,IAAD,EAAO,eAAP,EAAwB,CAAxB,CAA1B;AACA,UAAIwZ,UAAU,GAAGX,OAAO,CAAC7Y,IAAD,EAAO,mBAAP,EAA4B,CAA5B,CAAxB;AACA,UAAIyZ,WAAW,GAAGZ,OAAO,CAAC7Y,IAAD,EAAO,oBAAP,EAA6B,CAA7B,CAAzB;AACA,UAAIoZ,OAAO,GAAGI,UAAU,GAAGC,WAA3B;AACA,aAAOtC,KAAK,GAAGmC,WAAR,GAAsBC,YAAtB,GAAqCH,OAA5C;AACD;AACF,GAbD;;AAcA,MAAIM,SAAS,GAAG,UAAU1Z,IAAV,EAAgB;AAC9B,WAAO0Y,cAAc,KAAKI,mBAAmB,CAAC9Y,IAAD,CAAxB,GAAiC6Y,OAAO,CAAC7Y,IAAD,EAAO,QAAP,EAAiBuU,KAAK,CAACvU,IAAD,CAAtB,CAA7D;AACD,GAFD;;AAGA,MAAI2Z,QAAQ,GAAG,UAAU3Z,IAAV,EAAgB;AAC7B,WAAO0Y,cAAc,KAAKW,kBAAkB,CAACrZ,IAAD,CAAvB,GAAgC6Y,OAAO,CAAC7Y,IAAD,EAAO,OAAP,EAAgB0S,KAAK,CAAC1S,IAAD,CAArB,CAA5D;AACD,GAFD;;AAIA,MAAI4Z,yBAAyB,GAAG,gBAAhC;AACA,MAAIC,oBAAoB,GAAG,oBAA3B;;AACA,MAAIC,cAAc,GAAG,UAAUhZ,GAAV,EAAeiZ,MAAf,EAAuB;AAC1C,QAAIC,cAAc,GAAGpf,YAAY,CAACkG,GAAD,CAAZ,CAAkB3Z,KAAlB,CAAwBoV,OAAO,CAACvC,KAAK,CAAC8G,GAAD,CAAN,CAA/B,CAArB;AACA,WAAOiZ,MAAM,CAACjZ,GAAD,CAAN,GAAciZ,MAAM,CAACC,cAAD,CAApB,GAAuC,GAA9C;AACD,GAHD;;AAIA,MAAIC,aAAa,GAAG,UAAUja,IAAV,EAAgBoX,MAAhB,EAAwB;AAC1CnY,IAAAA,KAAK,CAACe,IAAD,EAAO,OAAP,EAAgBoX,MAAM,GAAG,IAAzB,CAAL;AACD,GAFD;;AAGA,MAAI8C,kBAAkB,GAAG,UAAUla,IAAV,EAAgBoX,MAAhB,EAAwB;AAC/CnY,IAAAA,KAAK,CAACe,IAAD,EAAO,OAAP,EAAgBoX,MAAM,GAAG,GAAzB,CAAL;AACD,GAFD;;AAGA,MAAI+C,SAAS,GAAG,UAAUna,IAAV,EAAgBoX,MAAhB,EAAwB;AACtCnY,IAAAA,KAAK,CAACe,IAAD,EAAO,QAAP,EAAiBoX,MAAM,GAAG,IAA1B,CAAL;AACD,GAFD;;AAGA,MAAIgD,cAAc,GAAG,UAAUpa,IAAV,EAAgB;AACnC,WAAOR,MAAM,CAACQ,IAAD,EAAO,QAAP,CAAN,CAAuB5Y,UAAvB,CAAkC,YAAY;AACnD,aAAOsyB,SAAS,CAAC1Z,IAAD,CAAT,GAAkB,IAAzB;AACD,KAFM,CAAP;AAGD,GAJD;;AAKA,MAAIqa,OAAO,GAAG,UAAUra,IAAV,EAAgBsa,MAAhB,EAAwBP,MAAxB,EAAgCQ,MAAhC,EAAwC;AACpD,QAAIC,OAAO,GAAGtZ,KAAK,CAAClB,IAAD,CAAL,CAAYtY,GAAZ,CAAgB,UAAUwZ,KAAV,EAAiB;AAC7C,UAAIuZ,KAAK,GAAGV,MAAM,CAAC7Y,KAAD,CAAlB;AACA,aAAO4D,IAAI,CAAC4V,KAAL,CAAWJ,MAAM,GAAG,GAAT,GAAeG,KAA1B,CAAP;AACD,KAHa,EAGXtzB,KAHW,CAGLmzB,MAHK,CAAd;AAIAC,IAAAA,MAAM,CAACva,IAAD,EAAOwa,OAAP,CAAN;AACA,WAAOA,OAAP;AACD,GAPD;;AAQA,MAAIG,kBAAkB,GAAG,UAAU92B,KAAV,EAAiBmc,IAAjB,EAAuB+Z,MAAvB,EAA+BQ,MAA/B,EAAuC;AAC9D,QAAID,MAAM,GAAGpa,QAAQ,CAACrc,KAAD,EAAQ,EAAR,CAArB;AACA,WAAOuL,QAAQ,CAACvL,KAAD,EAAQ,GAAR,CAAR,IAAwBJ,IAAI,CAACuc,IAAD,CAAJ,KAAe,OAAvC,GAAiDqa,OAAO,CAACra,IAAD,EAAOsa,MAAP,EAAeP,MAAf,EAAuBQ,MAAvB,CAAxD,GAAyFD,MAAhG;AACD,GAHD;;AAIA,MAAIM,cAAc,GAAG,UAAU5a,IAAV,EAAgB;AACnC,QAAInc,KAAK,GAAGu2B,cAAc,CAACpa,IAAD,CAA1B;;AACA,QAAI,CAACnc,KAAL,EAAY;AACV,aAAO0wB,KAAK,CAACvU,IAAD,CAAZ;AACD;;AACD,WAAO2a,kBAAkB,CAAC92B,KAAD,EAAQmc,IAAR,EAAcuU,KAAd,EAAqB4F,SAArB,CAAzB;AACD,GAND;;AAOA,MAAIU,KAAK,GAAG,UAAU7a,IAAV,EAAgBpc,IAAhB,EAAsBoC,CAAtB,EAAyB;AACnC,QAAIwC,CAAC,GAAGxC,CAAC,CAACga,IAAD,CAAT;AACA,QAAI8a,IAAI,GAAG3a,OAAO,CAACH,IAAD,EAAOpc,IAAP,CAAlB;AACA,WAAO4E,CAAC,GAAGsyB,IAAX;AACD,GAJD;;AAKA,MAAIC,WAAW,GAAG,UAAUlmB,OAAV,EAAmB;AACnC,QAAImmB,QAAQ,GAAGxb,MAAM,CAAC3K,OAAD,EAAU,OAAV,CAArB;AACA,WAAOmmB,QAAQ,CAACj0B,IAAT,CAAc,YAAY;AAC/B,aAAO6B,QAAQ,CAACD,IAAT,CAAcsV,KAAK,CAACpJ,OAAD,EAAU,OAAV,CAAnB,CAAP;AACD,KAFM,EAEJ,UAAUsiB,KAAV,EAAiB;AAClB,aAAOvuB,QAAQ,CAACR,IAAT,CAAc+uB,KAAd,CAAP;AACD,KAJM,CAAP;AAKD,GAPD;;AAQA,MAAI8D,wBAAwB,GAAG,UAAUC,SAAV,EAAqBC,SAArB,EAAgC;AAC7D,WAAOD,SAAS,GAAGC,SAAS,CAACC,UAAV,EAAZ,GAAqC,GAA5C;AACD,GAFD;;AAGA,MAAIC,oBAAoB,GAAG,UAAUxmB,OAAV,EAAmBsiB,KAAnB,EAA0BgE,SAA1B,EAAqC;AAC9D,QAAIG,YAAY,GAAG1B,yBAAyB,CAACpB,IAA1B,CAA+BrB,KAA/B,CAAnB;;AACA,QAAImE,YAAY,KAAK,IAArB,EAA2B;AACzB,aAAOtJ,UAAU,CAACsJ,YAAY,CAAC,CAAD,CAAb,CAAjB;AACD,KAFD,MAEO;AACL,UAAIC,QAAQ,GAAG5B,QAAQ,CAAC9kB,OAAD,CAAvB;AACA,aAAOomB,wBAAwB,CAACM,QAAD,EAAWJ,SAAX,CAA/B;AACD;AACF,GARD;;AASA,MAAIK,kBAAkB,GAAG,UAAUxb,IAAV,EAAgBmb,SAAhB,EAA2B;AAClD,QAAIhE,KAAK,GAAG4D,WAAW,CAAC/a,IAAD,CAAvB;AACA,WAAOmX,KAAK,CAACpwB,IAAN,CAAW,YAAY;AAC5B,UAAIw0B,QAAQ,GAAG7I,KAAK,CAAC1S,IAAD,CAApB;AACA,aAAOib,wBAAwB,CAACM,QAAD,EAAWJ,SAAX,CAA/B;AACD,KAHM,EAGJ,UAAUhW,CAAV,EAAa;AACd,aAAOkW,oBAAoB,CAACrb,IAAD,EAAOmF,CAAP,EAAUgW,SAAV,CAA3B;AACD,KALM,CAAP;AAMD,GARD;;AASA,MAAIM,mBAAmB,GAAG,UAAUP,SAAV,EAAqBC,SAArB,EAAgC;AACxD,WAAOD,SAAS,GAAG,GAAZ,GAAkBC,SAAS,CAACC,UAAV,EAAzB;AACD,GAFD;;AAGA,MAAIM,eAAe,GAAG,UAAU7mB,OAAV,EAAmBsiB,KAAnB,EAA0BgE,SAA1B,EAAqC;AACzD,QAAIQ,UAAU,GAAG9B,oBAAoB,CAACrB,IAArB,CAA0BrB,KAA1B,CAAjB;;AACA,QAAIwE,UAAU,KAAK,IAAnB,EAAyB;AACvB,aAAOzb,QAAQ,CAACyb,UAAU,CAAC,CAAD,CAAX,EAAgB,EAAhB,CAAf;AACD;;AACD,QAAIL,YAAY,GAAG1B,yBAAyB,CAACpB,IAA1B,CAA+BrB,KAA/B,CAAnB;;AACA,QAAImE,YAAY,KAAK,IAArB,EAA2B;AACzB,UAAIM,UAAU,GAAG5J,UAAU,CAACsJ,YAAY,CAAC,CAAD,CAAb,CAA3B;AACA,aAAOG,mBAAmB,CAACG,UAAD,EAAaT,SAAb,CAA1B;AACD;;AACD,WAAOxB,QAAQ,CAAC9kB,OAAD,CAAf;AACD,GAXD;;AAYA,MAAIgnB,aAAa,GAAG,UAAU7b,IAAV,EAAgBmb,SAAhB,EAA2B;AAC7C,QAAIhE,KAAK,GAAG4D,WAAW,CAAC/a,IAAD,CAAvB;AACA,WAAOmX,KAAK,CAACpwB,IAAN,CAAW,YAAY;AAC5B,aAAO4yB,QAAQ,CAAC3Z,IAAD,CAAf;AACD,KAFM,EAEJ,UAAUmF,CAAV,EAAa;AACd,aAAOuW,eAAe,CAAC1b,IAAD,EAAOmF,CAAP,EAAUgW,SAAV,CAAtB;AACD,KAJM,CAAP;AAKD,GAPD;;AAQA,MAAIW,WAAW,GAAG,UAAU9b,IAAV,EAAgB;AAChC,WAAO6a,KAAK,CAAC7a,IAAD,EAAO,SAAP,EAAkB4a,cAAlB,CAAZ;AACD,GAFD;;AAGA,MAAImB,eAAe,GAAG,UAAU/b,IAAV,EAAgB;AACpC,QAAImX,KAAK,GAAG4D,WAAW,CAAC/a,IAAD,CAAvB;AACA,WAAOmX,KAAK,CAACvvB,IAAN,CAAW,UAAUud,CAAV,EAAa;AAC7B,aAAOoT,KAAK,CAACpT,CAAD,EAAI,CACd,OADc,EAEd,UAFc,EAGd,OAHc,CAAJ,CAAZ;AAKD,KANM,CAAP;AAOD,GATD;;AAUA,MAAI6W,eAAe,GAAG,UAAUhc,IAAV,EAAgBoX,MAAhB,EAAwBgB,IAAxB,EAA8B;AAClDnZ,IAAAA,KAAK,CAACe,IAAD,EAAO,OAAP,EAAgBoX,MAAM,GAAGgB,IAAzB,CAAL;AACD,GAFD;;AAGA,MAAI6D,kBAAkB,GAAG,UAAU/a,KAAV,EAAiB;AACxC,WAAOwR,KAAK,CAACxR,KAAD,CAAL,GAAe,IAAtB;AACD,GAFD;;AAGA,MAAIgb,oBAAoB,GAAG,UAAUhb,KAAV,EAAiB;AAC1C,WAAO4Y,cAAc,CAAC5Y,KAAD,EAAQwR,KAAR,CAAd,GAA+B,GAAtC;AACD,GAFD;;AAGA,MAAIyJ,eAAe,GAAG,UAAUjb,KAAV,EAAiB;AACrC,WAAO6Z,WAAW,CAAC7Z,KAAD,CAAX,CAAmBrZ,MAAnB,CAA0B,UAAUoP,IAAV,EAAgB;AAC/C,aAAO2iB,yBAAyB,CAACrtB,IAA1B,CAA+B0K,IAA/B,CAAP;AACD,KAFM,CAAP;AAGD,GAJD;;AAKA,MAAImlB,aAAa,GAAG,UAAUlb,KAAV,EAAiB;AACnC,WAAO6Z,WAAW,CAAC7Z,KAAD,CAAX,CAAmBrZ,MAAnB,CAA0B,UAAUoP,IAAV,EAAgB;AAC/C,aAAO4iB,oBAAoB,CAACttB,IAArB,CAA0B0K,IAA1B,CAAP;AACD,KAFM,CAAP;AAGD,GAJD;;AAKA,MAAIolB,YAAY,GAAG,UAAUnb,KAAV,EAAiB;AAClC,WAAO6Z,WAAW,CAAC7Z,KAAD,CAAX,CAAmBza,MAAnB,EAAP;AACD,GAFD;;AAGA,MAAI61B,wBAAwB,GAAG/2B,QAAQ,CAACq0B,yBAAD,CAAvC;AACA,MAAI2C,mBAAmB,GAAGh3B,QAAQ,CAACs0B,oBAAD,CAAlC;AAEA,MAAI2C,KAAK,GAAG1iB,KAAK,CAAC,KAAD,CAAjB;;AACA,MAAI2iB,QAAQ,GAAG,UAAUzc,IAAV,EAAgBnB,QAAhB,EAA0Bkb,MAA1B,EAAkC;AAC/C,WAAOva,MAAM,CAACQ,IAAD,EAAOnB,QAAP,CAAN,CAAuB9X,IAAvB,CAA4B,YAAY;AAC7C,aAAOgzB,MAAM,CAAC/Z,IAAD,CAAN,GAAe,IAAtB;AACD,KAFM,EAEJ,UAAUP,GAAV,EAAe;AAChB,aAAOA,GAAP;AACD,KAJM,CAAP;AAKD,GAND;;AAOA,MAAIid,OAAO,GAAG,UAAU1c,IAAV,EAAgBmb,SAAhB,EAA2B;AACvC,QAAIlb,QAAQ,GAAG,UAAUlG,CAAV,EAAa;AAC1B,aAAOyiB,KAAK,CAACziB,CAAD,CAAL,GAAW2Y,KAAK,CAAC3Y,CAAD,CAAhB,GAAsB8hB,aAAa,CAAC9hB,CAAD,EAAIohB,SAAJ,CAA1C;AACD,KAFD;;AAGA,WAAOsB,QAAQ,CAACzc,IAAD,EAAO,OAAP,EAAgBC,QAAhB,CAAf;AACD,GALD;;AAMA,MAAI0c,OAAO,GAAG,UAAU3c,IAAV,EAAgB;AAC5B,WAAOyc,QAAQ,CAACzc,IAAD,EAAO,QAAP,EAAiB8b,WAAjB,CAAf;AACD,GAFD;;AAGA,MAAIc,QAAQ,GAAG,UAAUvZ,SAAV,EAAqB;AAClC,WAAO3b,GAAG,CAAC6d,SAAS,CAACH,WAAV,CAAsB/B,SAAtB,CAAD,EAAmC,UAAUtL,MAAV,EAAkB;AAC7D,aAAOnP,QAAQ,CAACD,IAAT,CAAcoP,MAAM,CAAClD,OAArB,CAAP;AACD,KAFS,CAAV;AAGD,GAJD;;AAKA,MAAIgoB,WAAW,GAAG,UAAU7c,IAAV,EAAgB8c,IAAhB,EAAsB;AACtC,WAAOtd,MAAM,CAACQ,IAAD,EAAO8c,IAAP,CAAN,CAAmB51B,MAAnB,EAAP;AACD,GAFD;;AAGA,MAAI61B,aAAa,GAAG,UAAU/c,IAAV,EAAgB;AAClC,WAAO,CAACwc,KAAK,CAACxc,IAAD,CAAN,IAAgB6c,WAAW,CAAC7c,IAAD,EAAO,OAAP,CAAlC;AACD,GAFD;;AAGA,MAAIgd,YAAY,GAAG,UAAUC,OAAV,EAAmB/hB,KAAnB,EAA0BgiB,OAA1B,EAAmCn1B,MAAnC,EAA2CgyB,MAA3C,EAAmD9Z,QAAnD,EAA6D;AAC9E,WAAOgd,OAAO,CAACl1B,MAAR,CAAeA,MAAf,EAAuBhB,IAAvB,CAA4B,YAAY;AAC7C,aAAOkZ,QAAQ,CAACuT,MAAM,CAAC0J,OAAD,EAAUhiB,KAAV,CAAP,CAAf;AACD,KAFM,EAEJ,UAAU8E,IAAV,EAAgB;AACjB,aAAO+Z,MAAM,CAAC/Z,IAAD,CAAb;AACD,KAJM,CAAP;AAKD,GAND;;AAOA,MAAImd,YAAY,GAAG,UAAU9Z,SAAV,EAAqBnC,KAArB,EAA4ByY,QAA5B,EAAsC1Z,QAAtC,EAAgDkb,SAAhD,EAA2D;AAC5E,QAAIiC,WAAW,GAAGzK,SAAS,CAACtP,SAAD,EAAY,UAAUrD,IAAV,EAAgB;AACrD,aAAO6c,WAAW,CAAC7c,IAAD,EAAO,OAAP,CAAlB;AACD,KAF0B,CAA3B;AAGA,QAAIpI,OAAO,GAAG2N,SAAS,CAACF,UAAV,CAAqBhC,SAArB,IAAkCuZ,QAAQ,CAACvZ,SAAD,CAA1C,GAAwD+Z,WAAtE;AACA,QAAIF,OAAO,GAAG,CAACt0B,QAAQ,CAACR,IAAT,CAAc+uB,KAAK,CAACrnB,IAAN,CAAWoR,KAAX,CAAd,CAAD,EAAmCpb,MAAnC,CAA0C4B,GAAG,CAACyvB,KAAK,CAACL,SAAN,CAAgBsG,WAAhB,EAA6Blc,KAA7B,CAAD,EAAsC,UAAU4U,GAAV,EAAe;AAC9G,aAAOA,GAAG,CAACpuB,GAAJ,CAAQ,UAAU6D,CAAV,EAAa;AAC1B,eAAOA,CAAC,CAACpI,CAAT;AACD,OAFM,CAAP;AAGD,KAJ0D,CAA7C,CAAd;AAKA,QAAIk6B,SAAS,GAAGt3B,GAAG,CAACqa,UAAD,CAAnB;AACA,WAAO1Y,GAAG,CAACkQ,OAAD,EAAU,UAAU8e,UAAV,EAAsBpD,CAAtB,EAAyB;AAC3C,aAAO0J,YAAY,CAACtG,UAAD,EAAapD,CAAb,EAAgB4J,OAAhB,EAAyBG,SAAzB,EAAoC,UAAUtlB,MAAV,EAAkB;AACvE,YAAIglB,aAAa,CAAChlB,MAAD,CAAjB,EAA2B;AACzB,iBAAO4hB,QAAQ,CAAC5hB,MAAD,EAASojB,SAAT,CAAf;AACD,SAFD,MAEO;AACL,cAAInb,IAAI,GAAG2R,QAAQ,CAACyL,WAAW,CAAC9J,CAAD,CAAZ,EAAiB9tB,QAAjB,CAAnB;AACA,iBAAOw3B,YAAY,CAAChd,IAAD,EAAOsT,CAAP,EAAU4J,OAAV,EAAmBG,SAAnB,EAA8B,UAAUrd,IAAV,EAAgB;AAC/D,mBAAOC,QAAQ,CAACrX,QAAQ,CAACR,IAAT,CAAcsqB,KAAK,CAAC1S,IAAD,CAAnB,CAAD,CAAf;AACD,WAFkB,EAEhBC,QAFgB,CAAnB;AAGD;AACF,OATkB,EAShBA,QATgB,CAAnB;AAUD,KAXS,CAAV;AAYD,GAvBD;;AAwBA,MAAIqd,UAAU,GAAG,UAAUC,OAAV,EAAmB;AAClC,WAAOA,OAAO,CAAC71B,GAAR,CAAY,UAAUqf,CAAV,EAAa;AAC9B,aAAOA,CAAC,GAAG,IAAX;AACD,KAFM,EAEJ5f,KAFI,CAEE,EAFF,CAAP;AAGD,GAJD;;AAKA,MAAIq2B,YAAY,GAAG,UAAUna,SAAV,EAAqBnC,KAArB,EAA4Bia,SAA5B,EAAuC;AACxD,WAAOgC,YAAY,CAAC9Z,SAAD,EAAYnC,KAAZ,EAAmBwb,OAAnB,EAA4BY,UAA5B,EAAwCnC,SAAxC,CAAnB;AACD,GAFD;;AAGA,MAAIsC,mBAAmB,GAAG,UAAUpa,SAAV,EAAqBnC,KAArB,EAA4Bia,SAA5B,EAAuC;AAC/D,WAAOgC,YAAY,CAAC9Z,SAAD,EAAYnC,KAAZ,EAAmBsa,kBAAnB,EAAuC,UAAU+B,OAAV,EAAmB;AAC3E,aAAOA,OAAO,CAACx2B,IAAR,CAAa,YAAY;AAC9B,eAAOo0B,SAAS,CAACuC,YAAV,EAAP;AACD,OAFM,EAEJ,UAAUxC,SAAV,EAAqB;AACtB,eAAOA,SAAS,GAAGC,SAAS,CAACC,UAAV,EAAZ,GAAqC,GAA5C;AACD,OAJM,CAAP;AAKD,KANkB,EAMhBD,SANgB,CAAnB;AAOD,GARD;;AASA,MAAIwC,cAAc,GAAG,UAAUta,SAAV,EAAqBnC,KAArB,EAA4Bia,SAA5B,EAAuC;AAC1D,WAAOgC,YAAY,CAAC9Z,SAAD,EAAYnC,KAAZ,EAAmB2a,aAAnB,EAAkC,UAAU0B,OAAV,EAAmB;AACtE,aAAOA,OAAO,CAACn2B,UAAR,CAAmB+zB,SAAS,CAACuC,YAA7B,CAAP;AACD,KAFkB,EAEhBvC,SAFgB,CAAnB;AAGD,GAJD;;AAKA,MAAIyC,aAAa,GAAG,UAAUva,SAAV,EAAqBnC,KAArB,EAA4B2c,SAA5B,EAAuCnE,SAAvC,EAAkDzZ,QAAlD,EAA4D;AAC9E,QAAItI,IAAI,GAAG8J,MAAM,CAAC4B,SAAD,CAAjB;AACA,QAAI6Z,OAAO,GAAG,CAACt0B,QAAQ,CAACR,IAAT,CAAcy1B,SAAS,CAAC/tB,IAAV,CAAeoR,KAAf,CAAd,CAAD,EAAuCpb,MAAvC,CAA8C4B,GAAG,CAACm2B,SAAS,CAAC/G,SAAV,CAAoBnf,IAApB,EAA0BuJ,KAA1B,CAAD,EAAmC,UAAU4U,GAAV,EAAe;AAC/G,aAAOA,GAAG,CAACpuB,GAAJ,CAAQ,UAAU6D,CAAV,EAAa;AAC1B,eAAOA,CAAC,CAACmJ,CAAT;AACD,OAFM,CAAP;AAGD,KAJ8D,CAAjD,CAAd;AAKA,WAAOhN,GAAG,CAACiQ,IAAD,EAAO,UAAU+e,UAAV,EAAsBpD,CAAtB,EAAyB;AACxC,aAAO0J,YAAY,CAACtG,UAAD,EAAapD,CAAb,EAAgB4J,OAAhB,EAAyBn3B,GAAG,CAACsa,UAAD,CAA5B,EAA0CqZ,SAA1C,EAAqDzZ,QAArD,CAAnB;AACD,KAFS,CAAV;AAGD,GAVD;;AAWA,MAAI6d,eAAe,GAAG,UAAUza,SAAV,EAAqBnC,KAArB,EAA4B2c,SAA5B,EAAuC;AAC3D,WAAOD,aAAa,CAACva,SAAD,EAAYnC,KAAZ,EAAmB2c,SAAnB,EAA8B/B,WAA9B,EAA2C,UAAUyB,OAAV,EAAmB;AAChF,aAAOA,OAAO,CAACn2B,UAAR,CAAmBoZ,SAAnB,CAAP;AACD,KAFmB,CAApB;AAGD,GAJD;;AAKA,MAAIud,aAAa,GAAG,UAAU1a,SAAV,EAAqBnC,KAArB,EAA4B2c,SAA5B,EAAuC;AACzD,WAAOD,aAAa,CAACva,SAAD,EAAYnC,KAAZ,EAAmB2c,SAAnB,EAA8BlB,OAA9B,EAAuCW,UAAvC,CAApB;AACD,GAFD;;AAIA,MAAIU,IAAI,GAAG,UAAUC,OAAV,EAAmB;AAC5B,QAAIp6B,KAAK,GAAGo6B,OAAZ;;AACA,QAAIjzB,GAAG,GAAG,YAAY;AACpB,aAAOnH,KAAP;AACD,KAFD;;AAGA,QAAIia,GAAG,GAAG,UAAUtV,CAAV,EAAa;AACrB3E,MAAAA,KAAK,GAAG2E,CAAR;AACD,KAFD;;AAGA,WAAO;AACLwC,MAAAA,GAAG,EAAEA,GADA;AAEL8S,MAAAA,GAAG,EAAEA;AAFA,KAAP;AAID,GAZD;;AAcA,MAAIogB,QAAQ,GAAG,UAAUhd,KAAV,EAAiB;AAC9B,QAAIyY,QAAQ,GAAG,YAAY;AACzB,aAAOjH,KAAK,CAACxR,KAAD,CAAZ;AACD,KAFD;;AAGA,QAAIid,IAAI,GAAG54B,QAAQ,CAAC,CAAD,CAAnB;;AACA,QAAI64B,SAAS,GAAG,UAAU/a,SAAV,EAAqB8X,SAArB,EAAgC;AAC9C,aAAOwC,cAAc,CAACta,SAAD,EAAYnC,KAAZ,EAAmBia,SAAnB,CAArB;AACD,KAFD;;AAGA,WAAO;AACLhE,MAAAA,KAAK,EAAEwC,QADF;AAELyB,MAAAA,UAAU,EAAEzB,QAFP;AAGLyE,MAAAA,SAAS,EAAEA,SAHN;AAILC,MAAAA,YAAY,EAAEF,IAJT;AAKLG,MAAAA,iBAAiB,EAAE/4B,QAAQ,CAAC,CAAC,CAAD,CAAD,CALtB;AAMLm4B,MAAAA,YAAY,EAAES,IANT;AAOLI,MAAAA,eAAe,EAAE55B,IAPZ;AAQL65B,MAAAA,gBAAgB,EAAE75B,IARb;AASL85B,MAAAA,UAAU,EAAE,IATP;AAUL9O,MAAAA,KAAK,EAAE;AAVF,KAAP;AAYD,GApBD;;AAqBA,MAAI+O,cAAc,GAAG,UAAUC,YAAV,EAAwBzd,KAAxB,EAA+B;AAClD,QAAI0a,UAAU,GAAGoC,IAAI,CAAChM,UAAU,CAAC2M,YAAD,CAAX,CAArB;AACA,QAAIvD,UAAU,GAAG4C,IAAI,CAACtL,KAAK,CAACxR,KAAD,CAAN,CAArB;;AACA,QAAImd,YAAY,GAAG,UAAU1K,KAAV,EAAiB;AAClC,aAAOA,KAAK,GAAGyH,UAAU,CAACpwB,GAAX,EAAR,GAA2B,GAAlC;AACD,KAFD;;AAGA,QAAIszB,iBAAiB,GAAG,UAAUnZ,CAAV,EAAayZ,MAAb,EAAqB;AAC3C,aAAO,CAAC,MAAMzZ,CAAP,CAAP;AACD,KAFD;;AAGA,QAAIuY,YAAY,GAAG,YAAY;AAC7B,aAAOnd,QAAQ,KAAK6a,UAAU,CAACpwB,GAAX,EAAb,GAAgC,GAAvC;AACD,KAFD;;AAGA,QAAIwzB,gBAAgB,GAAG,UAAU7K,KAAV,EAAiB;AACtC,UAAIkL,YAAY,GAAGjD,UAAU,CAAC5wB,GAAX,EAAnB;AACA,UAAI8zB,MAAM,GAAGnL,KAAK,GAAG,GAAR,GAAckL,YAA3B;AACA,UAAIE,QAAQ,GAAGF,YAAY,GAAGC,MAA9B;AACA5E,MAAAA,kBAAkB,CAAChZ,KAAD,EAAQ6d,QAAR,CAAlB;AACAnD,MAAAA,UAAU,CAAC9d,GAAX,CAAeihB,QAAf;AACA3D,MAAAA,UAAU,CAACtd,GAAX,CAAe4U,KAAK,CAACxR,KAAD,CAApB;AACD,KAPD;;AAQA,QAAIkd,SAAS,GAAG,UAAU/a,SAAV,EAAqB8X,SAArB,EAAgC;AAC9C,aAAOsC,mBAAmB,CAACpa,SAAD,EAAYnC,KAAZ,EAAmBia,SAAnB,CAA1B;AACD,KAFD;;AAGA,WAAO;AACLhE,MAAAA,KAAK,EAAEyE,UAAU,CAAC5wB,GADb;AAELowB,MAAAA,UAAU,EAAEA,UAAU,CAACpwB,GAFlB;AAGLozB,MAAAA,SAAS,EAAEA,SAHN;AAILC,MAAAA,YAAY,EAAEA,YAJT;AAKLC,MAAAA,iBAAiB,EAAEA,iBALd;AAMLZ,MAAAA,YAAY,EAAEA,YANT;AAOLa,MAAAA,eAAe,EAAErE,kBAPZ;AAQLsE,MAAAA,gBAAgB,EAAEA,gBARb;AASLC,MAAAA,UAAU,EAAE,IATP;AAUL9O,MAAAA,KAAK,EAAE;AAVF,KAAP;AAYD,GAnCD;;AAoCA,MAAIqP,SAAS,GAAG,UAAUL,YAAV,EAAwBzd,KAAxB,EAA+B;AAC7C,QAAIiW,KAAK,GAAG6G,IAAI,CAACW,YAAD,CAAhB;AACA,QAAIhF,QAAQ,GAAGxC,KAAK,CAACnsB,GAArB;AACA,QAAIqzB,YAAY,GAAG74B,QAAnB;;AACA,QAAI84B,iBAAiB,GAAG,UAAUnZ,CAAV,EAAawO,KAAb,EAAoB;AAC1C,UAAIsL,OAAO,GAAGna,IAAI,CAACC,GAAL,CAASxE,QAAQ,EAAjB,EAAqB4E,CAAC,GAAGwO,KAAzB,CAAd;AACA,aAAO,CAACsL,OAAO,GAAG9Z,CAAX,CAAP;AACD,KAHD;;AAIA,QAAIqZ,gBAAgB,GAAG,UAAU7K,KAAV,EAAiB;AACtC,UAAIoL,QAAQ,GAAGpF,QAAQ,KAAKhG,KAA5B;AACAsG,MAAAA,aAAa,CAAC/Y,KAAD,EAAQ6d,QAAR,CAAb;AACA5H,MAAAA,KAAK,CAACrZ,GAAN,CAAUihB,QAAV;AACD,KAJD;;AAKA,QAAIX,SAAS,GAAG,UAAU/a,SAAV,EAAqB8X,SAArB,EAAgC;AAC9C,aAAOwC,cAAc,CAACta,SAAD,EAAYnC,KAAZ,EAAmBia,SAAnB,CAArB;AACD,KAFD;;AAGA,WAAO;AACLhE,MAAAA,KAAK,EAAEwC,QADF;AAELyB,MAAAA,UAAU,EAAEzB,QAFP;AAGLyE,MAAAA,SAAS,EAAEA,SAHN;AAILC,MAAAA,YAAY,EAAEA,YAJT;AAKLC,MAAAA,iBAAiB,EAAEA,iBALd;AAMLZ,MAAAA,YAAY,EAAEnd,QANT;AAOLge,MAAAA,eAAe,EAAEtE,aAPZ;AAQLuE,MAAAA,gBAAgB,EAAEA,gBARb;AASLC,MAAAA,UAAU,EAAE,KATP;AAUL9O,MAAAA,KAAK,EAAE;AAVF,KAAP;AAYD,GA5BD;;AA6BA,MAAIuP,UAAU,GAAG,UAAUrqB,OAAV,EAAmBsiB,KAAnB,EAA0B;AACzC,QAAImE,YAAY,GAAGgB,wBAAwB,GAAG9D,IAA3B,CAAgCrB,KAAhC,CAAnB;;AACA,QAAImE,YAAY,KAAK,IAArB,EAA2B;AACzB,aAAOoD,cAAc,CAACpD,YAAY,CAAC,CAAD,CAAb,EAAkBzmB,OAAlB,CAArB;AACD;;AACD,QAAI8mB,UAAU,GAAGY,mBAAmB,GAAG/D,IAAtB,CAA2BrB,KAA3B,CAAjB;;AACA,QAAIwE,UAAU,KAAK,IAAnB,EAAyB;AACvB,UAAIJ,QAAQ,GAAGrb,QAAQ,CAACyb,UAAU,CAAC,CAAD,CAAX,EAAgB,EAAhB,CAAvB;AACA,aAAOqD,SAAS,CAACzD,QAAD,EAAW1mB,OAAX,CAAhB;AACD;;AACD,QAAIsqB,aAAa,GAAGzM,KAAK,CAAC7d,OAAD,CAAzB;AACA,WAAOmqB,SAAS,CAACG,aAAD,EAAgBtqB,OAAhB,CAAhB;AACD,GAZD;;AAaA,MAAIuqB,YAAY,GAAG,UAAUle,KAAV,EAAiB;AAClC,QAAIiW,KAAK,GAAG4D,WAAW,CAAC7Z,KAAD,CAAvB;AACA,WAAOiW,KAAK,CAACpwB,IAAN,CAAW,YAAY;AAC5B,aAAOm3B,QAAQ,CAAChd,KAAD,CAAf;AACD,KAFM,EAEJ,UAAUiE,CAAV,EAAa;AACd,aAAO+Z,UAAU,CAAChe,KAAD,EAAQiE,CAAR,CAAjB;AACD,KAJM,CAAP;AAKD,GAPD;;AAQA,MAAIka,SAAS,GAAG;AACdD,IAAAA,YAAY,EAAEA,YADA;AAEdJ,IAAAA,SAAS,EAAEA,SAFG;AAGdN,IAAAA,cAAc,EAAEA,cAHF;AAIdR,IAAAA,QAAQ,EAAEA;AAJI,GAAhB;;AAOA,MAAIoB,WAAW,GAAG,UAAUC,MAAV,EAAkBC,MAAlB,EAA0BC,MAA1B,EAAkCC,MAAlC,EAA0CC,QAA1C,EAAoDC,aAApD,EAAmE;AACnF,WAAO;AACLL,MAAAA,MAAM,EAAEA,MADH;AAELC,MAAAA,MAAM,EAAEA,MAFH;AAGLC,MAAAA,MAAM,EAAEA,MAHH;AAILC,MAAAA,MAAM,EAAEA,MAJH;AAKLC,MAAAA,QAAQ,EAAEA,QALL;AAMLC,MAAAA,aAAa,EAAEA;AANV,KAAP;AAQD,GATD;;AAUA,MAAIC,iBAAiB,GAAG,UAAUC,KAAV,EAAiBC,UAAjB,EAA6B;AACnD,QAAIC,YAAY,GAAGF,KAAK,CAACpoB,IAAN,CAAWE,OAA9B;AACA,QAAIqoB,SAAS,GAAGH,KAAK,CAACpoB,IAAN,CAAWC,IAA3B;AACA,QAAI4nB,MAAM,GAAGU,SAAb;AACA,QAAIT,MAAM,GAAGQ,YAAb;AACA,QAAIP,MAAM,GAAG,CAAb;AACA,QAAIC,MAAM,GAAG,CAAb;AACA,QAAIC,QAAQ,GAAG,EAAf;AACA,QAAIC,aAAa,GAAG,EAApB;AACAxpB,IAAAA,MAAM,CAAC0pB,KAAK,CAACxc,MAAP,EAAe,UAAUtL,MAAV,EAAkB;AACrC2nB,MAAAA,QAAQ,CAACz2B,IAAT,CAAc8O,MAAd;;AACA,UAAI+nB,UAAU,CAAC/nB,MAAD,CAAd,EAAwB;AACtB4nB,QAAAA,aAAa,CAAC12B,IAAd,CAAmB8O,MAAnB;AACA,YAAIgB,QAAQ,GAAGhB,MAAM,CAACF,GAAtB;AACA,YAAIooB,MAAM,GAAGlnB,QAAQ,GAAGhB,MAAM,CAACC,OAAlB,GAA4B,CAAzC;AACA,YAAIgB,QAAQ,GAAGjB,MAAM,CAACD,MAAtB;AACA,YAAIooB,MAAM,GAAGlnB,QAAQ,GAAGjB,MAAM,CAACE,OAAlB,GAA4B,CAAzC;;AACA,YAAIc,QAAQ,GAAGumB,MAAf,EAAuB;AACrBA,UAAAA,MAAM,GAAGvmB,QAAT;AACD,SAFD,MAEO,IAAIknB,MAAM,GAAGT,MAAb,EAAqB;AAC1BA,UAAAA,MAAM,GAAGS,MAAT;AACD;;AACD,YAAIjnB,QAAQ,GAAGumB,MAAf,EAAuB;AACrBA,UAAAA,MAAM,GAAGvmB,QAAT;AACD,SAFD,MAEO,IAAIknB,MAAM,GAAGT,MAAb,EAAqB;AAC1BA,UAAAA,MAAM,GAAGS,MAAT;AACD;AACF;AACF,KAnBK,CAAN;AAoBA,WAAOb,WAAW,CAACC,MAAD,EAASC,MAAT,EAAiBC,MAAjB,EAAyBC,MAAzB,EAAiCC,QAAjC,EAA2CC,aAA3C,CAAlB;AACD,GA9BD;;AA+BA,MAAIQ,QAAQ,GAAG,UAAUnc,IAAV,EAAgBoc,YAAhB,EAA8BC,QAA9B,EAAwC;AACrD,QAAIxoB,GAAG,GAAGmM,IAAI,CAACqc,QAAD,CAAJ,CAAezrB,OAAzB;AACA,QAAI0rB,EAAE,GAAG3rB,YAAY,CAACX,OAAb,CAAqB,IAArB,CAAT;AACAwU,IAAAA,MAAM,CAAC8X,EAAD,EAAK3rB,YAAY,CAACX,OAAb,CAAqB,IAArB,CAAL,CAAN;AACA,QAAIjO,CAAC,GAAGq6B,YAAY,GAAG5X,MAAH,GAAYC,OAAhC;AACA1iB,IAAAA,CAAC,CAAC8R,GAAD,EAAMyoB,EAAN,CAAD;AACD,GAND;;AAOA,MAAIC,UAAU,GAAG,UAAUvc,IAAV,EAAgB6b,KAAhB,EAAuBW,KAAvB,EAA8BV,UAA9B,EAA0C;AACzD,QAAIC,YAAY,GAAGF,KAAK,CAACpoB,IAAN,CAAWE,OAA9B;AACA,QAAIqoB,SAAS,GAAGH,KAAK,CAACpoB,IAAN,CAAWC,IAA3B;;AACA,SAAK,IAAInO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGy2B,SAApB,EAA+Bz2B,CAAC,EAAhC,EAAoC;AAClC,UAAI62B,YAAY,GAAG,KAAnB;;AACA,WAAK,IAAIz0B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGo0B,YAApB,EAAkCp0B,CAAC,EAAnC,EAAuC;AACrC,YAAI,EAAEpC,CAAC,GAAGi3B,KAAK,CAAClB,MAAV,IAAoB/1B,CAAC,GAAGi3B,KAAK,CAAChB,MAA9B,IAAwC7zB,CAAC,GAAG60B,KAAK,CAACjB,MAAlD,IAA4D5zB,CAAC,GAAG60B,KAAK,CAACf,MAAxE,CAAJ,EAAqF;AACnF,cAAIgB,QAAQ,GAAGnb,SAAS,CAACnC,KAAV,CAAgB0c,KAAhB,EAAuBt2B,CAAvB,EAA0BoC,CAA1B,EAA6B7D,MAA7B,CAAoCg4B,UAApC,EAAgDt5B,MAAhD,EAAf;;AACA,cAAIi6B,QAAJ,EAAc;AACZN,YAAAA,QAAQ,CAACnc,IAAD,EAAOoc,YAAP,EAAqB72B,CAArB,CAAR;AACD,WAFD,MAEO;AACL62B,YAAAA,YAAY,GAAG,IAAf;AACD;AACF;AACF;AACF;AACF,GAhBD;;AAiBA,MAAIM,KAAK,GAAG,UAAUC,OAAV,EAAmBH,KAAnB,EAA0BX,KAA1B,EAAiCe,UAAjC,EAA6C;AACvDzqB,IAAAA,MAAM,CAAC0pB,KAAK,CAACloB,OAAP,EAAgB,UAAUkb,GAAV,EAAe;AACnC,UAAIA,GAAG,CAAC/a,MAAJ,GAAa0oB,KAAK,CAACjB,MAAnB,IAA6B1M,GAAG,CAAC/a,MAAJ,GAAa0oB,KAAK,CAACf,MAApD,EAA4D;AAC1DpW,QAAAA,QAAQ,CAACwJ,GAAG,CAACje,OAAL,CAAR;AACD;AACF,KAJK,CAAN;AAKA,QAAIisB,SAAS,GAAG/4B,MAAM,CAAC0Y,UAAU,CAACmgB,OAAD,EAAU,IAAV,CAAX,EAA4B,UAAU9oB,GAAV,EAAe;AAC/D,aAAOA,GAAG,CAACvD,GAAJ,CAAQc,iBAAR,KAA8B,CAArC;AACD,KAFqB,CAAtB;AAGA1N,IAAAA,IAAI,CAACm5B,SAAD,EAAYxX,QAAZ,CAAJ;;AACA,QAAImX,KAAK,CAACjB,MAAN,KAAiBiB,KAAK,CAACf,MAAvB,IAAiCe,KAAK,CAAClB,MAAN,KAAiBkB,KAAK,CAAChB,MAA5D,EAAoE;AAClE93B,MAAAA,IAAI,CAAC8Y,UAAU,CAACmgB,OAAD,EAAU,OAAV,CAAX,EAA+B,UAAU5gB,IAAV,EAAgB;AACjD5B,QAAAA,MAAM,CAAC4B,IAAD,EAAO,SAAP,CAAN;AACA5B,QAAAA,MAAM,CAAC4B,IAAD,EAAO,SAAP,CAAN;AACD,OAHG,CAAJ;AAID;;AACD5B,IAAAA,MAAM,CAACwiB,OAAD,EAAUje,eAAV,CAAN;AACAvE,IAAAA,MAAM,CAACwiB,OAAD,EAAU,yBAAV,CAAN;AACA,QAAIzF,SAAS,GAAGkE,SAAS,CAACD,YAAV,CAAuBwB,OAAvB,CAAhB;AACAzF,IAAAA,SAAS,CAACqD,gBAAV,CAA2BqC,UAA3B;AACD,GApBD;;AAqBA,MAAIE,kBAAkB,GAAG,UAAU7f,KAAV,EAAiBmC,SAAjB,EAA4B8X,SAA5B,EAAuCsF,KAAvC,EAA8C;AACrE,QAAIA,KAAK,CAACjB,MAAN,KAAiB,CAAjB,IAAsBnc,SAAS,CAAC3L,IAAV,CAAeE,OAAf,KAA2B6oB,KAAK,CAACf,MAAN,GAAe,CAApE,EAAuE;AACrE,aAAO,CAAP;AACD;;AACD,QAAIsB,SAAS,GAAGrD,cAAc,CAACta,SAAD,EAAYnC,KAAZ,EAAmBia,SAAnB,CAA9B;AACA,QAAI8F,YAAY,GAAG72B,KAAK,CAAC42B,SAAD,EAAY,UAAU72B,GAAV,EAAegtB,KAAf,EAAsB;AACxD,aAAOhtB,GAAG,GAAGgtB,KAAb;AACD,KAFuB,EAErB,CAFqB,CAAxB;AAGA,QAAI+J,iBAAiB,GAAG92B,KAAK,CAAC42B,SAAS,CAACl4B,KAAV,CAAgB23B,KAAK,CAACjB,MAAtB,EAA8BiB,KAAK,CAACf,MAAN,GAAe,CAA7C,CAAD,EAAkD,UAAUv1B,GAAV,EAAegtB,KAAf,EAAsB;AACnG,aAAOhtB,GAAG,GAAGgtB,KAAb;AACD,KAF4B,EAE1B,CAF0B,CAA7B;AAGA,QAAI4H,QAAQ,GAAGmC,iBAAiB,GAAGD,YAApB,GAAmC9F,SAAS,CAACC,UAAV,EAAlD;AACA,QAAIzH,KAAK,GAAGoL,QAAQ,GAAG5D,SAAS,CAACC,UAAV,EAAvB;AACA,WAAOD,SAAS,CAACkD,YAAV,CAAuB1K,KAAvB,CAAP;AACD,GAdD;;AAeA,MAAIwN,OAAO,GAAG,UAAUjgB,KAAV,EAAiBwP,gBAAjB,EAAmC;AAC/C,QAAIqP,UAAU,GAAG,UAAU/nB,MAAV,EAAkB;AACjC,aAAO/Q,EAAE,CAAC+Q,MAAM,CAACnD,OAAR,EAAiB6b,gBAAjB,CAAT;AACD,KAFD;;AAGA,QAAIkQ,OAAO,GAAGzP,IAAI,CAACjQ,KAAD,CAAlB;AACA,QAAI+C,IAAI,GAAGzC,SAAS,CAACof,OAAD,CAApB;AACA,QAAIzF,SAAS,GAAGkE,SAAS,CAACD,YAAV,CAAuBle,KAAvB,CAAhB;AACA,QAAIkgB,YAAY,GAAG7b,SAAS,CAACvB,QAAV,CAAmBC,IAAnB,CAAnB;AACA,QAAIod,YAAY,GAAGxB,iBAAiB,CAACuB,YAAD,EAAerB,UAAf,CAApC;AACA,QAAIjrB,QAAQ,GAAG,YAAY4b,gBAAZ,GAA+B,GAA/B,GAAqC,UAArC,GAAkDA,gBAAlD,GAAqE,GAApF;AACA,QAAI4Q,eAAe,GAAG5gB,gBAAgB,CAACkgB,OAAD,EAAU,OAAV,EAAmB,UAAU5gB,IAAV,EAAgB;AACvE,aAAO/Y,EAAE,CAAC+Y,IAAD,EAAOlL,QAAP,CAAT;AACD,KAFqC,CAAtC;AAGAnN,IAAAA,IAAI,CAAC25B,eAAD,EAAkBhY,QAAlB,CAAJ;AACAkX,IAAAA,UAAU,CAACvc,IAAD,EAAOmd,YAAP,EAAqBC,YAArB,EAAmCtB,UAAnC,CAAV;AACA,QAAID,KAAK,GAAGva,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAZ;AACA,QAAI2f,UAAU,GAAGE,kBAAkB,CAAC7f,KAAD,EAAQ4e,KAAR,EAAe3E,SAAf,EAA0BkG,YAA1B,CAAnC;AACAV,IAAAA,KAAK,CAACC,OAAD,EAAUS,YAAV,EAAwBD,YAAxB,EAAsCP,UAAtC,CAAL;AACA,WAAOD,OAAP;AACD,GAnBD;;AAqBA,MAAIW,IAAI,GAAG,MAAX;;AAEA,MAAIC,MAAM,GAAG,UAAU3sB,OAAV,EAAmB;AAC9B,WAAOpR,IAAI,CAACoR,OAAD,CAAJ,KAAkB,KAAlB,GAA0B,CAA1B,GAA8B6U,SAAS,CAAC7U,OAAD,CAAT,CAAmB9N,IAAnB,CAAwB,YAAY;AACvE,aAAOiU,QAAQ,CAACnG,OAAD,CAAR,CAAkB3P,MAAzB;AACD,KAFoC,EAElC,UAAUsD,CAAV,EAAa;AACd,aAAOA,CAAC,CAACtD,MAAT;AACD,KAJoC,CAArC;AAKD,GAND;;AAOA,MAAIu8B,4BAA4B,GAAG,UAAUzlB,EAAV,EAAc;AAC/C,WAAO0N,SAAS,CAAC1N,EAAD,CAAT,CAAcjU,MAAd,CAAqB,UAAUsM,IAAV,EAAgB;AAC1C,aAAOA,IAAI,CAAC9E,IAAL,GAAYrK,MAAZ,KAAuB,CAAvB,IAA4BmP,IAAI,CAACrL,OAAL,CAAau4B,IAAb,IAAqB,CAAC,CAAzD;AACD,KAFM,EAEJr6B,MAFI,EAAP;AAGD,GAJD;;AAKA,MAAIw6B,0BAA0B,GAAG,CAC/B,KAD+B,EAE/B,IAF+B,CAAjC;;AAIA,MAAIC,gBAAgB,GAAG,UAAU3sB,IAAV,EAAgB;AACrC,QAAI4sB,iBAAiB,GAAGH,4BAA4B,CAACzsB,IAAD,CAApD;AACA,WAAO4sB,iBAAiB,IAAIv4B,QAAQ,CAACq4B,0BAAD,EAA6Bj+B,IAAI,CAACuR,IAAD,CAAjC,CAApC;AACD,GAHD;;AAKA,MAAI6S,KAAK,GAAG,UAAUhT,OAAV,EAAmB;AAC7B,WAAOuI,UAAU,CAACvI,OAAD,EAAU8sB,gBAAV,CAAjB;AACD,GAFD;;AAGA,MAAIE,MAAM,GAAG,UAAUhtB,OAAV,EAAmB;AAC9B,WAAOitB,aAAa,CAACjtB,OAAD,EAAU8sB,gBAAV,CAApB;AACD,GAFD;;AAGA,MAAIG,aAAa,GAAG,UAAUxuB,KAAV,EAAiBmJ,SAAjB,EAA4B;AAC9C,QAAIY,OAAO,GAAG,UAAUxI,OAAV,EAAmB;AAC/B,UAAI6H,UAAU,GAAG1B,QAAQ,CAACnG,OAAD,CAAzB;;AACA,WAAK,IAAIrL,CAAC,GAAGkT,UAAU,CAACxX,MAAX,GAAoB,CAAjC,EAAoCsE,CAAC,IAAI,CAAzC,EAA4CA,CAAC,EAA7C,EAAiD;AAC/C,YAAIyR,KAAK,GAAGyB,UAAU,CAAClT,CAAD,CAAtB;;AACA,YAAIiT,SAAS,CAACxB,KAAD,CAAb,EAAsB;AACpB,iBAAOrS,QAAQ,CAACR,IAAT,CAAc6S,KAAd,CAAP;AACD;;AACD,YAAIsC,GAAG,GAAGF,OAAO,CAACpC,KAAD,CAAjB;;AACA,YAAIsC,GAAG,CAACrW,MAAJ,EAAJ,EAAkB;AAChB,iBAAOqW,GAAP;AACD;AACF;;AACD,aAAO3U,QAAQ,CAACtC,IAAT,EAAP;AACD,KAbD;;AAcA,WAAO+W,OAAO,CAAC/J,KAAD,CAAd;AACD,GAhBD;;AAkBA,MAAIyuB,sBAAsB,GAAG;AAC3BzuB,IAAAA,KAAK,EAAE,CACL,KADK,EAEL,KAFK;AADoB,GAA7B;;AAMA,MAAI0uB,UAAU,GAAG,YAAY;AAC3B,QAAIzB,EAAE,GAAG3rB,YAAY,CAACX,OAAb,CAAqB,IAArB,CAAT;AACAwU,IAAAA,MAAM,CAAC8X,EAAD,EAAK3rB,YAAY,CAACX,OAAb,CAAqB,IAArB,CAAL,CAAN;AACA,WAAOssB,EAAP;AACD,GAJD;;AAKA,MAAI0B,SAAS,GAAG,YAAY;AAC1B,WAAOrtB,YAAY,CAACX,OAAb,CAAqB,KAArB,CAAP;AACD,GAFD;;AAGA,MAAIiuB,cAAc,GAAG,YAAY;AAC/B,WAAOttB,YAAY,CAACX,OAAb,CAAqB,UAArB,CAAP;AACD,GAFD;;AAGA,MAAIvG,OAAO,GAAG,UAAUsS,IAAV,EAAgB9L,GAAhB,EAAqB8J,KAArB,EAA4B;AACxC,QAAI4iB,OAAO,GAAGvP,MAAM,CAACrR,IAAD,EAAO9L,GAAP,CAApB;AACAkC,IAAAA,MAAM,CAAC4H,KAAD,EAAQ,UAAUxV,CAAV,EAAamD,CAAb,EAAgB;AAC5B,UAAInD,CAAC,KAAK,IAAV,EAAgB;AACd4V,QAAAA,MAAM,CAACwiB,OAAD,EAAUj1B,CAAV,CAAN;AACD,OAFD,MAEO;AACLmS,QAAAA,GAAG,CAAC8iB,OAAD,EAAUj1B,CAAV,EAAanD,CAAb,CAAH;AACD;AACF,KANK,CAAN;AAOA,WAAOo4B,OAAP;AACD,GAVD;;AAWA,MAAIuB,YAAY,GAAG,UAAUniB,IAAV,EAAgB;AACjC,WAAOA,IAAP;AACD,GAFD;;AAGA,MAAIoiB,MAAM,GAAG,UAAU7uB,GAAV,EAAe;AAC1B,WAAO,YAAY;AACjB,aAAOqB,YAAY,CAACX,OAAb,CAAqB,IAArB,EAA2BV,GAAG,CAACgB,GAA/B,CAAP;AACD,KAFD;AAGD,GAJD;;AAKA,MAAI8tB,YAAY,GAAG,UAAUC,OAAV,EAAmBC,OAAnB,EAA4BC,OAA5B,EAAqC;AACtD,QAAIC,OAAO,GAAG5a,KAAK,CAACya,OAAD,CAAnB;AACA,WAAOG,OAAO,CAAC/6B,GAAR,CAAY,UAAUg7B,SAAV,EAAqB;AACtC,UAAIC,cAAc,GAAGH,OAAO,CAACzhB,IAAR,CAAa,GAAb,CAArB;AACA,UAAIxG,OAAO,GAAGsC,WAAW,CAAC6lB,SAAD,EAAYC,cAAZ,EAA4B,UAAU9tB,OAAV,EAAmB;AACtE,eAAOa,IAAI,CAACb,OAAD,EAAUytB,OAAV,CAAX;AACD,OAFwB,CAAzB;AAGA,aAAOp4B,KAAK,CAACqQ,OAAD,EAAU,UAAUrP,IAAV,EAAgBmP,MAAhB,EAAwB;AAC5C,YAAIuoB,YAAY,GAAG1R,OAAO,CAAC7W,MAAD,CAA1B;AACA+D,QAAAA,MAAM,CAACwkB,YAAD,EAAe,iBAAf,CAAN;AACAna,QAAAA,MAAM,CAACvd,IAAD,EAAO03B,YAAP,CAAN;AACA,eAAOA,YAAP;AACD,OALW,EAKTL,OALS,CAAZ;AAMD,KAXM,EAWJp7B,KAXI,CAWEo7B,OAXF,CAAP;AAYD,GAdD;;AAeA,MAAIM,0BAA0B,GAAG,UAAU7R,QAAV,EAAoB1S,KAApB,EAA2B;AAC1DlI,IAAAA,MAAM,CAAC2rB,sBAAD,EAAyB,UAAUe,eAAV,EAA2BC,aAA3B,EAA0C;AACvE,aAAO5kB,MAAM,CAAC6S,QAAD,EAAW+R,aAAX,CAAN,CAAgCh7B,MAAhC,CAAuC,UAAUi7B,SAAV,EAAqB;AACjE,eAAO35B,QAAQ,CAACy5B,eAAD,EAAkBE,SAAlB,CAAf;AACD,OAFM,EAEJr7B,IAFI,CAEC,UAAUq7B,SAAV,EAAqB;AAC3B,eAAOllB,GAAG,CAACQ,KAAD,EAAQykB,aAAR,EAAuBC,SAAvB,CAAV;AACD,OAJM,CAAP;AAKD,KANK,CAAN;AAOD,GARD;;AASA,MAAIC,cAAc,GAAG,UAAUC,MAAV,EAAkB3vB,GAAlB,EAAuB4vB,cAAvB,EAAuC;AAC1D,QAAIC,QAAQ,GAAG,UAAUC,IAAV,EAAgB/kB,KAAhB,EAAuB;AACpCvT,MAAAA,IAAI,CAACs4B,IAAI,CAACxuB,OAAN,EAAeyJ,KAAf,CAAJ;AACAoB,MAAAA,QAAQ,CAACpB,KAAD,EAAQ,QAAR,CAAR;;AACA,UAAI+kB,IAAI,CAACnrB,OAAL,KAAiB,CAArB,EAAwB;AACtBwH,QAAAA,QAAQ,CAACpB,KAAD,EAAQ,OAAR,CAAR;AACD;AACF,KAND;;AAOA,QAAIikB,OAAO,GAAG,UAAUc,IAAV,EAAgB;AAC5B,UAAIC,IAAI,GAAGtpB,KAAK,CAACqpB,IAAI,CAACxuB,OAAN,CAAhB;AACA,UAAI0rB,EAAE,GAAG3rB,YAAY,CAACX,OAAb,CAAqBxQ,IAAI,CAAC4/B,IAAI,CAACxuB,OAAN,CAAzB,EAAyCyuB,IAAI,CAAC/uB,GAA9C,CAAT;AACA,UAAIiuB,OAAO,GAAGW,cAAc,CAACh8B,KAAf,CAAqB,CACjC,QADiC,EAEjC,IAFiC,EAGjC,GAHiC,EAIjC,GAJiC,EAKjC,MALiC,EAMjC,MANiC,EAOjC,IAPiC,EAQjC,IARiC,EASjC,IATiC,EAUjC,IAViC,EAWjC,IAXiC,EAYjC,IAZiC,EAajC,GAbiC,EAcjC,KAdiC,CAArB,CAAd;AAgBA,UAAIo8B,QAAQ,GAAGf,OAAO,CAACt9B,MAAR,GAAiB,CAAjB,GAAqBm9B,YAAY,CAACgB,IAAI,CAACxuB,OAAN,EAAe0rB,EAAf,EAAmBiC,OAAnB,CAAjC,GAA+DjC,EAA9E;AACA9X,MAAAA,MAAM,CAAC8a,QAAD,EAAW3uB,YAAY,CAACX,OAAb,CAAqB,IAArB,CAAX,CAAN;AACAmvB,MAAAA,QAAQ,CAACC,IAAD,EAAO9C,EAAP,CAAR;AACAsC,MAAAA,0BAA0B,CAACQ,IAAI,CAACxuB,OAAN,EAAe0rB,EAAf,CAA1B;AACA2C,MAAAA,MAAM,CAACG,IAAI,CAACxuB,OAAN,EAAe0rB,EAAf,CAAN;AACA,aAAOA,EAAP;AACD,KAzBD;;AA0BA,QAAIiD,MAAM,GAAG,UAAUH,IAAV,EAAgB;AAC3B,UAAI9vB,GAAG,GAAGyG,KAAK,CAACqpB,IAAI,CAACxuB,OAAN,CAAf;AACA,UAAIie,GAAG,GAAGle,YAAY,CAACX,OAAb,CAAqBxQ,IAAI,CAAC4/B,IAAI,CAACxuB,OAAN,CAAzB,EAAyCtB,GAAG,CAACgB,GAA7C,CAAV;AACA6uB,MAAAA,QAAQ,CAACC,IAAD,EAAOvQ,GAAP,CAAR;AACAoQ,MAAAA,MAAM,CAACG,IAAI,CAACxuB,OAAN,EAAeie,GAAf,CAAN;AACA,aAAOA,GAAP;AACD,KAND;;AAOA,WAAO;AACLA,MAAAA,GAAG,EAAE0Q,MADA;AAELC,MAAAA,QAAQ,EAAEvB,cAFL;AAGLpqB,MAAAA,GAAG,EAAEsqB,MAAM,CAAC7uB,GAAD,CAHN;AAILyM,MAAAA,IAAI,EAAEuiB,OAJD;AAKL70B,MAAAA,OAAO,EAAEA,OALJ;AAMLg2B,MAAAA,GAAG,EAAE1B;AANA,KAAP;AAQD,GAjDD;;AAkDA,MAAI2B,KAAK,GAAG,UAAUpwB,GAAV,EAAe;AACzB,WAAO;AACLuf,MAAAA,GAAG,EAAEmP,SADA;AAELwB,MAAAA,QAAQ,EAAEvB,cAFL;AAGLpqB,MAAAA,GAAG,EAAEsqB,MAAM,CAAC7uB,GAAD,CAHN;AAILyM,MAAAA,IAAI,EAAEgiB,UAJD;AAKLt0B,MAAAA,OAAO,EAAEy0B,YALJ;AAMLuB,MAAAA,GAAG,EAAE1B;AANA,KAAP;AAQD,GATD;;AAWA,MAAI4B,UAAU,GAAG,UAAUvwB,IAAV,EAAgBC,KAAhB,EAAuB;AACtC,QAAIC,GAAG,GAAGD,KAAK,IAAIE,QAAnB;AACA,QAAIC,GAAG,GAAGF,GAAG,CAACG,aAAJ,CAAkB,KAAlB,CAAV;AACAD,IAAAA,GAAG,CAACE,SAAJ,GAAgBN,IAAhB;AACA,WAAO2H,QAAQ,CAACpG,YAAY,CAACZ,OAAb,CAAqBP,GAArB,CAAD,CAAf;AACD,GALD;;AAMA,MAAIowB,SAAS,GAAG,UAAUC,KAAV,EAAiB;AAC/B,WAAOp8B,GAAG,CAACo8B,KAAD,EAAQlvB,YAAY,CAACZ,OAArB,CAAV;AACD,GAFD;;AAIA,MAAI+vB,WAAW,GAAG,UAAUjjB,GAAV,EAAe;AAC/B,WAAOA,GAAG,CAACvH,QAAJ,CAAaxL,WAAb,EAAP;AACD,GAFD;;AAGA,MAAIi2B,SAAS,GAAG,UAAUC,MAAV,EAAkB;AAChC,WAAOrvB,YAAY,CAACZ,OAAb,CAAqBiwB,MAAM,CAAC1nB,OAAP,EAArB,CAAP;AACD,GAFD;;AAGA,MAAI2nB,eAAe,GAAG,UAAUpjB,GAAV,EAAe;AACnC,WAAOA,GAAG,CAACsT,qBAAJ,GAA4B+C,KAAnC;AACD,GAFD;;AAGA,MAAIgN,cAAc,GAAG,UAAUrjB,GAAV,EAAe;AAClC,WAAOA,GAAG,CAACsT,qBAAJ,GAA4BC,MAAnC;AACD,GAFD;;AAGA,MAAIpH,SAAS,GAAG,UAAUgX,MAAV,EAAkB;AAChC,WAAO,UAAUpvB,OAAV,EAAmB;AACxB,aAAOa,IAAI,CAACb,OAAD,EAAUmvB,SAAS,CAACC,MAAD,CAAnB,CAAX;AACD,KAFD;AAGD,GAJD;;AAKA,MAAIG,cAAc,GAAG,UAAUntB,IAAV,EAAgB;AACnC,WAAOA,IAAI,GAAGA,IAAI,CAACvJ,OAAL,CAAa,KAAb,EAAoB,EAApB,CAAH,GAA6B,EAAxC;AACD,GAFD;;AAGA,MAAI22B,WAAW,GAAG,UAAUptB,IAAV,EAAgB;AAChC,WAAO,gBAAgB1K,IAAhB,CAAqB0K,IAArB,IAA6BA,IAAI,GAAG,IAApC,GAA2CA,IAAlD;AACD,GAFD;;AAGA,MAAIqtB,eAAe,GAAG,UAAUpjB,KAAV,EAAiB;AACrC9C,IAAAA,MAAM,CAAC8C,KAAD,EAAQ,gBAAR,CAAN;;AACA,QAAIqjB,oBAAoB,GAAG,UAAU1vB,OAAV,EAAmB;AAC5C,aAAOuJ,MAAM,CAACvJ,OAAD,EAAU,gBAAV,CAAb;AACD,KAFD;;AAGAlN,IAAAA,IAAI,CAAC6Q,KAAK,CAAC0I,KAAD,CAAN,EAAeqjB,oBAAf,CAAJ;AACA58B,IAAAA,IAAI,CAACiQ,OAAO,CAACsJ,KAAD,CAAR,EAAiBqjB,oBAAjB,CAAJ;AACD,GAPD;;AAQA,MAAIC,aAAa,GAAG,UAAUP,MAAV,EAAkBnjB,GAAlB,EAAuB;AACzC,QAAIrB,GAAG,GAAGwkB,MAAM,CAAC1vB,GAAP,CAAWkwB,QAAX,CAAoB3jB,GAApB,EAAyB,OAAzB,KAAqCmjB,MAAM,CAAC1vB,GAAP,CAAWmwB,SAAX,CAAqB5jB,GAArB,EAA0B,OAA1B,CAA/C;AACA,WAAOlY,QAAQ,CAACD,IAAT,CAAc8W,GAAd,EAAmB1X,MAAnB,CAA0ByH,UAA1B,CAAP;AACD,GAHD;;AAIA,MAAIm1B,YAAY,GAAG,UAAU9gC,KAAV,EAAiB;AAClC,WAAO,mBAAmB0I,IAAnB,CAAwB1I,KAAxB,CAAP;AACD,GAFD;;AAGA,MAAI+gC,OAAO,GAAG,UAAU/gC,KAAV,EAAiB;AAC7B,WAAO,oBAAoB0I,IAApB,CAAyB1I,KAAzB,CAAP;AACD,GAFD;;AAGA,MAAIghC,iBAAiB,GAAG,UAAUZ,MAAV,EAAkB;AACxC,WAAOrvB,YAAY,CAACZ,OAAb,CAAqBiwB,MAAM,CAACa,SAAP,CAAiBrU,QAAjB,EAArB,CAAP;AACD,GAFD;;AAIA,MAAIqU,SAAS,GAAG,UAAUC,UAAV,EAAsB;AACpC,WAAO9U,IAAI,CAAC8U,UAAU,CAAC/5B,GAAX,EAAD,EAAmBzF,QAAQ,CAAC,EAAD,CAA3B,EAAiCC,QAAjC,EAA2CoF,IAA3C,CAAX;AACD,GAFD;;AAGA,MAAIo6B,UAAU,GAAG,UAAUD,UAAV,EAAsB;AACrC,QAAIE,OAAO,GAAG,UAAUjwB,IAAV,EAAgBpR,IAAhB,EAAsB;AAClC,aAAOua,MAAM,CAACnJ,IAAD,EAAOpR,IAAP,CAAN,CAAmBiE,MAAnB,CAA0B,UAAUizB,IAAV,EAAgB;AAC/C,eAAO5a,QAAQ,CAAC4a,IAAD,EAAO,EAAP,CAAR,GAAqB,CAA5B;AACD,OAFM,CAAP;AAGD,KAJD;;AAKA,QAAIoK,eAAe,GAAG,UAAUlwB,IAAV,EAAgB;AACpC,aAAOiwB,OAAO,CAACjwB,IAAD,EAAO,SAAP,CAAP,IAA4BiwB,OAAO,CAACjwB,IAAD,EAAO,SAAP,CAA1C;AACD,KAFD;;AAGA,QAAI7G,UAAU,GAAG22B,SAAS,CAACC,UAAD,CAA1B;AACA,WAAO52B,UAAU,CAACjJ,MAAX,GAAoB,CAApB,IAAyB4C,MAAM,CAACqG,UAAD,EAAa+2B,eAAb,CAA/B,GAA+Dt8B,QAAQ,CAACR,IAAT,CAAc+F,UAAd,CAA/D,GAA2FvF,QAAQ,CAACtC,IAAT,EAAlG;AACD,GAXD;;AAYA,MAAI6+B,QAAQ,GAAG,UAAUjkB,KAAV,EAAiB6jB,UAAjB,EAA6BK,QAA7B,EAAuC;AACpD,WAAOnV,IAAI,CAAC8U,UAAU,CAAC/5B,GAAX,EAAD,EAAmBpC,QAAQ,CAACtC,IAA5B,EAAkC,UAAUkS,KAAV,EAAiB;AAC5D,UAAIA,KAAK,CAACtT,MAAN,IAAgB,CAApB,EAAuB;AACrB,eAAO0D,QAAQ,CAACtC,IAAT,EAAP;AACD,OAFD,MAEO;AACL,eAAOgoB,WAAW,CAACpN,KAAD,EAAQkkB,QAAQ,CAACnX,qBAAjB,EAAwCmX,QAAQ,CAACtX,oBAAjD,CAAX,CAAkFpmB,GAAlF,CAAsF,UAAUqR,MAAV,EAAkB;AAC7G,iBAAO;AACLA,YAAAA,MAAM,EAAEA,MADH;AAELP,YAAAA,KAAK,EAAEA;AAFF,WAAP;AAID,SALM,CAAP;AAMD;AACF,KAXU,EAWR5P,QAAQ,CAACtC,IAXD,CAAX;AAYD,GAbD;;AAeA,MAAI++B,WAAW,GAAG,mBAAlB;AACA,MAAIC,mBAAmB,GAAG,QAAQD,WAAR,GAAsB,OAAtB,GAAgCA,WAAhC,GAA8C,GAAxE;AACA,MAAIE,oBAAoB,GAAG,MAAMF,WAAN,GAAoB,GAA/C;AACA,MAAIG,gBAAgB,GAAG,yBAAvB;AACA,MAAIC,wBAAwB,GAAG,QAAQD,gBAAR,GAA2B,OAA3B,GAAqCA,gBAArC,GAAwD,GAAvF;AACA,MAAIE,eAAe,GAAG,wBAAtB;AACA,MAAIC,uBAAuB,GAAG,QAAQD,eAAR,GAA0B,OAA1B,GAAoCA,eAApC,GAAsD,GAApF;AACA,MAAIE,iBAAiB,GAAGL,oBAAxB;AACA,MAAIH,QAAQ,GAAG;AACbS,IAAAA,QAAQ,EAAER,WADG;AAEb3U,IAAAA,gBAAgB,EAAE4U,mBAFL;AAGbQ,IAAAA,aAAa,EAAEN,gBAHF;AAIbvX,IAAAA,qBAAqB,EAAEwX,wBAJV;AAKbM,IAAAA,YAAY,EAAEL,eALD;AAMb5X,IAAAA,oBAAoB,EAAE6X;AANT,GAAf;;AASA,MAAIK,MAAM,GAAG,UAAUhmB,IAAV,EAAgB;AAC3B,WAAO;AACLnL,MAAAA,OAAO,EAAEmL,IADJ;AAELmlB,MAAAA,QAAQ,EAAEv8B,QAAQ,CAACtC,IAAT,EAFL;AAGL0+B,MAAAA,UAAU,EAAEp8B,QAAQ,CAACtC,IAAT,EAHP;AAILw+B,MAAAA,SAAS,EAAE,CAAC9kB,IAAD;AAJN,KAAP;AAMD,GAPD;;AAQA,MAAIimB,OAAO,GAAG,UAAUlB,UAAV,EAAsB7jB,KAAtB,EAA6BlB,IAA7B,EAAmC;AAC/C,WAAO;AACLnL,MAAAA,OAAO,EAAEmL,IADJ;AAELmlB,MAAAA,QAAQ,EAAEA,QAAQ,CAACjkB,KAAD,EAAQ6jB,UAAR,EAAoBK,QAApB,CAFb;AAGLJ,MAAAA,UAAU,EAAEA,UAAU,CAACD,UAAD,CAHjB;AAILD,MAAAA,SAAS,EAAEA,SAAS,CAACC,UAAD;AAJf,KAAP;AAMD,GAPD;;AAQA,MAAImB,OAAO,GAAG,UAAUrxB,OAAV,EAAmBsxB,SAAnB,EAA8BC,UAA9B,EAA0C;AACtD,WAAO;AACLvxB,MAAAA,OAAO,EAAEA,OADJ;AAELsxB,MAAAA,SAAS,EAAEA,SAFN;AAGLC,MAAAA,UAAU,EAAEA;AAHP,KAAP;AAKD,GAND;;AAOA,MAAIC,SAAS,GAAG,UAAUtB,UAAV,EAAsB/kB,IAAtB,EAA4BmmB,SAA5B,EAAuCC,UAAvC,EAAmD;AACjE,WAAO;AACLtB,MAAAA,SAAS,EAAEA,SAAS,CAACC,UAAD,CADf;AAELoB,MAAAA,SAAS,EAAEA,SAFN;AAGLC,MAAAA,UAAU,EAAEA;AAHP,KAAP;AAKD,GAND;;AAQA,MAAIE,eAAe,GAAG,UAAU9tB,KAAV,EAAiB;AACrC,WAAO0I,KAAK,CAAC1I,KAAK,CAAC,CAAD,CAAN,CAAL,CAAgB9Q,GAAhB,CAAoB,UAAUwZ,KAAV,EAAiB;AAC1C,UAAI0f,OAAO,GAAGO,OAAO,CAACjgB,KAAD,EAAQ0kB,iBAAR,CAArB;AACAtB,MAAAA,eAAe,CAAC1D,OAAD,CAAf;AACA,aAAO,CAACA,OAAD,CAAP;AACD,KAJM,CAAP;AAKD,GAND;;AAOA,MAAI2F,iBAAiB,GAAG,UAAUtC,MAAV,EAAkBjb,QAAlB,EAA4B;AAClD,WAAOthB,GAAG,CAACshB,QAAD,EAAW,UAAUlI,GAAV,EAAe;AAClC,aAAOmjB,MAAM,CAACa,SAAP,CAAiB0B,UAAjB,CAA4BC,SAA5B,CAAsC3lB,GAAG,CAACvM,GAA1C,EAA+C,EAA/C,CAAP;AACD,KAFS,CAAH,CAEJwM,IAFI,CAEC,EAFD,CAAP;AAGD,GAJD;;AAKA,MAAI2lB,cAAc,GAAG,UAAU1d,QAAV,EAAoB;AACvC,WAAOthB,GAAG,CAACshB,QAAD,EAAW,UAAUnU,OAAV,EAAmB;AACtC,aAAOA,OAAO,CAACN,GAAR,CAAYoyB,SAAnB;AACD,KAFS,CAAH,CAEJ5lB,IAFI,CAEC,EAFD,CAAP;AAGD,GAJD;;AAKA,MAAI6lB,cAAc,GAAG,UAAU3C,MAAV,EAAkBc,UAAlB,EAA8B8B,OAA9B,EAAuCC,aAAvC,EAAsD;AACzE7C,IAAAA,MAAM,CAAC8C,EAAP,CAAU,kBAAV,EAA8B,UAAUhtB,CAAV,EAAa;AACzC,UAAIitB,gBAAgB,GAAG,UAAUxuB,KAAV,EAAiB;AACtCuB,QAAAA,CAAC,CAACktB,cAAF;AACAX,QAAAA,eAAe,CAAC9tB,KAAD,CAAf,CAAuB7Q,IAAvB,CAA4B,UAAUqhB,QAAV,EAAoB;AAC9CjP,UAAAA,CAAC,CAACmtB,OAAF,GAAYntB,CAAC,CAACotB,MAAF,KAAa,MAAb,GAAsBT,cAAc,CAAC1d,QAAD,CAApC,GAAiDud,iBAAiB,CAACtC,MAAD,EAASjb,QAAT,CAA9E;AACD,SAFD;AAGD,OALD;;AAMA,UAAIjP,CAAC,CAAC+qB,SAAF,KAAgB,IAApB,EAA0B;AACxB7U,QAAAA,IAAI,CAAC8U,UAAU,CAAC/5B,GAAX,EAAD,EAAmBrG,IAAnB,EAAyBqiC,gBAAzB,EAA2CriC,IAA3C,CAAJ;AACD;AACF,KAVD;AAWAs/B,IAAAA,MAAM,CAAC8C,EAAP,CAAU,kBAAV,EAA8B,UAAUhtB,CAAV,EAAa;AACzC,UAAIA,CAAC,CAAC+qB,SAAF,KAAgB,IAAhB,IAAwB/qB,CAAC,CAAC4pB,KAAF,KAAY,IAAxC,EAA8C;AAC5C,YAAI1G,OAAO,GAAGr0B,QAAQ,CAACD,IAAT,CAAcs7B,MAAM,CAAC1vB,GAAP,CAAW6yB,SAAX,CAAqBnD,MAAM,CAACa,SAAP,CAAiBrU,QAAjB,EAArB,EAAkD,OAAlD,CAAd,CAAd;AACAwM,QAAAA,OAAO,CAACt1B,IAAR,CAAa,UAAU0/B,OAAV,EAAmB;AAC9B,cAAIrnB,IAAI,GAAGpL,YAAY,CAACZ,OAAb,CAAqBqzB,OAArB,CAAX;AACAnmB,UAAAA,KAAK,CAAClB,IAAD,CAAL,CAAYrY,IAAZ,CAAiB,UAAUuZ,KAAV,EAAiB;AAChC,gBAAI8H,QAAQ,GAAGjhB,MAAM,CAAC67B,UAAU,CAAC7pB,CAAC,CAACmtB,OAAH,CAAX,EAAwB,UAAUA,OAAV,EAAmB;AAC9D,qBAAOzjC,IAAI,CAACyjC,OAAD,CAAJ,KAAkB,MAAzB;AACD,aAFoB,CAArB;;AAGA,gBAAII,OAAO,GAAG,UAAUxmB,GAAV,EAAe;AAC3B,qBAAOrd,IAAI,CAACqd,GAAD,CAAJ,KAAc,OAArB;AACD,aAFD;;AAGA,gBAAIkI,QAAQ,CAAC9jB,MAAT,KAAoB,CAApB,IAAyBoiC,OAAO,CAACte,QAAQ,CAAC,CAAD,CAAT,CAApC,EAAmD;AACjDjP,cAAAA,CAAC,CAACktB,cAAF;AACA,kBAAI1zB,GAAG,GAAGqB,YAAY,CAACZ,OAAb,CAAqBiwB,MAAM,CAACsD,MAAP,EAArB,CAAV;AACA,kBAAInB,UAAU,GAAGzC,KAAK,CAACpwB,GAAD,CAAtB;AACA,kBAAIi0B,OAAO,GAAGtB,OAAO,CAAClmB,IAAD,EAAOgJ,QAAQ,CAAC,CAAD,CAAf,EAAoBod,UAApB,CAArB;AACAS,cAAAA,OAAO,CAACY,UAAR,CAAmBvmB,KAAnB,EAA0BsmB,OAA1B,EAAmC7/B,IAAnC,CAAwC,UAAU+/B,IAAV,EAAgB;AACtDzD,gBAAAA,MAAM,CAACa,SAAP,CAAiB6C,MAAjB,CAAwBD,IAAI,CAACE,GAA7B;AACA3D,gBAAAA,MAAM,CAAC4D,KAAP;AACAf,gBAAAA,aAAa,CAACgB,KAAd,CAAoB5mB,KAApB;AACD,eAJD;AAKD;AACF,WAlBD;AAmBD,SArBD;AAsBD;AACF,KA1BD;AA2BD,GAvCD;;AAyCA,MAAI8N,GAAG,GAAGa,GAAG,CAAC7L,QAAJ,CAAa,CACrB;AAAE1d,IAAAA,IAAI,EAAE;AAAR,GADqB,EAErB;AAAEyhC,IAAAA,IAAI,EAAE,CAAC,OAAD;AAAR,GAFqB,EAGrB;AACEtT,IAAAA,IAAI,EAAE,CACJ,OADI,EAEJ,MAFI;AADR,GAHqB,EASrB;AACEuT,IAAAA,MAAM,EAAE,CACN,MADM,EAEN,OAFM,EAGN,MAHM;AADV,GATqB,EAgBrB;AACEC,IAAAA,KAAK,EAAE,CACL,MADK,EAEL,OAFK;AADT,GAhBqB,CAAb,CAAV;;AAuBA,MAAIC,aAAa,GAAG98B,QAAQ,CAAC,EAAD,EAAK4jB,GAAL,CAA5B;;AAEA,MAAImZ,UAAU,GAAG,UAAUpQ,KAAV,EAAiB7c,KAAjB,EAAwB;AACvC,QAAI6c,KAAK,CAAC7yB,MAAN,KAAiB,CAArB,EAAwB;AACtB,aAAOgjC,aAAa,CAAC5hC,IAAd,EAAP;AACD;;AACD,QAAIyxB,KAAK,CAAC7yB,MAAN,KAAiB,CAArB,EAAwB;AACtB,aAAOgjC,aAAa,CAACH,IAAd,CAAmB,CAAnB,CAAP;AACD;;AACD,QAAI7sB,KAAK,KAAK,CAAd,EAAiB;AACf,aAAOgtB,aAAa,CAACzT,IAAd,CAAmB,CAAnB,EAAsB,CAAtB,CAAP;AACD;;AACD,QAAIvZ,KAAK,KAAK6c,KAAK,CAAC7yB,MAAN,GAAe,CAA7B,EAAgC;AAC9B,aAAOgjC,aAAa,CAACD,KAAd,CAAoB/sB,KAAK,GAAG,CAA5B,EAA+BA,KAA/B,CAAP;AACD;;AACD,QAAIA,KAAK,GAAG,CAAR,IAAaA,KAAK,GAAG6c,KAAK,CAAC7yB,MAAN,GAAe,CAAxC,EAA2C;AACzC,aAAOgjC,aAAa,CAACF,MAAd,CAAqB9sB,KAAK,GAAG,CAA7B,EAAgCA,KAAhC,EAAuCA,KAAK,GAAG,CAA/C,CAAP;AACD;;AACD,WAAOgtB,aAAa,CAAC5hC,IAAd,EAAP;AACD,GAjBD;;AAkBA,MAAI8hC,SAAS,GAAG,UAAUrQ,KAAV,EAAiBhgB,MAAjB,EAAyB8e,IAAzB,EAA+BsE,SAA/B,EAA0CkN,MAA1C,EAAkD;AAChE,QAAIzrB,MAAM,GAAGmb,KAAK,CAACjvB,KAAN,CAAY,CAAZ,CAAb;AACA,QAAIw/B,OAAO,GAAGH,UAAU,CAACpQ,KAAD,EAAQhgB,MAAR,CAAxB;AACA,QAAIoY,MAAM,GAAG5qB,QAAQ,CAACmC,GAAG,CAACkV,MAAD,EAASrX,QAAQ,CAAC,CAAD,CAAjB,CAAJ,CAArB;;AACA,QAAIgjC,MAAM,GAAG,UAAUrtB,KAAV,EAAiB;AAC5B,aAAOigB,SAAS,CAACmD,iBAAV,CAA4B1hB,MAAM,CAAC1B,KAAD,CAAlC,EAA2C2b,IAA3C,CAAP;AACD,KAFD;;AAGA,QAAI2R,MAAM,GAAG,UAAUttB,KAAV,EAAiB0Y,IAAjB,EAAuB;AAClC,aAAOyU,MAAM,CAACI,kBAAP,CAA0B7rB,MAA1B,EAAkC1B,KAAlC,EAAyC0Y,IAAzC,EAA+CiD,IAA/C,EAAqDsE,SAAS,CAACuC,YAAV,EAArD,EAA+EvC,SAAS,CAACsD,UAAzF,CAAP;AACD,KAFD;;AAGA,QAAIiK,QAAQ,GAAG,UAAUrF,IAAV,EAAgBnoB,KAAhB,EAAuB0Y,IAAvB,EAA6B;AAC1C,aAAOyU,MAAM,CAACM,gBAAP,CAAwB/rB,MAAxB,EAAgCymB,IAAhC,EAAsCnoB,KAAtC,EAA6C0Y,IAA7C,EAAmDiD,IAAnD,EAAyDsE,SAAS,CAACuC,YAAV,EAAzD,EAAmFvC,SAAS,CAACsD,UAA7F,CAAP;AACD,KAFD;;AAGA,QAAImK,OAAO,GAAG,UAAUvF,IAAV,EAAgBnoB,KAAhB,EAAuB;AACnC,aAAOmtB,MAAM,CAACQ,mBAAP,CAA2BjsB,MAA3B,EAAmCymB,IAAnC,EAAyCnoB,KAAzC,EAAgD2b,IAAhD,EAAsDsE,SAAS,CAACuC,YAAV,EAAtD,EAAgFvC,SAAS,CAACsD,UAA1F,CAAP;AACD,KAFD;;AAGA,WAAO6J,OAAO,CAACvhC,IAAR,CAAaopB,MAAb,EAAqBoY,MAArB,EAA6BC,MAA7B,EAAqCE,QAArC,EAA+CE,OAA/C,CAAP;AACD,GAjBD;;AAmBA,MAAInO,KAAK,GAAG,UAAUzrB,KAAV,EAAiB4c,GAAjB,EAAsBkd,QAAtB,EAAgC;AAC1C,QAAIl/B,CAAC,GAAG,CAAR;;AACA,SAAK,IAAIJ,CAAC,GAAGwF,KAAb,EAAoBxF,CAAC,GAAGoiB,GAAxB,EAA6BpiB,CAAC,EAA9B,EAAkC;AAChCI,MAAAA,CAAC,IAAIk/B,QAAQ,CAACt/B,CAAD,CAAR,KAAgBlF,SAAhB,GAA4BwkC,QAAQ,CAACt/B,CAAD,CAApC,GAA0C,CAA/C;AACD;;AACD,WAAOI,CAAP;AACD,GAND;;AAOA,MAAIm/B,wBAAwB,GAAG,UAAU1lB,SAAV,EAAqB2lB,MAArB,EAA6B;AAC1D,QAAInjC,GAAG,GAAG0f,SAAS,CAACL,SAAV,CAAoB7B,SAApB,CAAV;AACA,WAAO3b,GAAG,CAAC7B,GAAD,EAAM,UAAUma,IAAV,EAAgB;AAC9B,UAAImX,KAAK,GAAGsD,KAAK,CAACza,IAAI,CAACjI,MAAN,EAAciI,IAAI,CAACjI,MAAL,GAAciI,IAAI,CAAC9H,OAAjC,EAA0C8wB,MAA1C,CAAjB;AACA,aAAO;AACLn0B,QAAAA,OAAO,EAAEmL,IAAI,CAACnL,OADT;AAELsiB,QAAAA,KAAK,EAAEA,KAFF;AAGLjf,QAAAA,OAAO,EAAE8H,IAAI,CAAC9H;AAHT,OAAP;AAKD,KAPS,CAAV;AAQD,GAVD;;AAWA,MAAI+wB,0BAA0B,GAAG,UAAU5lB,SAAV,EAAqB2lB,MAArB,EAA6B;AAC5D,QAAIE,MAAM,GAAG3jB,SAAS,CAACH,WAAV,CAAsB/B,SAAtB,CAAb;AACA,WAAO3b,GAAG,CAACwhC,MAAD,EAAS,UAAUnxB,MAAV,EAAkBmD,KAAlB,EAAyB;AAC1C,aAAO;AACLrG,QAAAA,OAAO,EAAEkD,MAAM,CAAClD,OADX;AAELsiB,QAAAA,KAAK,EAAE6R,MAAM,CAAC9tB,KAAD,CAFR;AAGLhD,QAAAA,OAAO,EAAEH,MAAM,CAACG;AAHX,OAAP;AAKD,KANS,CAAV;AAOD,GATD;;AAUA,MAAIixB,yBAAyB,GAAG,UAAU9lB,SAAV,EAAqB+lB,OAArB,EAA8B;AAC5D,QAAIvjC,GAAG,GAAG0f,SAAS,CAACL,SAAV,CAAoB7B,SAApB,CAAV;AACA,WAAO3b,GAAG,CAAC7B,GAAD,EAAM,UAAUma,IAAV,EAAgB;AAC9B,UAAIqU,MAAM,GAAGoG,KAAK,CAACza,IAAI,CAAClI,GAAN,EAAWkI,IAAI,CAAClI,GAAL,GAAWkI,IAAI,CAAC/H,OAA3B,EAAoCmxB,OAApC,CAAlB;AACA,aAAO;AACLv0B,QAAAA,OAAO,EAAEmL,IAAI,CAACnL,OADT;AAELwf,QAAAA,MAAM,EAAEA,MAFH;AAGLpc,QAAAA,OAAO,EAAE+H,IAAI,CAAC/H;AAHT,OAAP;AAKD,KAPS,CAAV;AAQD,GAVD;;AAWA,MAAIoxB,cAAc,GAAG,UAAUhmB,SAAV,EAAqB+lB,OAArB,EAA8B;AACjD,WAAO1hC,GAAG,CAAC2b,SAAS,CAACxd,GAAX,EAAgB,UAAUiS,GAAV,EAAetO,CAAf,EAAkB;AAC1C,aAAO;AACLqL,QAAAA,OAAO,EAAEiD,GAAG,CAACjD,OADR;AAELwf,QAAAA,MAAM,EAAE+U,OAAO,CAAC5/B,CAAD;AAFV,OAAP;AAID,KALS,CAAV;AAMD,GAPD;;AASA,MAAI8/B,KAAK,GAAG,UAAU9O,OAAV,EAAmB;AAC7B,WAAOtwB,KAAK,CAACswB,OAAD,EAAU,UAAU9xB,CAAV,EAAa1E,CAAb,EAAgB;AACpC,aAAO0E,CAAC,GAAG1E,CAAX;AACD,KAFW,EAET,CAFS,CAAZ;AAGD,GAJD;;AAKA,MAAIulC,WAAW,GAAG,UAAUlmB,SAAV,EAAqB2lB,MAArB,EAA6B;AAC7C,QAAIzjB,SAAS,CAACF,UAAV,CAAqBhC,SAArB,CAAJ,EAAqC;AACnC,aAAO4lB,0BAA0B,CAAC5lB,SAAD,EAAY2lB,MAAZ,CAAjC;AACD,KAFD,MAEO;AACL,aAAOD,wBAAwB,CAAC1lB,SAAD,EAAY2lB,MAAZ,CAA/B;AACD;AACF,GAND;;AAOA,MAAIQ,mBAAmB,GAAG,UAAUnmB,SAAV,EAAqB2lB,MAArB,EAA6B7N,SAA7B,EAAwC;AAChE,QAAIsO,QAAQ,GAAGF,WAAW,CAAClmB,SAAD,EAAY2lB,MAAZ,CAA1B;AACArhC,IAAAA,IAAI,CAAC8hC,QAAD,EAAW,UAAUzpB,IAAV,EAAgB;AAC7Bmb,MAAAA,SAAS,CAACoD,eAAV,CAA0Bve,IAAI,CAACnL,OAA/B,EAAwCmL,IAAI,CAACmX,KAA7C;AACD,KAFG,CAAJ;AAGD,GALD;;AAMA,MAAIuS,WAAW,GAAG,UAAUxoB,KAAV,EAAiByS,KAAjB,EAAwBzY,KAAxB,EAA+ByuB,QAA/B,EAAyCxO,SAAzC,EAAoD;AACpE,QAAI9X,SAAS,GAAGkC,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAhB;AACA,QAAI2V,IAAI,GAAGsE,SAAS,CAACkD,YAAV,CAAuB1K,KAAvB,CAAX;AACA,QAAIqV,MAAM,GAAG7N,SAAS,CAACiD,SAAV,CAAoB/a,SAApB,EAA+B8X,SAA/B,CAAb;AACA,QAAIyO,YAAY,GAAG1uB,KAAK,KAAKmI,SAAS,CAAC3L,IAAV,CAAeE,OAAf,GAAyB,CAAtD;AACA,QAAIiyB,WAAW,GAAGF,QAAQ,CAACG,eAAT,CAAyBd,MAAzB,EAAiC9tB,KAAjC,EAAwC2b,IAAxC,EAA8CsE,SAAS,CAACuC,YAAV,EAA9C,EAAwEkM,YAAxE,CAAlB;AACA,QAAIG,MAAM,GAAG3B,SAAS,CAACY,MAAD,EAAS9tB,KAAT,EAAgB2uB,WAAhB,EAA6B1O,SAA7B,EAAwCwO,QAAxC,CAAtB;AACA,QAAIK,SAAS,GAAGtiC,GAAG,CAACqiC,MAAD,EAAS,UAAUE,EAAV,EAAczgC,CAAd,EAAiB;AAC3C,aAAOygC,EAAE,GAAGjB,MAAM,CAACx/B,CAAD,CAAlB;AACD,KAFkB,CAAnB;AAGAggC,IAAAA,mBAAmB,CAACnmB,SAAD,EAAY2mB,SAAZ,EAAuB7O,SAAvB,CAAnB;AACAwO,IAAAA,QAAQ,CAACO,WAAT,CAAqB/O,SAAS,CAACqD,gBAA/B,EAAiDqL,WAAjD,EAA8DD,YAA9D;AACD,GAZD;;AAaA,MAAIO,YAAY,GAAG,UAAUjpB,KAAV,EAAiByS,KAAjB,EAAwBzY,KAAxB,EAA+B2iB,SAA/B,EAA0C;AAC3D,QAAIxa,SAAS,GAAGkC,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAhB;AACA,QAAIkoB,OAAO,GAAGtL,eAAe,CAACza,SAAD,EAAYnC,KAAZ,EAAmB2c,SAAnB,CAA7B;AACA,QAAIuM,UAAU,GAAG1iC,GAAG,CAAC0hC,OAAD,EAAU,UAAUiB,EAAV,EAAc7gC,CAAd,EAAiB;AAC7C,aAAO0R,KAAK,KAAK1R,CAAV,GAAcsb,IAAI,CAACC,GAAL,CAAS4O,KAAK,GAAG0W,EAAjB,EAAqB7pB,SAAS,EAA9B,CAAd,GAAkD6pB,EAAzD;AACD,KAFmB,CAApB;AAGA,QAAIC,YAAY,GAAGnB,yBAAyB,CAAC9lB,SAAD,EAAY+mB,UAAZ,CAA5C;AACA,QAAIG,WAAW,GAAGlB,cAAc,CAAChmB,SAAD,EAAY+mB,UAAZ,CAAhC;AACAziC,IAAAA,IAAI,CAAC4iC,WAAD,EAAc,UAAUzyB,GAAV,EAAe;AAC/BqiB,MAAAA,SAAS,CAACriB,GAAG,CAACjD,OAAL,EAAciD,GAAG,CAACuc,MAAlB,CAAT;AACD,KAFG,CAAJ;AAGA1sB,IAAAA,IAAI,CAAC2iC,YAAD,EAAe,UAAUtqB,IAAV,EAAgB;AACjCma,MAAAA,SAAS,CAACna,IAAI,CAACnL,OAAN,EAAemL,IAAI,CAACqU,MAApB,CAAT;AACD,KAFG,CAAJ;AAGA,QAAIoG,KAAK,GAAG6O,KAAK,CAACc,UAAD,CAAjB;AACAjQ,IAAAA,SAAS,CAACjZ,KAAD,EAAQuZ,KAAR,CAAT;AACD,GAhBD;;AAiBA,MAAI+P,2BAA2B,GAAG,UAAUC,MAAV,EAAkBxmB,IAAlB,EAAwBnL,OAAxB,EAAiCqiB,SAAjC,EAA4CuP,eAA5C,EAA6D;AAC7F,QAAIrnB,SAAS,GAAGkC,SAAS,CAACvB,QAAV,CAAmBC,IAAnB,CAAhB;AACA,QAAI0mB,KAAK,GAAGxP,SAAS,CAACiD,SAAV,CAAoB/a,SAApB,EAA+B8X,SAA/B,CAAZ;AACA,QAAIyP,eAAe,GAAGzP,SAAS,CAACC,UAAV,EAAtB;;AACA,QAAIyP,EAAE,GAAGH,eAAe,CAACI,uBAAhB,CAAwCH,KAAxC,EAA+CC,eAA/C,EAAgE9xB,OAAO,CAACiyB,UAAxE,EAAoF5P,SAAS,CAACsD,UAA9F,CAAT;AAAA,QAAoHgL,QAAQ,GAAGoB,EAAE,CAACpB,QAAlI;AAAA,QAA4I9V,KAAK,GAAGkX,EAAE,CAAClX,KAAvJ;;AACA6V,IAAAA,mBAAmB,CAACnmB,SAAD,EAAYomB,QAAZ,EAAsBtO,SAAtB,CAAnB;AACAA,IAAAA,SAAS,CAACqD,gBAAV,CAA2B7K,KAA3B;AACD,GAPD;;AAQA,MAAIqX,aAAa,GAAG,UAAUP,MAAV,EAAkBxmB,IAAlB,EAAwBgnB,KAAxB,EAA+B9P,SAA/B,EAA0C;AAC5D,QAAI9X,SAAS,GAAGkC,SAAS,CAACvB,QAAV,CAAmBC,IAAnB,CAAhB;AACA,QAAI+kB,MAAM,GAAG7N,SAAS,CAACiD,SAAV,CAAoB/a,SAApB,EAA+B8X,SAA/B,CAAb;AACAqO,IAAAA,mBAAmB,CAACnmB,SAAD,EAAY2lB,MAAZ,EAAoB7N,SAApB,CAAnB;AACD,GAJD;;AAMA,MAAIgD,IAAI,GAAG,UAAU3H,KAAV,EAAiB;AAC1B,WAAO9uB,GAAG,CAAC8uB,KAAD,EAAQjxB,QAAQ,CAAC,CAAD,CAAhB,CAAV;AACD,GAFD;;AAGA,MAAI2lC,QAAQ,GAAG,UAAUP,KAAV,EAAiBQ,UAAjB,EAA6BC,QAA7B,EAAuCC,OAAvC,EAAgDrlC,CAAhD,EAAmD;AAChE,WAAOA,CAAC,CAAC2kC,KAAK,CAAC7hC,KAAN,CAAY,CAAZ,EAAeqiC,UAAf,CAAD,CAAD,CAA8BrlC,MAA9B,CAAqCulC,OAArC,EAA8CvlC,MAA9C,CAAqDE,CAAC,CAAC2kC,KAAK,CAAC7hC,KAAN,CAAYsiC,QAAZ,CAAD,CAAtD,CAAP;AACD,GAFD;;AAGA,MAAIE,gBAAgB,GAAG,UAAU7uB,SAAV,EAAqB;AAC1C,WAAO,UAAUkuB,KAAV,EAAiBzvB,KAAjB,EAAwByY,KAAxB,EAA+B4X,WAA/B,EAA4C;AACjD,UAAI,CAAC9uB,SAAS,CAACkX,KAAD,CAAd,EAAuB;AACrB,eAAOA,KAAP;AACD,OAFD,MAEO;AACL,YAAI6G,OAAO,GAAG1V,IAAI,CAACC,GAAL,CAASwmB,WAAT,EAAsBZ,KAAK,CAACzvB,KAAD,CAAL,GAAe4J,IAAI,CAACgP,GAAL,CAASH,KAAT,CAArC,CAAd;AACA,YAAI6X,IAAI,GAAG1mB,IAAI,CAACgP,GAAL,CAAS0G,OAAO,GAAGmQ,KAAK,CAACzvB,KAAD,CAAxB,CAAX;AACA,eAAOyY,KAAK,IAAI,CAAT,GAAa6X,IAAb,GAAoB,CAACA,IAA5B;AACD;AACF,KARD;AASD,GAVD;;AAWA,MAAIC,kBAAkB,GAAGH,gBAAgB,CAAC,UAAU3X,KAAV,EAAiB;AACzD,WAAOA,KAAK,GAAG,CAAf;AACD,GAFwC,CAAzC;AAGA,MAAI+X,UAAU,GAAGJ,gBAAgB,CAACjlC,MAAD,CAAjC;;AACA,MAAI6jC,WAAW,GAAG,YAAY;AAC5B,QAAIyB,eAAe,GAAG,UAAUhB,KAAV,EAAiBzvB,KAAjB,EAAwB0Y,IAAxB,EAA8BD,KAA9B,EAAqC4X,WAArC,EAAkD;AACtE,UAAIK,YAAY,GAAGH,kBAAkB,CAACd,KAAD,EAAQzvB,KAAR,EAAeyY,KAAf,EAAsB4X,WAAtB,CAArC;AACA,aAAOL,QAAQ,CAACP,KAAD,EAAQzvB,KAAR,EAAe0Y,IAAI,GAAG,CAAtB,EAAyB,CACtCgY,YADsC,EAEtC,CAFsC,CAAzB,EAGZzN,IAHY,CAAf;AAID,KAND;;AAOA,QAAI0N,kBAAkB,GAAG,UAAUlB,KAAV,EAAiBzvB,KAAjB,EAAwByY,KAAxB,EAA+B4X,WAA/B,EAA4C;AACnE,UAAIO,KAAK,GAAG,CAAC,MAAMnY,KAAP,IAAgB,GAA5B;AACA,UAAIoY,OAAO,GAAGjnB,IAAI,CAACC,GAAL,CAASwmB,WAAT,EAAsB,CAACZ,KAAK,CAACzvB,KAAD,CAAL,GAAeyY,KAAhB,IAAyBmY,KAA/C,CAAd;AACA,aAAOpkC,GAAG,CAACijC,KAAD,EAAQ,UAAU1zB,IAAV,EAAgBgM,GAAhB,EAAqB;AACrC,YAAIuX,OAAO,GAAGvX,GAAG,KAAK/H,KAAR,GAAgB6wB,OAAhB,GAA0B90B,IAAI,GAAG60B,KAA/C;AACA,eAAOtR,OAAO,GAAGvjB,IAAjB;AACD,OAHS,CAAV;AAID,KAPD;;AAQA,QAAIwxB,kBAAkB,GAAG,UAAUkC,KAAV,EAAiBzvB,KAAjB,EAAwB0Y,IAAxB,EAA8BD,KAA9B,EAAqC4X,WAArC,EAAkD9M,UAAlD,EAA8D;AACrF,UAAIA,UAAJ,EAAgB;AACd,eAAOoN,kBAAkB,CAAClB,KAAD,EAAQzvB,KAAR,EAAeyY,KAAf,EAAsB4X,WAAtB,CAAzB;AACD,OAFD,MAEO;AACL,eAAOI,eAAe,CAAChB,KAAD,EAAQzvB,KAAR,EAAe0Y,IAAf,EAAqBD,KAArB,EAA4B4X,WAA5B,CAAtB;AACD;AACF,KAND;;AAOA,QAAI5C,gBAAgB,GAAG,UAAUgC,KAAV,EAAiBqB,KAAjB,EAAwB9wB,KAAxB,EAA+B0Y,IAA/B,EAAqCD,KAArC,EAA4C4X,WAA5C,EAAyD9M,UAAzD,EAAqE;AAC1F,aAAOgK,kBAAkB,CAACkC,KAAD,EAAQzvB,KAAR,EAAe0Y,IAAf,EAAqBD,KAArB,EAA4B4X,WAA5B,EAAyC9M,UAAzC,CAAzB;AACD,KAFD;;AAGA,QAAIyL,WAAW,GAAG,UAAU+B,OAAV,EAAmBtY,KAAnB,EAA0B;AAC1C,aAAOsY,OAAO,CAACtY,KAAD,CAAd;AACD,KAFD;;AAGA,QAAIkV,mBAAmB,GAAG,UAAU8B,KAAV,EAAiBqB,KAAjB,EAAwB9wB,KAAxB,EAA+ByY,KAA/B,EAAsC4X,WAAtC,EAAmD9M,UAAnD,EAA+D;AACvF,UAAIA,UAAJ,EAAgB;AACd,eAAOoN,kBAAkB,CAAClB,KAAD,EAAQzvB,KAAR,EAAeyY,KAAf,EAAsB4X,WAAtB,CAAzB;AACD,OAFD,MAEO;AACL,YAAIK,YAAY,GAAGH,kBAAkB,CAACd,KAAD,EAAQzvB,KAAR,EAAeyY,KAAf,EAAsB4X,WAAtB,CAArC;AACA,eAAOpN,IAAI,CAACwM,KAAK,CAAC7hC,KAAN,CAAY,CAAZ,EAAeoS,KAAf,CAAD,CAAJ,CAA4BpV,MAA5B,CAAmC,CAAC8lC,YAAD,CAAnC,CAAP;AACD;AACF,KAPD;;AAQA,QAAId,uBAAuB,GAAG,UAAUH,KAAV,EAAiBuB,UAAjB,EAA6BnB,UAA7B,EAAyCtM,UAAzC,EAAqD;AACjF,UAAIA,UAAJ,EAAgB;AACd,YAAI0N,UAAU,GAAGD,UAAU,GAAGnB,UAA9B;AACA,YAAIqB,OAAO,GAAGD,UAAU,GAAGD,UAA3B;AACA,YAAIzC,QAAQ,GAAG/hC,GAAG,CAACijC,KAAD,EAAQ,UAAU1zB,IAAV,EAAgB;AACxC,iBAAOA,IAAI,GAAGm1B,OAAd;AACD,SAFiB,CAAlB;AAGA,eAAO;AACLzY,UAAAA,KAAK,EAAEyY,OAAO,GAAG,GAAV,GAAgB,GADlB;AAEL3C,UAAAA,QAAQ,EAAEA;AAFL,SAAP;AAID,OAVD,MAUO;AACL,eAAO;AACL9V,UAAAA,KAAK,EAAEoX,UADF;AAELtB,UAAAA,QAAQ,EAAEkB;AAFL,SAAP;AAID;AACF,KAjBD;;AAkBA,WAAO;AACLT,MAAAA,WAAW,EAAEA,WADR;AAELJ,MAAAA,eAAe,EAAE2B,kBAFZ;AAGLhD,MAAAA,kBAAkB,EAAEA,kBAHf;AAILE,MAAAA,gBAAgB,EAAEA,gBAJb;AAKLE,MAAAA,mBAAmB,EAAEA,mBALhB;AAMLiC,MAAAA,uBAAuB,EAAEA;AANpB,KAAP;AAQD,GA/DD;;AAgEA,MAAIuB,aAAa,GAAG,YAAY;AAC9B,QAAI5D,kBAAkB,GAAG,UAAUkC,KAAV,EAAiBzvB,KAAjB,EAAwB0Y,IAAxB,EAA8BD,KAA9B,EAAqC4X,WAArC,EAAkD;AACzE,UAAItoB,GAAG,GAAG0Q,KAAK,IAAI,CAAT,GAAaC,IAAb,GAAoB1Y,KAA9B;AACA,UAAI0wB,YAAY,GAAGF,UAAU,CAACf,KAAD,EAAQ1nB,GAAR,EAAa0Q,KAAb,EAAoB4X,WAApB,CAA7B;AACA,aAAOL,QAAQ,CAACP,KAAD,EAAQzvB,KAAR,EAAe0Y,IAAI,GAAG,CAAtB,EAAyB,CACtCgY,YADsC,EAEtC,CAACA,YAFqC,CAAzB,EAGZzN,IAHY,CAAf;AAID,KAPD;;AAQA,QAAIwK,gBAAgB,GAAG,UAAUgC,KAAV,EAAiBqB,KAAjB,EAAwB9wB,KAAxB,EAA+B0Y,IAA/B,EAAqCD,KAArC,EAA4C4X,WAA5C,EAAyD;AAC9E,aAAO9C,kBAAkB,CAACkC,KAAD,EAAQzvB,KAAR,EAAe0Y,IAAf,EAAqBD,KAArB,EAA4B4X,WAA5B,CAAzB;AACD,KAFD;;AAGA,QAAIrB,WAAW,GAAG,UAAU+B,OAAV,EAAmBtY,KAAnB,EAA0BiW,YAA1B,EAAwC;AACxD,UAAIA,YAAJ,EAAkB;AAChBqC,QAAAA,OAAO,CAACtY,KAAD,CAAP;AACD;AACF,KAJD;;AAKA,QAAIkV,mBAAmB,GAAG,UAAU8B,KAAV,EAAiBqB,KAAjB,EAAwBM,MAAxB,EAAgC3Y,KAAhC,EAAuC4Y,YAAvC,EAAqD9N,UAArD,EAAiE;AACzF,UAAIA,UAAJ,EAAgB;AACd,eAAON,IAAI,CAACwM,KAAD,CAAX;AACD,OAFD,MAEO;AACL,YAAIa,IAAI,GAAG7X,KAAK,GAAGgX,KAAK,CAACzlC,MAAzB;AACA,eAAOwC,GAAG,CAACijC,KAAD,EAAQplC,QAAQ,CAACimC,IAAD,CAAhB,CAAV;AACD;AACF,KAPD;;AAQA,QAAI1B,eAAe,GAAG,UAAUa,KAAV,EAAiBzvB,KAAjB,EAAwByY,KAAxB,EAA+B4X,WAA/B,EAA4C3B,YAA5C,EAA0D;AAC9E,UAAIA,YAAJ,EAAkB;AAChB,YAAIjW,KAAK,IAAI,CAAb,EAAgB;AACd,iBAAOA,KAAP;AACD,SAFD,MAEO;AACL,cAAI6Y,QAAQ,GAAGpiC,KAAK,CAACugC,KAAD,EAAQ,UAAU3mC,CAAV,EAAa0E,CAAb,EAAgB;AAC1C,mBAAO1E,CAAC,GAAG0E,CAAJ,GAAQ6iC,WAAf;AACD,WAFmB,EAEjB,CAFiB,CAApB;AAGA,iBAAOzmB,IAAI,CAACC,GAAL,CAAS,CAACynB,QAAV,EAAoB7Y,KAApB,CAAP;AACD;AACF,OATD,MASO;AACL,eAAO8X,kBAAkB,CAACd,KAAD,EAAQzvB,KAAR,EAAeyY,KAAf,EAAsB4X,WAAtB,CAAzB;AACD;AACF,KAbD;;AAcA,QAAIT,uBAAuB,GAAG,UAAUH,KAAV,EAAiB8B,WAAjB,EAA8BC,WAA9B,EAA2CC,WAA3C,EAAwD;AACpF,aAAO;AACLhZ,QAAAA,KAAK,EAAE,CADF;AAEL8V,QAAAA,QAAQ,EAAEkB;AAFL,OAAP;AAID,KALD;;AAMA,WAAO;AACLT,MAAAA,WAAW,EAAEA,WADR;AAELJ,MAAAA,eAAe,EAAEA,eAFZ;AAGLrB,MAAAA,kBAAkB,EAAEA,kBAHf;AAILE,MAAAA,gBAAgB,EAAEA,gBAJb;AAKLE,MAAAA,mBAAmB,EAAEA,mBALhB;AAMLiC,MAAAA,uBAAuB,EAAEA;AANpB,KAAP;AAQD,GArDD;;AAuDA,MAAI/C,IAAI,GAAG,UAAUlzB,OAAV,EAAmB+3B,WAAnB,EAAgC;AACzC,QAAIvyB,MAAM,GAAGzR,QAAQ,CAACD,IAAT,CAAckM,OAAO,CAACN,GAAR,CAAY0gB,eAA1B,EAA2CvtB,GAA3C,CAA+CkN,YAAY,CAACZ,OAA5D,EAAqE7M,KAArE,CAA2E0N,OAA3E,CAAb;AACA,WAAO;AACLwF,MAAAA,MAAM,EAAE9U,QAAQ,CAAC8U,MAAD,CADX;AAELwyB,MAAAA,IAAI,EAAEtnC,QAAQ,CAACsP,OAAD,CAFT;AAGLi4B,MAAAA,MAAM,EAAEvnC,QAAQ,CAACqvB,aAAa,CAAC,CAAD,EAAI,CAAJ,CAAd,CAHX;AAILgY,MAAAA,WAAW,EAAEA;AAJR,KAAP;AAMD,GARD;;AASA,MAAIG,QAAQ,GAAG,UAAUC,QAAV,EAAoBj9B,MAApB,EAA4B68B,WAA5B,EAAyC;AACtD,QAAIE,MAAM,GAAG,YAAY;AACvB,aAAO/X,QAAQ,CAAChlB,MAAD,CAAf;AACD,KAFD;;AAGA,WAAO;AACLsK,MAAAA,MAAM,EAAE9U,QAAQ,CAACwK,MAAD,CADX;AAEL88B,MAAAA,IAAI,EAAEtnC,QAAQ,CAACynC,QAAD,CAFT;AAGLF,MAAAA,MAAM,EAAEA,MAHH;AAILF,MAAAA,WAAW,EAAEA;AAJR,KAAP;AAMD,GAVD;;AAWA,MAAIK,MAAM,GAAG,UAAUD,QAAV,EAAoBj9B,MAApB,EAA4B68B,WAA5B,EAAyC;AACpD,WAAO;AACLvyB,MAAAA,MAAM,EAAE9U,QAAQ,CAACwK,MAAD,CADX;AAEL88B,MAAAA,IAAI,EAAEtnC,QAAQ,CAACynC,QAAD,CAFT;AAGLF,MAAAA,MAAM,EAAEvnC,QAAQ,CAACqvB,aAAa,CAAC,CAAD,EAAI,CAAJ,CAAd,CAHX;AAILgY,MAAAA,WAAW,EAAEA;AAJR,KAAP;AAMD,GAPD;;AAQA,MAAIM,UAAU,GAAG;AACfnF,IAAAA,IAAI,EAAEA,IADS;AAEfgF,IAAAA,QAAQ,EAAEA,QAFK;AAGfzwB,IAAAA,IAAI,EAAE2wB;AAHS,GAAjB;AAMA,MAAIE,KAAK,GAAGtd,GAAG,CAAC7L,QAAJ,CAAa,CACvB;AAAEopB,IAAAA,OAAO,EAAE,CAAC,KAAD;AAAX,GADuB,EAEvB;AAAEC,IAAAA,MAAM,EAAE,CAAC,OAAD;AAAV,GAFuB,EAGvB;AAAEC,IAAAA,OAAO,EAAE,CAAC,OAAD;AAAX,GAHuB,CAAb,CAAZ;;AAKA,MAAIC,WAAW,GAAG,UAAUl+B,MAAV,EAAkBzL,IAAlB,EAAwBC,KAAxB,EAA+B;AAC/C,QAAI2pC,SAAS,GAAG3pC,KAAK,CAAC4pC,SAAN,CAAgB,CAAhB,EAAmB5pC,KAAK,CAACqB,MAAN,GAAemK,MAAM,CAACnK,MAAzC,CAAhB;AACA,QAAIkyB,MAAM,GAAGpF,UAAU,CAACwb,SAAD,CAAvB;AACA,WAAOA,SAAS,KAAKpW,MAAM,CAACjvB,QAAP,EAAd,GAAkCvE,IAAI,CAACwzB,MAAD,CAAtC,GAAiD+V,KAAK,CAACC,OAAN,CAAcvpC,KAAd,CAAxD;AACD,GAJD;;AAKA,MAAI6pC,MAAM,GAAG,UAAU7pC,KAAV,EAAiB;AAC5B,QAAIuL,QAAQ,CAACvL,KAAD,EAAQ,GAAR,CAAZ,EAA0B;AACxB,aAAO0pC,WAAW,CAAC,GAAD,EAAMJ,KAAK,CAACG,OAAZ,EAAqBzpC,KAArB,CAAlB;AACD;;AACD,QAAIuL,QAAQ,CAACvL,KAAD,EAAQ,IAAR,CAAZ,EAA2B;AACzB,aAAO0pC,WAAW,CAAC,IAAD,EAAOJ,KAAK,CAACE,MAAb,EAAqBxpC,KAArB,CAAlB;AACD;;AACD,WAAOspC,KAAK,CAACC,OAAN,CAAcvpC,KAAd,CAAP;AACD,GARD;;AASA,MAAI8pC,IAAI,GAAGviC,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK+hC,KAAL,CAAT,EAAsB;AAAExkC,IAAAA,IAAI,EAAE+kC;AAAR,GAAtB,CAAnB;;AAEA,MAAIE,qBAAqB,GAAG,UAAU5E,MAAV,EAAkBkD,UAAlB,EAA8B;AACxD,WAAOxkC,GAAG,CAACshC,MAAD,EAAS,UAAU7jB,CAAV,EAAa;AAC9B,UAAI0oB,OAAO,GAAGF,IAAI,CAAChlC,IAAL,CAAUwc,CAAV,CAAd;AACA,aAAO0oB,OAAO,CAAC9mC,IAAR,CAAa,YAAY;AAC9B,eAAOoe,CAAP;AACD,OAFM,EAEJ,UAAUyT,EAAV,EAAc;AACf,YAAIkT,KAAK,GAAGlT,EAAE,GAAGsT,UAAL,GAAkB,GAA9B;AACA,eAAOJ,KAAK,GAAG,GAAf;AACD,OALM,EAKJ,UAAUgC,EAAV,EAAc;AACf,eAAOA,EAAE,GAAG,GAAZ;AACD,OAPM,CAAP;AAQD,KAVS,CAAV;AAWD,GAZD;;AAaA,MAAIC,gBAAgB,GAAG,UAAU/E,MAAV,EAAkBkD,UAAlB,EAA8B8B,aAA9B,EAA6C;AAClE,QAAIC,KAAK,GAAGD,aAAa,GAAG9B,UAA5B;AACA,WAAOxkC,GAAG,CAACshC,MAAD,EAAS,UAAU7jB,CAAV,EAAa;AAC9B,UAAI0oB,OAAO,GAAGF,IAAI,CAAChlC,IAAL,CAAUwc,CAAV,CAAd;AACA,aAAO0oB,OAAO,CAAC9mC,IAAR,CAAa,YAAY;AAC9B,eAAOoe,CAAP;AACD,OAFM,EAEJ,UAAUyT,EAAV,EAAc;AACf,eAAOA,EAAE,GAAGqV,KAAL,GAAa,IAApB;AACD,OAJM,EAIJ,UAAUH,EAAV,EAAc;AACf,eAAOA,EAAE,GAAG,GAAL,GAAWE,aAAX,GAA2B,IAAlC;AACD,OANM,CAAP;AAOD,KATS,CAAV;AAUD,GAZD;;AAaA,MAAIE,iBAAiB,GAAG,UAAUC,YAAV,EAAwBv2B,OAAxB,EAAiC;AACvD,QAAI5R,CAAC,GAAGmoC,YAAY,CAACpnC,IAAb,CAAkB,YAAY;AACpC,aAAOxB,QAAQ,CAAC,EAAD,CAAf;AACD,KAFO,EAEL,UAAU8nC,MAAV,EAAkB;AACnB,UAAI1jC,GAAG,GAAG0jC,MAAM,GAAGz1B,OAAnB;AACA,aAAOrS,QAAQ,CAACoE,GAAG,GAAG,IAAP,CAAf;AACD,KALO,EAKL,YAAY;AACb,UAAIA,GAAG,GAAG,MAAMiO,OAAhB;AACA,aAAOrS,QAAQ,CAACoE,GAAG,GAAG,GAAP,CAAf;AACD,KARO,CAAR;AASA,WAAOD,KAAK,CAACkO,OAAD,EAAU5R,CAAV,CAAZ;AACD,GAXD;;AAYA,MAAIooC,kBAAkB,GAAG,UAAUD,YAAV,EAAwBnF,MAAxB,EAAgCkD,UAAhC,EAA4C;AACnE,WAAOiC,YAAY,CAACpnC,IAAb,CAAkB,YAAY;AACnC,aAAOiiC,MAAP;AACD,KAFM,EAEJ,UAAUpQ,EAAV,EAAc;AACf,aAAOmV,gBAAgB,CAAC/E,MAAD,EAASkD,UAAT,EAAqBtT,EAArB,CAAvB;AACD,KAJM,EAIJ,UAAUyV,GAAV,EAAe;AAChB,aAAOT,qBAAqB,CAAC5E,MAAD,EAASkD,UAAT,CAA5B;AACD,KANM,CAAP;AAOD,GARD;;AASA,MAAIoC,YAAY,GAAG,UAAUtF,MAAV,EAAkBkD,UAAlB,EAA8BnN,QAA9B,EAAwC;AACzD,QAAIwP,OAAO,GAAGZ,IAAI,CAAChlC,IAAL,CAAUo2B,QAAV,CAAd;AACA,QAAIyP,MAAM,GAAG1mC,MAAM,CAACkhC,MAAD,EAAS,UAAUzgC,CAAV,EAAa;AACvC,aAAOA,CAAC,KAAK,KAAb;AACD,KAFkB,CAAN,GAER2lC,iBAAiB,CAACK,OAAD,EAAUvF,MAAM,CAAC9jC,MAAjB,CAFT,GAEoCkpC,kBAAkB,CAACG,OAAD,EAAUvF,MAAV,EAAkBkD,UAAlB,CAFnE;AAGA,WAAOuC,SAAS,CAACD,MAAD,CAAhB;AACD,GAND;;AAOA,MAAIE,GAAG,GAAG,UAAU13B,MAAV,EAAkBiJ,QAAlB,EAA4B;AACpC,QAAIjJ,MAAM,CAAC9R,MAAP,KAAkB,CAAtB,EAAyB;AACvB,aAAO+a,QAAP;AACD;;AACD,WAAO/V,KAAK,CAAC8M,MAAD,EAAS,UAAUyc,IAAV,EAAgBjrB,CAAhB,EAAmB;AACtC,aAAOmlC,IAAI,CAAChlC,IAAL,CAAUH,CAAV,EAAazB,IAAb,CAAkBxB,QAAQ,CAAC,CAAD,CAA1B,EAA+BC,QAA/B,EAAyCA,QAAzC,IAAqDiuB,IAA5D;AACD,KAFW,EAET,CAFS,CAAZ;AAGD,GAPD;;AAQA,MAAIkb,SAAS,GAAG,UAAUhlC,GAAV,EAAeyuB,IAAf,EAAqB;AACnC,QAAIwW,OAAO,GAAG9pB,IAAI,CAAC4V,KAAL,CAAW/wB,GAAX,CAAd;AACA,WAAO;AACL9F,MAAAA,KAAK,EAAE+qC,OAAO,GAAGxW,IADZ;AAELyW,MAAAA,SAAS,EAAEllC,GAAG,GAAGilC;AAFZ,KAAP;AAID,GAND;;AAOA,MAAIE,GAAG,GAAG,UAAUjrC,KAAV,EAAiBuzB,MAAjB,EAAyB;AACjC,WAAOuW,IAAI,CAAChlC,IAAL,CAAU9E,KAAV,EAAiBkD,IAAjB,CAAsBxB,QAAQ,CAAC1B,KAAD,CAA9B,EAAuC,UAAU+0B,EAAV,EAAc;AAC1D,aAAOA,EAAE,GAAGxB,MAAL,GAAc,IAArB;AACD,KAFM,EAEJ,UAAU0W,EAAV,EAAc;AACf,aAAOA,EAAE,GAAG1W,MAAL,GAAc,GAArB;AACD,KAJM,CAAP;AAKD,GAND;;AAOA,MAAIqX,SAAS,GAAG,UAAUz3B,MAAV,EAAkB;AAChC,QAAIA,MAAM,CAAC9R,MAAP,KAAkB,CAAtB,EAAyB;AACvB,aAAO8R,MAAP;AACD;;AACD,QAAI+3B,IAAI,GAAG7kC,KAAK,CAAC8M,MAAD,EAAS,UAAUyc,IAAV,EAAgB5vB,KAAhB,EAAuB;AAC9C,UAAIyM,IAAI,GAAGq9B,IAAI,CAAChlC,IAAL,CAAU9E,KAAV,EAAiBkD,IAAjB,CAAsB,YAAY;AAC3C,eAAO;AACLlD,UAAAA,KAAK,EAAEA,KADF;AAELgrC,UAAAA,SAAS,EAAE;AAFN,SAAP;AAID,OALU,EAKR,UAAUllC,GAAV,EAAe;AAChB,eAAOglC,SAAS,CAAChlC,GAAD,EAAM,IAAN,CAAhB;AACD,OAPU,EAOR,UAAUA,GAAV,EAAe;AAChB,eAAO;AACL9F,UAAAA,KAAK,EAAE8F,GAAG,GAAG,GADR;AAELklC,UAAAA,SAAS,EAAE;AAFN,SAAP;AAID,OAZU,CAAX;AAaA,aAAO;AACLG,QAAAA,MAAM,EAAE,CAAC1+B,IAAI,CAACzM,KAAN,EAAaiC,MAAb,CAAoB2tB,IAAI,CAACub,MAAzB,CADH;AAELH,QAAAA,SAAS,EAAEpb,IAAI,CAACob,SAAL,GAAiBv+B,IAAI,CAACu+B;AAF5B,OAAP;AAID,KAlBe,EAkBb;AACDG,MAAAA,MAAM,EAAE,EADP;AAEDH,MAAAA,SAAS,EAAE;AAFV,KAlBa,CAAhB;AAsBA,QAAIjlC,CAAC,GAAGmlC,IAAI,CAACC,MAAb;AACA,WAAOplC,CAAC,CAACd,KAAF,CAAQ,CAAR,EAAWc,CAAC,CAAC1E,MAAF,GAAW,CAAtB,EAAyBY,MAAzB,CAAgC,CAACgpC,GAAG,CAACllC,CAAC,CAACA,CAAC,CAAC1E,MAAF,GAAW,CAAZ,CAAF,EAAkB4f,IAAI,CAACmqB,KAAL,CAAWF,IAAI,CAACF,SAAhB,CAAlB,CAAJ,CAAhC,CAAP;AACD,GA5BD;;AA6BA,MAAIK,QAAQ,GAAGvB,IAAI,CAAChlC,IAApB;;AAEA,MAAIwmC,eAAe,GAAG,UAAUnF,SAAV,EAAqBxxB,KAArB,EAA4B4f,IAA5B,EAAkC;AACtDzwB,IAAAA,IAAI,CAAC6Q,KAAD,EAAQ,UAAUwH,IAAV,EAAgB;AAC1B,UAAIgpB,MAAM,GAAGgB,SAAS,CAAClhC,KAAV,CAAgBkX,IAAI,CAACjI,MAArB,EAA6BiI,IAAI,CAAC9H,OAAL,GAAe8H,IAAI,CAACjI,MAAjD,CAAb;AACA,UAAIoN,CAAC,GAAGupB,GAAG,CAAC1F,MAAD,EAASzoB,QAAQ,EAAjB,CAAX;AACAtB,MAAAA,KAAK,CAACe,IAAI,CAACnL,OAAN,EAAe,OAAf,EAAwBsQ,CAAC,GAAGiT,IAA5B,CAAL;AACD,KAJG,CAAJ;AAKD,GAND;;AAOA,MAAIgX,qBAAqB,GAAG,UAAUpF,SAAV,EAAqBpyB,OAArB,EAA8BwgB,IAA9B,EAAoC;AAC9DzwB,IAAAA,IAAI,CAACiQ,OAAD,EAAU,UAAUG,MAAV,EAAkBmD,KAAlB,EAAyB;AACrC,UAAIic,KAAK,GAAGuX,GAAG,CAAC,CAAC1E,SAAS,CAAC9uB,KAAD,CAAV,CAAD,EAAqBqF,QAAQ,EAA7B,CAAf;AACAtB,MAAAA,KAAK,CAAClH,MAAM,CAAClD,OAAR,EAAiB,OAAjB,EAA0BsiB,KAAK,GAAGiB,IAAlC,CAAL;AACD,KAHG,CAAJ;AAID,GALD;;AAMA,MAAIiX,eAAe,GAAG,UAAUjF,UAAV,EAAsBzyB,IAAtB,EAA4Ba,KAA5B,EAAmC4f,IAAnC,EAAyC;AAC7DzwB,IAAAA,IAAI,CAAC6Q,KAAD,EAAQ,UAAUwH,IAAV,EAAgB;AAC1B,UAAIopB,OAAO,GAAGgB,UAAU,CAACthC,KAAX,CAAiBkX,IAAI,CAAClI,GAAtB,EAA2BkI,IAAI,CAAC/H,OAAL,GAAe+H,IAAI,CAAClI,GAA/C,CAAd;AACA,UAAIia,CAAC,GAAG2c,GAAG,CAACtF,OAAD,EAAU5oB,SAAS,EAAnB,CAAX;AACAvB,MAAAA,KAAK,CAACe,IAAI,CAACnL,OAAN,EAAe,QAAf,EAAyBkd,CAAC,GAAGqG,IAA7B,CAAL;AACD,KAJG,CAAJ;AAKAzwB,IAAAA,IAAI,CAACgQ,IAAD,EAAO,UAAUG,GAAV,EAAetO,CAAf,EAAkB;AAC3ByV,MAAAA,KAAK,CAACnH,GAAG,CAACjD,OAAL,EAAc,QAAd,EAAwBu1B,UAAU,CAAC5gC,CAAD,CAAlC,CAAL;AACD,KAFG,CAAJ;AAGD,GATD;;AAUA,MAAI8lC,OAAO,GAAG,UAAU9U,OAAV,EAAmB;AAC/B,WAAO0U,QAAQ,CAAC1U,OAAD,CAAR,CAAkBzzB,IAAlB,CAAuBxB,QAAQ,CAAC,IAAD,CAA/B,EAAuCA,QAAQ,CAAC,IAAD,CAA/C,EAAuDA,QAAQ,CAAC,GAAD,CAA/D,CAAP;AACD,GAFD;;AAGA,MAAIgqC,cAAc,GAAG,UAAUruB,KAAV,EAAiBsuB,QAAjB,EAA2BC,SAA3B,EAAsCtU,SAAtC,EAAiD;AACpE,QAAI9X,SAAS,GAAGkC,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAhB;AACA,QAAIvJ,IAAI,GAAG0L,SAAS,CAACxd,GAArB;AACA,QAAI2S,KAAK,GAAG+M,SAAS,CAACL,SAAV,CAAoB7B,SAApB,CAAZ;AACA,QAAIzL,OAAO,GAAG2N,SAAS,CAACH,WAAV,CAAsB/B,SAAtB,CAAd;AACAmsB,IAAAA,QAAQ,CAAC7nC,IAAT,CAAc,UAAUo3B,QAAV,EAAoB;AAChC,UAAI2Q,SAAS,GAAGJ,OAAO,CAACvQ,QAAD,CAAvB;AACA,UAAImN,UAAU,GAAGxZ,KAAK,CAACxR,KAAD,CAAtB;AACA,UAAIyuB,SAAS,GAAGnS,YAAY,CAACna,SAAD,EAAYnC,KAAZ,EAAmBia,SAAnB,CAA5B;AACA,UAAIyU,QAAQ,GAAGtB,YAAY,CAACqB,SAAD,EAAYzD,UAAZ,EAAwBnN,QAAxB,CAA3B;;AACA,UAAIxZ,SAAS,CAACF,UAAV,CAAqBhC,SAArB,CAAJ,EAAqC;AACnC+rB,QAAAA,qBAAqB,CAACQ,QAAD,EAAWh4B,OAAX,EAAoB83B,SAApB,CAArB;AACD,OAFD,MAEO;AACLP,QAAAA,eAAe,CAACS,QAAD,EAAWp3B,KAAX,EAAkBk3B,SAAlB,CAAf;AACD;;AACDzwB,MAAAA,KAAK,CAACiC,KAAD,EAAQ,OAAR,EAAiB6d,QAAjB,CAAL;AACD,KAXD;AAYA0Q,IAAAA,SAAS,CAAC9nC,IAAV,CAAe,UAAUkoC,SAAV,EAAqB;AAClC,UAAIC,KAAK,GAAGR,OAAO,CAACO,SAAD,CAAnB;AACA,UAAIE,WAAW,GAAGxb,KAAK,CAACrT,KAAD,CAAvB;AACA,UAAI8uB,UAAU,GAAGjS,aAAa,CAAC1a,SAAD,EAAYnC,KAAZ,EAAmBmT,MAAnB,CAA9B;AACA,UAAI4b,SAAS,GAAG3B,YAAY,CAAC0B,UAAD,EAAaD,WAAb,EAA0BF,SAA1B,CAA5B;AACAR,MAAAA,eAAe,CAACY,SAAD,EAAYt4B,IAAZ,EAAkBa,KAAlB,EAAyBs3B,KAAzB,CAAf;AACA7wB,MAAAA,KAAK,CAACiC,KAAD,EAAQ,QAAR,EAAkB2uB,SAAlB,CAAL;AACD,KAPD;AAQD,GAzBD;;AA0BA,MAAIK,iBAAiB,GAAG/T,eAAxB;AACA,MAAIgU,eAAe,GAAG/T,aAAtB;AACA,MAAIgU,cAAc,GAAG/T,YAArB;AACA,MAAIgU,sBAAsB,GAAGnU,oBAA7B;;AAEA,MAAIoU,WAAW,GAAG,UAAUpvB,KAAV,EAAiB;AACjC,QAAImC,SAAS,GAAGkC,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAhB;AACA,WAAOmC,SAAS,CAAC3L,IAAjB;AACD,GAHD;;AAKA,MAAI64B,KAAK,GAAG,UAAUC,MAAV,EAAkB;AAC5B,QAAIC,QAAQ,GAAG,EAAf;;AACA,QAAI7oC,IAAI,GAAG,UAAU8oC,OAAV,EAAmB;AAC5B,UAAIA,OAAO,KAAKpsC,SAAhB,EAA2B;AACzB,cAAM,IAAI6B,KAAJ,CAAU,qCAAV,CAAN;AACD;;AACDsqC,MAAAA,QAAQ,CAACvnC,IAAT,CAAcwnC,OAAd;AACD,KALD;;AAMA,QAAIC,MAAM,GAAG,UAAUD,OAAV,EAAmB;AAC9BD,MAAAA,QAAQ,GAAG1oC,MAAM,CAAC0oC,QAAD,EAAW,UAAU1e,CAAV,EAAa;AACvC,eAAOA,CAAC,KAAK2e,OAAb;AACD,OAFgB,CAAjB;AAGD,KAJD;;AAKA,QAAIE,OAAO,GAAG,YAAY;AACxB,UAAI7rC,IAAI,GAAG,EAAX;;AACA,WAAK,IAAIC,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAACC,MAAhC,EAAwCF,EAAE,EAA1C,EAA8C;AAC5CD,QAAAA,IAAI,CAACC,EAAD,CAAJ,GAAWC,SAAS,CAACD,EAAD,CAApB;AACD;;AACD,UAAI+W,KAAK,GAAG,EAAZ;AACApU,MAAAA,IAAI,CAAC6oC,MAAD,EAAS,UAAU/sC,IAAV,EAAgB+F,CAAhB,EAAmB;AAC9BuS,QAAAA,KAAK,CAACtY,IAAD,CAAL,GAAcsB,IAAI,CAACyE,CAAD,CAAlB;AACD,OAFG,CAAJ;AAGA7B,MAAAA,IAAI,CAAC8oC,QAAD,EAAW,UAAUC,OAAV,EAAmB;AAChCA,QAAAA,OAAO,CAAC30B,KAAD,CAAP;AACD,OAFG,CAAJ;AAGD,KAZD;;AAaA,WAAO;AACLnU,MAAAA,IAAI,EAAEA,IADD;AAEL+oC,MAAAA,MAAM,EAAEA,MAFH;AAGLC,MAAAA,OAAO,EAAEA;AAHJ,KAAP;AAKD,GA/BD;;AAiCA,MAAI1lB,MAAM,GAAG,UAAU2lB,QAAV,EAAoB;AAC/B,QAAIC,QAAQ,GAAGv6B,KAAK,CAACs6B,QAAD,EAAW,UAAU90B,KAAV,EAAiB;AAC9C,aAAO;AACLnU,QAAAA,IAAI,EAAEmU,KAAK,CAACnU,IADP;AAEL+oC,QAAAA,MAAM,EAAE50B,KAAK,CAAC40B;AAFT,OAAP;AAID,KALmB,CAApB;AAMA,QAAIC,OAAO,GAAGr6B,KAAK,CAACs6B,QAAD,EAAW,UAAU90B,KAAV,EAAiB;AAC7C,aAAOA,KAAK,CAAC60B,OAAb;AACD,KAFkB,CAAnB;AAGA,WAAO;AACLE,MAAAA,QAAQ,EAAEA,QADL;AAELF,MAAAA,OAAO,EAAEA;AAFJ,KAAP;AAID,GAdD;;AAgBA,MAAIG,MAAM,GAAG,UAAUrrC,EAAV,EAAcsrC,IAAd,EAAoB;AAC/B,QAAIC,KAAK,GAAG,IAAZ;;AACA,QAAIC,MAAM,GAAG,YAAY;AACvB,UAAID,KAAK,KAAK,IAAd,EAAoB;AAClBE,QAAAA,YAAY,CAACF,KAAD,CAAZ;AACAA,QAAAA,KAAK,GAAG,IAAR;AACD;AACF,KALD;;AAMA,QAAIG,QAAQ,GAAG,YAAY;AACzB,UAAIrsC,IAAI,GAAG,EAAX;;AACA,WAAK,IAAIC,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAACC,MAAhC,EAAwCF,EAAE,EAA1C,EAA8C;AAC5CD,QAAAA,IAAI,CAACC,EAAD,CAAJ,GAAWC,SAAS,CAACD,EAAD,CAApB;AACD;;AACD,UAAIisC,KAAK,KAAK,IAAd,EAAoB;AAClBE,QAAAA,YAAY,CAACF,KAAD,CAAZ;AACD;;AACDA,MAAAA,KAAK,GAAGI,UAAU,CAAC,YAAY;AAC7B3rC,QAAAA,EAAE,CAACP,KAAH,CAAS,IAAT,EAAeJ,IAAf;AACAksC,QAAAA,KAAK,GAAG,IAAR;AACD,OAHiB,EAGfD,IAHe,CAAlB;AAID,KAZD;;AAaA,WAAO;AACLE,MAAAA,MAAM,EAAEA,MADH;AAELE,MAAAA,QAAQ,EAAEA;AAFL,KAAP;AAID,GAzBD;;AA2BA,MAAIE,MAAM,GAAG,UAAUrnC,GAAV,EAAe;AAC1B,WAAOA,GAAG,CAACnB,KAAJ,CAAU,CAAV,EAAa+B,IAAb,EAAP;AACD,GAFD;;AAGA,MAAI0mC,UAAU,GAAG,UAAUC,QAAV,EAAoBr7B,IAApB,EAA0B;AACzC,UAAM,IAAIhQ,KAAJ,CAAU,wBAAwBmrC,MAAM,CAACE,QAAD,CAAN,CAAiBzwB,IAAjB,CAAsB,IAAtB,CAAxB,GAAsD,6CAAtD,GAAsGuwB,MAAM,CAACn7B,IAAD,CAAN,CAAa4K,IAAb,CAAkB,IAAlB,CAAtG,GAAgI,GAA1I,CAAN;AACD,GAFD;;AAGA,MAAI0wB,aAAa,GAAG,UAAUC,WAAV,EAAuB;AACzC,UAAM,IAAIvrC,KAAJ,CAAU,kCAAkCmrC,MAAM,CAACI,WAAD,CAAN,CAAoB3wB,IAApB,CAAyB,IAAzB,CAA5C,CAAN;AACD,GAFD;;AAGA,MAAI4wB,cAAc,GAAG,UAAUhiB,KAAV,EAAiB6G,KAAjB,EAAwB;AAC3C,QAAI,CAACryB,OAAO,CAACqyB,KAAD,CAAZ,EAAqB;AACnB,YAAM,IAAIrwB,KAAJ,CAAU,SAASwpB,KAAT,GAAiB,iCAAjB,GAAqD6G,KAArD,GAA6D,GAAvE,CAAN;AACD;;AACD7uB,IAAAA,IAAI,CAAC6uB,KAAD,EAAQ,UAAUxyB,CAAV,EAAa;AACvB,UAAI,CAACC,QAAQ,CAACD,CAAD,CAAb,EAAkB;AAChB,cAAM,IAAImC,KAAJ,CAAU,eAAenC,CAAf,GAAmB,UAAnB,GAAgC2rB,KAAhC,GAAwC,2BAAlD,CAAN;AACD;AACF,KAJG,CAAJ;AAKD,GATD;;AAUA,MAAIiiB,kBAAkB,GAAG,UAAUC,SAAV,EAAqBjuC,IAArB,EAA2B;AAClD,UAAM,IAAIuC,KAAJ,CAAU,oCAAoCvC,IAApC,GAA2C,UAA3C,GAAwD0tC,MAAM,CAACO,SAAD,CAAN,CAAkB9wB,IAAlB,CAAuB,IAAvB,CAAxD,GAAuF,aAAjG,CAAN;AACD,GAFD;;AAGA,MAAI+wB,UAAU,GAAG,UAAUC,UAAV,EAAsB;AACrC,QAAIC,MAAM,GAAGV,MAAM,CAACS,UAAD,CAAnB;AACA,QAAIE,IAAI,GAAG1nC,IAAI,CAACynC,MAAD,EAAS,UAAUzpC,CAAV,EAAaiB,CAAb,EAAgB;AACtC,aAAOA,CAAC,GAAGwoC,MAAM,CAAC9sC,MAAP,GAAgB,CAApB,IAAyBqD,CAAC,KAAKypC,MAAM,CAACxoC,CAAC,GAAG,CAAL,CAA5C;AACD,KAFc,CAAf;AAGAyoC,IAAAA,IAAI,CAACtqC,IAAL,CAAU,UAAUof,CAAV,EAAa;AACrB,YAAM,IAAI5gB,KAAJ,CAAU,gBAAgB4gB,CAAhB,GAAoB,kDAApB,GAAyEirB,MAAM,CAACjxB,IAAP,CAAY,IAAZ,CAAzE,GAA6F,IAAvG,CAAN;AACD,KAFD;AAGD,GARD;;AAUA,MAAIzL,IAAI,GAAG,UAAU48B,iBAAV,EAA6BV,QAA7B,EAAuC;AAChD,WAAOW,QAAQ,CAACD,iBAAD,EAAoBV,QAApB,EAA8B;AAC3CtC,MAAAA,QAAQ,EAAEzqC,UADiC;AAE3CkrB,MAAAA,KAAK,EAAE;AAFoC,KAA9B,CAAf;AAID,GALD;;AAMA,MAAIwiB,QAAQ,GAAG,UAAUD,iBAAV,EAA6BV,QAA7B,EAAuCjoC,IAAvC,EAA6C;AAC1D,QAAIioC,QAAQ,CAACtsC,MAAT,KAAoB,CAAxB,EAA2B;AACzB,YAAM,IAAIiB,KAAJ,CAAU,+CAAV,CAAN;AACD;;AACDwrC,IAAAA,cAAc,CAAC,UAAD,EAAaH,QAAb,CAAd;AACAM,IAAAA,UAAU,CAACN,QAAD,CAAV;AACA,WAAO,UAAUn7B,GAAV,EAAe;AACpB,UAAI8Y,MAAM,GAAGhZ,IAAI,CAACE,GAAD,CAAjB;AACA,UAAIkZ,OAAO,GAAGznB,MAAM,CAAC0pC,QAAD,EAAW,UAAUY,GAAV,EAAe;AAC5C,eAAO/oC,QAAQ,CAAC8lB,MAAD,EAASijB,GAAT,CAAf;AACD,OAFmB,CAApB;;AAGA,UAAI,CAAC7iB,OAAL,EAAc;AACZgiB,QAAAA,UAAU,CAACC,QAAD,EAAWriB,MAAX,CAAV;AACD;;AACD+iB,MAAAA,iBAAiB,CAACV,QAAD,EAAWriB,MAAX,CAAjB;AACA,UAAIkjB,WAAW,GAAGtqC,MAAM,CAACypC,QAAD,EAAW,UAAUr6B,GAAV,EAAe;AAChD,eAAO,CAAC5N,IAAI,CAAC2lC,QAAL,CAAc74B,GAAG,CAACc,GAAD,CAAjB,EAAwBA,GAAxB,CAAR;AACD,OAFuB,CAAxB;;AAGA,UAAIk7B,WAAW,CAACntC,MAAZ,GAAqB,CAAzB,EAA4B;AAC1B0sC,QAAAA,kBAAkB,CAACS,WAAD,EAAc9oC,IAAI,CAAComB,KAAnB,CAAlB;AACD;;AACD,aAAOtZ,GAAP;AACD,KAhBD;AAiBD,GAvBD;;AAwBA,MAAIi8B,WAAW,GAAG,UAAUd,QAAV,EAAoBr7B,IAApB,EAA0B;AAC1C,QAAIu7B,WAAW,GAAG3pC,MAAM,CAACoO,IAAD,EAAO,UAAUgB,GAAV,EAAe;AAC5C,aAAO,CAAC9N,QAAQ,CAACmoC,QAAD,EAAWr6B,GAAX,CAAhB;AACD,KAFuB,CAAxB;;AAGA,QAAIu6B,WAAW,CAACxsC,MAAZ,GAAqB,CAAzB,EAA4B;AAC1BusC,MAAAA,aAAa,CAACC,WAAD,CAAb;AACD;AACF,GAPD;;AAQA,MAAIa,OAAO,GAAG,UAAUf,QAAV,EAAoB;AAChC,WAAOl8B,IAAI,CAACg9B,WAAD,EAAcd,QAAd,CAAX;AACD,GAFD;;AAIA,MAAIgB,QAAQ,GAAGD,OAAO,CAAC,CACrB,SADqB,EAErB,SAFqB,EAGrB,QAHqB,EAIrB,MAJqB,CAAD,CAAtB;AAMA,MAAIE,QAAQ,GAAGF,OAAO,CAAC,CACrB,SADqB,EAErB,OAFqB,EAGrB,MAHqB,EAIrB,SAJqB,CAAD,CAAtB;AAMA,MAAIG,OAAO,GAAGH,OAAO,CAAC,CACpB,WADoB,EAEpB,MAFoB,EAGpB,MAHoB,EAIpB,WAJoB,CAAD,CAArB;;AAOA,MAAII,MAAM,GAAG,YAAY;AACvB,QAAIC,QAAQ,GAAGhqC,QAAQ,CAACtC,IAAT,EAAf;;AACA,QAAIusC,KAAK,GAAG,YAAY;AACtBD,MAAAA,QAAQ,GAAGhqC,QAAQ,CAACtC,IAAT,EAAX;AACD,KAFD;;AAGA,QAAIwsC,MAAM,GAAG,UAAUC,IAAV,EAAgBplC,EAAhB,EAAoB;AAC/B,UAAIiP,MAAM,GAAGg2B,QAAQ,CAAClrC,GAAT,CAAa,UAAUsrC,GAAV,EAAe;AACvC,eAAOD,IAAI,CAACE,OAAL,CAAaD,GAAb,EAAkBrlC,EAAlB,CAAP;AACD,OAFY,CAAb;AAGAilC,MAAAA,QAAQ,GAAGhqC,QAAQ,CAACR,IAAT,CAAcuF,EAAd,CAAX;AACA,aAAOiP,MAAP;AACD,KAND;;AAOA,QAAIs2B,OAAO,GAAG,UAAUn3B,KAAV,EAAiBg3B,IAAjB,EAAuB;AACnC,UAAII,UAAU,GAAGJ,IAAI,CAAC5R,OAAL,CAAaplB,KAAb,CAAjB;AACAo3B,MAAAA,UAAU,CAACxrC,IAAX,CAAgB,UAAU+/B,IAAV,EAAgB;AAC9B,YAAI0L,MAAM,GAAGN,MAAM,CAACC,IAAD,EAAOrL,IAAP,CAAnB;AACA0L,QAAAA,MAAM,CAACzrC,IAAP,CAAY,UAAUof,CAAV,EAAa;AACvBssB,UAAAA,MAAM,CAACzC,OAAP,CAAe0C,IAAf,CAAoBvsB,CAApB;AACD,SAFD;AAGD,OALD;AAMD,KARD;;AASA,QAAIssB,MAAM,GAAGnoB,MAAM,CAAC;AAAEooB,MAAAA,IAAI,EAAE/C,KAAK,CAAC,CAAC,MAAD,CAAD;AAAb,KAAD,CAAnB;AACA,WAAO;AACL2C,MAAAA,OAAO,EAAEA,OADJ;AAELL,MAAAA,KAAK,EAAEA,KAFF;AAGLQ,MAAAA,MAAM,EAAEA,MAAM,CAACvC;AAHV,KAAP;AAKD,GA3BD;;AA6BA,MAAIyC,MAAM,GAAG,YAAY;AACvB,QAAIF,MAAM,GAAGnoB,MAAM,CAAC;AAAEooB,MAAAA,IAAI,EAAE/C,KAAK,CAAC,CAAC,MAAD,CAAD;AAAb,KAAD,CAAnB;AACA,WAAO;AACL2C,MAAAA,OAAO,EAAEvuC,IADJ;AAELkuC,MAAAA,KAAK,EAAEluC,IAFF;AAGL0uC,MAAAA,MAAM,EAAEA,MAAM,CAACvC;AAHV,KAAP;AAKD,GAPD;;AASA,MAAI0C,QAAQ,GAAG,YAAY;AACzB,QAAIC,WAAW,GAAGF,MAAM,EAAxB;AACA,QAAIG,WAAW,GAAGf,MAAM,EAAxB;AACA,QAAIgB,SAAS,GAAGF,WAAhB;;AACA,QAAI1M,EAAE,GAAG,YAAY;AACnB4M,MAAAA,SAAS,CAACd,KAAV;AACAc,MAAAA,SAAS,GAAGD,WAAZ;AACD,KAHD;;AAIA,QAAIE,GAAG,GAAG,YAAY;AACpBD,MAAAA,SAAS,CAACd,KAAV;AACAc,MAAAA,SAAS,GAAGF,WAAZ;AACD,KAHD;;AAIA,QAAIP,OAAO,GAAG,UAAUn3B,KAAV,EAAiBg3B,IAAjB,EAAuB;AACnCY,MAAAA,SAAS,CAACT,OAAV,CAAkBn3B,KAAlB,EAAyBg3B,IAAzB;AACD,KAFD;;AAGA,QAAIc,IAAI,GAAG,YAAY;AACrB,aAAOF,SAAS,KAAKD,WAArB;AACD,KAFD;;AAGA,WAAO;AACL3M,MAAAA,EAAE,EAAEA,EADC;AAEL6M,MAAAA,GAAG,EAAEA,GAFA;AAGLC,MAAAA,IAAI,EAAEA,IAHD;AAILX,MAAAA,OAAO,EAAEA,OAJJ;AAKLG,MAAAA,MAAM,EAAEK,WAAW,CAACL;AALf,KAAP;AAOD,GAzBD;;AA2BA,MAAIS,KAAK,GAAG,UAAUC,QAAV,EAAoBhB,IAApB,EAA0BiB,QAA1B,EAAoC;AAC9C,QAAIC,MAAM,GAAG,KAAb;AACA,QAAIZ,MAAM,GAAGnoB,MAAM,CAAC;AAClBlc,MAAAA,KAAK,EAAEuhC,KAAK,CAAC,EAAD,CADM;AAElB91B,MAAAA,IAAI,EAAE81B,KAAK,CAAC,EAAD;AAFO,KAAD,CAAnB;AAIA,QAAI2D,QAAQ,GAAGV,QAAQ,EAAvB;;AACA,QAAIW,IAAI,GAAG,YAAY;AACrBC,MAAAA,IAAI,CAAC35B,IAAL;;AACA,UAAIy5B,QAAQ,CAACL,IAAT,EAAJ,EAAqB;AACnBK,QAAAA,QAAQ,CAACN,GAAT;AACAP,QAAAA,MAAM,CAACzC,OAAP,CAAen2B,IAAf;AACD;AACF,KAND;;AAOA,QAAI45B,aAAa,GAAGtD,MAAM,CAACoD,IAAD,EAAO,GAAP,CAA1B;;AACA,QAAIG,EAAE,GAAG,UAAUj6B,MAAV,EAAkB;AACzB+5B,MAAAA,IAAI,CAACplC,KAAL,CAAWqL,MAAX;AACA65B,MAAAA,QAAQ,CAACnN,EAAT;AACAsM,MAAAA,MAAM,CAACzC,OAAP,CAAe5hC,KAAf;AACD,KAJD;;AAKA,QAAIulC,SAAS,GAAG,UAAUx4B,KAAV,EAAiB;AAC/Bs4B,MAAAA,aAAa,CAACnD,MAAd;AACAgD,MAAAA,QAAQ,CAAChB,OAAT,CAAiBn3B,KAAjB,EAAwBg3B,IAAxB;AACD,KAHD;;AAIAmB,IAAAA,QAAQ,CAACb,MAAT,CAAgBC,IAAhB,CAAqB1rC,IAArB,CAA0B,UAAUmU,KAAV,EAAiB;AACzCg3B,MAAAA,IAAI,CAAC7P,MAAL,CAAY6Q,QAAZ,EAAsBh4B,KAAK,CAACzL,IAA5B;AACD,KAFD;;AAGA,QAAIy2B,EAAE,GAAG,YAAY;AACnBkN,MAAAA,MAAM,GAAG,IAAT;AACD,KAFD;;AAGA,QAAIL,GAAG,GAAG,YAAY;AACpBK,MAAAA,MAAM,GAAG,KAAT;AACD,KAFD;;AAGA,QAAIO,WAAW,GAAG,UAAUxuC,CAAV,EAAa;AAC7B,aAAO,YAAY;AACjB,YAAIjB,IAAI,GAAG,EAAX;;AACA,aAAK,IAAIC,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAACC,MAAhC,EAAwCF,EAAE,EAA1C,EAA8C;AAC5CD,UAAAA,IAAI,CAACC,EAAD,CAAJ,GAAWC,SAAS,CAACD,EAAD,CAApB;AACD;;AACD,YAAIivC,MAAJ,EAAY;AACVjuC,UAAAA,CAAC,CAACb,KAAF,CAAQ,IAAR,EAAcJ,IAAd;AACD;AACF,OARD;AASD,KAVD;;AAWA,QAAIqvC,IAAI,GAAGrB,IAAI,CAACqB,IAAL,CAAU1B,OAAO,CAAC;AAC3B+B,MAAAA,SAAS,EAAEN,IADgB;AAE3BA,MAAAA,IAAI,EAAEK,WAAW,CAACL,IAAD,CAFU;AAG3Bb,MAAAA,IAAI,EAAEkB,WAAW,CAACD,SAAD,CAHU;AAI3BG,MAAAA,SAAS,EAAEF,WAAW,CAACH,aAAa,CAACjD,QAAf;AAJK,KAAD,CAAjB,EAKP4C,QALO,CAAX;;AAMA,QAAIW,OAAO,GAAG,YAAY;AACxBP,MAAAA,IAAI,CAACO,OAAL;AACD,KAFD;;AAGA,WAAO;AACL9/B,MAAAA,OAAO,EAAEu/B,IAAI,CAACv/B,OADT;AAELy/B,MAAAA,EAAE,EAAEA,EAFC;AAGLvN,MAAAA,EAAE,EAAEA,EAHC;AAIL6M,MAAAA,GAAG,EAAEA,GAJA;AAKLe,MAAAA,OAAO,EAAEA,OALJ;AAMLtB,MAAAA,MAAM,EAAEA,MAAM,CAACvC;AANV,KAAP;AAQD,GA7DD;;AA+DA,MAAI8D,OAAO,GAAG,UAAUjlC,MAAV,EAAkBxM,CAAlB,EAAqBuR,CAArB,EAAwB+F,IAAxB,EAA8Bo6B,OAA9B,EAAuCC,IAAvC,EAA6Cr1B,GAA7C,EAAkD;AAC9D,WAAO;AACL9P,MAAAA,MAAM,EAAEA,MADH;AAELxM,MAAAA,CAAC,EAAEA,CAFE;AAGLuR,MAAAA,CAAC,EAAEA,CAHE;AAIL+F,MAAAA,IAAI,EAAEA,IAJD;AAKLo6B,MAAAA,OAAO,EAAEA,OALJ;AAMLC,MAAAA,IAAI,EAAEA,IAND;AAOLr1B,MAAAA,GAAG,EAAEA;AAPA,KAAP;AASD,GAVD;;AAWA,MAAIs1B,YAAY,GAAG,UAAUC,QAAV,EAAoB;AACrC,QAAIrlC,MAAM,GAAGiF,YAAY,CAACZ,OAAb,CAAqB8H,sBAAsB,CAACk5B,QAAD,CAAtB,CAAiC7tC,KAAjC,CAAuC6tC,QAAQ,CAACrlC,MAAhD,CAArB,CAAb;;AACA,QAAI8K,IAAI,GAAG,YAAY;AACrB,aAAOu6B,QAAQ,CAACC,eAAT,EAAP;AACD,KAFD;;AAGA,QAAIJ,OAAO,GAAG,YAAY;AACxB,aAAOG,QAAQ,CAAC/N,cAAT,EAAP;AACD,KAFD;;AAGA,QAAI6N,IAAI,GAAGlwC,OAAO,CAACiwC,OAAD,EAAUp6B,IAAV,CAAlB;AACA,WAAOm6B,OAAO,CAACjlC,MAAD,EAASqlC,QAAQ,CAACE,OAAlB,EAA2BF,QAAQ,CAACG,OAApC,EAA6C16B,IAA7C,EAAmDo6B,OAAnD,EAA4DC,IAA5D,EAAkEE,QAAlE,CAAd;AACD,GAVD;;AAWA,MAAII,MAAM,GAAG,UAAUrtC,MAAV,EAAkB2oC,OAAlB,EAA2B;AACtC,WAAO,UAAUsE,QAAV,EAAoB;AACzB,UAAIjtC,MAAM,CAACitC,QAAD,CAAV,EAAsB;AACpBtE,QAAAA,OAAO,CAACqE,YAAY,CAACC,QAAD,CAAb,CAAP;AACD;AACF,KAJD;AAKD,GAND;;AAOA,MAAIK,MAAM,GAAG,UAAUxgC,OAAV,EAAmBkH,KAAnB,EAA0BhU,MAA1B,EAAkC2oC,OAAlC,EAA2C4E,UAA3C,EAAuD;AAClE,QAAIC,OAAO,GAAGH,MAAM,CAACrtC,MAAD,EAAS2oC,OAAT,CAApB;AACA77B,IAAAA,OAAO,CAACN,GAAR,CAAYihC,gBAAZ,CAA6Bz5B,KAA7B,EAAoCw5B,OAApC,EAA6CD,UAA7C;AACA,WAAO;AAAE3E,MAAAA,MAAM,EAAElrC,KAAK,CAACkrC,MAAD,EAAS97B,OAAT,EAAkBkH,KAAlB,EAAyBw5B,OAAzB,EAAkCD,UAAlC;AAAf,KAAP;AACD,GAJD;;AAKA,MAAIG,MAAM,GAAG,UAAU5gC,OAAV,EAAmBkH,KAAnB,EAA0BhU,MAA1B,EAAkC2oC,OAAlC,EAA2C;AACtD,WAAO2E,MAAM,CAACxgC,OAAD,EAAUkH,KAAV,EAAiBhU,MAAjB,EAAyB2oC,OAAzB,EAAkC,KAAlC,CAAb;AACD,GAFD;;AAGA,MAAIC,MAAM,GAAG,UAAU97B,OAAV,EAAmBkH,KAAnB,EAA0B20B,OAA1B,EAAmC4E,UAAnC,EAA+C;AAC1DzgC,IAAAA,OAAO,CAACN,GAAR,CAAYmhC,mBAAZ,CAAgC35B,KAAhC,EAAuC20B,OAAvC,EAAgD4E,UAAhD;AACD,GAFD;;AAIA,MAAIK,QAAQ,GAAGtvC,MAAf;;AACA,MAAIuvC,MAAM,GAAG,UAAU/gC,OAAV,EAAmBkH,KAAnB,EAA0B20B,OAA1B,EAAmC;AAC9C,WAAO+E,MAAM,CAAC5gC,OAAD,EAAUkH,KAAV,EAAiB45B,QAAjB,EAA2BjF,OAA3B,CAAb;AACD,GAFD;;AAGA,MAAImF,cAAc,GAAGd,YAArB;;AAEA,MAAIe,IAAI,GAAG,UAAUjhC,OAAV,EAAmB2J,IAAnB,EAAyB;AAClC,QAAI3a,KAAK,GAAGoa,KAAK,CAACpJ,OAAD,EAAU2J,IAAV,CAAjB;AACA,WAAO3a,KAAK,KAAKS,SAAV,IAAuBT,KAAK,KAAK,EAAjC,GAAsC,EAAtC,GAA2CA,KAAK,CAACkyC,KAAN,CAAY,GAAZ,CAAlD;AACD,GAHD;;AAIA,MAAIC,KAAK,GAAG,UAAUnhC,OAAV,EAAmB2J,IAAnB,EAAyB5X,EAAzB,EAA6B;AACvC,QAAIosC,GAAG,GAAG8C,IAAI,CAACjhC,OAAD,EAAU2J,IAAV,CAAd;AACA,QAAI7Q,EAAE,GAAGqlC,GAAG,CAACltC,MAAJ,CAAW,CAACc,EAAD,CAAX,CAAT;AACAkX,IAAAA,GAAG,CAACjJ,OAAD,EAAU2J,IAAV,EAAgB7Q,EAAE,CAACoT,IAAH,CAAQ,GAAR,CAAhB,CAAH;AACA,WAAO,IAAP;AACD,GALD;;AAMA,MAAIk1B,QAAQ,GAAG,UAAUphC,OAAV,EAAmB2J,IAAnB,EAAyB5X,EAAzB,EAA6B;AAC1C,QAAI+G,EAAE,GAAG5F,MAAM,CAAC+tC,IAAI,CAACjhC,OAAD,EAAU2J,IAAV,CAAL,EAAsB,UAAUhW,CAAV,EAAa;AAChD,aAAOA,CAAC,KAAK5B,EAAb;AACD,KAFc,CAAf;;AAGA,QAAI+G,EAAE,CAACzI,MAAH,GAAY,CAAhB,EAAmB;AACjB4Y,MAAAA,GAAG,CAACjJ,OAAD,EAAU2J,IAAV,EAAgB7Q,EAAE,CAACoT,IAAH,CAAQ,GAAR,CAAhB,CAAH;AACD,KAFD,MAEO;AACL3C,MAAAA,MAAM,CAACvJ,OAAD,EAAU2J,IAAV,CAAN;AACD;;AACD,WAAO,KAAP;AACD,GAVD;;AAYA,MAAI03B,QAAQ,GAAG,UAAUrhC,OAAV,EAAmB;AAChC,WAAOA,OAAO,CAACN,GAAR,CAAY4hC,SAAZ,KAA0B7xC,SAAjC;AACD,GAFD;;AAGA,MAAI8xC,KAAK,GAAG,UAAUvhC,OAAV,EAAmB;AAC7B,WAAOihC,IAAI,CAACjhC,OAAD,EAAU,OAAV,CAAX;AACD,GAFD;;AAGA,MAAIwhC,KAAK,GAAG,UAAUxhC,OAAV,EAAmByhC,KAAnB,EAA0B;AACpC,WAAON,KAAK,CAACnhC,OAAD,EAAU,OAAV,EAAmByhC,KAAnB,CAAZ;AACD,GAFD;;AAGA,MAAIC,QAAQ,GAAG,UAAU1hC,OAAV,EAAmByhC,KAAnB,EAA0B;AACvC,WAAOL,QAAQ,CAACphC,OAAD,EAAU,OAAV,EAAmByhC,KAAnB,CAAf;AACD,GAFD;;AAIA,MAAIE,KAAK,GAAG,UAAU3hC,OAAV,EAAmByhC,KAAnB,EAA0B;AACpC,QAAIJ,QAAQ,CAACrhC,OAAD,CAAZ,EAAuB;AACrBA,MAAAA,OAAO,CAACN,GAAR,CAAY4hC,SAAZ,CAAsBrH,GAAtB,CAA0BwH,KAA1B;AACD,KAFD,MAEO;AACLD,MAAAA,KAAK,CAACxhC,OAAD,EAAUyhC,KAAV,CAAL;AACD;AACF,GAND;;AAOA,MAAIG,UAAU,GAAG,UAAU5hC,OAAV,EAAmB;AAClC,QAAIshC,SAAS,GAAGD,QAAQ,CAACrhC,OAAD,CAAR,GAAoBA,OAAO,CAACN,GAAR,CAAY4hC,SAAhC,GAA4CC,KAAK,CAACvhC,OAAD,CAAjE;;AACA,QAAIshC,SAAS,CAACjxC,MAAV,KAAqB,CAAzB,EAA4B;AAC1BkZ,MAAAA,MAAM,CAACvJ,OAAD,EAAU,OAAV,CAAN;AACD;AACF,GALD;;AAMA,MAAI6hC,QAAQ,GAAG,UAAU7hC,OAAV,EAAmByhC,KAAnB,EAA0B;AACvC,QAAIJ,QAAQ,CAACrhC,OAAD,CAAZ,EAAuB;AACrB,UAAIshC,SAAS,GAAGthC,OAAO,CAACN,GAAR,CAAY4hC,SAA5B;AACAA,MAAAA,SAAS,CAAC/3B,MAAV,CAAiBk4B,KAAjB;AACD,KAHD,MAGO;AACLC,MAAAA,QAAQ,CAAC1hC,OAAD,EAAUyhC,KAAV,CAAR;AACD;;AACDG,IAAAA,UAAU,CAAC5hC,OAAD,CAAV;AACD,GARD;;AASA,MAAI8hC,KAAK,GAAG,UAAU9hC,OAAV,EAAmByhC,KAAnB,EAA0B;AACpC,WAAOJ,QAAQ,CAACrhC,OAAD,CAAR,IAAqBA,OAAO,CAACN,GAAR,CAAY4hC,SAAZ,CAAsB9sC,QAAtB,CAA+BitC,KAA/B,CAA5B;AACD,GAFD;;AAIA,MAAIn3B,GAAG,GAAG,UAAUy3B,SAAV,EAAqB;AAC7B,QAAIC,aAAa,GAAGD,SAAS,CAAClpC,OAAV,CAAkB,KAAlB,EAAyB,GAAzB,CAApB;;AACA,QAAIqjB,OAAO,GAAG,UAAUjiB,GAAV,EAAe;AAC3B,aAAO+nC,aAAa,GAAG,GAAhB,GAAsB/nC,GAA7B;AACD,KAFD;;AAGA,WAAO;AAAEiiB,MAAAA,OAAO,EAAEA;AAAX,KAAP;AACD,GAND;;AAQA,MAAI1R,MAAM,GAAGF,GAAG,CAAC,gBAAD,CAAhB;AACA,MAAI4R,OAAO,GAAG1R,MAAM,CAAC0R,OAArB;;AAEA,MAAI+lB,OAAO,GAAG,UAAUC,OAAV,EAAmB;AAC/B,QAAI/C,QAAQ,GAAG5oC,QAAQ,CAAC;AAAE4rC,MAAAA,UAAU,EAAEjmB,OAAO,CAAC,SAAD;AAArB,KAAD,EAAqCgmB,OAArC,CAAvB;;AACA,QAAItjC,GAAG,GAAGmB,YAAY,CAACX,OAAb,CAAqB,KAArB,CAAV;AACA6J,IAAAA,GAAG,CAACrK,GAAD,EAAM,MAAN,EAAc,cAAd,CAAH;AACAyL,IAAAA,QAAQ,CAACzL,GAAD,EAAM;AACZwjC,MAAAA,QAAQ,EAAE,OADE;AAEZxiB,MAAAA,IAAI,EAAE,KAFM;AAGZC,MAAAA,GAAG,EAAE,KAHO;AAIZyC,MAAAA,KAAK,EAAE,MAJK;AAKZ9C,MAAAA,MAAM,EAAE;AALI,KAAN,CAAR;AAOAmiB,IAAAA,KAAK,CAAC/iC,GAAD,EAAMsd,OAAO,CAAC,SAAD,CAAb,CAAL;AACAylB,IAAAA,KAAK,CAAC/iC,GAAD,EAAMugC,QAAQ,CAACgD,UAAf,CAAL;;AACA,QAAIniC,OAAO,GAAG,YAAY;AACxB,aAAOpB,GAAP;AACD,KAFD;;AAGA,QAAIkhC,OAAO,GAAG,YAAY;AACxBrrB,MAAAA,QAAQ,CAAC7V,GAAD,CAAR;AACD,KAFD;;AAGA,WAAO;AACLoB,MAAAA,OAAO,EAAEA,OADJ;AAEL8/B,MAAAA,OAAO,EAAEA;AAFJ,KAAP;AAID,GAvBD;;AAyBA,MAAI1B,OAAO,GAAG,UAAUD,GAAV,EAAerlC,EAAf,EAAmB;AAC/B,WAAOinB,aAAa,CAACjnB,EAAE,CAAC8mB,IAAH,GAAUue,GAAG,CAACve,IAAf,EAAqB9mB,EAAE,CAAC+mB,GAAH,GAASse,GAAG,CAACte,GAAlC,CAApB;AACD,GAFD;;AAGA,MAAIwiB,SAAS,GAAG,UAAUn7B,KAAV,EAAiB;AAC/B,WAAOnT,QAAQ,CAACR,IAAT,CAAcwsB,aAAa,CAAC7Y,KAAK,CAAC5Y,CAAP,EAAU4Y,KAAK,CAACrH,CAAhB,CAA3B,CAAP;AACD,GAFD;;AAGA,MAAIwuB,MAAM,GAAG,UAAU6Q,QAAV,EAAoBzjC,IAApB,EAA0B;AACrCyjC,IAAAA,QAAQ,CAAC7Q,MAAT,CAAgB5yB,IAAI,CAACmkB,IAArB,EAA2BnkB,IAAI,CAACokB,GAAhC;AACD,GAFD;;AAGA,MAAI0f,IAAI,GAAG,UAAU+C,OAAV,EAAmBnD,QAAnB,EAA6B;AACtC,QAAIoD,OAAO,GAAGN,OAAO,CAAC9C,QAAD,CAArB;AACA,QAAIqD,KAAK,GAAGzB,MAAM,CAACwB,OAAO,CAACviC,OAAR,EAAD,EAAoB,WAApB,EAAiCsiC,OAAO,CAAC1C,SAAzC,CAAlB;AACA,QAAI6C,GAAG,GAAG1B,MAAM,CAACwB,OAAO,CAACviC,OAAR,EAAD,EAAoB,SAApB,EAA+BsiC,OAAO,CAAChD,IAAvC,CAAhB;AACA,QAAIoD,KAAK,GAAG3B,MAAM,CAACwB,OAAO,CAACviC,OAAR,EAAD,EAAoB,WAApB,EAAiCsiC,OAAO,CAAC7D,IAAzC,CAAlB;AACA,QAAIkE,IAAI,GAAG5B,MAAM,CAACwB,OAAO,CAACviC,OAAR,EAAD,EAAoB,UAApB,EAAgCsiC,OAAO,CAACzC,SAAxC,CAAjB;;AACA,QAAIC,OAAO,GAAG,YAAY;AACxByC,MAAAA,OAAO,CAACzC,OAAR;AACA2C,MAAAA,GAAG,CAAC3G,MAAJ;AACA4G,MAAAA,KAAK,CAAC5G,MAAN;AACA6G,MAAAA,IAAI,CAAC7G,MAAL;AACA0G,MAAAA,KAAK,CAAC1G,MAAN;AACD,KAND;;AAOA,QAAI3hC,KAAK,GAAG,UAAUqL,MAAV,EAAkB;AAC5BoO,MAAAA,MAAM,CAACpO,MAAD,EAAS+8B,OAAO,CAACviC,OAAR,EAAT,CAAN;AACD,KAFD;;AAGA,QAAI4F,IAAI,GAAG,YAAY;AACrB6O,MAAAA,QAAQ,CAAC8tB,OAAO,CAACviC,OAAR,EAAD,CAAR;AACD,KAFD;;AAGA,WAAO49B,QAAQ,CAAC;AACd59B,MAAAA,OAAO,EAAEuiC,OAAO,CAACviC,OADH;AAEd7F,MAAAA,KAAK,EAAEA,KAFO;AAGdyL,MAAAA,IAAI,EAAEA,IAHQ;AAIdk6B,MAAAA,OAAO,EAAEA;AAJK,KAAD,CAAf;AAMD,GAzBD;;AA0BA,MAAI8C,SAAS,GAAGjF,QAAQ,CAAC;AACvBS,IAAAA,OAAO,EAAEA,OADc;AAEvB9R,IAAAA,OAAO,EAAE+V,SAFc;AAGvB9C,IAAAA,IAAI,EAAEA,IAHiB;AAIvBlR,IAAAA,MAAM,EAAEA;AAJe,GAAD,CAAxB;;AAOA,MAAIwU,SAAS,GAAG,UAAU3D,QAAV,EAAoBC,QAApB,EAA8B;AAC5C,QAAIA,QAAQ,KAAK,KAAK,CAAtB,EAAyB;AACvBA,MAAAA,QAAQ,GAAG,EAAX;AACD;;AACD,QAAIjB,IAAI,GAAGiB,QAAQ,CAACjB,IAAT,KAAkBzuC,SAAlB,GAA8B0vC,QAAQ,CAACjB,IAAvC,GAA8C0E,SAAzD;AACA,WAAO3D,KAAK,CAACC,QAAD,EAAWhB,IAAX,EAAiBiB,QAAjB,CAAZ;AACD,GAND;;AAQA,MAAI2D,qBAAqB,GAAG,UAAU72B,GAAV,EAAe;AACzC,WAAO7C,KAAK,CAAC6C,GAAD,EAAM,iBAAN,CAAL,KAAkC,MAAzC;AACD,GAFD;;AAGA,MAAI82B,0BAA0B,GAAG,UAAUjoC,MAAV,EAAkB6K,MAAlB,EAA0B;AACzD,WAAOmD,SAAS,CAAChO,MAAD,EAAS,mBAAT,EAA8B6K,MAA9B,CAAhB;AACD,GAFD;;AAIA,MAAIq9B,QAAQ,GAAG14B,GAAG,CAAC,eAAD,CAAlB;AACA,MAAI24B,SAAS,GAAGD,QAAQ,CAAC9mB,OAAzB;;AAEA,MAAIgnB,QAAQ,GAAG,YAAY;AACzB,QAAI1E,MAAM,GAAGnoB,MAAM,CAAC;AAClB8sB,MAAAA,IAAI,EAAEzH,KAAK,CAAC,CACV,QADU,EAEV,QAFU,CAAD;AADO,KAAD,CAAnB;;AAMA,QAAIrN,MAAM,GAAG,UAAU//B,CAAV,EAAauR,CAAb,EAAgB;AAC3B2+B,MAAAA,MAAM,CAACzC,OAAP,CAAeoH,IAAf,CAAoB70C,CAApB,EAAuBuR,CAAvB;AACD,KAFD;;AAGA,WAAO;AACLwuB,MAAAA,MAAM,EAAEA,MADH;AAELmQ,MAAAA,MAAM,EAAEA,MAAM,CAACvC;AAFV,KAAP;AAID,GAdD;;AAgBA,MAAImH,WAAW,GAAG,YAAY;AAC5B,QAAI5E,MAAM,GAAGnoB,MAAM,CAAC;AAClB8sB,MAAAA,IAAI,EAAEzH,KAAK,CAAC,CACV,QADU,EAEV,QAFU,EAGV,QAHU,CAAD;AADO,KAAD,CAAnB;AAOA,QAAI5gC,MAAM,GAAG/G,QAAQ,CAACtC,IAAT,EAAb;AACA,QAAI4xC,QAAQ,GAAGH,QAAQ,EAAvB;AACAG,IAAAA,QAAQ,CAAC7E,MAAT,CAAgB2E,IAAhB,CAAqBpwC,IAArB,CAA0B,UAAUmU,KAAV,EAAiB;AACzCpM,MAAAA,MAAM,CAAChI,IAAP,CAAY,UAAUvE,CAAV,EAAa;AACvBiwC,QAAAA,MAAM,CAACzC,OAAP,CAAeoH,IAAf,CAAoBj8B,KAAK,CAACo8B,MAA1B,EAAkCp8B,KAAK,CAACq8B,MAAxC,EAAgDh1C,CAAhD;AACD,OAFD;AAGD,KAJD;;AAKA,QAAIkI,MAAM,GAAG,UAAUlI,CAAV,EAAa;AACxBuM,MAAAA,MAAM,GAAG/G,QAAQ,CAACR,IAAT,CAAchF,CAAd,CAAT;AACD,KAFD;;AAGA,QAAI4H,GAAG,GAAG,YAAY;AACpB,aAAO2E,MAAP;AACD,KAFD;;AAGA,WAAO;AACLrE,MAAAA,MAAM,EAAEA,MADH;AAELN,MAAAA,GAAG,EAAEA,GAFA;AAGLk4B,MAAAA,MAAM,EAAEgV,QAAQ,CAAChV,MAHZ;AAILmQ,MAAAA,MAAM,EAAEA,MAAM,CAACvC;AAJV,KAAP;AAMD,GA3BD;;AA6BA,MAAIhe,GAAG,GAAG,UAAU/a,MAAV,EAAkB5U,CAAlB,EAAqBuR,CAArB,EAAwByQ,CAAxB,EAA2B4M,CAA3B,EAA8B;AACtC,QAAIsmB,GAAG,GAAGzjC,YAAY,CAACX,OAAb,CAAqB,KAArB,CAAV;AACAiL,IAAAA,QAAQ,CAACm5B,GAAD,EAAM;AACZpB,MAAAA,QAAQ,EAAE,UADE;AAEZxiB,MAAAA,IAAI,EAAEtxB,CAAC,GAAGgiB,CAAC,GAAG,CAAR,GAAY,IAFN;AAGZuP,MAAAA,GAAG,EAAEhgB,CAAC,GAAG,IAHG;AAIZ2f,MAAAA,MAAM,EAAEtC,CAAC,GAAG,IAJA;AAKZoF,MAAAA,KAAK,EAAEhS,CAAC,GAAG;AALC,KAAN,CAAR;AAOApH,IAAAA,MAAM,CAACs6B,GAAD,EAAM;AACV,qBAAetgC,MADL;AAEV,cAAQ;AAFE,KAAN,CAAN;AAIA,WAAOsgC,GAAP;AACD,GAdD;;AAeA,MAAIvgC,GAAG,GAAG,UAAUlO,CAAV,EAAazG,CAAb,EAAgBuR,CAAhB,EAAmByQ,CAAnB,EAAsB4M,CAAtB,EAAyB;AACjC,QAAIsmB,GAAG,GAAGzjC,YAAY,CAACX,OAAb,CAAqB,KAArB,CAAV;AACAiL,IAAAA,QAAQ,CAACm5B,GAAD,EAAM;AACZpB,MAAAA,QAAQ,EAAE,UADE;AAEZxiB,MAAAA,IAAI,EAAEtxB,CAAC,GAAG,IAFE;AAGZuxB,MAAAA,GAAG,EAAEhgB,CAAC,GAAGqd,CAAC,GAAG,CAAR,GAAY,IAHL;AAIZsC,MAAAA,MAAM,EAAEtC,CAAC,GAAG,IAJA;AAKZoF,MAAAA,KAAK,EAAEhS,CAAC,GAAG;AALC,KAAN,CAAR;AAOApH,IAAAA,MAAM,CAACs6B,GAAD,EAAM;AACV,kBAAYzuC,CADF;AAEV,cAAQ;AAFE,KAAN,CAAN;AAIA,WAAOyuC,GAAP;AACD,GAdD;;AAgBA,MAAIC,SAAS,GAAGR,SAAS,CAAC,aAAD,CAAzB;AACA,MAAIS,YAAY,GAAGT,SAAS,CAAC,cAAD,CAA5B;AACA,MAAIU,YAAY,GAAGV,SAAS,CAAC,cAAD,CAA5B;AACA,MAAIW,aAAa,GAAG,CAApB;;AACA,MAAIC,aAAa,GAAG,UAAUr1B,SAAV,EAAqBupB,WAArB,EAAkC;AACpD,WAAOhlC,IAAI,CAACyb,SAAS,CAACxd,GAAX,EAAgB,UAAUiS,GAAV,EAAetO,CAAf,EAAkB;AAC3C,aAAOojC,WAAW,CAAC90B,GAAG,CAACjD,OAAL,CAAX,GAA2B,CAACrL,CAAD,CAA3B,GAAiC,EAAxC;AACD,KAFU,CAAX;AAGD,GAJD;;AAKA,MAAImvC,gBAAgB,GAAG,UAAUt1B,SAAV,EAAqBupB,WAArB,EAAkC;AACvD,QAAIgM,aAAa,GAAG,EAApB;AACAlvC,IAAAA,KAAK,CAAC2Z,SAAS,CAAC3L,IAAV,CAAeE,OAAhB,EAAyB,UAAUsD,KAAV,EAAiB;AAC7C,UAAI29B,SAAS,GAAGtzB,SAAS,CAACD,WAAV,CAAsBjC,SAAtB,EAAiCnI,KAAjC,EAAwCxT,GAAxC,CAA4C,UAAUorB,GAAV,EAAe;AACzE,eAAOA,GAAG,CAACje,OAAX;AACD,OAFe,CAAhB;;AAGA,UAAIgkC,SAAS,CAAC/wC,MAAV,CAAiB8kC,WAAjB,CAAJ,EAAmC;AACjCgM,QAAAA,aAAa,CAAC1vC,IAAd,CAAmBgS,KAAnB;AACD;AACF,KAPI,CAAL;AAQA,WAAOnT,MAAM,CAAC6wC,aAAD,EAAgB,UAAU70B,QAAV,EAAoB;AAC/C,UAAIqZ,WAAW,GAAG7X,SAAS,CAAC7B,WAAV,CAAsBL,SAAtB,EAAiC,UAAUrD,IAAV,EAAgB;AACjE,eAAOA,IAAI,CAACjI,MAAL,KAAgBgM,QAAvB;AACD,OAFiB,CAAlB;AAGA,aAAOjc,MAAM,CAACs1B,WAAD,EAAc,UAAUpd,IAAV,EAAgB;AACzC,eAAO4sB,WAAW,CAAC5sB,IAAI,CAACnL,OAAN,CAAlB;AACD,OAFY,CAAb;AAGD,KAPY,CAAb;AAQD,GAlBD;;AAmBA,MAAI8/B,OAAO,GAAG,UAAUmE,IAAV,EAAgB;AAC5B,QAAIlG,QAAQ,GAAG71B,aAAa,CAAC+7B,IAAI,CAACz+B,MAAL,EAAD,EAAgB,MAAMi+B,SAAtB,CAA5B;AACA3wC,IAAAA,IAAI,CAACirC,QAAD,EAAWtpB,QAAX,CAAJ;AACD,GAHD;;AAIA,MAAIyvB,OAAO,GAAG,UAAUD,IAAV,EAAgBhiB,SAAhB,EAA2B5L,MAA3B,EAAmC;AAC/C,QAAI4hB,MAAM,GAAGgM,IAAI,CAAChM,MAAL,EAAb;AACAnlC,IAAAA,IAAI,CAACmvB,SAAD,EAAY,UAAUkiB,QAAV,EAAoB;AAClCA,MAAAA,QAAQ,CAACrxC,IAAT,CAAc,UAAUsxC,EAAV,EAAc;AAC1B,YAAIZ,GAAG,GAAGntB,MAAM,CAAC4hB,MAAD,EAASmM,EAAT,CAAhB;AACAzC,QAAAA,KAAK,CAAC6B,GAAD,EAAMC,SAAN,CAAL;AACA7vB,QAAAA,MAAM,CAACqwB,IAAI,CAACz+B,MAAL,EAAD,EAAgBg+B,GAAhB,CAAN;AACD,OAJD;AAKD,KANG,CAAJ;AAOD,GATD;;AAUA,MAAIa,UAAU,GAAG,UAAUJ,IAAV,EAAgBK,YAAhB,EAA8BlC,QAA9B,EAAwCmC,WAAxC,EAAqD;AACpEL,IAAAA,OAAO,CAACD,IAAD,EAAOK,YAAP,EAAqB,UAAUrM,MAAV,EAAkBmM,EAAlB,EAAsB;AAChD,UAAII,MAAM,GAAGvmB,GAAG,CAACmmB,EAAE,CAACnmB,GAAJ,EAASmmB,EAAE,CAAC91C,CAAH,GAAO2pC,MAAM,CAACrY,IAAvB,EAA6BwiB,QAAQ,CAACviB,GAAT,GAAeoY,MAAM,CAACpY,GAAnD,EAAwD+jB,aAAxD,EAAuEW,WAAvE,CAAhB;AACA5C,MAAAA,KAAK,CAAC6C,MAAD,EAASb,YAAT,CAAL;AACA,aAAOa,MAAP;AACD,KAJM,CAAP;AAKD,GAND;;AAOA,MAAIC,UAAU,GAAG,UAAUR,IAAV,EAAgBS,YAAhB,EAA8BtC,QAA9B,EAAwC9K,UAAxC,EAAoD;AACnE4M,IAAAA,OAAO,CAACD,IAAD,EAAOS,YAAP,EAAqB,UAAUzM,MAAV,EAAkBmM,EAAlB,EAAsB;AAChD,UAAIO,MAAM,GAAG1hC,GAAG,CAACmhC,EAAE,CAACnhC,GAAJ,EAASm/B,QAAQ,CAACxiB,IAAT,GAAgBqY,MAAM,CAACrY,IAAhC,EAAsCwkB,EAAE,CAACvkC,CAAH,GAAOo4B,MAAM,CAACpY,GAApD,EAAyDyX,UAAzD,EAAqEsM,aAArE,CAAhB;AACAjC,MAAAA,KAAK,CAACgD,MAAD,EAASjB,YAAT,CAAL;AACA,aAAOiB,MAAP;AACD,KAJM,CAAP;AAKD,GAND;;AAOA,MAAIC,WAAW,GAAG,UAAUC,QAAV,EAAoBZ,IAApB,EAA0B53B,KAA1B,EAAiCvJ,IAAjC,EAAuC+K,IAAvC,EAA6C;AAC7D,QAAIu0B,QAAQ,GAAGliB,QAAQ,CAAC7T,KAAD,CAAvB;AACA,QAAI0rB,WAAW,GAAGkM,IAAI,CAAClM,WAAvB;AACA,QAAI2M,YAAY,GAAG5hC,IAAI,CAACzS,MAAL,GAAc,CAAd,GAAkBmvB,MAAM,CAACyC,SAAP,CAAiBnf,IAAjB,EAAuBuJ,KAAvB,CAAlB,GAAkD,EAArE;AACA,QAAIy4B,gBAAgB,GAAGJ,YAAY,CAACr0C,MAAb,GAAsB,CAAtB,GAA0BwzC,aAAa,CAACgB,QAAD,EAAW9M,WAAX,CAAvC,GAAiE,EAAxF;AACA,QAAIgN,qBAAqB,GAAG7xC,MAAM,CAACwxC,YAAD,EAAe,UAAUM,IAAV,EAAgBrwC,CAAhB,EAAmB;AAClE,aAAO3B,MAAM,CAAC8xC,gBAAD,EAAmB,UAAUG,QAAV,EAAoB;AAClD,eAAOtwC,CAAC,KAAKswC,QAAb;AACD,OAFY,CAAb;AAGD,KAJiC,CAAlC;AAKAR,IAAAA,UAAU,CAACR,IAAD,EAAOc,qBAAP,EAA8B3C,QAA9B,EAAwChlB,QAAQ,CAAC/Q,KAAD,CAAhD,CAAV;AACA,QAAIi4B,YAAY,GAAGz2B,IAAI,CAACxd,MAAL,GAAc,CAAd,GAAkBiyB,KAAK,CAACL,SAAN,CAAgBpU,IAAhB,EAAsBxB,KAAtB,CAAlB,GAAiD,EAApE;AACA,QAAI64B,gBAAgB,GAAGZ,YAAY,CAACj0C,MAAb,GAAsB,CAAtB,GAA0ByzC,gBAAgB,CAACe,QAAD,EAAW9M,WAAX,CAA1C,GAAoE,EAA3F;AACA,QAAIoN,qBAAqB,GAAGjyC,MAAM,CAACoxC,YAAD,EAAe,UAAUU,IAAV,EAAgBrwC,CAAhB,EAAmB;AAClE,aAAO3B,MAAM,CAACkyC,gBAAD,EAAmB,UAAUD,QAAV,EAAoB;AAClD,eAAOtwC,CAAC,KAAKswC,QAAb;AACD,OAFY,CAAb;AAGD,KAJiC,CAAlC;AAKAZ,IAAAA,UAAU,CAACJ,IAAD,EAAOkB,qBAAP,EAA8B/C,QAA9B,EAAwCziB,UAAU,CAACtT,KAAD,CAAlD,CAAV;AACD,GAnBD;;AAoBA,MAAI+4B,OAAO,GAAG,UAAUnB,IAAV,EAAgB53B,KAAhB,EAAuB;AACnCyzB,IAAAA,OAAO,CAACmE,IAAD,CAAP;;AACA,QAAIA,IAAI,CAAClM,WAAL,CAAiB1rB,KAAjB,CAAJ,EAA6B;AAC3B,UAAImC,SAAS,GAAGkC,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAhB;AACA,UAAIvJ,IAAI,GAAG8J,MAAM,CAAC4B,SAAD,CAAjB;AACA,UAAIX,IAAI,GAAGiQ,SAAS,CAACtP,SAAD,CAApB;AACAo2B,MAAAA,WAAW,CAACp2B,SAAD,EAAYy1B,IAAZ,EAAkB53B,KAAlB,EAAyBvJ,IAAzB,EAA+B+K,IAA/B,CAAX;AACD;AACF,GARD;;AASA,MAAIw3B,MAAM,GAAG,UAAUpB,IAAV,EAAgB9yC,CAAhB,EAAmB;AAC9B,QAAIm0C,IAAI,GAAGp9B,aAAa,CAAC+7B,IAAI,CAACz+B,MAAL,EAAD,EAAgB,MAAMi+B,SAAtB,CAAxB;AACA3wC,IAAAA,IAAI,CAACwyC,IAAD,EAAOn0C,CAAP,CAAJ;AACD,GAHD;;AAIA,MAAIo0C,IAAI,GAAG,UAAUtB,IAAV,EAAgB;AACzBoB,IAAAA,MAAM,CAACpB,IAAD,EAAO,UAAUT,GAAV,EAAe;AAC1Bp5B,MAAAA,KAAK,CAACo5B,GAAD,EAAM,SAAN,EAAiB,MAAjB,CAAL;AACD,KAFK,CAAN;AAGD,GAJD;;AAKA,MAAIgC,IAAI,GAAG,UAAUvB,IAAV,EAAgB;AACzBoB,IAAAA,MAAM,CAACpB,IAAD,EAAO,UAAUT,GAAV,EAAe;AAC1Bp5B,MAAAA,KAAK,CAACo5B,GAAD,EAAM,SAAN,EAAiB,OAAjB,CAAL;AACD,KAFK,CAAN;AAGD,GAJD;;AAKA,MAAIiC,QAAQ,GAAG,UAAUzlC,OAAV,EAAmB;AAChC,WAAO8hC,KAAK,CAAC9hC,OAAD,EAAU0jC,YAAV,CAAZ;AACD,GAFD;;AAGA,MAAIgC,QAAQ,GAAG,UAAU1lC,OAAV,EAAmB;AAChC,WAAO8hC,KAAK,CAAC9hC,OAAD,EAAU2jC,YAAV,CAAZ;AACD,GAFD;;AAIA,MAAIgC,iBAAiB,GAAG1C,SAAS,CAAC,sBAAD,CAAjC;;AACA,MAAI2C,UAAU,GAAG,UAAU3B,IAAV,EAAgB;AAC/B,QAAI/E,QAAQ,GAAGkE,WAAW,EAA1B;AACA,QAAItO,QAAQ,GAAG+N,SAAS,CAAC3D,QAAD,EAAW,EAAX,CAAxB;AACA,QAAI2G,UAAU,GAAG9xC,QAAQ,CAACtC,IAAT,EAAjB;;AACA,QAAIq0C,UAAU,GAAG,UAAU9lC,OAAV,EAAmBjR,IAAnB,EAAyB;AACxC,aAAOgF,QAAQ,CAACD,IAAT,CAAcsV,KAAK,CAACpJ,OAAD,EAAUjR,IAAV,CAAnB,CAAP;AACD,KAFD;;AAGAmwC,IAAAA,QAAQ,CAACV,MAAT,CAAgB2E,IAAhB,CAAqBpwC,IAArB,CAA0B,UAAUmU,KAAV,EAAiB;AACzC4+B,MAAAA,UAAU,CAAC5+B,KAAK,CAACpM,MAAP,EAAe,UAAf,CAAV,CAAqChI,IAArC,CAA0C,UAAUizC,QAAV,EAAoB;AAC5D,YAAIC,UAAU,GAAGv6B,WAAW,CAACvE,KAAK,CAACpM,MAAP,EAAe,KAAf,CAA5B;AACAsP,QAAAA,KAAK,CAAClD,KAAK,CAACpM,MAAP,EAAe,KAAf,EAAsBkrC,UAAU,GAAG9+B,KAAK,CAACq8B,MAAnB,GAA4B,IAAlD,CAAL;AACD,OAHD;AAIAuC,MAAAA,UAAU,CAAC5+B,KAAK,CAACpM,MAAP,EAAe,aAAf,CAAV,CAAwChI,IAAxC,CAA6C,UAAUmzC,QAAV,EAAoB;AAC/D,YAAIC,UAAU,GAAGz6B,WAAW,CAACvE,KAAK,CAACpM,MAAP,EAAe,MAAf,CAA5B;AACAsP,QAAAA,KAAK,CAAClD,KAAK,CAACpM,MAAP,EAAe,MAAf,EAAuBorC,UAAU,GAAGh/B,KAAK,CAACo8B,MAAnB,GAA4B,IAAnD,CAAL;AACD,OAHD;AAID,KATD;;AAUA,QAAI6C,QAAQ,GAAG,UAAUrrC,MAAV,EAAkBsrC,GAAlB,EAAuB;AACpC,UAAIC,IAAI,GAAG56B,WAAW,CAAC3Q,MAAD,EAASsrC,GAAT,CAAtB;AACA,UAAIE,IAAI,GAAGp7B,YAAY,CAACpQ,MAAD,EAAS,kBAAkBsrC,GAA3B,EAAgC,CAAhC,CAAvB;AACA,aAAOC,IAAI,GAAGC,IAAd;AACD,KAJD;;AAKAxR,IAAAA,QAAQ,CAAC0J,MAAT,CAAgB54B,IAAhB,CAAqB7S,IAArB,CAA0B,YAAY;AACpCmsC,MAAAA,QAAQ,CAAC/oC,GAAT,GAAerD,IAAf,CAAoB,UAAUgI,MAAV,EAAkB;AACpC+qC,QAAAA,UAAU,CAAC/yC,IAAX,CAAgB,UAAUuZ,KAAV,EAAiB;AAC/By5B,UAAAA,UAAU,CAAChrC,MAAD,EAAS,UAAT,CAAV,CAA+BhI,IAA/B,CAAoC,UAAUmQ,GAAV,EAAe;AACjD,gBAAI6b,KAAK,GAAGqnB,QAAQ,CAACrrC,MAAD,EAAS,KAAT,CAApB;AACAyO,YAAAA,MAAM,CAACzO,MAAD,EAAS,kBAAT,CAAN;AACA0jC,YAAAA,MAAM,CAACzC,OAAP,CAAezG,YAAf,CAA4BjpB,KAA5B,EAAmCyS,KAAnC,EAA0CzT,QAAQ,CAACpI,GAAD,EAAM,EAAN,CAAlD;AACD,WAJD;AAKA6iC,UAAAA,UAAU,CAAChrC,MAAD,EAAS,aAAT,CAAV,CAAkChI,IAAlC,CAAuC,UAAUoQ,MAAV,EAAkB;AACvD,gBAAI4b,KAAK,GAAGqnB,QAAQ,CAACrrC,MAAD,EAAS,MAAT,CAApB;AACAyO,YAAAA,MAAM,CAACzO,MAAD,EAAS,mBAAT,CAAN;AACA0jC,YAAAA,MAAM,CAACzC,OAAP,CAAelH,WAAf,CAA2BxoB,KAA3B,EAAkCyS,KAAlC,EAAyCzT,QAAQ,CAACnI,MAAD,EAAS,EAAT,CAAjD;AACD,WAJD;AAKAkiC,UAAAA,OAAO,CAACnB,IAAD,EAAO53B,KAAP,CAAP;AACD,SAZD;AAaD,OAdD;AAeD,KAhBD;;AAiBA,QAAIwvB,OAAO,GAAG,UAAU/gC,MAAV,EAAkBsrC,GAAlB,EAAuB;AACnC5H,MAAAA,MAAM,CAACzC,OAAP,CAAewK,WAAf;AACArH,MAAAA,QAAQ,CAACzoC,MAAT,CAAgBqE,MAAhB;AACAmO,MAAAA,GAAG,CAACnO,MAAD,EAAS,kBAAkBsrC,GAA3B,EAAgC36B,WAAW,CAAC3Q,MAAD,EAASsrC,GAAT,CAA3C,CAAH;AACAzE,MAAAA,KAAK,CAAC7mC,MAAD,EAAS6qC,iBAAT,CAAL;AACAv7B,MAAAA,KAAK,CAACtP,MAAD,EAAS,SAAT,EAAoB,KAApB,CAAL;AACAg6B,MAAAA,QAAQ,CAAC2K,EAAT,CAAYwE,IAAI,CAACz+B,MAAL,EAAZ;AACD,KAPD;;AAQA,QAAIghC,SAAS,GAAGzF,MAAM,CAACkD,IAAI,CAACz+B,MAAL,EAAD,EAAgB,WAAhB,EAA6B,UAAU0B,KAAV,EAAiB;AAClE,UAAIu+B,QAAQ,CAACv+B,KAAK,CAACpM,MAAP,CAAZ,EAA4B;AAC1B+gC,QAAAA,OAAO,CAAC30B,KAAK,CAACpM,MAAP,EAAe,KAAf,CAAP;AACD;;AACD,UAAI4qC,QAAQ,CAACx+B,KAAK,CAACpM,MAAP,CAAZ,EAA4B;AAC1B+gC,QAAAA,OAAO,CAAC30B,KAAK,CAACpM,MAAP,EAAe,MAAf,CAAP;AACD;AACF,KAPqB,CAAtB;;AAQA,QAAI6K,MAAM,GAAG,UAAUT,CAAV,EAAa;AACxB,aAAOrE,IAAI,CAACqE,CAAD,EAAI++B,IAAI,CAACjM,IAAL,EAAJ,CAAX;AACD,KAFD;;AAGA,QAAIyO,wBAAwB,GAAG,UAAU3rC,MAAV,EAAkB;AAC/C,aAAOgO,SAAS,CAAChO,MAAD,EAAS,OAAT,EAAkB6K,MAAlB,CAAT,CAAmCzS,MAAnC,CAA0C,UAAUmZ,KAAV,EAAiB;AAChE,eAAO02B,0BAA0B,CAAC12B,KAAD,EAAQ1G,MAAR,CAA1B,CAA0C3S,MAA1C,CAAiD8vC,qBAAjD,CAAP;AACD,OAFM,CAAP;AAGD,KAJD;;AAKA,QAAI4D,SAAS,GAAG3F,MAAM,CAACkD,IAAI,CAACjM,IAAL,EAAD,EAAc,WAAd,EAA2B,UAAU9wB,KAAV,EAAiB;AAChEu/B,MAAAA,wBAAwB,CAACv/B,KAAK,CAACpM,MAAP,CAAxB,CAAuC5I,IAAvC,CAA4C,YAAY;AACtD,YAAIsV,MAAM,CAACN,KAAK,CAACpM,MAAP,CAAV,EAA0B;AACxBglC,UAAAA,OAAO,CAACmE,IAAD,CAAP;AACD;AACF,OAJD,EAIG,UAAU53B,KAAV,EAAiB;AAClBw5B,QAAAA,UAAU,GAAG9xC,QAAQ,CAACR,IAAT,CAAc8Y,KAAd,CAAb;AACA+4B,QAAAA,OAAO,CAACnB,IAAD,EAAO53B,KAAP,CAAP;AACD,OAPD;AAQD,KATqB,CAAtB;;AAUA,QAAIs6B,SAAS,GAAG,YAAY;AAC1BH,MAAAA,SAAS,CAAC1K,MAAV;AACA4K,MAAAA,SAAS,CAAC5K,MAAV;AACAhH,MAAAA,QAAQ,CAACgL,OAAT;AACAA,MAAAA,OAAO,CAACmE,IAAD,CAAP;AACD,KALD;;AAMA,QAAI2C,SAAS,GAAG,UAAUC,GAAV,EAAe;AAC7BzB,MAAAA,OAAO,CAACnB,IAAD,EAAO4C,GAAP,CAAP;AACD,KAFD;;AAGA,QAAIrI,MAAM,GAAGnoB,MAAM,CAAC;AAClBif,MAAAA,YAAY,EAAEoG,KAAK,CAAC,CAClB,OADkB,EAElB,OAFkB,EAGlB,KAHkB,CAAD,CADD;AAMlB7G,MAAAA,WAAW,EAAE6G,KAAK,CAAC,CACjB,OADiB,EAEjB,OAFiB,EAGjB,QAHiB,CAAD,CANA;AAWlB6K,MAAAA,WAAW,EAAE7K,KAAK,CAAC,EAAD;AAXA,KAAD,CAAnB;AAaA,WAAO;AACLoE,MAAAA,OAAO,EAAE6G,SADJ;AAELvB,MAAAA,OAAO,EAAEwB,SAFJ;AAGL1U,MAAAA,EAAE,EAAE4C,QAAQ,CAAC5C,EAHR;AAIL6M,MAAAA,GAAG,EAAEjK,QAAQ,CAACiK,GAJT;AAKL+H,MAAAA,QAAQ,EAAEl2C,KAAK,CAAC20C,IAAD,EAAOtB,IAAP,CALV;AAML8C,MAAAA,QAAQ,EAAEn2C,KAAK,CAAC40C,IAAD,EAAOvB,IAAP,CANV;AAOLzF,MAAAA,MAAM,EAAEA,MAAM,CAACvC;AAPV,KAAP;AASD,GAxGD;;AA0GA,MAAI+K,QAAQ,GAAG,UAAU/C,IAAV,EAAgBnP,QAAhB,EAA0BmS,UAA1B,EAAsC;AACnD,QAAIC,UAAU,GAAG1nB,MAAjB;AACA,QAAI2nB,UAAU,GAAG7kB,KAAjB;AACA,QAAI8kB,OAAO,GAAGxB,UAAU,CAAC3B,IAAD,CAAxB;AACA,QAAIzF,MAAM,GAAGnoB,MAAM,CAAC;AAClBgxB,MAAAA,YAAY,EAAE3L,KAAK,CAAC,CAClB,OADkB,EAElB,MAFkB,CAAD,CADD;AAKlB4L,MAAAA,WAAW,EAAE5L,KAAK,CAAC,CACjB,OADiB,EAEjB,MAFiB,CAAD,CALA;AASlB6L,MAAAA,SAAS,EAAE7L,KAAK,CAAC,EAAD;AATE,KAAD,CAAnB;AAWA0L,IAAAA,OAAO,CAAC5I,MAAR,CAAelJ,YAAf,CAA4BviC,IAA5B,CAAiC,UAAUmU,KAAV,EAAiB;AAChD,UAAImF,KAAK,GAAGnF,KAAK,CAACmF,KAAlB;AACAmyB,MAAAA,MAAM,CAACzC,OAAP,CAAesL,YAAf,CAA4Bh7B,KAA5B,EAAmC,KAAnC;AACA,UAAIyS,KAAK,GAAGooB,UAAU,CAACpoB,KAAX,CAAiB5X,KAAK,CAAC4X,KAAvB,EAA8BzS,KAA9B,CAAZ;AACAipB,MAAAA,YAAY,CAACjpB,KAAD,EAAQyS,KAAR,EAAe5X,KAAK,CAACjE,GAArB,EAA0BikC,UAA1B,CAAZ;AACA1I,MAAAA,MAAM,CAACzC,OAAP,CAAeuL,WAAf,CAA2Bj7B,KAA3B,EAAkC,KAAlC;AACD,KAND;AAOA+6B,IAAAA,OAAO,CAAC5I,MAAR,CAAe+H,WAAf,CAA2BxzC,IAA3B,CAAgC,UAAUy0C,MAAV,EAAkB;AAChDhJ,MAAAA,MAAM,CAACzC,OAAP,CAAewL,SAAf;AACD,KAFD;AAGAH,IAAAA,OAAO,CAAC5I,MAAR,CAAe3J,WAAf,CAA2B9hC,IAA3B,CAAgC,UAAUmU,KAAV,EAAiB;AAC/C,UAAImF,KAAK,GAAGnF,KAAK,CAACmF,KAAlB;AACAmyB,MAAAA,MAAM,CAACzC,OAAP,CAAesL,YAAf,CAA4Bh7B,KAA5B,EAAmC,KAAnC;AACA,UAAIyS,KAAK,GAAGqoB,UAAU,CAACroB,KAAX,CAAiB5X,KAAK,CAAC4X,KAAvB,EAA8BzS,KAA9B,CAAZ;AACA,UAAIia,SAAS,GAAG2gB,UAAU,CAAC56B,KAAD,CAA1B;AACAwoB,MAAAA,WAAW,CAACxoB,KAAD,EAAQyS,KAAR,EAAe5X,KAAK,CAAChE,MAArB,EAA6B4xB,QAA7B,EAAuCxO,SAAvC,CAAX;AACAkY,MAAAA,MAAM,CAACzC,OAAP,CAAeuL,WAAf,CAA2Bj7B,KAA3B,EAAkC,KAAlC;AACD,KAPD;AAQA,WAAO;AACL6lB,MAAAA,EAAE,EAAEkV,OAAO,CAAClV,EADP;AAEL6M,MAAAA,GAAG,EAAEqI,OAAO,CAACrI,GAFR;AAGL+H,MAAAA,QAAQ,EAAEM,OAAO,CAACN,QAHb;AAILC,MAAAA,QAAQ,EAAEK,OAAO,CAACL,QAJb;AAKLjH,MAAAA,OAAO,EAAEsH,OAAO,CAACtH,OALZ;AAMLtB,MAAAA,MAAM,EAAEA,MAAM,CAACvC;AANV,KAAP;AAQD,GAzCD;;AA0CA,MAAIwL,WAAW,GAAG;AAAEpxB,IAAAA,MAAM,EAAE2wB;AAAV,GAAlB;;AAEA,MAAIU,UAAU,GAAG,UAAUtY,MAAV,EAAkBnsB,GAAlB,EAAuB;AACtC,WAAOmsB,MAAM,CAACuY,IAAP,CAAY,QAAZ,EAAsB;AAAEroC,MAAAA,IAAI,EAAE2D;AAAR,KAAtB,CAAP;AACD,GAFD;;AAGA,MAAI2kC,WAAW,GAAG,UAAUxY,MAAV,EAAkBjkB,IAAlB,EAAwB;AACxC,WAAOikB,MAAM,CAACuY,IAAP,CAAY,SAAZ,EAAuB;AAAEroC,MAAAA,IAAI,EAAE6L;AAAR,KAAvB,CAAP;AACD,GAFD;;AAGA,MAAI08B,qBAAqB,GAAG,UAAUzY,MAAV,EAAkBt0B,MAAlB,EAA0BwnB,KAA1B,EAAiC9C,MAAjC,EAAyCyY,MAAzC,EAAiD;AAC3E7I,IAAAA,MAAM,CAACuY,IAAP,CAAY,mBAAZ,EAAiC;AAC/B7sC,MAAAA,MAAM,EAAEA,MADuB;AAE/BwnB,MAAAA,KAAK,EAAEA,KAFwB;AAG/B9C,MAAAA,MAAM,EAAEA,MAHuB;AAI/ByY,MAAAA,MAAM,EAAEA;AAJuB,KAAjC;AAMD,GAPD;;AAQA,MAAI6P,iBAAiB,GAAG,UAAU1Y,MAAV,EAAkBt0B,MAAlB,EAA0BwnB,KAA1B,EAAiC9C,MAAjC,EAAyCyY,MAAzC,EAAiD;AACvE7I,IAAAA,MAAM,CAACuY,IAAP,CAAY,eAAZ,EAA6B;AAC3B7sC,MAAAA,MAAM,EAAEA,MADmB;AAE3BwnB,MAAAA,KAAK,EAAEA,KAFoB;AAG3B9C,MAAAA,MAAM,EAAEA,MAHmB;AAI3ByY,MAAAA,MAAM,EAAEA;AAJmB,KAA7B;AAMD,GAPD;;AAQA,MAAI8P,wBAAwB,GAAG,UAAU3Y,MAAV,EAAkBzrB,KAAlB,EAAyBxJ,KAAzB,EAAgCiY,MAAhC,EAAwC41B,UAAxC,EAAoD;AACjF5Y,IAAAA,MAAM,CAACuY,IAAP,CAAY,sBAAZ,EAAoC;AAClChkC,MAAAA,KAAK,EAAEA,KAD2B;AAElCxJ,MAAAA,KAAK,EAAEA,KAF2B;AAGlCiY,MAAAA,MAAM,EAAEA,MAH0B;AAIlC41B,MAAAA,UAAU,EAAEA;AAJsB,KAApC;AAMD,GAPD;;AAQA,MAAIC,uBAAuB,GAAG,UAAU7Y,MAAV,EAAkB;AAC9CA,IAAAA,MAAM,CAACuY,IAAP,CAAY,qBAAZ;AACD,GAFD;;AAGA,MAAIO,iBAAiB,GAAG,UAAU9Y,MAAV,EAAkB/iB,KAAlB,EAAyBwmB,IAAzB,EAA+B;AACrDzD,IAAAA,MAAM,CAACuY,IAAP,CAAY,eAAZ,EAA6BpxC,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKs8B,IAAL,CAAT,EAAqB;AAAExmB,MAAAA,KAAK,EAAEA;AAAT,KAArB,CAArC;AACD,GAFD;;AAGA,MAAI87B,aAAa,GAAG;AAClBC,IAAAA,SAAS,EAAE,KADO;AAElBv+B,IAAAA,KAAK,EAAE;AAFW,GAApB;AAIA,MAAIw+B,iBAAiB,GAAG;AACtBD,IAAAA,SAAS,EAAE,IADW;AAEtBv+B,IAAAA,KAAK,EAAE;AAFe,GAAxB;AAKA,MAAIy+B,mBAAmB,GAAG,4IAA1B;AACA,MAAIC,aAAa,GAAG;AAClB,uBAAmB,UADD;AAElB,aAAS;AAFS,GAApB;;AAIA,MAAIC,sBAAsB,GAAG,UAAUpZ,MAAV,EAAkB;AAC7C,QAAIqZ,cAAc,CAACrZ,MAAD,CAAlB,EAA4B;AAC1B,UAAIsZ,WAAW,GAAGtZ,MAAM,CAAC1nB,OAAP,GAAiBkW,WAAnC;AACA,aAAOrnB,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKgyC,aAAL,CAAT,EAA8B;AAAEjmB,QAAAA,KAAK,EAAEomB,WAAW,GAAG;AAAvB,OAA9B,CAAf;AACD,KAHD,MAGO,IAAIC,kBAAkB,CAACvZ,MAAD,CAAtB,EAAgC;AACrC,aAAOntB,QAAQ,CAACsmC,aAAD,EAAgB,UAAUK,MAAV,EAAkBtmC,GAAlB,EAAuB;AACpD,eAAOA,GAAG,KAAK,OAAf;AACD,OAFc,CAAf;AAGD,KAJM,MAIA;AACL,aAAOimC,aAAP;AACD;AACF,GAXD;;AAYA,MAAIM,iBAAiB,GAAG;AAAEC,IAAAA,MAAM,EAAE;AAAV,GAAxB;AACA,MAAIC,8BAA8B,GAAG,eAArC;;AACA,MAAIC,kBAAkB,GAAG,UAAU5Z,MAAV,EAAkB;AACzC,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,mBAAhB,EAAqC,MAArC,CAAP;AACD,GAFD;;AAGA,MAAIC,qBAAqB,GAAG,UAAU9Z,MAAV,EAAkB;AAC5C,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,wBAAhB,CAAP;AACD,GAFD;;AAGA,MAAIE,oBAAoB,GAAG,UAAU/Z,MAAV,EAAkB;AAC3C,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,0BAAhB,EAA4CJ,iBAA5C,EAA+D,QAA/D,CAAP;AACD,GAFD;;AAGA,MAAIO,gBAAgB,GAAG,UAAUha,MAAV,EAAkB;AACvC,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,sBAAhB,EAAwCT,sBAAsB,CAACpZ,MAAD,CAA9D,EAAwE,QAAxE,CAAP;AACD,GAFD;;AAGA,MAAIia,kBAAkB,GAAG,UAAUja,MAAV,EAAkB;AACzC,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,mBAAhB,EAAqC,IAArC,EAA2C,SAA3C,CAAP;AACD,GAFD;;AAGA,MAAIK,gBAAgB,GAAG,UAAUla,MAAV,EAAkB;AACvC,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,sBAAhB,EAAwC,IAAxC,EAA8C,SAA9C,CAAP;AACD,GAFD;;AAGA,MAAIM,kBAAkB,GAAG,UAAUna,MAAV,EAAkB;AACzC,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,mBAAhB,EAAqC,IAArC,EAA2C,SAA3C,CAAP;AACD,GAFD;;AAGA,MAAIO,iBAAiB,GAAG,UAAUpa,MAAV,EAAkB;AACxC,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,kBAAhB,EAAoC,IAApC,EAA0C,SAA1C,CAAP;AACD,GAFD;;AAGA,MAAIQ,mBAAmB,GAAG,UAAUra,MAAV,EAAkB;AAC1C,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,cAAhB,EAAgC,IAAhC,EAAsC,SAAtC,CAAP;AACD,GAFD;;AAGA,MAAIS,oBAAoB,GAAG,UAAUta,MAAV,EAAkB;AAC3C,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,0BAAhB,EAA4C,IAA5C,EAAkD,SAAlD,CAAP;AACD,GAFD;;AAGA,MAAIU,YAAY,GAAG,UAAUva,MAAV,EAAkB;AACnC,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,YAAhB,EAA8B,IAA9B,EAAoC,SAApC,CAAP;AACD,GAFD;;AAGA,MAAIW,kBAAkB,GAAG,UAAUxa,MAAV,EAAkB;AACzC,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,oBAAhB,EAAsC,KAAtC,EAA6C,SAA7C,CAAP;AACD,GAFD;;AAGA,MAAIY,gBAAgB,GAAG,UAAUza,MAAV,EAAkB;AACvC,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,uBAAhB,EAAyC,EAAzC,EAA6C,OAA7C,CAAP;AACD,GAFD;;AAGA,MAAIa,eAAe,GAAG,UAAU1a,MAAV,EAAkB;AACtC,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,sBAAhB,EAAwC,EAAxC,EAA4C,OAA5C,CAAP;AACD,GAFD;;AAGA,MAAIc,iBAAiB,GAAG,UAAU3a,MAAV,EAAkB;AACxC,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,kBAAhB,EAAoC,EAApC,EAAwC,OAAxC,CAAP;AACD,GAFD;;AAGA,MAAIe,mBAAmB,GAAG,UAAU5a,MAAV,EAAkB;AAC1C,WAAO4Z,kBAAkB,CAAC5Z,MAAD,CAAlB,KAA+B,UAA/B,IAA6C8Z,qBAAqB,CAAC9Z,MAAD,CAArB,KAAkC,IAAtF;AACD,GAFD;;AAGA,MAAIqZ,cAAc,GAAG,UAAUrZ,MAAV,EAAkB;AACrC,WAAO4Z,kBAAkB,CAAC5Z,MAAD,CAAlB,KAA+B,OAA/B,IAA0C8Z,qBAAqB,CAAC9Z,MAAD,CAArB,KAAkC,KAAnF;AACD,GAFD;;AAGA,MAAIuZ,kBAAkB,GAAG,UAAUvZ,MAAV,EAAkB;AACzC,WAAO4Z,kBAAkB,CAAC5Z,MAAD,CAAlB,KAA+B,YAAtC;AACD,GAFD;;AAGA,MAAI6a,UAAU,GAAG,UAAU7a,MAAV,EAAkB;AACjC,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,eAAhB,EAAiCX,mBAAjC,CAAP;AACD,GAFD;;AAGA,MAAI4B,cAAc,GAAG,UAAU9a,MAAV,EAAkB;AACrC,WAAOA,MAAM,CAAC6Z,QAAP,CAAgB,qBAAhB,EAAuC,KAAvC,EAA8C,SAA9C,CAAP;AACD,GAFD;;AAGA,MAAIkB,kBAAkB,GAAG,UAAU/a,MAAV,EAAkB;AACzC,QAAIgb,YAAY,GAAG,SAAnB;AACA,QAAIp7C,KAAK,GAAGogC,MAAM,CAAC6Z,QAAP,CAAgB,mBAAhB,EAAqCmB,YAArC,EAAmD,QAAnD,CAAZ;AACA,QAAIC,WAAW,GAAG,CAChB,SADgB,EAEhB,OAFgB,EAGhB,cAHgB,EAIhB,MAJgB,CAAlB;;AAMA,QAAI,CAAC71C,QAAQ,CAAC61C,WAAD,EAAcr7C,KAAd,CAAb,EAAmC;AACjC,aAAOo7C,YAAP;AACD,KAFD,MAEO;AACL,aAAOp7C,KAAP;AACD;AACF,GAdD;;AAeA,MAAIs7C,0BAA0B,GAAG,UAAUlb,MAAV,EAAkB;AACjD,QAAImb,UAAU,GAAG,CACf,eADe,EAEf,aAFe,CAAjB;AAIA,QAAIC,SAAS,GAAGpb,MAAM,CAAC6Z,QAAP,CAAgB,uBAAhB,EAAyCF,8BAAzC,EAAyE,QAAzE,CAAhB;AACA,WAAOrzC,IAAI,CAAC60C,UAAD,EAAa,UAAUrM,IAAV,EAAgB;AACtC,aAAOA,IAAI,KAAKsM,SAAhB;AACD,KAFU,CAAJ,CAEJl4C,KAFI,CAEEy2C,8BAFF,CAAP;AAGD,GATD;;AAUA,MAAI0B,6BAA6B,GAAG,UAAUrb,MAAV,EAAkB;AACpD,WAAOkb,0BAA0B,CAAClb,MAAD,CAA1B,KAAuC,eAA9C;AACD,GAFD;;AAGA,MAAIsb,2BAA2B,GAAG,UAAUtb,MAAV,EAAkB;AAClD,WAAOkb,0BAA0B,CAAClb,MAAD,CAA1B,KAAuC,aAA9C;AACD,GAFD;;AAGA,MAAIub,gBAAgB,GAAG,UAAUvb,MAAV,EAAkB;AACvC,QAAIwb,aAAa,GAAGxb,MAAM,CAAC6Z,QAAP,CAAgB,sBAAhB,CAApB;;AACA,QAAI75C,QAAQ,CAACw7C,aAAD,CAAZ,EAA6B;AAC3B,aAAO72C,QAAQ,CAACR,IAAT,CAAcq3C,aAAa,CAAC1J,KAAd,CAAoB,MAApB,CAAd,CAAP;AACD,KAFD,MAEO,IAAI1yC,KAAK,CAACc,OAAN,CAAcs7C,aAAd,CAAJ,EAAkC;AACvC,aAAO72C,QAAQ,CAACR,IAAT,CAAcq3C,aAAd,CAAP;AACD,KAFM,MAEA;AACL,aAAO72C,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,GATD;;AAUA,MAAIo5C,iBAAiB,GAAG,UAAUzb,MAAV,EAAkB;AACxC,QAAI0b,cAAc,GAAG1b,MAAM,CAAC6Z,QAAP,CAAgB,iBAAhB,EAAmC,IAAnC,CAArB;AACA,WAAO75C,QAAQ,CAAC07C,cAAD,CAAR,GAA2BA,cAAc,KAAK,OAA9C,GAAwDA,cAA/D;AACD,GAHD;;AAKA,MAAIC,KAAK,GAAG,UAAU3b,MAAV,EAAkB/iB,KAAlB,EAAyB;AACnC,QAAI29B,mBAAmB,CAAC5a,MAAD,CAAvB,EAAiC;AAC/B,UAAI9M,KAAK,GAAGqN,aAAa,CAACP,MAAD,EAAS/iB,KAAK,CAAC3M,GAAf,CAAb,CAAiCxM,MAAjC,CAAwC48B,YAAxC,EAAsDv9B,UAAtD,CAAiE,YAAY;AACvF,eAAOipC,sBAAsB,CAACnvB,KAAD,CAA7B;AACD,OAFW,CAAZ;AAGA,aAAOme,SAAS,CAACX,cAAV,CAAyBvH,KAAzB,EAAgCjW,KAAhC,CAAP;AACD,KALD,MAKO,IAAIo8B,cAAc,CAACrZ,MAAD,CAAlB,EAA4B;AACjC,aAAO5E,SAAS,CAACL,SAAV,CAAoBtM,KAAK,CAACxR,KAAD,CAAzB,EAAkCA,KAAlC,CAAP;AACD,KAFM,MAEA;AACL,aAAOme,SAAS,CAACD,YAAV,CAAuBle,KAAvB,CAAP;AACD;AACF,GAXD;;AAaA,MAAI2+B,uBAAuB,GAAG,UAAUhrC,OAAV,EAAmB;AAC/CuJ,IAAAA,MAAM,CAACvJ,OAAD,EAAU,OAAV,CAAN;AACD,GAFD;;AAGA,MAAIirC,oBAAoB,GAAG,UAAU5+B,KAAV,EAAiBia,SAAjB,EAA4B;AACrD,QAAI4D,QAAQ,GAAG7C,oBAAoB,CAAChb,KAAD,CAAnC;AACAquB,IAAAA,cAAc,CAACruB,KAAD,EAAQtY,QAAQ,CAACR,IAAT,CAAc22B,QAAd,CAAR,EAAiCn2B,QAAQ,CAACtC,IAAT,EAAjC,EAAkD60B,SAAlD,CAAd;AACA0kB,IAAAA,uBAAuB,CAAC3+B,KAAD,CAAvB;AACD,GAJD;;AAKA,MAAI6+B,kBAAkB,GAAG,UAAU7+B,KAAV,EAAiBia,SAAjB,EAA4B;AACnD,QAAI4D,QAAQ,GAAG9C,kBAAkB,CAAC/a,KAAD,CAAjC;AACAquB,IAAAA,cAAc,CAACruB,KAAD,EAAQtY,QAAQ,CAACR,IAAT,CAAc22B,QAAd,CAAR,EAAiCn2B,QAAQ,CAACtC,IAAT,EAAjC,EAAkD60B,SAAlD,CAAd;AACA0kB,IAAAA,uBAAuB,CAAC3+B,KAAD,CAAvB;AACD,GAJD;;AAKA,MAAI8+B,iBAAiB,GAAG,UAAU9+B,KAAV,EAAiB;AACvCxB,IAAAA,QAAQ,CAACwB,KAAD,EAAQ,OAAR,CAAR;AACA,QAAIyR,SAAS,GAAG/a,OAAO,CAACsJ,KAAD,CAAvB;AACA,QAAI++B,WAAW,GAAGttB,SAAS,CAACztB,MAAV,GAAmB,CAAnB,GAAuBytB,SAAvB,GAAmCna,KAAK,CAAC0I,KAAD,CAA1D;AACAvZ,IAAAA,IAAI,CAACs4C,WAAD,EAAc,UAAUjgC,IAAV,EAAgB;AAChCN,MAAAA,QAAQ,CAACM,IAAD,EAAO,OAAP,CAAR;AACA6/B,MAAAA,uBAAuB,CAAC7/B,IAAD,CAAvB;AACD,KAHG,CAAJ;AAIA6/B,IAAAA,uBAAuB,CAAC3+B,KAAD,CAAvB;AACD,GATD;;AAWA,MAAIg/B,iBAAiB,GAAG,UAAUjc,MAAV,EAAkB/iB,KAAlB,EAAyB;AAC/C,QAAIi/B,WAAW,GAAGP,KAAK,CAAC3b,MAAD,EAAS/iB,KAAT,CAAvB;AACA4+B,IAAAA,oBAAoB,CAAC5+B,KAAD,EAAQi/B,WAAR,CAApB;AACD,GAHD;;AAIA,MAAIC,aAAa,GAAG,UAAUnc,MAAV,EAAkB/iB,KAAlB,EAAyB;AAC3C,QAAIi/B,WAAW,GAAGP,KAAK,CAAC3b,MAAD,EAAS/iB,KAAT,CAAvB;AACA6+B,IAAAA,kBAAkB,CAAC7+B,KAAD,EAAQi/B,WAAR,CAAlB;AACD,GAHD;;AAIA,MAAIE,WAAW,GAAGL,iBAAlB;;AACA,MAAIM,UAAU,GAAG,UAAUp/B,KAAV,EAAiB;AAChC,QAAImC,SAAS,GAAGkC,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAhB;;AACA,QAAI,CAACqE,SAAS,CAACF,UAAV,CAAqBhC,SAArB,CAAL,EAAsC;AACpC1b,MAAAA,IAAI,CAAC6Q,KAAK,CAAC0I,KAAD,CAAN,EAAe,UAAUlB,IAAV,EAAgB;AACjC,YAAIugC,aAAa,GAAGnhC,KAAK,CAACY,IAAD,EAAO,OAAP,CAAzB;AACAf,QAAAA,KAAK,CAACe,IAAD,EAAO,OAAP,EAAgBugC,aAAhB,CAAL;AACAniC,QAAAA,MAAM,CAAC4B,IAAD,EAAO,OAAP,CAAN;AACD,OAJG,CAAJ;AAKD;AACF,GATD;;AAWA,MAAIwgC,eAAe,GAAG,YAAY;AAChC,QAAIzzB,SAAS,GAAGnY,YAAY,CAACX,OAAb,CAAqB,KAArB,CAAhB;AACAiL,IAAAA,QAAQ,CAAC6N,SAAD,EAAY;AAClBkqB,MAAAA,QAAQ,EAAE,QADQ;AAElB5iB,MAAAA,MAAM,EAAE,GAFU;AAGlB8C,MAAAA,KAAK,EAAE,GAHW;AAIlBspB,MAAAA,OAAO,EAAE,GAJS;AAKlBC,MAAAA,MAAM,EAAE,GALU;AAMlB/C,MAAAA,MAAM,EAAE;AANU,KAAZ,CAAR;AAQAl1B,IAAAA,MAAM,CAACnM,IAAI,EAAL,EAASyQ,SAAT,CAAN;AACA,WAAOA,SAAP;AACD,GAZD;;AAaA,MAAI4zB,KAAK,GAAG,UAAU1c,MAAV,EAAkB2I,WAAlB,EAA+B;AACzC,WAAO3I,MAAM,CAAC2c,MAAP,GAAgB1T,UAAU,CAAC5wB,IAAX,CAAgB0nB,SAAS,CAACC,MAAD,CAAzB,EAAmCuc,eAAe,EAAlD,EAAsD5T,WAAtD,CAAhB,GAAqFM,UAAU,CAACnF,IAAX,CAAgBnzB,YAAY,CAACZ,OAAb,CAAqBiwB,MAAM,CAACsD,MAAP,EAArB,CAAhB,EAAuDqF,WAAvD,CAA5F;AACD,GAFD;;AAGA,MAAIiU,QAAQ,GAAG,UAAU5c,MAAV,EAAkB6U,IAAlB,EAAwB;AACrC,QAAI7U,MAAM,CAAC2c,MAAX,EAAmB;AACjBt3B,MAAAA,QAAQ,CAACwvB,IAAI,CAACz+B,MAAL,EAAD,CAAR;AACD;AACF,GAJD;;AAMA,MAAIymC,gBAAgB,GAAG,MAAvB;;AACA,MAAIlU,WAAW,GAAG,UAAU9rB,GAAV,EAAe;AAC/B,WAAO7C,KAAK,CAAC6C,GAAD,EAAM,iBAAN,CAAL,KAAkC,OAAzC;AACD,GAFD;;AAGA,MAAIigC,gBAAgB,GAAG,UAAU9c,MAAV,EAAkB;AACvC,QAAI+c,YAAY,GAAGp4C,QAAQ,CAACtC,IAAT,EAAnB;AACA,QAAI+hC,MAAM,GAAGz/B,QAAQ,CAACtC,IAAT,EAAb;AACA,QAAIwyC,IAAI,GAAGlwC,QAAQ,CAACtC,IAAT,EAAX;AACA,QAAI26C,MAAJ;AACA,QAAIC,SAAJ;;AACA,QAAI5Z,OAAO,GAAG,UAAUxmB,GAAV,EAAe;AAC3B,aAAOA,GAAG,CAACvH,QAAJ,KAAiB,OAAxB;AACD,KAFD;;AAGA,QAAI4nC,UAAU,GAAG,YAAY;AAC3B,aAAO9Y,MAAP;AACD,KAFD;;AAGA,QAAI+Y,QAAQ,GAAG,YAAY;AACzB,aAAOtI,IAAI,CAAC3xC,KAAL,CAAW+lC,UAAU,CAACnF,IAAX,CAAgBnzB,YAAY,CAACZ,OAAb,CAAqBiwB,MAAM,CAAC1nB,OAAP,EAArB,CAAhB,EAAwDqwB,WAAxD,CAAX,CAAP;AACD,KAFD;;AAGA,QAAIkP,UAAU,GAAG,UAAU56B,KAAV,EAAiB;AAChC,aAAO0+B,KAAK,CAAC3b,MAAD,EAAS/iB,KAAT,CAAZ;AACD,KAFD;;AAGA,QAAImgC,qBAAqB,GAAG,YAAY;AACtC,aAAO/B,6BAA6B,CAACrb,MAAD,CAA7B,GAAwCoI,aAAa,EAArD,GAA0DnC,WAAW,EAA5E;AACD,KAFD;;AAGA,QAAIoX,aAAa,GAAG,UAAUpgC,KAAV,EAAiB;AACnC,aAAOovB,WAAW,CAACpvB,KAAD,CAAX,CAAmBtJ,OAA1B;AACD,KAFD;;AAGA,QAAI2pC,iBAAiB,GAAG,UAAUrgC,KAAV,EAAiB4rB,MAAjB,EAAyB3V,KAAzB,EAAgC;AACtD,UAAIqqB,iBAAiB,GAAGpyC,QAAQ,CAAC09B,MAAD,EAAS,GAAT,CAAhC;;AACA,UAAIoU,SAAS,KAAK,EAAlB,EAAsB;AACpBhB,QAAAA,iBAAiB,CAACjc,MAAD,EAAS/iB,KAAT,CAAjB;AACD;;AACD,UAAIiW,KAAK,KAAK8pB,MAAV,IAAoBC,SAAS,KAAK,EAAtC,EAA0C;AACxCjiC,QAAAA,KAAK,CAACiC,KAAD,EAAQ,OAAR,EAAiBggC,SAAjB,CAAL;AACA,YAAIvX,QAAQ,GAAG0X,qBAAqB,EAApC;AACA,YAAIlmB,SAAS,GAAG2gB,UAAU,CAAC56B,KAAD,CAA1B;AACA,YAAI4R,GAAG,GAAGwsB,6BAA6B,CAACrb,MAAD,CAA7B,IAAyCud,iBAAzC,GAA6DF,aAAa,CAACpgC,KAAD,CAAb,GAAuB,CAApF,GAAwF,CAAlG;AACAwoB,QAAAA,WAAW,CAACxoB,KAAD,EAAQiW,KAAK,GAAG8pB,MAAhB,EAAwBnuB,GAAxB,EAA6B6W,QAA7B,EAAuCxO,SAAvC,CAAX;AACD,OAND,MAMO,IAAIwJ,YAAY,CAACuc,SAAD,CAAhB,EAA6B;AAClC,YAAIO,QAAQ,GAAGzvB,UAAU,CAACkvB,SAAS,CAACxzC,OAAV,CAAkB,GAAlB,EAAuB,EAAvB,CAAD,CAAzB;AACA,YAAIg0C,cAAc,GAAGvqB,KAAK,GAAGsqB,QAAR,GAAmBR,MAAxC;AACAhiC,QAAAA,KAAK,CAACiC,KAAD,EAAQ,OAAR,EAAiBwgC,cAAc,GAAG,GAAlC,CAAL;AACD;;AACD,UAAI9c,OAAO,CAACsc,SAAD,CAAX,EAAwB;AACtBZ,QAAAA,UAAU,CAACp/B,KAAD,CAAV;AACD;AACF,KAnBD;;AAoBA,QAAIyzB,OAAO,GAAG,YAAY;AACxBtM,MAAAA,MAAM,CAAC1gC,IAAP,CAAY,UAAUg6C,EAAV,EAAc;AACxBA,QAAAA,EAAE,CAAChN,OAAH;AACD,OAFD;AAGAmE,MAAAA,IAAI,CAACnxC,IAAL,CAAU,UAAUwd,CAAV,EAAa;AACrB07B,QAAAA,QAAQ,CAAC5c,MAAD,EAAS9e,CAAT,CAAR;AACD,OAFD;AAGD,KAPD;;AAQA8e,IAAAA,MAAM,CAAC8C,EAAP,CAAU,MAAV,EAAkB,YAAY;AAC5B,UAAI6a,OAAO,GAAGjB,KAAK,CAAC1c,MAAD,EAAS2I,WAAT,CAAnB;AACAkM,MAAAA,IAAI,GAAGlwC,QAAQ,CAACR,IAAT,CAAcw5C,OAAd,CAAP;;AACA,UAAIlC,iBAAiB,CAACzb,MAAD,CAAjB,IAA6Bia,kBAAkB,CAACja,MAAD,CAAnD,EAA6D;AAC3D,YAAI0F,QAAQ,GAAG0X,qBAAqB,EAApC;AACA,YAAIM,EAAE,GAAGrF,WAAW,CAACpxB,MAAZ,CAAmB02B,OAAnB,EAA4BjY,QAA5B,EAAsCmS,UAAtC,CAAT;AACA6F,QAAAA,EAAE,CAAC5a,EAAH;AACA4a,QAAAA,EAAE,CAACtO,MAAH,CAAU+I,SAAV,CAAoBx0C,IAApB,CAAyB,UAAUy0C,MAAV,EAAkB;AACzC2E,UAAAA,YAAY,GAAGp4C,QAAQ,CAACR,IAAT,CAAc67B,MAAM,CAACa,SAAP,CAAiB+c,MAAjB,EAAd,CAAf;AACD,SAFD;AAGAF,QAAAA,EAAE,CAACtO,MAAH,CAAU6I,YAAV,CAAuBt0C,IAAvB,CAA4B,UAAUmU,KAAV,EAAiB;AAC3C,cAAI+lC,QAAQ,GAAG/lC,KAAK,CAACmF,KAAN,CAAY3M,GAA3B;AACAmoC,UAAAA,qBAAqB,CAACzY,MAAD,EAAS6d,QAAT,EAAmB5d,eAAe,CAAC4d,QAAD,CAAlC,EAA8C3d,cAAc,CAAC2d,QAAD,CAA5D,EAAwEhB,gBAAgB,GAAG/kC,KAAK,CAACnY,IAAjG,CAArB;AACD,SAHD;AAIA+9C,QAAAA,EAAE,CAACtO,MAAH,CAAU8I,WAAV,CAAsBv0C,IAAtB,CAA2B,UAAUmU,KAAV,EAAiB;AAC1C,cAAImF,KAAK,GAAGnF,KAAK,CAACmF,KAAlB;AACA,cAAI4gC,QAAQ,GAAG5gC,KAAK,CAAC3M,GAArB;AACA+vB,UAAAA,eAAe,CAACpjB,KAAD,CAAf;AACA8/B,UAAAA,YAAY,CAACr5C,IAAb,CAAkB,UAAUigC,GAAV,EAAe;AAC/B3D,YAAAA,MAAM,CAACa,SAAP,CAAiB6C,MAAjB,CAAwBC,GAAxB;AACA3D,YAAAA,MAAM,CAAC4D,KAAP;AACD,WAHD;AAIA8U,UAAAA,iBAAiB,CAAC1Y,MAAD,EAAS6d,QAAT,EAAmB5d,eAAe,CAAC4d,QAAD,CAAlC,EAA8C3d,cAAc,CAAC2d,QAAD,CAA5D,EAAwEhB,gBAAgB,GAAG/kC,KAAK,CAACnY,IAAjG,CAAjB;AACAqgC,UAAAA,MAAM,CAAC8d,WAAP,CAAmBjT,GAAnB;AACD,SAVD;AAWAzG,QAAAA,MAAM,GAAGz/B,QAAQ,CAACR,IAAT,CAAcu5C,EAAd,CAAT;AACD;AACF,KA3BD;AA4BA1d,IAAAA,MAAM,CAAC8C,EAAP,CAAU,mBAAV,EAA+B,UAAUhtB,CAAV,EAAa;AAC1C,UAAIioC,SAAS,GAAGjoC,CAAC,CAACpK,MAAlB;;AACA,UAAI23B,OAAO,CAAC0a,SAAD,CAAX,EAAwB;AACtB,YAAI9gC,KAAK,GAAGtM,YAAY,CAACZ,OAAb,CAAqBguC,SAArB,CAAZ;AACAr6C,QAAAA,IAAI,CAACs8B,MAAM,CAAC1vB,GAAP,CAAW0tC,MAAX,CAAkB,sBAAlB,CAAD,EAA4C,UAAU3jC,KAAV,EAAiB;AAC/D2lB,UAAAA,MAAM,CAAC1vB,GAAP,CAAW2tC,QAAX,CAAoB5jC,KAApB,EAA2B,SAAS6gC,0BAA0B,CAAClb,MAAD,CAAnC,GAA8C,UAAzE;AACD,SAFG,CAAJ;;AAGA,YAAI,CAACkM,eAAe,CAACjvB,KAAD,CAAhB,IAA2Bo8B,cAAc,CAACrZ,MAAD,CAA7C,EAAuD;AACrDmc,UAAAA,aAAa,CAACnc,MAAD,EAAS/iB,KAAT,CAAb;AACD,SAFD,MAEO,IAAI,CAACgvB,iBAAiB,CAAChvB,KAAD,CAAlB,IAA6B29B,mBAAmB,CAAC5a,MAAD,CAApD,EAA8D;AACnEic,UAAAA,iBAAiB,CAACjc,MAAD,EAAS/iB,KAAT,CAAjB;AACD;;AACD,YAAIkvB,cAAc,CAAClvB,KAAD,CAAd,IAAyBhS,UAAU,CAAC6K,CAAC,CAAC+yB,MAAH,EAAWgU,gBAAX,CAAvC,EAAqE;AACnEZ,UAAAA,iBAAiB,CAACjc,MAAD,EAAS/iB,KAAT,CAAjB;AACD;;AACD+/B,QAAAA,MAAM,GAAGlnC,CAAC,CAACod,KAAX;AACA+pB,QAAAA,SAAS,GAAG1D,kBAAkB,CAACvZ,MAAD,CAAlB,GAA6B,EAA7B,GAAkCO,aAAa,CAACP,MAAD,EAAS+d,SAAT,CAAb,CAAiC76C,KAAjC,CAAuC,EAAvC,CAA9C;AACD;AACF,KAlBD;AAmBA88B,IAAAA,MAAM,CAAC8C,EAAP,CAAU,eAAV,EAA2B,UAAUhtB,CAAV,EAAa;AACtC,UAAIioC,SAAS,GAAGjoC,CAAC,CAACpK,MAAlB;;AACA,UAAI23B,OAAO,CAAC0a,SAAD,CAAX,EAAwB;AACtB,YAAI9gC,KAAK,GAAGtM,YAAY,CAACZ,OAAb,CAAqBguC,SAArB,CAAZ;AACA,YAAIG,QAAQ,GAAGpoC,CAAC,CAAC+yB,MAAjB;;AACA,YAAI59B,UAAU,CAACizC,QAAD,EAAW,SAAX,CAAd,EAAqC;AACnCZ,UAAAA,iBAAiB,CAACrgC,KAAD,EAAQihC,QAAR,EAAkBpoC,CAAC,CAACod,KAApB,CAAjB;AACD;;AACDmN,QAAAA,eAAe,CAACpjB,KAAD,CAAf;AACA67B,QAAAA,iBAAiB,CAAC9Y,MAAD,EAAS/iB,KAAK,CAAC3M,GAAf,EAAoByoC,aAApB,CAAjB;AACD;AACF,KAXD;AAYA/Y,IAAAA,MAAM,CAAC8C,EAAP,CAAU,YAAV,EAAwB,YAAY;AAClCoa,MAAAA,UAAU,GAAGx5C,IAAb,CAAkB,UAAU0gC,MAAV,EAAkB;AAClC,YAAIpE,MAAM,CAAC8O,IAAP,CAAYqP,UAAZ,EAAJ,EAA8B;AAC5B/Z,UAAAA,MAAM,CAACsT,QAAP;AACD,SAFD,MAEO;AACLtT,UAAAA,MAAM,CAACuT,QAAP;AACD;AACF,OAND;AAOD,KARD;AASA,WAAO;AACLuF,MAAAA,UAAU,EAAEA,UADP;AAELC,MAAAA,QAAQ,EAAEA,QAFL;AAGLzM,MAAAA,OAAO,EAAEA;AAHJ,KAAP;AAKD,GA7HD;;AA+HA,MAAI0N,KAAK,GAAG,UAAUxtC,OAAV,EAAmBu+B,MAAnB,EAA2B;AACrC,WAAO;AACLv+B,MAAAA,OAAO,EAAEA,OADJ;AAELu+B,MAAAA,MAAM,EAAEA;AAFH,KAAP;AAID,GALD;;AAOA,MAAIrE,IAAI,GAAG,UAAUzjB,QAAV,EAAoBzW,OAApB,EAA6BgpB,SAA7B,EAAwC;AACjD,QAAIvS,QAAQ,CAACzM,QAAT,GAAoBlF,MAApB,CAA2B9E,OAA3B,KAAuCyW,QAAQ,CAACzM,QAAT,GAAoBsM,OAApB,CAA4BtW,OAA5B,EAAqCtF,IAArC,GAA4CrK,MAA5C,KAAuD,CAA9F,IAAmGomB,QAAQ,CAACzM,QAAT,GAAoBpF,SAApB,CAA8B5E,OAA9B,CAAvG,EAA+I;AAC7I,aAAOgpB,SAAS,CAAChpB,OAAD,CAAT,CAAmBjN,IAAnB,CAAwB,UAAUoN,IAAV,EAAgB;AAC7C,eAAO+5B,IAAI,CAACzjB,QAAD,EAAWtW,IAAX,EAAiB6oB,SAAjB,CAAJ,CAAgCp2B,OAAhC,CAAwC,YAAY;AACzD,iBAAOmB,QAAQ,CAACR,IAAT,CAAc4M,IAAd,CAAP;AACD,SAFM,CAAP;AAGD,OAJM,CAAP;AAKD,KAND,MAMO;AACL,aAAOpM,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,GAVD;;AAWA,MAAIg8C,KAAK,GAAG,UAAUh3B,QAAV,EAAoBzW,OAApB,EAA6B;AACvC,QAAIyW,QAAQ,CAACzM,QAAT,GAAoBlF,MAApB,CAA2B9E,OAA3B,CAAJ,EAAyC;AACvC,aAAOyW,QAAQ,CAACzM,QAAT,GAAoBsM,OAApB,CAA4BtW,OAA5B,EAAqC3P,MAA5C;AACD;;AACD,QAAI8V,QAAQ,GAAGsQ,QAAQ,CAACzM,QAAT,GAAoB7D,QAApB,CAA6BnG,OAA7B,CAAf;AACA,WAAOmG,QAAQ,CAAC9V,MAAhB;AACD,GAND;;AAOA,MAAIq9C,WAAW,GAAG,UAAUj3B,QAAV,EAAoBzW,OAApB,EAA6B;AAC7C,QAAIzG,SAAS,GAAG2gC,IAAI,CAACzjB,QAAD,EAAWzW,OAAX,EAAoByW,QAAQ,CAACnZ,KAAT,GAAiB0I,WAArC,CAAJ,CAAsD1T,KAAtD,CAA4D0N,OAA5D,CAAhB;;AACA,QAAIyW,QAAQ,CAACzM,QAAT,GAAoBlF,MAApB,CAA2BvL,SAA3B,CAAJ,EAA2C;AACzC,aAAOi0C,KAAK,CAACj0C,SAAD,EAAYk0C,KAAK,CAACh3B,QAAD,EAAWld,SAAX,CAAjB,CAAZ;AACD;;AACD,QAAI4M,QAAQ,GAAGsQ,QAAQ,CAACzM,QAAT,GAAoB7D,QAApB,CAA6B5M,SAA7B,CAAf;AACA,WAAO4M,QAAQ,CAAC9V,MAAT,GAAkB,CAAlB,GAAsBq9C,WAAW,CAACj3B,QAAD,EAAWtQ,QAAQ,CAACA,QAAQ,CAAC9V,MAAT,GAAkB,CAAnB,CAAnB,CAAjC,GAA6Em9C,KAAK,CAACj0C,SAAD,EAAYk0C,KAAK,CAACh3B,QAAD,EAAWld,SAAX,CAAjB,CAAzF;AACD,GAPD;;AASA,MAAIo0C,aAAa,GAAGD,WAApB;AAEA,MAAIE,UAAU,GAAGz4B,WAAW,EAA5B;;AACA,MAAI04B,aAAa,GAAG,UAAU7tC,OAAV,EAAmB;AACrC,WAAO2tC,aAAa,CAACC,UAAD,EAAa5tC,OAAb,CAApB;AACD,GAFD;;AAIA,MAAI8tC,KAAK,GAAG,UAAUC,IAAV,EAAgBr4B,KAAhB,EAAuB;AACjC,QAAIrS,OAAO,GAAGiI,OAAO,CAACyiC,IAAD,EAAO,SAAP,CAArB;;AACA,QAAI1qC,OAAO,KAAK,CAAhB,EAAmB;AACjB,UAAIif,KAAK,GAAG4E,eAAe,CAAC6mB,IAAD,CAA3B;AACAzrB,MAAAA,KAAK,CAACxvB,IAAN,CAAW,UAAUwd,CAAV,EAAa;AACtB,YAAI4Z,QAAQ,GAAG5Z,CAAC,CAACthB,KAAF,GAAU,CAAzB;AACAm4B,QAAAA,eAAe,CAAC4mB,IAAD,EAAO7jB,QAAP,EAAiB5Z,CAAC,CAACiT,IAAnB,CAAf;AACA4D,QAAAA,eAAe,CAACzR,KAAD,EAAQwU,QAAR,EAAkB5Z,CAAC,CAACiT,IAApB,CAAf;AACD,OAJD;AAKD;AACF,GAVD;;AAYA,MAAIyqB,QAAQ,GAAG,UAAUhuC,OAAV,EAAmBgK,QAAnB,EAA6Bhb,KAA7B,EAAoCi/C,MAApC,EAA4C;AACzD,QAAIj/C,KAAK,KAAKi/C,MAAd,EAAsB;AACpB1kC,MAAAA,MAAM,CAACvJ,OAAD,EAAUgK,QAAV,CAAN;AACD,KAFD,MAEO;AACLf,MAAAA,GAAG,CAACjJ,OAAD,EAAUgK,QAAV,EAAoBhb,KAApB,CAAH;AACD;AACF,GAND;;AAOA,MAAIknB,MAAM,GAAG,UAAU7J,KAAV,EAAiBpM,QAAjB,EAA2BD,OAA3B,EAAoC;AAC/C3J,IAAAA,IAAI,CAAC4R,UAAU,CAACoE,KAAD,EAAQpM,QAAR,CAAX,CAAJ,CAAkC/N,IAAlC,CAAuC,YAAY;AACjD,aAAO2hB,OAAO,CAACxH,KAAD,EAAQrM,OAAR,CAAd;AACD,KAFD,EAEG,UAAUoG,KAAV,EAAiB;AAClB,aAAO+G,KAAK,CAAC/G,KAAD,EAAQpG,OAAR,CAAZ;AACD,KAJD;AAKD,GAND;;AAOA,MAAIkuC,eAAe,GAAG,UAAU7hC,KAAV,EAAiB8hC,WAAjB,EAA8B;AAClD,QAAIvqC,OAAO,GAAGgF,OAAO,CAACyD,KAAD,EAAQ8hC,WAAR,CAAP,CAA4B57C,UAA5B,CAAuC,YAAY;AAC/D,UAAI67C,UAAU,GAAGruC,YAAY,CAACX,OAAb,CAAqB+uC,WAArB,EAAkChpC,KAAK,CAACkH,KAAD,CAAL,CAAa3M,GAA/C,CAAjB;;AACA,UAAIyuC,WAAW,KAAK,OAApB,EAA6B;AAC3Bj4B,QAAAA,MAAM,CAAC7J,KAAD,EAAQ,kBAAR,EAA4B+hC,UAA5B,CAAN;AACD,OAFD,MAEO,IAAID,WAAW,KAAK,UAApB,EAAgC;AACrCj4B,QAAAA,MAAM,CAAC7J,KAAD,EAAQ,SAAR,EAAmB+hC,UAAnB,CAAN;AACD,OAFM,MAEA;AACLx6B,QAAAA,MAAM,CAACvH,KAAD,EAAQ+hC,UAAR,CAAN;AACD;;AACD,aAAOA,UAAP;AACD,KAVa,CAAd;AAWA95B,IAAAA,KAAK,CAAC1Q,OAAD,CAAL;AACA,WAAOA,OAAP;AACD,GAdD;;AAeA,MAAIyqC,MAAM,GAAG,UAAUhiC,KAAV,EAAiBxJ,IAAjB,EAAuB;AAClC,QAAIyrC,OAAO,GAAG,EAAd;AACA,QAAIlhC,QAAQ,GAAG,EAAf;;AACA,QAAImhC,QAAQ,GAAG,UAAUC,WAAV,EAAuB;AACpC,aAAO37C,GAAG,CAAC27C,WAAD,EAAc,UAAUvrC,GAAV,EAAe;AACrC,YAAIA,GAAG,CAACM,KAAR,EAAe;AACb+qC,UAAAA,OAAO,CAACj6C,IAAR,CAAa4O,GAAG,CAACjD,OAAjB;AACD;;AACD,YAAIyuC,EAAE,GAAGxrC,GAAG,CAACjD,OAAb;AACAsU,QAAAA,KAAK,CAACm6B,EAAD,CAAL;AACA37C,QAAAA,IAAI,CAACmQ,GAAG,CAACU,KAAL,EAAY,UAAUwH,IAAV,EAAgB;AAC9B,cAAIA,IAAI,CAAC5H,KAAT,EAAgB;AACd6J,YAAAA,QAAQ,CAAC/Y,IAAT,CAAc8W,IAAI,CAACnL,OAAnB;AACD;;AACDguC,UAAAA,QAAQ,CAAC7iC,IAAI,CAACnL,OAAN,EAAe,SAAf,EAA0BmL,IAAI,CAAC9H,OAA/B,EAAwC,CAAxC,CAAR;AACA2qC,UAAAA,QAAQ,CAAC7iC,IAAI,CAACnL,OAAN,EAAe,SAAf,EAA0BmL,IAAI,CAAC/H,OAA/B,EAAwC,CAAxC,CAAR;AACAwQ,UAAAA,MAAM,CAAC66B,EAAD,EAAKtjC,IAAI,CAACnL,OAAV,CAAN;AACD,SAPG,CAAJ;AAQA,eAAOyuC,EAAP;AACD,OAfS,CAAV;AAgBD,KAjBD;;AAkBA,QAAIC,YAAY,GAAG,UAAUF,WAAV,EAAuB;AACxC,aAAOz7C,IAAI,CAACy7C,WAAD,EAAc,UAAUG,QAAV,EAAoB;AAC3C,eAAO97C,GAAG,CAAC87C,QAAQ,CAAChrC,KAAV,EAAiB,UAAUsa,GAAV,EAAe;AACxC+vB,UAAAA,QAAQ,CAAC/vB,GAAG,CAACje,OAAL,EAAc,MAAd,EAAsBie,GAAG,CAAC5a,OAA1B,EAAmC,CAAnC,CAAR;AACA,iBAAO4a,GAAG,CAACje,OAAX;AACD,SAHS,CAAV;AAID,OALU,CAAX;AAMD,KAPD;;AAQA,QAAI4uC,aAAa,GAAG,UAAUJ,WAAV,EAAuBL,WAAvB,EAAoC;AACtD,UAAIvqC,OAAO,GAAGsqC,eAAe,CAAC7hC,KAAD,EAAQ8hC,WAAR,CAA7B;AACA,UAAIU,IAAI,GAAGV,WAAW,KAAK,UAAhB,GAA6BO,YAA7B,GAA4CH,QAAvD;AACA,UAAIO,YAAY,GAAGD,IAAI,CAACL,WAAD,CAAvB;AACAn6B,MAAAA,QAAQ,CAACzQ,OAAD,EAAUkrC,YAAV,CAAR;AACD,KALD;;AAMA,QAAIC,aAAa,GAAG,UAAUZ,WAAV,EAAuB;AACzCvlC,MAAAA,OAAO,CAACyD,KAAD,EAAQ8hC,WAAR,CAAP,CAA4Br7C,IAA5B,CAAiC2hB,QAAjC;AACD,KAFD;;AAGA,QAAIu6B,qBAAqB,GAAG,UAAUR,WAAV,EAAuBL,WAAvB,EAAoC;AAC9D,UAAIK,WAAW,CAACn+C,MAAZ,GAAqB,CAAzB,EAA4B;AAC1Bu+C,QAAAA,aAAa,CAACJ,WAAD,EAAcL,WAAd,CAAb;AACD,OAFD,MAEO;AACLY,QAAAA,aAAa,CAACZ,WAAD,CAAb;AACD;AACF,KAND;;AAOA,QAAIc,WAAW,GAAG,EAAlB;AACA,QAAIC,WAAW,GAAG,EAAlB;AACA,QAAIC,WAAW,GAAG,EAAlB;AACA,QAAIC,mBAAmB,GAAG,EAA1B;AACAt8C,IAAAA,IAAI,CAAC+P,IAAD,EAAO,UAAUI,GAAV,EAAe;AACxB,cAAQA,GAAG,CAACW,OAAZ;AACA,aAAK,OAAL;AACEqrC,UAAAA,WAAW,CAAC56C,IAAZ,CAAiB4O,GAAjB;AACA;;AACF,aAAK,OAAL;AACEisC,UAAAA,WAAW,CAAC76C,IAAZ,CAAiB4O,GAAjB;AACA;;AACF,aAAK,OAAL;AACEksC,UAAAA,WAAW,CAAC96C,IAAZ,CAAiB4O,GAAjB;AACA;;AACF,aAAK,UAAL;AACEmsC,UAAAA,mBAAmB,CAAC/6C,IAApB,CAAyB4O,GAAzB;AACA;AAZF;AAcD,KAfG,CAAJ;AAgBA+rC,IAAAA,qBAAqB,CAACI,mBAAD,EAAsB,UAAtB,CAArB;AACAJ,IAAAA,qBAAqB,CAACC,WAAD,EAAc,OAAd,CAArB;AACAD,IAAAA,qBAAqB,CAACE,WAAD,EAAc,OAAd,CAArB;AACAF,IAAAA,qBAAqB,CAACG,WAAD,EAAc,OAAd,CAArB;AACA,WAAO;AACLb,MAAAA,OAAO,EAAEA,OADJ;AAELlhC,MAAAA,QAAQ,EAAEA;AAFL,KAAP;AAID,GAzED;;AA0EA,MAAIiiC,MAAM,GAAG,UAAUxsC,IAAV,EAAgB;AAC3B,WAAOhQ,GAAG,CAACgQ,IAAD,EAAO,UAAUI,GAAV,EAAe;AAC9B,UAAIwrC,EAAE,GAAGpyB,OAAO,CAACpZ,GAAG,CAACjD,OAAL,CAAhB;AACAlN,MAAAA,IAAI,CAACmQ,GAAG,CAACU,KAAL,EAAY,UAAUwH,IAAV,EAAgB;AAC9B,YAAImkC,UAAU,GAAGhzB,IAAI,CAACnR,IAAI,CAACnL,OAAN,CAArB;AACAguC,QAAAA,QAAQ,CAACsB,UAAD,EAAa,SAAb,EAAwBnkC,IAAI,CAAC9H,OAA7B,EAAsC,CAAtC,CAAR;AACA2qC,QAAAA,QAAQ,CAACsB,UAAD,EAAa,SAAb,EAAwBnkC,IAAI,CAAC/H,OAA7B,EAAsC,CAAtC,CAAR;AACAwQ,QAAAA,MAAM,CAAC66B,EAAD,EAAKa,UAAL,CAAN;AACD,OALG,CAAJ;AAMA,aAAOb,EAAP;AACD,KATS,CAAV;AAUD,GAXD;;AAaA,MAAIc,SAAS,GAAG,UAAU1sC,IAAV,EAAgBwD,KAAhB,EAAuB;AACrC,WAAOxT,GAAG,CAACgQ,IAAD,EAAO,UAAUI,GAAV,EAAe;AAC9B,aAAOwK,OAAO,CAACxK,GAAD,EAAMoD,KAAN,CAAd;AACD,KAFS,CAAV;AAGD,GAJD;;AAKA,MAAImpC,MAAM,GAAG,UAAU3sC,IAAV,EAAgBwD,KAAhB,EAAuB;AAClC,WAAOxD,IAAI,CAACwD,KAAD,CAAX;AACD,GAFD;;AAGA,MAAIopC,QAAQ,GAAG,UAAUh7C,EAAV,EAAci7C,IAAd,EAAoB;AACjC,QAAIj7C,EAAE,CAACpE,MAAH,KAAc,CAAlB,EAAqB;AACnB,aAAO,CAAP;AACD;;AACD,QAAI2iB,KAAK,GAAGve,EAAE,CAAC,CAAD,CAAd;AACA,QAAI4R,KAAK,GAAG1Q,SAAS,CAAClB,EAAD,EAAK,UAAUnG,CAAV,EAAa;AACrC,aAAO,CAACohD,IAAI,CAAC18B,KAAK,CAAChT,OAAP,EAAgB1R,CAAC,CAAC0R,OAAlB,CAAZ;AACD,KAFoB,CAArB;AAGA,WAAOqG,KAAK,CAACnU,IAAN,CAAW,YAAY;AAC5B,aAAOuC,EAAE,CAACpE,MAAV;AACD,KAFM,EAEJ,UAAUinB,GAAV,EAAe;AAChB,aAAOA,GAAP;AACD,KAJM,CAAP;AAKD,GAbD;;AAcA,MAAIq4B,OAAO,GAAG,UAAU9sC,IAAV,EAAgBI,GAAhB,EAAqBC,MAArB,EAA6BjN,UAA7B,EAAyC;AACrD,QAAI25C,SAAS,GAAGJ,MAAM,CAAC3sC,IAAD,EAAOI,GAAP,CAAN,CAAkBU,KAAlB,CAAwB1P,KAAxB,CAA8BiP,MAA9B,CAAhB;AACA,QAAI2sC,WAAW,GAAGJ,QAAQ,CAACG,SAAD,EAAY35C,UAAZ,CAA1B;AACA,QAAI65C,YAAY,GAAGP,SAAS,CAAC1sC,IAAD,EAAOK,MAAP,CAAT,CAAwBjP,KAAxB,CAA8BgP,GAA9B,CAAnB;AACA,QAAI8sC,WAAW,GAAGN,QAAQ,CAACK,YAAD,EAAe75C,UAAf,CAA1B;AACA,WAAO;AACLoN,MAAAA,OAAO,EAAEwsC,WADJ;AAELzsC,MAAAA,OAAO,EAAE2sC;AAFJ,KAAP;AAID,GATD;;AAWA,MAAIC,SAAS,GAAG,UAAUntC,IAAV,EAAgB5M,UAAhB,EAA4B;AAC1C,QAAIg6C,IAAI,GAAGp9C,GAAG,CAACgQ,IAAD,EAAO,UAAUI,GAAV,EAAe;AAClC,aAAOpQ,GAAG,CAACoQ,GAAG,CAACU,KAAL,EAAYpS,KAAZ,CAAV;AACD,KAFa,CAAd;;AAGA,QAAI2+C,UAAU,GAAG,UAAUzkB,QAAV,EAAoBxc,WAApB,EAAiC7L,OAAjC,EAA0CC,OAA1C,EAAmD;AAClE,WAAK,IAAIJ,GAAG,GAAGwoB,QAAf,EAAyBxoB,GAAG,GAAGwoB,QAAQ,GAAGroB,OAA1C,EAAmDH,GAAG,EAAtD,EAA0D;AACxD,aAAK,IAAIC,MAAM,GAAG+L,WAAlB,EAA+B/L,MAAM,GAAG+L,WAAW,GAAG5L,OAAtD,EAA+DH,MAAM,EAArE,EAAyE;AACvE+sC,UAAAA,IAAI,CAAChtC,GAAD,CAAJ,CAAUC,MAAV,IAAoB,IAApB;AACD;AACF;AACF,KAND;;AAOA,WAAOrQ,GAAG,CAACgQ,IAAD,EAAO,UAAUI,GAAV,EAAewoB,QAAf,EAAyB;AACxC,UAAIxnB,OAAO,GAAGlR,IAAI,CAACkQ,GAAG,CAACU,KAAL,EAAY,UAAUwH,IAAV,EAAgB8D,WAAhB,EAA6B;AACzD,YAAIghC,IAAI,CAACxkB,QAAD,CAAJ,CAAexc,WAAf,MAAgC,KAApC,EAA2C;AACzC,cAAIlH,MAAM,GAAG4nC,OAAO,CAAC9sC,IAAD,EAAO4oB,QAAP,EAAiBxc,WAAjB,EAA8BhZ,UAA9B,CAApB;AACAi6C,UAAAA,UAAU,CAACzkB,QAAD,EAAWxc,WAAX,EAAwBlH,MAAM,CAAC3E,OAA/B,EAAwC2E,MAAM,CAAC1E,OAA/C,CAAV;AACA,iBAAO,CAACC,SAAS,CAAC6H,IAAI,CAACnL,OAAN,EAAe+H,MAAM,CAAC3E,OAAtB,EAA+B2E,MAAM,CAAC1E,OAAtC,EAA+C8H,IAAI,CAAC5H,KAApD,CAAV,CAAP;AACD,SAJD,MAIO;AACL,iBAAO,EAAP;AACD;AACF,OARiB,CAAlB;AASA,aAAOS,UAAU,CAACC,OAAD,EAAUhB,GAAG,CAACW,OAAd,CAAjB;AACD,KAXS,CAAV;AAYD,GAvBD;;AAwBA,MAAIusC,MAAM,GAAG,UAAU3hC,SAAV,EAAqB+iB,UAArB,EAAiChuB,KAAjC,EAAwC;AACnD,QAAIV,IAAI,GAAG,EAAX;;AACA,QAAI6N,SAAS,CAACF,UAAV,CAAqBhC,SAArB,CAAJ,EAAqC;AACnC,UAAI4hC,eAAe,GAAGv9C,GAAG,CAAC6d,SAAS,CAACH,WAAV,CAAsB/B,SAAtB,CAAD,EAAmC,UAAUtL,MAAV,EAAkB;AAC5E,eAAOW,UAAU,CAACX,MAAM,CAAClD,OAAR,EAAiBuD,KAAjB,EAAwB,KAAxB,CAAjB;AACD,OAFwB,CAAzB;AAGAV,MAAAA,IAAI,CAACxO,IAAL,CAAU0P,QAAQ,CAACqsC,eAAD,EAAkB,UAAlB,CAAlB;AACD;;AACD,SAAK,IAAI3kB,QAAQ,GAAG,CAApB,EAAuBA,QAAQ,GAAGjd,SAAS,CAAC3L,IAAV,CAAeC,IAAjD,EAAuD2oB,QAAQ,EAA/D,EAAmE;AACjE,UAAI4kB,QAAQ,GAAG,EAAf;;AACA,WAAK,IAAIphC,WAAW,GAAG,CAAvB,EAA0BA,WAAW,GAAGT,SAAS,CAAC3L,IAAV,CAAeE,OAAvD,EAAgEkM,WAAW,EAA3E,EAA+E;AAC7E,YAAIjP,OAAO,GAAG0Q,SAAS,CAACnC,KAAV,CAAgBC,SAAhB,EAA2Bid,QAA3B,EAAqCxc,WAArC,EAAkDpc,GAAlD,CAAsD,UAAU8b,IAAV,EAAgB;AAClF,iBAAO9K,UAAU,CAAC8K,IAAI,CAAC3O,OAAN,EAAeuD,KAAf,EAAsBoL,IAAI,CAAClL,QAA3B,CAAjB;AACD,SAFa,EAEXlR,UAFW,CAEA,YAAY;AACxB,iBAAOsR,UAAU,CAAC0tB,UAAU,CAAC1C,GAAX,EAAD,EAAmB,IAAnB,EAAyB,KAAzB,CAAjB;AACD,SAJa,CAAd;AAKAwhB,QAAAA,QAAQ,CAACh8C,IAAT,CAAc2L,OAAd;AACD;;AACD,UAAIiD,GAAG,GAAGc,QAAQ,CAACssC,QAAD,EAAW7hC,SAAS,CAACxd,GAAV,CAAcy6B,QAAd,EAAwB7nB,OAAnC,CAAlB;AACAf,MAAAA,IAAI,CAACxO,IAAL,CAAU4O,GAAV;AACD;;AACD,WAAOJ,IAAP;AACD,GAtBD;;AAwBA,MAAIytC,aAAa,GAAG,UAAU9hC,SAAV,EAAqB+iB,UAArB,EAAiC;AACnD,WAAO4e,MAAM,CAAC3hC,SAAD,EAAY+iB,UAAZ,EAAwB,KAAxB,CAAb;AACD,GAFD;;AAGA,MAAIgf,UAAU,GAAG,UAAUC,QAAV,EAAoBjf,UAApB,EAAgC;AAC/C,QAAIkf,OAAO,GAAG,UAAUxsC,OAAV,EAAmB;AAC/B,UAAIysC,UAAU,GAAGp6C,OAAO,CAAC2N,OAAD,EAAU,UAAUd,MAAV,EAAkB;AAClD,eAAOqC,MAAM,CAACrC,MAAM,CAACnD,OAAR,CAAN,CAAuBnN,GAAvB,CAA2B,UAAUoQ,GAAV,EAAe;AAC/C,cAAIM,KAAK,GAAGiC,MAAM,CAACvC,GAAD,CAAN,CAAYrR,MAAZ,EAAZ;AACA,iBAAOiS,UAAU,CAACZ,GAAD,EAAMM,KAAN,EAAa,KAAb,CAAjB;AACD,SAHM,CAAP;AAID,OALuB,CAAxB;AAMA,aAAOmtC,UAAU,CAACn+C,UAAX,CAAsB,YAAY;AACvC,eAAOsR,UAAU,CAAC0tB,UAAU,CAACtuB,GAAX,EAAD,EAAmB,IAAnB,EAAyB,KAAzB,CAAjB;AACD,OAFM,CAAP;AAGD,KAVD;;AAWA,WAAOpQ,GAAG,CAAC29C,QAAD,EAAW,UAAUvsC,OAAV,EAAmB;AACtC,UAAIhB,GAAG,GAAGwtC,OAAO,CAACxsC,OAAO,CAACA,OAAT,CAAjB;AACA,aAAOH,UAAU,CAACb,GAAG,CAACjD,OAAL,EAAciE,OAAO,CAACA,OAAtB,EAA+BA,OAAO,CAACL,OAAvC,EAAgDX,GAAG,CAACM,KAApD,CAAjB;AACD,KAHS,CAAV;AAID,GAhBD;;AAiBA,MAAIotC,YAAY,GAAG,UAAU9tC,IAAV,EAAgB0uB,UAAhB,EAA4B;AAC7C,QAAIif,QAAQ,GAAGR,SAAS,CAACntC,IAAD,EAAOhC,IAAP,CAAxB;AACA,WAAO0vC,UAAU,CAACC,QAAD,EAAWjf,UAAX,CAAjB;AACD,GAHD;;AAIA,MAAIqf,eAAe,GAAG,UAAUpiC,SAAV,EAAqBxO,OAArB,EAA8B;AAClD,WAAO1J,OAAO,CAACkY,SAAS,CAACxd,GAAX,EAAgB,UAAU+D,CAAV,EAAa;AACzC,aAAOW,IAAI,CAACX,CAAC,CAAC4O,KAAH,EAAU,UAAUuB,CAAV,EAAa;AAChC,eAAOrE,IAAI,CAACb,OAAD,EAAUkF,CAAC,CAAClF,OAAZ,CAAX;AACD,OAFU,CAAX;AAGD,KAJa,CAAd;AAKD,GAND;;AAOA,MAAI6wC,YAAY,GAAG,UAAUriC,SAAV,EAAqB1T,MAArB,EAA6B8M,SAA7B,EAAwC;AACzD,QAAI3D,OAAO,GAAGpR,GAAG,CAACiI,MAAM,CAACm1B,SAAR,EAAmB,UAAU6gB,MAAV,EAAkB;AACpD,aAAO3lC,IAAI,CAAC2lC,MAAD,CAAJ,CAAa/9C,IAAb,CAAkB,UAAUg+C,EAAV,EAAc;AACrC,eAAOH,eAAe,CAACpiC,SAAD,EAAYuiC,EAAZ,CAAtB;AACD,OAFM,EAEJ79C,MAFI,CAEG0U,SAFH,CAAP;AAGD,KAJgB,CAAjB;AAKA,QAAIjE,KAAK,GAAG+Y,GAAG,CAACzY,OAAD,CAAf;AACA,WAAO8Y,MAAM,CAACpZ,KAAK,CAACtT,MAAN,GAAe,CAAhB,EAAmBsT,KAAnB,CAAb;AACD,GARD;;AASA,MAAIqtC,GAAG,GAAG,UAAUC,SAAV,EAAqB3kB,OAArB,EAA8B4kB,UAA9B,EAA0CC,UAA1C,EAAsDC,WAAtD,EAAmE;AAC3E,WAAO,UAAUnN,IAAV,EAAgB53B,KAAhB,EAAuBvR,MAAvB,EAA+By2B,UAA/B,EAA2C8f,MAA3C,EAAmDxb,eAAnD,EAAoE;AACzE,UAAIrnB,SAAS,GAAGkC,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAhB;AACA,UAAI8tB,MAAM,GAAG7N,OAAO,CAAC9d,SAAD,EAAY1T,MAAZ,CAAP,CAA2BjI,GAA3B,CAA+B,UAAU4I,IAAV,EAAgB;AAC1D,YAAI61C,KAAK,GAAGhB,aAAa,CAAC9hC,SAAD,EAAY+iB,UAAZ,CAAzB;AACA,YAAIxpB,MAAM,GAAGkpC,SAAS,CAACK,KAAD,EAAQ71C,IAAR,EAAcoF,IAAd,EAAoBuwC,WAAW,CAAC7f,UAAD,CAA/B,CAAtB;AACA,YAAIjiB,aAAa,GAAGpB,wBAAwB,CAACnG,MAAM,CAAClF,IAAR,CAA5C;AACA,YAAIA,IAAI,GAAG8tC,YAAY,CAAC5oC,MAAM,CAAClF,IAAR,EAAc0uB,UAAd,CAAvB;AACA,eAAO;AACL91B,UAAAA,IAAI,EAAEA,IADD;AAELoH,UAAAA,IAAI,EAAEA,IAFD;AAGL0uC,UAAAA,MAAM,EAAExpC,MAAM,CAACwpC,MAHV;AAILjiC,UAAAA,aAAa,EAAEA;AAJV,SAAP;AAMD,OAXY,CAAb;AAYA,aAAO6qB,MAAM,CAACpnC,IAAP,CAAY,UAAUy+C,GAAV,EAAe;AAChC,YAAIC,WAAW,GAAGpD,MAAM,CAAChiC,KAAD,EAAQmlC,GAAG,CAAC3uC,IAAZ,CAAxB;AACA,YAAIyoC,WAAW,GAAGv3C,QAAQ,CAACD,IAAT,CAAcu9C,MAAd,EAAsB9+C,UAAtB,CAAiC,YAAY;AAC7D,iBAAOi4B,SAAS,CAACD,YAAV,CAAuBle,KAAvB,CAAP;AACD,SAFiB,CAAlB;AAGA,YAAIyoB,QAAQ,GAAG/gC,QAAQ,CAACD,IAAT,CAAc+hC,eAAd,EAA+BtjC,UAA/B,CAA0CilC,aAA1C,CAAf;AACA0Z,QAAAA,UAAU,CAAC7kC,KAAD,EAAQmlC,GAAG,CAAC3uC,IAAZ,EAAkB2uC,GAAG,CAAC/1C,IAAtB,EAA4B6vC,WAA5B,EAAyCxW,QAAzC,CAAV;AACAqc,QAAAA,UAAU,CAAC9kC,KAAD,CAAV;AACA+4B,QAAAA,OAAO,CAACnB,IAAD,EAAO53B,KAAP,CAAP;AACA9C,QAAAA,MAAM,CAAC8C,KAAD,EAAQyB,eAAR,CAAN;;AACA,YAAI0jC,GAAG,CAACliC,aAAJ,CAAkBjf,MAAlB,GAA2B,CAA/B,EAAkC;AAChC4Y,UAAAA,GAAG,CAACoD,KAAD,EAAQyB,eAAR,EAAyB0jC,GAAG,CAACliC,aAAJ,CAAkBpD,IAAlB,CAAuB,GAAvB,CAAzB,CAAH;AACD;;AACD,eAAOnY,QAAQ,CAACR,IAAT,CAAc;AACnBg+C,UAAAA,MAAM,EAAEC,GAAG,CAACD,MADO;AAEnBjD,UAAAA,OAAO,EAAEmD,WAAW,CAACnD,OAFF;AAGnBlhC,UAAAA,QAAQ,EAAEqkC,WAAW,CAACrkC;AAHH,SAAd,CAAP;AAKD,OAlBM,CAAP;AAmBD,KAjCD;AAkCD,GAnCD;;AAoCA,MAAIskC,MAAM,GAAG,UAAUljC,SAAV,EAAqB1T,MAArB,EAA6B;AACxC,WAAOqQ,IAAI,CAACrQ,MAAM,CAACkF,OAAR,CAAJ,CAAqBjN,IAArB,CAA0B,UAAUoY,IAAV,EAAgB;AAC/C,aAAOylC,eAAe,CAACpiC,SAAD,EAAYrD,IAAZ,CAAtB;AACD,KAFM,CAAP;AAGD,GAJD;;AAKA,MAAIwmC,OAAO,GAAG,UAAUnjC,SAAV,EAAqB1T,MAArB,EAA6B;AACzC,WAAOqQ,IAAI,CAACrQ,MAAM,CAACkF,OAAR,CAAJ,CAAqBjN,IAArB,CAA0B,UAAUoY,IAAV,EAAgB;AAC/C,aAAOylC,eAAe,CAACpiC,SAAD,EAAYrD,IAAZ,CAAf,CAAiCtY,GAAjC,CAAqC,UAAUoR,OAAV,EAAmB;AAC7D,YAAIjV,KAAK,GAAGuH,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK0N,OAAL,CAAT,EAAwB;AAC1CstB,UAAAA,UAAU,EAAEz2B,MAAM,CAACy2B,UADuB;AAE1CD,UAAAA,SAAS,EAAEx2B,MAAM,CAACw2B;AAFwB,SAAxB,CAApB;;AAIA,eAAOtiC,KAAP;AACD,OANM,CAAP;AAOD,KARM,CAAP;AASD,GAVD;;AAWA,MAAI4iD,eAAe,GAAG,UAAUpjC,SAAV,EAAqB1T,MAArB,EAA6B;AACjD,WAAO+1C,YAAY,CAACriC,SAAD,EAAY1T,MAAZ,EAAoBtJ,MAApB,CAAZ,CAAwCqB,GAAxC,CAA4C,UAAU8Q,KAAV,EAAiB;AAClE,aAAO;AACLA,QAAAA,KAAK,EAAEA,KADF;AAEL4tB,QAAAA,UAAU,EAAEz2B,MAAM,CAACy2B,UAFd;AAGLD,QAAAA,SAAS,EAAEx2B,MAAM,CAACw2B;AAHb,OAAP;AAKD,KANM,CAAP;AAOD,GARD;;AASA,MAAIugB,UAAU,GAAG,UAAUC,UAAV,EAAsBh3C,MAAtB,EAA8B;AAC7C,WAAOA,MAAM,CAACw1B,QAAd;AACD,GAFD;;AAGA,MAAIyhB,YAAY,GAAG,UAAUD,UAAV,EAAsBh3C,MAAtB,EAA8B;AAC/C,WAAOA,MAAM,CAACq1B,UAAd;AACD,GAFD;;AAGA,MAAI6hB,OAAO,GAAG,UAAUxjC,SAAV,EAAqB1T,MAArB,EAA6B;AACzC,WAAO+1C,YAAY,CAACriC,SAAD,EAAY1T,MAAZ,EAAoBtJ,MAApB,CAAnB;AACD,GAFD;;AAGA,MAAIygD,cAAc,GAAG,UAAUzjC,SAAV,EAAqB1T,MAArB,EAA6B;AAChD,WAAO42C,MAAM,CAACljC,SAAD,EAAY1T,MAAZ,CAAN,CAA0B5H,MAA1B,CAAiC,UAAUiQ,MAAV,EAAkB;AACxD,aAAO,CAACA,MAAM,CAACM,QAAf;AACD,KAFM,CAAP;AAGD,GAJD;;AAKA,MAAIyuC,eAAe,GAAG,UAAU1jC,SAAV,EAAqB1T,MAArB,EAA6B;AACjD,WAAO+1C,YAAY,CAACriC,SAAD,EAAY1T,MAAZ,EAAoB,UAAUqI,MAAV,EAAkB;AACvD,aAAO,CAACA,MAAM,CAACM,QAAf;AACD,KAFkB,CAAnB;AAGD,GAJD;;AAKA,MAAI0uC,mBAAmB,GAAG,UAAU3jC,SAAV,EAAqBrD,IAArB,EAA2B;AACnD,WAAOylC,eAAe,CAACpiC,SAAD,EAAYrD,IAAZ,CAAf,CAAiCnY,MAAjC,CAAwC,UAAUmQ,MAAV,EAAkB;AAC/D,aAAO,CAACA,MAAM,CAACM,QAAf;AACD,KAFM,CAAP;AAGD,GAJD;;AAKA,MAAI2uC,WAAW,GAAG,UAAU5jC,SAAV,EAAqB7K,KAArB,EAA4B;AAC5C,WAAO1Q,MAAM,CAAC0Q,KAAD,EAAQ,UAAUwH,IAAV,EAAgB;AACnC,aAAOgnC,mBAAmB,CAAC3jC,SAAD,EAAYrD,IAAZ,CAA1B;AACD,KAFY,CAAb;AAGD,GAJD;;AAKA,MAAIknC,kBAAkB,GAAG,UAAU7jC,SAAV,EAAqB1T,MAArB,EAA6B;AACpD,WAAO+2C,UAAU,CAACrjC,SAAD,EAAY1T,MAAZ,CAAV,CAA8B5H,MAA9B,CAAqC,UAAUo/C,SAAV,EAAqB;AAC/D,aAAOF,WAAW,CAAC5jC,SAAD,EAAY8jC,SAAS,CAAC3uC,KAAtB,CAAlB;AACD,KAFM,CAAP;AAGD,GAJD;;AAKA,MAAI4uC,oBAAoB,GAAG,UAAU/jC,SAAV,EAAqB1T,MAArB,EAA6B;AACtD,WAAOi3C,YAAY,CAACvjC,SAAD,EAAY1T,MAAZ,CAAZ,CAAgC5H,MAAhC,CAAuC,UAAUyQ,KAAV,EAAiB;AAC7D,aAAOyuC,WAAW,CAAC5jC,SAAD,EAAY7K,KAAZ,CAAlB;AACD,KAFM,CAAP;AAGD,GAJD;;AAMA,MAAI6uC,KAAK,GAAG,UAAU3vC,IAAV,EAAgBqB,MAAhB,EAAwBjO,UAAxB,EAAoCw8C,YAApC,EAAkD;AAC5D,QAAI3vC,IAAI,GAAG8K,kBAAkB,CAAC/K,IAAD,CAAlB,CAAyBC,IAApC;;AACA,QAAIA,IAAI,CAACzS,MAAL,KAAgB,CAApB,EAAuB;AACrB,aAAOwS,IAAP;AACD;;AACD,SAAK,IAAIlO,CAAC,GAAGuP,MAAM,CAACC,QAApB,EAA8BxP,CAAC,IAAIuP,MAAM,CAACG,SAA1C,EAAqD1P,CAAC,EAAtD,EAA0D;AACxD,WAAK,IAAIoC,CAAC,GAAGmN,MAAM,CAACE,QAApB,EAA8BrN,CAAC,IAAImN,MAAM,CAACI,SAA1C,EAAqDvN,CAAC,EAAtD,EAA0D;AACxD,YAAIkM,GAAG,GAAGH,IAAI,CAACnO,CAAD,CAAd;AACA,YAAI8O,QAAQ,GAAGgK,OAAO,CAACxK,GAAD,EAAMlM,CAAN,CAAP,CAAgB0M,QAA/B;AACA8J,QAAAA,UAAU,CAACtK,GAAD,EAAMlM,CAAN,EAAS8M,UAAU,CAAC4uC,YAAY,EAAb,EAAiB,KAAjB,EAAwBhvC,QAAxB,CAAnB,CAAV;AACD;AACF;;AACD,WAAOZ,IAAP;AACD,GAbD;;AAcA,MAAI6vC,OAAO,GAAG,UAAU7vC,IAAV,EAAgB/H,MAAhB,EAAwB7E,UAAxB,EAAoCw8C,YAApC,EAAkD;AAC9D,QAAI3vC,IAAI,GAAG8K,kBAAkB,CAAC/K,IAAD,CAAlB,CAAyBC,IAApC;AACA,QAAIkQ,KAAK,GAAG,IAAZ;;AACA,SAAK,IAAIre,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmO,IAAI,CAACzS,MAAzB,EAAiCsE,CAAC,EAAlC,EAAsC;AACpC,WAAK,IAAIoC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG4W,UAAU,CAAC7K,IAAI,CAAC,CAAD,CAAL,CAA9B,EAAyC/L,CAAC,EAA1C,EAA8C;AAC5C,YAAIkM,GAAG,GAAGH,IAAI,CAACnO,CAAD,CAAd;AACA,YAAIg+C,WAAW,GAAGllC,OAAO,CAACxK,GAAD,EAAMlM,CAAN,CAAzB;AACA,YAAI67C,cAAc,GAAGD,WAAW,CAAC3yC,OAAjC;AACA,YAAI6yC,WAAW,GAAG58C,UAAU,CAAC28C,cAAD,EAAiB93C,MAAjB,CAA5B;;AACA,YAAI+3C,WAAW,KAAK,IAAhB,IAAwB7/B,KAAK,KAAK,KAAtC,EAA6C;AAC3CzF,UAAAA,UAAU,CAACtK,GAAD,EAAMlM,CAAN,EAAS8M,UAAU,CAAC4uC,YAAY,EAAb,EAAiB,IAAjB,EAAuBE,WAAW,CAAClvC,QAAnC,CAAnB,CAAV;AACD,SAFD,MAEO,IAAIovC,WAAW,KAAK,IAApB,EAA0B;AAC/B7/B,UAAAA,KAAK,GAAG,KAAR;AACD;AACF;AACF;;AACD,WAAOnQ,IAAP;AACD,GAjBD;;AAkBA,MAAIiwC,WAAW,GAAG,UAAU7vC,GAAV,EAAehN,UAAf,EAA2B;AAC3C,WAAOV,KAAK,CAAC0N,GAAD,EAAM,UAAU2b,IAAV,EAAgBzT,IAAhB,EAAsB;AACtC,aAAOnY,MAAM,CAAC4rB,IAAD,EAAO,UAAU+zB,WAAV,EAAuB;AACzC,eAAO18C,UAAU,CAAC08C,WAAW,CAAC3yC,OAAb,EAAsBmL,IAAI,CAACnL,OAA3B,CAAjB;AACD,OAFY,CAAN,GAEF4e,IAFE,GAEKA,IAAI,CAAC3tB,MAAL,CAAY,CAACka,IAAD,CAAZ,CAFZ;AAGD,KAJW,EAIT,EAJS,CAAZ;AAKD,GAND;;AAOA,MAAI4nC,SAAS,GAAG,UAAUlwC,IAAV,EAAgBwD,KAAhB,EAAuBpQ,UAAvB,EAAmCw8C,YAAnC,EAAiD;AAC/D,QAAIpsC,KAAK,GAAG,CAAR,IAAaA,KAAK,GAAGxD,IAAI,CAAC,CAAD,CAAJ,CAAQc,KAAR,CAActT,MAAvC,EAA+C;AAC7CyC,MAAAA,IAAI,CAAC+P,IAAD,EAAO,UAAUI,GAAV,EAAe;AACxB,YAAI+vC,QAAQ,GAAG/vC,GAAG,CAACU,KAAJ,CAAU0C,KAAK,GAAG,CAAlB,CAAf;AACA,YAAIzM,OAAO,GAAGqJ,GAAG,CAACU,KAAJ,CAAU0C,KAAV,CAAd;AACA,YAAIwsC,WAAW,GAAG58C,UAAU,CAAC2D,OAAO,CAACoG,OAAT,EAAkBgzC,QAAQ,CAAChzC,OAA3B,CAA5B;;AACA,YAAI6yC,WAAJ,EAAiB;AACftlC,UAAAA,UAAU,CAACtK,GAAD,EAAMoD,KAAN,EAAaxC,UAAU,CAAC4uC,YAAY,EAAb,EAAiB,IAAjB,EAAuB74C,OAAO,CAAC6J,QAA/B,CAAvB,CAAV;AACD;AACF,OAPG,CAAJ;AAQD;;AACD,WAAOZ,IAAP;AACD,GAZD;;AAaA,MAAIowC,SAAS,GAAG,UAAUpwC,IAAV,EAAgBwD,KAAhB,EAAuBpQ,UAAvB,EAAmCw8C,YAAnC,EAAiD;AAC/D,QAAI3vC,IAAI,GAAG8K,kBAAkB,CAAC/K,IAAD,CAAlB,CAAyBC,IAApC;;AACA,QAAIuD,KAAK,GAAG,CAAR,IAAaA,KAAK,GAAGvD,IAAI,CAACzS,MAA9B,EAAsC;AACpC,UAAI6iD,YAAY,GAAGpwC,IAAI,CAACuD,KAAK,GAAG,CAAT,CAAJ,CAAgB1C,KAAnC;AACA,UAAIA,KAAK,GAAGmvC,WAAW,CAACI,YAAD,EAAej9C,UAAf,CAAvB;AACAnD,MAAAA,IAAI,CAAC6Q,KAAD,EAAQ,UAAUwH,IAAV,EAAgB;AAC1B,YAAIgoC,WAAW,GAAGp/C,QAAQ,CAACtC,IAAT,EAAlB;;AACA,aAAK,IAAIkD,CAAC,GAAG0R,KAAb,EAAoB1R,CAAC,GAAGmO,IAAI,CAACzS,MAA7B,EAAqCsE,CAAC,EAAtC,EAA0C;AACxC,cAAIy+C,OAAO,GAAG,UAAUr8C,CAAV,EAAa;AACzB,gBAAIkM,GAAG,GAAGH,IAAI,CAACnO,CAAD,CAAd;AACA,gBAAIiF,OAAO,GAAG6T,OAAO,CAACxK,GAAD,EAAMlM,CAAN,CAArB;AACA,gBAAI87C,WAAW,GAAG58C,UAAU,CAAC2D,OAAO,CAACoG,OAAT,EAAkBmL,IAAI,CAACnL,OAAvB,CAA5B;;AACA,gBAAI6yC,WAAJ,EAAiB;AACf,kBAAIM,WAAW,CAACvhD,MAAZ,EAAJ,EAA0B;AACxBuhD,gBAAAA,WAAW,GAAGp/C,QAAQ,CAACR,IAAT,CAAck/C,YAAY,EAA1B,CAAd;AACD;;AACDU,cAAAA,WAAW,CAACrgD,IAAZ,CAAiB,UAAUugD,GAAV,EAAe;AAC9B9lC,gBAAAA,UAAU,CAACtK,GAAD,EAAMlM,CAAN,EAAS8M,UAAU,CAACwvC,GAAD,EAAM,IAAN,EAAYz5C,OAAO,CAAC6J,QAApB,CAAnB,CAAV;AACD,eAFD;AAGD;AACF,WAZD;;AAaA,eAAK,IAAI1M,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG4W,UAAU,CAAC7K,IAAI,CAAC,CAAD,CAAL,CAA9B,EAAyC/L,CAAC,EAA1C,EAA8C;AAC5Cq8C,YAAAA,OAAO,CAACr8C,CAAD,CAAP;AACD;AACF;AACF,OApBG,CAAJ;AAqBD;;AACD,WAAO8L,IAAP;AACD,GA5BD;;AA8BA,MAAI7T,KAAK,GAAG,UAAU2C,CAAV,EAAa;AACvB,QAAIS,EAAE,GAAG,UAAUuB,CAAV,EAAa;AACpB,aAAOhC,CAAC,KAAKgC,CAAb;AACD,KAFD;;AAGA,QAAIhB,EAAE,GAAG,UAAU2gD,IAAV,EAAgB;AACvB,aAAOtkD,KAAK,CAAC2C,CAAD,CAAZ;AACD,KAFD;;AAGA,QAAIiB,OAAO,GAAG,UAAU2gD,EAAV,EAAc;AAC1B,aAAOvkD,KAAK,CAAC2C,CAAD,CAAZ;AACD,KAFD;;AAGA,QAAIkB,GAAG,GAAG,UAAU1B,CAAV,EAAa;AACrB,aAAOnC,KAAK,CAACmC,CAAC,CAACQ,CAAD,CAAF,CAAZ;AACD,KAFD;;AAGA,QAAI6hD,QAAQ,GAAG,UAAUD,EAAV,EAAc;AAC3B,aAAOvkD,KAAK,CAAC2C,CAAD,CAAZ;AACD,KAFD;;AAGA,QAAImB,IAAI,GAAG,UAAU3B,CAAV,EAAa;AACtBA,MAAAA,CAAC,CAACQ,CAAD,CAAD;AACD,KAFD;;AAGA,QAAIoB,IAAI,GAAG,UAAU5B,CAAV,EAAa;AACtB,aAAOA,CAAC,CAACQ,CAAD,CAAR;AACD,KAFD;;AAGA,QAAIO,IAAI,GAAG,UAAUuhD,CAAV,EAAaC,OAAb,EAAsB;AAC/B,aAAOA,OAAO,CAAC/hD,CAAD,CAAd;AACD,KAFD;;AAGA,QAAIqB,MAAM,GAAG,UAAU7B,CAAV,EAAa;AACxB,aAAOA,CAAC,CAACQ,CAAD,CAAR;AACD,KAFD;;AAGA,QAAIsB,MAAM,GAAG,UAAU9B,CAAV,EAAa;AACxB,aAAOA,CAAC,CAACQ,CAAD,CAAR;AACD,KAFD;;AAGA,QAAIgiD,UAAU,GAAG,YAAY;AAC3B,aAAO5/C,QAAQ,CAACR,IAAT,CAAc5B,CAAd,CAAP;AACD,KAFD;;AAGA,WAAO;AACLS,MAAAA,EAAE,EAAEA,EADC;AAELwhD,MAAAA,OAAO,EAAEpiD,MAFJ;AAGLqiD,MAAAA,OAAO,EAAEtiD,KAHJ;AAILe,MAAAA,KAAK,EAAE5B,QAAQ,CAACiB,CAAD,CAJV;AAKLY,MAAAA,UAAU,EAAE7B,QAAQ,CAACiB,CAAD,CALf;AAMLa,MAAAA,QAAQ,EAAE9B,QAAQ,CAACiB,CAAD,CANb;AAOLgB,MAAAA,EAAE,EAAEA,EAPC;AAQLC,MAAAA,OAAO,EAAEA,OARJ;AASLV,MAAAA,IAAI,EAAEA,IATD;AAULW,MAAAA,GAAG,EAAEA,GAVA;AAWL2gD,MAAAA,QAAQ,EAAEA,QAXL;AAYL1gD,MAAAA,IAAI,EAAEA,IAZD;AAaLC,MAAAA,IAAI,EAAEA,IAbD;AAcLC,MAAAA,MAAM,EAAEA,MAdH;AAeLC,MAAAA,MAAM,EAAEA,MAfH;AAgBL0gD,MAAAA,UAAU,EAAEA;AAhBP,KAAP;AAkBD,GApDD;;AAqDA,MAAIz0C,KAAK,GAAG,UAAU40C,OAAV,EAAmB;AAC7B,QAAIvhD,UAAU,GAAG,UAAUpB,CAAV,EAAa;AAC5B,aAAOA,CAAC,EAAR;AACD,KAFD;;AAGA,QAAIqB,QAAQ,GAAG,YAAY;AACzB,aAAOpB,GAAG,CAACvC,MAAM,CAACilD,OAAD,CAAP,CAAH,EAAP;AACD,KAFD;;AAGA,QAAInhD,EAAE,GAAG,UAAUswB,GAAV,EAAe;AACtB,aAAOA,GAAP;AACD,KAFD;;AAGA,QAAIrwB,OAAO,GAAG,UAAUzB,CAAV,EAAa;AACzB,aAAOA,CAAC,EAAR;AACD,KAFD;;AAGA,QAAI0B,GAAG,GAAG,UAAU0gD,EAAV,EAAc;AACtB,aAAOr0C,KAAK,CAAC40C,OAAD,CAAZ;AACD,KAFD;;AAGA,QAAIN,QAAQ,GAAG,UAAUriD,CAAV,EAAa;AAC1B,aAAO+N,KAAK,CAAC/N,CAAC,CAAC2iD,OAAD,CAAF,CAAZ;AACD,KAFD;;AAGA,QAAI/gD,IAAI,GAAG,UAAUwgD,EAAV,EAAc;AACvB,aAAOr0C,KAAK,CAAC40C,OAAD,CAAZ;AACD,KAFD;;AAGA,QAAI5hD,IAAI,GAAG,UAAU6hD,OAAV,EAAmBN,CAAnB,EAAsB;AAC/B,aAAOM,OAAO,CAACD,OAAD,CAAd;AACD,KAFD;;AAGA,WAAO;AACL1hD,MAAAA,EAAE,EAAEb,KADC;AAELqiD,MAAAA,OAAO,EAAEriD,KAFJ;AAGLsiD,MAAAA,OAAO,EAAEriD,MAHJ;AAILc,MAAAA,KAAK,EAAE3B,QAJF;AAKL4B,MAAAA,UAAU,EAAEA,UALP;AAMLC,MAAAA,QAAQ,EAAEA,QANL;AAOLG,MAAAA,EAAE,EAAEA,EAPC;AAQLC,MAAAA,OAAO,EAAEA,OARJ;AASLV,MAAAA,IAAI,EAAEA,IATD;AAULW,MAAAA,GAAG,EAAEA,GAVA;AAWL2gD,MAAAA,QAAQ,EAAEA,QAXL;AAYL1gD,MAAAA,IAAI,EAAEhD,IAZD;AAaLiD,MAAAA,IAAI,EAAEA,IAbD;AAcLC,MAAAA,MAAM,EAAEzB,KAdH;AAeL0B,MAAAA,MAAM,EAAEzB,MAfH;AAgBLmiD,MAAAA,UAAU,EAAE5/C,QAAQ,CAACtC;AAhBhB,KAAP;AAkBD,GA3CD;;AA4CA,MAAIuiD,UAAU,GAAG,UAAU/wB,GAAV,EAAegxB,GAAf,EAAoB;AACnC,WAAOhxB,GAAG,CAAC/wB,IAAJ,CAAS,YAAY;AAC1B,aAAOgN,KAAK,CAAC+0C,GAAD,CAAZ;AACD,KAFM,EAEJjlD,KAFI,CAAP;AAGD,GAJD;;AAKA,MAAIklD,MAAM,GAAG;AACXllD,IAAAA,KAAK,EAAEA,KADI;AAEXkQ,IAAAA,KAAK,EAAEA,KAFI;AAGX80C,IAAAA,UAAU,EAAEA;AAHD,GAAb;;AAMA,MAAIG,OAAO,GAAG,UAAUC,YAAV,EAAwBC,KAAxB,EAA+BC,KAA/B,EAAsC;AAClD,QAAIF,YAAY,CAACnxC,GAAb,IAAoBoxC,KAAK,CAAChkD,MAA1B,IAAoC+jD,YAAY,CAAClxC,MAAb,GAAsByK,UAAU,CAAC0mC,KAAK,CAAC,CAAD,CAAN,CAAxE,EAAoF;AAClF,aAAOH,MAAM,CAACh1C,KAAP,CAAa,qDAAqDk1C,YAAY,CAACnxC,GAAlE,GAAwE,YAAxE,GAAuFmxC,YAAY,CAAClxC,MAAjH,CAAP;AACD;;AACD,QAAIqxC,YAAY,GAAGF,KAAK,CAACpgD,KAAN,CAAYmgD,YAAY,CAACnxC,GAAzB,CAAnB;AACA,QAAIuxC,YAAY,GAAGD,YAAY,CAAC,CAAD,CAAZ,CAAgB5wC,KAAhB,CAAsB1P,KAAtB,CAA4BmgD,YAAY,CAAClxC,MAAzC,CAAnB;AACA,QAAIuxC,WAAW,GAAG9mC,UAAU,CAAC2mC,KAAK,CAAC,CAAD,CAAN,CAA5B;AACA,QAAII,WAAW,GAAGJ,KAAK,CAACjkD,MAAxB;AACA,WAAO6jD,MAAM,CAACllD,KAAP,CAAa;AAClB2lD,MAAAA,QAAQ,EAAEJ,YAAY,CAAClkD,MAAb,GAAsBqkD,WADd;AAElBE,MAAAA,QAAQ,EAAEJ,YAAY,CAACnkD,MAAb,GAAsBokD;AAFd,KAAb,CAAP;AAID,GAZD;;AAaA,MAAII,YAAY,GAAG,UAAUR,KAAV,EAAiBC,KAAjB,EAAwB;AACzC,QAAIQ,UAAU,GAAGnnC,UAAU,CAAC0mC,KAAK,CAAC,CAAD,CAAN,CAA3B;AACA,QAAIU,UAAU,GAAGpnC,UAAU,CAAC2mC,KAAK,CAAC,CAAD,CAAN,CAA3B;AACA,WAAO;AACLK,MAAAA,QAAQ,EAAE,CADL;AAELC,MAAAA,QAAQ,EAAEE,UAAU,GAAGC;AAFlB,KAAP;AAID,GAPD;;AAQA,MAAIC,aAAa,GAAG,UAAUX,KAAV,EAAiBC,KAAjB,EAAwB;AAC1C,QAAIW,UAAU,GAAGZ,KAAK,CAAChkD,MAAvB;AACA,QAAI6kD,UAAU,GAAGZ,KAAK,CAACjkD,MAAvB;AACA,WAAO;AACLskD,MAAAA,QAAQ,EAAEM,UAAU,GAAGC,UADlB;AAELN,MAAAA,QAAQ,EAAE;AAFL,KAAP;AAID,GAPD;;AAQA,MAAIO,gBAAgB,GAAG,UAAU5yB,MAAV,EAAkBtf,GAAlB,EAAuBsuB,UAAvB,EAAmC9tB,QAAnC,EAA6C;AAClE,QAAI2xC,SAAS,GAAGnyC,GAAG,CAACW,OAAJ,KAAgB,UAAhB,GAA6B2tB,UAAU,CAACtT,GAAxC,GAA8CsT,UAAU,CAACpmB,IAAzE;AACA,WAAOtW,KAAK,CAAC0tB,MAAD,EAAS,UAAUnU,GAAV,EAAe;AAClC,aAAOvK,UAAU,CAACuxC,SAAS,EAAV,EAAc,IAAd,EAAoB3xC,QAAQ,CAAC2K,GAAD,CAA5B,CAAjB;AACD,KAFW,CAAZ;AAGD,GALD;;AAMA,MAAIinC,OAAO,GAAG,UAAUxyC,IAAV,EAAgB0f,MAAhB,EAAwBgP,UAAxB,EAAoCjiB,aAApC,EAAmD;AAC/D,WAAOzM,IAAI,CAAC5R,MAAL,CAAY4D,KAAK,CAAC0tB,MAAD,EAAS,YAAY;AAC3C,UAAItf,GAAG,GAAGJ,IAAI,CAACA,IAAI,CAACxS,MAAL,GAAc,CAAf,CAAd;AACA,UAAI8jB,QAAQ,GAAGghC,gBAAgB,CAAClyC,GAAG,CAACU,KAAJ,CAAUtT,MAAX,EAAmB4S,GAAnB,EAAwBsuB,UAAxB,EAAoC,UAAUnjB,GAAV,EAAe;AAChF,eAAO7L,GAAG,CAAC+M,aAAD,EAAgBlB,GAAG,CAAC9a,QAAJ,EAAhB,CAAV;AACD,OAF8B,CAA/B;AAGA,aAAO+Z,QAAQ,CAACpK,GAAD,EAAMkR,QAAN,CAAf;AACD,KANuB,CAAjB,CAAP;AAOD,GARD;;AASA,MAAImhC,OAAO,GAAG,UAAUzyC,IAAV,EAAgB0f,MAAhB,EAAwBgP,UAAxB,EAAoC+E,UAApC,EAAgD;AAC5D,WAAOzjC,GAAG,CAACgQ,IAAD,EAAO,UAAUI,GAAV,EAAe;AAC9B,UAAIsyC,WAAW,GAAGJ,gBAAgB,CAAC5yB,MAAD,EAAStf,GAAT,EAAcsuB,UAAd,EAA0BhgC,KAA1B,CAAlC;AACA,aAAOwb,QAAQ,CAAC9J,GAAD,EAAMqzB,UAAN,EAAkBif,WAAlB,CAAf;AACD,KAHS,CAAV;AAID,GALD;;AAMA,MAAIC,aAAa,GAAG,UAAU3yC,IAAV,EAAgB0uB,UAAhB,EAA4BjiB,aAA5B,EAA2C;AAC7D,WAAOzc,GAAG,CAACgQ,IAAD,EAAO,UAAUI,GAAV,EAAe;AAC9B,aAAO1N,KAAK,CAAC+Z,aAAD,EAAgB,UAAUha,GAAV,EAAemgD,MAAf,EAAuB;AACjD,YAAIC,QAAQ,GAAGP,gBAAgB,CAAC,CAAD,EAAIlyC,GAAJ,EAASsuB,UAAT,EAAqB//B,MAArB,CAAhB,CAA6C,CAA7C,CAAf;AACA,eAAO8b,OAAO,CAAChY,GAAD,EAAMmgD,MAAN,EAAcC,QAAd,CAAd;AACD,OAHW,EAGTzyC,GAHS,CAAZ;AAID,KALS,CAAV;AAMD,GAPD;;AAQA,MAAI0yC,MAAM,GAAG,UAAUtB,KAAV,EAAiBv1B,KAAjB,EAAwByS,UAAxB,EAAoC;AAC/C,QAAIqkB,QAAQ,GAAG92B,KAAK,CAAC81B,QAAN,GAAiB,CAAjB,GAAqBU,OAArB,GAA+B3kD,QAA9C;AACA,QAAIklD,QAAQ,GAAG/2B,KAAK,CAAC61B,QAAN,GAAiB,CAAjB,GAAqBU,OAArB,GAA+B1kD,QAA9C;AACA,QAAI2e,aAAa,GAAGpB,wBAAwB,CAACmmC,KAAD,CAA5C;AACA,QAAIyB,SAAS,GAAGnoC,UAAU,CAAC0mC,KAAK,CAAC,CAAD,CAAN,CAA1B;AACA,QAAI0B,eAAe,GAAG/iD,MAAM,CAACsc,aAAD,EAAgB,UAAUnB,MAAV,EAAkB;AAC5D,aAAOA,MAAM,KAAK2nC,SAAS,GAAG,CAA9B;AACD,KAF2B,CAA5B;AAGA,QAAIE,YAAY,GAAGJ,QAAQ,CAACvB,KAAD,EAAQpkC,IAAI,CAACgP,GAAL,CAASH,KAAK,CAAC81B,QAAf,CAAR,EAAkCrjB,UAAlC,EAA8CwkB,eAAe,GAAGD,SAAS,GAAG,CAAf,GAAmBA,SAAhF,CAA3B;AACA,QAAIG,gBAAgB,GAAG/nC,wBAAwB,CAAC8nC,YAAD,CAA/C;AACA,WAAOH,QAAQ,CAACG,YAAD,EAAe/lC,IAAI,CAACgP,GAAL,CAASH,KAAK,CAAC61B,QAAf,CAAf,EAAyCpjB,UAAzC,EAAqDz7B,WAAW,CAACmgD,gBAAD,EAAmBzkD,MAAnB,CAAhE,CAAf;AACD,GAXD;;AAaA,MAAI0kD,UAAU,GAAG,UAAUrzC,IAAV,EAAgBI,GAAhB,EAAqBgb,GAArB,EAA0BhoB,UAA1B,EAAsC;AACrD,QAAIsD,SAAS,GAAGkU,OAAO,CAAC5K,IAAI,CAACI,GAAD,CAAL,EAAYgb,GAAZ,CAAvB;AACA,QAAIk4B,QAAQ,GAAGvlD,KAAK,CAACqF,UAAD,EAAasD,SAAS,CAACyG,OAAvB,CAApB;AACA,QAAIgmC,UAAU,GAAGnjC,IAAI,CAACI,GAAD,CAArB;AACA,WAAOJ,IAAI,CAACxS,MAAL,GAAc,CAAd,IAAmBsd,UAAU,CAACq4B,UAAD,CAAV,GAAyB,CAA5C,KAAkD/nB,GAAG,GAAG,CAAN,IAAWk4B,QAAQ,CAACzoC,cAAc,CAACs4B,UAAD,EAAa/nB,GAAG,GAAG,CAAnB,CAAf,CAAnB,IAA4DA,GAAG,GAAG+nB,UAAU,CAACriC,KAAX,CAAiBtT,MAAjB,GAA0B,CAAhC,IAAqC8lD,QAAQ,CAACzoC,cAAc,CAACs4B,UAAD,EAAa/nB,GAAG,GAAG,CAAnB,CAAf,CAAzG,IAAkJhb,GAAG,GAAG,CAAN,IAAWkzC,QAAQ,CAACzoC,cAAc,CAAC7K,IAAI,CAACI,GAAG,GAAG,CAAP,CAAL,EAAgBgb,GAAhB,CAAf,CAArK,IAA6Mhb,GAAG,GAAGJ,IAAI,CAACxS,MAAL,GAAc,CAApB,IAAyB8lD,QAAQ,CAACzoC,cAAc,CAAC7K,IAAI,CAACI,GAAG,GAAG,CAAP,CAAL,EAAgBgb,GAAhB,CAAf,CAAhS,CAAP;AACD,GALD;;AAMA,MAAIm4B,WAAW,GAAG,UAAUhC,YAAV,EAAwBC,KAAxB,EAA+BC,KAA/B,EAAsCc,SAAtC,EAAiDn/C,UAAjD,EAA6DqZ,aAA7D,EAA4E;AAC5F,QAAInL,QAAQ,GAAGiwC,YAAY,CAACnxC,GAA5B;AACA,QAAImB,QAAQ,GAAGgwC,YAAY,CAAClxC,MAA5B;AACA,QAAImzC,WAAW,GAAG/B,KAAK,CAACjkD,MAAxB;AACA,QAAIimD,UAAU,GAAG3oC,UAAU,CAAC2mC,KAAK,CAAC,CAAD,CAAN,CAA3B;AACA,QAAIjpB,MAAM,GAAGlnB,QAAQ,GAAGkyC,WAAxB;AACA,QAAI/qB,MAAM,GAAGlnB,QAAQ,GAAGkyC,UAAX,GAAwBhnC,aAAa,CAACjf,MAAnD;AACA,QAAIkmD,eAAe,GAAGzgD,WAAW,CAACwZ,aAAD,EAAgB9d,MAAhB,CAAjC;;AACA,SAAK,IAAIuD,CAAC,GAAGoP,QAAb,EAAuBpP,CAAC,GAAGs2B,MAA3B,EAAmCt2B,CAAC,EAApC,EAAwC;AACtC,UAAIyhD,UAAU,GAAG,CAAjB;;AACA,WAAK,IAAI/3B,CAAC,GAAGra,QAAb,EAAuBqa,CAAC,GAAG6M,MAA3B,EAAmC7M,CAAC,EAApC,EAAwC;AACtC,YAAI83B,eAAe,CAAC93B,CAAD,CAAnB,EAAwB;AACtB+3B,UAAAA,UAAU;AACV;AACD;;AACD,YAAIN,UAAU,CAAC7B,KAAD,EAAQt/C,CAAR,EAAW0pB,CAAX,EAAcxoB,UAAd,CAAd,EAAyC;AACvCy8C,UAAAA,OAAO,CAAC2B,KAAD,EAAQ3mC,cAAc,CAAC2mC,KAAK,CAACt/C,CAAD,CAAN,EAAW0pB,CAAX,CAAtB,EAAqCxoB,UAArC,EAAiDm/C,SAAS,CAACjqC,IAA3D,CAAP;AACD;;AACD,YAAIsrC,aAAa,GAAGh4B,CAAC,GAAGra,QAAJ,GAAeoyC,UAAnC;AACA,YAAI9oB,OAAO,GAAGjgB,OAAO,CAAC6mC,KAAK,CAACv/C,CAAC,GAAGoP,QAAL,CAAN,EAAsBsyC,aAAtB,CAArB;AACA,YAAIC,UAAU,GAAGhpB,OAAO,CAAC1tB,OAAzB;AACA,YAAImzC,WAAW,GAAGiC,SAAS,CAACv8C,OAAV,CAAkB69C,UAAlB,CAAlB;AACAnpC,QAAAA,UAAU,CAAC8mC,KAAK,CAACt/C,CAAD,CAAN,EAAW0pB,CAAX,EAAc5a,UAAU,CAACsvC,WAAD,EAAc,IAAd,EAAoBzlB,OAAO,CAACjqB,QAA5B,CAAxB,CAAV;AACD;AACF;;AACD,WAAO4wC,KAAP;AACD,GA1BD;;AA2BA,MAAIsC,oBAAoB,GAAG,UAAUC,mBAAV,EAA+B/zC,IAA/B,EAAqCyM,aAArC,EAAoD;AAC7E,QAAIunC,aAAa,GAAGlpC,UAAU,CAAC9K,IAAI,CAAC,CAAD,CAAL,CAA9B;AACA,QAAIi0C,kBAAkB,GAAGlpC,kBAAkB,CAAC/K,IAAD,CAAlB,CAAyBgL,IAAzB,CAA8Bxd,MAA9B,GAAuCumD,mBAAmB,CAAC3zC,GAApF;AACA,QAAI8zC,oBAAoB,GAAGliD,KAAK,CAACgiD,aAAa,GAAGD,mBAAmB,CAAC1zC,MAArC,EAA6C,UAAUpO,GAAV,EAAe;AAC1F,aAAOA,GAAG,GAAG8hD,mBAAmB,CAAC1zC,MAAjC;AACD,KAF+B,CAAhC;AAGA,QAAI8zC,eAAe,GAAGthD,IAAI,CAACqhD,oBAAD,EAAuB,UAAUjiD,GAAV,EAAe;AAC9D,aAAO7B,MAAM,CAACqc,aAAD,EAAgB,UAAU2O,GAAV,EAAe;AAC1C,eAAOA,GAAG,KAAKnpB,GAAf;AACD,OAFY,CAAb;AAGD,KAJyB,CAAJ,CAInBxC,KAJmB,CAIbukD,aAAa,GAAG,CAJH,CAAtB;AAKA,WAAO;AACL5zC,MAAAA,GAAG,EAAE6zC,kBADA;AAEL5zC,MAAAA,MAAM,EAAE8zC;AAFH,KAAP;AAID,GAfD;;AAgBA,MAAIC,4BAA4B,GAAG,UAAU7C,YAAV,EAAwBvxC,IAAxB,EAA8ByM,aAA9B,EAA6C;AAC9E,WAAOpc,MAAM,CAACoc,aAAD,EAAgB,UAAUmmC,MAAV,EAAkB;AAC7C,aAAOA,MAAM,IAAIrB,YAAY,CAAClxC,MAAvB,IAAiCuyC,MAAM,IAAI9nC,UAAU,CAAC9K,IAAI,CAAC,CAAD,CAAL,CAAV,GAAsBuxC,YAAY,CAAClxC,MAArF;AACD,KAFY,CAAb;AAGD,GAJD;;AAKA,MAAIg0C,OAAO,GAAG,UAAU9C,YAAV,EAAwBC,KAAxB,EAA+BC,KAA/B,EAAsCc,SAAtC,EAAiDn/C,UAAjD,EAA6D;AACzE,QAAIqZ,aAAa,GAAGpB,wBAAwB,CAACmmC,KAAD,CAA5C;AACA,QAAI8C,iBAAiB,GAAGR,oBAAoB,CAACvC,YAAD,EAAeC,KAAf,EAAsB/kC,aAAtB,CAA5C;AACA,QAAI8nC,SAAS,GAAGxpC,kBAAkB,CAAC0mC,KAAD,CAAlB,CAA0BxxC,IAA1C;AACA,QAAIu0C,yBAAyB,GAAGJ,4BAA4B,CAACE,iBAAD,EAAoBC,SAApB,EAA+B9nC,aAA/B,CAA5D;AACA,QAAIvH,MAAM,GAAGosC,OAAO,CAACgD,iBAAD,EAAoB9C,KAApB,EAA2B+C,SAA3B,CAApB;AACA,WAAOrvC,MAAM,CAAClV,GAAP,CAAW,UAAU8jC,IAAV,EAAgB;AAChC,UAAI7X,KAAK,GAAGvoB,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKogC,IAAL,CAAT,EAAqB;AAAEie,QAAAA,QAAQ,EAAEje,IAAI,CAACie,QAAL,GAAgByC,yBAAyB,CAAChnD;AAAtD,OAArB,CAApB;;AACA,UAAIinD,UAAU,GAAG3B,MAAM,CAACtB,KAAD,EAAQv1B,KAAR,EAAes2B,SAAf,CAAvB;AACA,UAAIa,gBAAgB,GAAG/nC,wBAAwB,CAACopC,UAAD,CAA/C;AACA,UAAIC,4BAA4B,GAAGN,4BAA4B,CAACE,iBAAD,EAAoBC,SAApB,EAA+BnB,gBAA/B,CAA/D;AACA,aAAOG,WAAW,CAACe,iBAAD,EAAoBG,UAApB,EAAgCF,SAAhC,EAA2ChC,SAA3C,EAAsDn/C,UAAtD,EAAkEshD,4BAAlE,CAAlB;AACD,KANM,CAAP;AAOD,GAbD;;AAcA,MAAIC,UAAU,GAAG,UAAUnxC,KAAV,EAAiBguC,KAAjB,EAAwBC,KAAxB,EAA+Bc,SAA/B,EAA0Cn/C,UAA1C,EAAsD;AACrE88C,IAAAA,SAAS,CAACsB,KAAD,EAAQhuC,KAAR,EAAepQ,UAAf,EAA2Bm/C,SAAS,CAACjqC,IAArC,CAAT;AACA,QAAI2T,KAAK,GAAGk2B,aAAa,CAACV,KAAD,EAAQD,KAAR,CAAzB;AACA,QAAIoD,aAAa,GAAG9B,MAAM,CAACrB,KAAD,EAAQx1B,KAAR,EAAes2B,SAAf,CAA1B;AACA,QAAIsC,WAAW,GAAG1C,aAAa,CAACX,KAAD,EAAQoD,aAAR,CAA/B;AACA,QAAIE,aAAa,GAAGhC,MAAM,CAACtB,KAAD,EAAQqD,WAAR,EAAqBtC,SAArB,CAA1B;AACA,WAAOviD,GAAG,CAAC8kD,aAAD,EAAgB,UAAU3qC,OAAV,EAAmBrY,CAAnB,EAAsB;AAC9C,aAAOoY,QAAQ,CAACC,OAAD,EAAU3G,KAAV,EAAiBoxC,aAAa,CAAC9iD,CAAD,CAAb,CAAiBgP,KAAlC,CAAf;AACD,KAFS,CAAV;AAGD,GATD;;AAUA,MAAIi0C,UAAU,GAAG,UAAUvxC,KAAV,EAAiBguC,KAAjB,EAAwBC,KAAxB,EAA+Bc,SAA/B,EAA0Cn/C,UAA1C,EAAsD;AACrEg9C,IAAAA,SAAS,CAACoB,KAAD,EAAQhuC,KAAR,EAAepQ,UAAf,EAA2Bm/C,SAAS,CAACjqC,IAArC,CAAT;AACA,QAAIgD,MAAM,GAAGD,wBAAwB,CAACmmC,KAAD,CAArC;AACA,QAAI1d,IAAI,GAAGke,YAAY,CAACR,KAAD,EAAQC,KAAR,CAAvB;;AACA,QAAIx1B,KAAK,GAAGvoB,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKogC,IAAL,CAAT,EAAqB;AAAEie,MAAAA,QAAQ,EAAEje,IAAI,CAACie,QAAL,GAAgBzmC,MAAM,CAAC9d;AAAnC,KAArB,CAApB;;AACA,QAAIsnD,aAAa,GAAGhC,MAAM,CAACtB,KAAD,EAAQv1B,KAAR,EAAes2B,SAAf,CAA1B;;AACA,QAAIpf,EAAE,GAAGpoB,kBAAkB,CAAC+pC,aAAD,CAA3B;AAAA,QAA4CE,OAAO,GAAG7hB,EAAE,CAACnoB,IAAzD;AAAA,QAA+DiqC,OAAO,GAAG9hB,EAAE,CAAClzB,IAA5E;;AACA,QAAIi1C,SAAS,GAAG7pC,wBAAwB,CAACypC,aAAD,CAAxC;AACA,QAAIK,UAAU,GAAGnD,YAAY,CAACP,KAAD,EAAQD,KAAR,CAA7B;;AACA,QAAIqD,WAAW,GAAGnhD,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKyhD,UAAL,CAAT,EAA2B;AAAEpD,MAAAA,QAAQ,EAAEoD,UAAU,CAACpD,QAAX,GAAsBmD,SAAS,CAAC1nD;AAA5C,KAA3B,CAA1B;;AACA,QAAI4nD,WAAW,GAAGzC,aAAa,CAAClB,KAAD,EAAQc,SAAR,EAAmB2C,SAAnB,CAA/B;AACA,QAAIN,aAAa,GAAG9B,MAAM,CAACsC,WAAD,EAAcP,WAAd,EAA2BtC,SAA3B,CAA1B;AACA,WAAOyC,OAAO,CAAC5mD,MAAR,CAAe6mD,OAAO,CAAC7jD,KAAR,CAAc,CAAd,EAAiBoS,KAAjB,CAAf,EAAwCpV,MAAxC,CAA+CwmD,aAA/C,EAA8DxmD,MAA9D,CAAqE6mD,OAAO,CAAC7jD,KAAR,CAAcoS,KAAd,EAAqByxC,OAAO,CAACznD,MAA7B,CAArE,CAAP;AACD,GAbD;;AAeA,MAAI6nD,WAAW,GAAG,UAAUr1C,IAAV,EAAgBwD,KAAhB,EAAuB8xC,OAAvB,EAAgCliD,UAAhC,EAA4Cw8C,YAA5C,EAA0D;AAC1E,QAAIzc,EAAE,GAAGpoB,kBAAkB,CAAC/K,IAAD,CAA3B;AAAA,QAAmCC,IAAI,GAAGkzB,EAAE,CAAClzB,IAA7C;AAAA,QAAmD+K,IAAI,GAAGmoB,EAAE,CAACnoB,IAA7D;;AACA,QAAIX,MAAM,GAAGpK,IAAI,CAAC7O,KAAL,CAAW,CAAX,EAAcoS,KAAd,CAAb;AACA,QAAI8G,KAAK,GAAGrK,IAAI,CAAC7O,KAAL,CAAWoS,KAAX,CAAZ;AACA,QAAI+xC,OAAO,GAAG5qC,QAAQ,CAAC1K,IAAI,CAACq1C,OAAD,CAAL,EAAgB,UAAUE,EAAV,EAAc55B,CAAd,EAAiB;AACrD,UAAI65B,UAAU,GAAGjyC,KAAK,GAAG,CAAR,IAAaA,KAAK,GAAGvD,IAAI,CAACzS,MAA1B,IAAoC4F,UAAU,CAACyX,cAAc,CAAC5K,IAAI,CAACuD,KAAK,GAAG,CAAT,CAAL,EAAkBoY,CAAlB,CAAf,EAAqC/Q,cAAc,CAAC5K,IAAI,CAACuD,KAAD,CAAL,EAAcoY,CAAd,CAAnD,CAA/D;AACA,UAAI5Y,GAAG,GAAGyyC,UAAU,GAAG7qC,OAAO,CAAC3K,IAAI,CAACuD,KAAD,CAAL,EAAcoY,CAAd,CAAV,GAA6B5a,UAAU,CAAC4uC,YAAY,CAAC4F,EAAE,CAACr4C,OAAJ,EAAa/J,UAAb,CAAb,EAAuC,IAAvC,EAA6CoiD,EAAE,CAAC50C,QAAhD,CAA3D;AACA,aAAOoC,GAAP;AACD,KAJqB,CAAtB;AAKA,WAAOgI,IAAI,CAAC5c,MAAL,CAAYic,MAAZ,EAAoBjc,MAApB,CAA2B,CAACmnD,OAAD,CAA3B,EAAsCnnD,MAAtC,CAA6Ckc,KAA7C,CAAP;AACD,GAVD;;AAWA,MAAIorC,aAAa,GAAG,UAAUt1C,GAAV,EAAeC,MAAf,EAAuBU,OAAvB,EAAgC00C,UAAhC,EAA4CH,OAA5C,EAAqDliD,UAArD,EAAiEw8C,YAAjE,EAA+E;AACjG,QAAI7uC,OAAO,KAAK,UAAZ,IAA0B,CAAC00C,UAA/B,EAA2C;AACzC,UAAIntC,IAAI,GAAGsC,OAAO,CAACxK,GAAD,EAAMk1C,OAAN,CAAlB;AACA,aAAOt0C,UAAU,CAAC4uC,YAAY,CAACtnC,IAAI,CAACnL,OAAN,EAAe/J,UAAf,CAAb,EAAyC,IAAzC,EAA+C,KAA/C,CAAjB;AACD,KAHD,MAGO;AACL,aAAOwX,OAAO,CAACxK,GAAD,EAAMC,MAAN,CAAd;AACD;AACF,GAPD;;AAQA,MAAIs1C,cAAc,GAAG,UAAU31C,IAAV,EAAgBwD,KAAhB,EAAuB8xC,OAAvB,EAAgCliD,UAAhC,EAA4Cw8C,YAA5C,EAA0D;AAC7E,WAAO5/C,GAAG,CAACgQ,IAAD,EAAO,UAAUI,GAAV,EAAe;AAC9B,UAAIq1C,UAAU,GAAGjyC,KAAK,GAAG,CAAR,IAAaA,KAAK,GAAGsH,UAAU,CAAC1K,GAAD,CAA/B,IAAwChN,UAAU,CAACyX,cAAc,CAACzK,GAAD,EAAMoD,KAAK,GAAG,CAAd,CAAf,EAAiCqH,cAAc,CAACzK,GAAD,EAAMoD,KAAN,CAA/C,CAAnE;AACA,UAAIgtC,GAAG,GAAGkF,aAAa,CAACt1C,GAAD,EAAMoD,KAAN,EAAapD,GAAG,CAACW,OAAjB,EAA0B00C,UAA1B,EAAsCH,OAAtC,EAA+CliD,UAA/C,EAA2Dw8C,YAA3D,CAAvB;AACA,aAAOnlC,OAAO,CAACrK,GAAD,EAAMoD,KAAN,EAAagtC,GAAb,CAAd;AACD,KAJS,CAAV;AAKD,GAND;;AAOA,MAAIoF,eAAe,GAAG,UAAU51C,IAAV,EAAgBE,OAAhB,EAAyB;AAC7C,WAAOhQ,IAAI,CAAC8P,IAAD,EAAO,UAAUI,GAAV,EAAe;AAC/B,UAAIgK,aAAa,GAAGhK,GAAG,CAACU,KAAxB;AACA,UAAIA,KAAK,GAAGtO,KAAK,CAAC0N,OAAD,EAAU,UAAUzN,GAAV,EAAe4N,MAAf,EAAuB;AAChD,eAAOA,MAAM,IAAI,CAAV,IAAeA,MAAM,GAAG5N,GAAG,CAACjF,MAA5B,GAAqCiF,GAAG,CAACrB,KAAJ,CAAU,CAAV,EAAaiP,MAAb,EAAqBjS,MAArB,CAA4BqE,GAAG,CAACrB,KAAJ,CAAUiP,MAAM,GAAG,CAAnB,CAA5B,CAArC,GAA0F5N,GAAjG;AACD,OAFgB,EAEd2X,aAFc,CAAjB;AAGA,aAAOtJ,KAAK,CAACtT,MAAN,GAAe,CAAf,GAAmB,CAAC0T,QAAQ,CAACJ,KAAD,EAAQV,GAAG,CAACW,OAAZ,CAAT,CAAnB,GAAoD,EAA3D;AACD,KANU,CAAX;AAOD,GARD;;AASA,MAAI80C,YAAY,GAAG,UAAU71C,IAAV,EAAgB1I,KAAhB,EAAuBiY,MAAvB,EAA+B;AAChD,QAAI4jB,EAAE,GAAGpoB,kBAAkB,CAAC/K,IAAD,CAA3B;AAAA,QAAmCC,IAAI,GAAGkzB,EAAE,CAAClzB,IAA7C;AAAA,QAAmD+K,IAAI,GAAGmoB,EAAE,CAACnoB,IAA7D;;AACA,WAAOA,IAAI,CAAC5c,MAAL,CAAY6R,IAAI,CAAC7O,KAAL,CAAW,CAAX,EAAckG,KAAd,CAAZ,EAAkClJ,MAAlC,CAAyC6R,IAAI,CAAC7O,KAAL,CAAWme,MAAM,GAAG,CAApB,CAAzC,CAAP;AACD,GAHD;;AAKA,MAAIumC,SAAS,GAAG,UAAU91C,IAAV,EAAgB8vB,OAAhB,EAAyB18B,UAAzB,EAAqCw8C,YAArC,EAAmD;AACjE,QAAImG,QAAQ,GAAG,UAAUztC,IAAV,EAAgB;AAC7B,aAAOnY,MAAM,CAAC2/B,OAAD,EAAU,UAAU73B,MAAV,EAAkB;AACvC,eAAO7E,UAAU,CAACkV,IAAI,CAACnL,OAAN,EAAelF,MAAM,CAACkF,OAAtB,CAAjB;AACD,OAFY,CAAb;AAGD,KAJD;;AAKA,WAAOnN,GAAG,CAACgQ,IAAD,EAAO,UAAUI,GAAV,EAAe;AAC9B,aAAOuK,QAAQ,CAACvK,GAAD,EAAM,UAAUkI,IAAV,EAAgB;AACnC,eAAOytC,QAAQ,CAACztC,IAAD,CAAR,GAAiBtH,UAAU,CAAC4uC,YAAY,CAACtnC,IAAI,CAACnL,OAAN,EAAe/J,UAAf,CAAb,EAAyC,IAAzC,EAA+CkV,IAAI,CAAC1H,QAApD,CAA3B,GAA2F0H,IAAlG;AACD,OAFc,CAAf;AAGD,KAJS,CAAV;AAKD,GAXD;;AAYA,MAAI0tC,WAAW,GAAG,UAAUh2C,IAAV,EAAgB4oB,QAAhB,EAA0Bvc,QAA1B,EAAoCjZ,UAApC,EAAgD;AAChE,WAAOyX,cAAc,CAAC7K,IAAI,CAAC4oB,QAAD,CAAL,EAAiBvc,QAAjB,CAAd,KAA6Czf,SAA7C,IAA2Dg8B,QAAQ,GAAG,CAAX,IAAgBx1B,UAAU,CAACyX,cAAc,CAAC7K,IAAI,CAAC4oB,QAAQ,GAAG,CAAZ,CAAL,EAAqBvc,QAArB,CAAf,EAA+CxB,cAAc,CAAC7K,IAAI,CAAC4oB,QAAD,CAAL,EAAiBvc,QAAjB,CAA7D,CAA5F;AACD,GAFD;;AAGA,MAAI4pC,cAAc,GAAG,UAAU71C,GAAV,EAAeoD,KAAf,EAAsBpQ,UAAtB,EAAkC;AACrD,WAAOoQ,KAAK,GAAG,CAAR,IAAapQ,UAAU,CAACyX,cAAc,CAACzK,GAAD,EAAMoD,KAAK,GAAG,CAAd,CAAf,EAAiCqH,cAAc,CAACzK,GAAD,EAAMoD,KAAN,CAA/C,CAA9B;AACD,GAFD;;AAGA,MAAI0yC,aAAa,GAAG,UAAUl2C,IAAV,EAAgBwD,KAAhB,EAAuBpQ,UAAvB,EAAmCw8C,YAAnC,EAAiD;AACnE,QAAI3vC,IAAI,GAAG8K,kBAAkB,CAAC/K,IAAD,CAAlB,CAAyBC,IAApC;AACA,QAAI6vB,OAAO,GAAG5/B,IAAI,CAAC+P,IAAD,EAAO,UAAUG,GAAV,EAAetO,CAAf,EAAkB;AACzC,UAAIqkD,YAAY,GAAGH,WAAW,CAACh2C,IAAD,EAAOlO,CAAP,EAAU0R,KAAV,EAAiBpQ,UAAjB,CAAX,IAA2C6iD,cAAc,CAAC71C,GAAD,EAAMoD,KAAN,EAAapQ,UAAb,CAA5E;AACA,aAAO+iD,YAAY,GAAG,EAAH,GAAQ,CAACvrC,OAAO,CAACxK,GAAD,EAAMoD,KAAN,CAAR,CAA3B;AACD,KAHiB,CAAlB;AAIA,WAAOsyC,SAAS,CAAC91C,IAAD,EAAO8vB,OAAP,EAAgB18B,UAAhB,EAA4Bw8C,YAA5B,CAAhB;AACD,GAPD;;AAQA,MAAIwG,UAAU,GAAG,UAAUp2C,IAAV,EAAgBwD,KAAhB,EAAuBpQ,UAAvB,EAAmCw8C,YAAnC,EAAiD;AAChE,QAAI3vC,IAAI,GAAG8K,kBAAkB,CAAC/K,IAAD,CAAlB,CAAyBC,IAApC;AACA,QAAIo2C,SAAS,GAAGp2C,IAAI,CAACuD,KAAD,CAApB;AACA,QAAIssB,OAAO,GAAG5/B,IAAI,CAACmmD,SAAS,CAACv1C,KAAX,EAAkB,UAAUgL,IAAV,EAAgBha,CAAhB,EAAmB;AACrD,UAAIqkD,YAAY,GAAGH,WAAW,CAAC/1C,IAAD,EAAOuD,KAAP,EAAc1R,CAAd,EAAiBsB,UAAjB,CAAX,IAA2C6iD,cAAc,CAACI,SAAD,EAAYvkD,CAAZ,EAAesB,UAAf,CAA5E;AACA,aAAO+iD,YAAY,GAAG,EAAH,GAAQ,CAACrqC,IAAD,CAA3B;AACD,KAHiB,CAAlB;AAIA,WAAOgqC,SAAS,CAAC91C,IAAD,EAAO8vB,OAAP,EAAgB18B,UAAhB,EAA4Bw8C,YAA5B,CAAhB;AACD,GARD;;AAUA,MAAI0G,aAAa,GAAG,UAAUl1C,OAAV,EAAmB;AACrC,QAAIm1C,WAAW,GAAG,UAAUx6B,IAAV,EAAgBzb,MAAhB,EAAwB;AACxC,UAAIk2C,YAAY,GAAGrmD,MAAM,CAAC4rB,IAAD,EAAO,UAAU06B,aAAV,EAAyB;AACvD,eAAOA,aAAa,CAACp2C,MAAd,KAAyBC,MAAM,CAACD,MAAvC;AACD,OAFwB,CAAzB;AAGA,aAAOm2C,YAAY,GAAGz6B,IAAH,GAAUA,IAAI,CAAC3tB,MAAL,CAAY,CAACkS,MAAD,CAAZ,CAA7B;AACD,KALD;;AAMA,WAAO5N,KAAK,CAAC0O,OAAD,EAAUm1C,WAAV,EAAuB,EAAvB,CAAL,CAAgCpjD,IAAhC,CAAqC,UAAUqb,OAAV,EAAmBC,OAAnB,EAA4B;AACtE,aAAOD,OAAO,CAACnO,MAAR,GAAiBoO,OAAO,CAACpO,MAAhC;AACD,KAFM,CAAP;AAGD,GAVD;;AAYA,MAAIq2C,aAAa,GAAG,UAAUv5C,OAAV,EAAmB;AACrC,QAAIqD,OAAO,GAAG6H,YAAY,CAAClL,OAAD,EAAU,SAAV,EAAqB,CAArB,CAA1B;AACA,QAAIoD,OAAO,GAAG8H,YAAY,CAAClL,OAAD,EAAU,SAAV,EAAqB,CAArB,CAA1B;AACA,WAAO;AACLA,MAAAA,OAAO,EAAEA,OADJ;AAELqD,MAAAA,OAAO,EAAEA,OAFJ;AAGLD,MAAAA,OAAO,EAAEA;AAHJ,KAAP;AAKD,GARD;;AASA,MAAIo2C,YAAY,GAAG,UAAUjoB,UAAV,EAAsBkoB,MAAtB,EAA8B;AAC/C,QAAIA,MAAM,KAAK,KAAK,CAApB,EAAuB;AACrBA,MAAAA,MAAM,GAAGF,aAAT;AACD;;AACD,QAAInX,QAAQ,GAAGjZ,IAAI,CAACp1B,QAAQ,CAACtC,IAAT,EAAD,CAAnB;;AACA,QAAIqH,EAAE,GAAG,UAAU+5B,IAAV,EAAgB;AACvB,cAAQjkC,IAAI,CAACikC,IAAI,CAAC7yB,OAAN,CAAZ;AACA,aAAK,KAAL;AACE,iBAAOuxB,UAAU,CAACtT,GAAX,CAAe4U,IAAf,CAAP;;AACF;AACE,iBAAOtB,UAAU,CAACpmB,IAAX,CAAgB0nB,IAAhB,CAAP;AAJF;AAMD,KAPD;;AAQA,QAAI6mB,MAAM,GAAG,UAAU15C,OAAV,EAAmB;AAC9B,UAAI6yB,IAAI,GAAG4mB,MAAM,CAACz5C,OAAD,CAAjB;AACA,aAAOlH,EAAE,CAAC+5B,IAAD,CAAT;AACD,KAHD;;AAIA,QAAIoH,GAAG,GAAG,UAAUj6B,OAAV,EAAmB;AAC3B,UAAImzC,WAAW,GAAGuG,MAAM,CAAC15C,OAAD,CAAxB;;AACA,UAAIoiC,QAAQ,CAACjsC,GAAT,GAAevE,MAAf,EAAJ,EAA6B;AAC3BwwC,QAAAA,QAAQ,CAACn5B,GAAT,CAAalV,QAAQ,CAACR,IAAT,CAAc4/C,WAAd,CAAb;AACD;;AACDwG,MAAAA,MAAM,GAAG5lD,QAAQ,CAACR,IAAT,CAAc;AACrBob,QAAAA,IAAI,EAAE3O,OADe;AAErBmzC,QAAAA,WAAW,EAAEA;AAFQ,OAAd,CAAT;AAIA,aAAOA,WAAP;AACD,KAVD;;AAWA,QAAIwG,MAAM,GAAG5lD,QAAQ,CAACtC,IAAT,EAAb;;AACA,QAAImoD,SAAS,GAAG,UAAU55C,OAAV,EAAmB/J,UAAnB,EAA+B;AAC7C,aAAO0jD,MAAM,CAACznD,IAAP,CAAY,YAAY;AAC7B,eAAO+nC,GAAG,CAACj6B,OAAD,CAAV;AACD,OAFM,EAEJ,UAAUtJ,CAAV,EAAa;AACd,eAAOT,UAAU,CAAC+J,OAAD,EAAUtJ,CAAC,CAACiY,IAAZ,CAAV,GAA8BjY,CAAC,CAACy8C,WAAhC,GAA8ClZ,GAAG,CAACj6B,OAAD,CAAxD;AACD,OAJM,CAAP;AAKD,KAND;;AAOA,WAAO;AACL45C,MAAAA,SAAS,EAAEA,SADN;AAELrI,MAAAA,MAAM,EAAEnP,QAAQ,CAACjsC;AAFZ,KAAP;AAID,GAxCD;;AAyCA,MAAI0jD,WAAW,GAAG,UAAUp7C,KAAV,EAAiBY,GAAjB,EAAsB;AACtC,WAAO,UAAUkyB,UAAV,EAAsB;AAC3B,UAAI6Q,QAAQ,GAAGjZ,IAAI,CAACp1B,QAAQ,CAACtC,IAAT,EAAD,CAAnB;AACA,UAAI2d,IAAI,GAAG,EAAX;;AACA,UAAI7W,MAAM,GAAG,UAAUyH,OAAV,EAAmB/J,UAAnB,EAA+B;AAC1C,eAAOP,IAAI,CAAC0Z,IAAD,EAAO,UAAU9gB,CAAV,EAAa;AAC7B,iBAAO2H,UAAU,CAAC3H,CAAC,CAACqgB,IAAH,EAAS3O,OAAT,CAAjB;AACD,SAFU,CAAX;AAGD,OAJD;;AAKA,UAAI85C,OAAO,GAAG,UAAU95C,OAAV,EAAmB;AAC/B,YAAImJ,KAAK,GAAG;AAAE1K,UAAAA,KAAK,EAAEA;AAAT,SAAZ;AACA,YAAI0M,IAAI,GAAGomB,UAAU,CAAC14B,OAAX,CAAmBmH,OAAnB,EAA4BX,GAA5B,EAAiC8J,KAAjC,CAAX;AACAiG,QAAAA,IAAI,CAAC/a,IAAL,CAAU;AACRsa,UAAAA,IAAI,EAAE3O,OADE;AAERqzC,UAAAA,GAAG,EAAEloC;AAFG,SAAV;;AAIA,YAAIi3B,QAAQ,CAACjsC,GAAT,GAAevE,MAAf,EAAJ,EAA6B;AAC3BwwC,UAAAA,QAAQ,CAACn5B,GAAT,CAAalV,QAAQ,CAACR,IAAT,CAAc4X,IAAd,CAAb;AACD;;AACD,eAAOA,IAAP;AACD,OAXD;;AAYA,UAAI4uC,aAAa,GAAG,UAAU/5C,OAAV,EAAmB/J,UAAnB,EAA+B;AACjD,YAAIrH,IAAI,CAACoR,OAAD,CAAJ,KAAkB,KAAtB,EAA6B;AAC3B,iBAAOA,OAAP;AACD,SAFD,MAEO;AACL,iBAAOzH,MAAM,CAACyH,OAAD,EAAU/J,UAAV,CAAN,CAA4B/D,IAA5B,CAAiC,YAAY;AAClD,mBAAO4nD,OAAO,CAAC95C,OAAD,CAAd;AACD,WAFM,EAEJ,UAAUtJ,CAAV,EAAa;AACd,mBAAOT,UAAU,CAAC+J,OAAD,EAAUtJ,CAAC,CAACiY,IAAZ,CAAV,GAA8BjY,CAAC,CAAC28C,GAAhC,GAAsCyG,OAAO,CAAC95C,OAAD,CAApD;AACD,WAJM,CAAP;AAKD;AACF,OAVD;;AAWA,aAAO;AACL+5C,QAAAA,aAAa,EAAEA,aADV;AAELxI,QAAAA,MAAM,EAAEnP,QAAQ,CAACjsC;AAFZ,OAAP;AAID,KAnCD;AAoCD,GArCD;;AAsCA,MAAI6jD,iBAAiB,GAAG,UAAU7uC,IAAV,EAAgB;AACtC,WAAO7B,MAAM,CAAC6B,IAAD,EAAO,OAAP,CAAN,CAAsBtY,GAAtB,CAA0B,UAAUs7B,SAAV,EAAqB;AACpD,aAAOA,SAAS,CAACj0B,MAAV,CAAiB,CAAjB,EAAoB,CAApB,CAAP;AACD,KAFM,CAAP;AAGD,GAJD;;AAKA,MAAI+/C,OAAO,GAAG,UAAU1oB,UAAV,EAAsB;AAClC,QAAI6Q,QAAQ,GAAGjZ,IAAI,CAACp1B,QAAQ,CAACtC,IAAT,EAAD,CAAnB;;AACA,QAAIihD,OAAO,GAAG,UAAUvnC,IAAV,EAAgB;AAC5B,UAAIi3B,QAAQ,CAACjsC,GAAT,GAAevE,MAAf,EAAJ,EAA6B;AAC3BwwC,QAAAA,QAAQ,CAACn5B,GAAT,CAAalV,QAAQ,CAACR,IAAT,CAAc4X,IAAd,CAAb;AACD;;AACD,UAAI1M,KAAK,GAAGu7C,iBAAiB,CAAC7uC,IAAD,CAA7B;AACA1M,MAAAA,KAAK,CAAC3L,IAAN,CAAW,UAAUq7B,SAAV,EAAqB;AAC9B,eAAOllB,GAAG,CAACkC,IAAD,EAAO,OAAP,EAAgBgjB,SAAhB,CAAV;AACD,OAFD;AAGA,aAAO,YAAY;AACjB,YAAIvjB,GAAG,GAAG2mB,UAAU,CAACpmB,IAAX,CAAgB;AACxBnL,UAAAA,OAAO,EAAEmL,IADe;AAExB9H,UAAAA,OAAO,EAAE,CAFe;AAGxBD,UAAAA,OAAO,EAAE;AAHe,SAAhB,CAAV;AAKAyH,QAAAA,QAAQ,CAACD,GAAD,EAAM,OAAN,CAAR;AACAC,QAAAA,QAAQ,CAACM,IAAD,EAAO,OAAP,CAAR;AACA1M,QAAAA,KAAK,CAAC3L,IAAN,CAAW,UAAUq7B,SAAV,EAAqB;AAC9B,iBAAOllB,GAAG,CAAC2B,GAAD,EAAM,OAAN,EAAeujB,SAAf,CAAV;AACD,SAFD;AAGA,eAAOvjB,GAAP;AACD,OAZD;AAaD,KArBD;;AAsBA,QAAI4nC,KAAK,GAAG,UAAU7uC,KAAV,EAAiB;AAC3B,UAAIu2C,gBAAgB,GAAG,YAAY;AACjC,YAAIC,gBAAgB,GAAGz9B,GAAG,CAAC7pB,GAAG,CAAC8Q,KAAD,EAAQq2C,iBAAR,CAAJ,CAA1B;;AACA,YAAIG,gBAAgB,CAAC9pD,MAAjB,KAA4B,CAAhC,EAAmC;AACjC,iBAAO0D,QAAQ,CAACtC,IAAT,EAAP;AACD,SAFD,MAEO;AACL,cAAI2oD,WAAW,GAAGD,gBAAgB,CAAC,CAAD,CAAlC;AACA,cAAIE,QAAQ,GAAG,CACb,KADa,EAEb,KAFa,CAAf;AAIA,cAAIC,OAAO,GAAGtnD,MAAM,CAACmnD,gBAAD,EAAmB,UAAUhsB,SAAV,EAAqB;AAC1D,mBAAOA,SAAS,KAAKisB,WAAd,IAA6B5lD,QAAQ,CAAC6lD,QAAD,EAAWlsB,SAAX,CAA5C;AACD,WAFmB,CAApB;AAGA,iBAAOmsB,OAAO,GAAGvmD,QAAQ,CAACtC,IAAT,EAAH,GAAqBsC,QAAQ,CAACD,IAAT,CAAcsmD,WAAd,CAAnC;AACD;AACF,OAfD;;AAgBAvvC,MAAAA,QAAQ,CAAClH,KAAK,CAAC,CAAD,CAAN,EAAW,OAAX,CAAR;AACAu2C,MAAAA,gBAAgB,GAAGhoD,IAAnB,CAAwB,YAAY;AAClC,eAAOqX,MAAM,CAAC5F,KAAK,CAAC,CAAD,CAAN,EAAW,OAAX,CAAb;AACD,OAFD,EAEG,UAAUwqB,SAAV,EAAqB;AACtB,eAAOllB,GAAG,CAACtF,KAAK,CAAC,CAAD,CAAN,EAAW,OAAX,EAAoBwqB,SAAS,GAAG,OAAhC,CAAV;AACD,OAJD;AAKA,aAAOz9B,QAAQ,CAACiT,KAAK,CAAC,CAAD,CAAN,CAAf;AACD,KAxBD;;AAyBA,WAAO;AACL+uC,MAAAA,OAAO,EAAEA,OADJ;AAELF,MAAAA,KAAK,EAAEA,KAFF;AAGLjB,MAAAA,MAAM,EAAEnP,QAAQ,CAACjsC;AAHZ,KAAP;AAKD,GAtDD;;AAuDA,MAAIokD,UAAU,GAAG;AACff,IAAAA,YAAY,EAAEA,YADC;AAEf3W,IAAAA,SAAS,EAAEgX,WAFI;AAGfI,IAAAA,OAAO,EAAEA;AAHM,GAAjB;AAMA,MAAIO,SAAS,GAAG,CACd,MADc,EAEd,GAFc,EAGd,KAHc,EAId,SAJc,EAKd,OALc,EAMd,YANc,EAOd,QAPc,EAQd,QARc,EASd,QATc,EAUd,KAVc,EAWd,SAXc,EAYd,IAZc,EAad,IAbc,EAcd,OAdc,EAed,OAfc,EAgBd,OAhBc,EAiBd,OAjBc,EAkBd,SAlBc,EAmBd,IAnBc,EAoBd,IApBc,EAqBd,IArBc,EAsBd,IAtBc,EAuBd,IAvBc,EAwBd,IAxBc,EAyBd,IAzBc,EA0Bd,IA1Bc,EA2Bd,IA3Bc,EA4Bd,YA5Bc,EA6Bd,KA7Bc,EA8Bd,SA9Bc,CAAhB;;AAgCA,MAAIC,MAAM,GAAG,UAAUhkC,QAAV,EAAoB9H,IAApB,EAA0B;AACrC,QAAI+rC,OAAO,GAAGjkC,QAAQ,CAACzM,QAAT,GAAoBpb,IAApB,CAAyB+f,IAAzB,CAAd;AACA,WAAOna,QAAQ,CAAC,CACd,IADc,EAEd,IAFc,CAAD,EAGZkmD,OAHY,CAAf;AAID,GAND;;AAOA,MAAIC,OAAO,GAAG,UAAUlkC,QAAV,EAAoB9H,IAApB,EAA0B;AACtC,QAAI+rC,OAAO,GAAGjkC,QAAQ,CAACzM,QAAT,GAAoBpb,IAApB,CAAyB+f,IAAzB,CAAd;AACA,WAAOna,QAAQ,CAACgmD,SAAD,EAAYE,OAAZ,CAAf;AACD,GAHD;;AAIA,MAAInlC,UAAU,GAAG,UAAUkB,QAAV,EAAoB9H,IAApB,EAA0B;AACzC,WAAOna,QAAQ,CAAC,CACd,IADc,EAEd,KAFc,EAGd,IAHc,EAId,OAJc,CAAD,EAKZiiB,QAAQ,CAACzM,QAAT,GAAoBpb,IAApB,CAAyB+f,IAAzB,CALY,CAAf;AAMD,GAPD;;AASA,MAAIisC,UAAU,GAAGzlC,WAAW,EAA5B;;AACA,MAAI0lC,SAAS,GAAG,UAAU76C,OAAV,EAAmB;AACjC,WAAO26C,OAAO,CAACC,UAAD,EAAa56C,OAAb,CAAd;AACD,GAFD;;AAGA,MAAI86C,QAAQ,GAAG,UAAU96C,OAAV,EAAmB;AAChC,WAAOy6C,MAAM,CAACG,UAAD,EAAa56C,OAAb,CAAb;AACD,GAFD;;AAGA,MAAI+6C,YAAY,GAAG,UAAU/6C,OAAV,EAAmB;AACpC,WAAOuV,UAAU,CAACqlC,UAAD,EAAa56C,OAAb,CAAjB;AACD,GAFD;;AAIA,MAAIg7C,OAAO,GAAG,UAAUr3C,KAAV,EAAiB;AAC7B,QAAIs3C,IAAI,GAAG,UAAU9zC,EAAV,EAAc;AACvB,aAAOvY,IAAI,CAACuY,EAAD,CAAJ,KAAa,IAApB;AACD,KAFD;;AAGA,QAAI+zC,UAAU,GAAG,UAAU/0C,QAAV,EAAoB;AACnC,aAAOlT,MAAM,CAACkT,QAAD,EAAW,UAAUsY,CAAV,EAAa;AACnC,eAAOw8B,IAAI,CAACx8B,CAAD,CAAJ,IAAW3Z,MAAM,CAAC2Z,CAAD,CAAN,IAAazJ,KAAK,CAACyJ,CAAD,CAAL,CAAS/jB,IAAT,GAAgBrK,MAAhB,KAA2B,CAA1D;AACD,OAFY,CAAb;AAGD,KAJD;;AAKA,QAAI8qD,UAAU,GAAG,UAAUh0C,EAAV,EAAc;AAC7B,aAAOvY,IAAI,CAACuY,EAAD,CAAJ,KAAa,IAAb,IAAqBiB,QAAQ,CAACjB,EAAD,EAAK2zC,QAAL,CAAR,CAAuBzoD,MAAvB,EAA5B;AACD,KAFD;;AAGA,QAAI+oD,cAAc,GAAG,UAAUj0C,EAAV,EAAc;AACjC,aAAOjB,WAAW,CAACiB,EAAD,CAAX,CAAgBtU,GAAhB,CAAoB,UAAUwoD,YAAV,EAAwB;AACjD,YAAIR,SAAS,CAACQ,YAAD,CAAb,EAA6B;AAC3B,iBAAO,IAAP;AACD;;AACD,YAAIN,YAAY,CAACM,YAAD,CAAhB,EAAgC;AAC9B,iBAAOzsD,IAAI,CAACysD,YAAD,CAAJ,KAAuB,KAAvB,GAA+B,KAA/B,GAAuC,IAA9C;AACD;;AACD,eAAO,KAAP;AACD,OARM,EAQJ/oD,KARI,CAQE,KARF,CAAP;AASD,KAVD;;AAWA,QAAIgpD,QAAQ,GAAG,UAAUnwC,IAAV,EAAgB;AAC7B,aAAO6hB,MAAM,CAAC7hB,IAAD,CAAN,CAAapY,IAAb,CAAkB,UAAU8d,SAAV,EAAqB;AAC5C,YAAI0qC,mBAAmB,GAAGH,cAAc,CAACvqC,SAAD,CAAxC;AACA,eAAOrL,MAAM,CAACqL,SAAD,CAAN,CAAkBhe,GAAlB,CAAsB,UAAU2S,MAAV,EAAkB;AAC7C,iBAAO+1C,mBAAmB,KAAK,IAAxB,IAAgCJ,UAAU,CAAC31C,MAAD,CAA1C,IAAsDy1C,IAAI,CAACpqC,SAAD,CAA1D,IAAyEgqC,SAAS,CAACr1C,MAAD,CAAT,IAAqB,CAAC3E,IAAI,CAACsK,IAAD,EAAO3F,MAAP,CAAnG,GAAoH,EAApH,GAAyH,CAACzF,YAAY,CAACX,OAAb,CAAqB,IAArB,CAAD,CAAhI;AACD,SAFM,CAAP;AAGD,OALM,EAKJ9M,KALI,CAKE,EALF,CAAP;AAMD,KAPD;;AAQA,QAAIkpD,WAAW,GAAG,YAAY;AAC5B,UAAInpB,OAAO,GAAGt/B,IAAI,CAAC4Q,KAAD,EAAQ,UAAUwH,IAAV,EAAgB;AACxC,YAAItD,UAAU,GAAG1B,QAAQ,CAACgF,IAAD,CAAzB;AACA,eAAO+vC,UAAU,CAACrzC,UAAD,CAAV,GAAyB,EAAzB,GAA8BA,UAAU,CAAC5W,MAAX,CAAkBqqD,QAAQ,CAACnwC,IAAD,CAA1B,CAArC;AACD,OAHiB,CAAlB;AAIA,aAAOknB,OAAO,CAAChiC,MAAR,KAAmB,CAAnB,GAAuB,CAAC0P,YAAY,CAACX,OAAb,CAAqB,IAArB,CAAD,CAAvB,GAAsDizB,OAA7D;AACD,KAND;;AAOA,QAAIopB,QAAQ,GAAGD,WAAW,EAA1B;AACAlnC,IAAAA,KAAK,CAAC3Q,KAAK,CAAC,CAAD,CAAN,CAAL;AACA0Q,IAAAA,QAAQ,CAAC1Q,KAAK,CAAC,CAAD,CAAN,EAAW83C,QAAX,CAAR;AACD,GAzCD;;AA2CA,MAAIrkC,KAAK,GAAG,UAAU/K,KAAV,EAAiB;AAC3B,QAAII,OAAO,GAAG9I,KAAK,CAAC0I,KAAD,CAAnB;;AACA,QAAII,OAAO,CAACpc,MAAR,KAAmB,CAAvB,EAA0B;AACxBokB,MAAAA,QAAQ,CAACpI,KAAD,CAAR;AACD;AACF,GALD;;AAMA,MAAIqvC,OAAO,GAAG,UAAU74C,IAAV,EAAgB0uC,MAAhB,EAAwB;AACpC,WAAO;AACL1uC,MAAAA,IAAI,EAAEA,IADD;AAEL0uC,MAAAA,MAAM,EAAEA;AAFH,KAAP;AAID,GALD;;AAMA,MAAIoK,eAAe,GAAG,UAAU94C,IAAV,EAAgBI,GAAhB,EAAqBC,MAArB,EAA6B;AACjD,QAAIJ,IAAI,GAAG8K,kBAAkB,CAAC/K,IAAD,CAAlB,CAAyBC,IAApC;AACA,WAAO84C,MAAM,CAAC94C,IAAD,EAAOG,GAAP,EAAYC,MAAZ,CAAN,CAA0BtQ,OAA1B,CAAkC,YAAY;AACnD,aAAOgpD,MAAM,CAAC94C,IAAD,EAAO,CAAP,EAAU,CAAV,CAAb;AACD,KAFM,CAAP;AAGD,GALD;;AAMA,MAAI84C,MAAM,GAAG,UAAU/4C,IAAV,EAAgBI,GAAhB,EAAqBC,MAArB,EAA6B;AACxC,WAAOnP,QAAQ,CAACD,IAAT,CAAc+O,IAAI,CAACI,GAAD,CAAlB,EAAyBlQ,IAAzB,CAA8B,UAAUgC,CAAV,EAAa;AAChD,aAAOhB,QAAQ,CAACD,IAAT,CAAciB,CAAC,CAAC4O,KAAF,CAAQT,MAAR,CAAd,EAA+BnQ,IAA/B,CAAoC,UAAU0rB,CAAV,EAAa;AACtD,eAAO1qB,QAAQ,CAACD,IAAT,CAAc2qB,CAAC,CAACze,OAAhB,CAAP;AACD,OAFM,CAAP;AAGD,KAJM,CAAP;AAKD,GAND;;AAOA,MAAI67C,MAAM,GAAG,UAAUh5C,IAAV,EAAgBI,GAAhB,EAAqBC,MAArB,EAA6B;AACxC,QAAIJ,IAAI,GAAG8K,kBAAkB,CAAC/K,IAAD,CAAlB,CAAyBC,IAApC;AACA,WAAO44C,OAAO,CAAC74C,IAAD,EAAO+4C,MAAM,CAAC94C,IAAD,EAAOG,GAAP,EAAYC,MAAZ,CAAb,CAAd;AACD,GAHD;;AAIA,MAAI44C,UAAU,GAAG,UAAU73C,OAAV,EAAmB;AAClC,QAAI83C,cAAc,GAAG,UAAUn9B,IAAV,EAAgBzb,MAAhB,EAAwB;AAC3C,UAAI64C,SAAS,GAAGhpD,MAAM,CAAC4rB,IAAD,EAAO,UAAU06B,aAAV,EAAyB;AACpD,eAAOA,aAAa,CAACr2C,GAAd,KAAsBE,MAAM,CAACF,GAApC;AACD,OAFqB,CAAtB;AAGA,aAAO+4C,SAAS,GAAGp9B,IAAH,GAAUA,IAAI,CAAC3tB,MAAL,CAAY,CAACkS,MAAD,CAAZ,CAA1B;AACD,KALD;;AAMA,WAAO5N,KAAK,CAAC0O,OAAD,EAAU83C,cAAV,EAA0B,EAA1B,CAAL,CAAmC/lD,IAAnC,CAAwC,UAAUqb,OAAV,EAAmBC,OAAnB,EAA4B;AACzE,aAAOD,OAAO,CAACpO,GAAR,GAAcqO,OAAO,CAACrO,GAA7B;AACD,KAFM,CAAP;AAGD,GAVD;;AAWA,MAAIg5C,kBAAkB,GAAG,UAAUp5C,IAAV,EAAgBoB,OAAhB,EAAyBhO,UAAzB,EAAqCm7C,WAArC,EAAkD;AACzE,QAAI8K,WAAW,GAAGj4C,OAAO,CAAC,CAAD,CAAP,CAAWhB,GAA7B;AACA,QAAIH,IAAI,GAAGg5C,UAAU,CAAC73C,OAAD,CAArB;AACA,QAAIk4C,OAAO,GAAG9mD,KAAK,CAACyN,IAAD,EAAO,UAAUxN,GAAV,EAAe2N,GAAf,EAAoB;AAC5C,UAAIm5C,IAAI,GAAGlE,WAAW,CAAC5iD,GAAG,CAACuN,IAAL,EAAWq5C,WAAX,EAAwBj5C,GAAG,CAACA,GAAJ,GAAU3N,GAAG,CAACwpB,KAAtC,EAA6C7oB,UAA7C,EAAyDm7C,WAAW,CAACwI,SAArE,CAAtB;AACA,aAAO;AACL/2C,QAAAA,IAAI,EAAEu5C,IADD;AAELt9B,QAAAA,KAAK,EAAExpB,GAAG,CAACwpB,KAAJ,GAAY;AAFd,OAAP;AAID,KANkB,EAMhB;AACDjc,MAAAA,IAAI,EAAEA,IADL;AAEDic,MAAAA,KAAK,EAAE;AAFN,KANgB,CAAL,CASXjc,IATH;AAUA,WAAOg5C,MAAM,CAACM,OAAD,EAAUD,WAAV,EAAuBj4C,OAAO,CAAC,CAAD,CAAP,CAAWf,MAAlC,CAAb;AACD,GAdD;;AAeA,MAAIm5C,iBAAiB,GAAG,UAAUx5C,IAAV,EAAgBoB,OAAhB,EAAyBhO,UAAzB,EAAqCm7C,WAArC,EAAkD;AACxE,QAAItuC,IAAI,GAAGg5C,UAAU,CAAC73C,OAAD,CAArB;AACA,QAAInJ,MAAM,GAAGgI,IAAI,CAACA,IAAI,CAACzS,MAAL,GAAc,CAAf,CAAjB;AACA,QAAI6rD,WAAW,GAAGphD,MAAM,CAACmI,GAAP,GAAanI,MAAM,CAACsI,OAAtC;AACA,QAAI+4C,OAAO,GAAG9mD,KAAK,CAACyN,IAAD,EAAO,UAAUs5C,IAAV,EAAgBn5C,GAAhB,EAAqB;AAC7C,aAAOi1C,WAAW,CAACkE,IAAD,EAAOF,WAAP,EAAoBj5C,GAAG,CAACA,GAAxB,EAA6BhN,UAA7B,EAAyCm7C,WAAW,CAACwI,SAArD,CAAlB;AACD,KAFkB,EAEhB/2C,IAFgB,CAAnB;AAGA,WAAOg5C,MAAM,CAACM,OAAD,EAAUD,WAAV,EAAuBj4C,OAAO,CAAC,CAAD,CAAP,CAAWf,MAAlC,CAAb;AACD,GARD;;AASA,MAAIo5C,qBAAqB,GAAG,UAAUz5C,IAAV,EAAgB05C,aAAhB,EAA+BtmD,UAA/B,EAA2Cm7C,WAA3C,EAAwD;AAClF,QAAIntC,OAAO,GAAGs4C,aAAa,CAACt4C,OAA5B;AACA,QAAIlB,OAAO,GAAGo2C,aAAa,CAACl1C,OAAD,CAA3B;AACA,QAAIi4C,WAAW,GAAGn5C,OAAO,CAAC,CAAD,CAAP,CAAWG,MAA7B;AACA,QAAIi5C,OAAO,GAAG9mD,KAAK,CAAC0N,OAAD,EAAU,UAAUzN,GAAV,EAAe2oB,GAAf,EAAoB;AAC/C,UAAIm+B,IAAI,GAAG5D,cAAc,CAACljD,GAAG,CAACuN,IAAL,EAAWq5C,WAAX,EAAwBj+B,GAAG,CAAC/a,MAAJ,GAAa5N,GAAG,CAACwpB,KAAzC,EAAgD7oB,UAAhD,EAA4Dm7C,WAAW,CAACwI,SAAxE,CAAzB;AACA,aAAO;AACL/2C,QAAAA,IAAI,EAAEu5C,IADD;AAELt9B,QAAAA,KAAK,EAAExpB,GAAG,CAACwpB,KAAJ,GAAY;AAFd,OAAP;AAID,KANkB,EAMhB;AACDjc,MAAAA,IAAI,EAAEA,IADL;AAEDic,MAAAA,KAAK,EAAE;AAFN,KANgB,CAAL,CASXjc,IATH;AAUA,WAAOg5C,MAAM,CAACM,OAAD,EAAUl4C,OAAO,CAAC,CAAD,CAAP,CAAWhB,GAArB,EAA0Bi5C,WAA1B,CAAb;AACD,GAfD;;AAgBA,MAAIM,oBAAoB,GAAG,UAAU35C,IAAV,EAAgB05C,aAAhB,EAA+BtmD,UAA/B,EAA2Cm7C,WAA3C,EAAwD;AACjF,QAAIntC,OAAO,GAAGs4C,aAAa,CAACt4C,OAA5B;AACA,QAAInJ,MAAM,GAAGmJ,OAAO,CAACA,OAAO,CAAC5T,MAAR,GAAiB,CAAlB,CAApB;AACA,QAAI6rD,WAAW,GAAGphD,MAAM,CAACoI,MAAP,GAAgBpI,MAAM,CAACuI,OAAzC;AACA,QAAIN,OAAO,GAAGo2C,aAAa,CAACl1C,OAAD,CAA3B;AACA,QAAIk4C,OAAO,GAAG9mD,KAAK,CAAC0N,OAAD,EAAU,UAAUq5C,IAAV,EAAgBn+B,GAAhB,EAAqB;AAChD,aAAOu6B,cAAc,CAAC4D,IAAD,EAAOF,WAAP,EAAoBj+B,GAAG,CAAC/a,MAAxB,EAAgCjN,UAAhC,EAA4Cm7C,WAAW,CAACwI,SAAxD,CAArB;AACD,KAFkB,EAEhB/2C,IAFgB,CAAnB;AAGA,WAAOg5C,MAAM,CAACM,OAAD,EAAUl4C,OAAO,CAAC,CAAD,CAAP,CAAWhB,GAArB,EAA0Bi5C,WAA1B,CAAb;AACD,GATD;;AAUA,MAAIO,eAAe,GAAG,UAAU55C,IAAV,EAAgBM,MAAhB,EAAwBlN,UAAxB,EAAoCm7C,WAApC,EAAiD;AACrE,QAAI+K,OAAO,GAAGlD,UAAU,CAACp2C,IAAD,EAAOM,MAAM,CAACF,GAAd,EAAmBhN,UAAnB,EAA+Bm7C,WAAW,CAAC2I,aAA3C,CAAxB;AACA,WAAO8B,MAAM,CAACM,OAAD,EAAUh5C,MAAM,CAACF,GAAjB,EAAsBE,MAAM,CAACD,MAA7B,CAAb;AACD,GAHD;;AAIA,MAAIw5C,gBAAgB,GAAG,UAAUC,WAAV,EAAuB14C,OAAvB,EAAgChO,UAAhC,EAA4Cm7C,WAA5C,EAAyD;AAC9E,QAAItuC,IAAI,GAAGg5C,UAAU,CAAC73C,OAAD,CAArB;;AACA,QAAI24C,QAAQ,GAAG,UAAUC,WAAV,EAAuB55C,GAAvB,EAA4B;AACzC,aAAOg2C,UAAU,CAAC4D,WAAD,EAAc55C,GAAG,CAACA,GAAlB,EAAuBhN,UAAvB,EAAmCm7C,WAAW,CAAC2I,aAA/C,CAAjB;AACD,KAFD;;AAGA,QAAIoC,OAAO,GAAG5mD,KAAK,CAACuN,IAAD,EAAO85C,QAAP,EAAiBD,WAAjB,CAAnB;AACA,WAAOd,MAAM,CAACM,OAAD,EAAUl4C,OAAO,CAAC,CAAD,CAAP,CAAWhB,GAArB,EAA0BgB,OAAO,CAAC,CAAD,CAAP,CAAWf,MAArC,CAAb;AACD,GAPD;;AAQA,MAAI45C,kBAAkB,GAAG,UAAUH,WAAV,EAAuBx5C,MAAvB,EAA+BlN,UAA/B,EAA2Cm7C,WAA3C,EAAwD;AAC/E,QAAI+K,OAAO,GAAGpD,aAAa,CAAC4D,WAAD,EAAcx5C,MAAM,CAACD,MAArB,EAA6BjN,UAA7B,EAAyCm7C,WAAW,CAAC2I,aAArD,CAA3B;AACA,WAAO8B,MAAM,CAACM,OAAD,EAAUh5C,MAAM,CAACF,GAAjB,EAAsBE,MAAM,CAACD,MAA7B,CAAb;AACD,GAHD;;AAIA,MAAI65C,mBAAmB,GAAG,UAAUJ,WAAV,EAAuB14C,OAAvB,EAAgChO,UAAhC,EAA4Cm7C,WAA5C,EAAyD;AACjF,QAAIruC,OAAO,GAAGo2C,aAAa,CAACl1C,OAAD,CAA3B;;AACA,QAAI24C,QAAQ,GAAG,UAAUC,WAAV,EAAuB35C,MAAvB,EAA+B;AAC5C,aAAO61C,aAAa,CAAC8D,WAAD,EAAc35C,MAAM,CAACA,MAArB,EAA6BjN,UAA7B,EAAyCm7C,WAAW,CAAC2I,aAArD,CAApB;AACD,KAFD;;AAGA,QAAIoC,OAAO,GAAG5mD,KAAK,CAACwN,OAAD,EAAU65C,QAAV,EAAoBD,WAApB,CAAnB;AACA,WAAOd,MAAM,CAACM,OAAD,EAAUl4C,OAAO,CAAC,CAAD,CAAP,CAAWhB,GAArB,EAA0BgB,OAAO,CAAC,CAAD,CAAP,CAAWf,MAArC,CAAb;AACD,GAPD;;AAQA,MAAI85C,iBAAiB,GAAG,UAAUn6C,IAAV,EAAgBM,MAAhB,EAAwBlN,UAAxB,EAAoCm7C,WAApC,EAAiD;AACvE,QAAI+K,OAAO,GAAGlD,UAAU,CAACp2C,IAAD,EAAOM,MAAM,CAACF,GAAd,EAAmBhN,UAAnB,EAA+Bm7C,WAAW,CAAC2I,aAA3C,CAAxB;AACA,WAAO8B,MAAM,CAACM,OAAD,EAAUh5C,MAAM,CAACF,GAAjB,EAAsBE,MAAM,CAACD,MAA7B,CAAb;AACD,GAHD;;AAIA,MAAI+5C,kBAAkB,GAAG,UAAUN,WAAV,EAAuB14C,OAAvB,EAAgChO,UAAhC,EAA4Cm7C,WAA5C,EAAyD;AAChF,QAAItuC,IAAI,GAAGg5C,UAAU,CAAC73C,OAAD,CAArB;;AACA,QAAI24C,QAAQ,GAAG,UAAUC,WAAV,EAAuB55C,GAAvB,EAA4B;AACzC,aAAOg2C,UAAU,CAAC4D,WAAD,EAAc55C,GAAG,CAACA,GAAlB,EAAuBhN,UAAvB,EAAmCm7C,WAAW,CAAC2I,aAA/C,CAAjB;AACD,KAFD;;AAGA,QAAIoC,OAAO,GAAG5mD,KAAK,CAACuN,IAAD,EAAO85C,QAAP,EAAiBD,WAAjB,CAAnB;AACA,WAAOd,MAAM,CAACM,OAAD,EAAUl4C,OAAO,CAAC,CAAD,CAAP,CAAWhB,GAArB,EAA0BgB,OAAO,CAAC,CAAD,CAAP,CAAWf,MAArC,CAAb;AACD,GAPD;;AAQA,MAAIg6C,oBAAoB,GAAG,UAAUP,WAAV,EAAuBx5C,MAAvB,EAA+BlN,UAA/B,EAA2Cm7C,WAA3C,EAAwD;AACjF,QAAI+K,OAAO,GAAGpD,aAAa,CAAC4D,WAAD,EAAcx5C,MAAM,CAACD,MAArB,EAA6BjN,UAA7B,EAAyCm7C,WAAW,CAAC2I,aAArD,CAA3B;AACA,WAAO8B,MAAM,CAACM,OAAD,EAAUh5C,MAAM,CAACF,GAAjB,EAAsBE,MAAM,CAACD,MAA7B,CAAb;AACD,GAHD;;AAIA,MAAIi6C,qBAAqB,GAAG,UAAUR,WAAV,EAAuB14C,OAAvB,EAAgChO,UAAhC,EAA4Cm7C,WAA5C,EAAyD;AACnF,QAAIruC,OAAO,GAAGo2C,aAAa,CAACl1C,OAAD,CAA3B;;AACA,QAAI24C,QAAQ,GAAG,UAAUC,WAAV,EAAuB35C,MAAvB,EAA+B;AAC5C,aAAO61C,aAAa,CAAC8D,WAAD,EAAc35C,MAAM,CAACA,MAArB,EAA6BjN,UAA7B,EAAyCm7C,WAAW,CAAC2I,aAArD,CAApB;AACD,KAFD;;AAGA,QAAIoC,OAAO,GAAG5mD,KAAK,CAACwN,OAAD,EAAU65C,QAAV,EAAoBD,WAApB,CAAnB;AACA,WAAOd,MAAM,CAACM,OAAD,EAAUl4C,OAAO,CAAC,CAAD,CAAP,CAAWhB,GAArB,EAA0BgB,OAAO,CAAC,CAAD,CAAP,CAAWf,MAArC,CAAb;AACD,GAPD;;AAQA,MAAIk6C,cAAc,GAAG,UAAUv6C,IAAV,EAAgB05C,aAAhB,EAA+Bc,WAA/B,EAA4CC,YAA5C,EAA0D;AAC7E,QAAIv6C,OAAO,GAAGo2C,aAAa,CAACoD,aAAa,CAACt4C,OAAf,CAA3B;AACA,QAAIk4C,OAAO,GAAG1D,eAAe,CAAC51C,IAAD,EAAOhQ,GAAG,CAACkQ,OAAD,EAAU,UAAUG,MAAV,EAAkB;AACjE,aAAOA,MAAM,CAACA,MAAd;AACD,KAFsC,CAAV,CAA7B;AAGA,QAAIquC,MAAM,GAAGoK,eAAe,CAACQ,OAAD,EAAUp5C,OAAO,CAAC,CAAD,CAAP,CAAWE,GAArB,EAA0BF,OAAO,CAAC,CAAD,CAAP,CAAWG,MAArC,CAA5B;AACA,WAAOw4C,OAAO,CAACS,OAAD,EAAU5K,MAAV,CAAd;AACD,GAPD;;AAQA,MAAIgM,WAAW,GAAG,UAAU16C,IAAV,EAAgBoB,OAAhB,EAAyBo5C,WAAzB,EAAsCC,YAAtC,EAAoD;AACpE,QAAIx6C,IAAI,GAAGg5C,UAAU,CAAC73C,OAAD,CAArB;AACA,QAAIk4C,OAAO,GAAGzD,YAAY,CAAC71C,IAAD,EAAOC,IAAI,CAAC,CAAD,CAAJ,CAAQG,GAAf,EAAoBH,IAAI,CAACA,IAAI,CAACzS,MAAL,GAAc,CAAf,CAAJ,CAAsB4S,GAA1C,CAA1B;AACA,QAAIsuC,MAAM,GAAGoK,eAAe,CAACQ,OAAD,EAAUl4C,OAAO,CAAC,CAAD,CAAP,CAAWhB,GAArB,EAA0BgB,OAAO,CAAC,CAAD,CAAP,CAAWf,MAArC,CAA5B;AACA,WAAOw4C,OAAO,CAACS,OAAD,EAAU5K,MAAV,CAAd;AACD,GALD;;AAMA,MAAIiM,YAAY,GAAG,UAAU36C,IAAV,EAAgBytB,QAAhB,EAA0Br6B,UAA1B,EAAsCm7C,WAAtC,EAAmD;AACpE,QAAIztC,KAAK,GAAG2sB,QAAQ,CAAC3sB,KAArB;AACAq3C,IAAAA,OAAO,CAACr3C,KAAD,CAAP;AACA,QAAIw4C,OAAO,GAAG3J,KAAK,CAAC3vC,IAAD,EAAOytB,QAAQ,CAACpsB,MAAhB,EAAwBjO,UAAxB,EAAoCm7C,WAAW,CAACoB,KAAZ,CAAkB7uC,KAAlB,CAApC,CAAnB;AACA,WAAO+3C,OAAO,CAACS,OAAD,EAAUpoD,QAAQ,CAACD,IAAT,CAAc6P,KAAK,CAAC,CAAD,CAAnB,CAAV,CAAd;AACD,GALD;;AAMA,MAAI85C,cAAc,GAAG,UAAU56C,IAAV,EAAgBstB,UAAhB,EAA4Bl6B,UAA5B,EAAwCm7C,WAAxC,EAAqD;AACxE,QAAIsM,SAAS,GAAG,UAAU7pD,CAAV,EAAasX,IAAb,EAAmB;AACjC,aAAOunC,OAAO,CAAC7+C,CAAD,EAAIsX,IAAJ,EAAUlV,UAAV,EAAsBm7C,WAAW,CAACsB,OAAZ,CAAoBvnC,IAApB,CAAtB,CAAd;AACD,KAFD;;AAGA,QAAIgxC,OAAO,GAAG9mD,KAAK,CAAC86B,UAAD,EAAautB,SAAb,EAAwB76C,IAAxB,CAAnB;AACA,WAAO64C,OAAO,CAACS,OAAD,EAAUpoD,QAAQ,CAACD,IAAT,CAAcq8B,UAAU,CAAC,CAAD,CAAxB,CAAV,CAAd;AACD,GAND;;AAOA,MAAIwtB,YAAY,GAAG,UAAU96C,IAAV,EAAgB+6C,YAAhB,EAA8B3nD,UAA9B,EAA0CqnD,YAA1C,EAAwD;AACzE,QAAIO,OAAO,GAAG,UAAUxxC,KAAV,EAAiBklB,UAAjB,EAA6B;AACzC,UAAIusB,EAAE,GAAGptC,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAT;AACA,aAAO8jC,MAAM,CAAC2N,EAAD,EAAKvsB,UAAL,EAAiB,IAAjB,CAAb;AACD,KAHD;;AAIA,QAAI+iB,KAAK,GAAGuJ,OAAO,CAACD,YAAY,CAACtsB,SAAd,EAAyBssB,YAAY,CAACrsB,UAAtC,CAAnB;AACA,QAAI6iB,YAAY,GAAGpxC,OAAO,CAAC46C,YAAY,CAAC36C,GAAd,EAAmB26C,YAAY,CAAC16C,MAAhC,CAA1B;AACA,QAAI66C,UAAU,GAAG7G,OAAO,CAAC9C,YAAD,EAAevxC,IAAf,EAAqByxC,KAArB,EAA4BsJ,YAAY,CAACrsB,UAAzC,EAAqDt7B,UAArD,CAAxB;AACA,WAAO8nD,UAAU,CAAC7rD,IAAX,CAAgB,YAAY;AACjC,aAAOwpD,OAAO,CAAC74C,IAAD,EAAO9O,QAAQ,CAACR,IAAT,CAAcqqD,YAAY,CAAC59C,OAA3B,CAAP,CAAd;AACD,KAFM,EAEJ,UAAUm8C,OAAV,EAAmB;AACpB,UAAI5K,MAAM,GAAGoK,eAAe,CAACQ,OAAD,EAAUyB,YAAY,CAAC36C,GAAvB,EAA4B26C,YAAY,CAAC16C,MAAzC,CAA5B;AACA,aAAOw4C,OAAO,CAACS,OAAD,EAAU5K,MAAV,CAAd;AACD,KALM,CAAP;AAMD,GAdD;;AAeA,MAAIyM,WAAW,GAAG,UAAUl7C,IAAV,EAAgByuB,UAAhB,EAA4BkC,OAA5B,EAAqC;AACrD,QAAImqB,YAAY,GAAG9wC,cAAc,CAAChK,IAAD,EAAO2wB,OAAO,CAAC7vB,OAAf,CAAjC;AACA,QAAIk6C,EAAE,GAAGptC,SAAS,CAACvB,QAAV,CAAmByuC,YAAnB,CAAT;AACA,WAAOzN,MAAM,CAAC2N,EAAD,EAAKvsB,UAAL,EAAiB,IAAjB,CAAb;AACD,GAJD;;AAKA,MAAI0sB,iBAAiB,GAAG,UAAUp7C,IAAV,EAAgB+6C,YAAhB,EAA8B3nD,UAA9B,EAA0CqnD,YAA1C,EAAwD;AAC9E,QAAIx6C,IAAI,GAAG8K,kBAAkB,CAAC/K,IAAD,CAAlB,CAAyBC,IAApC;AACA,QAAIuD,KAAK,GAAGu3C,YAAY,CAACj6C,KAAb,CAAmB,CAAnB,EAAsBT,MAAlC;AACA,QAAIuwB,OAAO,GAAG3wB,IAAI,CAAC86C,YAAY,CAACj6C,KAAb,CAAmB,CAAnB,EAAsBV,GAAvB,CAAlB;AACA,QAAIqxC,KAAK,GAAG0J,WAAW,CAACJ,YAAY,CAACtsB,SAAd,EAAyBssB,YAAY,CAACrsB,UAAtC,EAAkDkC,OAAlD,CAAvB;AACA,QAAIsqB,UAAU,GAAGvG,UAAU,CAACnxC,KAAD,EAAQxD,IAAR,EAAcyxC,KAAd,EAAqBsJ,YAAY,CAACrsB,UAAlC,EAA8Ct7B,UAA9C,CAA3B;AACA,QAAIs7C,MAAM,GAAGoK,eAAe,CAACoC,UAAD,EAAaH,YAAY,CAACj6C,KAAb,CAAmB,CAAnB,EAAsBV,GAAnC,EAAwC26C,YAAY,CAACj6C,KAAb,CAAmB,CAAnB,EAAsBT,MAA9D,CAA5B;AACA,WAAOw4C,OAAO,CAACqC,UAAD,EAAaxM,MAAb,CAAd;AACD,GARD;;AASA,MAAI2M,gBAAgB,GAAG,UAAUr7C,IAAV,EAAgB+6C,YAAhB,EAA8B3nD,UAA9B,EAA0CqnD,YAA1C,EAAwD;AAC7E,QAAIx6C,IAAI,GAAG8K,kBAAkB,CAAC/K,IAAD,CAAlB,CAAyBC,IAApC;AACA,QAAIuD,KAAK,GAAGu3C,YAAY,CAACj6C,KAAb,CAAmBi6C,YAAY,CAACj6C,KAAb,CAAmBtT,MAAnB,GAA4B,CAA/C,EAAkD6S,MAAlD,GAA2D06C,YAAY,CAACj6C,KAAb,CAAmBi6C,YAAY,CAACj6C,KAAb,CAAmBtT,MAAnB,GAA4B,CAA/C,EAAkDgT,OAAzH;AACA,QAAIowB,OAAO,GAAG3wB,IAAI,CAAC86C,YAAY,CAACj6C,KAAb,CAAmB,CAAnB,EAAsBV,GAAvB,CAAlB;AACA,QAAIqxC,KAAK,GAAG0J,WAAW,CAACJ,YAAY,CAACtsB,SAAd,EAAyBssB,YAAY,CAACrsB,UAAtC,EAAkDkC,OAAlD,CAAvB;AACA,QAAIsqB,UAAU,GAAGvG,UAAU,CAACnxC,KAAD,EAAQxD,IAAR,EAAcyxC,KAAd,EAAqBsJ,YAAY,CAACrsB,UAAlC,EAA8Ct7B,UAA9C,CAA3B;AACA,QAAIs7C,MAAM,GAAGoK,eAAe,CAACoC,UAAD,EAAaH,YAAY,CAACj6C,KAAb,CAAmB,CAAnB,EAAsBV,GAAnC,EAAwC26C,YAAY,CAACj6C,KAAb,CAAmB,CAAnB,EAAsBT,MAA9D,CAA5B;AACA,WAAOw4C,OAAO,CAACqC,UAAD,EAAaxM,MAAb,CAAd;AACD,GARD;;AASA,MAAI4M,iBAAiB,GAAG,UAAUt7C,IAAV,EAAgB+6C,YAAhB,EAA8B3nD,UAA9B,EAA0CqnD,YAA1C,EAAwD;AAC9E,QAAIx6C,IAAI,GAAG8K,kBAAkB,CAAC/K,IAAD,CAAlB,CAAyBC,IAApC;AACA,QAAIuD,KAAK,GAAGu3C,YAAY,CAACj6C,KAAb,CAAmB,CAAnB,EAAsBV,GAAlC;AACA,QAAIwwB,OAAO,GAAG3wB,IAAI,CAACuD,KAAD,CAAlB;AACA,QAAIiuC,KAAK,GAAG0J,WAAW,CAACJ,YAAY,CAACtsB,SAAd,EAAyBssB,YAAY,CAACrsB,UAAtC,EAAkDkC,OAAlD,CAAvB;AACA,QAAIsqB,UAAU,GAAGnG,UAAU,CAACvxC,KAAD,EAAQxD,IAAR,EAAcyxC,KAAd,EAAqBsJ,YAAY,CAACrsB,UAAlC,EAA8Ct7B,UAA9C,CAA3B;AACA,QAAIs7C,MAAM,GAAGoK,eAAe,CAACoC,UAAD,EAAaH,YAAY,CAACj6C,KAAb,CAAmB,CAAnB,EAAsBV,GAAnC,EAAwC26C,YAAY,CAACj6C,KAAb,CAAmB,CAAnB,EAAsBT,MAA9D,CAA5B;AACA,WAAOw4C,OAAO,CAACqC,UAAD,EAAaxM,MAAb,CAAd;AACD,GARD;;AASA,MAAI6M,gBAAgB,GAAG,UAAUv7C,IAAV,EAAgB+6C,YAAhB,EAA8B3nD,UAA9B,EAA0CqnD,YAA1C,EAAwD;AAC7E,QAAIx6C,IAAI,GAAG8K,kBAAkB,CAAC/K,IAAD,CAAlB,CAAyBC,IAApC;AACA,QAAIuD,KAAK,GAAGu3C,YAAY,CAACj6C,KAAb,CAAmBi6C,YAAY,CAACj6C,KAAb,CAAmBtT,MAAnB,GAA4B,CAA/C,EAAkD4S,GAAlD,GAAwD26C,YAAY,CAACj6C,KAAb,CAAmBi6C,YAAY,CAACj6C,KAAb,CAAmBtT,MAAnB,GAA4B,CAA/C,EAAkD+S,OAAtH;AACA,QAAIqwB,OAAO,GAAG3wB,IAAI,CAAC86C,YAAY,CAACj6C,KAAb,CAAmB,CAAnB,EAAsBV,GAAvB,CAAlB;AACA,QAAIqxC,KAAK,GAAG0J,WAAW,CAACJ,YAAY,CAACtsB,SAAd,EAAyBssB,YAAY,CAACrsB,UAAtC,EAAkDkC,OAAlD,CAAvB;AACA,QAAIsqB,UAAU,GAAGnG,UAAU,CAACvxC,KAAD,EAAQxD,IAAR,EAAcyxC,KAAd,EAAqBsJ,YAAY,CAACrsB,UAAlC,EAA8Ct7B,UAA9C,CAA3B;AACA,QAAIs7C,MAAM,GAAGoK,eAAe,CAACoC,UAAD,EAAaH,YAAY,CAACj6C,KAAb,CAAmB,CAAnB,EAAsBV,GAAnC,EAAwC26C,YAAY,CAACj6C,KAAb,CAAmB,CAAnB,EAAsBT,MAA9D,CAA5B;AACA,WAAOw4C,OAAO,CAACqC,UAAD,EAAaxM,MAAb,CAAd;AACD,GARD;;AASA,MAAI8M,eAAe,GAAG,UAAUhyC,KAAV,EAAiBvR,MAAjB,EAAyB;AAC7C,QAAImwB,KAAK,GAAGva,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAZ;AACA,QAAIpI,OAAO,GAAG+tC,OAAO,CAAC/mB,KAAD,EAAQnwB,MAAR,CAArB;AACA,WAAOmJ,OAAO,CAAClR,IAAR,CAAa,UAAUg4B,aAAV,EAAyB;AAC3C,UAAIuzB,gBAAgB,GAAGvzB,aAAa,CAACA,aAAa,CAAC16B,MAAd,GAAuB,CAAxB,CAApC;AACA,UAAIkuD,WAAW,GAAGxzB,aAAa,CAAC,CAAD,CAAb,CAAiB7nB,MAAnC;AACA,UAAIs7C,WAAW,GAAGF,gBAAgB,CAACp7C,MAAjB,GAA0Bo7C,gBAAgB,CAACj7C,OAA7D;AACA,UAAIo7C,mBAAmB,GAAG7oD,OAAO,CAAC/C,GAAG,CAACo4B,KAAK,CAACj6B,GAAP,EAAY,UAAUiS,GAAV,EAAe;AAC9D,eAAO/P,MAAM,CAAC+P,GAAG,CAACU,KAAL,EAAY,UAAUwH,IAAV,EAAgB;AACvC,iBAAOA,IAAI,CAACjI,MAAL,IAAeq7C,WAAf,IAA8BpzC,IAAI,CAACjI,MAAL,GAAcs7C,WAAnD;AACD,SAFY,CAAb;AAGD,OAJoC,CAAJ,CAAjC;AAKA,aAAOE,YAAY,CAACD,mBAAD,EAAsB,UAAUtzC,IAAV,EAAgB;AACvD,eAAOvc,IAAI,CAACuc,IAAI,CAACnL,OAAN,CAAJ,KAAuB,IAA9B;AACD,OAFkB,CAAnB;AAGD,KAZM,EAYJ1N,KAZI,CAYE,EAZF,CAAP;AAaD,GAhBD;;AAiBA,MAAIosD,YAAY,GAAG,UAAU/6C,KAAV,EAAiBg7C,UAAjB,EAA6B;AAC9C,QAAIC,WAAW,GAAG1rD,MAAM,CAACyQ,KAAD,EAAQg7C,UAAR,CAAxB;;AACA,QAAIC,WAAW,CAACvuD,MAAZ,KAAuB,CAA3B,EAA8B;AAC5B,aAAO0D,QAAQ,CAACR,IAAT,CAAc,IAAd,CAAP;AACD,KAFD,MAEO,IAAIqrD,WAAW,CAACvuD,MAAZ,KAAuBsT,KAAK,CAACtT,MAAjC,EAAyC;AAC9C,aAAO0D,QAAQ,CAACR,IAAT,CAAc,IAAd,CAAP;AACD,KAFM,MAEA;AACL,aAAOQ,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,GATD;;AAUA,MAAI+hC,MAAM,GAAG2C,aAAb;AACA,MAAI0oB,6BAA6B,GAAGlpB,2BAApC;;AACA,MAAImpB,mBAAmB,GAAG,UAAUhN,UAAV,EAAsB7tC,OAAtB,EAA+B;AACvD,WAAOjR,MAAM,CAACiR,OAAD,EAAU,UAAUd,MAAV,EAAkB;AACvC,aAAOA,MAAM,CAACD,MAAP,KAAkB,CAAlB,IAAuBC,MAAM,CAACM,QAArC;AACD,KAFY,CAAb;AAGD,GAJD;;AAKA,MAAIs7C,kBAAkB,GAAG,UAAUvwC,SAAV,EAAqBvK,OAArB,EAA8B;AACrD,WAAOjR,MAAM,CAACiR,OAAD,EAAU,UAAUd,MAAV,EAAkB;AACvC,aAAOA,MAAM,CAACD,MAAP,GAAgBC,MAAM,CAACE,OAAvB,IAAkCmL,SAAS,CAAC3L,IAAV,CAAeE,OAAjD,IAA4DI,MAAM,CAACM,QAA1E;AACD,KAFY,CAAb;AAGD,GAJD;;AAKA,MAAIu7C,eAAe,GAAG,UAAUxwC,SAAV,EAAqBvK,OAArB,EAA8B;AAClD,QAAIlB,OAAO,GAAG+a,SAAS,CAACtP,SAAD,CAAvB;AACA,QAAIywC,UAAU,GAAG9F,aAAa,CAACl1C,OAAD,CAA9B;AACA,WAAO1O,KAAK,CAAC0pD,UAAD,EAAa,UAAU3pD,GAAV,EAAe6N,MAAf,EAAuB;AAC9C,UAAID,MAAM,GAAGH,OAAO,CAACI,MAAM,CAACD,MAAR,CAApB;AACA,UAAIg8C,QAAQ,GAAGh8C,MAAM,CAACrQ,GAAP,CAAWuqB,QAAX,EAAqB9qB,KAArB,CAA2B,CAA3B,CAAf;AACA,aAAOgD,GAAG,GAAG4pD,QAAb;AACD,KAJW,EAIT,CAJS,CAAZ;AAKD,GARD;;AASA,MAAIC,sBAAsB,GAAG,UAAUjyC,MAAV,EAAkB;AAC7C,WAAO,UAAUsB,SAAV,EAAqB1T,MAArB,EAA6B;AAClC,aAAOk3C,OAAO,CAACxjC,SAAD,EAAY1T,MAAZ,CAAP,CAA2B5H,MAA3B,CAAkC,UAAU+Q,OAAV,EAAmB;AAC1D,YAAIm7C,WAAW,GAAGlyC,MAAM,GAAG4xC,mBAAH,GAAyBC,kBAAjD;AACA,eAAO,CAACK,WAAW,CAAC5wC,SAAD,EAAYvK,OAAZ,CAAnB;AACD,OAHM,EAGJpR,GAHI,CAGA,UAAUoR,OAAV,EAAmB;AACxB,eAAO;AACLA,UAAAA,OAAO,EAAEA,OADJ;AAELiyB,UAAAA,UAAU,EAAE8oB,eAAe,CAACxwC,SAAD,EAAYvK,OAAZ;AAFtB,SAAP;AAID,OARM,CAAP;AASD,KAVD;AAWD,GAZD;;AAaA,MAAIo7C,qBAAqB,GAAG,UAAU7wC,SAAV,EAAqB1T,MAArB,EAA6B;AACvD,WAAOo3C,eAAe,CAAC1jC,SAAD,EAAY1T,MAAZ,CAAf,CAAmCjI,GAAnC,CAAuC,UAAUoR,OAAV,EAAmB;AAC/D,aAAO;AACLA,QAAAA,OAAO,EAAEA,OADJ;AAELiyB,QAAAA,UAAU,EAAE,CAAC8oB,eAAe,CAACxwC,SAAD,EAAYvK,OAAZ;AAFvB,OAAP;AAID,KALM,CAAP;AAMD,GAPD;;AAQA,MAAIq7C,qBAAqB,GAAG,UAAUpyC,MAAV,EAAkB;AAC5C,WAAO,UAAUsB,SAAV,EAAqB1T,MAArB,EAA6B;AAClC,aAAO82C,eAAe,CAACpjC,SAAD,EAAY1T,MAAZ,CAAf,CAAmC5H,MAAnC,CAA0C,UAAU+Q,OAAV,EAAmB;AAClE,YAAIm7C,WAAW,GAAGlyC,MAAM,GAAG4xC,mBAAH,GAAyBC,kBAAjD;AACA,eAAO,CAACK,WAAW,CAAC5wC,SAAD,EAAYvK,OAAO,CAACN,KAApB,CAAnB;AACD,OAHM,CAAP;AAID,KALD;AAMD,GAPD;;AAQA,MAAI47C,gBAAgB,GAAGvO,GAAG,CAACiL,kBAAD,EAAqBjK,OAArB,EAA8BliD,IAA9B,EAAoCA,IAApC,EAA0CyqD,UAAU,CAACf,YAArD,CAA1B;AACA,MAAIgG,eAAe,GAAGxO,GAAG,CAACqL,iBAAD,EAAoBrK,OAApB,EAA6BliD,IAA7B,EAAmCA,IAAnC,EAAyCyqD,UAAU,CAACf,YAApD,CAAzB;AACA,MAAIiG,mBAAmB,GAAGzO,GAAG,CAACsL,qBAAD,EAAwB6C,sBAAsB,CAAC,IAAD,CAA9C,EAAsDN,6BAAtD,EAAqF/uD,IAArF,EAA2FyqD,UAAU,CAACf,YAAtG,CAA7B;AACA,MAAIkG,kBAAkB,GAAG1O,GAAG,CAACwL,oBAAD,EAAuB2C,sBAAsB,CAAC,KAAD,CAA7C,EAAsDN,6BAAtD,EAAqF/uD,IAArF,EAA2FyqD,UAAU,CAACf,YAAtG,CAA5B;AACA,MAAImG,YAAY,GAAG3O,GAAG,CAACoM,cAAD,EAAiBiC,qBAAjB,EAAwCR,6BAAxC,EAAuEznC,KAAvE,EAA8EmjC,UAAU,CAACf,YAAzF,CAAtB;AACA,MAAIoG,SAAS,GAAG5O,GAAG,CAACuM,WAAD,EAAcvL,OAAd,EAAuBliD,IAAvB,EAA6BsnB,KAA7B,EAAoCmjC,UAAU,CAACf,YAA/C,CAAnB;AACA,MAAIqG,gBAAgB,GAAG7O,GAAG,CAAC8L,kBAAD,EAAqB7K,cAArB,EAAqCniD,IAArC,EAA2CA,IAA3C,EAAiDyqD,UAAU,CAAC1X,SAAX,CAAqB,KAArB,EAA4B,IAA5B,CAAjD,CAA1B;AACA,MAAIid,iBAAiB,GAAG9O,GAAG,CAAC+L,mBAAD,EAAsB7K,eAAtB,EAAuCpiD,IAAvC,EAA6CA,IAA7C,EAAmDyqD,UAAU,CAAC1X,SAAX,CAAqB,KAArB,EAA4B,IAA5B,CAAnD,CAA3B;AACA,MAAIkd,kBAAkB,GAAG/O,GAAG,CAACkM,oBAAD,EAAuBjL,cAAvB,EAAuCniD,IAAvC,EAA6CA,IAA7C,EAAmDyqD,UAAU,CAAC1X,SAAX,CAAqB,IAArB,EAA2B,IAA3B,CAAnD,CAA5B;AACA,MAAImd,mBAAmB,GAAGhP,GAAG,CAACmM,qBAAD,EAAwBjL,eAAxB,EAAyCpiD,IAAzC,EAA+CA,IAA/C,EAAqDyqD,UAAU,CAAC1X,SAAX,CAAqB,IAArB,EAA2B,IAA3B,CAArD,CAA7B;AACA,MAAIod,aAAa,GAAGjP,GAAG,CAACyL,eAAD,EAAkB/K,MAAlB,EAA0B5hD,IAA1B,EAAgCA,IAAhC,EAAsCyqD,UAAU,CAAC1X,SAAX,CAAqB,KAArB,EAA4B,IAA5B,CAAtC,CAAvB;AACA,MAAIqd,cAAc,GAAGlP,GAAG,CAAC0L,gBAAD,EAAmB1K,OAAnB,EAA4BliD,IAA5B,EAAkCA,IAAlC,EAAwCyqD,UAAU,CAAC1X,SAAX,CAAqB,KAArB,EAA4B,IAA5B,CAAxC,CAAxB;AACA,MAAIsd,eAAe,GAAGnP,GAAG,CAACgM,iBAAD,EAAoBtL,MAApB,EAA4B5hD,IAA5B,EAAkCA,IAAlC,EAAwCyqD,UAAU,CAAC1X,SAAX,CAAqB,IAArB,EAA2B,IAA3B,CAAxC,CAAzB;AACA,MAAIud,gBAAgB,GAAGpP,GAAG,CAACiM,kBAAD,EAAqBjL,OAArB,EAA8BliD,IAA9B,EAAoCA,IAApC,EAA0CyqD,UAAU,CAAC1X,SAAX,CAAqB,IAArB,EAA2B,IAA3B,CAA1C,CAA1B;AACA,MAAIwd,UAAU,GAAGrP,GAAG,CAACwM,YAAD,EAAenL,kBAAf,EAAmC7e,MAAnC,EAA2C1jC,IAA3C,EAAiDyqD,UAAU,CAACN,OAA5D,CAApB;AACA,MAAIqG,YAAY,GAAGtP,GAAG,CAACyM,cAAD,EAAiBlL,oBAAjB,EAAuC/e,MAAvC,EAA+C1jC,IAA/C,EAAqDyqD,UAAU,CAACN,OAAhE,CAAtB;AACA,MAAIrnB,UAAU,GAAGoe,GAAG,CAAC2M,YAAD,EAAehM,OAAf,EAAwBne,MAAxB,EAAgC1jC,IAAhC,EAAsCyqD,UAAU,CAACf,YAAjD,CAApB;AACA,MAAI+G,eAAe,GAAGvP,GAAG,CAACiN,iBAAD,EAAoBqB,qBAAqB,CAAC,IAAD,CAAzC,EAAiDxvD,IAAjD,EAAuDA,IAAvD,EAA6DyqD,UAAU,CAACf,YAAxE,CAAzB;AACA,MAAIgH,cAAc,GAAGxP,GAAG,CAACkN,gBAAD,EAAmBoB,qBAAqB,CAAC,KAAD,CAAxC,EAAiDxvD,IAAjD,EAAuDA,IAAvD,EAA6DyqD,UAAU,CAACf,YAAxE,CAAxB;AACA,MAAIiH,eAAe,GAAGzP,GAAG,CAACmN,iBAAD,EAAoBvM,eAApB,EAAqC9hD,IAArC,EAA2CA,IAA3C,EAAiDyqD,UAAU,CAACf,YAA5D,CAAzB;AACA,MAAIkH,cAAc,GAAG1P,GAAG,CAACoN,gBAAD,EAAmBxM,eAAnB,EAAoC9hD,IAApC,EAA0CA,IAA1C,EAAgDyqD,UAAU,CAACf,YAA3D,CAAxB;AACA,MAAImH,aAAa,GAAGtC,eAApB;;AAEA,MAAI7xC,UAAU,GAAG,UAAUP,GAAV,EAAe;AAC9B,WAAOijB,WAAW,CAACjjB,GAAG,CAACxG,UAAL,CAAlB;AACD,GAFD;;AAGA,MAAIm7C,oBAAoB,GAAG,UAAUh9C,OAAV,EAAmB;AAC5C,QAAIA,OAAO,KAAK,OAAhB,EAAyB;AACvB,aAAO,QAAP;AACD,KAFD,MAEO,IAAIA,OAAO,KAAK,OAAhB,EAAyB;AAC9B,aAAO,QAAP;AACD,KAFM,MAEA;AACL,aAAO,MAAP;AACD;AACF,GARD;;AASA,MAAIi9C,eAAe,GAAG,UAAUzxB,MAAV,EAAkBnjB,GAAlB,EAAuB;AAC3C,QAAI60C,OAAO,GAAGt0C,UAAU,CAACP,GAAD,CAAV,KAAoB,OAAlC;AACA,QAAI80C,cAAc,GAAG,CAAC/tD,MAAM,CAACiZ,GAAG,CAACtI,KAAL,EAAY,UAAU8a,CAAV,EAAa;AACnD,aAAOyQ,WAAW,CAACzQ,CAAD,CAAX,KAAmB,IAA1B;AACD,KAF2B,CAA5B;AAGA,WAAOqiC,OAAO,IAAIC,cAAX,GAA4BhtD,QAAQ,CAACR,IAAT,CAAc;AAC/CytD,MAAAA,KAAK,EAAEF,OADwC;AAE/CG,MAAAA,GAAG,EAAEF;AAF0C,KAAd,CAA5B,GAGFhtD,QAAQ,CAACtC,IAAT,EAHL;AAID,GATD;;AAUA,MAAIyvD,UAAU,GAAG,UAAU9xB,MAAV,EAAkBnjB,GAAlB,EAAuB;AACtC,WAAO20C,oBAAoB,CAACC,eAAe,CAACzxB,MAAD,EAASnjB,GAAT,CAAf,CAA6B/Z,IAA7B,CAAkC,YAAY;AACxE,aAAOsa,UAAU,CAACP,GAAD,CAAjB;AACD,KAF2B,EAEzB,UAAUk1C,UAAV,EAAsB;AACvB,aAAO,OAAP;AACD,KAJ2B,CAAD,CAA3B;AAKD,GAND;;AAOA,MAAIC,gBAAgB,GAAG,UAAU1hD,GAAV,EAAe2hD,MAAf,EAAuBC,cAAvB,EAAuC;AAC5D,QAAIC,QAAQ,GAAG7hD,GAAG,CAAC6yB,SAAJ,CAAc8uB,MAAd,EAAsB,OAAtB,CAAf;AACA,QAAIG,aAAa,GAAGH,MAAM,CAAC57C,UAA3B;AACA,QAAIg8C,cAAc,GAAGvyB,WAAW,CAACsyB,aAAD,CAAhC;;AACA,QAAIF,cAAc,KAAKG,cAAvB,EAAuC;AACrC,UAAIC,YAAY,GAAGhiD,GAAG,CAAC0tC,MAAJ,CAAWkU,cAAX,EAA2BC,QAA3B,EAAqC,CAArC,CAAnB;;AACA,UAAI,CAACG,YAAL,EAAmB;AACjBA,QAAAA,YAAY,GAAGhiD,GAAG,CAAC2W,MAAJ,CAAWirC,cAAX,CAAf;AACA,YAAIK,iBAAiB,GAAGJ,QAAQ,CAACh7C,UAAjC;;AACA,YAAI+6C,cAAc,KAAK,OAAvB,EAAgC;AAC9BjrD,UAAAA,IAAI,CAAC4R,UAAU,CAAClI,YAAY,CAACZ,OAAb,CAAqBoiD,QAArB,CAAD,EAAiC,kBAAjC,CAAX,CAAJ,CAAqErvD,IAArE,CAA0E,YAAY;AACpF,mBAAOqvD,QAAQ,CAAC7tC,YAAT,CAAsBguC,YAAtB,EAAoCC,iBAApC,CAAP;AACD,WAFD,EAEG,UAAUljC,CAAV,EAAa;AACd,mBAAO/e,GAAG,CAACkiD,WAAJ,CAAgBF,YAAhB,EAA8BjjC,CAAC,CAAC/e,GAAhC,CAAP;AACD,WAJD;AAKD,SAND,MAMO;AACL6hD,UAAAA,QAAQ,CAACxtC,WAAT,CAAqB2tC,YAArB;AACD;AACF;;AACD,UAAIJ,cAAc,KAAK,OAAnB,IAA8BG,cAAc,KAAK,OAAjD,IAA4DC,YAAY,CAACn7C,UAA7E,EAAyF;AACvFm7C,QAAAA,YAAY,CAAChuC,YAAb,CAA0B2tC,MAA1B,EAAkCK,YAAY,CAACn7C,UAA/C;AACD,OAFD,MAEO;AACLm7C,QAAAA,YAAY,CAAC3tC,WAAb,CAAyBstC,MAAzB;AACD;;AACD,UAAI,CAACG,aAAa,CAACziD,aAAd,EAAL,EAAoC;AAClCW,QAAAA,GAAG,CAAC6J,MAAJ,CAAWi4C,aAAX;AACD;AACF;AACF,GA5BD;;AA6BA,MAAIK,UAAU,GAAG,UAAUzyB,MAAV,EAAkBjkB,IAAlB,EAAwB22C,WAAxB,EAAqC;AACpD,QAAInyD,aAAa,CAACmyD,WAAD,CAAb,IAA8B5yB,WAAW,CAAC/jB,IAAD,CAAX,KAAsB22C,WAAxD,EAAqE;AACnE,UAAIpL,UAAU,GAAGtnB,MAAM,CAAC1vB,GAAP,CAAWqiD,MAAX,CAAkB52C,IAAlB,EAAwB22C,WAAxB,CAAjB;AACAla,MAAAA,WAAW,CAACxY,MAAD,EAASsnB,UAAT,CAAX;AACA,aAAOA,UAAP;AACD,KAJD,MAIO;AACL,aAAOvrC,IAAP;AACD;AACF,GARD;;AASA,MAAI62C,cAAc,GAAG,UAAU5yB,MAAV,EAAkBjkB,IAAlB,EAAwB22C,WAAxB,EAAqCrjD,KAArC,EAA4C;AAC/D,QAAIiB,GAAG,GAAG0vB,MAAM,CAAC1vB,GAAjB;AACA,QAAIguB,OAAO,GAAGm0B,UAAU,CAACzyB,MAAD,EAASjkB,IAAT,EAAe22C,WAAf,CAAxB;;AACA,QAAI,CAACtyD,WAAW,CAACiP,KAAD,CAAhB,EAAyB;AACvBiB,MAAAA,GAAG,CAACuiD,SAAJ,CAAcv0B,OAAd,EAAuB,OAAvB,EAAgCjvB,KAAhC;AACD;;AACD,WAAOivB,OAAP;AACD,GAPD;;AAQA,MAAIw0B,eAAe,GAAG,UAAU9yB,MAAV,EAAkBzrB,KAAlB,EAAyBm+C,WAAzB,EAAsCrjD,KAAtC,EAA6C;AACjE,WAAO3L,IAAI,CAAC6Q,KAAD,EAAQ,UAAU8a,CAAV,EAAa;AAC9B,aAAOujC,cAAc,CAAC5yB,MAAD,EAAS3Q,CAAT,EAAYqjC,WAAZ,EAAyBrjD,KAAzB,CAArB;AACD,KAFU,CAAX;AAGD,GAJD;;AAKA,MAAI0jD,iBAAiB,GAAG,UAAU/yB,MAAV,EAAkBiyB,MAAlB,EAA0B3nB,OAA1B,EAAmC;AACzD,QAAI0oB,sBAAsB,GAAG,YAAY;AACvC,UAAIC,YAAY,GAAGh2C,KAAK,CAACtM,YAAY,CAACZ,OAAb,CAAqBkiD,MAAM,CAAC19C,KAAP,CAAa,CAAb,CAArB,CAAD,CAAL,CAA6C9Q,GAA7C,CAAiD,UAAUwZ,KAAV,EAAiB;AACnF,eAAOvJ,IAAI,CAACuJ,KAAD,CAAX;AACD,OAFkB,EAEhB/Z,KAFgB,CAEV,EAFU,CAAnB;AAGA,aAAOgE,OAAO,CAAC+rD,YAAD,EAAe,UAAUp/C,GAAV,EAAe;AAC1C,eAAO49C,eAAe,CAACzxB,MAAD,EAASnsB,GAAG,CAACvD,GAAb,CAAtB;AACD,OAFa,CAAP,CAEJ7M,GAFI,CAEA,UAAUyvD,YAAV,EAAwB;AAC7B,YAAIA,YAAY,CAACtB,KAAb,IAAsBsB,YAAY,CAACrB,GAAvC,EAA4C;AAC1C,iBAAO,cAAP;AACD,SAFD,MAEO;AACL,iBAAOqB,YAAY,CAACtB,KAAb,GAAqB,SAArB,GAAiC,OAAxC;AACD;AACF,OARM,EAQJ1uD,KARI,CAQE,SARF,CAAP;AASD,KAbD;;AAcA,QAAIoN,GAAG,GAAG0vB,MAAM,CAAC1vB,GAAjB;;AACA,QAAIg6B,OAAO,KAAK,QAAhB,EAA0B;AACxB,UAAI6oB,oBAAoB,GAAGpY,kBAAkB,CAAC/a,MAAD,CAA7C;AACA,UAAIozB,aAAa,GAAGD,oBAAoB,KAAK,MAAzB,GAAkCH,sBAAsB,EAAxD,GAA6DG,oBAAjF;AACAL,MAAAA,eAAe,CAAC9yB,MAAD,EAASiyB,MAAM,CAAC19C,KAAhB,EAAuB6+C,aAAa,KAAK,SAAlB,GAA8B,IAA9B,GAAqC,IAA5D,EAAkE,KAAlE,CAAf;AACApB,MAAAA,gBAAgB,CAAC1hD,GAAD,EAAM2hD,MAAN,EAAcmB,aAAa,KAAK,OAAlB,GAA4B,OAA5B,GAAsC,OAApD,CAAhB;AACD,KALD,MAKO;AACLN,MAAAA,eAAe,CAAC9yB,MAAD,EAASiyB,MAAM,CAAC19C,KAAhB,EAAuB,IAAvB,EAA6B,IAA7B,CAAf;AACAy9C,MAAAA,gBAAgB,CAAC1hD,GAAD,EAAM2hD,MAAN,EAAc3nB,OAAO,KAAK,QAAZ,GAAuB,OAAvB,GAAiC,OAA/C,CAAhB;AACD;AACF,GAzBD;;AA2BA,MAAI+oB,6BAA6B,GAAG,UAAUtoD,KAAV,EAAiB;AACnD,WAAOkS,KAAK,CAAClS,KAAD,CAAL,CAAapH,IAAb,CAAkB,UAAUsZ,KAAV,EAAiB;AACxC,aAAOmN,UAAU,CAACnN,KAAD,EAAQkkB,QAAQ,CAACnX,qBAAjB,CAAjB;AACD,KAFM,EAEJlnB,IAFI,CAEC,YAAY;AAClB,aAAOiI,KAAP;AACD,KAJM,EAIJ,UAAUwJ,KAAV,EAAiB;AAClB,aAAOA,KAAK,CAAC,CAAD,CAAZ;AACD,KANM,CAAP;AAOD,GARD;;AASA,MAAI++C,6BAA6B,GAAG,UAAUziD,QAAV,EAAoB;AACtD,WAAO,UAAU9F,KAAV,EAAiBwL,MAAjB,EAAyB;AAC9B,UAAIg9C,aAAa,GAAG/zD,IAAI,CAACuL,KAAD,CAAxB;AACA,UAAIsX,SAAS,GAAGkxC,aAAa,KAAK,KAAlB,IAA2BA,aAAa,KAAK,UAA7C,GAA0DF,6BAA6B,CAACtoD,KAAD,CAAvF,GAAiGA,KAAjH;AACA,aAAO2O,SAAS,CAAC2I,SAAD,EAAYxR,QAAZ,EAAsB0F,MAAtB,CAAhB;AACD,KAJD;AAKD,GAND;;AAOA,MAAIi9C,qBAAqB,GAAGF,6BAA6B,CAAC,OAAD,CAAzD;AACA,MAAIG,8BAA8B,GAAGH,6BAA6B,CAAC,eAAD,CAAlE;;AACA,MAAII,qBAAqB,GAAG,UAAU3oD,KAAV,EAAiB+1B,UAAjB,EAA6BvqB,MAA7B,EAAqC;AAC/D,WAAOi9C,qBAAqB,CAACzoD,KAAD,EAAQwL,MAAR,CAArB,CAAqC9S,GAArC,CAAyC,UAAUkwD,KAAV,EAAiB;AAC/D,aAAO9yB,SAAS,CAACC,UAAD,CAAhB;AACD,KAFM,EAEJ59B,KAFI,CAEE,EAFF,CAAP;AAGD,GAJD;;AAKA,MAAI0wD,oBAAoB,GAAG,UAAU7oD,KAAV,EAAiB8F,QAAjB,EAA2B;AACpD,QAAImoB,OAAO,GAAGw6B,qBAAqB,CAACzoD,KAAD,CAAnC;AACA,QAAI8oD,OAAO,GAAG76B,OAAO,CAACr1B,IAAR,CAAa,UAAUoY,IAAV,EAAgB;AACzC,aAAOkB,KAAK,CAAClB,IAAD,CAAZ;AACD,KAFa,EAEXtY,GAFW,CAEP,UAAUwZ,KAAV,EAAiB;AACtB,aAAOvJ,IAAI,CAACuJ,KAAD,CAAX;AACD,KAJa,CAAd;AAKA,WAAOsQ,KAAK,CAACyL,OAAD,EAAU66B,OAAV,EAAmB,UAAU93C,IAAV,EAAgBrI,IAAhB,EAAsB;AACnD,aAAO5P,MAAM,CAAC4P,IAAD,EAAO,UAAUG,GAAV,EAAe;AACjC,eAAOjQ,MAAM,CAACg8B,SAAS,CAAC/rB,GAAG,CAACvD,GAAJ,CAAQiE,KAAT,CAAV,EAA2B,UAAUgM,OAAV,EAAmB;AACzD,iBAAOvG,KAAK,CAACuG,OAAD,EAAU1P,QAAV,CAAL,KAA6B,GAA7B,IAAoCY,IAAI,CAAC8O,OAAD,EAAUxE,IAAV,CAA/C;AACD,SAFY,CAAb;AAGD,OAJY,CAAb;AAKD,KANW,CAAL,CAMJ7Y,KANI,CAME,EANF,CAAP;AAOD,GAdD;;AAgBA,MAAI4wD,YAAY,GAAG,UAAU9zB,MAAV,EAAkBmd,QAAlB,EAA4Brc,UAA5B,EAAwC;AACzD,QAAIizB,WAAW,GAAG,UAAU/zB,MAAV,EAAkB;AAClC,aAAOxgC,IAAI,CAACugC,SAAS,CAACC,MAAD,CAAV,CAAJ,KAA4B,OAAnC;AACD,KAFD;;AAGA,QAAIg0B,YAAY,GAAG,UAAU/2C,KAAV,EAAiB;AAClC,aAAO82C,WAAW,CAAC/zB,MAAD,CAAX,KAAwB,KAAxB,IAAiCqM,WAAW,CAACpvB,KAAD,CAAX,CAAmBvJ,IAAnB,GAA0B,CAAlE;AACD,KAFD;;AAGA,QAAIugD,eAAe,GAAG,UAAUh3C,KAAV,EAAiB;AACrC,aAAO82C,WAAW,CAAC/zB,MAAD,CAAX,KAAwB,KAAxB,IAAiCqM,WAAW,CAACpvB,KAAD,CAAX,CAAmBtJ,OAAnB,GAA6B,CAArE;AACD,KAFD;;AAGA,QAAIyqB,YAAY,GAAGmd,gBAAgB,CAACvb,MAAD,CAAnC;AACA,QAAIk0B,aAAa,GAAG5Y,2BAA2B,CAACtb,MAAD,CAA3B,GAAsCt/B,IAAtC,GAA6Cg+C,KAAjE;;AACA,QAAIyV,OAAO,GAAG,UAAUtS,SAAV,EAAqBuS,KAArB,EAA4Bn1B,MAA5B,EAAoCke,QAApC,EAA8CkX,MAA9C,EAAsD;AAClE,aAAO,UAAUp3C,KAAV,EAAiBvR,MAAjB,EAAyB;AAC9B20B,QAAAA,eAAe,CAACpjB,KAAD,CAAf;AACA,YAAI43B,IAAI,GAAGsI,QAAQ,EAAnB;AACA,YAAI7tC,GAAG,GAAGqB,YAAY,CAACZ,OAAb,CAAqBiwB,MAAM,CAACsD,MAAP,EAArB,CAAV;AACA,YAAInB,UAAU,GAAGnD,cAAc,CAACC,MAAD,EAAS3vB,GAAT,EAAc8uB,YAAd,CAA/B;AACA,YAAI6jB,MAAM,GAAGtG,KAAK,CAAC3b,MAAD,EAAS/iB,KAAT,CAAlB;AACA,YAAIwpB,eAAe,GAAG6U,2BAA2B,CAACtb,MAAD,CAA3B,GAAsCiG,WAAW,EAAjD,GAAsDmC,aAAa,EAAzF;AACA,eAAOgsB,KAAK,CAACn3C,KAAD,CAAL,GAAe4kC,SAAS,CAAChN,IAAD,EAAO53B,KAAP,EAAcvR,MAAd,EAAsBy2B,UAAtB,EAAkC8f,MAAlC,EAA0Cxb,eAA1C,CAAT,CAAoE9iC,IAApE,CAAyE,UAAUgV,MAAV,EAAkB;AAC/GjV,UAAAA,IAAI,CAACiV,MAAM,CAACumC,OAAR,EAAiB,UAAUrrC,GAAV,EAAe;AAClCykC,YAAAA,UAAU,CAACtY,MAAD,EAASnsB,GAAG,CAACvD,GAAb,CAAV;AACD,WAFG,CAAJ;AAGA5M,UAAAA,IAAI,CAACiV,MAAM,CAACqF,QAAR,EAAkB,UAAUjC,IAAV,EAAgB;AACpCy8B,YAAAA,WAAW,CAACxY,MAAD,EAASjkB,IAAI,CAACzL,GAAd,CAAX;AACD,WAFG,CAAJ;AAGA,iBAAOqI,MAAM,CAACwpC,MAAP,CAAc1+C,GAAd,CAAkB,UAAUsY,IAAV,EAAgB;AACvC,gBAAIu4C,GAAG,GAAG7V,aAAa,CAAC1iC,IAAD,CAAvB;AACA,gBAAI4nB,GAAG,GAAG3D,MAAM,CAAC1vB,GAAP,CAAWikD,SAAX,EAAV;AACA5wB,YAAAA,GAAG,CAAC6wB,QAAJ,CAAaF,GAAG,CAAC1jD,OAAJ,CAAYN,GAAzB,EAA8BgkD,GAAG,CAACnlB,MAAlC;AACAxL,YAAAA,GAAG,CAAC8wB,MAAJ,CAAWH,GAAG,CAAC1jD,OAAJ,CAAYN,GAAvB,EAA4BgkD,GAAG,CAACnlB,MAAhC;AACA,mBAAO;AACLxL,cAAAA,GAAG,EAAEA,GADA;AAEL0wB,cAAAA,MAAM,EAAEA;AAFH,aAAP;AAID,WATM,CAAP;AAUD,SAjBqB,CAAf,GAiBF1vD,QAAQ,CAACtC,IAAT,EAjBL;AAkBD,OAzBD;AA0BD,KA3BD;;AA4BA,QAAIqyD,SAAS,GAAGP,OAAO,CAAC3D,SAAD,EAAYwD,YAAZ,EAA0BtzD,IAA1B,EAAgCy8C,QAAhC,EAA0ClE,iBAA1C,CAAvB;AACA,QAAI0b,YAAY,GAAGR,OAAO,CAAC5D,YAAD,EAAe0D,eAAf,EAAgCvzD,IAAhC,EAAsCy8C,QAAtC,EAAgDlE,iBAAhD,CAA1B;AACA,QAAI2b,kBAAkB,GAAGT,OAAO,CAAChE,gBAAD,EAAmB/tD,MAAnB,EAA2B1B,IAA3B,EAAiCy8C,QAAjC,EAA2ClE,iBAA3C,CAAhC;AACA,QAAI4b,iBAAiB,GAAGV,OAAO,CAAC/D,eAAD,EAAkBhuD,MAAlB,EAA0B1B,IAA1B,EAAgCy8C,QAAhC,EAA0ClE,iBAA1C,CAA/B;AACA,QAAI6b,qBAAqB,GAAGX,OAAO,CAAC9D,mBAAD,EAAsBjuD,MAAtB,EAA8B8xD,aAA9B,EAA6C/W,QAA7C,EAAuDlE,iBAAvD,CAAnC;AACA,QAAI8b,oBAAoB,GAAGZ,OAAO,CAAC7D,kBAAD,EAAqBluD,MAArB,EAA6B8xD,aAA7B,EAA4C/W,QAA5C,EAAsDlE,iBAAtD,CAAlC;AACA,QAAI+b,YAAY,GAAGb,OAAO,CAAClD,UAAD,EAAa7uD,MAAb,EAAqB1B,IAArB,EAA2By8C,QAA3B,EAAqClE,iBAArC,CAA1B;AACA,QAAIgc,cAAc,GAAGd,OAAO,CAACjD,YAAD,EAAe9uD,MAAf,EAAuB1B,IAAvB,EAA6By8C,QAA7B,EAAuClE,iBAAvC,CAA5B;AACA,QAAIic,iBAAiB,GAAGf,OAAO,CAAChD,eAAD,EAAkB/uD,MAAlB,EAA0B1B,IAA1B,EAAgCy8C,QAAhC,EAA0ClE,iBAA1C,CAA/B;AACA,QAAIkc,gBAAgB,GAAGhB,OAAO,CAAC/C,cAAD,EAAiBhvD,MAAjB,EAAyB1B,IAAzB,EAA+By8C,QAA/B,EAAyClE,iBAAzC,CAA9B;AACA,QAAImc,iBAAiB,GAAGjB,OAAO,CAAC9C,eAAD,EAAkBjvD,MAAlB,EAA0B1B,IAA1B,EAAgCy8C,QAAhC,EAA0ClE,iBAA1C,CAA/B;AACA,QAAIoc,gBAAgB,GAAGlB,OAAO,CAAC7C,cAAD,EAAiBlvD,MAAjB,EAAyB1B,IAAzB,EAA+By8C,QAA/B,EAAyClE,iBAAzC,CAA9B;AACA,QAAIqc,YAAY,GAAGnB,OAAO,CAAC3wB,UAAD,EAAaphC,MAAb,EAAqB1B,IAArB,EAA2By8C,QAA3B,EAAqClE,iBAArC,CAA1B;;AACA,QAAIsc,WAAW,GAAG,UAAUz0D,IAAV,EAAgB00D,UAAhB,EAA4B;AAC5C,aAAOviD,KAAK,CAACnS,IAAD,EAAO,MAAP,CAAL,CAAoBgD,MAApB,CAA2B,UAAUnE,IAAV,EAAgB;AAChD,eAAOyF,QAAQ,CAACowD,UAAD,EAAa71D,IAAb,CAAf;AACD,OAFM,CAAP;AAGD,KAJD;;AAKA,QAAI81D,gBAAgB,GAAG,UAAUz1B,MAAV,EAAkBl/B,IAAlB,EAAwB;AAC7C,aAAOy0D,WAAW,CAACz0D,IAAD,EAAO,CACvB,IADuB,EAEvB,IAFuB,CAAP,CAAX,CAGJ4C,IAHI,CAGC,UAAU/D,IAAV,EAAgB;AACtB,YAAI4U,KAAK,GAAG9Q,GAAG,CAACiwD,qBAAqB,CAAC9yB,iBAAiB,CAACZ,MAAD,CAAlB,EAA4Bc,UAA5B,CAAtB,EAA+D,UAAUzR,CAAV,EAAa;AACzF,iBAAOA,CAAC,CAAC/e,GAAT;AACD,SAFc,CAAf;AAGAwiD,QAAAA,eAAe,CAAC9yB,MAAD,EAASzrB,KAAT,EAAgB5U,IAAhB,EAAsB,IAAtB,CAAf;AACD,OARM,CAAP;AASD,KAVD;;AAWA,QAAI+1D,eAAe,GAAG,UAAU11B,MAAV,EAAkBl/B,IAAlB,EAAwB;AAC5C,aAAOy0D,WAAW,CAACz0D,IAAD,EAAO,CACvB,QADuB,EAEvB,MAFuB,EAGvB,QAHuB,CAAP,CAAX,CAIJ4C,IAJI,CAIC,UAAU/D,IAAV,EAAgB;AACtB8D,QAAAA,GAAG,CAACmwD,oBAAoB,CAAChzB,iBAAiB,CAACZ,MAAD,CAAlB,EAA4BmB,QAAQ,CAACS,QAArC,CAArB,EAAqE,UAAU/tB,GAAV,EAAe;AACrF,iBAAOk/C,iBAAiB,CAAC/yB,MAAD,EAASnsB,GAAG,CAACvD,GAAb,EAAkB3Q,IAAlB,CAAxB;AACD,SAFE,CAAH;AAGD,OARM,CAAP;AASD,KAVD;;AAWA,QAAIg2D,mBAAmB,GAAGxB,OAAO,CAACzD,iBAAD,EAAoBtuD,MAApB,EAA4B1B,IAA5B,EAAkCy8C,QAAlC,EAA4ClE,iBAA5C,CAAjC;AACA,QAAI2c,qBAAqB,GAAGzB,OAAO,CAACvD,mBAAD,EAAsBxuD,MAAtB,EAA8B1B,IAA9B,EAAoCy8C,QAApC,EAA8ClE,iBAA9C,CAAnC;;AACA,QAAI4c,eAAe,GAAG,UAAU71B,MAAV,EAAkB;AACtC,UAAItsB,IAAI,GAAGkgD,oBAAoB,CAAChzB,iBAAiB,CAACZ,MAAD,CAAlB,EAA4BmB,QAAQ,CAACS,QAArC,CAA/B;;AACA,UAAIluB,IAAI,CAACzS,MAAL,GAAc,CAAlB,EAAqB;AACnB,YAAI60D,QAAQ,GAAGryD,GAAG,CAACiQ,IAAD,EAAO,UAAU/N,CAAV,EAAa;AACpC,iBAAOmsD,UAAU,CAAC9xB,MAAD,EAASr6B,CAAC,CAAC2K,GAAX,CAAjB;AACD,SAFiB,CAAlB;AAGA,YAAIylD,SAAS,GAAG3wD,QAAQ,CAAC0wD,QAAD,EAAW,QAAX,CAAxB;AACA,YAAIE,SAAS,GAAG5wD,QAAQ,CAAC0wD,QAAD,EAAW,QAAX,CAAxB;;AACA,YAAI,CAACC,SAAD,IAAc,CAACC,SAAnB,EAA8B;AAC5B,iBAAO,MAAP;AACD,SAFD,MAEO;AACL,cAAIC,OAAO,GAAG7wD,QAAQ,CAAC0wD,QAAD,EAAW,MAAX,CAAtB;;AACA,cAAIC,SAAS,IAAI,CAACE,OAAd,IAAyB,CAACD,SAA9B,EAAyC;AACvC,mBAAO,QAAP;AACD,WAFD,MAEO,IAAI,CAACD,SAAD,IAAc,CAACE,OAAf,IAA0BD,SAA9B,EAAyC;AAC9C,mBAAO,QAAP;AACD,WAFM,MAEA;AACL,mBAAO,EAAP;AACD;AACF;AACF;AACF,KArBD;;AAsBA,QAAIE,gBAAgB,GAAG,UAAUl2B,MAAV,EAAkB;AACvC,aAAOsvB,YAAY,CAACoE,qBAAqB,CAAC9yB,iBAAiB,CAACZ,MAAD,CAAlB,EAA4Bc,UAA5B,CAAtB,EAA+D,UAAU/kB,IAAV,EAAgB;AAChG,eAAOvc,IAAI,CAACuc,IAAD,CAAJ,KAAe,IAAtB;AACD,OAFkB,CAAZ,CAEJ7Y,KAFI,CAEE,EAFF,CAAP;AAGD,KAJD;;AAKA,QAAIizD,eAAe,GAAG5E,aAAtB;AACA,WAAO;AACLmD,MAAAA,SAAS,EAAEA,SADN;AAELC,MAAAA,YAAY,EAAEA,YAFT;AAGLxE,MAAAA,gBAAgB,EAAEyE,kBAHb;AAILxE,MAAAA,eAAe,EAAEyE,iBAJZ;AAKLxE,MAAAA,mBAAmB,EAAEyE,qBALhB;AAMLxE,MAAAA,kBAAkB,EAAEyE,oBANf;AAOL9D,MAAAA,UAAU,EAAE+D,YAPP;AAQL9D,MAAAA,YAAY,EAAE+D,cART;AASL9D,MAAAA,eAAe,EAAE+D,iBATZ;AAUL9D,MAAAA,cAAc,EAAE+D,gBAVX;AAWL9D,MAAAA,eAAe,EAAE+D,iBAXZ;AAYL9D,MAAAA,cAAc,EAAE+D,gBAZX;AAaL7xB,MAAAA,UAAU,EAAE8xB,YAbP;AAcLG,MAAAA,gBAAgB,EAAEA,gBAdb;AAeLC,MAAAA,eAAe,EAAEA,eAfZ;AAgBLhF,MAAAA,iBAAiB,EAAEiF,mBAhBd;AAiBL/E,MAAAA,mBAAmB,EAAEgF,qBAjBhB;AAkBLC,MAAAA,eAAe,EAAEA,eAlBZ;AAmBLK,MAAAA,gBAAgB,EAAEA,gBAnBb;AAoBLC,MAAAA,eAAe,EAAEA;AApBZ,KAAP;AAsBD,GApID;;AAsIA,MAAIC,oBAAoB,GAAG;AACzBh7C,IAAAA,MAAM,EAAE;AACN,yBAAmB,UADb;AAEN,eAAS;AAFH,KADiB;AAKzBd,IAAAA,UAAU,EAAE;AAAEo/B,MAAAA,MAAM,EAAE;AAAV,KALa;AAMzB2c,IAAAA,SAAS,EAAE;AANc,GAA3B;;AAQA,MAAIC,eAAe,GAAG,YAAY;AAChC,WAAO3lD,YAAY,CAACX,OAAb,CAAqB,IAArB,CAAP;AACD,GAFD;;AAGA,MAAIumD,SAAS,GAAG,YAAY;AAC1B,WAAO5lD,YAAY,CAACX,OAAb,CAAqB,IAArB,CAAP;AACD,GAFD;;AAGA,MAAIwmD,WAAW,GAAG,YAAY;AAC5B,WAAO7lD,YAAY,CAACX,OAAb,CAAqB,KAArB,CAAP;AACD,GAFD;;AAGA,MAAIymD,SAAS,GAAG,UAAU9iD,OAAV,EAAmB+iD,UAAnB,EAA+BC,aAA/B,EAA8Ct6B,QAA9C,EAAwD;AACtE,QAAIgjB,EAAE,GAAG1uC,YAAY,CAACX,OAAb,CAAqB,IAArB,CAAT;;AACA,SAAK,IAAIrI,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgM,OAApB,EAA6BhM,CAAC,EAA9B,EAAkC;AAChC,UAAI20B,EAAE,GAAGD,QAAQ,GAAGq6B,UAAX,IAAyB/uD,CAAC,GAAGgvD,aAA7B,GAA6CL,eAAe,EAA5D,GAAiEC,SAAS,EAAnF;;AACA,UAAI5uD,CAAC,GAAGgvD,aAAR,EAAuB;AACrB98C,QAAAA,GAAG,CAACyiB,EAAD,EAAK,OAAL,EAAc,KAAd,CAAH;AACD;;AACD,UAAID,QAAQ,GAAGq6B,UAAf,EAA2B;AACzB78C,QAAAA,GAAG,CAACyiB,EAAD,EAAK,OAAL,EAAc,KAAd,CAAH;AACD;;AACD9X,MAAAA,MAAM,CAAC8X,EAAD,EAAK3rB,YAAY,CAACX,OAAb,CAAqB,IAArB,CAAL,CAAN;AACAwU,MAAAA,MAAM,CAAC66B,EAAD,EAAK/iB,EAAL,CAAN;AACD;;AACD,WAAO+iB,EAAP;AACD,GAdD;;AAeA,MAAIuX,cAAc,GAAG,UAAUjjD,OAAV,EAAmB;AACtC,QAAIqJ,WAAW,GAAGrM,YAAY,CAACX,OAAb,CAAqB,UAArB,CAAlB;AACAvK,IAAAA,KAAK,CAACkO,OAAD,EAAU,YAAY;AACzB,aAAO6Q,MAAM,CAACxH,WAAD,EAAcw5C,WAAW,EAAzB,CAAb;AACD,KAFI,CAAL;AAGA,WAAOx5C,WAAP;AACD,GAND;;AAOA,MAAI65C,UAAU,GAAG,UAAUnjD,IAAV,EAAgBC,OAAhB,EAAyB+iD,UAAzB,EAAqCC,aAArC,EAAoD;AACnE,WAAOlxD,KAAK,CAACiO,IAAD,EAAO,UAAU/N,CAAV,EAAa;AAC9B,aAAO8wD,SAAS,CAAC9iD,OAAD,EAAU+iD,UAAV,EAAsBC,aAAtB,EAAqChxD,CAArC,CAAhB;AACD,KAFW,CAAZ;AAGD,GAJD;;AAKA,MAAImxD,QAAQ,GAAG,UAAUpjD,IAAV,EAAgBC,OAAhB,EAAyB+iD,UAAzB,EAAqCC,aAArC,EAAoDI,UAApD,EAAgEC,UAAhE,EAA4E;AACzF,QAAIA,UAAU,KAAK,KAAK,CAAxB,EAA2B;AACzBA,MAAAA,UAAU,GAAGZ,oBAAb;AACD;;AACD,QAAIn5C,KAAK,GAAGtM,YAAY,CAACX,OAAb,CAAqB,OAArB,CAAZ;AACA,QAAIinD,mBAAmB,GAAGF,UAAU,KAAK,OAAzC;AACA97C,IAAAA,QAAQ,CAACgC,KAAD,EAAQ+5C,UAAU,CAAC57C,MAAnB,CAAR;AACAtB,IAAAA,MAAM,CAACmD,KAAD,EAAQ+5C,UAAU,CAAC18C,UAAnB,CAAN;;AACA,QAAI08C,UAAU,CAACX,SAAf,EAA0B;AACxB7xC,MAAAA,MAAM,CAACvH,KAAD,EAAQ25C,cAAc,CAACjjD,OAAD,CAAtB,CAAN;AACD;;AACD,QAAIujD,gBAAgB,GAAGr2C,IAAI,CAACsB,GAAL,CAASzO,IAAT,EAAegjD,UAAf,CAAvB;;AACA,QAAIO,mBAAmB,IAAIP,UAAU,GAAG,CAAxC,EAA2C;AACzC,UAAI9E,KAAK,GAAGjhD,YAAY,CAACX,OAAb,CAAqB,OAArB,CAAZ;AACAwU,MAAAA,MAAM,CAACvH,KAAD,EAAQ20C,KAAR,CAAN;AACA,UAAIuF,eAAe,GAAGJ,UAAU,KAAK,cAAf,GAAgCG,gBAAhC,GAAmD,CAAzE;AACA,UAAIE,SAAS,GAAGP,UAAU,CAACH,UAAD,EAAa/iD,OAAb,EAAsBwjD,eAAtB,EAAuCR,aAAvC,CAA1B;AACA1xC,MAAAA,QAAQ,CAAC2sC,KAAD,EAAQwF,SAAR,CAAR;AACD;;AACD,QAAIC,KAAK,GAAG1mD,YAAY,CAACX,OAAb,CAAqB,OAArB,CAAZ;AACAwU,IAAAA,MAAM,CAACvH,KAAD,EAAQo6C,KAAR,CAAN;AACA,QAAIC,OAAO,GAAGL,mBAAmB,GAAGvjD,IAAI,GAAGwjD,gBAAV,GAA6BxjD,IAA9D;AACA,QAAI6jD,aAAa,GAAGN,mBAAmB,GAAG,CAAH,GAAOP,UAA9C;AACA,QAAIc,SAAS,GAAGX,UAAU,CAACS,OAAD,EAAU3jD,OAAV,EAAmB4jD,aAAnB,EAAkCZ,aAAlC,CAA1B;AACA1xC,IAAAA,QAAQ,CAACoyC,KAAD,EAAQG,SAAR,CAAR;AACA,WAAOv6C,KAAP;AACD,GA1BD;;AA4BA,MAAIw6C,KAAK,GAAG,UAAU7mD,OAAV,EAAmB;AAC7B,WAAOA,OAAO,CAACN,GAAR,CAAYZ,SAAnB;AACD,GAFD;;AAGA,MAAIgoD,UAAU,GAAG,UAAU9mD,OAAV,EAAmB;AAClC,QAAIkY,SAAS,GAAGnY,YAAY,CAACX,OAAb,CAAqB,KAArB,CAAhB;AACA,QAAIqK,KAAK,GAAG1J,YAAY,CAACZ,OAAb,CAAqBa,OAAO,CAACN,GAAR,CAAY2V,SAAZ,CAAsB,IAAtB,CAArB,CAAZ;AACAzB,IAAAA,MAAM,CAACsE,SAAD,EAAYzO,KAAZ,CAAN;AACA,WAAOo9C,KAAK,CAAC3uC,SAAD,CAAZ;AACD,GALD;;AAOA,MAAI6uC,gBAAgB,GAAG,UAAU33B,MAAV,EAAkBjkB,IAAlB,EAAwB;AAC7CikB,IAAAA,MAAM,CAACa,SAAP,CAAiBmd,MAAjB,CAAwBjiC,IAAI,CAACzL,GAA7B,EAAkC,IAAlC;AACA0vB,IAAAA,MAAM,CAACa,SAAP,CAAiB+2B,QAAjB,CAA0B,IAA1B;AACD,GAHD;;AAIA,MAAIC,sBAAsB,GAAG,UAAU73B,MAAV,EAAkBmyB,QAAlB,EAA4B;AACvD14C,IAAAA,YAAY,CAAC04C,QAAD,EAAW,OAAX,CAAZ,CAAgCzuD,IAAhC,CAAqClC,KAAK,CAACm2D,gBAAD,EAAmB33B,MAAnB,CAA1C;AACD,GAFD;;AAGA,MAAI83B,UAAU,GAAG,UAAU93B,MAAV,EAAkB/iB,KAAlB,EAAyB;AACxCvZ,IAAAA,IAAI,CAACoV,aAAa,CAACmE,KAAD,EAAQ,IAAR,CAAd,EAA6B,UAAUpJ,GAAV,EAAe;AAC9CykC,MAAAA,UAAU,CAACtY,MAAD,EAASnsB,GAAG,CAACvD,GAAb,CAAV;AACA5M,MAAAA,IAAI,CAACoV,aAAa,CAACjF,GAAD,EAAM,OAAN,CAAd,EAA8B,UAAUkI,IAAV,EAAgB;AAChDy8B,QAAAA,WAAW,CAACxY,MAAD,EAASjkB,IAAI,CAACzL,GAAd,CAAX;AACD,OAFG,CAAJ;AAGD,KALG,CAAJ;AAMD,GAPD;;AAQA,MAAIynD,cAAc,GAAG,UAAU7kC,KAAV,EAAiB;AACpC,WAAOlzB,QAAQ,CAACkzB,KAAD,CAAR,IAAmBA,KAAK,CAACnuB,OAAN,CAAc,GAAd,MAAuB,CAAC,CAAlD;AACD,GAFD;;AAGA,MAAIizD,QAAQ,GAAG,UAAUh4B,MAAV,EAAkBrsB,OAAlB,EAA2BD,IAA3B,EAAiCukD,UAAjC,EAA6CvB,UAA7C,EAAyD;AACtE,QAAIvd,aAAa,GAAGa,gBAAgB,CAACha,MAAD,CAApC;AACA,QAAI8S,OAAO,GAAG;AACZ13B,MAAAA,MAAM,EAAE+9B,aADI;AAEZ7+B,MAAAA,UAAU,EAAEy/B,oBAAoB,CAAC/Z,MAAD,CAFpB;AAGZq2B,MAAAA,SAAS,EAAEvb,cAAc,CAAC9a,MAAD;AAHb,KAAd;AAKAA,IAAAA,MAAM,CAAC8d,WAAP,CAAmBe,MAAnB,CAA0B,YAAY;AACpC,UAAI5hC,KAAK,GAAG65C,QAAQ,CAACpjD,IAAD,EAAOC,OAAP,EAAgB+iD,UAAhB,EAA4BuB,UAA5B,EAAwCld,kBAAkB,CAAC/a,MAAD,CAA1D,EAAoE8S,OAApE,CAApB;AACAj5B,MAAAA,GAAG,CAACoD,KAAD,EAAQ,aAAR,EAAuB,OAAvB,CAAH;AACA,UAAI7N,IAAI,GAAGsoD,UAAU,CAACz6C,KAAD,CAArB;AACA+iB,MAAAA,MAAM,CAACk4B,aAAP,CAAqB9oD,IAArB;AACA4wB,MAAAA,MAAM,CAACm4B,SAAP;AACD,KAND;AAOA,WAAO1+C,YAAY,CAACsmB,SAAS,CAACC,MAAD,CAAV,EAAoB,4BAApB,CAAZ,CAA8Dv8B,GAA9D,CAAkE,UAAUwZ,KAAV,EAAiB;AACxF,UAAIo8B,cAAc,CAACrZ,MAAD,CAAlB,EAA4B;AAC1Bmc,QAAAA,aAAa,CAACnc,MAAD,EAAS/iB,KAAT,CAAb;AACD,OAFD,MAEO,IAAIs8B,kBAAkB,CAACvZ,MAAD,CAAtB,EAAgC;AACrCoc,QAAAA,WAAW,CAACn/B,KAAD,CAAX;AACD,OAFM,MAEA,IAAI29B,mBAAmB,CAAC5a,MAAD,CAAnB,IAA+B+3B,cAAc,CAAC5e,aAAa,CAACjmB,KAAf,CAAjD,EAAwE;AAC7E+oB,QAAAA,iBAAiB,CAACjc,MAAD,EAAS/iB,KAAT,CAAjB;AACD;;AACDojB,MAAAA,eAAe,CAACpjB,KAAD,CAAf;AACA9C,MAAAA,MAAM,CAAC8C,KAAD,EAAQ,aAAR,CAAN;AACA66C,MAAAA,UAAU,CAAC93B,MAAD,EAAS/iB,KAAT,CAAV;AACA46C,MAAAA,sBAAsB,CAAC73B,MAAD,EAAS/iB,KAAT,CAAtB;AACA,aAAOA,KAAK,CAAC3M,GAAb;AACD,KAbM,EAaJpN,KAbI,CAaE,IAbF,CAAP;AAcD,GA5BD;;AA6BA,MAAIk1D,6BAA6B,GAAG,UAAUp4B,MAAV,EAAkBtsB,IAAlB,EAAwBC,OAAxB,EAAiCm/B,OAAjC,EAA0CulB,QAA1C,EAAoD;AACtF,QAAIvlB,OAAO,KAAK,KAAK,CAArB,EAAwB;AACtBA,MAAAA,OAAO,GAAG,EAAV;AACD;;AACD,QAAIwlB,UAAU,GAAG,UAAUnqC,GAAV,EAAe;AAC9B,aAAO1tB,QAAQ,CAAC0tB,GAAD,CAAR,IAAiBA,GAAG,GAAG,CAA9B;AACD,KAFD;;AAGA,QAAImqC,UAAU,CAAC5kD,IAAD,CAAV,IAAoB4kD,UAAU,CAAC3kD,OAAD,CAAlC,EAA6C;AAC3C,UAAI4kD,UAAU,GAAGzlB,OAAO,CAACylB,UAAR,IAAsB,CAAvC;AACA,UAAIC,aAAa,GAAG1lB,OAAO,CAAC0lB,aAAR,IAAyB,CAA7C;AACA,aAAOR,QAAQ,CAACh4B,MAAD,EAASrsB,OAAT,EAAkBD,IAAlB,EAAwB8kD,aAAxB,EAAuCD,UAAvC,CAAf;AACD,KAJD,MAIO;AACL1oD,MAAAA,OAAO,CAACC,KAAR,CAAcuoD,QAAd;AACA,aAAO,IAAP;AACD;AACF,GAfD;;AAiBA,MAAII,oBAAoB,GAAG,UAAUC,YAAV,EAAwB;AACjD,WAAO,YAAY;AACjB,aAAOA,YAAY,GAAG51D,IAAf,CAAoB,YAAY;AACrC,eAAO,EAAP;AACD,OAFM,EAEJ,UAAUqa,KAAV,EAAiB;AAClB,eAAO1Z,GAAG,CAAC0Z,KAAD,EAAQ,UAAUrH,CAAV,EAAa;AAC7B,iBAAOA,CAAC,CAACxF,GAAT;AACD,SAFS,CAAV;AAGD,OANM,CAAP;AAOD,KARD;AASD,GAVD;;AAWA,MAAIqoD,oBAAoB,GAAG,UAAUC,YAAV,EAAwB;AACjD,WAAO,UAAUz7C,KAAV,EAAiB;AACtB,UAAI07C,OAAO,GAAG17C,KAAK,CAAClc,MAAN,GAAe,CAAf,GAAmB0D,QAAQ,CAACR,IAAT,CAAcy7B,SAAS,CAACziB,KAAD,CAAvB,CAAnB,GAAqDxY,QAAQ,CAACtC,IAAT,EAAnE;AACAu2D,MAAAA,YAAY,CAACC,OAAD,CAAZ;AACD,KAHD;AAID,GALD;;AAMA,MAAIC,WAAW,GAAG,UAAU94B,MAAV,EAAkB;AAClC,WAAO,UAAUrsB,OAAV,EAAmBD,IAAnB,EAAyBo/B,OAAzB,EAAkC;AACvC,UAAIA,OAAO,KAAK,KAAK,CAArB,EAAwB;AACtBA,QAAAA,OAAO,GAAG,EAAV;AACD;;AACD,UAAI71B,KAAK,GAAGm7C,6BAA6B,CAACp4B,MAAD,EAAStsB,IAAT,EAAeC,OAAf,EAAwBm/B,OAAxB,EAAiC,0FAAjC,CAAzC;AACA9S,MAAAA,MAAM,CAAC8d,WAAP,CAAmBjT,GAAnB;AACA,aAAO5tB,KAAP;AACD,KAPD;AAQD,GATD;;AAUA,MAAI87C,MAAM,GAAG,UAAU/4B,MAAV,EAAkBkC,SAAlB,EAA6B82B,aAA7B,EAA4CC,gBAA5C,EAA8D;AACzE,WAAO;AACLH,MAAAA,WAAW,EAAEA,WAAW,CAAC94B,MAAD,CADnB;AAELk5B,MAAAA,gBAAgB,EAAEP,oBAAoB,CAACz2B,SAAS,CAACi3B,OAAX,CAFjC;AAGLC,MAAAA,gBAAgB,EAAEX,oBAAoB,CAACv2B,SAAS,CAACm3B,OAAX,CAHjC;AAILC,MAAAA,gBAAgB,EAAEX,oBAAoB,CAACz2B,SAAS,CAACq3B,UAAX,CAJjC;AAKLC,MAAAA,gBAAgB,EAAEf,oBAAoB,CAACv2B,SAAS,CAACu3B,UAAX,CALjC;AAMLT,MAAAA,aAAa,EAAEA,aANV;AAOLC,MAAAA,gBAAgB,EAAEA;AAPb,KAAP;AASD,GAVD;;AAYA,MAAIS,aAAa,GAAG,UAAU9oD,OAAV,EAAmBgK,QAAnB,EAA6Bhb,KAA7B,EAAoC;AACtD,QAAI+5D,cAAc,GAAG79C,YAAY,CAAClL,OAAD,EAAUgK,QAAV,EAAoB,CAApB,CAAjC;;AACA,QAAIhb,KAAK,KAAK,CAAV,IAAe+5D,cAAc,IAAI,CAArC,EAAwC;AACtCx/C,MAAAA,MAAM,CAACvJ,OAAD,EAAUgK,QAAV,CAAN;AACD,KAFD,MAEO;AACLf,MAAAA,GAAG,CAACjJ,OAAD,EAAUgK,QAAV,EAAoBiG,IAAI,CAACsB,GAAL,CAASviB,KAAT,EAAgB+5D,cAAhB,CAApB,CAAH;AACD;AACF,GAPD;;AAQA,MAAIC,gBAAgB,GAAG,UAAU/9B,KAAV,EAAiBszB,WAAjB,EAA8BC,WAA9B,EAA2C;AAChE,QAAI9tC,SAAS,CAACF,UAAV,CAAqBya,KAArB,CAAJ,EAAiC;AAC/B,UAAIg+B,UAAU,GAAG/1D,MAAM,CAACwd,SAAS,CAACH,WAAV,CAAsB0a,KAAtB,CAAD,EAA+B,UAAUhN,GAAV,EAAe;AACnE,eAAOA,GAAG,CAAC/a,MAAJ,IAAcq7C,WAAd,IAA6BtgC,GAAG,CAAC/a,MAAJ,GAAas7C,WAAjD;AACD,OAFsB,CAAvB;AAGA,UAAI0K,UAAU,GAAGr2D,GAAG,CAACo2D,UAAD,EAAa,UAAUxqC,CAAV,EAAa;AAC5C,YAAI0qC,SAAS,GAAG7sC,IAAI,CAACmC,CAAC,CAACze,OAAH,CAApB;AACA8oD,QAAAA,aAAa,CAACK,SAAD,EAAY,MAAZ,EAAoB3K,WAAW,GAAGD,WAAlC,CAAb;AACA,eAAO4K,SAAP;AACD,OAJmB,CAApB;AAKA,UAAIC,YAAY,GAAGrpD,YAAY,CAACX,OAAb,CAAqB,UAArB,CAAnB;AACAiV,MAAAA,QAAQ,CAAC+0C,YAAD,EAAeF,UAAf,CAAR;AACA,aAAO,CAACE,YAAD,CAAP;AACD,KAZD,MAYO;AACL,aAAO,EAAP;AACD;AACF,GAhBD;;AAiBA,MAAIC,YAAY,GAAG,UAAUp+B,KAAV,EAAiBszB,WAAjB,EAA8BC,WAA9B,EAA2C;AAC5D,WAAO3rD,GAAG,CAACo4B,KAAK,CAACj6B,GAAP,EAAY,UAAUiS,GAAV,EAAe;AACnC,UAAIqmD,WAAW,GAAGp2D,MAAM,CAAC+P,GAAG,CAACU,KAAL,EAAY,UAAUwH,IAAV,EAAgB;AAClD,eAAOA,IAAI,CAACjI,MAAL,IAAeq7C,WAAf,IAA8BpzC,IAAI,CAACjI,MAAL,GAAcs7C,WAAnD;AACD,OAFuB,CAAxB;AAGA,UAAI+K,WAAW,GAAG12D,GAAG,CAACy2D,WAAD,EAAc,UAAUn+C,IAAV,EAAgB;AACjD,YAAImkC,UAAU,GAAGhzB,IAAI,CAACnR,IAAI,CAACnL,OAAN,CAArB;AACA8oD,QAAAA,aAAa,CAACxZ,UAAD,EAAa,SAAb,EAAwBkP,WAAW,GAAGD,WAAtC,CAAb;AACA,eAAOjP,UAAP;AACD,OAJoB,CAArB;AAKA,UAAIka,MAAM,GAAGzpD,YAAY,CAACX,OAAb,CAAqB,IAArB,CAAb;AACAiV,MAAAA,QAAQ,CAACm1C,MAAD,EAASD,WAAT,CAAR;AACA,aAAOC,MAAP;AACD,KAZS,CAAV;AAaD,GAdD;;AAeA,MAAIC,QAAQ,GAAG,UAAUp9C,KAAV,EAAiBvR,MAAjB,EAAyB;AACtC,QAAImwB,KAAK,GAAGva,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAZ;AACA,QAAIpI,OAAO,GAAGiuC,eAAe,CAACjnB,KAAD,EAAQnwB,MAAR,CAA7B;AACA,WAAOmJ,OAAO,CAACpR,GAAR,CAAY,UAAUk4B,aAAV,EAAyB;AAC1C,UAAIuzB,gBAAgB,GAAGvzB,aAAa,CAACA,aAAa,CAAC16B,MAAd,GAAuB,CAAxB,CAApC;AACA,UAAIkuD,WAAW,GAAGxzB,aAAa,CAAC,CAAD,CAAb,CAAiB7nB,MAAnC;AACA,UAAIs7C,WAAW,GAAGF,gBAAgB,CAACp7C,MAAjB,GAA0Bo7C,gBAAgB,CAACj7C,OAA7D;AACA,UAAIqmD,aAAa,GAAGV,gBAAgB,CAAC/9B,KAAD,EAAQszB,WAAR,EAAqBC,WAArB,CAApC;AACA,UAAImL,QAAQ,GAAGN,YAAY,CAACp+B,KAAD,EAAQszB,WAAR,EAAqBC,WAArB,CAA3B;AACA,aAAO5nD,cAAc,CAAC8yD,aAAD,EAAgBC,QAAhB,CAArB;AACD,KAPM,CAAP;AAQD,GAXD;;AAaA,MAAIC,QAAQ,GAAG,UAAUv9C,KAAV,EAAiBvR,MAAjB,EAAyBy2B,UAAzB,EAAqC;AAClD,QAAI/iB,SAAS,GAAGkC,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAhB;AACA,QAAIpI,OAAO,GAAG+tC,OAAO,CAACxjC,SAAD,EAAY1T,MAAZ,CAArB;AACA,WAAOmJ,OAAO,CAAClR,IAAR,CAAa,UAAUg4B,aAAV,EAAyB;AAC3C,UAAIloB,IAAI,GAAGstC,MAAM,CAAC3hC,SAAD,EAAY+iB,UAAZ,EAAwB,KAAxB,CAAjB;AACA,UAAIzuB,IAAI,GAAG8K,kBAAkB,CAAC/K,IAAD,CAAlB,CAAyBC,IAApC;AACA,UAAI+mD,UAAU,GAAG/mD,IAAI,CAAC7O,KAAL,CAAW82B,aAAa,CAAC,CAAD,CAAb,CAAiB9nB,GAA5B,EAAiC8nB,aAAa,CAACA,aAAa,CAAC16B,MAAd,GAAuB,CAAxB,CAAb,CAAwC4S,GAAxC,GAA8C8nB,aAAa,CAACA,aAAa,CAAC16B,MAAd,GAAuB,CAAxB,CAAb,CAAwC+S,OAAvH,CAAjB;AACA,UAAI0mD,YAAY,GAAG/2D,IAAI,CAAC82D,UAAD,EAAa,UAAU5mD,GAAV,EAAe;AACjD,YAAImK,QAAQ,GAAGla,MAAM,CAAC+P,GAAG,CAACU,KAAL,EAAY,UAAUwH,IAAV,EAAgB;AAC/C,iBAAO,CAACA,IAAI,CAAC1H,QAAb;AACD,SAFoB,CAArB;AAGA,eAAO2J,QAAQ,CAAC/c,MAAT,GAAkB,CAAlB,GAAsB,CAACkG,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK0M,GAAL,CAAT,EAAoB;AAAEU,UAAAA,KAAK,EAAEyJ;AAAT,SAApB,CAAT,CAAtB,GAA2E,EAAlF;AACD,OALsB,CAAvB;AAMA,UAAI28C,aAAa,GAAGpZ,YAAY,CAACmZ,YAAD,EAAev4B,UAAf,CAAhC;AACA,aAAOxU,MAAM,CAACgtC,aAAa,CAAC15D,MAAd,GAAuB,CAAxB,EAA2B05D,aAA3B,CAAb;AACD,KAZM,EAYJl3D,GAZI,CAYA,UAAUk3D,aAAV,EAAyB;AAC9B,aAAO1a,MAAM,CAAC0a,aAAD,CAAb;AACD,KAdM,CAAP;AAeD,GAlBD;;AAoBA,MAAIC,QAAQ,GAAGjuC,OAAO,CAACC,IAAR,CAAaC,KAAb,CAAmBC,OAAnB,CAA2B,oBAA3B,CAAf;;AAEA,MAAI+tC,mBAAmB,GAAG,UAAUvqD,GAAV,EAAeuM,GAAf,EAAoBrd,IAApB,EAA0B;AAClD,QAAI+U,KAAK,GAAGjE,GAAG,CAAC0tC,MAAJ,CAAW,OAAX,EAAoBnhC,GAApB,CAAZ;AACA,QAAIi+C,eAAJ;;AACA,QAAIC,aAAa,GAAG,UAAUD,eAAV,EAA2BE,IAA3B,EAAiC;AACnD,WAAK,IAAIz1D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGy1D,IAAI,CAAC/5D,MAAzB,EAAiCsE,CAAC,EAAlC,EAAsC;AACpC,YAAI01D,YAAY,GAAG3qD,GAAG,CAACkwB,QAAJ,CAAaw6B,IAAI,CAACz1D,CAAD,CAAjB,EAAsB/F,IAAtB,CAAnB;;AACA,YAAI,OAAOs7D,eAAP,KAA2B,WAA/B,EAA4C;AAC1CA,UAAAA,eAAe,GAAGG,YAAlB;AACD;;AACD,YAAIH,eAAe,KAAKG,YAAxB,EAAsC;AACpC,iBAAO,EAAP;AACD;AACF;;AACD,aAAOH,eAAP;AACD,KAXD;;AAYA,WAAOC,aAAa,CAACD,eAAD,EAAkBvmD,KAAlB,CAApB;AACD,GAhBD;;AAiBA,MAAI2mD,UAAU,GAAG,UAAUl7B,MAAV,EAAkBnjB,GAAlB,EAAuBrd,IAAvB,EAA6B;AAC5C,QAAIA,IAAJ,EAAU;AACRwgC,MAAAA,MAAM,CAACm7B,SAAP,CAAiBj6D,KAAjB,CAAuB,UAAU1B,IAAjC,EAAuC,EAAvC,EAA2Cqd,GAA3C;AACD;AACF,GAJD;;AAKA,MAAIu+C,WAAW,GAAG,UAAUp7B,MAAV,EAAkBnjB,GAAlB,EAAuBrd,IAAvB,EAA6B;AAC7C,QAAIA,IAAJ,EAAU;AACRwgC,MAAAA,MAAM,CAACm7B,SAAP,CAAiBj6D,KAAjB,CAAuB,WAAW1B,IAAlC,EAAwC,EAAxC,EAA4Cqd,GAA5C;AACD;AACF,GAJD;;AAKA,MAAIw+C,YAAY,GAAG,UAAUr7B,MAAV,EAAkBnjB,GAAlB,EAAuB;AACxC+9C,IAAAA,QAAQ,CAACl3D,IAAT,CAAc,oBAAoBouC,KAApB,CAA0B,GAA1B,CAAd,EAA8C,UAAUtyC,IAAV,EAAgB;AAC5DwgC,MAAAA,MAAM,CAACm7B,SAAP,CAAiBhhD,MAAjB,CAAwB,UAAU3a,IAAlC,EAAwC,EAAxC,EAA4Cqd,GAA5C;AACD,KAFD;AAGD,GAJD;;AAKA,MAAIy+C,aAAa,GAAG,UAAUt7B,MAAV,EAAkBnjB,GAAlB,EAAuB;AACzC+9C,IAAAA,QAAQ,CAACl3D,IAAT,CAAc,oBAAoBouC,KAApB,CAA0B,GAA1B,CAAd,EAA8C,UAAUtyC,IAAV,EAAgB;AAC5DwgC,MAAAA,MAAM,CAACm7B,SAAP,CAAiBhhD,MAAjB,CAAwB,WAAW3a,IAAnC,EAAyC,EAAzC,EAA6Cqd,GAA7C;AACD,KAFD;AAGD,GAJD;;AAMA,MAAI0+C,WAAW,GAAG,UAAUh8C,IAAV,EAAgB;AAChC,WAAOnM,iBAAiB,CAACmM,IAAD,EAAO,MAAP,CAAxB;AACD,GAFD;;AAGA,MAAIi8C,cAAc,GAAG,UAAUC,SAAV,EAAqBC,UAArB,EAAiC;AACpD,QAAIC,WAAW,GAAG,UAAU5oD,MAAV,EAAkB7M,GAAlB,EAAuB;AACvC,aAAOA,GAAG,CAACrE,MAAJ,CAAW4B,GAAG,CAACsP,MAAD,EAAS,UAAUwM,IAAV,EAAgB;AAC5C,YAAInP,IAAI,GAAGmP,IAAI,CAACnP,IAAL,IAAamP,IAAI,CAACq8C,KAA7B;;AACA,YAAIL,WAAW,CAACh8C,IAAD,CAAf,EAAuB;AACrB,iBAAO;AACLnP,YAAAA,IAAI,EAAEA,IADD;AAELyrD,YAAAA,KAAK,EAAEL,cAAc,CAACj8C,IAAI,CAACu8C,IAAN;AAFhB,WAAP;AAID,SALD,MAKO;AACL,iBAAO;AACL1rD,YAAAA,IAAI,EAAEA,IADD;AAELxQ,YAAAA,KAAK,EAAE2f,IAAI,CAAC3f;AAFP,WAAP;AAID;AACF,OAboB,CAAd,CAAP;AAcD,KAfD;;AAgBA,WAAO+7D,WAAW,CAACF,SAAD,EAAYC,UAAU,IAAI,EAA1B,CAAlB;AACD,GAlBD;;AAmBA,MAAIK,QAAQ,GAAG,UAAUzrD,GAAV,EAAe;AAC5B,WAAO,UAAU1Q,KAAV,EAAiB;AACtB,aAAOqL,UAAU,CAACrL,KAAD,EAAQ,KAAR,CAAV,GAA2B0Q,GAAG,CAAC0rD,KAAJ,CAAUp8D,KAAV,CAA3B,GAA8CA,KAArD;AACD,KAFD;AAGD,GAJD;;AAKA,MAAIq8D,qBAAqB,GAAG,UAAU3rD,GAAV,EAAeuM,GAAf,EAAoB;AAC9C,QAAIjM,OAAO,GAAGD,YAAY,CAACZ,OAAb,CAAqB8M,GAArB,CAAd;AACA,WAAO;AACLq/C,MAAAA,WAAW,EAAE3gD,MAAM,CAAC3K,OAAD,EAAU,cAAV,CAAN,CAAgC1N,KAAhC,CAAsC,EAAtC,CADR;AAELi5D,MAAAA,WAAW,EAAE5gD,MAAM,CAAC3K,OAAD,EAAU,cAAV,CAAN,CAAgC1N,KAAhC,CAAsC,EAAtC,CAFR;AAGLk5D,MAAAA,WAAW,EAAE7gD,MAAM,CAAC3K,OAAD,EAAU,cAAV,CAAN,CAAgCnN,GAAhC,CAAoCs4D,QAAQ,CAACzrD,GAAD,CAA5C,EAAmDpN,KAAnD,CAAyD,EAAzD,CAHR;AAILm5D,MAAAA,eAAe,EAAE9gD,MAAM,CAAC3K,OAAD,EAAU,kBAAV,CAAN,CAAoCnN,GAApC,CAAwCs4D,QAAQ,CAACzrD,GAAD,CAAhD,EAAuDpN,KAAvD,CAA6D,EAA7D;AAJZ,KAAP;AAMD,GARD;;AASA,MAAIo5D,eAAe,GAAG,UAAU74B,IAAV,EAAgB;AACpC,QAAI84B,QAAQ,GAAG94B,IAAI,CAAC,CAAD,CAAnB;AACA,QAAI+4B,cAAc,GAAG/4B,IAAI,CAAC5+B,KAAL,CAAW,CAAX,CAArB;AACAnB,IAAAA,IAAI,CAAC84D,cAAD,EAAiB,UAAUX,KAAV,EAAiB;AACpCn4D,MAAAA,IAAI,CAACwO,IAAI,CAACqqD,QAAD,CAAL,EAAiB,UAAUrpD,GAAV,EAAe;AAClCf,QAAAA,MAAM,CAAC0pD,KAAD,EAAQ,UAAUY,SAAV,EAAqBC,OAArB,EAA8B;AAC1C,cAAIC,eAAe,GAAGJ,QAAQ,CAACrpD,GAAD,CAA9B;;AACA,cAAIypD,eAAe,KAAK,EAApB,IAA0BzpD,GAAG,KAAKwpD,OAAtC,EAA+C;AAC7C,gBAAIC,eAAe,KAAKF,SAAxB,EAAmC;AACjCF,cAAAA,QAAQ,CAACrpD,GAAD,CAAR,GAAgB,EAAhB;AACD;AACF;AACF,SAPK,CAAN;AAQD,OATG,CAAJ;AAUD,KAXG,CAAJ;AAYA,WAAOqpD,QAAP;AACD,GAhBD;;AAiBA,MAAIK,cAAc,GAAG,UAAUC,UAAV,EAAsB;AACzC,QAAIC,WAAW,GAAG,CAChB;AACEt9D,MAAAA,IAAI,EAAE,aADR;AAEEG,MAAAA,IAAI,EAAE,SAFR;AAGE+rB,MAAAA,KAAK,EAAE,cAHT;AAIEmwC,MAAAA,KAAK,EAAE,CACL;AACEzrD,QAAAA,IAAI,EAAE,WADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OADK,EAKL;AACEwQ,QAAAA,IAAI,EAAE,OADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OALK,EASL;AACEwQ,QAAAA,IAAI,EAAE,QADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OATK,EAaL;AACEwQ,QAAAA,IAAI,EAAE,QADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OAbK,EAiBL;AACEwQ,QAAAA,IAAI,EAAE,QADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OAjBK,EAqBL;AACEwQ,QAAAA,IAAI,EAAE,QADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OArBK,EAyBL;AACEwQ,QAAAA,IAAI,EAAE,OADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OAzBK,EA6BL;AACEwQ,QAAAA,IAAI,EAAE,OADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OA7BK,EAiCL;AACEwQ,QAAAA,IAAI,EAAE,QADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OAjCK,EAqCL;AACEwQ,QAAAA,IAAI,EAAE,MADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OArCK,EAyCL;AACEwQ,QAAAA,IAAI,EAAE,QADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OAzCK;AAJT,KADgB,EAoDhB;AACEJ,MAAAA,IAAI,EAAE,aADR;AAEEG,MAAAA,IAAI,EAAE,YAFR;AAGE+rB,MAAAA,KAAK,EAAE;AAHT,KApDgB,EAyDhB;AACElsB,MAAAA,IAAI,EAAE,iBADR;AAEEG,MAAAA,IAAI,EAAE,YAFR;AAGE+rB,MAAAA,KAAK,EAAE;AAHT,KAzDgB,CAAlB;AA+DA,QAAIqxC,WAAW,GAAG;AAChBv9D,MAAAA,IAAI,EAAE,aADU;AAEhBG,MAAAA,IAAI,EAAE,OAFU;AAGhB+rB,MAAAA,KAAK,EAAE;AAHS,KAAlB;AAKA,QAAImwC,KAAK,GAAGgB,UAAU,KAAK,MAAf,GAAwB,CAACE,WAAD,EAAcl7D,MAAd,CAAqBi7D,WAArB,CAAxB,GAA4DA,WAAxE;AACA,WAAO;AACLlB,MAAAA,KAAK,EAAE,UADF;AAELp8D,MAAAA,IAAI,EAAE,UAFD;AAGLq8D,MAAAA,KAAK,EAAEA;AAHF,KAAP;AAKD,GA3ED;;AA4EA,MAAImB,YAAY,GAAG,UAAUz+B,OAAV,EAAmB0+B,UAAnB,EAA+Bj9B,MAA/B,EAAuCnjB,GAAvC,EAA4C;AAC7D,WAAOvW,IAAI,CAACi4B,OAAD,EAAU,UAAU/+B,IAAV,EAAgB;AACnC,aAAOwgC,MAAM,CAACm7B,SAAP,CAAiB+B,SAAjB,CAA2BrgD,GAA3B,EAAgCogD,UAAU,GAAGz9D,IAA7C,CAAP;AACD,KAFU,CAAJ,CAEJ0D,KAFI,CAEE,EAFF,CAAP;AAGD,GAJD;;AAKA,MAAIi6D,aAAa,GAAG37D,KAAK,CAACw7D,YAAD,EAAe,CACtC,MADsC,EAEtC,QAFsC,EAGtC,OAHsC,CAAf,EAItB,OAJsB,CAAzB;AAKA,MAAII,aAAa,GAAG57D,KAAK,CAACw7D,YAAD,EAAe,CACtC,KADsC,EAEtC,QAFsC,EAGtC,QAHsC,CAAf,EAItB,QAJsB,CAAzB;;AAKA,MAAIK,uBAAuB,GAAG,UAAUr9B,MAAV,EAAkBs9B,cAAlB,EAAkC;AAC9D,QAAI7iD,KAAK,GAAGu/B,gBAAgB,CAACha,MAAD,CAA5B;AACA,QAAIjmB,KAAK,GAAGggC,oBAAoB,CAAC/Z,MAAD,CAAhC;;AACA,QAAIu9B,wBAAwB,GAAG,UAAUjtD,GAAV,EAAe;AAC5C,aAAO;AACL6rD,QAAAA,WAAW,EAAElpD,KAAK,CAACwH,KAAD,EAAQ,cAAR,CAAL,CAA6BvX,KAA7B,CAAmC,EAAnC,CADR;AAELk5D,QAAAA,WAAW,EAAEL,QAAQ,CAACzrD,GAAD,CAAR,CAAc2C,KAAK,CAACwH,KAAD,EAAQ,cAAR,CAAL,CAA6BvX,KAA7B,CAAmC,EAAnC,CAAd,CAFR;AAGLm5D,QAAAA,eAAe,EAAEN,QAAQ,CAACzrD,GAAD,CAAR,CAAc2C,KAAK,CAACwH,KAAD,EAAQ,kBAAR,CAAL,CAAiCvX,KAAjC,CAAuC,EAAvC,CAAd;AAHZ,OAAP;AAKD,KAND;;AAOA,QAAIs6D,WAAW,GAAG;AAChBptC,MAAAA,MAAM,EAAE,EADQ;AAEhB8C,MAAAA,KAAK,EAAE,MAFS;AAGhBuqC,MAAAA,WAAW,EAAE,EAHG;AAIhBC,MAAAA,WAAW,EAAE,EAJG;AAKhBC,MAAAA,OAAO,EAAE,KALO;AAMhBC,MAAAA,KAAK,EAAE,EANS;AAOhBC,MAAAA,KAAK,EAAE,EAPS;AAQhBnkB,MAAAA,MAAM,EAAE;AARQ,KAAlB;;AAUA,QAAIokB,SAAS,GAAG,YAAY;AAC1B,UAAIf,WAAW,GAAGtiD,KAAK,CAAC,cAAD,CAAvB;;AACA,UAAI+/B,kBAAkB,CAACxa,MAAD,CAAlB,IAA8B+8B,WAAlC,EAA+C;AAC7C,eAAO;AAAErjB,UAAAA,MAAM,EAAEqjB;AAAV,SAAP;AACD;;AACD,aAAO9pD,KAAK,CAAC8G,KAAD,EAAQ,QAAR,CAAL,CAAuBjX,IAAvB,CAA4B,YAAY;AAC7C,eAAO,EAAP;AACD,OAFM,EAEJ,UAAU42C,MAAV,EAAkB;AACnB,eAAO;AAAEA,UAAAA,MAAM,EAAEA;AAAV,SAAP;AACD,OAJM,CAAP;AAKD,KAVD;;AAWA,QAAIqkB,QAAQ,GAAGT,cAAc,GAAGC,wBAAwB,CAACv9B,MAAM,CAAC1vB,GAAR,CAA3B,GAA0C,EAAvE;;AACA,QAAI0tD,yBAAyB,GAAG,YAAY;AAC1C,UAAIC,OAAO,GAAGhrD,KAAK,CAACwH,KAAD,EAAQ,gBAAR,CAAL,CAA+BlX,EAA/B,CAAkC0P,KAAK,CAAC8G,KAAD,EAAQ,aAAR,CAAvC,EAA+DjX,IAA/D,CAAoE,YAAY;AAC5F,eAAO,EAAP;AACD,OAFa,EAEX,UAAU26D,WAAV,EAAuB;AACxB,eAAO;AAAEA,UAAAA,WAAW,EAAEA;AAAf,SAAP;AACD,OAJa,CAAd;AAKA,UAAIjhB,OAAO,GAAGvpC,KAAK,CAACwH,KAAD,EAAQ,gBAAR,CAAL,CAA+BlX,EAA/B,CAAkC0P,KAAK,CAAC8G,KAAD,EAAQ,aAAR,CAAvC,EAA+DjX,IAA/D,CAAoE,YAAY;AAC5F,eAAO,EAAP;AACD,OAFa,EAEX,UAAU46D,WAAV,EAAuB;AACxB,eAAO;AAAEA,UAAAA,WAAW,EAAEA;AAAf,SAAP;AACD,OAJa,CAAd;AAKA,aAAOv2D,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK82D,OAAL,CAAT,EAAwBzhB,OAAxB,CAAf;AACD,KAZD;;AAaA,QAAI/Y,IAAI,GAAGt8B,QAAQ,CAACA,QAAQ,CAACA,QAAQ,CAACA,QAAQ,CAACA,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKq2D,WAAL,CAAT,EAA4B/iD,KAA5B,CAAT,EAA6CV,KAA7C,CAAT,EAA8DgkD,QAA9D,CAAT,EAAkFD,SAAS,EAA3F,CAAT,EAAyGE,yBAAyB,EAAlI,CAAnB;;AACA,WAAOv6B,IAAP;AACD,GA/CD;;AAgDA,MAAIy6B,2BAA2B,GAAG,UAAUl+B,MAAV,EAAkBnjB,GAAlB,EAAuBygD,cAAvB,EAAuC;AACvE,QAAIQ,SAAS,GAAG,UAAUxtD,GAAV,EAAeuM,GAAf,EAAoB;AAClC,UAAIshD,cAAc,GAAG5iD,MAAM,CAAC5K,YAAY,CAACZ,OAAb,CAAqB8M,GAArB,CAAD,EAA4B,cAA5B,CAA3B;;AACA,UAAI29B,kBAAkB,CAACxa,MAAD,CAAlB,IAA8Bm+B,cAAc,CAACl7D,MAAf,EAAlC,EAA2D;AACzD,eAAOk7D,cAAc,CAACj7D,KAAf,CAAqB,EAArB,CAAP;AACD;;AACD,aAAOoN,GAAG,CAACmwB,SAAJ,CAAc5jB,GAAd,EAAmB,QAAnB,KAAgCg+C,mBAAmB,CAAC76B,MAAM,CAAC1vB,GAAR,EAAauM,GAAb,EAAkB,cAAlB,CAAnD,IAAwFg+C,mBAAmB,CAAC76B,MAAM,CAAC1vB,GAAR,EAAauM,GAAb,EAAkB,QAAlB,CAAlH;AACD,KAND;;AAOA,QAAIvM,GAAG,GAAG0vB,MAAM,CAAC1vB,GAAjB;AACA,WAAOnJ,QAAQ,CAAC;AACd+rB,MAAAA,KAAK,EAAE5iB,GAAG,CAACkwB,QAAJ,CAAa3jB,GAAb,EAAkB,OAAlB,KAA8BvM,GAAG,CAACmwB,SAAJ,CAAc5jB,GAAd,EAAmB,OAAnB,CADvB;AAEduT,MAAAA,MAAM,EAAE9f,GAAG,CAACkwB,QAAJ,CAAa3jB,GAAb,EAAkB,QAAlB,KAA+BvM,GAAG,CAACmwB,SAAJ,CAAc5jB,GAAd,EAAmB,QAAnB,CAFzB;AAGd4gD,MAAAA,WAAW,EAAEntD,GAAG,CAACkwB,QAAJ,CAAa3jB,GAAb,EAAkB,gBAAlB,KAAuCvM,GAAG,CAACmwB,SAAJ,CAAc5jB,GAAd,EAAmB,aAAnB,CAHtC;AAId6gD,MAAAA,WAAW,EAAEptD,GAAG,CAACmwB,SAAJ,CAAc5jB,GAAd,EAAmB,aAAnB,KAAqCg+C,mBAAmB,CAAC76B,MAAM,CAAC1vB,GAAR,EAAauM,GAAb,EAAkB,SAAlB,CAJvD;AAKd68B,MAAAA,MAAM,EAAEokB,SAAS,CAACxtD,GAAD,EAAMuM,GAAN,CALH;AAMd8gD,MAAAA,OAAO,EAAE,CAAC,CAACrtD,GAAG,CAAC0tC,MAAJ,CAAW,SAAX,EAAsBnhC,GAAtB,EAA2B,CAA3B,CANG;AAOd+gD,MAAAA,KAAK,EAAEttD,GAAG,CAACmwB,SAAJ,CAAc5jB,GAAd,EAAmB,OAAnB,EAA4B,EAA5B,CAPO;AAQdghD,MAAAA,KAAK,EAAEV,aAAa,CAACn9B,MAAD,EAASnjB,GAAT;AARN,KAAD,EASZygD,cAAc,GAAGrB,qBAAqB,CAAC3rD,GAAD,EAAMuM,GAAN,CAAxB,GAAqC,EATvC,CAAf;AAUD,GAnBD;;AAoBA,MAAIuhD,yBAAyB,GAAG,UAAUp+B,MAAV,EAAkBnjB,GAAlB,EAAuBu9B,iBAAvB,EAA0C;AACxE,QAAI9pC,GAAG,GAAG0vB,MAAM,CAAC1vB,GAAjB;AACA,WAAOnJ,QAAQ,CAAC;AACdipB,MAAAA,MAAM,EAAE9f,GAAG,CAACkwB,QAAJ,CAAa3jB,GAAb,EAAkB,QAAlB,KAA+BvM,GAAG,CAACmwB,SAAJ,CAAc5jB,GAAd,EAAmB,QAAnB,CADzB;AAEd+gD,MAAAA,KAAK,EAAEttD,GAAG,CAACmwB,SAAJ,CAAc5jB,GAAd,EAAmB,OAAnB,EAA4B,EAA5B,CAFO;AAGdld,MAAAA,IAAI,EAAEmyD,UAAU,CAAC9xB,MAAD,EAASnjB,GAAT,CAHF;AAIdghD,MAAAA,KAAK,EAAEV,aAAa,CAACn9B,MAAD,EAASnjB,GAAT;AAJN,KAAD,EAKZu9B,iBAAiB,GAAG6hB,qBAAqB,CAAC3rD,GAAD,EAAMuM,GAAN,CAAxB,GAAqC,EAL1C,CAAf;AAMD,GARD;;AASA,MAAIwhD,0BAA0B,GAAG,UAAUr+B,MAAV,EAAkBjkB,IAAlB,EAAwBo+B,kBAAxB,EAA4CrmC,MAA5C,EAAoD;AACnF,QAAIxD,GAAG,GAAG0vB,MAAM,CAAC1vB,GAAjB;AACA,QAAIguD,MAAM,GAAGxqD,MAAM,CAAC5Q,KAAP,CAAa6Y,IAAb,CAAb;;AACA,QAAIykB,QAAQ,GAAG,UAAU5vB,OAAV,EAAmB6J,KAAnB,EAA0B;AACvC,aAAOnK,GAAG,CAACkwB,QAAJ,CAAa5vB,OAAb,EAAsB6J,KAAtB,KAAgCnK,GAAG,CAACmwB,SAAJ,CAAc7vB,OAAd,EAAuB6J,KAAvB,CAAvC;AACD,KAFD;;AAGA,WAAOtT,QAAQ,CAAC;AACd+rB,MAAAA,KAAK,EAAEsN,QAAQ,CAAC89B,MAAD,EAAS,OAAT,CADD;AAEdluC,MAAAA,MAAM,EAAEoQ,QAAQ,CAACzkB,IAAD,EAAO,QAAP,CAFF;AAGd1M,MAAAA,KAAK,EAAEiB,GAAG,CAACmwB,SAAJ,CAAc1kB,IAAd,EAAoB,OAApB,CAHO;AAIdwiD,MAAAA,QAAQ,EAAEz+B,WAAW,CAAC/jB,IAAD,CAJP;AAKd6hD,MAAAA,KAAK,EAAEttD,GAAG,CAACmwB,SAAJ,CAAc1kB,IAAd,EAAoB,OAApB,EAA6B,EAA7B,CALO;AAMdyiD,MAAAA,MAAM,EAAErB,aAAa,CAACn9B,MAAD,EAASjkB,IAAT,CANP;AAOd0iD,MAAAA,MAAM,EAAErB,aAAa,CAACp9B,MAAD,EAASjkB,IAAT;AAPP,KAAD,EAQZo+B,kBAAkB,GAAG8hB,qBAAqB,CAAC3rD,GAAD,EAAMyL,IAAN,CAAxB,GAAsC,EAR5C,CAAf;AASD,GAfD;;AAiBA,MAAI2iD,YAAY,GAAG,UAAU1+B,MAAV,EAAkB;AACnC,QAAI2+B,OAAO,GAAGnD,cAAc,CAAC/gB,gBAAgB,CAACza,MAAD,CAAjB,CAA5B;;AACA,QAAI2+B,OAAO,CAAC19D,MAAR,GAAiB,CAArB,EAAwB;AACtB,aAAO0D,QAAQ,CAACR,IAAT,CAAc;AACnB3E,QAAAA,IAAI,EAAE,OADa;AAEnBG,QAAAA,IAAI,EAAE,SAFa;AAGnB+rB,QAAAA,KAAK,EAAE,OAHY;AAInBmwC,QAAAA,KAAK,EAAE8C;AAJY,OAAd,CAAP;AAMD;;AACD,WAAOh6D,QAAQ,CAACtC,IAAT,EAAP;AACD,GAXD;;AAYA,MAAIu8D,UAAU,GAAG,CACf;AACEp/D,IAAAA,IAAI,EAAE,OADR;AAEEG,IAAAA,IAAI,EAAE,OAFR;AAGE+rB,IAAAA,KAAK,EAAE;AAHT,GADe,EAMf;AACElsB,IAAAA,IAAI,EAAE,QADR;AAEEG,IAAAA,IAAI,EAAE,OAFR;AAGE+rB,IAAAA,KAAK,EAAE;AAHT,GANe,EAWf;AACElsB,IAAAA,IAAI,EAAE,UADR;AAEEG,IAAAA,IAAI,EAAE,SAFR;AAGE+rB,IAAAA,KAAK,EAAE,WAHT;AAIEmwC,IAAAA,KAAK,EAAE,CACL;AACEzrD,MAAAA,IAAI,EAAE,MADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KADK,EAKL;AACEwQ,MAAAA,IAAI,EAAE,aADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KALK;AAJT,GAXe,EA0Bf;AACEJ,IAAAA,IAAI,EAAE,OADR;AAEEG,IAAAA,IAAI,EAAE,SAFR;AAGE+rB,IAAAA,KAAK,EAAE,OAHT;AAIEmwC,IAAAA,KAAK,EAAE,CACL;AACEzrD,MAAAA,IAAI,EAAE,MADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KADK,EAKL;AACEwQ,MAAAA,IAAI,EAAE,KADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KALK,EASL;AACEwQ,MAAAA,IAAI,EAAE,QADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KATK,EAaL;AACEwQ,MAAAA,IAAI,EAAE,WADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KAbK,EAiBL;AACEwQ,MAAAA,IAAI,EAAE,cADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KAjBK;AAJT,GA1Be,EAqDf;AACEJ,IAAAA,IAAI,EAAE,QADR;AAEEG,IAAAA,IAAI,EAAE,SAFR;AAGE+rB,IAAAA,KAAK,EAAE,kBAHT;AAIEmwC,IAAAA,KAAK,EAAE,CACL;AACEzrD,MAAAA,IAAI,EAAE,MADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KADK,EAKL;AACEwQ,MAAAA,IAAI,EAAE,MADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KALK,EASL;AACEwQ,MAAAA,IAAI,EAAE,QADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KATK,EAaL;AACEwQ,MAAAA,IAAI,EAAE,OADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KAbK;AAJT,GArDe,EA4Ef;AACEJ,IAAAA,IAAI,EAAE,QADR;AAEEG,IAAAA,IAAI,EAAE,SAFR;AAGE+rB,IAAAA,KAAK,EAAE,gBAHT;AAIEmwC,IAAAA,KAAK,EAAE,CACL;AACEzrD,MAAAA,IAAI,EAAE,MADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KADK,EAKL;AACEwQ,MAAAA,IAAI,EAAE,KADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KALK,EASL;AACEwQ,MAAAA,IAAI,EAAE,QADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KATK,EAaL;AACEwQ,MAAAA,IAAI,EAAE,QADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KAbK;AAJT,GA5Ee,CAAjB;;AAoGA,MAAIi/D,QAAQ,GAAG,UAAU7+B,MAAV,EAAkB;AAC/B,WAAO4+B,UAAU,CAAC/8D,MAAX,CAAkB68D,YAAY,CAAC1+B,MAAD,CAAZ,CAAqB/7B,OAArB,EAAlB,CAAP;AACD,GAFD;;AAIA,MAAI66D,SAAS,GAAG,UAAUC,UAAV,EAAsB;AACpC,WAAO,UAAU/+B,MAAV,EAAkB9vB,IAAlB,EAAwB;AAC7B,UAAII,GAAG,GAAG0vB,MAAM,CAAC1vB,GAAjB;;AACA,UAAIuiD,SAAS,GAAG,UAAUt4C,IAAV,EAAgB3a,KAAhB,EAAuB;AACrC,YAAI,CAACm/D,UAAD,IAAen/D,KAAnB,EAA0B;AACxB0Q,UAAAA,GAAG,CAACuiD,SAAJ,CAAc3iD,IAAd,EAAoBqK,IAApB,EAA0B3a,KAA1B;AACD;AACF,OAJD;;AAKA,UAAIo/D,QAAQ,GAAG,UAAUnmC,IAAV,EAAgBj5B,KAAhB,EAAuB;AACpC,YAAI,CAACm/D,UAAD,IAAen/D,KAAnB,EAA0B;AACxB0Q,UAAAA,GAAG,CAAC0uD,QAAJ,CAAa9uD,IAAb,EAAmB2oB,IAAnB,EAAyBj5B,KAAzB;AACD;AACF,OAJD;;AAKA,UAAIq/D,SAAS,GAAG,UAAUhC,UAAV,EAAsBr9D,KAAtB,EAA6B;AAC3C,YAAI,CAACm/D,UAAD,IAAen/D,KAAnB,EAA0B;AACxB,cAAIA,KAAK,KAAK,EAAd,EAAkB;AAChBogC,YAAAA,MAAM,CAACm7B,SAAP,CAAiBhhD,MAAjB,CAAwB8iD,UAAxB,EAAoC;AAAEr9D,cAAAA,KAAK,EAAE;AAAT,aAApC,EAAqDsQ,IAArD,EAA2D,IAA3D;AACD,WAFD,MAEO;AACL8vB,YAAAA,MAAM,CAACm7B,SAAP,CAAiBj6D,KAAjB,CAAuB+7D,UAAvB,EAAmC;AAAEr9D,cAAAA,KAAK,EAAEA;AAAT,aAAnC,EAAqDsQ,IAArD;AACD;AACF;AACF,OARD;;AASA,aAAO;AACL2iD,QAAAA,SAAS,EAAEA,SADN;AAELmM,QAAAA,QAAQ,EAAEA,QAFL;AAGLC,QAAAA,SAAS,EAAEA;AAHN,OAAP;AAKD,KA1BD;AA2BD,GA5BD;;AA6BA,MAAIC,WAAW,GAAG;AAChBC,IAAAA,MAAM,EAAEL,SAAS,CAAC,KAAD,CADD;AAEhBM,IAAAA,QAAQ,EAAEN,SAAS,CAAC,IAAD;AAFH,GAAlB;;AAKA,MAAIO,gBAAgB,GAAG,UAAU9qD,KAAV,EAAiB;AACtC,WAAO0I,KAAK,CAAC1I,KAAK,CAAC,CAAD,CAAN,CAAL,CAAgB9Q,GAAhB,CAAoB,UAAUwZ,KAAV,EAAiB;AAC1C,UAAImC,SAAS,GAAGkC,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAhB;AACA,UAAIye,QAAQ,GAAGpa,SAAS,CAACL,SAAV,CAAoB7B,SAApB,CAAf;AACA,UAAII,QAAQ,GAAG1b,MAAM,CAAC43B,QAAD,EAAW,UAAU4jC,KAAV,EAAiB;AAC/C,eAAO17D,MAAM,CAAC2Q,KAAD,EAAQ,UAAUgrD,KAAV,EAAiB;AACpC,iBAAO9tD,IAAI,CAAC6tD,KAAK,CAAC1uD,OAAP,EAAgB2uD,KAAhB,CAAX;AACD,SAFY,CAAb;AAGD,OAJoB,CAArB;AAKA,aAAO97D,GAAG,CAAC+b,QAAD,EAAW,UAAUzD,IAAV,EAAgB;AACnC,eAAO;AACLnL,UAAAA,OAAO,EAAEmL,IAAI,CAACnL,OAAL,CAAaN,GADjB;AAELwD,UAAAA,MAAM,EAAEwN,SAAS,CAACD,WAAV,CAAsBjC,SAAtB,EAAiCrD,IAAI,CAACjI,MAAtC,EAA8CrQ,GAA9C,CAAkD,UAAUorB,GAAV,EAAe;AACvE,mBAAOA,GAAG,CAACje,OAAJ,CAAYN,GAAnB;AACD,WAFO;AAFH,SAAP;AAMD,OAPS,CAAV;AAQD,KAhBM,CAAP;AAiBD,GAlBD;;AAmBA,MAAIkvD,iBAAiB,GAAG,UAAUC,QAAV,EAAoBC,WAApB,EAAiCj8B,IAAjC,EAAuC;AAC7Dg8B,IAAAA,QAAQ,CAAC5M,SAAT,CAAmB,OAAnB,EAA4BpvB,IAAI,CAACp0B,KAAjC;AACAowD,IAAAA,QAAQ,CAAC5M,SAAT,CAAmB,OAAnB,EAA4BpvB,IAAI,CAACm6B,KAAjC;AACA6B,IAAAA,QAAQ,CAACT,QAAT,CAAkB,QAAlB,EAA4B5+B,WAAW,CAACqD,IAAI,CAACrT,MAAN,CAAvC;AACAsvC,IAAAA,WAAW,CAACV,QAAZ,CAAqB,OAArB,EAA8B5+B,WAAW,CAACqD,IAAI,CAACvQ,KAAN,CAAzC;AACD,GALD;;AAMA,MAAIysC,mBAAmB,GAAG,UAAUF,QAAV,EAAoBh8B,IAApB,EAA0B;AAClDg8B,IAAAA,QAAQ,CAACR,SAAT,CAAmB,0BAAnB,EAA+Cx7B,IAAI,CAAC44B,eAApD;AACAoD,IAAAA,QAAQ,CAACR,SAAT,CAAmB,sBAAnB,EAA2Cx7B,IAAI,CAAC24B,WAAhD;AACAqD,IAAAA,QAAQ,CAACR,SAAT,CAAmB,sBAAnB,EAA2Cx7B,IAAI,CAAC04B,WAAhD;AACAsD,IAAAA,QAAQ,CAACR,SAAT,CAAmB,sBAAnB,EAA2C7+B,WAAW,CAACqD,IAAI,CAACy4B,WAAN,CAAtD;AACD,GALD;;AAMA,MAAI0D,aAAa,GAAG,UAAU5/B,MAAV,EAAkBzrB,KAAlB,EAAyBsrD,OAAzB,EAAkCp8B,IAAlC,EAAwC;AAC1D,QAAIq8B,YAAY,GAAGvrD,KAAK,CAACtT,MAAN,KAAiB,CAApC;AACA,QAAI8+D,YAAY,GAAGltD,QAAQ,CAAC4wB,IAAD,EAAO,UAAU7jC,KAAV,EAAiBsT,GAAjB,EAAsB;AACtD,aAAO2sD,OAAO,CAAC3sD,GAAD,CAAP,KAAiBtT,KAAxB;AACD,KAF0B,CAA3B;;AAGA,QAAIoT,IAAI,CAAC+sD,YAAD,CAAJ,GAAqB,CAArB,IAA0BxrD,KAAK,CAACtT,MAAN,IAAgB,CAA9C,EAAiD;AAC/C,UAAIgf,QAAQ,GAAGhD,KAAK,CAAC1I,KAAK,CAAC,CAAD,CAAN,CAApB;AACA8qD,MAAAA,gBAAgB,CAAC9qD,KAAD,CAAhB,CAAwB7Q,IAAxB,CAA6B,UAAUi4B,aAAV,EAAyB;AACpDj4B,QAAAA,IAAI,CAACi4B,aAAD,EAAgB,UAAUpc,IAAV,EAAgB;AAClC,cAAIygD,OAAO,GAAGpN,cAAc,CAAC5yB,MAAD,EAASzgB,IAAI,CAAC3O,OAAd,EAAuB6yB,IAAI,CAAC86B,QAA5B,CAA5B;AACA,cAAIkB,QAAQ,GAAGK,YAAY,GAAGZ,WAAW,CAACC,MAAZ,CAAmBn/B,MAAnB,EAA2BggC,OAA3B,CAAH,GAAyCd,WAAW,CAACE,QAAZ,CAAqBp/B,MAArB,EAA6BggC,OAA7B,CAApE;AACA,cAAIN,WAAW,GAAGngD,IAAI,CAACzL,MAAL,CAAYrQ,GAAZ,CAAgB,UAAUorB,GAAV,EAAe;AAC/C,mBAAOixC,YAAY,GAAGZ,WAAW,CAACC,MAAZ,CAAmBn/B,MAAnB,EAA2BnR,GAA3B,CAAH,GAAqCqwC,WAAW,CAACE,QAAZ,CAAqBp/B,MAArB,EAA6BnR,GAA7B,CAAxD;AACD,WAFiB,EAEf3rB,KAFe,CAETu8D,QAFS,CAAlB;AAGAD,UAAAA,iBAAiB,CAACC,QAAD,EAAWC,WAAX,EAAwBj8B,IAAxB,CAAjB;;AACA,cAAI0W,kBAAkB,CAACna,MAAD,CAAtB,EAAgC;AAC9B2/B,YAAAA,mBAAmB,CAACF,QAAD,EAAWh8B,IAAX,CAAnB;AACD;;AACD,cAAIq8B,YAAJ,EAAkB;AAChBzE,YAAAA,YAAY,CAACr7B,MAAD,EAASggC,OAAT,CAAZ;AACA1E,YAAAA,aAAa,CAACt7B,MAAD,EAASggC,OAAT,CAAb;AACD;;AACD,cAAIv8B,IAAI,CAAC+6B,MAAT,EAAiB;AACftD,YAAAA,UAAU,CAACl7B,MAAD,EAASggC,OAAT,EAAkBv8B,IAAI,CAAC+6B,MAAvB,CAAV;AACD;;AACD,cAAI/6B,IAAI,CAACg7B,MAAT,EAAiB;AACfrD,YAAAA,WAAW,CAACp7B,MAAD,EAASggC,OAAT,EAAkBv8B,IAAI,CAACg7B,MAAvB,CAAX;AACD;AACF,SApBG,CAAJ;AAqBD,OAtBD;AAuBA,UAAIwB,eAAe,GAAGjtD,IAAI,CAACH,QAAQ,CAACktD,YAAD,EAAe,UAAUvmB,MAAV,EAAkBtmC,GAAlB,EAAuB;AACvE,eAAOA,GAAG,KAAK,OAAR,IAAmBA,GAAG,KAAK,UAAlC;AACD,OAFkC,CAAT,CAAJ,GAEhB,CAFN;AAGA+M,MAAAA,QAAQ,CAACvc,IAAT,CAAc,UAAUuZ,KAAV,EAAiB;AAC7B,eAAO67B,iBAAiB,CAAC9Y,MAAD,EAAS/iB,KAAK,CAAC3M,GAAf,EAAoB;AAC1C0oC,UAAAA,SAAS,EAAE7lC,GAAG,CAAC4sD,YAAD,EAAe,UAAf,CAD4B;AAE1CtlD,UAAAA,KAAK,EAAEwlD;AAFmC,SAApB,CAAxB;AAID,OALD;AAMD;AACF,GAxCD;;AAyCA,MAAIC,gBAAgB,GAAG,UAAUlgC,MAAV,EAAkBzrB,KAAlB,EAAyBsrD,OAAzB,EAAkCl6C,GAAlC,EAAuC;AAC5D,QAAI8d,IAAI,GAAG9d,GAAG,CAACw6C,OAAJ,EAAX;AACAx6C,IAAAA,GAAG,CAACy6C,KAAJ;AACApgC,IAAAA,MAAM,CAAC8d,WAAP,CAAmBuiB,QAAnB,CAA4B,YAAY;AACtCT,MAAAA,aAAa,CAAC5/B,MAAD,EAASzrB,KAAT,EAAgBsrD,OAAhB,EAAyBp8B,IAAzB,CAAb;AACAzD,MAAAA,MAAM,CAAC4D,KAAP;AACD,KAHD;AAID,GAPD;;AAQA,MAAIu8B,OAAO,GAAG,UAAUngC,MAAV,EAAkBzrB,KAAlB,EAAyB;AACrC,QAAI+rD,SAAS,GAAGjB,gBAAgB,CAAC9qD,KAAD,CAAhB,CAAwB9Q,GAAxB,CAA4B,UAAUk4B,aAAV,EAAyB;AACnE,aAAOl4B,GAAG,CAACk4B,aAAD,EAAgB,UAAUpc,IAAV,EAAgB;AACxC,eAAO8+C,0BAA0B,CAACr+B,MAAD,EAASzgB,IAAI,CAAC3O,OAAd,EAAuBupC,kBAAkB,CAACna,MAAD,CAAzC,EAAmDzgB,IAAI,CAACzL,MAAxD,CAAjC;AACD,OAFS,CAAV;AAGD,KAJe,CAAhB;AAKA,WAAOwoD,eAAe,CAACgE,SAAS,CAACl9D,QAAV,EAAD,CAAtB;AACD,GAPD;;AAQA,MAAIm9D,IAAI,GAAG,UAAUvgC,MAAV,EAAkBc,UAAlB,EAA8B;AACvC,QAAIvsB,KAAK,GAAGm/C,qBAAqB,CAAC9yB,iBAAiB,CAACZ,MAAD,CAAlB,EAA4Bc,UAA5B,CAAjC;;AACA,QAAIvsB,KAAK,CAACtT,MAAN,KAAiB,CAArB,EAAwB;AACtB;AACD;;AACD,QAAIwiC,IAAI,GAAG08B,OAAO,CAACngC,MAAD,EAASzrB,KAAT,CAAlB;AACA,QAAIisD,cAAc,GAAG;AACnB7gE,MAAAA,IAAI,EAAE,UADa;AAEnB8gE,MAAAA,IAAI,EAAE,CACJ;AACE7E,QAAAA,KAAK,EAAE,SADT;AAEEp8D,QAAAA,IAAI,EAAE,SAFR;AAGEq8D,QAAAA,KAAK,EAAEgD,QAAQ,CAAC7+B,MAAD;AAHjB,OADI,EAMJ48B,cAAc,CAAC,MAAD,CANV;AAFa,KAArB;AAWA,QAAI8D,WAAW,GAAG;AAChB/gE,MAAAA,IAAI,EAAE,OADU;AAEhBk8D,MAAAA,KAAK,EAAE,CAAC;AACJl8D,QAAAA,IAAI,EAAE,MADF;AAEJgU,QAAAA,OAAO,EAAE,CAFL;AAGJkoD,QAAAA,KAAK,EAAEgD,QAAQ,CAAC7+B,MAAD;AAHX,OAAD;AAFS,KAAlB;AAQAA,IAAAA,MAAM,CAAC2gC,aAAP,CAAqBJ,IAArB,CAA0B;AACxB3E,MAAAA,KAAK,EAAE,iBADiB;AAExB5oD,MAAAA,IAAI,EAAE,QAFkB;AAGxBqF,MAAAA,IAAI,EAAE8hC,kBAAkB,CAACna,MAAD,CAAlB,GAA6BwgC,cAA7B,GAA8CE,WAH5B;AAIxBE,MAAAA,OAAO,EAAE,CACP;AACEjhE,QAAAA,IAAI,EAAE,QADR;AAEEH,QAAAA,IAAI,EAAE,QAFR;AAGE4Q,QAAAA,IAAI,EAAE;AAHR,OADO,EAMP;AACEzQ,QAAAA,IAAI,EAAE,QADR;AAEEH,QAAAA,IAAI,EAAE,MAFR;AAGE4Q,QAAAA,IAAI,EAAE,MAHR;AAIEywD,QAAAA,OAAO,EAAE;AAJX,OANO,CAJe;AAiBxBC,MAAAA,WAAW,EAAEr9B,IAjBW;AAkBxBs9B,MAAAA,QAAQ,EAAEv/D,KAAK,CAAC0+D,gBAAD,EAAmBlgC,MAAnB,EAA2BzrB,KAA3B,EAAkCkvB,IAAlC;AAlBS,KAA1B;AAoBD,GA7CD;;AA+CA,MAAIu9B,cAAc,GAAG,UAAUhhC,MAAV,EAAkB;AACrC,QAAI2+B,OAAO,GAAGnD,cAAc,CAAC9gB,eAAe,CAAC1a,MAAD,CAAhB,CAA5B;;AACA,QAAI2+B,OAAO,CAAC19D,MAAR,GAAiB,CAArB,EAAwB;AACtB,aAAO0D,QAAQ,CAACR,IAAT,CAAc;AACnB3E,QAAAA,IAAI,EAAE,OADa;AAEnBG,QAAAA,IAAI,EAAE,SAFa;AAGnB+rB,QAAAA,KAAK,EAAE,OAHY;AAInBmwC,QAAAA,KAAK,EAAE8C;AAJY,OAAd,CAAP;AAMD;;AACD,WAAOh6D,QAAQ,CAACtC,IAAT,EAAP;AACD,GAXD;;AAYA,MAAI4+D,YAAY,GAAG,CACjB;AACEthE,IAAAA,IAAI,EAAE,SADR;AAEEH,IAAAA,IAAI,EAAE,MAFR;AAGEksB,IAAAA,KAAK,EAAE,UAHT;AAIEmwC,IAAAA,KAAK,EAAE,CACL;AACEzrD,MAAAA,IAAI,EAAE,QADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KADK,EAKL;AACEwQ,MAAAA,IAAI,EAAE,MADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KALK,EASL;AACEwQ,MAAAA,IAAI,EAAE,QADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KATK;AAJT,GADiB,EAoBjB;AACED,IAAAA,IAAI,EAAE,SADR;AAEEH,IAAAA,IAAI,EAAE,OAFR;AAGEksB,IAAAA,KAAK,EAAE,WAHT;AAIEmwC,IAAAA,KAAK,EAAE,CACL;AACEzrD,MAAAA,IAAI,EAAE,MADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KADK,EAKL;AACEwQ,MAAAA,IAAI,EAAE,MADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KALK,EASL;AACEwQ,MAAAA,IAAI,EAAE,QADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KATK,EAaL;AACEwQ,MAAAA,IAAI,EAAE,OADR;AAEExQ,MAAAA,KAAK,EAAE;AAFT,KAbK;AAJT,GApBiB,EA2CjB;AACE8rB,IAAAA,KAAK,EAAE,QADT;AAEElsB,IAAAA,IAAI,EAAE,QAFR;AAGEG,IAAAA,IAAI,EAAE;AAHR,GA3CiB,CAAnB;;AAiDA,MAAIuhE,UAAU,GAAG,UAAUlhC,MAAV,EAAkB;AACjC,WAAOihC,YAAY,CAACp/D,MAAb,CAAoBm/D,cAAc,CAAChhC,MAAD,CAAd,CAAuB/7B,OAAvB,EAApB,CAAP;AACD,GAFD;;AAIA,MAAIk9D,mBAAmB,GAAG,UAAU1B,QAAV,EAAoBh8B,IAApB,EAA0B;AAClDg8B,IAAAA,QAAQ,CAAC5M,SAAT,CAAmB,OAAnB,EAA4BpvB,IAAI,CAACm6B,KAAjC;AACA6B,IAAAA,QAAQ,CAACT,QAAT,CAAkB,QAAlB,EAA4B5+B,WAAW,CAACqD,IAAI,CAACrT,MAAN,CAAvC;AACD,GAHD;;AAIA,MAAIgxC,qBAAqB,GAAG,UAAU3B,QAAV,EAAoBh8B,IAApB,EAA0B;AACpDg8B,IAAAA,QAAQ,CAACT,QAAT,CAAkB,kBAAlB,EAAsCv7B,IAAI,CAAC44B,eAA3C;AACAoD,IAAAA,QAAQ,CAACT,QAAT,CAAkB,cAAlB,EAAkCv7B,IAAI,CAAC24B,WAAvC;AACAqD,IAAAA,QAAQ,CAACT,QAAT,CAAkB,cAAlB,EAAkCv7B,IAAI,CAAC04B,WAAvC;AACD,GAJD;;AAKA,MAAIkF,YAAY,GAAG,UAAUrhC,MAAV,EAAkBtsB,IAAlB,EAAwBmsD,OAAxB,EAAiCp8B,IAAjC,EAAuC;AACxD,QAAI69B,WAAW,GAAG5tD,IAAI,CAACzS,MAAL,KAAgB,CAAlC;AACA,QAAI8+D,YAAY,GAAGltD,QAAQ,CAAC4wB,IAAD,EAAO,UAAU7jC,KAAV,EAAiBsT,GAAjB,EAAsB;AACtD,aAAO2sD,OAAO,CAAC3sD,GAAD,CAAP,KAAiBtT,KAAxB;AACD,KAF0B,CAA3B;;AAGA,QAAIoT,IAAI,CAAC+sD,YAAD,CAAJ,GAAqB,CAAzB,EAA4B;AAC1Br8D,MAAAA,IAAI,CAACgQ,IAAD,EAAO,UAAUu+C,MAAV,EAAkB;AAC3B,YAAIxuB,IAAI,CAAC9jC,IAAL,KAAcmgC,WAAW,CAACmyB,MAAM,CAAC57C,UAAR,CAA7B,EAAkD;AAChD08C,UAAAA,iBAAiB,CAAC/yB,MAAD,EAASiyB,MAAT,EAAiBxuB,IAAI,CAAC9jC,IAAtB,CAAjB;AACD;;AACD,YAAI8/D,QAAQ,GAAG6B,WAAW,GAAGpC,WAAW,CAACC,MAAZ,CAAmBn/B,MAAnB,EAA2BiyB,MAA3B,CAAH,GAAwCiN,WAAW,CAACE,QAAZ,CAAqBp/B,MAArB,EAA6BiyB,MAA7B,CAAlE;AACAkP,QAAAA,mBAAmB,CAAC1B,QAAD,EAAWh8B,IAAX,CAAnB;;AACA,YAAI2W,iBAAiB,CAACpa,MAAD,CAArB,EAA+B;AAC7BohC,UAAAA,qBAAqB,CAAC3B,QAAD,EAAWh8B,IAAX,CAArB;AACD;;AACD,YAAIA,IAAI,CAACo6B,KAAL,KAAegC,OAAO,CAAChC,KAA3B,EAAkC;AAChCxC,UAAAA,YAAY,CAACr7B,MAAD,EAASiyB,MAAT,CAAZ;AACAiJ,UAAAA,UAAU,CAACl7B,MAAD,EAASiyB,MAAT,EAAiBxuB,IAAI,CAACo6B,KAAtB,CAAV;AACD;AACF,OAbG,CAAJ;AAcA,UAAI0D,cAAc,GAAGpuD,GAAG,CAAC4sD,YAAD,EAAe,MAAf,CAAxB;AACA,UAAIE,eAAe,GAAGsB,cAAc,GAAGvuD,IAAI,CAAC+sD,YAAD,CAAJ,GAAqB,CAAxB,GAA4B,IAAhE;AACA9iD,MAAAA,KAAK,CAACtM,YAAY,CAACZ,OAAb,CAAqB2D,IAAI,CAAC,CAAD,CAAzB,CAAD,CAAL,CAAqChQ,IAArC,CAA0C,UAAUuZ,KAAV,EAAiB;AACzD,eAAO67B,iBAAiB,CAAC9Y,MAAD,EAAS/iB,KAAK,CAAC3M,GAAf,EAAoB;AAC1C0oC,UAAAA,SAAS,EAAEuoB,cAD+B;AAE1C9mD,UAAAA,KAAK,EAAEwlD;AAFmC,SAApB,CAAxB;AAID,OALD;AAMD;AACF,GA7BD;;AA8BA,MAAIuB,eAAe,GAAG,UAAUxhC,MAAV,EAAkBtsB,IAAlB,EAAwBmsD,OAAxB,EAAiCl6C,GAAjC,EAAsC;AAC1D,QAAI8d,IAAI,GAAG9d,GAAG,CAACw6C,OAAJ,EAAX;AACAx6C,IAAAA,GAAG,CAACy6C,KAAJ;AACApgC,IAAAA,MAAM,CAAC8d,WAAP,CAAmBuiB,QAAnB,CAA4B,YAAY;AACtCgB,MAAAA,YAAY,CAACrhC,MAAD,EAAStsB,IAAT,EAAemsD,OAAf,EAAwBp8B,IAAxB,CAAZ;AACAzD,MAAAA,MAAM,CAAC4D,KAAP;AACD,KAHD;AAID,GAPD;;AAQA,MAAI69B,MAAM,GAAG,UAAUzhC,MAAV,EAAkB;AAC7B,QAAItsB,IAAI,GAAGkgD,oBAAoB,CAAChzB,iBAAiB,CAACZ,MAAD,CAAlB,EAA4BmB,QAAQ,CAACS,QAArC,CAA/B;;AACA,QAAIluB,IAAI,CAACzS,MAAL,KAAgB,CAApB,EAAuB;AACrB;AACD;;AACD,QAAIygE,QAAQ,GAAGj+D,GAAG,CAACiQ,IAAD,EAAO,UAAUu+C,MAAV,EAAkB;AACzC,aAAOmM,yBAAyB,CAACp+B,MAAD,EAASiyB,MAAM,CAAC3hD,GAAhB,EAAqB8pC,iBAAiB,CAACpa,MAAD,CAAtC,CAAhC;AACD,KAFiB,CAAlB;AAGA,QAAIyD,IAAI,GAAG64B,eAAe,CAACoF,QAAD,CAA1B;AACA,QAAIlB,cAAc,GAAG;AACnB7gE,MAAAA,IAAI,EAAE,UADa;AAEnB8gE,MAAAA,IAAI,EAAE,CACJ;AACE7E,QAAAA,KAAK,EAAE,SADT;AAEEp8D,QAAAA,IAAI,EAAE,SAFR;AAGEq8D,QAAAA,KAAK,EAAEqF,UAAU,CAAClhC,MAAD;AAHnB,OADI,EAMJ48B,cAAc,CAAC,KAAD,CANV;AAFa,KAArB;AAWA,QAAI8D,WAAW,GAAG;AAChB/gE,MAAAA,IAAI,EAAE,OADU;AAEhBk8D,MAAAA,KAAK,EAAE,CAAC;AACJl8D,QAAAA,IAAI,EAAE,MADF;AAEJgU,QAAAA,OAAO,EAAE,CAFL;AAGJkoD,QAAAA,KAAK,EAAEqF,UAAU,CAAClhC,MAAD;AAHb,OAAD;AAFS,KAAlB;AAQAA,IAAAA,MAAM,CAAC2gC,aAAP,CAAqBJ,IAArB,CAA0B;AACxB3E,MAAAA,KAAK,EAAE,gBADiB;AAExB5oD,MAAAA,IAAI,EAAE,QAFkB;AAGxBqF,MAAAA,IAAI,EAAE+hC,iBAAiB,CAACpa,MAAD,CAAjB,GAA4BwgC,cAA5B,GAA6CE,WAH3B;AAIxBE,MAAAA,OAAO,EAAE,CACP;AACEjhE,QAAAA,IAAI,EAAE,QADR;AAEEH,QAAAA,IAAI,EAAE,QAFR;AAGE4Q,QAAAA,IAAI,EAAE;AAHR,OADO,EAMP;AACEzQ,QAAAA,IAAI,EAAE,QADR;AAEEH,QAAAA,IAAI,EAAE,MAFR;AAGE4Q,QAAAA,IAAI,EAAE,MAHR;AAIEywD,QAAAA,OAAO,EAAE;AAJX,OANO,CAJe;AAiBxBC,MAAAA,WAAW,EAAEr9B,IAjBW;AAkBxBs9B,MAAAA,QAAQ,EAAEv/D,KAAK,CAACggE,eAAD,EAAkBxhC,MAAlB,EAA0Bv8B,GAAG,CAACiQ,IAAD,EAAO,UAAU/N,CAAV,EAAa;AAC9D,eAAOA,CAAC,CAAC2K,GAAT;AACD,OAF2C,CAA7B,EAEXmzB,IAFW;AAlBS,KAA1B;AAsBD,GAlDD;;AAoDA,MAAIk+B,QAAQ,GAAGh1C,OAAO,CAACC,IAAR,CAAaC,KAAb,CAAmBC,OAAnB,CAA2B,aAA3B,CAAf;;AAEA,MAAI80C,UAAU,GAAG,UAAU5hC,MAAV,EAAkB2+B,OAAlB,EAA2BkD,cAA3B,EAA2C;AAC1D,QAAIC,gBAAgB,GAAG,CAACD,cAAD,GAAkB,EAAlB,GAAuB,CAC5C;AACEliE,MAAAA,IAAI,EAAE,OADR;AAEEH,MAAAA,IAAI,EAAE,MAFR;AAGEksB,MAAAA,KAAK,EAAE,MAHT;AAIEq2C,MAAAA,SAAS,EAAE;AAJb,KAD4C,EAO5C;AACEpiE,MAAAA,IAAI,EAAE,OADR;AAEEH,MAAAA,IAAI,EAAE,MAFR;AAGEksB,MAAAA,KAAK,EAAE,MAHT;AAIEq2C,MAAAA,SAAS,EAAE;AAJb,KAP4C,CAA9C;AAcA,QAAIC,WAAW,GAAG,CAChB;AACEriE,MAAAA,IAAI,EAAE,OADR;AAEEH,MAAAA,IAAI,EAAE,OAFR;AAGEksB,MAAAA,KAAK,EAAE;AAHT,KADgB,EAMhB;AACE/rB,MAAAA,IAAI,EAAE,OADR;AAEEH,MAAAA,IAAI,EAAE,QAFR;AAGEksB,MAAAA,KAAK,EAAE;AAHT,KANgB,CAAlB;AAYA,QAAIu2C,eAAe,GAAG3nB,oBAAoB,CAACta,MAAD,CAApB,GAA+B,CACnD;AACErgC,MAAAA,IAAI,EAAE,OADR;AAEEH,MAAAA,IAAI,EAAE,aAFR;AAGEksB,MAAAA,KAAK,EAAE,cAHT;AAIEq2C,MAAAA,SAAS,EAAE;AAJb,KADmD,EAOnD;AACEpiE,MAAAA,IAAI,EAAE,OADR;AAEEH,MAAAA,IAAI,EAAE,aAFR;AAGEksB,MAAAA,KAAK,EAAE,cAHT;AAIEq2C,MAAAA,SAAS,EAAE;AAJb,KAPmD,EAanD;AACEpiE,MAAAA,IAAI,EAAE,OADR;AAEEH,MAAAA,IAAI,EAAE,QAFR;AAGEksB,MAAAA,KAAK,EAAE;AAHT,KAbmD,EAkBnD;AACE/rB,MAAAA,IAAI,EAAE,OADR;AAEE+rB,MAAAA,KAAK,EAAE,SAFT;AAGEmwC,MAAAA,KAAK,EAAE,CAAC;AACJl8D,QAAAA,IAAI,EAAE,UADF;AAEJH,QAAAA,IAAI,EAAE,SAFF;AAGJksB,QAAAA,KAAK,EAAE;AAHH,OAAD;AAHT,KAlBmD,CAA/B,GA2BlB,EA3BJ;AA4BA,QAAIw2C,aAAa,GAAG,CAAC;AACjBviE,MAAAA,IAAI,EAAE,SADW;AAEjBH,MAAAA,IAAI,EAAE,OAFW;AAGjBksB,MAAAA,KAAK,EAAE,WAHU;AAIjBmwC,MAAAA,KAAK,EAAE,CACL;AACEzrD,QAAAA,IAAI,EAAE,MADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OADK,EAKL;AACEwQ,QAAAA,IAAI,EAAE,MADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OALK,EASL;AACEwQ,QAAAA,IAAI,EAAE,QADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OATK,EAaL;AACEwQ,QAAAA,IAAI,EAAE,OADR;AAEExQ,QAAAA,KAAK,EAAE;AAFT,OAbK;AAJU,KAAD,CAApB;AAuBA,QAAIuiE,aAAa,GAAGxD,OAAO,CAAC19D,MAAR,GAAiB,CAAjB,GAAqB,CAAC;AACtCtB,MAAAA,IAAI,EAAE,SADgC;AAEtCH,MAAAA,IAAI,EAAE,OAFgC;AAGtCksB,MAAAA,KAAK,EAAE,OAH+B;AAItCmwC,MAAAA,KAAK,EAAE8C;AAJ+B,KAAD,CAArB,GAKb,EALP;AAMA,WAAOmD,gBAAgB,CAACjgE,MAAjB,CAAwBmgE,WAAxB,EAAqCngE,MAArC,CAA4CogE,eAA5C,EAA6DpgE,MAA7D,CAAoEqgE,aAApE,EAAmFrgE,MAAnF,CAA0FsgE,aAA1F,CAAP;AACD,GArFD;;AAuFA,MAAIC,SAAS,GAAG,UAAU9xD,GAAV,EAAeuM,GAAf,EAAoBrd,IAApB,EAA0BI,KAA1B,EAAiC;AAC/C,QAAIid,GAAG,CAACyuC,OAAJ,KAAgB,IAAhB,IAAwBzuC,GAAG,CAACyuC,OAAJ,KAAgB,IAA5C,EAAkD;AAChD,UAAItrD,QAAQ,CAACR,IAAD,CAAZ,EAAoB;AAClB8Q,QAAAA,GAAG,CAAC0uD,QAAJ,CAAaniD,GAAb,EAAkBrd,IAAlB,EAAwBI,KAAxB;AACD,OAFD,MAEO;AACL0Q,QAAAA,GAAG,CAAC0uD,QAAJ,CAAaniD,GAAb,EAAkBrd,IAAlB;AACD;AACF,KAND,MAMO;AACL,UAAIqd,GAAG,CAAC9F,QAAR,EAAkB;AAChB,aAAK,IAAIxR,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsX,GAAG,CAAC9F,QAAJ,CAAa9V,MAAjC,EAAyCsE,CAAC,EAA1C,EAA8C;AAC5C68D,UAAAA,SAAS,CAAC9xD,GAAD,EAAMuM,GAAG,CAAC9F,QAAJ,CAAaxR,CAAb,CAAN,EAAuB/F,IAAvB,EAA6BI,KAA7B,CAAT;AACD;AACF;AACF;AACF,GAdD;;AAeA,MAAIyiE,kBAAkB,GAAG,UAAUriC,MAAV,EAAkBmyB,QAAlB,EAA4B1uB,IAA5B,EAAkC;AACzD,QAAInzB,GAAG,GAAG0vB,MAAM,CAAC1vB,GAAjB;AACA,QAAIyJ,KAAK,GAAG,EAAZ;AACA,QAAIqB,MAAM,GAAG,EAAb;AACArB,IAAAA,KAAK,CAAC6jD,KAAN,GAAcn6B,IAAI,CAACm6B,KAAnB;AACAxiD,IAAAA,MAAM,CAACgV,MAAP,GAAgBgQ,WAAW,CAACqD,IAAI,CAACrT,MAAN,CAA3B;;AACA,QAAI9f,GAAG,CAACmwB,SAAJ,CAAc0xB,QAAd,EAAwB,OAAxB,KAAoC,CAAC3X,kBAAkB,CAACxa,MAAD,CAA3D,EAAqE;AACnEjmB,MAAAA,KAAK,CAACmZ,KAAN,GAAciN,cAAc,CAACsD,IAAI,CAACvQ,KAAN,CAA5B;AACD,KAFD,MAEO;AACL9X,MAAAA,MAAM,CAAC8X,KAAP,GAAekN,WAAW,CAACqD,IAAI,CAACvQ,KAAN,CAA1B;AACD;;AACD,QAAIsnB,kBAAkB,CAACxa,MAAD,CAAtB,EAAgC;AAC9B5kB,MAAAA,MAAM,CAAC,cAAD,CAAN,GAAyBglB,WAAW,CAACqD,IAAI,CAACiW,MAAN,CAApC;AACAt+B,MAAAA,MAAM,CAAC,gBAAD,CAAN,GAA2BglB,WAAW,CAACqD,IAAI,CAACg6B,WAAN,CAAtC;AACD,KAHD,MAGO;AACL1jD,MAAAA,KAAK,CAAC2/B,MAAN,GAAejW,IAAI,CAACiW,MAApB;AACA3/B,MAAAA,KAAK,CAAC2jD,WAAN,GAAoBj6B,IAAI,CAACi6B,WAAzB;AACA3jD,MAAAA,KAAK,CAAC0jD,WAAN,GAAoBh6B,IAAI,CAACg6B,WAAzB;AACD;;AACD,QAAIjjB,kBAAkB,CAACxa,MAAD,CAAlB,IAA8BmyB,QAAQ,CAACp7C,QAA3C,EAAqD;AACnD,WAAK,IAAIxR,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG4sD,QAAQ,CAACp7C,QAAT,CAAkB9V,MAAtC,EAA8CsE,CAAC,EAA/C,EAAmD;AACjD68D,QAAAA,SAAS,CAAC9xD,GAAD,EAAM6hD,QAAQ,CAACp7C,QAAT,CAAkBxR,CAAlB,CAAN,EAA4B;AACnC,0BAAgB66B,WAAW,CAACqD,IAAI,CAACiW,MAAN,CADQ;AAEnC,qBAAWtZ,WAAW,CAACqD,IAAI,CAACi6B,WAAN;AAFa,SAA5B,CAAT;;AAIA,YAAIrjB,mBAAmB,CAACra,MAAD,CAAvB,EAAiC;AAC/BoiC,UAAAA,SAAS,CAAC9xD,GAAD,EAAM6hD,QAAQ,CAACp7C,QAAT,CAAkBxR,CAAlB,CAAN,EAA4B;AAAE,4BAAgBk+B,IAAI,CAAC24B;AAAvB,WAA5B,CAAT;AACD;AACF;AACF;;AACD,QAAI/hB,mBAAmB,CAACra,MAAD,CAAvB,EAAiC;AAC/B5kB,MAAAA,MAAM,CAAC,kBAAD,CAAN,GAA6BqoB,IAAI,CAAC44B,eAAlC;AACAjhD,MAAAA,MAAM,CAAC,cAAD,CAAN,GAAyBqoB,IAAI,CAAC24B,WAA9B;AACAhhD,MAAAA,MAAM,CAAC,cAAD,CAAN,GAAyBqoB,IAAI,CAAC04B,WAA9B;AACD;;AACDpiD,IAAAA,KAAK,CAACU,KAAN,GAAcnK,GAAG,CAACgyD,cAAJ,CAAmBn7D,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK6yC,gBAAgB,CAACha,MAAD,CAArB,CAAT,EAAyC5kB,MAAzC,CAA3B,CAAd;AACA9K,IAAAA,GAAG,CAACiyD,UAAJ,CAAepQ,QAAf,EAAyBhrD,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK4yC,oBAAoB,CAAC/Z,MAAD,CAAzB,CAAT,EAA6CjmB,KAA7C,CAAjC;AACD,GArCD;;AAsCA,MAAIyoD,iBAAiB,GAAG,UAAUxiC,MAAV,EAAkBmyB,QAAlB,EAA4B0N,OAA5B,EAAqCl6C,GAArC,EAA0C;AAChE,QAAIrV,GAAG,GAAG0vB,MAAM,CAAC1vB,GAAjB;AACA,QAAImyD,UAAJ;AACA,QAAIh/B,IAAI,GAAG9d,GAAG,CAACw6C,OAAJ,EAAX;AACA,QAAIJ,YAAY,GAAGltD,QAAQ,CAAC4wB,IAAD,EAAO,UAAU7jC,KAAV,EAAiBsT,GAAjB,EAAsB;AACtD,aAAO2sD,OAAO,CAAC3sD,GAAD,CAAP,KAAiBtT,KAAxB;AACD,KAF0B,CAA3B;AAGA+lB,IAAAA,GAAG,CAACy6C,KAAJ;;AACA,QAAI38B,IAAI,CAACm6B,KAAL,KAAe,EAAnB,EAAuB;AACrB,aAAOn6B,IAAI,CAACm6B,KAAZ;AACD;;AACD59B,IAAAA,MAAM,CAAC8d,WAAP,CAAmBuiB,QAAnB,CAA4B,YAAY;AACtC,UAAI,CAAClO,QAAL,EAAe;AACb,YAAI1zC,IAAI,GAAGxC,QAAQ,CAACwnB,IAAI,CAAChlB,IAAN,EAAY,EAAZ,CAAR,IAA2B,CAAtC;AACA,YAAI/K,IAAI,GAAGuI,QAAQ,CAACwnB,IAAI,CAAC/vB,IAAN,EAAY,EAAZ,CAAR,IAA2B,CAAtC;AACAy+C,QAAAA,QAAQ,GAAG6F,QAAQ,CAACh4B,MAAD,EAASvhB,IAAT,EAAe/K,IAAf,EAAqB,CAArB,EAAwB,CAAxB,CAAnB;AACD;;AACD,UAAIV,IAAI,CAAC+sD,YAAD,CAAJ,GAAqB,CAAzB,EAA4B;AAC1BsC,QAAAA,kBAAkB,CAACriC,MAAD,EAASmyB,QAAT,EAAmB1uB,IAAnB,CAAlB;AACAg/B,QAAAA,UAAU,GAAGnyD,GAAG,CAAC0tC,MAAJ,CAAW,SAAX,EAAsBmU,QAAtB,EAAgC,CAAhC,CAAb;;AACA,YAAIsQ,UAAU,IAAI,CAACh/B,IAAI,CAACk6B,OAAxB,EAAiC;AAC/BrtD,UAAAA,GAAG,CAAC6J,MAAJ,CAAWsoD,UAAX;AACD;;AACD,YAAI,CAACA,UAAD,IAAeh/B,IAAI,CAACk6B,OAAxB,EAAiC;AAC/B8E,UAAAA,UAAU,GAAGnyD,GAAG,CAAC2W,MAAJ,CAAW,SAAX,CAAb;AACAw7C,UAAAA,UAAU,CAAC/yD,SAAX,GAAuB,CAACiyD,QAAQ,CAAC51D,EAAV,GAAe,0BAAf,GAA4CuxB,IAAnE;AACA60B,UAAAA,QAAQ,CAAC7tC,YAAT,CAAsBm+C,UAAtB,EAAkCtQ,QAAQ,CAACh7C,UAA3C;AACD;;AACD,YAAIssB,IAAI,CAACo6B,KAAL,KAAe,EAAnB,EAAuB;AACrBxC,UAAAA,YAAY,CAACr7B,MAAD,EAASmyB,QAAT,CAAZ;AACD,SAFD,MAEO;AACL+I,UAAAA,UAAU,CAACl7B,MAAD,EAASmyB,QAAT,EAAmB1uB,IAAI,CAACo6B,KAAxB,CAAV;AACD;AACF;;AACD79B,MAAAA,MAAM,CAAC4D,KAAP;AACA5D,MAAAA,MAAM,CAACm4B,SAAP;;AACA,UAAInlD,IAAI,CAAC+sD,YAAD,CAAJ,GAAqB,CAAzB,EAA4B;AAC1B,YAAI2C,eAAe,GAAGvvD,GAAG,CAAC4sD,YAAD,EAAe,SAAf,CAAzB;AACA,YAAIhnB,aAAa,GAAG2pB,eAAe,GAAG1vD,IAAI,CAAC+sD,YAAD,CAAJ,GAAqB,CAAxB,GAA4B,IAA/D;AACAjnB,QAAAA,iBAAiB,CAAC9Y,MAAD,EAASmyB,QAAT,EAAmB;AAClCnZ,UAAAA,SAAS,EAAE0pB,eADuB;AAElCjoD,UAAAA,KAAK,EAAEs+B;AAF2B,SAAnB,CAAjB;AAID;AACF,KAjCD;AAkCD,GA7CD;;AA8CA,MAAI4pB,MAAM,GAAG,UAAU3iC,MAAV,EAAkB6hC,cAAlB,EAAkC;AAC7C,QAAIvxD,GAAG,GAAG0vB,MAAM,CAAC1vB,GAAjB;AACA,QAAI6hD,QAAJ;AACA,QAAI1uB,IAAI,GAAG45B,uBAAuB,CAACr9B,MAAD,EAASqa,mBAAmB,CAACra,MAAD,CAA5B,CAAlC;;AACA,QAAI6hC,cAAc,KAAK,KAAvB,EAA8B;AAC5B1P,MAAAA,QAAQ,GAAG7hD,GAAG,CAAC6yB,SAAJ,CAAcnD,MAAM,CAACa,SAAP,CAAiBrU,QAAjB,EAAd,EAA2C,OAA3C,EAAoDwT,MAAM,CAAC1nB,OAAP,EAApD,CAAX;;AACA,UAAI65C,QAAJ,EAAc;AACZ1uB,QAAAA,IAAI,GAAGy6B,2BAA2B,CAACl+B,MAAD,EAASmyB,QAAT,EAAmB9X,mBAAmB,CAACra,MAAD,CAAtC,CAAlC;AACD,OAFD,MAEO;AACL,YAAIqa,mBAAmB,CAACra,MAAD,CAAvB,EAAiC;AAC/ByD,UAAAA,IAAI,CAAC04B,WAAL,GAAmB,EAAnB;AACA14B,UAAAA,IAAI,CAAC24B,WAAL,GAAmB,EAAnB;AACA34B,UAAAA,IAAI,CAAC44B,eAAL,GAAuB,EAAvB;AACD;AACF;AACF,KAXD,MAWO;AACL54B,MAAAA,IAAI,CAAChlB,IAAL,GAAY,GAAZ;AACAglB,MAAAA,IAAI,CAAC/vB,IAAL,GAAY,GAAZ;;AACA,UAAI2mC,mBAAmB,CAACra,MAAD,CAAvB,EAAiC;AAC/ByD,QAAAA,IAAI,CAAC04B,WAAL,GAAmB,EAAnB;AACA14B,QAAAA,IAAI,CAAC24B,WAAL,GAAmB,EAAnB;AACA34B,QAAAA,IAAI,CAAC44B,eAAL,GAAuB,EAAvB;AACD;AACF;;AACD,QAAIsC,OAAO,GAAGnD,cAAc,CAAC7gB,iBAAiB,CAAC3a,MAAD,CAAlB,CAA5B;;AACA,QAAI2+B,OAAO,CAAC19D,MAAR,GAAiB,CAArB,EAAwB;AACtB,UAAIwiC,IAAI,CAACm6B,KAAT,EAAgB;AACdn6B,QAAAA,IAAI,CAACm6B,KAAL,GAAan6B,IAAI,CAACm6B,KAAL,CAAWn0D,OAAX,CAAmB,yBAAnB,EAA8C,EAA9C,CAAb;AACD;AACF;;AACD,QAAIm5D,YAAY,GAAG;AACjBjjE,MAAAA,IAAI,EAAE,MADW;AAEjBgU,MAAAA,OAAO,EAAE,CAFQ;AAGjBkoD,MAAAA,KAAK,EAAE+F,UAAU,CAAC5hC,MAAD,EAAS2+B,OAAT,EAAkBkD,cAAlB;AAHA,KAAnB;;AAKA,QAAIgB,eAAe,GAAG,YAAY;AAChC,aAAO;AACLljE,QAAAA,IAAI,EAAE,OADD;AAELk8D,QAAAA,KAAK,EAAE,CAAC+G,YAAD;AAFF,OAAP;AAID,KALD;;AAMA,QAAIE,YAAY,GAAG,YAAY;AAC7B,aAAO;AACLnjE,QAAAA,IAAI,EAAE,UADD;AAEL8gE,QAAAA,IAAI,EAAE,CACJ;AACE7E,UAAAA,KAAK,EAAE,SADT;AAEEp8D,UAAAA,IAAI,EAAE,SAFR;AAGEq8D,UAAAA,KAAK,EAAE,CAAC+G,YAAD;AAHT,SADI,EAMJhG,cAAc,CAAC,OAAD,CANV;AAFD,OAAP;AAWD,KAZD;;AAaA,QAAImG,UAAU,GAAG1oB,mBAAmB,CAACra,MAAD,CAAnB,GAA8B8iC,YAAY,EAA1C,GAA+CD,eAAe,EAA/E;AACA7iC,IAAAA,MAAM,CAAC2gC,aAAP,CAAqBJ,IAArB,CAA0B;AACxB3E,MAAAA,KAAK,EAAE,kBADiB;AAExB5oD,MAAAA,IAAI,EAAE,QAFkB;AAGxBqF,MAAAA,IAAI,EAAE0qD,UAHkB;AAIxBhC,MAAAA,QAAQ,EAAEv/D,KAAK,CAACghE,iBAAD,EAAoBxiC,MAApB,EAA4BmyB,QAA5B,EAAsC1uB,IAAtC,CAJS;AAKxBm9B,MAAAA,OAAO,EAAE,CACP;AACEjhE,QAAAA,IAAI,EAAE,QADR;AAEEH,QAAAA,IAAI,EAAE,QAFR;AAGE4Q,QAAAA,IAAI,EAAE;AAHR,OADO,EAMP;AACEzQ,QAAAA,IAAI,EAAE,QADR;AAEEH,QAAAA,IAAI,EAAE,MAFR;AAGE4Q,QAAAA,IAAI,EAAE,MAHR;AAIEywD,QAAAA,OAAO,EAAE;AAJX,OANO,CALe;AAkBxBC,MAAAA,WAAW,EAAEr9B;AAlBW,KAA1B;AAoBD,GA3ED;;AA6EA,MAAIu/B,gCAAgC,GAAG,UAAUhjC,MAAV,EAAkB;AACvD,WAAOyzB,8BAA8B,CAAC7yB,iBAAiB,CAACZ,MAAD,CAAlB,EAA4BhX,SAAS,CAACgX,MAAD,CAArC,CAArC;AACD,GAFD;;AAGA,MAAIijC,uBAAuB,GAAG,UAAUjjC,MAAV,EAAkB;AAC9C,WAAOwzB,qBAAqB,CAAC5yB,iBAAiB,CAACZ,MAAD,CAAlB,EAA4BhX,SAAS,CAACgX,MAAD,CAArC,CAA5B;AACD,GAFD;;AAGA,MAAIkjC,gBAAgB,GAAG,UAAUljC,MAAV,EAAkB4C,OAAlB,EAA2BC,aAA3B,EAA0C/B,UAA1C,EAAsDoB,SAAtD,EAAiE;AACtF,QAAI3rB,MAAM,GAAGyS,SAAS,CAACgX,MAAD,CAAtB;;AACA,QAAImjC,UAAU,GAAG,YAAY;AAC3B,aAAOH,gCAAgC,CAAChjC,MAAD,CAAhC,CAAyCt8B,IAAzC,CAA8C,UAAU0/D,aAAV,EAAyB;AAC5EnmD,QAAAA,KAAK,CAACmmD,aAAD,EAAgB7sD,MAAhB,CAAL,CAA6BzS,MAA7B,CAAoChC,GAAG,CAACyU,MAAD,CAAvC,EAAiD7S,IAAjD,CAAsD,UAAUuZ,KAAV,EAAiB;AACrE,cAAIklC,MAAM,GAAGxxC,YAAY,CAACR,QAAb,CAAsB,EAAtB,CAAb;AACA4N,UAAAA,KAAK,CAACd,KAAD,EAAQklC,MAAR,CAAL;AACA98B,UAAAA,QAAQ,CAACpI,KAAD,CAAR;;AACA,cAAI+iB,MAAM,CAAC1vB,GAAP,CAAW+C,OAAX,CAAmB2sB,MAAM,CAAC1nB,OAAP,EAAnB,CAAJ,EAA0C;AACxC0nB,YAAAA,MAAM,CAACqjC,UAAP,CAAkB,EAAlB;AACArjC,YAAAA,MAAM,CAACa,SAAP,CAAiByiC,iBAAjB;AACD,WAHD,MAGO;AACL,gBAAI3/B,GAAG,GAAG3D,MAAM,CAAC1vB,GAAP,CAAWikD,SAAX,EAAV;AACA5wB,YAAAA,GAAG,CAAC6wB,QAAJ,CAAarS,MAAM,CAAC7xC,GAApB,EAAyB,CAAzB;AACAqzB,YAAAA,GAAG,CAAC8wB,MAAJ,CAAWtS,MAAM,CAAC7xC,GAAlB,EAAuB,CAAvB;AACA0vB,YAAAA,MAAM,CAACa,SAAP,CAAiB6C,MAAjB,CAAwBC,GAAxB;AACA3D,YAAAA,MAAM,CAACujC,WAAP;AACD;AACF,SAdD;AAeD,OAhBM,CAAP;AAiBD,KAlBD;;AAmBA,QAAIC,aAAa,GAAG,UAAUvhB,MAAV,EAAkB;AACpC,aAAO+gB,gCAAgC,CAAChjC,MAAD,CAAhC,CAAyCt8B,IAAzC,CAA8C,UAAU0/D,aAAV,EAAyB;AAC5E,YAAIK,cAAc,GAAGlqB,kBAAkB,CAACvZ,MAAD,CAAlB,IAA8BqZ,cAAc,CAACrZ,MAAD,CAA5C,IAAwD4a,mBAAmB,CAAC5a,MAAD,CAAhG;;AACA,YAAI,CAACyjC,cAAL,EAAqB;AACnBxmD,UAAAA,KAAK,CAACmmD,aAAD,EAAgB7sD,MAAhB,CAAL,CAA6B7S,IAA7B,CAAkC,UAAUuZ,KAAV,EAAiB;AACjD,gBAAIglC,MAAM,KAAK,UAAX,IAAyB,CAAChW,iBAAiB,CAAChvB,KAAD,CAA/C,EAAwD;AACtDg/B,cAAAA,iBAAiB,CAACjc,MAAD,EAAS/iB,KAAT,CAAjB;AACD,aAFD,MAEO,IAAIglC,MAAM,KAAK,OAAX,IAAsB,CAAC/V,eAAe,CAACjvB,KAAD,CAA1C,EAAmD;AACxDk/B,cAAAA,aAAa,CAACnc,MAAD,EAAS/iB,KAAT,CAAb;AACD,aAFM,MAEA,IAAIglC,MAAM,KAAK,YAAX,IAA2B,CAAC9V,cAAc,CAAClvB,KAAD,CAA9C,EAAuD;AAC5Dm/B,cAAAA,WAAW,CAACn/B,KAAD,CAAX;AACD;;AACDojB,YAAAA,eAAe,CAACpjB,KAAD,CAAf;AACA67B,YAAAA,iBAAiB,CAAC9Y,MAAD,EAAS/iB,KAAK,CAAC3M,GAAf,EAAoB2oC,iBAApB,CAAjB;AACD,WAVD;AAWD;AACF,OAfM,CAAP;AAgBD,KAjBD;;AAkBA,QAAIyqB,gBAAgB,GAAG,UAAU3nD,IAAV,EAAgB;AACrC,aAAOkB,KAAK,CAAClB,IAAD,EAAOxF,MAAP,CAAZ;AACD,KAFD;;AAGA,QAAIotD,WAAW,GAAG,UAAU1mD,KAAV,EAAiB;AACjC,aAAO,UAAUwmB,IAAV,EAAgB;AACrBzD,QAAAA,MAAM,CAACa,SAAP,CAAiB6C,MAAjB,CAAwBD,IAAI,CAACE,GAA7B;AACA3D,QAAAA,MAAM,CAAC4D,KAAP;AACAf,QAAAA,aAAa,CAACgB,KAAd,CAAoB5mB,KAApB;AACAojB,QAAAA,eAAe,CAACpjB,KAAD,CAAf;AACA67B,QAAAA,iBAAiB,CAAC9Y,MAAD,EAAS/iB,KAAK,CAAC3M,GAAf,EAAoBmzB,IAAI,CAAC4wB,MAAzB,CAAjB;AACD,OAND;AAOD,KARD;;AASA,QAAIuP,cAAc,GAAG,UAAUzP,OAAV,EAAmB;AACtC,aAAO8O,uBAAuB,CAACjjC,MAAD,CAAvB,CAAgCt8B,IAAhC,CAAqC,UAAUqY,IAAV,EAAgB;AAC1D2nD,QAAAA,gBAAgB,CAAC3nD,IAAD,CAAhB,CAAuBrY,IAAvB,CAA4B,UAAUuZ,KAAV,EAAiB;AAC3C,cAAIsmB,OAAO,GAAGvB,OAAO,CAAClB,UAAD,EAAa7jB,KAAb,EAAoBlB,IAApB,CAArB;AACAo4C,UAAAA,OAAO,CAACl3C,KAAD,EAAQsmB,OAAR,CAAP,CAAwB7/B,IAAxB,CAA6BigE,WAAW,CAAC1mD,KAAD,CAAxC;AACD,SAHD;AAID,OALM,CAAP;AAMD,KAPD;;AAQA,QAAI4mD,gBAAgB,GAAG,YAAY;AACjC,aAAOZ,uBAAuB,CAACjjC,MAAD,CAAvB,CAAgCv8B,GAAhC,CAAoC,UAAUsY,IAAV,EAAgB;AACzD,eAAO2nD,gBAAgB,CAAC3nD,IAAD,CAAhB,CAAuBpY,IAAvB,CAA4B,UAAUsZ,KAAV,EAAiB;AAClD,cAAIsmB,OAAO,GAAGvB,OAAO,CAAClB,UAAD,EAAa7jB,KAAb,EAAoBlB,IAApB,CAArB;AACA,cAAIomB,UAAU,GAAGnD,cAAc,CAACt+B,IAAD,EAAOiQ,YAAY,CAACZ,OAAb,CAAqBiwB,MAAM,CAACsD,MAAP,EAArB,CAAP,EAA8C3+B,QAAQ,CAACtC,IAAT,EAA9C,CAA/B;AACA,iBAAOm4D,QAAQ,CAACv9C,KAAD,EAAQsmB,OAAR,EAAiBpB,UAAjB,CAAf;AACD,SAJM,CAAP;AAKD,OANM,CAAP;AAOD,KARD;;AASA,QAAI2hC,gBAAgB,GAAG,YAAY;AACjC,aAAOb,uBAAuB,CAACjjC,MAAD,CAAvB,CAAgCv8B,GAAhC,CAAoC,UAAUsY,IAAV,EAAgB;AACzD,eAAO2nD,gBAAgB,CAAC3nD,IAAD,CAAhB,CAAuBpY,IAAvB,CAA4B,UAAUsZ,KAAV,EAAiB;AAClD,cAAIsmB,OAAO,GAAGvB,OAAO,CAAClB,UAAD,EAAa7jB,KAAb,EAAoBlB,IAApB,CAArB;AACA,iBAAOs+C,QAAQ,CAACp9C,KAAD,EAAQsmB,OAAR,CAAf;AACD,SAHM,CAAP;AAID,OALM,CAAP;AAMD,KAPD;;AAQA,QAAIwgC,gBAAgB,GAAG,UAAU5P,OAAV,EAAmBkF,OAAnB,EAA4B;AACjD,aAAOA,OAAO,GAAG31D,IAAV,CAAe,UAAUgQ,IAAV,EAAgB;AACpC,YAAIswD,UAAU,GAAGvgE,GAAG,CAACiQ,IAAD,EAAO,UAAUG,GAAV,EAAe;AACxC,iBAAOqZ,IAAI,CAACrZ,GAAD,CAAX;AACD,SAFmB,CAApB;AAGAovD,QAAAA,uBAAuB,CAACjjC,MAAD,CAAvB,CAAgCt8B,IAAhC,CAAqC,UAAUqY,IAAV,EAAgB;AACnD,iBAAO2nD,gBAAgB,CAAC3nD,IAAD,CAAhB,CAAuBrY,IAAvB,CAA4B,UAAUuZ,KAAV,EAAiB;AAClD,gBAAIklB,UAAU,GAAGzC,KAAK,CAAC/uB,YAAY,CAACZ,OAAb,CAAqBiwB,MAAM,CAACsD,MAAP,EAArB,CAAD,CAAtB;AACA,gBAAIC,OAAO,GAAGnB,SAAS,CAACtB,UAAD,EAAa/kB,IAAb,EAAmBioD,UAAnB,EAA+B7hC,UAA/B,CAAvB;AACAgyB,YAAAA,OAAO,CAACl3C,KAAD,EAAQsmB,OAAR,CAAP,CAAwB7/B,IAAxB,CAA6BigE,WAAW,CAAC1mD,KAAD,CAAxC;AACD,WAJM,CAAP;AAKD,SAND;AAOD,OAXM,CAAP;AAYD,KAbD;;AAcA9K,IAAAA,MAAM,CAAC;AACL8xD,MAAAA,kBAAkB,EAAE,YAAY;AAC9B,eAAOL,cAAc,CAAChhC,OAAO,CAACsuB,YAAT,CAArB;AACD,OAHI;AAILgT,MAAAA,kBAAkB,EAAE,YAAY;AAC9B,eAAON,cAAc,CAAChhC,OAAO,CAACquB,UAAT,CAArB;AACD,OANI;AAOLkT,MAAAA,uBAAuB,EAAE,YAAY;AACnC,eAAOP,cAAc,CAAChhC,OAAO,CAACutB,gBAAT,CAArB;AACD,OATI;AAULiU,MAAAA,sBAAsB,EAAE,YAAY;AAClC,eAAOR,cAAc,CAAChhC,OAAO,CAACwtB,eAAT,CAArB;AACD,OAZI;AAaLiU,MAAAA,uBAAuB,EAAE,YAAY;AACnC,eAAOT,cAAc,CAAChhC,OAAO,CAACytB,mBAAT,CAArB;AACD,OAfI;AAgBLiU,MAAAA,sBAAsB,EAAE,YAAY;AAClC,eAAOV,cAAc,CAAChhC,OAAO,CAAC0tB,kBAAT,CAArB;AACD,OAlBI;AAmBLiU,MAAAA,iBAAiB,EAAE,YAAY;AAC7B,eAAOX,cAAc,CAAChhC,OAAO,CAAC+xB,YAAT,CAArB;AACD,OArBI;AAsBL6P,MAAAA,iBAAiB,EAAE,YAAY;AAC7B,eAAOZ,cAAc,CAAChhC,OAAO,CAAC8xB,SAAT,CAArB;AACD,OAxBI;AAyBL+P,MAAAA,cAAc,EAAE,UAAUC,KAAV,EAAiB;AAC/B,eAAOZ,gBAAgB,GAAGpgE,IAAnB,CAAwB,UAAUm9B,SAAV,EAAqB;AAClDqB,UAAAA,SAAS,CAACq3B,UAAV,CAAqB14B,SAArB;AACA+iC,UAAAA,cAAc,CAAChhC,OAAO,CAAC+xB,YAAT,CAAd;AACD,SAHM,CAAP;AAID,OA9BI;AA+BLgQ,MAAAA,cAAc,EAAE,UAAUD,KAAV,EAAiB;AAC/B,eAAOb,gBAAgB,GAAGngE,IAAnB,CAAwB,UAAUm9B,SAAV,EAAqB;AAClDqB,UAAAA,SAAS,CAACi3B,OAAV,CAAkBt4B,SAAlB;AACA+iC,UAAAA,cAAc,CAAChhC,OAAO,CAAC8xB,SAAT,CAAd;AACD,SAHM,CAAP;AAID,OApCI;AAqCLkQ,MAAAA,eAAe,EAAE,UAAUF,KAAV,EAAiB;AAChC,eAAOZ,gBAAgB,GAAGpgE,IAAnB,CAAwB,UAAUm9B,SAAV,EAAqB;AAClD,iBAAOqB,SAAS,CAACq3B,UAAV,CAAqB14B,SAArB,CAAP;AACD,SAFM,CAAP;AAGD,OAzCI;AA0CLgkC,MAAAA,eAAe,EAAE,UAAUH,KAAV,EAAiB;AAChC,eAAOb,gBAAgB,GAAGngE,IAAnB,CAAwB,UAAUm9B,SAAV,EAAqB;AAClD,iBAAOqB,SAAS,CAACi3B,OAAV,CAAkBt4B,SAAlB,CAAP;AACD,SAFM,CAAP;AAGD,OA9CI;AA+CLikC,MAAAA,sBAAsB,EAAE,UAAUJ,KAAV,EAAiB;AACvC,eAAOX,gBAAgB,CAACnhC,OAAO,CAACuuB,eAAT,EAA0BjvB,SAAS,CAACu3B,UAApC,CAAvB;AACD,OAjDI;AAkDLsL,MAAAA,qBAAqB,EAAE,UAAUL,KAAV,EAAiB;AACtC,eAAOX,gBAAgB,CAACnhC,OAAO,CAACwuB,cAAT,EAAyBlvB,SAAS,CAACu3B,UAAnC,CAAvB;AACD,OApDI;AAqDLuL,MAAAA,sBAAsB,EAAE,UAAUN,KAAV,EAAiB;AACvC,eAAOX,gBAAgB,CAACnhC,OAAO,CAACyuB,eAAT,EAA0BnvB,SAAS,CAACm3B,OAApC,CAAvB;AACD,OAvDI;AAwDL4L,MAAAA,qBAAqB,EAAE,UAAUP,KAAV,EAAiB;AACtC,eAAOX,gBAAgB,CAACnhC,OAAO,CAAC0uB,cAAT,EAAyBpvB,SAAS,CAACm3B,OAAnC,CAAvB;AACD,OA1DI;AA2DL6L,MAAAA,cAAc,EAAE/B,UA3DX;AA4DLgC,MAAAA,kBAAkB,EAAE,UAAUC,EAAV,EAAcnjB,MAAd,EAAsB;AACxC,eAAOuhB,aAAa,CAACvhB,MAAD,CAApB;AACD;AA9DI,KAAD,EA+DH,UAAUojB,IAAV,EAAgB7lE,IAAhB,EAAsB;AACvB,aAAOwgC,MAAM,CAACslC,UAAP,CAAkB9lE,IAAlB,EAAwB6lE,IAAxB,CAAP;AACD,KAjEK,CAAN;;AAkEA,QAAIE,6BAA6B,GAAG,UAAUvlC,MAAV,EAAkB/f,QAAlB,EAA4B;AAC9DA,MAAAA,QAAQ,CAACvc,IAAT,CAAc,UAAUuZ,KAAV,EAAiB;AAC7B67B,QAAAA,iBAAiB,CAAC9Y,MAAD,EAAS/iB,KAAK,CAAC3M,GAAf,EAAoB2oC,iBAApB,CAAjB;AACD,OAFD;AAGD,KAJD;;AAKA9mC,IAAAA,MAAM,CAAC;AACLqzD,MAAAA,gBAAgB,EAAE,UAAUC,GAAV,EAAe3kE,IAAf,EAAqB;AACrC,YAAImf,QAAQ,GAAGhD,KAAK,CAAC2jB,iBAAiB,CAACZ,MAAD,CAAlB,EAA4BzpB,MAA5B,CAApB;AACAqsB,QAAAA,OAAO,CAAC6yB,gBAAR,CAAyBz1B,MAAzB,EAAiCl/B,IAAjC;AACAykE,QAAAA,6BAA6B,CAACvlC,MAAD,EAAS/f,QAAT,CAA7B;AACD,OALI;AAMLylD,MAAAA,eAAe,EAAE,UAAUD,GAAV,EAAe3kE,IAAf,EAAqB;AACpC,YAAImf,QAAQ,GAAGhD,KAAK,CAAC2jB,iBAAiB,CAACZ,MAAD,CAAlB,EAA4BzpB,MAA5B,CAApB;AACAqsB,QAAAA,OAAO,CAAC8yB,eAAR,CAAwB11B,MAAxB,EAAgCl/B,IAAhC;AACAykE,QAAAA,6BAA6B,CAACvlC,MAAD,EAAS/f,QAAT,CAA7B;AACD;AAVI,KAAD,EAWH,UAAUolD,IAAV,EAAgB7lE,IAAhB,EAAsB;AACvB,aAAOwgC,MAAM,CAACslC,UAAP,CAAkB9lE,IAAlB,EAAwB6lE,IAAxB,CAAP;AACD,KAbK,CAAN;AAcArlC,IAAAA,MAAM,CAACslC,UAAP,CAAkB,iBAAlB,EAAqC,UAAUG,GAAV,EAAe3kE,IAAf,EAAqB;AACxD,aAAOmS,KAAK,CAACnS,IAAD,EAAO,MAAP,CAAL,CAAoB4C,IAApB,CAAyB,UAAU/D,IAAV,EAAgB;AAC9C,eAAOikE,cAAc,CAACjkE,IAAI,KAAK,IAAT,GAAgBijC,OAAO,CAAC8tB,iBAAxB,GAA4C9tB,OAAO,CAACguB,mBAArD,CAArB;AACD,OAFM,CAAP;AAGD,KAJD;AAKAz+C,IAAAA,MAAM,CAAC;AACLwzD,MAAAA,aAAa,EAAEnkE,KAAK,CAACmhE,MAAD,EAAS3iC,MAAT,EAAiB,KAAjB,CADf;AAEL4lC,MAAAA,gBAAgB,EAAEpkE,KAAK,CAACigE,MAAD,EAASzhC,MAAT,CAFlB;AAGL6lC,MAAAA,iBAAiB,EAAErkE,KAAK,CAAC++D,IAAD,EAAOvgC,MAAP,EAAec,UAAf;AAHnB,KAAD,EAIH,UAAUukC,IAAV,EAAgB7lE,IAAhB,EAAsB;AACvB,aAAOwgC,MAAM,CAACslC,UAAP,CAAkB9lE,IAAlB,EAAwB,YAAY;AACzC,eAAO6lE,IAAI,EAAX;AACD,OAFM,CAAP;AAGD,KARK,CAAN;AASArlC,IAAAA,MAAM,CAACslC,UAAP,CAAkB,gBAAlB,EAAoC,UAAUG,GAAV,EAAe3kE,IAAf,EAAqB;AACvD,UAAIb,QAAQ,CAACa,IAAD,CAAR,IAAkBoR,IAAI,CAACpR,IAAD,CAAJ,CAAWG,MAAX,GAAoB,CAA1C,EAA6C;AAC3Cm3D,QAAAA,6BAA6B,CAACp4B,MAAD,EAASl/B,IAAI,CAAC4S,IAAd,EAAoB5S,IAAI,CAAC6S,OAAzB,EAAkC7S,IAAI,CAACgyC,OAAvC,EAAgD,6FAAhD,CAA7B;AACD,OAFD,MAEO;AACL6vB,QAAAA,MAAM,CAAC3iC,MAAD,EAAS,IAAT,CAAN;AACD;AACF,KAND;AAOAA,IAAAA,MAAM,CAACslC,UAAP,CAAkB,wBAAlB,EAA4C,UAAUG,GAAV,EAAe3kE,IAAf,EAAqB;AAC/D,UAAIglE,aAAa,GAAG,UAAUrrD,KAAV,EAAiB;AACnC,eAAO,cAAcA,KAAK,CAAC3Q,WAAN,GAAoBL,OAApB,CAA4B,GAA5B,EAAiC,EAAjC,CAArB;AACD,OAFD;;AAGA,UAAI,CAACxJ,QAAQ,CAACa,IAAD,CAAb,EAAqB;AACnB;AACD;;AACD,UAAIyT,KAAK,GAAGm/C,qBAAqB,CAAC9yB,iBAAiB,CAACZ,MAAD,CAAlB,EAA4Bc,UAA5B,EAAwCvqB,MAAxC,CAAjC;;AACA,UAAIhC,KAAK,CAACtT,MAAN,KAAiB,CAArB,EAAwB;AACtB;AACD;;AACD,UAAI8kE,SAAS,GAAGlzD,QAAQ,CAAC/R,IAAD,EAAO,UAAUlB,KAAV,EAAiB6a,KAAjB,EAAwB;AACrD,eAAOulB,MAAM,CAACm7B,SAAP,CAAiBhoD,GAAjB,CAAqB2yD,aAAa,CAACrrD,KAAD,CAAlC,KAA8Cza,QAAQ,CAACJ,KAAD,CAA7D;AACD,OAFuB,CAAxB;;AAGA,UAAIyT,OAAO,CAAC0yD,SAAD,CAAX,EAAwB;AACtB;AACD;;AACD5zD,MAAAA,MAAM,CAAC4zD,SAAD,EAAY,UAAUnmE,KAAV,EAAiB6a,KAAjB,EAAwB;AACxC/W,QAAAA,IAAI,CAAC6Q,KAAD,EAAQ,UAAUwH,IAAV,EAAgB;AAC1BmjD,UAAAA,WAAW,CAACC,MAAZ,CAAmBn/B,MAAnB,EAA2BjkB,IAAI,CAACzL,GAAhC,EAAqC2uD,SAArC,CAA+C6G,aAAa,CAACrrD,KAAD,CAA5D,EAAqE7a,KAArE;AACD,SAFG,CAAJ;AAGD,OAJK,CAAN;AAKA8jE,MAAAA,gBAAgB,CAACnvD,KAAK,CAAC,CAAD,CAAN,CAAhB,CAA2B7Q,IAA3B,CAAgC,UAAUuZ,KAAV,EAAiB;AAC/C,eAAO67B,iBAAiB,CAAC9Y,MAAD,EAAS/iB,KAAK,CAAC3M,GAAf,EAAoByoC,aAApB,CAAxB;AACD,OAFD;AAGD,KAzBD;AA0BD,GA9ND;;AAgOA,MAAIitB,qBAAqB,GAAG,UAAUhmC,MAAV,EAAkB4C,OAAlB,EAA2B9B,UAA3B,EAAuC;AACjE,QAAIvqB,MAAM,GAAGyS,SAAS,CAACgX,MAAD,CAAtB;;AACA,QAAI0jC,gBAAgB,GAAG,UAAU3nD,IAAV,EAAgB;AACrC,aAAOkB,KAAK,CAAClB,IAAD,EAAOxF,MAAP,CAAZ;AACD,KAFD;;AAGApE,IAAAA,MAAM,CAAC;AACLuzD,MAAAA,eAAe,EAAE,YAAY;AAC3B,eAAO9iC,OAAO,CAACizB,eAAR,CAAwB71B,MAAxB,CAAP;AACD,OAHI;AAILwlC,MAAAA,gBAAgB,EAAE,YAAY;AAC5B,eAAO5iC,OAAO,CAACszB,gBAAR,CAAyBl2B,MAAzB,CAAP;AACD,OANI;AAOLimC,MAAAA,eAAe,EAAE,YAAY;AAC3B,eAAOzS,qBAAqB,CAAC5yB,iBAAiB,CAACZ,MAAD,CAAlB,CAArB,CAAiDr8B,IAAjD,CAAsD,UAAUoY,IAAV,EAAgB;AAC3E,iBAAO2nD,gBAAgB,CAAC3nD,IAAD,CAAhB,CAAuBtY,GAAvB,CAA2B,UAAUwZ,KAAV,EAAiB;AACjD,gBAAIsmB,OAAO,GAAGvB,OAAO,CAAClB,UAAD,EAAa7jB,KAAb,EAAoBlB,IAApB,CAArB;AACA,mBAAO6mB,OAAO,CAACuzB,eAAR,CAAwBl5C,KAAxB,EAA+BsmB,OAA/B,CAAP;AACD,WAHM,CAAP;AAID,SALM,EAKJrgC,KALI,CAKE,EALF,CAAP;AAMD;AAdI,KAAD,EAeH,UAAUmiE,IAAV,EAAgB7lE,IAAhB,EAAsB;AACvB,aAAOwgC,MAAM,CAACkmC,oBAAP,CAA4B1mE,IAA5B,EAAkC6lE,IAAlC,CAAP;AACD,KAjBK,CAAN;AAkBD,GAvBD;;AAyBA,MAAIc,SAAS,GAAG,YAAY;AAC1B,QAAIzyD,IAAI,GAAGqmB,IAAI,CAACp1B,QAAQ,CAACtC,IAAT,EAAD,CAAf;AACA,QAAIoc,IAAI,GAAGsb,IAAI,CAACp1B,QAAQ,CAACtC,IAAT,EAAD,CAAf;;AACA,QAAI+jE,cAAc,GAAG,UAAUlkC,SAAV,EAAqB;AACxCA,MAAAA,SAAS,CAACroB,GAAV,CAAclV,QAAQ,CAACtC,IAAT,EAAd;AACD,KAFD;;AAGA,WAAO;AACLg3D,MAAAA,OAAO,EAAE3lD,IAAI,CAAC3M,GADT;AAELoyD,MAAAA,OAAO,EAAE,UAAUxzD,CAAV,EAAa;AACpB+N,QAAAA,IAAI,CAACmG,GAAL,CAASlU,CAAT;AACAygE,QAAAA,cAAc,CAAC3nD,IAAD,CAAd;AACD,OALI;AAML4nD,MAAAA,SAAS,EAAE,YAAY;AACrB,eAAOD,cAAc,CAAC1yD,IAAD,CAArB;AACD,OARI;AASL+lD,MAAAA,UAAU,EAAEh7C,IAAI,CAAC1X,GATZ;AAULwyD,MAAAA,UAAU,EAAE,UAAUlqC,CAAV,EAAa;AACvB5Q,QAAAA,IAAI,CAAC5E,GAAL,CAASwV,CAAT;AACA+2C,QAAAA,cAAc,CAAC1yD,IAAD,CAAd;AACD,OAbI;AAcL4yD,MAAAA,YAAY,EAAE,YAAY;AACxB,eAAOF,cAAc,CAAC3nD,IAAD,CAArB;AACD;AAhBI,KAAP;AAkBD,GAxBD;;AA0BA,MAAI8nD,WAAW,GAAG;AAChBC,IAAAA,wBAAwB,EAAE;AACxB31D,MAAAA,QAAQ,EAAE,OADc;AAExBuK,MAAAA,MAAM,EAAE;AAAEqrD,QAAAA,eAAe,EAAE;AAAnB,OAFgB;AAGxBC,MAAAA,cAAc,EAAE;AAHQ,KADV;AAMhBC,IAAAA,oBAAoB,EAAE;AACpB91D,MAAAA,QAAQ,EAAE,OADU;AAEpBuK,MAAAA,MAAM,EAAE;AAAEwrD,QAAAA,WAAW,EAAE;AAAf,OAFY;AAGpBF,MAAAA,cAAc,EAAE;AAHI,KANN;AAWhBG,IAAAA,oBAAoB,EAAE;AACpBh2D,MAAAA,QAAQ,EAAE,OADU;AAEpBuK,MAAAA,MAAM,EAAE;AAAE0rD,QAAAA,WAAW,EAAE;AAAf,OAFY;AAGpBJ,MAAAA,cAAc,EAAE;AAHI,KAXN;AAgBhBK,IAAAA,oBAAoB,EAAE;AACpBl2D,MAAAA,QAAQ,EAAE,OADU;AAEpBuK,MAAAA,MAAM,EAAE;AAAE2hD,QAAAA,WAAW,EAAE;AAAf,OAFY;AAGpB2J,MAAAA,cAAc,EAAE;AAHI;AAhBN,GAAlB;;AAsBA,MAAIM,eAAe,GAAG,UAAUhnC,MAAV,EAAkB;AACtCA,IAAAA,MAAM,CAACm7B,SAAP,CAAiB8L,QAAjB,CAA0BV,WAA1B;AACD,GAFD;;AAIA,MAAIW,KAAK,GAAGt7C,GAAG,CAAC7L,QAAJ,CAAa,CACvB;AAAE1d,IAAAA,IAAI,EAAE,CAAC,SAAD;AAAR,GADuB,EAEvB;AAAEuhB,IAAAA,KAAK,EAAE,CAAC,SAAD;AAAT,GAFuB,EAGvB;AACEmgB,IAAAA,MAAM,EAAE,CACN,SADM,EAEN,QAFM;AADV,GAHuB,EASvB;AAAE98B,IAAAA,IAAI,EAAE,CAAC,SAAD;AAAR,GATuB,CAAb,CAAZ;;AAWA,MAAIkgE,MAAM,GAAG,UAAU38D,OAAV,EAAmB;AAC9B,QAAIA,OAAO,KAAK,KAAK,CAArB,EAAwB;AACtBA,MAAAA,OAAO,GAAGnK,SAAV;AACD;;AACD,WAAO6mE,KAAK,CAAC7kE,IAAN,CAAWmI,OAAX,CAAP;AACD,GALD;;AAMA,MAAI48D,YAAY,GAAGjgE,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK+/D,KAAL,CAAT,EAAsB;AAAE7kE,IAAAA,IAAI,EAAE8kE;AAAR,GAAtB,CAA3B;;AAEA,MAAIE,QAAQ,GAAG,UAAU78D,OAAV,EAAmB+L,MAAnB,EAA2B;AACxC,WAAO0G,KAAK,CAACzS,OAAD,EAAU+L,MAAV,CAAL,CAAuB5S,IAAvB,CAA4B,UAAUsZ,KAAV,EAAiB;AAClD,UAAIrb,GAAG,GAAG2S,KAAK,CAAC0I,KAAD,CAAf;AACA,UAAIhG,KAAK,GAAG1Q,SAAS,CAAC3E,GAAD,EAAM,UAAU1C,CAAV,EAAa;AACtC,eAAOuS,IAAI,CAACjH,OAAD,EAAUtL,CAAV,CAAX;AACD,OAFoB,CAArB;AAGA,aAAO+X,KAAK,CAACxT,GAAN,CAAU,UAAUwT,KAAV,EAAiB;AAChC,eAAO;AACLA,UAAAA,KAAK,EAAEA,KADF;AAELrV,UAAAA,GAAG,EAAEA;AAFA,SAAP;AAID,OALM,CAAP;AAMD,KAXM,CAAP;AAYD,GAbD;;AAcA,MAAI+tB,IAAI,GAAG,UAAUnlB,OAAV,EAAmB+L,MAAnB,EAA2B;AACpC,QAAI+wD,SAAS,GAAGD,QAAQ,CAAC78D,OAAD,EAAU+L,MAAV,CAAxB;AACA,WAAO+wD,SAAS,CAACxkE,IAAV,CAAe,YAAY;AAChC,aAAOskE,YAAY,CAAC/kE,IAAb,CAAkBmI,OAAlB,CAAP;AACD,KAFM,EAEJ,UAAU6B,IAAV,EAAgB;AACjB,aAAOA,IAAI,CAAC4K,KAAL,GAAa,CAAb,GAAiB5K,IAAI,CAACzK,GAAL,CAASX,MAA1B,GAAmCmmE,YAAY,CAACrjC,MAAb,CAAoBv5B,OAApB,EAA6B6B,IAAI,CAACzK,GAAL,CAASyK,IAAI,CAAC4K,KAAL,GAAa,CAAtB,CAA7B,CAAnC,GAA4FmwD,YAAY,CAACngE,IAAb,CAAkBuD,OAAlB,CAAnG;AACD,KAJM,CAAP;AAKD,GAPD;;AAQA,MAAI40B,IAAI,GAAG,UAAU50B,OAAV,EAAmB+L,MAAnB,EAA2B;AACpC,QAAI+wD,SAAS,GAAGD,QAAQ,CAAC78D,OAAD,EAAU+L,MAAV,CAAxB;AACA,WAAO+wD,SAAS,CAACxkE,IAAV,CAAe,YAAY;AAChC,aAAOskE,YAAY,CAAC/kE,IAAb,EAAP;AACD,KAFM,EAEJ,UAAUgK,IAAV,EAAgB;AACjB,aAAOA,IAAI,CAAC4K,KAAL,GAAa,CAAb,IAAkB,CAAlB,GAAsBmwD,YAAY,CAACrjC,MAAb,CAAoBv5B,OAApB,EAA6B6B,IAAI,CAACzK,GAAL,CAASyK,IAAI,CAAC4K,KAAL,GAAa,CAAtB,CAA7B,CAAtB,GAA+EmwD,YAAY,CAACxjD,KAAb,CAAmBpZ,OAAnB,CAAtF;AACD,KAJM,CAAP;AAKD,GAPD;;AASA,MAAI+8D,QAAQ,GAAG,UAAUx8D,KAAV,EAAiBy8D,OAAjB,EAA0BxkD,MAA1B,EAAkCykD,OAAlC,EAA2C;AACxD,WAAO;AACL18D,MAAAA,KAAK,EAAEA,KADF;AAELy8D,MAAAA,OAAO,EAAEA,OAFJ;AAGLxkD,MAAAA,MAAM,EAAEA,MAHH;AAILykD,MAAAA,OAAO,EAAEA;AAJJ,KAAP;AAMD,GAPD;;AAQA,MAAIC,QAAQ,GAAG;AAAEzgD,IAAAA,MAAM,EAAEsgD;AAAV,GAAf;AAEA,MAAII,KAAK,GAAG/7C,GAAG,CAAC7L,QAAJ,CAAa,CACvB;AAAEjC,IAAAA,MAAM,EAAE,CAAC,SAAD;AAAV,GADuB,EAEvB;AACEglB,IAAAA,EAAE,EAAE,CACF,SADE,EAEF,QAFE;AADN,GAFuB,EAQvB;AAAE/kB,IAAAA,KAAK,EAAE,CAAC,SAAD;AAAT,GARuB,CAAb,CAAZ;;AAUA,MAAI6pD,MAAM,GAAG,UAAU37C,OAAV,EAAmB47C,QAAnB,EAA6BC,IAA7B,EAAmCC,OAAnC,EAA4C;AACvD,WAAO97C,OAAO,CAACnpB,IAAR,CAAa+kE,QAAb,EAAuBC,IAAvB,EAA6BC,OAA7B,CAAP;AACD,GAFD;;AAGA,MAAIv7C,QAAQ,GAAG,UAAUw7C,IAAV,EAAgB;AAC7B,WAAOA,IAAI,CAACllE,IAAL,CAAUvB,QAAV,EAAoBA,QAApB,EAA8BA,QAA9B,CAAP;AACD,GAFD;;AAGA,MAAI0mE,QAAQ,GAAGN,KAAK,CAAC7pD,MAArB;AACA,MAAIglB,EAAE,GAAG6kC,KAAK,CAAC7kC,EAAf;AACA,MAAIolC,OAAO,GAAGP,KAAK,CAAC5pD,KAApB;AACA,MAAIoqD,IAAI,GAAG;AACTrqD,IAAAA,MAAM,EAAEmqD,QADC;AAETnlC,IAAAA,EAAE,EAAEA,EAFK;AAGT/kB,IAAAA,KAAK,EAAEmqD,OAHE;AAITl8C,IAAAA,IAAI,EAAE47C,MAJG;AAKTp7C,IAAAA,QAAQ,EAAEA;AALD,GAAX;AAQA,MAAI47C,KAAK,GAAGx8C,GAAG,CAAC7L,QAAJ,CAAa,CACvB;AAAEsoD,IAAAA,QAAQ,EAAE,CAAC,KAAD;AAAZ,GADuB,EAEvB;AACE90C,IAAAA,QAAQ,EAAE,CACR,WADQ,EAER,YAFQ;AADZ,GAFuB,EAQvB;AACE+0C,IAAAA,KAAK,EAAE,CACL,OADK,EAEL,SAFK,EAGL,QAHK,EAIL,SAJK;AADT,GARuB,CAAb,CAAZ;;AAiBA,MAAIC,cAAc,GAAG,UAAUC,QAAV,EAAoB;AACvC,WAAOJ,KAAK,CAACE,KAAN,CAAYE,QAAQ,CAACz9D,KAArB,EAA4By9D,QAAQ,CAAChB,OAArC,EAA8CgB,QAAQ,CAACxlD,MAAvD,EAA+DwlD,QAAQ,CAACf,OAAxE,CAAP;AACD,GAFD;;AAGA,MAAIgB,UAAU,GAAG,UAAU5nC,SAAV,EAAqB;AACpC,WAAOA,SAAS,CAACnyB,KAAV,CAAgB;AACrB25D,MAAAA,QAAQ,EAAE,UAAU1kC,GAAV,EAAe;AACvB,eAAOhzB,YAAY,CAACZ,OAAb,CAAqB4zB,GAAG,CAAC+kC,cAAzB,CAAP;AACD,OAHoB;AAIrBn1C,MAAAA,QAAQ,EAAE,UAAUo1C,SAAV,EAAqBC,WAArB,EAAkC;AAC1C,eAAOT,IAAI,CAAC37C,QAAL,CAAcm8C,SAAd,CAAP;AACD,OANoB;AAOrBL,MAAAA,KAAK,EAAE,UAAUv9D,KAAV,EAAiB89D,QAAjB,EAA2BC,OAA3B,EAAoCC,QAApC,EAA8C;AACnD,eAAOh+D,KAAP;AACD;AAToB,KAAhB,CAAP;AAWD,GAZD;;AAaA,MAAIs9D,QAAQ,GAAGD,KAAK,CAACC,QAArB;AACA,MAAI90C,QAAQ,GAAG60C,KAAK,CAAC70C,QAArB;AACA,MAAI+0C,KAAK,GAAGF,KAAK,CAACE,KAAlB;;AACA,MAAIU,MAAM,GAAG,UAAUnoC,SAAV,EAAqB;AAChC,QAAI91B,KAAK,GAAG09D,UAAU,CAAC5nC,SAAD,CAAtB;AACA,WAAO1qB,WAAW,CAACpL,KAAD,CAAlB;AACD,GAHD;;AAIA,MAAIk+D,OAAO,GAAGvB,QAAQ,CAACzgD,MAAvB;AACA,MAAIiiD,YAAY,GAAG;AACjBb,IAAAA,QAAQ,EAAEA,QADO;AAEjB90C,IAAAA,QAAQ,EAAEA,QAFO;AAGjB+0C,IAAAA,KAAK,EAAEA,KAHU;AAIjBC,IAAAA,cAAc,EAAEA,cAJC;AAKjBS,IAAAA,MAAM,EAAEA,MALS;AAMjBvjE,IAAAA,KAAK,EAAEwjE;AANU,GAAnB;;AASA,MAAIE,kBAAkB,GAAG,UAAUp4C,GAAV,EAAengB,OAAf,EAAwB;AAC/C,QAAI+yB,GAAG,GAAG5S,GAAG,CAACxhB,QAAJ,CAAa65D,WAAb,EAAV;AACAC,IAAAA,uBAAuB,CAAC1lC,GAAD,EAAM/yB,OAAN,CAAvB;AACA,WAAO+yB,GAAP;AACD,GAJD;;AAKA,MAAI0lC,uBAAuB,GAAG,UAAU1lC,GAAV,EAAe/yB,OAAf,EAAwB;AACpD,WAAO+yB,GAAG,CAACwlC,kBAAJ,CAAuBv4D,OAAO,CAACN,GAA/B,CAAP;AACD,GAFD;;AAGA,MAAIkkD,QAAQ,GAAG,UAAU7wB,GAAV,EAAeqkC,IAAf,EAAqB;AAClCA,IAAAA,IAAI,CAACllE,IAAL,CAAU,UAAUgT,CAAV,EAAa;AACrB6tB,MAAAA,GAAG,CAAC2lC,cAAJ,CAAmBxzD,CAAC,CAACxF,GAArB;AACD,KAFD,EAEG,UAAUwF,CAAV,EAAavT,CAAb,EAAgB;AACjBohC,MAAAA,GAAG,CAAC6wB,QAAJ,CAAa1+C,CAAC,CAACxF,GAAf,EAAoB/N,CAApB;AACD,KAJD,EAIG,UAAUuT,CAAV,EAAa;AACd6tB,MAAAA,GAAG,CAAC4lC,aAAJ,CAAkBzzD,CAAC,CAACxF,GAApB;AACD,KAND;AAOD,GARD;;AASA,MAAIk5D,SAAS,GAAG,UAAU7lC,GAAV,EAAeqkC,IAAf,EAAqB;AACnCA,IAAAA,IAAI,CAACllE,IAAL,CAAU,UAAUgT,CAAV,EAAa;AACrB6tB,MAAAA,GAAG,CAAC8lC,YAAJ,CAAiB3zD,CAAC,CAACxF,GAAnB;AACD,KAFD,EAEG,UAAUwF,CAAV,EAAavT,CAAb,EAAgB;AACjBohC,MAAAA,GAAG,CAAC8wB,MAAJ,CAAW3+C,CAAC,CAACxF,GAAb,EAAkB/N,CAAlB;AACD,KAJD,EAIG,UAAUuT,CAAV,EAAa;AACd6tB,MAAAA,GAAG,CAAC+lC,WAAJ,CAAgB5zD,CAAC,CAACxF,GAAlB;AACD,KAND;AAOD,GARD;;AASA,MAAIq5D,gBAAgB,GAAG,UAAU54C,GAAV,EAAe43C,SAAf,EAA0BiB,UAA1B,EAAsC;AAC3D,QAAInkE,KAAK,GAAGsrB,GAAG,CAACxhB,QAAJ,CAAa65D,WAAb,EAAZ;AACA5U,IAAAA,QAAQ,CAAC/uD,KAAD,EAAQkjE,SAAR,CAAR;AACAa,IAAAA,SAAS,CAAC/jE,KAAD,EAAQmkE,UAAR,CAAT;AACA,WAAOnkE,KAAP;AACD,GALD;;AAMA,MAAIokE,aAAa,GAAG,UAAU94C,GAAV,EAAehmB,KAAf,EAAsBy8D,OAAtB,EAA+BxkD,MAA/B,EAAuCykD,OAAvC,EAAgD;AAClE,QAAI9jC,GAAG,GAAG5S,GAAG,CAACxhB,QAAJ,CAAa65D,WAAb,EAAV;AACAzlC,IAAAA,GAAG,CAAC6wB,QAAJ,CAAazpD,KAAK,CAACuF,GAAnB,EAAwBk3D,OAAxB;AACA7jC,IAAAA,GAAG,CAAC8wB,MAAJ,CAAWzxC,MAAM,CAAC1S,GAAlB,EAAuBm3D,OAAvB;AACA,WAAO9jC,GAAP;AACD,GALD;;AAMA,MAAImmC,MAAM,GAAG,UAAUC,IAAV,EAAgB;AAC3B,WAAO;AACLv5C,MAAAA,IAAI,EAAEu5C,IAAI,CAACv5C,IADN;AAELC,MAAAA,GAAG,EAAEs5C,IAAI,CAACt5C,GAFL;AAGLuT,MAAAA,KAAK,EAAE+lC,IAAI,CAAC/lC,KAHP;AAILgmC,MAAAA,MAAM,EAAED,IAAI,CAACC,MAJR;AAKL92C,MAAAA,KAAK,EAAE62C,IAAI,CAAC72C,KALP;AAML9C,MAAAA,MAAM,EAAE25C,IAAI,CAAC35C;AANR,KAAP;AAQD,GATD;;AAUA,MAAI65C,YAAY,GAAG,UAAUtmC,GAAV,EAAe;AAChC,QAAIumC,KAAK,GAAGvmC,GAAG,CAACwmC,cAAJ,EAAZ;AACA,QAAIJ,IAAI,GAAGG,KAAK,CAACjpE,MAAN,GAAe,CAAf,GAAmBipE,KAAK,CAAC,CAAD,CAAxB,GAA8BvmC,GAAG,CAACxT,qBAAJ,EAAzC;AACA,WAAO45C,IAAI,CAAC72C,KAAL,GAAa,CAAb,IAAkB62C,IAAI,CAAC35C,MAAL,GAAc,CAAhC,GAAoCzrB,QAAQ,CAACR,IAAT,CAAc4lE,IAAd,EAAoBtmE,GAApB,CAAwBqmE,MAAxB,CAApC,GAAsEnlE,QAAQ,CAACtC,IAAT,EAA7E;AACD,GAJD;;AAMA,MAAI+nE,KAAK,GAAGx+C,GAAG,CAAC7L,QAAJ,CAAa,CACvB;AACEgT,IAAAA,GAAG,EAAE,CACH,OADG,EAEH,SAFG,EAGH,QAHG,EAIH,SAJG;AADP,GADuB,EASvB;AACEC,IAAAA,GAAG,EAAE,CACH,OADG,EAEH,SAFG,EAGH,QAHG,EAIH,SAJG;AADP,GATuB,CAAb,CAAZ;;AAkBA,MAAIq3C,SAAS,GAAG,UAAUt5C,GAAV,EAAepxB,IAAf,EAAqB8F,KAArB,EAA4B;AAC1C,WAAO9F,IAAI,CAACgR,YAAY,CAACZ,OAAb,CAAqBtK,KAAK,CAACijE,cAA3B,CAAD,EAA6CjjE,KAAK,CAAC6kE,WAAnD,EAAgE35D,YAAY,CAACZ,OAAb,CAAqBtK,KAAK,CAAC8kE,YAA3B,CAAhE,EAA0G9kE,KAAK,CAAC+kE,SAAhH,CAAX;AACD,GAFD;;AAGA,MAAIC,SAAS,GAAG,UAAU15C,GAAV,EAAe8P,SAAf,EAA0B;AACxC,WAAOA,SAAS,CAACnyB,KAAV,CAAgB;AACrB25D,MAAAA,QAAQ,EAAE,UAAU1kC,GAAV,EAAe;AACvB,eAAO;AACL5Q,UAAAA,GAAG,EAAEzxB,QAAQ,CAACqiC,GAAD,CADR;AAEL3Q,UAAAA,GAAG,EAAEruB,QAAQ,CAACtC;AAFT,SAAP;AAID,OANoB;AAOrBkxB,MAAAA,QAAQ,EAAE,UAAUo1C,SAAV,EAAqBiB,UAArB,EAAiC;AACzC,eAAO;AACL72C,UAAAA,GAAG,EAAElrB,MAAM,CAAC,YAAY;AACtB,mBAAO8hE,gBAAgB,CAAC54C,GAAD,EAAM43C,SAAN,EAAiBiB,UAAjB,CAAvB;AACD,WAFU,CADN;AAIL52C,UAAAA,GAAG,EAAEnrB,MAAM,CAAC,YAAY;AACtB,mBAAOlD,QAAQ,CAACR,IAAT,CAAcwlE,gBAAgB,CAAC54C,GAAD,EAAM64C,UAAN,EAAkBjB,SAAlB,CAA9B,CAAP;AACD,WAFU;AAJN,SAAP;AAQD,OAhBoB;AAiBrBL,MAAAA,KAAK,EAAE,UAAUv9D,KAAV,EAAiBy8D,OAAjB,EAA0BxkD,MAA1B,EAAkCykD,OAAlC,EAA2C;AAChD,eAAO;AACL10C,UAAAA,GAAG,EAAElrB,MAAM,CAAC,YAAY;AACtB,mBAAOgiE,aAAa,CAAC94C,GAAD,EAAMhmB,KAAN,EAAay8D,OAAb,EAAsBxkD,MAAtB,EAA8BykD,OAA9B,CAApB;AACD,WAFU,CADN;AAILz0C,UAAAA,GAAG,EAAEnrB,MAAM,CAAC,YAAY;AACtB,mBAAOlD,QAAQ,CAACR,IAAT,CAAc0lE,aAAa,CAAC94C,GAAD,EAAM/N,MAAN,EAAcykD,OAAd,EAAuB18D,KAAvB,EAA8By8D,OAA9B,CAA3B,CAAP;AACD,WAFU;AAJN,SAAP;AAQD;AA1BoB,KAAhB,CAAP;AA4BD,GA7BD;;AA8BA,MAAIkD,UAAU,GAAG,UAAU35C,GAAV,EAAe45C,MAAf,EAAuB;AACtC,QAAIhnC,GAAG,GAAGgnC,MAAM,CAAC53C,GAAP,EAAV;;AACA,QAAI4Q,GAAG,CAACinC,SAAR,EAAmB;AACjB,UAAIC,QAAQ,GAAGF,MAAM,CAAC33C,GAAP,GAAalvB,MAAb,CAAoB,UAAUgnE,GAAV,EAAe;AAChD,eAAOA,GAAG,CAACF,SAAJ,KAAkB,KAAzB;AACD,OAFc,CAAf;AAGA,aAAOC,QAAQ,CAACpnE,GAAT,CAAa,UAAUqnE,GAAV,EAAe;AACjC,eAAOV,KAAK,CAACp3C,GAAN,CAAUriB,YAAY,CAACZ,OAAb,CAAqB+6D,GAAG,CAACP,YAAzB,CAAV,EAAkDO,GAAG,CAACN,SAAtD,EAAiE75D,YAAY,CAACZ,OAAb,CAAqB+6D,GAAG,CAACpC,cAAzB,CAAjE,EAA2GoC,GAAG,CAACR,WAA/G,CAAP;AACD,OAFM,EAEJnnE,UAFI,CAEO,YAAY;AACxB,eAAOknE,SAAS,CAACt5C,GAAD,EAAMq5C,KAAK,CAACr3C,GAAZ,EAAiB4Q,GAAjB,CAAhB;AACD,OAJM,CAAP;AAKD,KATD,MASO;AACL,aAAO0mC,SAAS,CAACt5C,GAAD,EAAMq5C,KAAK,CAACr3C,GAAZ,EAAiB4Q,GAAjB,CAAhB;AACD;AACF,GAdD;;AAeA,MAAIonC,QAAQ,GAAG,UAAUh6C,GAAV,EAAe8P,SAAf,EAA0B;AACvC,QAAI8pC,MAAM,GAAGF,SAAS,CAAC15C,GAAD,EAAM8P,SAAN,CAAtB;AACA,WAAO6pC,UAAU,CAAC35C,GAAD,EAAM45C,MAAN,CAAjB;AACD,GAHD;;AAIA,MAAIK,UAAU,GAAG,UAAUj6C,GAAV,EAAe8P,SAAf,EAA0B;AACzC,QAAIoqC,SAAS,GAAGF,QAAQ,CAACh6C,GAAD,EAAM8P,SAAN,CAAxB;AACA,WAAOoqC,SAAS,CAACv8D,KAAV,CAAgB;AACrBqkB,MAAAA,GAAG,EAAE,UAAUhoB,KAAV,EAAiBy8D,OAAjB,EAA0BxkD,MAA1B,EAAkCykD,OAAlC,EAA2C;AAC9C,YAAI9jC,GAAG,GAAG5S,GAAG,CAACxhB,QAAJ,CAAa65D,WAAb,EAAV;AACAzlC,QAAAA,GAAG,CAAC6wB,QAAJ,CAAazpD,KAAK,CAACuF,GAAnB,EAAwBk3D,OAAxB;AACA7jC,QAAAA,GAAG,CAAC8wB,MAAJ,CAAWzxC,MAAM,CAAC1S,GAAlB,EAAuBm3D,OAAvB;AACA,eAAO9jC,GAAP;AACD,OANoB;AAOrB3Q,MAAAA,GAAG,EAAE,UAAUjoB,KAAV,EAAiBy8D,OAAjB,EAA0BxkD,MAA1B,EAAkCykD,OAAlC,EAA2C;AAC9C,YAAI9jC,GAAG,GAAG5S,GAAG,CAACxhB,QAAJ,CAAa65D,WAAb,EAAV;AACAzlC,QAAAA,GAAG,CAAC6wB,QAAJ,CAAaxxC,MAAM,CAAC1S,GAApB,EAAyBm3D,OAAzB;AACA9jC,QAAAA,GAAG,CAAC8wB,MAAJ,CAAW1pD,KAAK,CAACuF,GAAjB,EAAsBk3D,OAAtB;AACA,eAAO7jC,GAAP;AACD;AAZoB,KAAhB,CAAP;AAcD,GAhBD;;AAiBA,MAAIunC,KAAK,GAAGd,KAAK,CAACr3C,GAAlB;AACA,MAAIo4C,KAAK,GAAGf,KAAK,CAACp3C,GAAlB;;AAEA,MAAIo4C,cAAc,GAAG,UAAUC,aAAV,EAAyBnsE,CAAzB,EAA4BuR,CAA5B,EAA+B66D,IAA/B,EAAqCrqE,MAArC,EAA6C;AAChE,QAAIA,MAAM,KAAK,CAAf,EAAkB;AAChB,aAAO,CAAP;AACD,KAFD,MAEO,IAAI/B,CAAC,KAAKosE,IAAV,EAAgB;AACrB,aAAOrqE,MAAM,GAAG,CAAhB;AACD;;AACD,QAAIizC,MAAM,GAAGo3B,IAAb;;AACA,SAAK,IAAI/lE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGtE,MAApB,EAA4BsE,CAAC,EAA7B,EAAiC;AAC/B,UAAIwkE,IAAI,GAAGsB,aAAa,CAAC9lE,CAAD,CAAxB;AACA,UAAIgmE,SAAS,GAAG1qD,IAAI,CAACgP,GAAL,CAAS3wB,CAAC,GAAG6qE,IAAI,CAACv5C,IAAlB,CAAhB;;AACA,UAAI/f,CAAC,IAAIs5D,IAAI,CAACC,MAAd,EAAsB;AACpB,YAAIv5D,CAAC,GAAGs5D,IAAI,CAACt5C,GAAT,IAAgB86C,SAAS,GAAGr3B,MAAhC,EAAwC;AACtC,iBAAO3uC,CAAC,GAAG,CAAX;AACD,SAFD,MAEO;AACL2uC,UAAAA,MAAM,GAAGq3B,SAAT;AACD;AACF;AACF;;AACD,WAAO,CAAP;AACD,GAnBD;;AAoBA,MAAIC,MAAM,GAAG,UAAUzB,IAAV,EAAgB7qE,CAAhB,EAAmBuR,CAAnB,EAAsB;AACjC,WAAOvR,CAAC,IAAI6qE,IAAI,CAACv5C,IAAV,IAAkBtxB,CAAC,IAAI6qE,IAAI,CAAC/lC,KAA5B,IAAqCvzB,CAAC,IAAIs5D,IAAI,CAACt5C,GAA/C,IAAsDhgB,CAAC,IAAIs5D,IAAI,CAACC,MAAvE;AACD,GAFD;;AAIA,MAAIyB,YAAY,GAAG,UAAUn8D,GAAV,EAAeo8D,QAAf,EAAyBxsE,CAAzB,EAA4BuR,CAA5B,EAA+Bs5D,IAA/B,EAAqC;AACtD,QAAI4B,cAAc,GAAG,UAAUppE,CAAV,EAAa;AAChC,UAAIoD,CAAC,GAAG2J,GAAG,CAACgB,GAAJ,CAAQ84D,WAAR,EAAR;AACAzjE,MAAAA,CAAC,CAAC6uD,QAAF,CAAWkX,QAAQ,CAACp7D,GAApB,EAAyB/N,CAAzB;AACAoD,MAAAA,CAAC,CAACiyD,QAAF,CAAW,IAAX;AACA,aAAOjyD,CAAP;AACD,KALD;;AAMA,QAAI0lE,aAAa,GAAG,UAAU9oE,CAAV,EAAa;AAC/B,UAAIoD,CAAC,GAAGgmE,cAAc,CAACppE,CAAD,CAAtB;AACA,aAAOoD,CAAC,CAACwqB,qBAAF,EAAP;AACD,KAHD;;AAIA,QAAIlvB,MAAM,GAAG2kB,KAAK,CAAC8lD,QAAD,CAAL,CAAgBzqE,MAA7B;AACA,QAAIkuC,MAAM,GAAGi8B,cAAc,CAACC,aAAD,EAAgBnsE,CAAhB,EAAmBuR,CAAnB,EAAsBs5D,IAAI,CAAC/lC,KAA3B,EAAkC/iC,MAAlC,CAA3B;AACA,WAAO0qE,cAAc,CAACx8B,MAAD,CAArB;AACD,GAdD;;AAeA,MAAIy8B,MAAM,GAAG,UAAUt8D,GAAV,EAAeY,IAAf,EAAqBhR,CAArB,EAAwBuR,CAAxB,EAA2B;AACtC,QAAI9K,CAAC,GAAG2J,GAAG,CAACgB,GAAJ,CAAQ84D,WAAR,EAAR;AACAzjE,IAAAA,CAAC,CAACkmE,UAAF,CAAa37D,IAAI,CAACI,GAAlB;AACA,QAAI45D,KAAK,GAAGvkE,CAAC,CAACwkE,cAAF,EAAZ;AACA,QAAI2B,SAAS,GAAG5kE,OAAO,CAACgjE,KAAD,EAAQ,UAAUH,IAAV,EAAgB;AAC7C,aAAOyB,MAAM,CAACzB,IAAD,EAAO7qE,CAAP,EAAUuR,CAAV,CAAN,GAAqB9L,QAAQ,CAACR,IAAT,CAAc4lE,IAAd,CAArB,GAA2CplE,QAAQ,CAACtC,IAAT,EAAlD;AACD,KAFsB,CAAvB;AAGA,WAAOypE,SAAS,CAACroE,GAAV,CAAc,UAAUsmE,IAAV,EAAgB;AACnC,aAAO0B,YAAY,CAACn8D,GAAD,EAAMY,IAAN,EAAYhR,CAAZ,EAAeuR,CAAf,EAAkBs5D,IAAlB,CAAnB;AACD,KAFM,CAAP;AAGD,GAVD;;AAYA,MAAIgC,gBAAgB,GAAG,UAAUz8D,GAAV,EAAeY,IAAf,EAAqBhR,CAArB,EAAwBuR,CAAxB,EAA2B;AAChD,QAAI9K,CAAC,GAAG2J,GAAG,CAACgB,GAAJ,CAAQ84D,WAAR,EAAR;AACA,QAAIvpC,KAAK,GAAG9oB,QAAQ,CAAC7G,IAAD,CAApB;AACA,WAAOhJ,OAAO,CAAC24B,KAAD,EAAQ,UAAUj9B,CAAV,EAAa;AACjC+C,MAAAA,CAAC,CAACkmE,UAAF,CAAajpE,CAAC,CAAC0N,GAAf;AACA,aAAOk7D,MAAM,CAAC7lE,CAAC,CAACwqB,qBAAF,EAAD,EAA4BjxB,CAA5B,EAA+BuR,CAA/B,CAAN,GAA0Cu7D,UAAU,CAAC18D,GAAD,EAAM1M,CAAN,EAAS1D,CAAT,EAAYuR,CAAZ,CAApD,GAAqE9L,QAAQ,CAACtC,IAAT,EAA5E;AACD,KAHa,CAAd;AAID,GAPD;;AAQA,MAAI2pE,UAAU,GAAG,UAAU18D,GAAV,EAAeY,IAAf,EAAqBhR,CAArB,EAAwBuR,CAAxB,EAA2B;AAC1C,WAAOiF,MAAM,CAACxF,IAAD,CAAN,GAAe07D,MAAM,CAACt8D,GAAD,EAAMY,IAAN,EAAYhR,CAAZ,EAAeuR,CAAf,CAArB,GAAyCs7D,gBAAgB,CAACz8D,GAAD,EAAMY,IAAN,EAAYhR,CAAZ,EAAeuR,CAAf,CAAhE;AACD,GAFD;;AAGA,MAAIw7D,QAAQ,GAAG,UAAU38D,GAAV,EAAeY,IAAf,EAAqBhR,CAArB,EAAwBuR,CAAxB,EAA2B;AACxC,QAAI9K,CAAC,GAAG2J,GAAG,CAACgB,GAAJ,CAAQ84D,WAAR,EAAR;AACAzjE,IAAAA,CAAC,CAACkmE,UAAF,CAAa37D,IAAI,CAACI,GAAlB;AACA,QAAIy5D,IAAI,GAAGpkE,CAAC,CAACwqB,qBAAF,EAAX;AACA,QAAI+7C,QAAQ,GAAGrrD,IAAI,CAACC,GAAL,CAASipD,IAAI,CAACv5C,IAAd,EAAoB3P,IAAI,CAACsB,GAAL,CAAS4nD,IAAI,CAAC/lC,KAAd,EAAqB9kC,CAArB,CAApB,CAAf;AACA,QAAIitE,QAAQ,GAAGtrD,IAAI,CAACC,GAAL,CAASipD,IAAI,CAACt5C,GAAd,EAAmB5P,IAAI,CAACsB,GAAL,CAAS4nD,IAAI,CAACC,MAAd,EAAsBv5D,CAAtB,CAAnB,CAAf;AACA,WAAOu7D,UAAU,CAAC18D,GAAD,EAAMY,IAAN,EAAYg8D,QAAZ,EAAsBC,QAAtB,CAAjB;AACD,GAPD;;AASA,MAAIC,gBAAgB,GAAG,IAAvB;AACA,MAAIC,iBAAiB,GAAG,KAAxB;;AACA,MAAIC,oBAAoB,GAAG,UAAUvC,IAAV,EAAgB7qE,CAAhB,EAAmB;AAC5C,WAAOA,CAAC,GAAG6qE,IAAI,CAACv5C,IAAT,GAAgBu5C,IAAI,CAAC/lC,KAAL,GAAa9kC,CAA7B,GAAiCktE,gBAAjC,GAAoDC,iBAA3D;AACD,GAFD;;AAGA,MAAIE,mBAAmB,GAAG,UAAUj9D,GAAV,EAAe5D,MAAf,EAAuB8gE,iBAAvB,EAA0C;AAClE,QAAI7mE,CAAC,GAAG2J,GAAG,CAACgB,GAAJ,CAAQ84D,WAAR,EAAR;AACAzjE,IAAAA,CAAC,CAACkmE,UAAF,CAAangE,MAAM,CAAC4E,GAApB;AACA3K,IAAAA,CAAC,CAACiyD,QAAF,CAAW4U,iBAAX;AACA,WAAO7mE,CAAP;AACD,GALD;;AAMA,MAAI8mE,eAAe,GAAG,UAAUn9D,GAAV,EAAeY,IAAf,EAAqBhR,CAArB,EAAwB;AAC5C,QAAIwtE,WAAW,GAAGp9D,GAAG,CAACgB,GAAJ,CAAQ84D,WAAR,EAAlB;AACAsD,IAAAA,WAAW,CAACb,UAAZ,CAAuB37D,IAAI,CAACI,GAA5B;AACA,QAAIy5D,IAAI,GAAG2C,WAAW,CAACv8C,qBAAZ,EAAX;AACA,QAAIq8C,iBAAiB,GAAGF,oBAAoB,CAACvC,IAAD,EAAO7qE,CAAP,CAA5C;AACA,QAAI6C,CAAC,GAAGyqE,iBAAiB,KAAKJ,gBAAtB,GAAyCxoD,KAAzC,GAAiDga,MAAzD;AACA,WAAO77B,CAAC,CAACmO,IAAD,CAAD,CAAQzM,GAAR,CAAY,UAAUiI,MAAV,EAAkB;AACnC,aAAO6gE,mBAAmB,CAACj9D,GAAD,EAAM5D,MAAN,EAAc8gE,iBAAd,CAA1B;AACD,KAFM,CAAP;AAGD,GATD;;AAUA,MAAIG,aAAa,GAAG,UAAUr9D,GAAV,EAAeY,IAAf,EAAqBhR,CAArB,EAAwB;AAC1C,QAAI6qE,IAAI,GAAG75D,IAAI,CAACI,GAAL,CAAS6f,qBAAT,EAAX;AACA,QAAIq8C,iBAAiB,GAAGF,oBAAoB,CAACvC,IAAD,EAAO7qE,CAAP,CAA5C;AACA,WAAOyF,QAAQ,CAACR,IAAT,CAAcooE,mBAAmB,CAACj9D,GAAD,EAAMY,IAAN,EAAYs8D,iBAAZ,CAAjC,CAAP;AACD,GAJD;;AAKA,MAAIpiE,MAAM,GAAG,UAAUkF,GAAV,EAAeY,IAAf,EAAqBhR,CAArB,EAAwB;AACnC,QAAI6C,CAAC,GAAGgV,QAAQ,CAAC7G,IAAD,CAAR,CAAejP,MAAf,KAA0B,CAA1B,GAA8B0rE,aAA9B,GAA8CF,eAAtD;AACA,WAAO1qE,CAAC,CAACuN,GAAD,EAAMY,IAAN,EAAYhR,CAAZ,CAAR;AACD,GAHD;;AAKA,MAAI0tE,sBAAsB,GAAG,UAAUt9D,GAAV,EAAepQ,CAAf,EAAkBuR,CAAlB,EAAqB;AAChD,WAAO9L,QAAQ,CAACD,IAAT,CAAc4K,GAAG,CAACgB,GAAJ,CAAQs8D,sBAAR,CAA+B1tE,CAA/B,EAAkCuR,CAAlC,CAAd,EAAoD9M,IAApD,CAAyD,UAAUkuB,GAAV,EAAe;AAC7E,UAAIA,GAAG,CAACg7C,UAAJ,KAAmB,IAAvB,EAA6B;AAC3B,eAAOloE,QAAQ,CAACtC,IAAT,EAAP;AACD;;AACD,UAAIsD,CAAC,GAAG2J,GAAG,CAACgB,GAAJ,CAAQ84D,WAAR,EAAR;AACAzjE,MAAAA,CAAC,CAAC6uD,QAAF,CAAW3iC,GAAG,CAACg7C,UAAf,EAA2Bh7C,GAAG,CAACsd,MAA/B;AACAxpC,MAAAA,CAAC,CAACiyD,QAAF;AACA,aAAOjzD,QAAQ,CAACR,IAAT,CAAcwB,CAAd,CAAP;AACD,KARM,CAAP;AASD,GAVD;;AAWA,MAAImnE,mBAAmB,GAAG,UAAUx9D,GAAV,EAAepQ,CAAf,EAAkBuR,CAAlB,EAAqB;AAC7C,WAAO9L,QAAQ,CAACD,IAAT,CAAc4K,GAAG,CAACgB,GAAJ,CAAQw8D,mBAAR,CAA4B5tE,CAA5B,EAA+BuR,CAA/B,CAAd,CAAP;AACD,GAFD;;AAGA,MAAIs8D,eAAe,GAAG,UAAUz9D,GAAV,EAAeY,IAAf,EAAqBhR,CAArB,EAAwBuR,CAAxB,EAA2B;AAC/C,QAAI9K,CAAC,GAAG2J,GAAG,CAACgB,GAAJ,CAAQ84D,WAAR,EAAR;AACAzjE,IAAAA,CAAC,CAACkmE,UAAF,CAAa37D,IAAI,CAACI,GAAlB;AACA,QAAIy5D,IAAI,GAAGpkE,CAAC,CAACwqB,qBAAF,EAAX;AACA,QAAI+7C,QAAQ,GAAGrrD,IAAI,CAACC,GAAL,CAASipD,IAAI,CAACv5C,IAAd,EAAoB3P,IAAI,CAACsB,GAAL,CAAS4nD,IAAI,CAAC/lC,KAAd,EAAqB9kC,CAArB,CAApB,CAAf;AACA,QAAIitE,QAAQ,GAAGtrD,IAAI,CAACC,GAAL,CAASipD,IAAI,CAACt5C,GAAd,EAAmB5P,IAAI,CAACsB,GAAL,CAAS4nD,IAAI,CAACC,MAAd,EAAsBv5D,CAAtB,CAAnB,CAAf;AACA,WAAOw7D,QAAQ,CAAC38D,GAAD,EAAMY,IAAN,EAAYg8D,QAAZ,EAAsBC,QAAtB,CAAf;AACD,GAPD;;AAQA,MAAIa,eAAe,GAAG,UAAU19D,GAAV,EAAepQ,CAAf,EAAkBuR,CAAlB,EAAqB;AACzC,WAAOE,YAAY,CAACJ,SAAb,CAAuBjB,GAAvB,EAA4BpQ,CAA5B,EAA+BuR,CAA/B,EAAkC9M,IAAlC,CAAuC,UAAUoN,IAAV,EAAgB;AAC5D,UAAIiL,QAAQ,GAAG,YAAY;AACzB,eAAO5R,MAAM,CAACkF,GAAD,EAAMyB,IAAN,EAAY7R,CAAZ,CAAb;AACD,OAFD;;AAGA,aAAO6X,QAAQ,CAAChG,IAAD,CAAR,CAAe9P,MAAf,KAA0B,CAA1B,GAA8B+a,QAAQ,EAAtC,GAA2C+wD,eAAe,CAACz9D,GAAD,EAAMyB,IAAN,EAAY7R,CAAZ,EAAeuR,CAAf,CAAf,CAAiCjN,OAAjC,CAAyCwY,QAAzC,CAAlD;AACD,KALM,CAAP;AAMD,GAPD;;AAQA,MAAIixD,eAAe,GAAG,YAAY;AAChC,QAAI19D,QAAQ,CAACq9D,sBAAb,EAAqC;AACnC,aAAOA,sBAAP;AACD,KAFD,MAEO,IAAIr9D,QAAQ,CAACu9D,mBAAb,EAAkC;AACvC,aAAOA,mBAAP;AACD,KAFM,MAEA;AACL,aAAOE,eAAP;AACD;AACF,GARqB,EAAtB;;AASA,MAAIE,WAAW,GAAG,UAAUn8C,GAAV,EAAe7xB,CAAf,EAAkBuR,CAAlB,EAAqB;AACrC,QAAInB,GAAG,GAAGqB,YAAY,CAACZ,OAAb,CAAqBghB,GAAG,CAACxhB,QAAzB,CAAV;AACA,WAAO09D,eAAe,CAAC39D,GAAD,EAAMpQ,CAAN,EAASuR,CAAT,CAAf,CAA2BhN,GAA3B,CAA+B,UAAUkgC,GAAV,EAAe;AACnD,aAAO+jC,QAAQ,CAACzgD,MAAT,CAAgBtW,YAAY,CAACZ,OAAb,CAAqB4zB,GAAG,CAAC+kC,cAAzB,CAAhB,EAA0D/kC,GAAG,CAAC2mC,WAA9D,EAA2E35D,YAAY,CAACZ,OAAb,CAAqB4zB,GAAG,CAAC4mC,YAAzB,CAA3E,EAAmH5mC,GAAG,CAAC6mC,SAAvH,CAAP;AACD,KAFM,CAAP;AAGD,GALD;;AAOA,MAAI2C,aAAa,GAAG,UAAUv8D,OAAV,EAAmBu+B,MAAnB,EAA2B;AAC7C,QAAIi+B,MAAM,GAAG5tE,IAAI,CAACoR,OAAD,CAAjB;;AACA,QAAI,YAAYw8D,MAAhB,EAAwB;AACtB,aAAOjF,IAAI,CAACpqD,KAAL,CAAWnN,OAAX,CAAP;AACD,KAFD,MAEO,IAAI,CAACxL,QAAQ,CAAC,CACjB,IADiB,EAEjB,KAFiB,CAAD,EAGfgoE,MAHe,CAAb,EAGO;AACZ,aAAOjF,IAAI,CAACrlC,EAAL,CAAQlyB,OAAR,EAAiBu+B,MAAjB,CAAP;AACD,KALM,MAKA;AACL,aAAOA,MAAM,KAAK,CAAX,GAAeg5B,IAAI,CAACrqD,MAAL,CAAYlN,OAAZ,CAAf,GAAsCu3D,IAAI,CAACpqD,KAAL,CAAWnN,OAAX,CAA7C;AACD;AACF,GAZD;;AAaA,MAAIy8D,kBAAkB,GAAG,UAAU1E,SAAV,EAAqBiB,UAArB,EAAiC;AACxD,QAAI7+D,KAAK,GAAG49D,SAAS,CAAC7lE,IAAV,CAAeqlE,IAAI,CAACrqD,MAApB,EAA4BqvD,aAA5B,EAA2ChF,IAAI,CAACpqD,KAAhD,CAAZ;AACA,QAAIiF,MAAM,GAAG4mD,UAAU,CAAC9mE,IAAX,CAAgBqlE,IAAI,CAACrqD,MAArB,EAA6BqvD,aAA7B,EAA4ChF,IAAI,CAACpqD,KAAjD,CAAb;AACA,WAAOmrD,YAAY,CAAC31C,QAAb,CAAsBxoB,KAAtB,EAA6BiY,MAA7B,CAAP;AACD,GAJD;;AAKA,MAAIsqD,eAAe,GAAG,UAAUviE,KAAV,EAAiBy8D,OAAjB,EAA0BxkD,MAA1B,EAAkCykD,OAAlC,EAA2C;AAC/D,QAAIkB,SAAS,GAAGwE,aAAa,CAACpiE,KAAD,EAAQy8D,OAAR,CAA7B;AACA,QAAIoC,UAAU,GAAGuD,aAAa,CAACnqD,MAAD,EAASykD,OAAT,CAA9B;AACA,WAAOyB,YAAY,CAAC31C,QAAb,CAAsBo1C,SAAtB,EAAiCiB,UAAjC,CAAP;AACD,GAJD;;AAKA,MAAI2D,UAAU,GAAG,UAAU1sC,SAAV,EAAqB;AACpC,WAAOA,SAAS,CAACnyB,KAAV,CAAgB;AACrB25D,MAAAA,QAAQ,EAAE,UAAU1kC,GAAV,EAAe;AACvB,YAAI54B,KAAK,GAAG4F,YAAY,CAACZ,OAAb,CAAqB4zB,GAAG,CAAC+kC,cAAzB,CAAZ;AACA,YAAI1lD,MAAM,GAAGrS,YAAY,CAACZ,OAAb,CAAqB4zB,GAAG,CAAC4mC,YAAzB,CAAb;AACA,eAAO+C,eAAe,CAACviE,KAAD,EAAQ44B,GAAG,CAAC2mC,WAAZ,EAAyBtnD,MAAzB,EAAiC2gB,GAAG,CAAC6mC,SAArC,CAAtB;AACD,OALoB;AAMrBj3C,MAAAA,QAAQ,EAAE85C,kBANW;AAOrB/E,MAAAA,KAAK,EAAEgF;AAPc,KAAhB,CAAP;AASD,GAVD;;AAYA,MAAIE,SAAS,GAAG,UAAUziE,KAAV,EAAiBy8D,OAAjB,EAA0BxkD,MAA1B,EAAkCykD,OAAlC,EAA2C;AACzD,QAAIn4D,GAAG,GAAGyG,KAAK,CAAChL,KAAD,CAAf;AACA,QAAI44B,GAAG,GAAGr0B,GAAG,CAACgB,GAAJ,CAAQ84D,WAAR,EAAV;AACAzlC,IAAAA,GAAG,CAAC6wB,QAAJ,CAAazpD,KAAK,CAACuF,GAAnB,EAAwBk3D,OAAxB;AACA7jC,IAAAA,GAAG,CAAC8wB,MAAJ,CAAWzxC,MAAM,CAAC1S,GAAlB,EAAuBm3D,OAAvB;AACA,WAAO9jC,GAAP;AACD,GAND;;AAOA,MAAI8pC,OAAO,GAAG,UAAU1iE,KAAV,EAAiBy8D,OAAjB,EAA0BxkD,MAA1B,EAAkCykD,OAAlC,EAA2C;AACvD,QAAI9hE,CAAC,GAAG6nE,SAAS,CAACziE,KAAD,EAAQy8D,OAAR,EAAiBxkD,MAAjB,EAAyBykD,OAAzB,CAAjB;AACA,QAAIiG,IAAI,GAAGj8D,IAAI,CAAC1G,KAAD,EAAQiY,MAAR,CAAJ,IAAuBwkD,OAAO,KAAKC,OAA9C;AACA,WAAO9hE,CAAC,CAACilE,SAAF,IAAe,CAAC8C,IAAvB;AACD,GAJD;;AAMA,MAAIC,kBAAkB,GAAG,UAAU58C,GAAV,EAAe;AACtC,WAAOpsB,QAAQ,CAACD,IAAT,CAAcqsB,GAAG,CAAC68C,YAAJ,EAAd,CAAP;AACD,GAFD;;AAGA,MAAIC,gBAAgB,GAAG,UAAU98C,GAAV,EAAe4S,GAAf,EAAoB;AACzCgqC,IAAAA,kBAAkB,CAAC58C,GAAD,CAAlB,CAAwBrtB,IAAxB,CAA6B,UAAUm9B,SAAV,EAAqB;AAChDA,MAAAA,SAAS,CAACitC,eAAV;AACAjtC,MAAAA,SAAS,CAACktC,QAAV,CAAmBpqC,GAAnB;AACD,KAHD;AAID,GALD;;AAMA,MAAIqqC,UAAU,GAAG,UAAUj9C,GAAV,EAAehmB,KAAf,EAAsBy8D,OAAtB,EAA+BxkD,MAA/B,EAAuCykD,OAAvC,EAAgD;AAC/D,QAAI9jC,GAAG,GAAGkmC,aAAa,CAAC94C,GAAD,EAAMhmB,KAAN,EAAay8D,OAAb,EAAsBxkD,MAAtB,EAA8BykD,OAA9B,CAAvB;AACAoG,IAAAA,gBAAgB,CAAC98C,GAAD,EAAM4S,GAAN,CAAhB;AACD,GAHD;;AAIA,MAAIsqC,iBAAiB,GAAG,UAAUl9C,GAAV,EAAe8P,SAAf,EAA0B91B,KAA1B,EAAiCy8D,OAAjC,EAA0CxkD,MAA1C,EAAkDykD,OAAlD,EAA2D;AACjF5mC,IAAAA,SAAS,CAAC+2B,QAAV,CAAmB7sD,KAAK,CAACuF,GAAzB,EAA8Bk3D,OAA9B;AACA3mC,IAAAA,SAAS,CAACqtC,MAAV,CAAiBlrD,MAAM,CAAC1S,GAAxB,EAA6Bm3D,OAA7B;AACD,GAHD;;AAIA,MAAI0G,oBAAoB,GAAG,UAAUp9C,GAAV,EAAewC,QAAf,EAAyB;AAClD,WAAOw3C,QAAQ,CAACh6C,GAAD,EAAMwC,QAAN,CAAR,CAAwB7kB,KAAxB,CAA8B;AACnCqkB,MAAAA,GAAG,EAAE,UAAUhoB,KAAV,EAAiBy8D,OAAjB,EAA0BxkD,MAA1B,EAAkCykD,OAAlC,EAA2C;AAC9CuG,QAAAA,UAAU,CAACj9C,GAAD,EAAMhmB,KAAN,EAAay8D,OAAb,EAAsBxkD,MAAtB,EAA8BykD,OAA9B,CAAV;AACD,OAHkC;AAInCz0C,MAAAA,GAAG,EAAE,UAAUjoB,KAAV,EAAiBy8D,OAAjB,EAA0BxkD,MAA1B,EAAkCykD,OAAlC,EAA2C;AAC9CkG,QAAAA,kBAAkB,CAAC58C,GAAD,CAAlB,CAAwBrtB,IAAxB,CAA6B,UAAUm9B,SAAV,EAAqB;AAChD,cAAIA,SAAS,CAACutC,gBAAd,EAAgC;AAC9BvtC,YAAAA,SAAS,CAACutC,gBAAV,CAA2BrjE,KAAK,CAACuF,GAAjC,EAAsCk3D,OAAtC,EAA+CxkD,MAAM,CAAC1S,GAAtD,EAA2Dm3D,OAA3D;AACD,WAFD,MAEO,IAAI5mC,SAAS,CAACqtC,MAAd,EAAsB;AAC3B,gBAAI;AACFD,cAAAA,iBAAiB,CAACl9C,GAAD,EAAM8P,SAAN,EAAiB91B,KAAjB,EAAwBy8D,OAAxB,EAAiCxkD,MAAjC,EAAyCykD,OAAzC,CAAjB;AACD,aAFD,CAEE,OAAO3xD,CAAP,EAAU;AACVk4D,cAAAA,UAAU,CAACj9C,GAAD,EAAM/N,MAAN,EAAcykD,OAAd,EAAuB18D,KAAvB,EAA8By8D,OAA9B,CAAV;AACD;AACF,WANM,MAMA;AACLwG,YAAAA,UAAU,CAACj9C,GAAD,EAAM/N,MAAN,EAAcykD,OAAd,EAAuB18D,KAAvB,EAA8By8D,OAA9B,CAAV;AACD;AACF,SAZD;AAaD;AAlBkC,KAA9B,CAAP;AAoBD,GArBD;;AAsBA,MAAI6G,QAAQ,GAAG,UAAUt9C,GAAV,EAAehmB,KAAf,EAAsBy8D,OAAtB,EAA+BxkD,MAA/B,EAAuCykD,OAAvC,EAAgD;AAC7D,QAAIl0C,QAAQ,GAAG+5C,eAAe,CAACviE,KAAD,EAAQy8D,OAAR,EAAiBxkD,MAAjB,EAAyBykD,OAAzB,CAA9B;AACA0G,IAAAA,oBAAoB,CAACp9C,GAAD,EAAMwC,QAAN,CAApB;AACD,GAHD;;AAIA,MAAI+6C,WAAW,GAAG,UAAUv9C,GAAV,EAAe43C,SAAf,EAA0BiB,UAA1B,EAAsC;AACtD,QAAIr2C,QAAQ,GAAG85C,kBAAkB,CAAC1E,SAAD,EAAYiB,UAAZ,CAAjC;AACAuE,IAAAA,oBAAoB,CAACp9C,GAAD,EAAMwC,QAAN,CAApB;AACD,GAHD;;AAIA,MAAIg7C,QAAQ,GAAG,UAAU1tC,SAAV,EAAqB;AAClC,QAAI9P,GAAG,GAAGm4C,YAAY,CAACF,MAAb,CAAoBnoC,SAApB,EAA+BvwB,GAAzC;;AACA,QAAIk+D,WAAW,GAAG,UAAUzjE,KAAV,EAAiBy8D,OAAjB,EAA0BxkD,MAA1B,EAAkCykD,OAAlC,EAA2C;AAC3D,aAAOoC,aAAa,CAAC94C,GAAD,EAAMhmB,KAAN,EAAay8D,OAAb,EAAsBxkD,MAAtB,EAA8BykD,OAA9B,CAApB;AACD,KAFD;;AAGA,QAAIjoD,QAAQ,GAAG+tD,UAAU,CAAC1sC,SAAD,CAAzB;AACA,WAAOkqC,QAAQ,CAACh6C,GAAD,EAAMvR,QAAN,CAAR,CAAwB9Q,KAAxB,CAA8B;AACnCqkB,MAAAA,GAAG,EAAEy7C,WAD8B;AAEnCx7C,MAAAA,GAAG,EAAEw7C;AAF8B,KAA9B,CAAP;AAID,GAVD;;AAWA,MAAIC,SAAS,GAAG,UAAU5tC,SAAV,EAAqB;AACnC,QAAIA,SAAS,CAAC6tC,UAAV,GAAuB,CAA3B,EAA8B;AAC5B,UAAIC,QAAQ,GAAG9tC,SAAS,CAAC+tC,UAAV,CAAqB,CAArB,CAAf;AACA,UAAIC,OAAO,GAAGhuC,SAAS,CAAC+tC,UAAV,CAAqB/tC,SAAS,CAAC6tC,UAAV,GAAuB,CAA5C,CAAd;AACA,aAAO/pE,QAAQ,CAACR,IAAT,CAAcujE,QAAQ,CAACzgD,MAAT,CAAgBtW,YAAY,CAACZ,OAAb,CAAqB4+D,QAAQ,CAACjG,cAA9B,CAAhB,EAA+DiG,QAAQ,CAACrE,WAAxE,EAAqF35D,YAAY,CAACZ,OAAb,CAAqB8+D,OAAO,CAACtE,YAA7B,CAArF,EAAiIsE,OAAO,CAACrE,SAAzI,CAAd,CAAP;AACD,KAJD,MAIO;AACL,aAAO7lE,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,GARD;;AASA,MAAIysE,UAAU,GAAG,UAAUjuC,SAAV,EAAqB;AACpC,QAAIA,SAAS,CAACkuC,UAAV,KAAyB,IAAzB,IAAiCluC,SAAS,CAACmuC,SAAV,KAAwB,IAA7D,EAAmE;AACjE,aAAOP,SAAS,CAAC5tC,SAAD,CAAhB;AACD,KAFD,MAEO;AACL,UAAIouC,MAAM,GAAGt+D,YAAY,CAACZ,OAAb,CAAqB8wB,SAAS,CAACkuC,UAA/B,CAAb;AACA,UAAIG,OAAO,GAAGv+D,YAAY,CAACZ,OAAb,CAAqB8wB,SAAS,CAACmuC,SAA/B,CAAd;AACA,aAAOvB,OAAO,CAACwB,MAAD,EAASpuC,SAAS,CAACsuC,YAAnB,EAAiCD,OAAjC,EAA0CruC,SAAS,CAACuuC,WAApD,CAAP,GAA0EzqE,QAAQ,CAACR,IAAT,CAAcujE,QAAQ,CAACzgD,MAAT,CAAgBgoD,MAAhB,EAAwBpuC,SAAS,CAACsuC,YAAlC,EAAgDD,OAAhD,EAAyDruC,SAAS,CAACuuC,WAAnE,CAAd,CAA1E,GAA2KX,SAAS,CAAC5tC,SAAD,CAA3L;AACD;AACF,GARD;;AASA,MAAIwuC,YAAY,GAAG,UAAUt+C,GAAV,EAAengB,OAAf,EAAwB;AACzC,QAAI+yB,GAAG,GAAGwlC,kBAAkB,CAACp4C,GAAD,EAAMngB,OAAN,CAA5B;AACAi9D,IAAAA,gBAAgB,CAAC98C,GAAD,EAAM4S,GAAN,CAAhB;AACD,GAHD;;AAIA,MAAI2rC,QAAQ,GAAG,UAAUv+C,GAAV,EAAe;AAC5B,WAAO48C,kBAAkB,CAAC58C,GAAD,CAAlB,CAAwBjtB,MAAxB,CAA+B,UAAUyrE,GAAV,EAAe;AACnD,aAAOA,GAAG,CAACb,UAAJ,GAAiB,CAAxB;AACD,KAFM,EAEJ/qE,IAFI,CAECmrE,UAFD,CAAP;AAGD,GAJD;;AAKA,MAAIU,KAAK,GAAG,UAAUz+C,GAAV,EAAe;AACzB,WAAOu+C,QAAQ,CAACv+C,GAAD,CAAR,CAActtB,GAAd,CAAkB,UAAUgC,KAAV,EAAiB;AACxC,aAAOyjE,YAAY,CAACZ,KAAb,CAAmB7iE,KAAK,CAACsF,KAAzB,EAAgCtF,KAAK,CAAC+hE,OAAtC,EAA+C/hE,KAAK,CAACud,MAArD,EAA6Dvd,KAAK,CAACgiE,OAAnE,CAAP;AACD,KAFM,CAAP;AAGD,GAJD;;AAKA,MAAIgI,cAAc,GAAG,UAAU1+C,GAAV,EAAe8P,SAAf,EAA0B;AAC7C,QAAI8C,GAAG,GAAGqnC,UAAU,CAACj6C,GAAD,EAAM8P,SAAN,CAApB;AACA,WAAOopC,YAAY,CAACtmC,GAAD,CAAnB;AACD,GAHD;;AAIA,MAAI+rC,UAAU,GAAG,UAAU3+C,GAAV,EAAe7xB,CAAf,EAAkBuR,CAAlB,EAAqB;AACpC,WAAOy8D,WAAW,CAACn8C,GAAD,EAAM7xB,CAAN,EAASuR,CAAT,CAAlB;AACD,GAFD;;AAGA,MAAIozB,KAAK,GAAG,UAAU9S,GAAV,EAAe;AACzB48C,IAAAA,kBAAkB,CAAC58C,GAAD,CAAlB,CAAwBrtB,IAAxB,CAA6B,UAAUm9B,SAAV,EAAqB;AAChD,aAAOA,SAAS,CAACitC,eAAV,EAAP;AACD,KAFD;AAGD,GAJD;;AAMA,MAAI6B,QAAQ,GAAGhjD,OAAO,CAACC,IAAR,CAAaC,KAAb,CAAmBC,OAAnB,CAA2B,iBAA3B,CAAf;;AAEA,MAAI8iD,OAAO,GAAG,UAAU5vC,MAAV,EAAkBzpB,MAAlB,EAA0BwF,IAA1B,EAAgC;AAC5C,WAAOs0B,EAAE,CAACrQ,MAAD,EAASzpB,MAAT,EAAiBoZ,IAAI,CAAC5T,IAAD,CAArB,CAAT;AACD,GAFD;;AAGA,MAAI8zD,QAAQ,GAAG,UAAU7vC,MAAV,EAAkBzpB,MAAlB,EAA0BwF,IAA1B,EAAgC;AAC7C,WAAOs0B,EAAE,CAACrQ,MAAD,EAASzpB,MAAT,EAAiB6oB,IAAI,CAACrjB,IAAD,CAArB,CAAT;AACD,GAFD;;AAGA,MAAI+zD,0BAA0B,GAAG,UAAU9vC,MAAV,EAAkBjkB,IAAlB,EAAwB;AACvD,QAAI8kB,SAAS,GAAGqoC,YAAY,CAACZ,KAAb,CAAmBvsD,IAAnB,EAAyB,CAAzB,EAA4BA,IAA5B,EAAkC,CAAlC,CAAhB;AACA,WAAOwyD,QAAQ,CAAC1tC,SAAD,CAAf;AACD,GAHD;;AAIA,MAAIkvC,uBAAuB,GAAG,UAAU/vC,MAAV,EAAkB/iB,KAAlB,EAAyB;AACrD,QAAIvJ,IAAI,GAAGoF,aAAa,CAACmE,KAAD,EAAQ,IAAR,CAAxB;AACA,WAAOhW,IAAI,CAACyM,IAAD,CAAJ,CAAW/P,IAAX,CAAgB,UAAUsD,IAAV,EAAgB;AACrC,aAAOwS,YAAY,CAACxS,IAAD,EAAO,OAAP,CAAZ,CAA4BxD,GAA5B,CAAgC,UAAUmgB,KAAV,EAAiB;AACtD,eAAOksD,0BAA0B,CAAC9vC,MAAD,EAASpc,KAAT,CAAjC;AACD,OAFM,CAAP;AAGD,KAJM,CAAP;AAKD,GAPD;;AAQA,MAAIysB,EAAE,GAAG,UAAUrQ,MAAV,EAAkBzpB,MAAlB,EAA0BwF,IAA1B,EAAgC;AACvC,WAAOA,IAAI,CAACjZ,IAAL,CAAU6B,QAAQ,CAACtC,IAAnB,EAAyBsC,QAAQ,CAACtC,IAAlC,EAAwC,UAAUmI,OAAV,EAAmBmlB,IAAnB,EAAyB;AACtE,aAAO/L,KAAK,CAAC+L,IAAD,CAAL,CAAYlsB,GAAZ,CAAgB,UAAUsY,IAAV,EAAgB;AACrC,eAAO+zD,0BAA0B,CAAC9vC,MAAD,EAASjkB,IAAT,CAAjC;AACD,OAFM,CAAP;AAGD,KAJM,EAIJ,UAAUvR,OAAV,EAAmB;AACpB,aAAOyS,KAAK,CAACzS,OAAD,EAAU+L,MAAV,CAAL,CAAuB5S,IAAvB,CAA4B,UAAUsZ,KAAV,EAAiB;AAClD+iB,QAAAA,MAAM,CAACgwC,WAAP,CAAmB,wBAAnB;AACA,eAAOD,uBAAuB,CAAC/vC,MAAD,EAAS/iB,KAAT,CAA9B;AACD,OAHM,CAAP;AAID,KATM,CAAP;AAUD,GAXD;;AAYA,MAAIgzD,YAAY,GAAG,CACjB,OADiB,EAEjB,IAFiB,EAGjB,IAHiB,CAAnB;;AAKA,MAAIC,QAAQ,GAAG,UAAUp4D,KAAV,EAAiBkoB,MAAjB,EAAyB6C,aAAzB,EAAwC;AACrD,QAAI/qB,KAAK,CAACq4D,OAAN,KAAkBR,QAAQ,CAACS,GAA/B,EAAoC;AAClC,UAAIC,MAAM,GAAGtwC,SAAS,CAACC,MAAD,CAAtB;;AACA,UAAIswC,QAAQ,GAAG,UAAU1/D,OAAV,EAAmB;AAChC,YAAIw8D,MAAM,GAAG5tE,IAAI,CAACoR,OAAD,CAAjB;AACA,eAAOa,IAAI,CAACb,OAAD,EAAUy/D,MAAV,CAAJ,IAAyBjrE,QAAQ,CAAC6qE,YAAD,EAAe7C,MAAf,CAAxC;AACD,OAHD;;AAIA,UAAIzpC,GAAG,GAAG3D,MAAM,CAACa,SAAP,CAAiB+c,MAAjB,EAAV;AACA,UAAI90B,SAAS,GAAGnY,YAAY,CAACZ,OAAb,CAAqB+H,KAAK,CAACy4D,QAAN,GAAiB5sC,GAAG,CAAC+kC,cAArB,GAAsC/kC,GAAG,CAAC4mC,YAA/D,CAAhB;AACAxuD,MAAAA,IAAI,CAAC+M,SAAD,EAAYwnD,QAAZ,CAAJ,CAA0B5sE,IAA1B,CAA+B,UAAUqY,IAAV,EAAgB;AAC7CjE,QAAAA,KAAK,CAACkrB,cAAN;AACA/lB,QAAAA,KAAK,CAAClB,IAAD,EAAOu0D,QAAP,CAAL,CAAsB5sE,IAAtB,CAA2Bm/B,aAAa,CAACgB,KAAzC;AACA7D,QAAAA,MAAM,CAACa,SAAP,CAAiB+2B,QAAjB,CAA0B9/C,KAAK,CAACy4D,QAAhC;AACA,YAAIC,UAAU,GAAG14D,KAAK,CAACy4D,QAAN,GAAiBV,QAAjB,GAA4BD,OAA7C;AACA,YAAIjsC,GAAG,GAAG6sC,UAAU,CAACxwC,MAAD,EAASswC,QAAT,EAAmBv0D,IAAnB,CAApB;AACA4nB,QAAAA,GAAG,CAACjgC,IAAJ,CAAS,UAAU+B,KAAV,EAAiB;AACxBu6B,UAAAA,MAAM,CAACa,SAAP,CAAiB6C,MAAjB,CAAwBj+B,KAAxB;AACD,SAFD;AAGD,OATD;AAUD;AACF,GApBD;;AAsBA,MAAIgrE,QAAQ,GAAG,UAAU5vC,SAAV,EAAqBgQ,IAArB,EAA2B;AACxC,WAAO;AACLhQ,MAAAA,SAAS,EAAEA,SADN;AAELgQ,MAAAA,IAAI,EAAEA;AAFD,KAAP;AAID,GALD;;AAMA,MAAI6/B,QAAQ,GAAG;AAAEzpD,IAAAA,MAAM,EAAEwpD;AAAV,GAAf;;AAEA,MAAIE,QAAQ,GAAG,UAAU5lE,KAAV,EAAiBy8D,OAAjB,EAA0BxkD,MAA1B,EAAkCykD,OAAlC,EAA2C;AACxD,WAAO;AACL18D,MAAAA,KAAK,EAAEo9D,IAAI,CAACrlC,EAAL,CAAQ/3B,KAAR,EAAey8D,OAAf,CADF;AAELxkD,MAAAA,MAAM,EAAEmlD,IAAI,CAACrlC,EAAL,CAAQ9f,MAAR,EAAgBykD,OAAhB;AAFH,KAAP;AAID,GALD;;AAMA,MAAImJ,KAAK,GAAG;AAAE3pD,IAAAA,MAAM,EAAE0pD;AAAV,GAAZ;;AAEA,MAAIE,cAAc,GAAG,UAAU9/C,GAAV,EAAe8P,SAAf,EAA0B;AAC7C,QAAI8C,GAAG,GAAGqnC,UAAU,CAACj6C,GAAD,EAAM8P,SAAN,CAApB;AACA,WAAO6mC,QAAQ,CAACzgD,MAAT,CAAgBtW,YAAY,CAACZ,OAAb,CAAqB4zB,GAAG,CAAC+kC,cAAzB,CAAhB,EAA0D/kC,GAAG,CAAC2mC,WAA9D,EAA2E35D,YAAY,CAACZ,OAAb,CAAqB4zB,GAAG,CAAC4mC,YAAzB,CAA3E,EAAmH5mC,GAAG,CAAC6mC,SAAvH,CAAP;AACD,GAHD;;AAIA,MAAIsG,SAAS,GAAGF,KAAK,CAAC3pD,MAAtB;;AAEA,MAAIw4B,IAAI,GAAG,UAAU32B,SAAV,EAAqBvS,MAArB,EAA6BxL,KAA7B,EAAoCy8D,OAApC,EAA6CxkD,MAA7C,EAAqDykD,OAArD,EAA8DsJ,WAA9D,EAA2E;AACpF,QAAI,EAAEt/D,IAAI,CAAC1G,KAAD,EAAQiY,MAAR,CAAJ,IAAuBwkD,OAAO,KAAKC,OAArC,CAAJ,EAAmD;AACjD,aAAO/tD,SAAS,CAAC3O,KAAD,EAAQ,OAAR,EAAiBwL,MAAjB,CAAT,CAAkC5S,IAAlC,CAAuC,UAAUW,CAAV,EAAa;AACzD,eAAOoV,SAAS,CAACsJ,MAAD,EAAS,OAAT,EAAkBzM,MAAlB,CAAT,CAAmC5S,IAAnC,CAAwC,UAAU5B,CAAV,EAAa;AAC1D,iBAAOivE,QAAQ,CAACloD,SAAD,EAAYvS,MAAZ,EAAoBjS,CAApB,EAAuBvC,CAAvB,EAA0BgvE,WAA1B,CAAf;AACD,SAFM,CAAP;AAGD,OAJM,CAAP;AAKD,KAND,MAMO;AACL,aAAOpsE,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,GAVD;;AAWA,MAAI2uE,QAAQ,GAAG,UAAUloD,SAAV,EAAqBvS,MAArB,EAA6BxL,KAA7B,EAAoCiY,MAApC,EAA4C+tD,WAA5C,EAAyD;AACtE,QAAI,CAACt/D,IAAI,CAAC1G,KAAD,EAAQiY,MAAR,CAAT,EAA0B;AACxB,aAAO+F,QAAQ,CAAChe,KAAD,EAAQiY,MAAR,EAAgBzM,MAAhB,CAAR,CAAgC5S,IAAhC,CAAqC,UAAUstE,OAAV,EAAmB;AAC7D,YAAI/nD,KAAK,GAAG+nD,OAAO,CAAC/nD,KAAR,CAAchmB,KAAd,CAAoB,EAApB,CAAZ;;AACA,YAAIgmB,KAAK,CAACjoB,MAAN,GAAe,CAAnB,EAAsB;AACpB8vE,UAAAA,WAAW,CAACjoD,SAAD,EAAYI,KAAZ,EAAmB+nD,OAAO,CAAClmE,KAA3B,EAAkCkmE,OAAO,CAACjuD,MAA1C,CAAX;AACA,iBAAOre,QAAQ,CAACR,IAAT,CAAcusE,QAAQ,CAACzpD,MAAT,CAAgBtiB,QAAQ,CAACR,IAAT,CAAc2sE,SAAS,CAAC/lE,KAAD,EAAQ,CAAR,EAAWA,KAAX,EAAkBwyB,MAAM,CAACxyB,KAAD,CAAxB,CAAvB,CAAhB,EAA0E,IAA1E,CAAd,CAAP;AACD,SAHD,MAGO;AACL,iBAAOpG,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,OARM,CAAP;AASD,KAVD,MAUO;AACL,aAAOsC,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,GAdD;;AAeA,MAAIwsC,MAAM,GAAG,UAAUn7B,IAAV,EAAgBC,OAAhB,EAAyBmV,SAAzB,EAAoC8Y,QAApC,EAA8CsvC,WAA9C,EAA2D;AACtE,QAAIC,eAAe,GAAG,UAAUC,OAAV,EAAmB;AACvCF,MAAAA,WAAW,CAACG,iBAAZ,CAA8BvoD,SAA9B;AACAooD,MAAAA,WAAW,CAACH,WAAZ,CAAwBjoD,SAAxB,EAAmCsoD,OAAO,CAACloD,KAA3C,EAAkDkoD,OAAO,CAACrmE,KAA1D,EAAiEqmE,OAAO,CAACpuD,MAAzE;AACA,aAAOouD,OAAO,CAACloD,KAAf;AACD,KAJD;;AAKA,WAAOiB,cAAc,CAACyX,QAAD,EAAWluB,IAAX,EAAiBC,OAAjB,EAA0Bu9D,WAAW,CAAClnD,qBAAtC,EAA6DknD,WAAW,CAACrnD,oBAAzE,CAAd,CAA6GpmB,GAA7G,CAAiH0tE,eAAjH,CAAP;AACD,GAPD;;AASA,MAAIG,QAAQ,GAAG,UAAU/xD,IAAV,EAAgBuvB,IAAhB,EAAsB;AACnC,WAAO;AACLvvB,MAAAA,IAAI,EAAEA,IADD;AAELuvB,MAAAA,IAAI,EAAEA;AAFD,KAAP;AAID,GALD;;AAMA,MAAIyiC,SAAS,GAAG,UAAUlqD,QAAV,EAAoB9H,IAApB,EAA0BiyD,UAA1B,EAAsCC,UAAtC,EAAkD;AAChE,QAAIA,UAAU,KAAK,KAAK,CAAxB,EAA2B;AACzBA,MAAAA,UAAU,GAAGC,QAAb;AACD;;AACD,WAAOrqD,QAAQ,CAACzM,QAAT,GAAoBxE,MAApB,CAA2BmJ,IAA3B,EAAiC9b,GAAjC,CAAqC,UAAU6D,CAAV,EAAa;AACvD,aAAOgqE,QAAQ,CAAChqE,CAAD,EAAImqE,UAAJ,CAAf;AACD,KAFM,CAAP;AAGD,GAPD;;AAQA,MAAIC,QAAQ,GAAG,UAAUrqD,QAAV,EAAoB9H,IAApB,EAA0Bqa,SAA1B,EAAqC63C,UAArC,EAAiD;AAC9D,QAAIA,UAAU,KAAK,KAAK,CAAxB,EAA2B;AACzBA,MAAAA,UAAU,GAAGE,OAAb;AACD;;AACD,WAAO/3C,SAAS,CAACrV,OAAV,CAAkB8C,QAAlB,EAA4B9H,IAA5B,EAAkC9b,GAAlC,CAAsC,UAAU6D,CAAV,EAAa;AACxD,aAAOgqE,QAAQ,CAAChqE,CAAD,EAAImqE,UAAJ,CAAf;AACD,KAFM,CAAP;AAGD,GAPD;;AAQA,MAAIE,OAAO,GAAG,UAAUtqD,QAAV,EAAoB9H,IAApB,EAA0Bqa,SAA1B,EAAqC63C,UAArC,EAAiD;AAC7D,QAAIA,UAAU,KAAK,KAAK,CAAxB,EAA2B;AACzBA,MAAAA,UAAU,GAAGE,OAAb;AACD;;AACD,QAAI56D,QAAQ,GAAGsQ,QAAQ,CAACzM,QAAT,GAAoB7D,QAApB,CAA6BwI,IAA7B,CAAf;AACA,QAAI5G,MAAM,GAAGihB,SAAS,CAAChW,KAAV,CAAgB7M,QAAhB,CAAb;AACA,WAAO4B,MAAM,CAAClV,GAAP,CAAW,UAAUkC,CAAV,EAAa;AAC7B,aAAO2rE,QAAQ,CAAC3rE,CAAD,EAAI8rE,UAAJ,CAAf;AACD,KAFM,CAAP;AAGD,GATD;;AAUA,MAAIG,UAAU,GAAG,CACf;AACEpnE,IAAAA,OAAO,EAAE+mE,SADX;AAEE5hD,IAAAA,IAAI,EAAE+hD,QAFR;AAGE11D,IAAAA,QAAQ,EAAErX,QAAQ,CAACtC,IAAT;AAHZ,GADe,EAMf;AACEmI,IAAAA,OAAO,EAAEknE,QADX;AAEE/hD,IAAAA,IAAI,EAAEgiD,OAFR;AAGE31D,IAAAA,QAAQ,EAAErX,QAAQ,CAACR,IAAT,CAAcotE,SAAd;AAHZ,GANe,EAWf;AACE/mE,IAAAA,OAAO,EAAEmnE,OADX;AAEEhiD,IAAAA,IAAI,EAAEgiD,OAFR;AAGE31D,IAAAA,QAAQ,EAAErX,QAAQ,CAACR,IAAT,CAAcutE,QAAd;AAHZ,GAXe,CAAjB;;AAiBA,MAAIG,IAAI,GAAG,UAAUxqD,QAAV,EAAoB9H,IAApB,EAA0BuvB,IAA1B,EAAgClV,SAAhC,EAA2Ck4C,KAA3C,EAAkD;AAC3D,QAAIA,KAAK,KAAK,KAAK,CAAnB,EAAsB;AACpBA,MAAAA,KAAK,GAAGF,UAAR;AACD;;AACD,QAAIG,OAAO,GAAGzrE,IAAI,CAACwrE,KAAD,EAAQ,UAAUE,IAAV,EAAgB;AACxC,aAAOA,IAAI,CAACxnE,OAAL,KAAiBskC,IAAxB;AACD,KAFiB,CAAlB;AAGA,WAAOijC,OAAO,CAACpuE,IAAR,CAAa,UAAUsuE,IAAV,EAAgB;AAClC,aAAOA,IAAI,CAACznE,OAAL,CAAa6c,QAAb,EAAuB9H,IAAvB,EAA6Bqa,SAA7B,EAAwCq4C,IAAI,CAACtiD,IAA7C,EAAmDnsB,OAAnD,CAA2D,YAAY;AAC5E,eAAOyuE,IAAI,CAACj2D,QAAL,CAAcrY,IAAd,CAAmB,UAAU9C,EAAV,EAAc;AACtC,iBAAOgxE,IAAI,CAACxqD,QAAD,EAAW9H,IAAX,EAAiB1e,EAAjB,EAAqB+4B,SAArB,CAAX;AACD,SAFM,CAAP;AAGD,OAJM,CAAP;AAKD,KANM,CAAP;AAOD,GAdD;;AAgBA,MAAIpJ,IAAI,GAAG,YAAY;AACrB,QAAIjM,OAAO,GAAG,UAAU8C,QAAV,EAAoB9H,IAApB,EAA0B;AACtC,aAAO8H,QAAQ,CAACnZ,KAAT,GAAiB0I,WAAjB,CAA6B2I,IAA7B,CAAP;AACD,KAFD;;AAGA,QAAIqE,KAAK,GAAG,UAAU7M,QAAV,EAAoB;AAC9B,aAAOA,QAAQ,CAAC9V,MAAT,GAAkB,CAAlB,GAAsB0D,QAAQ,CAACR,IAAT,CAAc4S,QAAQ,CAACA,QAAQ,CAAC9V,MAAT,GAAkB,CAAnB,CAAtB,CAAtB,GAAqE0D,QAAQ,CAACtC,IAAT,EAA5E;AACD,KAFD;;AAGA,WAAO;AACLkiB,MAAAA,OAAO,EAAEA,OADJ;AAELX,MAAAA,KAAK,EAAEA;AAFF,KAAP;AAID,GAXD;;AAYA,MAAIogB,KAAK,GAAG,YAAY;AACtB,QAAIzf,OAAO,GAAG,UAAU8C,QAAV,EAAoB9H,IAApB,EAA0B;AACtC,aAAO8H,QAAQ,CAACnZ,KAAT,GAAiB4I,WAAjB,CAA6ByI,IAA7B,CAAP;AACD,KAFD;;AAGA,QAAIqE,KAAK,GAAG,UAAU7M,QAAV,EAAoB;AAC9B,aAAOA,QAAQ,CAAC9V,MAAT,GAAkB,CAAlB,GAAsB0D,QAAQ,CAACR,IAAT,CAAc4S,QAAQ,CAAC,CAAD,CAAtB,CAAtB,GAAmDpS,QAAQ,CAACtC,IAAT,EAA1D;AACD,KAFD;;AAGA,WAAO;AACLkiB,MAAAA,OAAO,EAAEA,OADJ;AAELX,MAAAA,KAAK,EAAEA;AAFF,KAAP;AAID,GAXD;;AAYA,MAAIsuD,OAAO,GAAG;AACZ1hD,IAAAA,IAAI,EAAEA,IADM;AAEZwT,IAAAA,KAAK,EAAEA;AAFK,GAAd;;AAKA,MAAImuC,IAAI,GAAG,UAAU9qD,QAAV,EAAoB9H,IAApB,EAA0B/G,SAA1B,EAAqCs2B,IAArC,EAA2ClV,SAA3C,EAAsDrjB,MAAtD,EAA8D;AACvE,QAAIoZ,IAAI,GAAGkiD,IAAI,CAACxqD,QAAD,EAAW9H,IAAX,EAAiBuvB,IAAjB,EAAuBlV,SAAvB,CAAf;AACA,WAAOjK,IAAI,CAAChsB,IAAL,CAAU,UAAUf,CAAV,EAAa;AAC5B,UAAI2T,MAAM,CAAC3T,CAAC,CAAC2c,IAAH,CAAV,EAAoB;AAClB,eAAO5a,QAAQ,CAACtC,IAAT,EAAP;AACD,OAFD,MAEO;AACL,eAAOmW,SAAS,CAAC5V,CAAC,CAAC2c,IAAH,CAAT,GAAoB5a,QAAQ,CAACR,IAAT,CAAcvB,CAAC,CAAC2c,IAAhB,CAApB,GAA4C4yD,IAAI,CAAC9qD,QAAD,EAAWzkB,CAAC,CAAC2c,IAAb,EAAmB/G,SAAnB,EAA8B5V,CAAC,CAACksC,IAAhC,EAAsClV,SAAtC,EAAiDrjB,MAAjD,CAAvD;AACD;AACF,KANM,CAAP;AAOD,GATD;;AAUA,MAAI67D,MAAM,GAAG,UAAU/qD,QAAV,EAAoB9H,IAApB,EAA0B/G,SAA1B,EAAqCjC,MAArC,EAA6C;AACxD,WAAO47D,IAAI,CAAC9qD,QAAD,EAAW9H,IAAX,EAAiB/G,SAAjB,EAA4Bk5D,QAA5B,EAAsCQ,OAAO,CAAC1hD,IAAR,EAAtC,EAAsDja,MAAtD,CAAX;AACD,GAFD;;AAGA,MAAI87D,OAAO,GAAG,UAAUhrD,QAAV,EAAoB9H,IAApB,EAA0B/G,SAA1B,EAAqCjC,MAArC,EAA6C;AACzD,WAAO47D,IAAI,CAAC9qD,QAAD,EAAW9H,IAAX,EAAiB/G,SAAjB,EAA4Bk5D,QAA5B,EAAsCQ,OAAO,CAACluC,KAAR,EAAtC,EAAuDztB,MAAvD,CAAX;AACD,GAFD;;AAIA,MAAI+7D,MAAM,GAAG,UAAUjrD,QAAV,EAAoB;AAC/B,WAAO,UAAUzW,OAAV,EAAmB;AACxB,aAAOyW,QAAQ,CAACzM,QAAT,GAAoB7D,QAApB,CAA6BnG,OAA7B,EAAsC3P,MAAtC,KAAiD,CAAxD;AACD,KAFD;AAGD,GAJD;;AAKA,MAAIsxE,QAAQ,GAAG,UAAUlrD,QAAV,EAAoB9H,IAApB,EAA0BhJ,MAA1B,EAAkC;AAC/C,WAAOi8D,QAAQ,CAACnrD,QAAD,EAAW9H,IAAX,EAAiB+yD,MAAM,CAACjrD,QAAD,CAAvB,EAAmC9Q,MAAnC,CAAf;AACD,GAFD;;AAGA,MAAIk8D,OAAO,GAAG,UAAUprD,QAAV,EAAoB9H,IAApB,EAA0BhJ,MAA1B,EAAkC;AAC9C,WAAOm8D,SAAS,CAACrrD,QAAD,EAAW9H,IAAX,EAAiB+yD,MAAM,CAACjrD,QAAD,CAAvB,EAAmC9Q,MAAnC,CAAhB;AACD,GAFD;;AAGA,MAAIi8D,QAAQ,GAAGJ,MAAf;AACA,MAAIM,SAAS,GAAGL,OAAhB;AAEA,MAAIM,UAAU,GAAG5sD,WAAW,EAA5B;;AACA,MAAI6sD,QAAQ,GAAG,UAAUhiE,OAAV,EAAmB2F,MAAnB,EAA2B;AACxC,WAAOg8D,QAAQ,CAACI,UAAD,EAAa/hE,OAAb,EAAsB2F,MAAtB,CAAf;AACD,GAFD;;AAGA,MAAIs8D,OAAO,GAAG,UAAUjiE,OAAV,EAAmB2F,MAAnB,EAA2B;AACvC,WAAOk8D,OAAO,CAACE,UAAD,EAAa/hE,OAAb,EAAsB2F,MAAtB,CAAd;AACD,GAFD;;AAGA,MAAIu8D,UAAU,GAAG,UAAUliE,OAAV,EAAmB4H,SAAnB,EAA8BjC,MAA9B,EAAsC;AACrD,WAAOi8D,QAAQ,CAACG,UAAD,EAAa/hE,OAAb,EAAsB4H,SAAtB,EAAiCjC,MAAjC,CAAf;AACD,GAFD;;AAGA,MAAIw8D,WAAW,GAAG,UAAUniE,OAAV,EAAmB4H,SAAnB,EAA8BjC,MAA9B,EAAsC;AACtD,WAAOm8D,SAAS,CAACC,UAAD,EAAa/hE,OAAb,EAAsB4H,SAAtB,EAAiCjC,MAAjC,CAAhB;AACD,GAFD;;AAIA,MAAIy8D,UAAU,GAAG,UAAU3jE,KAAV,EAAiBmJ,SAAjB,EAA4BjC,MAA5B,EAAoC;AACnD,WAAOyC,QAAQ,CAAC3J,KAAD,EAAQmJ,SAAR,EAAmBjC,MAAnB,CAAR,CAAmCtT,MAAnC,EAAP;AACD,GAFD;;AAIA,MAAIgwE,KAAK,GAAGrnD,GAAG,CAAC7L,QAAJ,CAAa,CACvB;AAAE1d,IAAAA,IAAI,EAAE,CAAC,SAAD;AAAR,GADuB,EAEvB;AAAE6wE,IAAAA,OAAO,EAAE;AAAX,GAFuB,EAGvB;AAAEC,IAAAA,QAAQ,EAAE,CAAC,MAAD;AAAZ,GAHuB,EAIvB;AAAEC,IAAAA,UAAU,EAAE,CAAC,MAAD;AAAd,GAJuB,CAAb,CAAZ;;AAMA,MAAIC,aAAa,GAAG,UAAUC,MAAV,EAAkBx1D,MAAlB,EAA0BC,KAA1B,EAAiC;AACnD,QAAIw1D,YAAY,GAAGD,MAAM,CAACE,OAAP,CAAe11D,MAAf,CAAnB;AACA,QAAI21D,WAAW,GAAGH,MAAM,CAACE,OAAP,CAAez1D,KAAf,CAAlB;AACA,WAAO01D,WAAW,CAACzvC,KAAZ,GAAoBuvC,YAAY,CAAC/iD,IAAjC,IAAyCijD,WAAW,CAACjjD,IAAZ,GAAmB+iD,YAAY,CAACvvC,KAAhF;AACD,GAJD;;AAKA,MAAI0vC,KAAK,GAAG,UAAU3iE,IAAV,EAAgB;AAC1B,WAAO2I,SAAS,CAAC3I,IAAD,EAAO,IAAP,CAAhB;AACD,GAFD;;AAGA,MAAI4iE,MAAM,GAAG,UAAUL,MAAV,EAAkBx1D,MAAlB,EAA0B81D,YAA1B,EAAwC71D,KAAxC,EAA+C81D,WAA/C,EAA4DC,OAA5D,EAAqEv9D,MAArE,EAA6E;AACxF,WAAOmD,SAAS,CAACqE,KAAD,EAAQ,OAAR,EAAiBxH,MAAjB,CAAT,CAAkC5S,IAAlC,CAAuC,UAAUowE,SAAV,EAAqB;AACjE,aAAOr6D,SAAS,CAACoE,MAAD,EAAS,OAAT,EAAkBvH,MAAlB,CAAT,CAAmC9S,GAAnC,CAAuC,UAAUuwE,UAAV,EAAsB;AAClE,YAAI,CAACviE,IAAI,CAACsiE,SAAD,EAAYC,UAAZ,CAAT,EAAkC;AAChC,iBAAOtrD,WAAW,CAACgrD,KAAD,EAAQ,CACxBK,SADwB,EAExBC,UAFwB,CAAR,CAAX,CAGJlxE,IAHI,CAGC,YAAY;AAClB,mBAAOuwE,aAAa,CAACC,MAAD,EAASU,UAAT,EAAqBD,SAArB,CAAb,GAA+Cd,KAAK,CAACC,OAAN,EAA/C,GAAiEY,OAAO,CAACE,UAAD,CAA/E;AACD,WALM,EAKJ,UAAUC,UAAV,EAAsB;AACvB,mBAAOH,OAAO,CAACE,UAAD,CAAd;AACD,WAPM,CAAP;AAQD,SATD,MASO;AACL,iBAAOviE,IAAI,CAACsM,KAAD,EAAQg2D,SAAR,CAAJ,IAA0Bx2C,MAAM,CAACw2C,SAAD,CAAN,KAAsBF,WAAhD,GAA8DC,OAAO,CAACE,UAAD,CAArE,GAAoFf,KAAK,CAAC5wE,IAAN,CAAW,cAAX,CAA3F;AACD;AACF,OAbM,CAAP;AAcD,KAfM,EAeJa,KAfI,CAeE+vE,KAAK,CAAC5wE,IAAN,CAAW,SAAX,CAfF,CAAP;AAgBD,GAjBD;;AAkBA,MAAI6xE,MAAM,GAAG,UAAUjoD,OAAV,EAAmBC,MAAnB,EAA2BioD,SAA3B,EAAsCC,UAAtC,EAAkDC,YAAlD,EAAgE;AAC3E,WAAOpoD,OAAO,CAACnpB,IAAR,CAAaopB,MAAb,EAAqBioD,SAArB,EAAgCC,UAAhC,EAA4CC,YAA5C,CAAP;AACD,GAFD;;AAGA,MAAIC,WAAW,GAAGntE,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK8rE,KAAL,CAAT,EAAsB;AAC9CU,IAAAA,MAAM,EAAEA,MADsC;AAE9C3nD,IAAAA,IAAI,EAAEkoD;AAFwC,GAAtB,CAA1B;;AAKA,MAAIK,QAAQ,GAAG,UAAUn+D,MAAV,EAAkBW,QAAlB,EAA4BnG,OAA5B,EAAqCqG,KAArC,EAA4C;AACzD,WAAO;AACLb,MAAAA,MAAM,EAAEA,MADH;AAELW,MAAAA,QAAQ,EAAEA,QAFL;AAGLnG,MAAAA,OAAO,EAAEA,OAHJ;AAILqG,MAAAA,KAAK,EAAEA;AAJF,KAAP;AAMD,GAPD;;AAQA,MAAIu9D,aAAa,GAAG,UAAU5jE,OAAV,EAAmB;AACrC,WAAOwF,MAAM,CAACxF,OAAD,CAAN,CAAgBjN,IAAhB,CAAqB,UAAUyS,MAAV,EAAkB;AAC5C,UAAIqC,UAAU,GAAG1B,QAAQ,CAACX,MAAD,CAAzB;AACA,aAAOrR,OAAO,CAAC0T,UAAD,EAAa7H,OAAb,CAAP,CAA6BnN,GAA7B,CAAiC,UAAUwT,KAAV,EAAiB;AACvD,eAAOs9D,QAAQ,CAACn+D,MAAD,EAASqC,UAAT,EAAqB7H,OAArB,EAA8BqG,KAA9B,CAAf;AACD,OAFM,CAAP;AAGD,KALM,CAAP;AAMD,GAPD;;AAQA,MAAIlS,OAAO,GAAG,UAAUggB,QAAV,EAAoBnU,OAApB,EAA6B;AACzC,WAAOrK,SAAS,CAACwe,QAAD,EAAWvjB,KAAK,CAACiQ,IAAD,EAAOb,OAAP,CAAhB,CAAhB;AACD,GAFD;;AAIA,MAAIi7C,IAAI,GAAG,UAAU96C,IAAV,EAAgB;AACzB,WAAOvR,IAAI,CAACuR,IAAD,CAAJ,KAAe,IAAtB;AACD,GAFD;;AAGA,MAAI0jE,QAAQ,GAAG,UAAUC,IAAV,EAAgBC,MAAhB,EAAwBp+D,MAAxB,EAAgC;AAC7C,WAAOo+D,MAAM,CAACD,IAAD,EAAOn+D,MAAP,CAAN,CAAqB5S,IAArB,CAA0B,UAAU+H,MAAV,EAAkB;AACjD,aAAOgK,MAAM,CAAChK,MAAD,CAAN,IAAkBka,KAAK,CAACla,MAAD,CAAL,CAAcJ,IAAd,GAAqBrK,MAArB,KAAgC,CAAlD,GAAsDwzE,QAAQ,CAAC/oE,MAAD,EAASipE,MAAT,EAAiBp+D,MAAjB,CAA9D,GAAyF5R,QAAQ,CAACR,IAAT,CAAcuH,MAAd,CAAhG;AACD,KAFM,CAAP;AAGD,GAJD;;AAKA,MAAIkpE,QAAQ,GAAG,UAAUr+D,MAAV,EAAkB3F,OAAlB,EAA2BgpB,SAA3B,EAAsC;AACnD,WAAOA,SAAS,CAAC03C,QAAV,CAAmB1gE,OAAnB,EAA4BpN,OAA5B,CAAoC,YAAY;AACrD,aAAOixE,QAAQ,CAAC7jE,OAAD,EAAUgpB,SAAS,CAAC+6C,MAApB,EAA4Bp+D,MAA5B,CAAf;AACD,KAFM,EAEJ9S,GAFI,CAEAm2B,SAAS,CAACrG,QAFV,CAAP;AAGD,GAJD;;AAKA,MAAIshD,MAAM,GAAG,UAAUjkE,OAAV,EAAmBu+B,MAAnB,EAA2B;AACtC,WAAOn4B,KAAK,CAACpG,OAAD,EAAUu+B,MAAV,CAAL,CAAuBrrC,MAAvB,CAA8B+nD,IAA9B,EAAoCroD,OAApC,CAA4C,YAAY;AAC7D,aAAOwT,KAAK,CAACpG,OAAD,EAAUu+B,MAAM,GAAG,CAAnB,CAAL,CAA2BrrC,MAA3B,CAAkC+nD,IAAlC,CAAP;AACD,KAFM,CAAP;AAGD,GAJD;;AAKA,MAAIipB,YAAY,GAAG,UAAUv+D,MAAV,EAAkB3F,OAAlB,EAA2Bu+B,MAA3B,EAAmCvV,SAAnC,EAA8C;AAC/D,WAAOi7C,MAAM,CAACjkE,OAAD,EAAUu+B,MAAV,CAAN,CAAwBxrC,IAAxB,CAA6B,UAAUoxE,EAAV,EAAc;AAChD,aAAOn7C,SAAS,CAAC03C,QAAV,CAAmByD,EAAnB,EAAuBjyE,IAAvB,CAA4B,YAAY;AAC7C,eAAO2xE,QAAQ,CAACM,EAAD,EAAKn7C,SAAS,CAAC+6C,MAAf,EAAuBp+D,MAAvB,CAAR,CAAuC9S,GAAvC,CAA2Cm2B,SAAS,CAACrG,QAArD,CAAP;AACD,OAFM,EAEJ,UAAUyhD,QAAV,EAAoB;AACrB,eAAOR,aAAa,CAACQ,QAAD,CAAb,CAAwBvxE,GAAxB,CAA4B,UAAU4I,IAAV,EAAgB;AACjD,iBAAO87D,IAAI,CAACrlC,EAAL,CAAQz2B,IAAI,CAAC+J,MAAb,EAAqB/J,IAAI,CAAC4K,KAA1B,CAAP;AACD,SAFM,CAAP;AAGD,OANM,CAAP;AAOD,KARM,CAAP;AASD,GAVD;;AAWA,MAAIg+D,KAAK,GAAG,UAAU1+D,MAAV,EAAkB3F,OAAlB,EAA2Bu+B,MAA3B,EAAmCvV,SAAnC,EAA8C;AACxD,QAAIluB,MAAM,GAAGmgD,IAAI,CAACj7C,OAAD,CAAJ,GAAgBgkE,QAAQ,CAACr+D,MAAD,EAAS3F,OAAT,EAAkBgpB,SAAlB,CAAxB,GAAuDk7C,YAAY,CAACv+D,MAAD,EAAS3F,OAAT,EAAkBu+B,MAAlB,EAA0BvV,SAA1B,CAAhF;AACA,WAAOluB,MAAM,CAACjI,GAAP,CAAW,UAAUyxE,GAAV,EAAe;AAC/B,aAAO;AACLnqE,QAAAA,KAAK,EAAEmqE,GADF;AAELlyD,QAAAA,MAAM,EAAEkyD;AAFH,OAAP;AAID,KALM,CAAP;AAMD,GARD;;AASA,MAAIC,OAAO,GAAG,UAAUC,QAAV,EAAoB;AAChC,WAAOd,WAAW,CAACtoD,IAAZ,CAAiBopD,QAAjB,EAA2B,UAAUC,QAAV,EAAoB;AACpD,aAAO1wE,QAAQ,CAACtC,IAAT,EAAP;AACD,KAFM,EAEJ,YAAY;AACb,aAAOsC,QAAQ,CAACtC,IAAT,EAAP;AACD,KAJM,EAIJ,UAAU0Z,IAAV,EAAgB;AACjB,aAAOpX,QAAQ,CAACR,IAAT,CAAci6C,KAAK,CAACriC,IAAD,EAAO,CAAP,CAAnB,CAAP;AACD,KANM,EAMJ,UAAUA,IAAV,EAAgB;AACjB,aAAOpX,QAAQ,CAACR,IAAT,CAAci6C,KAAK,CAACriC,IAAD,EAAOwhB,MAAM,CAACxhB,IAAD,CAAb,CAAnB,CAAP;AACD,KARM,CAAP;AASD,GAVD;;AAYA,MAAIu5D,QAAQ,GAAG,UAAUC,KAAV,EAAiBpiD,MAAjB,EAAyB;AACtC,WAAO;AACL3C,MAAAA,IAAI,EAAE+kD,KAAK,CAAC/kD,IADP;AAELC,MAAAA,GAAG,EAAE8kD,KAAK,CAAC9kD,GAAN,GAAY0C,MAFZ;AAGL6Q,MAAAA,KAAK,EAAEuxC,KAAK,CAACvxC,KAHR;AAILgmC,MAAAA,MAAM,EAAEuL,KAAK,CAACvL,MAAN,GAAe72C;AAJlB,KAAP;AAMD,GAPD;;AAQA,MAAIqiD,MAAM,GAAG,UAAUD,KAAV,EAAiBpiD,MAAjB,EAAyB;AACpC,WAAO;AACL3C,MAAAA,IAAI,EAAE+kD,KAAK,CAAC/kD,IADP;AAELC,MAAAA,GAAG,EAAE8kD,KAAK,CAAC9kD,GAAN,GAAY0C,MAFZ;AAGL6Q,MAAAA,KAAK,EAAEuxC,KAAK,CAACvxC,KAHR;AAILgmC,MAAAA,MAAM,EAAEuL,KAAK,CAACvL,MAAN,GAAe72C;AAJlB,KAAP;AAMD,GAPD;;AAQA,MAAIzC,SAAS,GAAG,UAAU6kD,KAAV,EAAiBrhC,MAAjB,EAAyBC,MAAzB,EAAiC;AAC/C,WAAO;AACL3jB,MAAAA,IAAI,EAAE+kD,KAAK,CAAC/kD,IAAN,GAAa0jB,MADd;AAELzjB,MAAAA,GAAG,EAAE8kD,KAAK,CAAC9kD,GAAN,GAAY0jB,MAFZ;AAGLnQ,MAAAA,KAAK,EAAEuxC,KAAK,CAACvxC,KAAN,GAAckQ,MAHhB;AAIL81B,MAAAA,MAAM,EAAEuL,KAAK,CAACvL,MAAN,GAAe71B;AAJlB,KAAP;AAMD,GAPD;;AAQA,MAAIshC,QAAQ,GAAG,UAAUF,KAAV,EAAiB;AAC9B,WAAOA,KAAK,CAAC9kD,GAAb;AACD,GAFD;;AAGA,MAAIilD,SAAS,GAAG,UAAUH,KAAV,EAAiB;AAC/B,WAAOA,KAAK,CAACvL,MAAb;AACD,GAFD;;AAIA,MAAI2L,aAAa,GAAG,UAAUrC,MAAV,EAAkB1iE,OAAlB,EAA2Bu+B,MAA3B,EAAmC;AACrD,QAAIA,MAAM,IAAI,CAAV,IAAeA,MAAM,GAAG5R,MAAM,CAAC3sB,OAAD,CAAlC,EAA6C;AAC3C,aAAO0iE,MAAM,CAACsC,aAAP,CAAqBhlE,OAArB,EAA8Bu+B,MAA9B,EAAsCv+B,OAAtC,EAA+Cu+B,MAAM,GAAG,CAAxD,CAAP;AACD,KAFD,MAEO,IAAIA,MAAM,GAAG,CAAb,EAAgB;AACrB,aAAOmkC,MAAM,CAACsC,aAAP,CAAqBhlE,OAArB,EAA8Bu+B,MAAM,GAAG,CAAvC,EAA0Cv+B,OAA1C,EAAmDu+B,MAAnD,CAAP;AACD;;AACD,WAAOxqC,QAAQ,CAACtC,IAAT,EAAP;AACD,GAPD;;AAQA,MAAIwzE,OAAO,GAAG,UAAU9L,IAAV,EAAgB;AAC5B,WAAO;AACLv5C,MAAAA,IAAI,EAAEu5C,IAAI,CAACv5C,IADN;AAELC,MAAAA,GAAG,EAAEs5C,IAAI,CAACt5C,GAFL;AAGLuT,MAAAA,KAAK,EAAE+lC,IAAI,CAAC/lC,KAHP;AAILgmC,MAAAA,MAAM,EAAED,IAAI,CAACC;AAJR,KAAP;AAMD,GAPD;;AAQA,MAAI8L,UAAU,GAAG,UAAUxC,MAAV,EAAkB1iE,OAAlB,EAA2B;AAC1C,WAAOjM,QAAQ,CAACR,IAAT,CAAcmvE,MAAM,CAACE,OAAP,CAAe5iE,OAAf,CAAd,CAAP;AACD,GAFD;;AAGA,MAAImlE,QAAQ,GAAG,UAAUzC,MAAV,EAAkB1iE,OAAlB,EAA2Bu+B,MAA3B,EAAmC;AAChD,QAAI15B,SAAS,CAAC7E,OAAD,CAAb,EAAwB;AACtB,aAAOklE,UAAU,CAACxC,MAAD,EAAS1iE,OAAT,CAAV,CAA4BnN,GAA5B,CAAgCoyE,OAAhC,CAAP;AACD,KAFD,MAEO,IAAIngE,MAAM,CAAC9E,OAAD,CAAV,EAAqB;AAC1B,aAAO+kE,aAAa,CAACrC,MAAD,EAAS1iE,OAAT,EAAkBu+B,MAAlB,CAAb,CAAuC1rC,GAAvC,CAA2CoyE,OAA3C,CAAP;AACD,KAFM,MAEA;AACL,aAAOlxE,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,GARD;;AASA,MAAI2zE,YAAY,GAAG,UAAU1C,MAAV,EAAkB1iE,OAAlB,EAA2B;AAC5C,QAAI6E,SAAS,CAAC7E,OAAD,CAAb,EAAwB;AACtB,aAAOklE,UAAU,CAACxC,MAAD,EAAS1iE,OAAT,CAAV,CAA4BnN,GAA5B,CAAgCoyE,OAAhC,CAAP;AACD,KAFD,MAEO,IAAIngE,MAAM,CAAC9E,OAAD,CAAV,EAAqB;AAC1B,aAAO0iE,MAAM,CAACsC,aAAP,CAAqBhlE,OAArB,EAA8B,CAA9B,EAAiCA,OAAjC,EAA0C2sB,MAAM,CAAC3sB,OAAD,CAAhD,EAA2DnN,GAA3D,CAA+DoyE,OAA/D,CAAP;AACD,KAFM,MAEA;AACL,aAAOlxE,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,GARD;;AAUA,MAAI4zE,SAAS,GAAG,CAAhB;AACA,MAAIC,WAAW,GAAG,GAAlB;AACA,MAAIC,KAAK,GAAGvqD,GAAG,CAAC7L,QAAJ,CAAa,CACvB;AAAE1d,IAAAA,IAAI,EAAE;AAAR,GADuB,EAEvB;AAAE+zE,IAAAA,KAAK,EAAE,CAAC,OAAD;AAAT,GAFuB,CAAb,CAAZ;;AAIA,MAAIC,SAAS,GAAG,UAAUd,KAAV,EAAiBzrD,GAAjB,EAAsB;AACpC,WAAOyrD,KAAK,CAAC/kD,IAAN,GAAa1G,GAAG,CAAC0G,IAAjB,IAAyB3P,IAAI,CAACgP,GAAL,CAAS/F,GAAG,CAACka,KAAJ,GAAYuxC,KAAK,CAAC/kD,IAA3B,IAAmC,CAA5D,IAAiE+kD,KAAK,CAAC/kD,IAAN,GAAa1G,GAAG,CAACka,KAAzF;AACD,GAFD;;AAGA,MAAIsyC,cAAc,GAAG,UAAUhD,MAAV,EAAkB1iE,OAAlB,EAA2B2kE,KAA3B,EAAkC;AACrD,WAAOt8D,OAAO,CAACrI,OAAD,EAAU66C,SAAV,CAAP,CAA4B3oD,IAA5B,CAAiCX,KAAjC,EAAwC,UAAU4Z,IAAV,EAAgB;AAC7D,aAAOi6D,YAAY,CAAC1C,MAAD,EAASv3D,IAAT,CAAZ,CAA2BnY,MAA3B,CAAkC,UAAUkmB,GAAV,EAAe;AACtD,eAAOusD,SAAS,CAACd,KAAD,EAAQzrD,GAAR,CAAhB;AACD,OAFM,CAAP;AAGD,KAJM,CAAP;AAKD,GAND;;AAOA,MAAIysD,UAAU,GAAG,UAAUjD,MAAV,EAAkB1iE,OAAlB,EAA2B4lE,QAA3B,EAAqCzpD,QAArC,EAA+CwoD,KAA/C,EAAsD;AACrE,QAAIkB,UAAU,GAAGnB,QAAQ,CAACC,KAAD,EAAQU,SAAR,CAAzB;;AACA,QAAIp1D,IAAI,CAACgP,GAAL,CAAS2mD,QAAQ,CAACxM,MAAT,GAAkBj9C,QAAQ,CAACi9C,MAApC,IAA8C,CAAlD,EAAqD;AACnD,aAAOmM,KAAK,CAACC,KAAN,CAAYK,UAAZ,CAAP;AACD,KAFD,MAEO,IAAID,QAAQ,CAAC/lD,GAAT,GAAe8kD,KAAK,CAACvL,MAAzB,EAAiC;AACtC,aAAOmM,KAAK,CAACC,KAAN,CAAYK,UAAZ,CAAP;AACD,KAFM,MAEA,IAAID,QAAQ,CAAC/lD,GAAT,KAAiB8kD,KAAK,CAACvL,MAA3B,EAAmC;AACxC,aAAOmM,KAAK,CAACC,KAAN,CAAYd,QAAQ,CAACC,KAAD,EAAQ,CAAR,CAApB,CAAP;AACD,KAFM,MAEA;AACL,aAAOe,cAAc,CAAChD,MAAD,EAAS1iE,OAAT,EAAkB2kE,KAAlB,CAAd,GAAyCY,KAAK,CAACC,KAAN,CAAY1lD,SAAS,CAAC+lD,UAAD,EAAaR,SAAb,EAAwB,CAAxB,CAArB,CAAzC,GAA4FE,KAAK,CAAC9zE,IAAN,EAAnG;AACD;AACF,GAXD;;AAYA,MAAIq0E,QAAQ,GAAG,UAAUpD,MAAV,EAAkB1iE,OAAlB,EAA2B4lE,QAA3B,EAAqCzpD,QAArC,EAA+CwoD,KAA/C,EAAsD;AACnE,QAAIoB,WAAW,GAAGnB,MAAM,CAACD,KAAD,EAAQU,SAAR,CAAxB;;AACA,QAAIp1D,IAAI,CAACgP,GAAL,CAAS2mD,QAAQ,CAAC/lD,GAAT,GAAe1D,QAAQ,CAAC0D,GAAjC,IAAwC,CAA5C,EAA+C;AAC7C,aAAO0lD,KAAK,CAACC,KAAN,CAAYO,WAAZ,CAAP;AACD,KAFD,MAEO,IAAIH,QAAQ,CAACxM,MAAT,GAAkBuL,KAAK,CAAC9kD,GAA5B,EAAiC;AACtC,aAAO0lD,KAAK,CAACC,KAAN,CAAYO,WAAZ,CAAP;AACD,KAFM,MAEA,IAAIH,QAAQ,CAACxM,MAAT,KAAoBuL,KAAK,CAAC9kD,GAA9B,EAAmC;AACxC,aAAO0lD,KAAK,CAACC,KAAN,CAAYZ,MAAM,CAACD,KAAD,EAAQ,CAAR,CAAlB,CAAP;AACD,KAFM,MAEA;AACL,aAAOe,cAAc,CAAChD,MAAD,EAAS1iE,OAAT,EAAkB2kE,KAAlB,CAAd,GAAyCY,KAAK,CAACC,KAAN,CAAY1lD,SAAS,CAACimD,WAAD,EAAcV,SAAd,EAAyB,CAAzB,CAArB,CAAzC,GAA6FE,KAAK,CAAC9zE,IAAN,EAApG;AACD;AACF,GAXD;;AAYA,MAAIu0E,UAAU,GAAG;AACfx4B,IAAAA,KAAK,EAAEq3B,QADQ;AAEfoB,IAAAA,QAAQ,EAAEH,QAFK;AAGfrnC,IAAAA,IAAI,EAAEmmC,MAHS;AAIfb,IAAAA,MAAM,EAAE/B;AAJO,GAAjB;AAMA,MAAIkE,YAAY,GAAG;AACjB14B,IAAAA,KAAK,EAAEs3B,SADU;AAEjBmB,IAAAA,QAAQ,EAAEN,UAFO;AAGjBlnC,IAAAA,IAAI,EAAEimC,QAHW;AAIjBX,IAAAA,MAAM,EAAE9B;AAJS,GAAnB;;AAMA,MAAIkE,SAAS,GAAG,UAAUzD,MAAV,EAAkBp0E,CAAlB,EAAqBuR,CAArB,EAAwB;AACtC,WAAO6iE,MAAM,CAAC5iE,gBAAP,CAAwBxR,CAAxB,EAA2BuR,CAA3B,EAA8B3M,MAA9B,CAAqC,UAAU+Y,GAAV,EAAe;AACzD,aAAOrd,IAAI,CAACqd,GAAD,CAAJ,KAAc,OAArB;AACD,KAFM,EAEJ5Z,MAFI,EAAP;AAGD,GAJD;;AAKA,MAAI+zE,cAAc,GAAG,UAAU1D,MAAV,EAAkBrjC,QAAlB,EAA4BljB,QAA5B,EAAsCwoD,KAAtC,EAA6C0B,UAA7C,EAAyD;AAC5E,WAAOC,SAAS,CAAC5D,MAAD,EAASrjC,QAAT,EAAmBljB,QAAnB,EAA6BkjB,QAAQ,CAACZ,IAAT,CAAckmC,KAAd,EAAqBU,SAArB,CAA7B,EAA8DgB,UAA9D,CAAhB;AACD,GAFD;;AAGA,MAAIC,SAAS,GAAG,UAAU5D,MAAV,EAAkBrjC,QAAlB,EAA4BljB,QAA5B,EAAsCwoD,KAAtC,EAA6C0B,UAA7C,EAAyD;AACvE,QAAIA,UAAU,KAAK,CAAnB,EAAsB;AACpB,aAAOtyE,QAAQ,CAACR,IAAT,CAAcoxE,KAAd,CAAP;AACD;;AACD,QAAIwB,SAAS,CAACzD,MAAD,EAASiC,KAAK,CAAC/kD,IAAf,EAAqByf,QAAQ,CAACmO,KAAT,CAAem3B,KAAf,CAArB,CAAb,EAA0D;AACxD,aAAOyB,cAAc,CAAC1D,MAAD,EAASrjC,QAAT,EAAmBljB,QAAnB,EAA6BwoD,KAA7B,EAAoC0B,UAAU,GAAG,CAAjD,CAArB;AACD;;AACD,WAAO3D,MAAM,CAAC6D,cAAP,CAAsB5B,KAAK,CAAC/kD,IAA5B,EAAkCyf,QAAQ,CAACmO,KAAT,CAAem3B,KAAf,CAAlC,EAAyD5xE,IAAzD,CAA8D,UAAUyzE,KAAV,EAAiB;AACpF,aAAOA,KAAK,CAACrsE,KAAN,CAAYjI,IAAZ,CAAiB6B,QAAQ,CAACtC,IAA1B,EAAgC,UAAUuO,OAAV,EAAmB;AACxD,eAAOolE,YAAY,CAAC1C,MAAD,EAAS1iE,OAAT,CAAZ,CAA8BjN,IAA9B,CAAmC,UAAU6yE,QAAV,EAAoB;AAC5D,iBAAOvmC,QAAQ,CAAC4mC,QAAT,CAAkBvD,MAAlB,EAA0B1iE,OAA1B,EAAmC4lE,QAAnC,EAA6CzpD,QAA7C,EAAuDwoD,KAAvD,EAA8DzyE,IAA9D,CAAmE6B,QAAQ,CAACtC,IAA5E,EAAkF,UAAUg1E,QAAV,EAAoB;AAC3G,mBAAOH,SAAS,CAAC5D,MAAD,EAASrjC,QAAT,EAAmBljB,QAAnB,EAA6BsqD,QAA7B,EAAuCJ,UAAU,GAAG,CAApD,CAAhB;AACD,WAFM,CAAP;AAGD,SAJM,EAIJzzE,OAJI,CAII,YAAY;AACrB,iBAAOmB,QAAQ,CAACR,IAAT,CAAcoxE,KAAd,CAAP;AACD,SANM,CAAP;AAOD,OARM,EAQJ5wE,QAAQ,CAACtC,IARL,CAAP;AASD,KAVM,CAAP;AAWD,GAlBD;;AAmBA,MAAIi1E,SAAS,GAAG,UAAUhE,MAAV,EAAkBiC,KAAlB,EAAyB;AACvC,WAAOjC,MAAM,CAAC6D,cAAP,CAAsB5B,KAAK,CAAC/kD,IAA5B,EAAkC+kD,KAAK,CAACvL,MAAN,GAAeiM,SAAjD,CAAP;AACD,GAFD;;AAGA,MAAIsB,OAAO,GAAG,UAAUjE,MAAV,EAAkBiC,KAAlB,EAAyB;AACrC,WAAOjC,MAAM,CAAC6D,cAAP,CAAsB5B,KAAK,CAAC/kD,IAA5B,EAAkC+kD,KAAK,CAAC9kD,GAAN,GAAYwlD,SAA9C,CAAP;AACD,GAFD;;AAGA,MAAIuB,WAAW,GAAG,UAAUvnC,QAAV,EAAoBwnC,QAApB,EAA8BnE,MAA9B,EAAsC;AACtD,QAAIrjC,QAAQ,CAACmO,KAAT,CAAeq5B,QAAf,IAA2BnE,MAAM,CAACoE,cAAP,EAA/B,EAAwD;AACtD,aAAO/yE,QAAQ,CAACR,IAAT,CAAc8rC,QAAQ,CAACmO,KAAT,CAAeq5B,QAAf,IAA2BnE,MAAM,CAACoE,cAAP,EAAzC,CAAP;AACD,KAFD,MAEO,IAAIznC,QAAQ,CAACmO,KAAT,CAAeq5B,QAAf,IAA2B,CAA/B,EAAkC;AACvC,aAAO9yE,QAAQ,CAACR,IAAT,CAAc,CAAC8rC,QAAQ,CAACmO,KAAT,CAAeq5B,QAAf,CAAf,CAAP;AACD,KAFM,MAEA;AACL,aAAO9yE,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,GARD;;AASA,MAAI+zE,KAAK,GAAG,UAAUnmC,QAAV,EAAoBqjC,MAApB,EAA4BiC,KAA5B,EAAmC;AAC7C,QAAIoC,KAAK,GAAG1nC,QAAQ,CAACZ,IAAT,CAAckmC,KAAd,EAAqBU,SAArB,CAAZ;AACA,QAAIwB,QAAQ,GAAGP,SAAS,CAAC5D,MAAD,EAASrjC,QAAT,EAAmBslC,KAAnB,EAA0BoC,KAA1B,EAAiCzB,WAAjC,CAAT,CAAuDhzE,KAAvD,CAA6Dy0E,KAA7D,CAAf;AACA,WAAOH,WAAW,CAACvnC,QAAD,EAAWwnC,QAAX,EAAqBnE,MAArB,CAAX,CAAwCxwE,IAAxC,CAA6C,YAAY;AAC9D,aAAOwwE,MAAM,CAAC6D,cAAP,CAAsBM,QAAQ,CAACjnD,IAA/B,EAAqCyf,QAAQ,CAACmO,KAAT,CAAeq5B,QAAf,CAArC,CAAP;AACD,KAFM,EAEJ,UAAU/nD,KAAV,EAAiB;AAClB4jD,MAAAA,MAAM,CAACsE,QAAP,CAAgB,CAAhB,EAAmBloD,KAAnB;AACA,aAAO4jD,MAAM,CAAC6D,cAAP,CAAsBM,QAAQ,CAACjnD,IAA/B,EAAqCyf,QAAQ,CAACmO,KAAT,CAAeq5B,QAAf,IAA2B/nD,KAAhE,CAAP;AACD,KALM,CAAP;AAMD,GATD;;AAUA,MAAImoD,OAAO,GAAG;AACZC,IAAAA,KAAK,EAAEt2E,KAAK,CAAC40E,KAAD,EAAQQ,UAAR,CADA;AAEZmB,IAAAA,OAAO,EAAEv2E,KAAK,CAAC40E,KAAD,EAAQU,YAAR,CAFF;AAGZS,IAAAA,OAAO,EAAEA,OAHG;AAIZD,IAAAA,SAAS,EAAEA,SAJC;AAKZU,IAAAA,WAAW,EAAE12E,QAAQ,CAAC20E,SAAD;AALT,GAAd;AAQA,MAAIgC,WAAW,GAAG,EAAlB;;AACA,MAAIC,QAAQ,GAAG,UAAU5E,MAAV,EAAkB/8D,MAAlB,EAA0BqjB,SAA1B,EAAqC;AAClD,WAAO05C,MAAM,CAAC1F,YAAP,GAAsBjqE,IAAtB,CAA2B,UAAU4rE,GAAV,EAAe;AAC/C,aAAO0F,KAAK,CAAC1+D,MAAD,EAASg5D,GAAG,CAACvsD,MAAb,EAAqBusD,GAAG,CAAC9H,OAAzB,EAAkC7tC,SAAlC,CAAL,CAAkD92B,IAAlD,CAAuD,YAAY;AACxE,eAAO6B,QAAQ,CAACR,IAAT,CAAci6C,KAAK,CAACmxB,GAAG,CAACvsD,MAAL,EAAausD,GAAG,CAAC9H,OAAjB,CAAnB,CAAP;AACD,OAFM,EAEJ,UAAU0Q,WAAV,EAAuB;AACxB,YAAI1yE,KAAK,GAAG6tE,MAAM,CAAC8E,SAAP,CAAiBD,WAAjB,CAAZ;AACA,YAAI/C,QAAQ,GAAGd,WAAW,CAACX,MAAZ,CAAmBL,MAAnB,EAA2B/D,GAAG,CAACvsD,MAA/B,EAAuCusD,GAAG,CAAC9H,OAA3C,EAAoDhiE,KAAK,CAACud,MAA1D,EAAkEvd,KAAK,CAACgiE,OAAxE,EAAiF7tC,SAAS,CAACk6C,OAA3F,EAAoGv9D,MAApG,CAAf;AACA,eAAO4+D,OAAO,CAACC,QAAD,CAAd;AACD,OANM,CAAP;AAOD,KARM,CAAP;AASD,GAVD;;AAWA,MAAIiD,MAAM,GAAG,UAAU/E,MAAV,EAAkB/8D,MAAlB,EAA0B3F,OAA1B,EAAmCu+B,MAAnC,EAA2CvV,SAA3C,EAAsDq9C,UAAtD,EAAkE;AAC7E,QAAIA,UAAU,KAAK,CAAnB,EAAsB;AACpB,aAAOtyE,QAAQ,CAACtC,IAAT,EAAP;AACD;;AACD,WAAOi2E,SAAS,CAAChF,MAAD,EAAS/8D,MAAT,EAAiB3F,OAAjB,EAA0Bu+B,MAA1B,EAAkCvV,SAAlC,CAAT,CAAsDj2B,IAAtD,CAA2D,UAAU40E,KAAV,EAAiB;AACjF,UAAI9yE,KAAK,GAAG6tE,MAAM,CAAC8E,SAAP,CAAiBG,KAAjB,CAAZ;AACA,UAAInD,QAAQ,GAAGd,WAAW,CAACX,MAAZ,CAAmBL,MAAnB,EAA2B1iE,OAA3B,EAAoCu+B,MAApC,EAA4C1pC,KAAK,CAACud,MAAlD,EAA0Dvd,KAAK,CAACgiE,OAAhE,EAAyE7tC,SAAS,CAACk6C,OAAnF,EAA4Fv9D,MAA5F,CAAf;AACA,aAAO+9D,WAAW,CAACtoD,IAAZ,CAAiBopD,QAAjB,EAA2B,YAAY;AAC5C,eAAOzwE,QAAQ,CAACtC,IAAT,EAAP;AACD,OAFM,EAEJ,YAAY;AACb,eAAOsC,QAAQ,CAACR,IAAT,CAAco0E,KAAd,CAAP;AACD,OAJM,EAIJ,UAAUx8D,IAAV,EAAgB;AACjB,YAAItK,IAAI,CAACb,OAAD,EAAUmL,IAAV,CAAJ,IAAuBozB,MAAM,KAAK,CAAtC,EAAyC;AACvC,iBAAOqpC,QAAQ,CAAClF,MAAD,EAAS1iE,OAAT,EAAkBu+B,MAAlB,EAA0BqmC,MAA1B,EAAkC57C,SAAlC,CAAf;AACD,SAFD,MAEO;AACL,iBAAOy+C,MAAM,CAAC/E,MAAD,EAAS/8D,MAAT,EAAiBwF,IAAjB,EAAuB,CAAvB,EAA0B6d,SAA1B,EAAqCq9C,UAAU,GAAG,CAAlD,CAAb;AACD;AACF,OAVM,EAUJ,UAAUl7D,IAAV,EAAgB;AACjB,YAAItK,IAAI,CAACb,OAAD,EAAUmL,IAAV,CAAJ,IAAuBozB,MAAM,KAAK5R,MAAM,CAACxhB,IAAD,CAA5C,EAAoD;AAClD,iBAAOy8D,QAAQ,CAAClF,MAAD,EAAS1iE,OAAT,EAAkBu+B,MAAlB,EAA0BmmC,QAA1B,EAAoC17C,SAApC,CAAf;AACD,SAFD,MAEO;AACL,iBAAOy+C,MAAM,CAAC/E,MAAD,EAAS/8D,MAAT,EAAiBwF,IAAjB,EAAuBwhB,MAAM,CAACxhB,IAAD,CAA7B,EAAqC6d,SAArC,EAAgDq9C,UAAU,GAAG,CAA7D,CAAb;AACD;AACF,OAhBM,CAAP;AAiBD,KApBM,CAAP;AAqBD,GAzBD;;AA0BA,MAAIuB,QAAQ,GAAG,UAAUlF,MAAV,EAAkB1iE,OAAlB,EAA2Bu+B,MAA3B,EAAmCE,IAAnC,EAAyCzV,SAAzC,EAAoD;AACjE,WAAOm8C,QAAQ,CAACzC,MAAD,EAAS1iE,OAAT,EAAkBu+B,MAAlB,CAAR,CAAkCxrC,IAAlC,CAAuC,UAAUmmB,GAAV,EAAe;AAC3D,aAAO2uD,KAAK,CAACnF,MAAD,EAAS15C,SAAT,EAAoByV,IAAI,CAACvlB,GAAD,EAAM+tD,OAAO,CAACG,WAAR,EAAN,CAAxB,CAAZ;AACD,KAFM,CAAP;AAGD,GAJD;;AAKA,MAAIS,KAAK,GAAG,UAAUnF,MAAV,EAAkB15C,SAAlB,EAA6B9P,GAA7B,EAAkC;AAC5C,QAAI7hB,OAAO,GAAGuG,QAAQ,GAAGvG,OAAzB;;AACA,QAAIA,OAAO,CAACuE,QAAR,MAAsBvE,OAAO,CAACa,QAAR,EAAtB,IAA4Cb,OAAO,CAAC0E,SAAR,EAA5C,IAAmE1E,OAAO,CAACsE,MAAR,EAAvE,EAAyF;AACvF,aAAOqtB,SAAS,CAAC8+C,UAAV,CAAqBpF,MAArB,EAA6BxpD,GAA7B,CAAP;AACD,KAFD,MAEO,IAAI7hB,OAAO,CAACwE,IAAR,EAAJ,EAAoB;AACzB,aAAOmtB,SAAS,CAAC++C,OAAV,CAAkBrF,MAAlB,EAA0BxpD,GAA1B,CAAP;AACD,KAFM,MAEA;AACL,aAAOnlB,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,GATD;;AAUA,MAAIi2E,SAAS,GAAG,UAAUhF,MAAV,EAAkB/8D,MAAlB,EAA0B3F,OAA1B,EAAmCu+B,MAAnC,EAA2CvV,SAA3C,EAAsD;AACpE,WAAOm8C,QAAQ,CAACzC,MAAD,EAAS1iE,OAAT,EAAkBu+B,MAAlB,CAAR,CAAkCxrC,IAAlC,CAAuC,UAAUmmB,GAAV,EAAe;AAC3D,aAAO2uD,KAAK,CAACnF,MAAD,EAAS15C,SAAT,EAAoB9P,GAApB,CAAZ;AACD,KAFM,CAAP;AAGD,GAJD;;AAKA,MAAI8uD,QAAQ,GAAG,UAAUtF,MAAV,EAAkB/8D,MAAlB,EAA0BqjB,SAA1B,EAAqC;AAClD,WAAOs+C,QAAQ,CAAC5E,MAAD,EAAS/8D,MAAT,EAAiBqjB,SAAjB,CAAR,CAAoCj2B,IAApC,CAAyC,UAAUk1E,IAAV,EAAgB;AAC9D,aAAOR,MAAM,CAAC/E,MAAD,EAAS/8D,MAAT,EAAiBsiE,IAAI,CAACjoE,OAAtB,EAA+BioE,IAAI,CAAC1pC,MAApC,EAA4CvV,SAA5C,EAAuDq+C,WAAvD,CAAN,CAA0Ex0E,GAA1E,CAA8E6vE,MAAM,CAAC8E,SAArF,CAAP;AACD,KAFM,CAAP;AAGD,GAJD;;AAMA,MAAIU,WAAW,GAAG,UAAU/nE,IAAV,EAAgBkM,KAAhB,EAAuB;AACvC,WAAO+1D,UAAU,CAACjiE,IAAD,EAAO,UAAU+E,CAAV,EAAa;AACnC,aAAOM,MAAM,CAACN,CAAD,CAAN,CAAUlS,MAAV,CAAiB,UAAU0D,CAAV,EAAa;AACnC,eAAOmK,IAAI,CAACnK,CAAD,EAAI2V,KAAJ,CAAX;AACD,OAFM,CAAP;AAGD,KAJgB,CAAjB;AAKD,GAND;;AAOA,MAAI87D,QAAQ,GAAG,UAAUzF,MAAV,EAAkB/8D,MAAlB,EAA0BqjB,SAA1B,EAAqCI,OAArC,EAA8Ci1C,MAA9C,EAAsD;AACnE,WAAOv1D,SAAS,CAACsgB,OAAD,EAAU,OAAV,EAAmBzjB,MAAnB,CAAT,CAAoC5S,IAApC,CAAyC,UAAUoH,KAAV,EAAiB;AAC/D,aAAO2O,SAAS,CAAC3O,KAAD,EAAQ,OAAR,EAAiBwL,MAAjB,CAAT,CAAkC5S,IAAlC,CAAuC,UAAUsZ,KAAV,EAAiB;AAC7D,YAAI,CAAC67D,WAAW,CAAC7J,MAAD,EAAShyD,KAAT,CAAhB,EAAiC;AAC/B,iBAAOtY,QAAQ,CAACtC,IAAT,EAAP;AACD;;AACD,eAAOu2E,QAAQ,CAACtF,MAAD,EAAS/8D,MAAT,EAAiBqjB,SAAjB,CAAR,CAAoCj2B,IAApC,CAAyC,UAAU8B,KAAV,EAAiB;AAC/D,iBAAOiU,SAAS,CAACjU,KAAK,CAACud,MAAP,EAAe,OAAf,EAAwBzM,MAAxB,CAAT,CAAyC9S,GAAzC,CAA6C,UAAUuf,MAAV,EAAkB;AACpE,mBAAO;AACLjY,cAAAA,KAAK,EAAEA,KADF;AAELiY,cAAAA,MAAM,EAAEA,MAFH;AAGLvd,cAAAA,KAAK,EAAEA;AAHF,aAAP;AAKD,WANM,CAAP;AAOD,SARM,CAAP;AASD,OAbM,CAAP;AAcD,KAfM,CAAP;AAgBD,GAjBD;;AAkBA,MAAIuzE,QAAQ,GAAG,UAAU1F,MAAV,EAAkB/8D,MAAlB,EAA0BqjB,SAA1B,EAAqCI,OAArC,EAA8Ci1C,MAA9C,EAAsDgK,QAAtD,EAAgE;AAC7E,QAAIzqE,QAAQ,GAAGvG,OAAX,CAAmBwE,IAAnB,EAAJ,EAA+B;AAC7B,aAAO9H,QAAQ,CAACtC,IAAT,EAAP;AACD,KAFD,MAEO;AACL,aAAO42E,QAAQ,CAACj/C,OAAD,EAAUzjB,MAAV,CAAR,CAA0B/S,OAA1B,CAAkC,YAAY;AACnD,eAAOu1E,QAAQ,CAACzF,MAAD,EAAS/8D,MAAT,EAAiBqjB,SAAjB,EAA4BI,OAA5B,EAAqCi1C,MAArC,CAAR,CAAqDxrE,GAArD,CAAyD,UAAU4I,IAAV,EAAgB;AAC9E,cAAI5G,KAAK,GAAG4G,IAAI,CAAC5G,KAAjB;AACA,iBAAOirE,QAAQ,CAACzpD,MAAT,CAAgBtiB,QAAQ,CAACR,IAAT,CAAc2sE,SAAS,CAACrrE,KAAK,CAACsF,KAAP,EAActF,KAAK,CAAC+hE,OAApB,EAA6B/hE,KAAK,CAACud,MAAnC,EAA2Cvd,KAAK,CAACgiE,OAAjD,CAAvB,CAAhB,EAAmG,IAAnG,CAAP;AACD,SAHM,CAAP;AAID,OALM,CAAP;AAMD;AACF,GAXD;;AAYA,MAAIyR,YAAY,GAAG,UAAUl/C,OAAV,EAAmBzjB,MAAnB,EAA2B;AAC5C,WAAOmD,SAAS,CAACsgB,OAAD,EAAU,IAAV,EAAgBzjB,MAAhB,CAAT,CAAiC5S,IAAjC,CAAsC,UAAUoR,QAAV,EAAoB;AAC/D,aAAO2E,SAAS,CAAC3E,QAAD,EAAW,OAAX,EAAoBwB,MAApB,CAAT,CAAqC5S,IAArC,CAA0C,UAAUsZ,KAAV,EAAiB;AAChE,YAAIvJ,IAAI,GAAGoF,aAAa,CAACmE,KAAD,EAAQ,IAAR,CAAxB;;AACA,YAAIxL,IAAI,CAACsD,QAAD,EAAWrB,IAAI,CAAC,CAAD,CAAf,CAAR,EAA6B;AAC3B,iBAAOo/D,UAAU,CAAC71D,KAAD,EAAQ,UAAUrM,OAAV,EAAmB;AAC1C,mBAAOgtB,MAAM,CAAChtB,OAAD,CAAN,CAAgB3N,MAAhB,EAAP;AACD,WAFgB,EAEdsT,MAFc,CAAV,CAEI9S,GAFJ,CAEQ,UAAUwD,IAAV,EAAgB;AAC7B,gBAAIkyE,UAAU,GAAG57C,MAAM,CAACt2B,IAAD,CAAvB;AACA,mBAAOypE,QAAQ,CAACzpD,MAAT,CAAgBtiB,QAAQ,CAACR,IAAT,CAAc2sE,SAAS,CAAC7pE,IAAD,EAAOkyE,UAAP,EAAmBlyE,IAAnB,EAAyBkyE,UAAzB,CAAvB,CAAhB,EAA8E,IAA9E,CAAP;AACD,WALM,CAAP;AAMD,SAPD,MAOO;AACL,iBAAOx0E,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,OAZM,CAAP;AAaD,KAdM,CAAP;AAeD,GAhBD;;AAiBA,MAAI+2E,aAAa,GAAG,UAAUp/C,OAAV,EAAmBzjB,MAAnB,EAA2B;AAC7C,WAAOmD,SAAS,CAACsgB,OAAD,EAAU,IAAV,EAAgBzjB,MAAhB,CAAT,CAAiC5S,IAAjC,CAAsC,UAAUoR,QAAV,EAAoB;AAC/D,aAAO2E,SAAS,CAAC3E,QAAD,EAAW,OAAX,EAAoBwB,MAApB,CAAT,CAAqC5S,IAArC,CAA0C,UAAUsZ,KAAV,EAAiB;AAChE,YAAIvJ,IAAI,GAAGoF,aAAa,CAACmE,KAAD,EAAQ,IAAR,CAAxB;;AACA,YAAIxL,IAAI,CAACsD,QAAD,EAAWrB,IAAI,CAACA,IAAI,CAACzS,MAAL,GAAc,CAAf,CAAf,CAAR,EAA2C;AACzC,iBAAO8xE,WAAW,CAAC91D,KAAD,EAAQ,UAAUrM,OAAV,EAAmB;AAC3C,mBAAOgT,KAAK,CAAChT,OAAD,CAAL,CAAe3N,MAAf,EAAP;AACD,WAFiB,EAEfsT,MAFe,CAAX,CAEI9S,GAFJ,CAEQ,UAAUmgB,KAAV,EAAiB;AAC9B,mBAAO8sD,QAAQ,CAACzpD,MAAT,CAAgBtiB,QAAQ,CAACR,IAAT,CAAc2sE,SAAS,CAACltD,KAAD,EAAQ,CAAR,EAAWA,KAAX,EAAkB,CAAlB,CAAvB,CAAhB,EAA8D,IAA9D,CAAP;AACD,WAJM,CAAP;AAKD,SAND,MAMO;AACL,iBAAOjf,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,OAXM,CAAP;AAYD,KAbM,CAAP;AAcD,GAfD;;AAgBA,MAAI27C,MAAM,GAAG,UAAUs1B,MAAV,EAAkBxqD,SAAlB,EAA6BvS,MAA7B,EAAqCqjB,SAArC,EAAgDI,OAAhD,EAAyDi1C,MAAzD,EAAiE8B,WAAjE,EAA8E;AACzF,WAAOgI,QAAQ,CAACzF,MAAD,EAAS/8D,MAAT,EAAiBqjB,SAAjB,EAA4BI,OAA5B,EAAqCi1C,MAArC,CAAR,CAAqDtrE,IAArD,CAA0D,UAAU0I,IAAV,EAAgB;AAC/E,aAAO2kE,QAAQ,CAACloD,SAAD,EAAYvS,MAAZ,EAAoBlK,IAAI,CAACtB,KAAzB,EAAgCsB,IAAI,CAAC2W,MAArC,EAA6C+tD,WAA7C,CAAf;AACD,KAFM,CAAP;AAGD,GAJD;;AAMA,MAAIsI,OAAO,GAAG,YAAY;AACxB,QAAIptD,OAAO,GAAG8N,IAAI,CAACp1B,QAAQ,CAACtC,IAAT,EAAD,CAAlB;;AACA,QAAIwhC,KAAK,GAAG,YAAY;AACtB,aAAO5X,OAAO,CAACpS,GAAR,CAAYlV,QAAQ,CAACtC,IAAT,EAAZ,CAAP;AACD,KAFD;;AAGA,QAAIwX,GAAG,GAAG,UAAUvV,CAAV,EAAa;AACrB,aAAO2nB,OAAO,CAACpS,GAAR,CAAYlV,QAAQ,CAACR,IAAT,CAAcG,CAAd,CAAZ,CAAP;AACD,KAFD;;AAGA,QAAIg1E,KAAK,GAAG,YAAY;AACtB,aAAOrtD,OAAO,CAACllB,GAAR,GAAc9D,MAAd,EAAP;AACD,KAFD;;AAGA,QAAI6/B,EAAE,GAAG,UAAU/gC,CAAV,EAAa;AACpB,aAAOkqB,OAAO,CAACllB,GAAR,GAAcrD,IAAd,CAAmB3B,CAAnB,CAAP;AACD,KAFD;;AAGA,WAAO;AACL8hC,MAAAA,KAAK,EAAEA,KADF;AAELhqB,MAAAA,GAAG,EAAEA,GAFA;AAGLy/D,MAAAA,KAAK,EAAEA,KAHF;AAILx2C,MAAAA,EAAE,EAAEA;AAJC,KAAP;AAMD,GApBD;;AAsBA,MAAIy2C,QAAQ,GAAG,UAAU7tE,MAAV,EAAkB6K,MAAlB,EAA0B;AACvC,WAAOmD,SAAS,CAAChO,MAAD,EAAS,OAAT,EAAkB6K,MAAlB,CAAhB;AACD,GAFD;;AAGA,MAAIijE,cAAc,GAAG,UAAUlG,MAAV,EAAkBxqD,SAAlB,EAA6BvS,MAA7B,EAAqC26D,WAArC,EAAkD;AACrE,QAAI/uB,MAAM,GAAGk3B,OAAO,EAApB;AACA,QAAII,UAAU,GAAGt3B,MAAM,CAACte,KAAxB;;AACA,QAAI61C,cAAc,GAAG,UAAU5hE,KAAV,EAAiB;AACpCqqC,MAAAA,MAAM,CAACrf,EAAP,CAAU,UAAU/3B,KAAV,EAAiB;AACzBmmE,QAAAA,WAAW,CAACG,iBAAZ,CAA8BvoD,SAA9B;AACAywD,QAAAA,QAAQ,CAACzhE,KAAK,CAACpM,MAAP,EAAe6K,MAAf,CAAR,CAA+B7S,IAA/B,CAAoC,UAAUsf,MAAV,EAAkB;AACpD+F,UAAAA,QAAQ,CAAChe,KAAD,EAAQiY,MAAR,EAAgBzM,MAAhB,CAAR,CAAgC7S,IAAhC,CAAqC,UAAUutE,OAAV,EAAmB;AACtD,gBAAI/nD,KAAK,GAAG+nD,OAAO,CAAC/nD,KAAR,CAAchmB,KAAd,CAAoB,EAApB,CAAZ;;AACA,gBAAIgmB,KAAK,CAACjoB,MAAN,GAAe,CAAf,IAAoBioB,KAAK,CAACjoB,MAAN,KAAiB,CAAjB,IAAsB,CAACwQ,IAAI,CAAC1G,KAAD,EAAQiY,MAAR,CAAnD,EAAoE;AAClEkuD,cAAAA,WAAW,CAACH,WAAZ,CAAwBjoD,SAAxB,EAAmCI,KAAnC,EAA0C+nD,OAAO,CAAClmE,KAAlD,EAAyDkmE,OAAO,CAACjuD,MAAjE;AACAswD,cAAAA,MAAM,CAACqG,cAAP,CAAsB32D,MAAtB;AACD;AACF,WAND;AAOD,SARD;AASD,OAXD;AAYD,KAbD;;AAcA,QAAIo0B,SAAS,GAAG,UAAUt/B,KAAV,EAAiB;AAC/Bo5D,MAAAA,WAAW,CAACrtC,KAAZ,CAAkB/a,SAAlB;AACAywD,MAAAA,QAAQ,CAACzhE,KAAK,CAACpM,MAAP,EAAe6K,MAAf,CAAR,CAA+B7S,IAA/B,CAAoCy+C,MAAM,CAACtoC,GAA3C;AACD,KAHD;;AAIA,QAAIy9B,SAAS,GAAG,UAAUx/B,KAAV,EAAiB;AAC/B4hE,MAAAA,cAAc,CAAC5hE,KAAD,CAAd;AACD,KAFD;;AAGA,QAAI8hE,OAAO,GAAG,UAAU9hE,KAAV,EAAiB;AAC7B4hE,MAAAA,cAAc,CAAC5hE,KAAD,CAAd;AACA2hE,MAAAA,UAAU;AACX,KAHD;;AAIA,WAAO;AACLA,MAAAA,UAAU,EAAEA,UADP;AAELriC,MAAAA,SAAS,EAAEA,SAFN;AAGLE,MAAAA,SAAS,EAAEA,SAHN;AAILsiC,MAAAA,OAAO,EAAEA;AAJJ,KAAP;AAMD,GAlCD;;AAoCA,MAAIhzD,IAAI,GAAG;AACT0qD,IAAAA,QAAQ,EAAEx6D,WADD;AAET69D,IAAAA,MAAM,EAAE9B,OAFC;AAGTt/C,IAAAA,QAAQ,EAAE40C,IAAI,CAACrqD,MAHN;AAIT46D,IAAAA,UAAU,EAAEb,OAAO,CAACE,OAJX;AAKTY,IAAAA,OAAO,EAAEd,OAAO,CAACP,SALR;AAMTxD,IAAAA,OAAO,EAAEQ,WAAW,CAAClB;AANZ,GAAX;AAQA,MAAIzsD,EAAE,GAAG;AACP2qD,IAAAA,QAAQ,EAAE16D,WADH;AAEP+9D,IAAAA,MAAM,EAAE/B,QAFD;AAGPr/C,IAAAA,QAAQ,EAAE40C,IAAI,CAACrqD,MAHR;AAIP46D,IAAAA,UAAU,EAAEb,OAAO,CAACC,KAJb;AAKPa,IAAAA,OAAO,EAAEd,OAAO,CAACN,OALV;AAMPzD,IAAAA,OAAO,EAAEQ,WAAW,CAACnB;AANd,GAAT;;AASA,MAAI0G,KAAK,GAAG,UAAU3mE,GAAV,EAAe;AACzB,WAAO,UAAU4mE,OAAV,EAAmB;AACxB,aAAOA,OAAO,KAAK5mE,GAAnB;AACD,KAFD;AAGD,GAJD;;AAKA,MAAI6mE,IAAI,GAAGF,KAAK,CAAC,EAAD,CAAhB;AACA,MAAIG,MAAM,GAAGH,KAAK,CAAC,EAAD,CAAlB;;AACA,MAAII,YAAY,GAAG,UAAUH,OAAV,EAAmB;AACpC,WAAOA,OAAO,IAAI,EAAX,IAAiBA,OAAO,IAAI,EAAnC;AACD,GAFD;;AAGA,MAAII,KAAK,GAAG;AACVC,IAAAA,UAAU,EAAEN,KAAK,CAAC,EAAD,CADP;AAEVO,IAAAA,SAAS,EAAEP,KAAK,CAAC,EAAD;AAFN,GAAZ;AAIA,MAAIQ,KAAK,GAAG;AACVF,IAAAA,UAAU,EAAEN,KAAK,CAAC,EAAD,CADP;AAEVO,IAAAA,SAAS,EAAEP,KAAK,CAAC,EAAD;AAFN,GAAZ;;AAKA,MAAIS,KAAK,GAAG,UAAUC,IAAV,EAAgB;AAC1B,QAAIjrE,GAAG,GAAGirE,IAAI,KAAKl6E,SAAT,GAAqBk6E,IAAI,CAACjqE,GAA1B,GAAgCf,QAA1C;AACA,QAAIrQ,CAAC,GAAGoQ,GAAG,CAAC+I,IAAJ,CAASgZ,UAAT,IAAuB/hB,GAAG,CAAC0hB,eAAJ,CAAoBK,UAAnD;AACA,QAAI5gB,CAAC,GAAGnB,GAAG,CAAC+I,IAAJ,CAAS8Y,SAAT,IAAsB7hB,GAAG,CAAC0hB,eAAJ,CAAoBG,SAAlD;AACA,WAAOR,aAAa,CAACzxB,CAAD,EAAIuR,CAAJ,CAApB;AACD,GALD;;AAMA,MAAI+pE,EAAE,GAAG,UAAUt7E,CAAV,EAAauR,CAAb,EAAgB8pE,IAAhB,EAAsB;AAC7B,QAAIjrE,GAAG,GAAGirE,IAAI,KAAKl6E,SAAT,GAAqBk6E,IAAI,CAACjqE,GAA1B,GAAgCf,QAA1C;AACA,QAAIwhB,GAAG,GAAGzhB,GAAG,CAAC6G,WAAd;;AACA,QAAI4a,GAAJ,EAAS;AACPA,MAAAA,GAAG,CAAC6mD,QAAJ,CAAa14E,CAAb,EAAgBuR,CAAhB;AACD;AACF,GAND;;AAQA,MAAIgqE,YAAY,GAAG,UAAU1pD,GAAV,EAAe;AAChC,QAAIrgB,gBAAgB,GAAG,UAAUxR,CAAV,EAAauR,CAAb,EAAgB;AACrC,aAAOE,YAAY,CAACJ,SAAb,CAAuBI,YAAY,CAACZ,OAAb,CAAqBghB,GAAG,CAACxhB,QAAzB,CAAvB,EAA2DrQ,CAA3D,EAA8DuR,CAA9D,CAAP;AACD,KAFD;;AAGA,QAAI+iE,OAAO,GAAG,UAAU5iE,OAAV,EAAmB;AAC/B,aAAOA,OAAO,CAACN,GAAR,CAAY6f,qBAAZ,EAAP;AACD,KAFD;;AAGA,QAAIylD,aAAa,GAAG,UAAU7qE,KAAV,EAAiBy8D,OAAjB,EAA0BxkD,MAA1B,EAAkCykD,OAAlC,EAA2C;AAC7D,UAAI8H,GAAG,GAAGrG,YAAY,CAACZ,KAAb,CAAmBv9D,KAAnB,EAA0By8D,OAA1B,EAAmCxkD,MAAnC,EAA2CykD,OAA3C,CAAV;AACA,aAAOgI,cAAc,CAAC1+C,GAAD,EAAMw+C,GAAN,CAArB;AACD,KAHD;;AAIA,QAAI3B,YAAY,GAAG,YAAY;AAC7B,aAAO4B,KAAK,CAACz+C,GAAD,CAAL,CAAWttB,GAAX,CAAe,UAAUi3E,QAAV,EAAoB;AACxC,eAAO7J,cAAc,CAAC9/C,GAAD,EAAM2pD,QAAN,CAArB;AACD,OAFM,CAAP;AAGD,KAJD;;AAKA,QAAItC,SAAS,GAAG,UAAUG,KAAV,EAAiB;AAC/B,UAAIhlD,QAAQ,GAAG21C,YAAY,CAAC31C,QAAb,CAAsBglD,KAAK,CAACxtE,KAA5B,EAAmCwtE,KAAK,CAACv1D,MAAzC,CAAf;AACA,aAAO6tD,cAAc,CAAC9/C,GAAD,EAAMwC,QAAN,CAArB;AACD,KAHD;;AAIA,QAAI4jD,cAAc,GAAG,UAAUj4E,CAAV,EAAauR,CAAb,EAAgB;AACnC,aAAOi/D,UAAU,CAAC3+C,GAAD,EAAM7xB,CAAN,EAASuR,CAAT,CAAV,CAAsBhN,GAAtB,CAA0B,UAAU6kE,KAAV,EAAiB;AAChD,eAAOsI,KAAK,CAAC3pD,MAAN,CAAaqhD,KAAK,CAACv9D,KAAnB,EAA0Bu9D,KAAK,CAACd,OAAhC,EAAyCc,KAAK,CAACtlD,MAA/C,EAAuDslD,KAAK,CAACb,OAA7D,CAAP;AACD,OAFM,CAAP;AAGD,KAJD;;AAKA,QAAIkT,cAAc,GAAG,YAAY;AAC/B92C,MAAAA,KAAK,CAAC9S,GAAD,CAAL;AACD,KAFD;;AAGA,QAAI6pD,iBAAiB,GAAG,UAAUC,OAAV,EAAmB;AACzC,UAAIA,OAAO,KAAK,KAAK,CAArB,EAAwB;AACtBA,QAAAA,OAAO,GAAG,KAAV;AACD;;AACDrL,MAAAA,KAAK,CAACz+C,GAAD,CAAL,CAAWrtB,IAAX,CAAgB,UAAU6rE,GAAV,EAAe;AAC7B,eAAOA,GAAG,CAACzsE,IAAJ,CAAS,UAAU6gC,GAAV,EAAe;AAC7B,iBAAOA,GAAG,CAACi0B,QAAJ,CAAaijB,OAAb,CAAP;AACD,SAFM,EAEJ,UAAUlS,SAAV,EAAqBiB,UAArB,EAAiC;AAClC,cAAI5B,IAAI,GAAG6S,OAAO,GAAGlS,SAAH,GAAeiB,UAAjC;AACA0E,UAAAA,WAAW,CAACv9C,GAAD,EAAMi3C,IAAN,EAAYA,IAAZ,CAAX;AACD,SALM,EAKJ,UAAUj9D,KAAV,EAAiBy8D,OAAjB,EAA0BxkD,MAA1B,EAAkCykD,OAAlC,EAA2C;AAC5C,cAAIv3D,IAAI,GAAG2qE,OAAO,GAAG9vE,KAAH,GAAWiY,MAA7B;AACA,cAAImsB,MAAM,GAAG0rC,OAAO,GAAGrT,OAAH,GAAaC,OAAjC;AACA4G,UAAAA,QAAQ,CAACt9C,GAAD,EAAM7gB,IAAN,EAAYi/B,MAAZ,EAAoBj/B,IAApB,EAA0Bi/B,MAA1B,CAAR;AACD,SATM,CAAP;AAUD,OAXD;AAYD,KAhBD;;AAiBA,QAAIwqC,cAAc,GAAG,UAAU/oE,OAAV,EAAmB;AACtCy+D,MAAAA,YAAY,CAACt+C,GAAD,EAAMngB,OAAN,CAAZ;AACD,KAFD;;AAGA,QAAIkqE,YAAY,GAAG,UAAUvL,GAAV,EAAe;AAChClB,MAAAA,QAAQ,CAACt9C,GAAD,EAAMw+C,GAAG,CAACxkE,KAAV,EAAiBwkE,GAAG,CAAC/H,OAArB,EAA8B+H,GAAG,CAACvsD,MAAlC,EAA0CusD,GAAG,CAAC9H,OAA9C,CAAR;AACD,KAFD;;AAGA,QAAIsT,oBAAoB,GAAG,UAAUhwE,KAAV,EAAiBiY,MAAjB,EAAyB;AAClDsrD,MAAAA,WAAW,CAACv9C,GAAD,EAAMhmB,KAAN,EAAaiY,MAAb,CAAX;AACD,KAFD;;AAGA,QAAI00D,cAAc,GAAG,YAAY;AAC/B,aAAO3mD,GAAG,CAACiqD,WAAX;AACD,KAFD;;AAGA,QAAIC,UAAU,GAAG,YAAY;AAC3B,UAAIppD,GAAG,GAAGyoD,KAAK,CAAC3pE,YAAY,CAACZ,OAAb,CAAqBghB,GAAG,CAACxhB,QAAzB,CAAD,CAAf;AACA,aAAOsiB,GAAG,CAACpB,GAAX;AACD,KAHD;;AAIA,QAAImnD,QAAQ,GAAG,UAAU14E,CAAV,EAAauR,CAAb,EAAgB;AAC7B+pE,MAAAA,EAAE,CAACt7E,CAAD,EAAIuR,CAAJ,EAAOE,YAAY,CAACZ,OAAb,CAAqBghB,GAAG,CAACxhB,QAAzB,CAAP,CAAF;AACD,KAFD;;AAGA,WAAO;AACLmB,MAAAA,gBAAgB,EAAEA,gBADb;AAEL8iE,MAAAA,OAAO,EAAEA,OAFJ;AAGLoC,MAAAA,aAAa,EAAEA,aAHV;AAILhI,MAAAA,YAAY,EAAEA,YAJT;AAKLwK,MAAAA,SAAS,EAAEA,SALN;AAMLjB,MAAAA,cAAc,EAAEA,cANX;AAOLwD,MAAAA,cAAc,EAAEA,cAPX;AAQLC,MAAAA,iBAAiB,EAAEA,iBARd;AASLE,MAAAA,YAAY,EAAEA,YATT;AAULC,MAAAA,oBAAoB,EAAEA,oBAVjB;AAWLpB,MAAAA,cAAc,EAAEA,cAXX;AAYLjC,MAAAA,cAAc,EAAEA,cAZX;AAaLuD,MAAAA,UAAU,EAAEA,UAbP;AAcLrD,MAAAA,QAAQ,EAAEA;AAdL,KAAP;AAgBD,GAhFD;;AAkFA,MAAIsD,EAAE,GAAG,UAAUxnE,IAAV,EAAgB+K,IAAhB,EAAsB;AAC7B,WAAO;AACL/K,MAAAA,IAAI,EAAEA,IADD;AAEL+K,MAAAA,IAAI,EAAEA;AAFD,KAAP;AAID,GALD;;AAMA,MAAI08D,KAAK,GAAG,UAAUpqD,GAAV,EAAejI,SAAf,EAA0BvS,MAA1B,EAAkC26D,WAAlC,EAA+C;AACzD,QAAIoC,MAAM,GAAGmH,YAAY,CAAC1pD,GAAD,CAAzB;AACA,QAAIyb,QAAQ,GAAGgtC,cAAc,CAAClG,MAAD,EAASxqD,SAAT,EAAoBvS,MAApB,EAA4B26D,WAA5B,CAA7B;AACA,WAAO;AACLuI,MAAAA,UAAU,EAAEjtC,QAAQ,CAACitC,UADhB;AAELriC,MAAAA,SAAS,EAAE5K,QAAQ,CAAC4K,SAFf;AAGLE,MAAAA,SAAS,EAAE9K,QAAQ,CAAC8K,SAHf;AAILsiC,MAAAA,OAAO,EAAEptC,QAAQ,CAACotC;AAJb,KAAP;AAMD,GATD;;AAUA,MAAIwB,QAAQ,GAAG,UAAUrqD,GAAV,EAAejI,SAAf,EAA0BvS,MAA1B,EAAkC26D,WAAlC,EAA+C;AAC5D,QAAIoC,MAAM,GAAGmH,YAAY,CAAC1pD,GAAD,CAAzB;;AACA,QAAIsqD,eAAe,GAAG,YAAY;AAChCnK,MAAAA,WAAW,CAACrtC,KAAZ,CAAkB/a,SAAlB;AACA,aAAOnkB,QAAQ,CAACtC,IAAT,EAAP;AACD,KAHD;;AAIA,QAAIi5E,OAAO,GAAG,UAAUxjE,KAAV,EAAiB/M,KAAjB,EAAwBy8D,OAAxB,EAAiCxkD,MAAjC,EAAyCykD,OAAzC,EAAkD7tC,SAAlD,EAA6D;AACzE,UAAI2hD,SAAS,GAAGzjE,KAAK,CAAC0D,GAAtB;AACA,UAAIs+D,OAAO,GAAGyB,SAAS,CAACC,KAAxB;AACA,UAAIjL,QAAQ,GAAGgL,SAAS,CAAChL,QAAV,KAAuB,IAAtC;AACA,UAAI9jC,OAAO,GAAG/iB,QAAQ,CAACZ,SAAD,EAAYooD,WAAW,CAACzkD,gBAAxB,CAAR,CAAkD3pB,IAAlD,CAAuD,YAAY;AAC/E,YAAIk3E,MAAM,CAACF,OAAD,CAAN,IAAmBvJ,QAAvB,EAAiC;AAC/B,iBAAO/uE,KAAK,CAACw8C,MAAD,EAASs1B,MAAT,EAAiBxqD,SAAjB,EAA4BvS,MAA5B,EAAoCqQ,IAApC,EAA0C5D,MAA1C,EAAkDjY,KAAlD,EAAyDmmE,WAAW,CAACH,WAArE,CAAZ;AACD,SAFD,MAEO,IAAIgJ,IAAI,CAACD,OAAD,CAAJ,IAAiBvJ,QAArB,EAA+B;AACpC,iBAAO/uE,KAAK,CAACw8C,MAAD,EAASs1B,MAAT,EAAiBxqD,SAAjB,EAA4BvS,MAA5B,EAAoCoQ,EAApC,EAAwC3D,MAAxC,EAAgDjY,KAAhD,EAAuDmmE,WAAW,CAACH,WAAnE,CAAZ;AACD,SAFM,MAEA,IAAIiJ,MAAM,CAACF,OAAD,CAAV,EAAqB;AAC1B,iBAAOt4E,KAAK,CAACw3E,QAAD,EAAW1F,MAAX,EAAmB/8D,MAAnB,EAA2BqQ,IAA3B,EAAiC5D,MAAjC,EAAyCjY,KAAzC,EAAgDquE,aAAhD,CAAZ;AACD,SAFM,MAEA,IAAIW,IAAI,CAACD,OAAD,CAAR,EAAmB;AACxB,iBAAOt4E,KAAK,CAACw3E,QAAD,EAAW1F,MAAX,EAAmB/8D,MAAnB,EAA2BoQ,EAA3B,EAA+B3D,MAA/B,EAAuCjY,KAAvC,EAA8CmuE,YAA9C,CAAZ;AACD,SAFM,MAEA;AACL,iBAAOv0E,QAAQ,CAACtC,IAAhB;AACD;AACF,OAZa,EAYX,UAAUu/B,QAAV,EAAoB;AACrB,YAAI65C,QAAQ,GAAG,UAAUC,QAAV,EAAoB;AACjC,iBAAO,YAAY;AACjB,gBAAIlL,UAAU,GAAGtpE,OAAO,CAACw0E,QAAD,EAAW,UAAUhsD,KAAV,EAAiB;AAClD,qBAAOmf,MAAM,CAACnf,KAAK,CAAChc,IAAP,EAAagc,KAAK,CAACjR,IAAnB,EAAyBqK,SAAzB,EAAoC8Y,QAApC,EAA8CsvC,WAA9C,CAAb;AACD,aAFuB,CAAxB;AAGA,mBAAOV,UAAU,CAAC1tE,IAAX,CAAgB,YAAY;AACjC,qBAAOinB,QAAQ,CAACjB,SAAD,EAAYooD,WAAW,CAAClnD,qBAAxB,EAA+CknD,WAAW,CAACrnD,oBAA3D,CAAR,CAAyFpmB,GAAzF,CAA6F,UAAU6mB,KAAV,EAAiB;AACnH,oBAAIiJ,QAAQ,GAAGymD,MAAM,CAACF,OAAD,CAAN,IAAmBlgD,SAAS,CAACwgD,SAAV,CAAoBN,OAApB,CAAnB,GAAkD3R,IAAI,CAACpqD,KAAvD,GAA+DoqD,IAAI,CAACrqD,MAAnF;AACAw1D,gBAAAA,MAAM,CAACyH,oBAAP,CAA4B5S,IAAI,CAACrlC,EAAL,CAAQxY,KAAK,CAAC1G,KAAd,EAAqB,CAArB,CAA5B,EAAqD2P,QAAQ,CAACjJ,KAAK,CAACrN,KAAP,CAA7D;AACAi0D,gBAAAA,WAAW,CAACrtC,KAAZ,CAAkB/a,SAAlB;AACA,uBAAO4nD,QAAQ,CAACzpD,MAAT,CAAgBtiB,QAAQ,CAACtC,IAAT,EAAhB,EAAiC,IAAjC,CAAP;AACD,eALM,CAAP;AAMD,aAPM,EAOJ,UAAUgiD,CAAV,EAAa;AACd,qBAAO1/C,QAAQ,CAACR,IAAT,CAAcusE,QAAQ,CAACzpD,MAAT,CAAgBtiB,QAAQ,CAACtC,IAAT,EAAhB,EAAiC,IAAjC,CAAd,CAAP;AACD,aATM,CAAP;AAUD,WAdD;AAeD,SAhBD;;AAiBA,YAAI23E,MAAM,CAACF,OAAD,CAAN,IAAmBvJ,QAAvB,EAAiC;AAC/B,iBAAOkL,QAAQ,CAAC,CAACP,EAAE,CAAC,CAAC,CAAF,EAAK,CAAL,CAAH,CAAD,CAAf;AACD,SAFD,MAEO,IAAInB,IAAI,CAACD,OAAD,CAAJ,IAAiBvJ,QAArB,EAA+B;AACpC,iBAAOkL,QAAQ,CAAC,CAACP,EAAE,CAAC,CAAC,CAAF,EAAK,CAAL,CAAH,CAAD,CAAf;AACD,SAFM,MAEA,IAAIthD,SAAS,CAACugD,UAAV,CAAqBL,OAArB,KAAiCvJ,QAArC,EAA+C;AACpD,iBAAOkL,QAAQ,CAAC,CACdP,EAAE,CAAC,CAAD,EAAI,CAAC,CAAL,CADY,EAEdA,EAAE,CAAC,CAAC,CAAF,EAAK,CAAL,CAFY,CAAD,CAAf;AAID,SALM,MAKA,IAAIthD,SAAS,CAACwgD,SAAV,CAAoBN,OAApB,KAAgCvJ,QAApC,EAA8C;AACnD,iBAAOkL,QAAQ,CAAC,CACdP,EAAE,CAAC,CAAD,EAAI,CAAC,CAAL,CADY,EAEdA,EAAE,CAAC,CAAC,CAAF,EAAK,CAAL,CAFY,CAAD,CAAf;AAID,SALM,MAKA,IAAIjB,YAAY,CAACH,OAAD,CAAZ,IAAyBvJ,QAAQ,KAAK,KAA1C,EAAiD;AACtD,iBAAO8K,eAAP;AACD,SAFM,MAEA;AACL,iBAAO12E,QAAQ,CAACtC,IAAhB;AACD;AACF,OAjDa,CAAd;AAkDA,aAAOoqC,OAAO,EAAd;AACD,KAvDD;;AAwDA,QAAIkvC,KAAK,GAAG,UAAU7jE,KAAV,EAAiB/M,KAAjB,EAAwBy8D,OAAxB,EAAiCxkD,MAAjC,EAAyCykD,OAAzC,EAAkD;AAC5D,aAAO/9C,QAAQ,CAACZ,SAAD,EAAYooD,WAAW,CAACzkD,gBAAxB,CAAR,CAAkD3pB,IAAlD,CAAuD,YAAY;AACxE,YAAIy4E,SAAS,GAAGzjE,KAAK,CAAC0D,GAAtB;AACA,YAAIs+D,OAAO,GAAGyB,SAAS,CAACC,KAAxB;AACA,YAAIjL,QAAQ,GAAGgL,SAAS,CAAChL,QAAV,KAAuB,IAAtC;;AACA,YAAIA,QAAQ,KAAK,KAAjB,EAAwB;AACtB,iBAAO5rE,QAAQ,CAACtC,IAAT,EAAP;AACD;;AACD,YAAI43E,YAAY,CAACH,OAAD,CAAhB,EAA2B;AACzB,iBAAOr6B,IAAI,CAAC32B,SAAD,EAAYvS,MAAZ,EAAoBxL,KAApB,EAA2By8D,OAA3B,EAAoCxkD,MAApC,EAA4CykD,OAA5C,EAAqDyJ,WAAW,CAACH,WAAjE,CAAX;AACD,SAFD,MAEO;AACL,iBAAOpsE,QAAQ,CAACtC,IAAT,EAAP;AACD;AACF,OAZM,EAYJsC,QAAQ,CAACtC,IAZL,CAAP;AAaD,KAdD;;AAeA,WAAO;AACLi5E,MAAAA,OAAO,EAAEA,OADJ;AAELK,MAAAA,KAAK,EAAEA;AAFF,KAAP;AAID,GAjFD;;AAkFA,MAAIC,QAAQ,GAAG,UAAU7qD,GAAV,EAAejI,SAAf,EAA0BvS,MAA1B,EAAkC26D,WAAlC,EAA+C;AAC5D,QAAIoC,MAAM,GAAGmH,YAAY,CAAC1pD,GAAD,CAAzB;AACA,WAAO,UAAUhmB,KAAV,EAAiBiY,MAAjB,EAAyB;AAC9BkuD,MAAAA,WAAW,CAACG,iBAAZ,CAA8BvoD,SAA9B;AACAC,MAAAA,QAAQ,CAAChe,KAAD,EAAQiY,MAAR,EAAgBzM,MAAhB,CAAR,CAAgC7S,IAAhC,CAAqC,UAAUutE,OAAV,EAAmB;AACtD,YAAI/nD,KAAK,GAAG+nD,OAAO,CAAC/nD,KAAR,CAAchmB,KAAd,CAAoB,EAApB,CAAZ;AACAguE,QAAAA,WAAW,CAACH,WAAZ,CAAwBjoD,SAAxB,EAAmCI,KAAnC,EAA0C+nD,OAAO,CAAClmE,KAAlD,EAAyDkmE,OAAO,CAACjuD,MAAjE;AACAswD,QAAAA,MAAM,CAACqG,cAAP,CAAsB32D,MAAtB;AACAswD,QAAAA,MAAM,CAACsH,iBAAP;AACD,OALD;AAMD,KARD;AASD,GAXD;;AAaA,MAAIiB,QAAQ,GAAG,UAAUjrE,OAAV,EAAmB+tD,OAAnB,EAA4B;AACzCj7D,IAAAA,IAAI,CAACi7D,OAAD,EAAU,UAAUz/D,CAAV,EAAa;AACzBuzC,MAAAA,QAAQ,CAAC7hC,OAAD,EAAU1R,CAAV,CAAR;AACD,KAFG,CAAJ;AAGD,GAJD;;AAMA,MAAI++C,QAAQ,GAAG,UAAU5L,KAAV,EAAiB;AAC9B,WAAO,UAAUzhC,OAAV,EAAmB;AACxB2hC,MAAAA,KAAK,CAAC3hC,OAAD,EAAUyhC,KAAV,CAAL;AACD,KAFD;AAGD,GAJD;;AAKA,MAAIypC,aAAa,GAAG,UAAUnd,OAAV,EAAmB;AACrC,WAAO,UAAU/tD,OAAV,EAAmB;AACxBirE,MAAAA,QAAQ,CAACjrE,OAAD,EAAU+tD,OAAV,CAAR;AACD,KAFD;AAGD,GAJD;;AAMA,MAAIod,OAAO,GAAG,UAAU56C,QAAV,EAAoB;AAChC,QAAI66C,iBAAiB,GAAG/9B,QAAQ,CAAC9c,QAAQ,CAACS,QAAV,CAAhC;AACA,QAAIq6C,sBAAsB,GAAGH,aAAa,CAAC,CACzC36C,QAAQ,CAACS,QADgC,EAEzCT,QAAQ,CAACW,YAFgC,EAGzCX,QAAQ,CAACU,aAHgC,CAAD,CAA1C;;AAKA,QAAIgC,KAAK,GAAG,UAAU/a,SAAV,EAAqB;AAC/B,UAAIa,IAAI,GAAG7Q,aAAa,CAACgQ,SAAD,EAAYqY,QAAQ,CAAC1U,gBAArB,CAAxB;AACA/oB,MAAAA,IAAI,CAACimB,IAAD,EAAOsyD,sBAAP,CAAJ;AACD,KAHD;;AAIA,QAAIlL,WAAW,GAAG,UAAUjoD,SAAV,EAAqBvU,KAArB,EAA4BxJ,KAA5B,EAAmCiY,MAAnC,EAA2C;AAC3D6gB,MAAAA,KAAK,CAAC/a,SAAD,CAAL;AACAplB,MAAAA,IAAI,CAAC6Q,KAAD,EAAQynE,iBAAR,CAAJ;AACAzpC,MAAAA,KAAK,CAACxnC,KAAD,EAAQo2B,QAAQ,CAACU,aAAjB,CAAL;AACA0Q,MAAAA,KAAK,CAACvvB,MAAD,EAASme,QAAQ,CAACW,YAAlB,CAAL;AACD,KALD;;AAMA,WAAO;AACLuvC,MAAAA,iBAAiB,EAAExtC,KADd;AAELA,MAAAA,KAAK,EAAEA,KAFF;AAGLktC,MAAAA,WAAW,EAAEA,WAHR;AAILtkD,MAAAA,gBAAgB,EAAE0U,QAAQ,CAAC1U,gBAJtB;AAKLzC,MAAAA,qBAAqB,EAAEmX,QAAQ,CAACnX,qBAL3B;AAMLH,MAAAA,oBAAoB,EAAEsX,QAAQ,CAACtX;AAN1B,KAAP;AAQD,GAzBD;;AA0BA,MAAIqyD,MAAM,GAAG,UAAU/6C,QAAV,EAAoBg7C,WAApB,EAAiCC,OAAjC,EAA0C;AACrD,QAAIC,yBAAyB,GAAG,UAAUzrE,OAAV,EAAmB;AACjDuJ,MAAAA,MAAM,CAACvJ,OAAD,EAAUuwB,QAAQ,CAACS,QAAnB,CAAN;AACAznB,MAAAA,MAAM,CAACvJ,OAAD,EAAUuwB,QAAQ,CAACU,aAAnB,CAAN;AACA1nB,MAAAA,MAAM,CAACvJ,OAAD,EAAUuwB,QAAQ,CAACW,YAAnB,CAAN;AACD,KAJD;;AAKA,QAAIw6C,qBAAqB,GAAG,UAAU1rE,OAAV,EAAmB;AAC7CiJ,MAAAA,GAAG,CAACjJ,OAAD,EAAUuwB,QAAQ,CAACS,QAAnB,EAA6B,GAA7B,CAAH;AACD,KAFD;;AAGA,QAAIiC,KAAK,GAAG,UAAU/a,SAAV,EAAqB;AAC/BuoD,MAAAA,iBAAiB,CAACvoD,SAAD,CAAjB;AACAszD,MAAAA,OAAO;AACR,KAHD;;AAIA,QAAI/K,iBAAiB,GAAG,UAAUvoD,SAAV,EAAqB;AAC3C,UAAIa,IAAI,GAAG7Q,aAAa,CAACgQ,SAAD,EAAYqY,QAAQ,CAAC1U,gBAArB,CAAxB;AACA/oB,MAAAA,IAAI,CAACimB,IAAD,EAAO0yD,yBAAP,CAAJ;AACD,KAHD;;AAIA,QAAItL,WAAW,GAAG,UAAUjoD,SAAV,EAAqBvU,KAArB,EAA4BxJ,KAA5B,EAAmCiY,MAAnC,EAA2C;AAC3D6gB,MAAAA,KAAK,CAAC/a,SAAD,CAAL;AACAplB,MAAAA,IAAI,CAAC6Q,KAAD,EAAQ+nE,qBAAR,CAAJ;AACAziE,MAAAA,GAAG,CAAC9O,KAAD,EAAQo2B,QAAQ,CAACU,aAAjB,EAAgC,GAAhC,CAAH;AACAhoB,MAAAA,GAAG,CAACmJ,MAAD,EAASme,QAAQ,CAACW,YAAlB,EAAgC,GAAhC,CAAH;AACAq6C,MAAAA,WAAW,CAAC5nE,KAAD,EAAQxJ,KAAR,EAAeiY,MAAf,CAAX;AACD,KAND;;AAOA,WAAO;AACLquD,MAAAA,iBAAiB,EAAEA,iBADd;AAELxtC,MAAAA,KAAK,EAAEA,KAFF;AAGLktC,MAAAA,WAAW,EAAEA,WAHR;AAILtkD,MAAAA,gBAAgB,EAAE0U,QAAQ,CAAC1U,gBAJtB;AAKLzC,MAAAA,qBAAqB,EAAEmX,QAAQ,CAACnX,qBAL3B;AAMLH,MAAAA,oBAAoB,EAAEsX,QAAQ,CAACtX;AAN1B,KAAP;AAQD,GAhCD;;AAiCA,MAAI0yD,mBAAmB,GAAG;AACxBR,IAAAA,OAAO,EAAEA,OADe;AAExBG,IAAAA,MAAM,EAAEA;AAFgB,GAA1B;;AAKA,MAAIM,gBAAgB,GAAG,UAAU/oE,IAAV,EAAgBkoB,aAAhB,EAA+BwG,UAA/B,EAA2C;AAChE,QAAIs6C,MAAM,GAAGhpE,IAAI,CAAC5O,KAAL,CAAW,CAAX,EAAc82B,aAAa,CAACA,aAAa,CAAC16B,MAAd,GAAuB,CAAxB,CAAb,CAAwC4S,GAAxC,GAA8C,CAA5D,CAAb;AACA,QAAI6oE,SAAS,GAAGn7B,YAAY,CAACk7B,MAAD,EAASt6C,UAAT,CAA5B;AACA,WAAOx+B,IAAI,CAAC+4E,SAAD,EAAY,UAAU3oE,MAAV,EAAkB;AACvC,UAAI4oE,WAAW,GAAG5oE,MAAM,CAACQ,KAAP,CAAa1P,KAAb,CAAmB,CAAnB,EAAsB82B,aAAa,CAACA,aAAa,CAAC16B,MAAd,GAAuB,CAAxB,CAAb,CAAwC6S,MAAxC,GAAiD,CAAvE,CAAlB;AACA,aAAOrQ,GAAG,CAACk5E,WAAD,EAAc,UAAU5gE,IAAV,EAAgB;AACtC,eAAOA,IAAI,CAACnL,OAAZ;AACD,OAFS,CAAV;AAGD,KALU,CAAX;AAMD,GATD;;AAUA,MAAIgsE,mBAAmB,GAAG,UAAUnpE,IAAV,EAAgBkoB,aAAhB,EAA+BwG,UAA/B,EAA2C;AACnE,QAAI06C,QAAQ,GAAGppE,IAAI,CAAC5O,KAAL,CAAW82B,aAAa,CAAC,CAAD,CAAb,CAAiB9nB,GAAjB,GAAuB8nB,aAAa,CAAC,CAAD,CAAb,CAAiB3nB,OAAxC,GAAkD,CAA7D,EAAgEP,IAAI,CAACxS,MAArE,CAAf;AACA,QAAI67E,WAAW,GAAGv7B,YAAY,CAACs7B,QAAD,EAAW16C,UAAX,CAA9B;AACA,WAAOx+B,IAAI,CAACm5E,WAAD,EAAc,UAAU/oE,MAAV,EAAkB;AACzC,UAAI4oE,WAAW,GAAG5oE,MAAM,CAACQ,KAAP,CAAa1P,KAAb,CAAmB82B,aAAa,CAAC,CAAD,CAAb,CAAiB7nB,MAAjB,GAA0B6nB,aAAa,CAAC,CAAD,CAAb,CAAiB1nB,OAA3C,GAAqD,CAAxE,EAA2EF,MAAM,CAACQ,KAAP,CAAatT,MAAxF,CAAlB;AACA,aAAOwC,GAAG,CAACk5E,WAAD,EAAc,UAAU5gE,IAAV,EAAgB;AACtC,eAAOA,IAAI,CAACnL,OAAZ;AACD,OAFS,CAAV;AAGD,KALU,CAAX;AAMD,GATD;;AAUA,MAAImsE,aAAa,GAAG,UAAU9/D,KAAV,EAAiBvR,MAAjB,EAAyBy2B,UAAzB,EAAqC;AACvD,QAAI/iB,SAAS,GAAGkC,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAhB;AACA,QAAIpI,OAAO,GAAG+tC,OAAO,CAACxjC,SAAD,EAAY1T,MAAZ,CAArB;AACA,WAAOmJ,OAAO,CAACpR,GAAR,CAAY,UAAUk4B,aAAV,EAAyB;AAC1C,UAAIloB,IAAI,GAAGstC,MAAM,CAAC3hC,SAAD,EAAY+iB,UAAZ,EAAwB,KAAxB,CAAjB;AACA,UAAI66C,aAAa,GAAGR,gBAAgB,CAAC/oE,IAAD,EAAOkoB,aAAP,EAAsBwG,UAAtB,CAApC;AACA,UAAI86C,gBAAgB,GAAGL,mBAAmB,CAACnpE,IAAD,EAAOkoB,aAAP,EAAsBwG,UAAtB,CAA1C;AACA,aAAO;AACL66C,QAAAA,aAAa,EAAEA,aADV;AAELC,QAAAA,gBAAgB,EAAEA;AAFb,OAAP;AAID,KARM,CAAP;AASD,GAZD;;AAcA,MAAIC,iBAAiB,GAAG,UAAUpnE,CAAV,EAAa;AACnC,WAAO48B,KAAK,CAAC/hC,YAAY,CAACZ,OAAb,CAAqB+F,CAAC,CAACpK,MAAvB,CAAD,EAAiC,2BAAjC,CAAL,KAAuE,KAA9E;AACD,GAFD;;AAGA,WAASyxE,aAAT,CAAwBn9C,MAAxB,EAAgCkd,UAAhC,EAA4C+b,gBAA5C,EAA8D;AAC5D,QAAIkjB,WAAW,GAAG,UAAU5nE,KAAV,EAAiBxJ,KAAjB,EAAwBiY,MAAxB,EAAgC;AAChDi2C,MAAAA,gBAAgB,CAAC11B,OAAjB,GAA2B7/B,IAA3B,CAAgC,UAAU6/B,OAAV,EAAmB;AACjD,YAAItjB,QAAQ,GAAGhD,KAAK,CAAClS,KAAD,CAApB;AACAkV,QAAAA,QAAQ,CAACvc,IAAT,CAAc,UAAUuZ,KAAV,EAAiB;AAC7B,cAAImhB,YAAY,GAAGmd,gBAAgB,CAACvb,MAAD,CAAnC;AACA,cAAImC,UAAU,GAAGnD,cAAc,CAACt+B,IAAD,EAAOiQ,YAAY,CAACZ,OAAb,CAAqBiwB,MAAM,CAACsD,MAAP,EAArB,CAAP,EAA8ClF,YAA9C,CAA/B;AACA,cAAIwa,UAAU,GAAGmkC,aAAa,CAAC9/D,KAAD,EAAQsmB,OAAR,EAAiBpB,UAAjB,CAA9B;AACAwW,UAAAA,wBAAwB,CAAC3Y,MAAD,EAASzrB,KAAT,EAAgBxJ,KAAhB,EAAuBiY,MAAvB,EAA+B41B,UAA/B,CAAxB;AACD,SALD;AAMD,OARD;AASD,KAVD;;AAWA,QAAIwjC,OAAO,GAAG,YAAY;AACxB,aAAOvjC,uBAAuB,CAAC7Y,MAAD,CAA9B;AACD,KAFD;;AAGA,QAAIkxC,WAAW,GAAGqL,mBAAmB,CAACL,MAApB,CAA2B/6C,QAA3B,EAAqCg7C,WAArC,EAAkDC,OAAlD,CAAlB;AACAp8C,IAAAA,MAAM,CAAC8C,EAAP,CAAU,MAAV,EAAkB,UAAUs6C,EAAV,EAAc;AAC9B,UAAIrsD,GAAG,GAAGiP,MAAM,CAACgpC,MAAP,EAAV;AACA,UAAI3wD,IAAI,GAAG0nB,SAAS,CAACC,MAAD,CAApB;AACA,UAAIzpB,MAAM,GAAGyS,SAAS,CAACgX,MAAD,CAAtB;;AACA,UAAIq9C,aAAa,GAAG,YAAY;AAC9B,YAAI9N,GAAG,GAAGvvC,MAAM,CAACa,SAAjB;AACA,YAAI91B,KAAK,GAAG4F,YAAY,CAACZ,OAAb,CAAqBw/D,GAAG,CAAC/iD,QAAJ,EAArB,CAAZ;AACA,YAAI7E,GAAG,GAAGhX,YAAY,CAACZ,OAAb,CAAqBw/D,GAAG,CAAChyC,MAAJ,EAArB,CAAV;AACA,YAAIlV,MAAM,GAAGK,WAAW,CAACzL,KAAD,EAAQ,CAC9BlS,KAD8B,EAE9B4c,GAF8B,CAAR,CAAxB;AAIAU,QAAAA,MAAM,CAACvlB,IAAP,CAAY,YAAY;AACtB,iBAAOouE,WAAW,CAACrtC,KAAZ,CAAkBxrB,IAAlB,CAAP;AACD,SAFD,EAEG3X,IAFH;AAGD,OAXD;;AAYA,UAAI48E,aAAa,GAAGnC,KAAK,CAACpqD,GAAD,EAAM1Y,IAAN,EAAY9B,MAAZ,EAAoB26D,WAApB,CAAzB;AACA,UAAIqM,WAAW,GAAGnC,QAAQ,CAACrqD,GAAD,EAAM1Y,IAAN,EAAY9B,MAAZ,EAAoB26D,WAApB,CAA1B;AACA,UAAIsM,UAAU,GAAG5B,QAAQ,CAAC7qD,GAAD,EAAM1Y,IAAN,EAAY9B,MAAZ,EAAoB26D,WAApB,CAAzB;;AACA,UAAIuM,WAAW,GAAG,UAAU3lE,KAAV,EAAiB;AACjC,eAAOA,KAAK,CAAC0D,GAAN,CAAU+0D,QAAV,KAAuB,IAA9B;AACD,OAFD;;AAGAvwC,MAAAA,MAAM,CAAC8C,EAAP,CAAU,qBAAV,EAAiC,UAAUhtB,CAAV,EAAa;AAC5C,eAAO0nE,UAAU,CAAC1nE,CAAC,CAAC/K,KAAH,EAAU+K,CAAC,CAACkN,MAAZ,CAAjB;AACD,OAFD;;AAGA,UAAI06D,cAAc,GAAG,UAAU5lE,KAAV,EAAiB6lE,QAAjB,EAA2B;AAC9C,YAAI,CAACF,WAAW,CAAC3lE,KAAD,CAAhB,EAAyB;AACvB;AACD;;AACD,YAAI6lE,QAAQ,CAAC9sC,IAAb,EAAmB;AACjB/4B,UAAAA,KAAK,CAAC+4B,IAAN;AACD;;AACD8sC,QAAAA,QAAQ,CAAC98C,SAAT,CAAmBn9B,IAAnB,CAAwB,UAAUk6E,EAAV,EAAc;AACpC,cAAIrqD,QAAQ,GAAG21C,YAAY,CAAC31C,QAAb,CAAsBqqD,EAAE,CAAC7yE,KAAzB,EAAgC6yE,EAAE,CAAC56D,MAAnC,CAAf;AACA,cAAI2gB,GAAG,GAAGqnC,UAAU,CAACj6C,GAAD,EAAMwC,QAAN,CAApB;AACAyM,UAAAA,MAAM,CAACa,SAAP,CAAiB6C,MAAjB,CAAwBC,GAAxB;AACD,SAJD;AAKD,OAZD;;AAaA,UAAIg4C,KAAK,GAAG,UAAU7jE,KAAV,EAAiB;AAC3B,YAAI+lE,YAAY,GAAGjsC,cAAc,CAAC95B,KAAD,CAAjC;;AACA,YAAI+lE,YAAY,CAACriE,GAAb,CAAiB+0D,QAAjB,IAA6B0J,YAAY,CAAC4D,YAAY,CAACriE,GAAb,CAAiBggE,KAAlB,CAA7C,EAAuE;AACrE,cAAI73C,GAAG,GAAG3D,MAAM,CAACa,SAAP,CAAiB+c,MAAjB,EAAV;AACA,cAAI7yC,KAAK,GAAG4F,YAAY,CAACZ,OAAb,CAAqB4zB,GAAG,CAAC+kC,cAAzB,CAAZ;AACA,cAAI/gD,GAAG,GAAGhX,YAAY,CAACZ,OAAb,CAAqB4zB,GAAG,CAAC4mC,YAAzB,CAAV;AACAgT,UAAAA,WAAW,CAAC5B,KAAZ,CAAkBkC,YAAlB,EAAgC9yE,KAAhC,EAAuC44B,GAAG,CAAC2mC,WAA3C,EAAwD3iD,GAAxD,EAA6Dgc,GAAG,CAAC6mC,SAAjE,EAA4E9mE,IAA5E,CAAiF,UAAUi6E,QAAV,EAAoB;AACnGD,YAAAA,cAAc,CAACG,YAAD,EAAeF,QAAf,CAAd;AACD,WAFD;AAGD;AACF,OAVD;;AAWA,UAAIrC,OAAO,GAAG,UAAUxjE,KAAV,EAAiB;AAC7B,YAAI+lE,YAAY,GAAGjsC,cAAc,CAAC95B,KAAD,CAAjC;AACAolC,QAAAA,UAAU,GAAGx5C,IAAb,CAAkB,UAAU0gC,MAAV,EAAkB;AAClC,iBAAOA,MAAM,CAACsT,QAAP,EAAP;AACD,SAFD;AAGA,YAAI/T,GAAG,GAAG3D,MAAM,CAACa,SAAP,CAAiB+c,MAAjB,EAAV;AACA,YAAI7yC,KAAK,GAAG4F,YAAY,CAACZ,OAAb,CAAqB4zB,GAAG,CAAC+kC,cAAzB,CAAZ;AACA,YAAI/gD,GAAG,GAAGhX,YAAY,CAACZ,OAAb,CAAqB4zB,GAAG,CAAC4mC,YAAzB,CAAV;AACA,YAAI3wC,SAAS,GAAG9J,WAAW,CAACoqD,KAAD,EAAQG,KAAR,CAAX,CAA0B1pE,YAAY,CAACZ,OAAb,CAAqBiwB,MAAM,CAACa,SAAP,CAAiBrU,QAAjB,EAArB,CAA1B,CAAhB;AACA+wD,QAAAA,WAAW,CAACjC,OAAZ,CAAoBuC,YAApB,EAAkC9yE,KAAlC,EAAyC44B,GAAG,CAAC2mC,WAA7C,EAA0D3iD,GAA1D,EAA+Dgc,GAAG,CAAC6mC,SAAnE,EAA8E5wC,SAA9E,EAAyFl2B,IAAzF,CAA8F,UAAUi6E,QAAV,EAAoB;AAChHD,UAAAA,cAAc,CAACG,YAAD,EAAeF,QAAf,CAAd;AACD,SAFD;AAGAzgC,QAAAA,UAAU,GAAGx5C,IAAb,CAAkB,UAAU0gC,MAAV,EAAkB;AAClC,iBAAOA,MAAM,CAACuT,QAAP,EAAP;AACD,SAFD;AAGD,OAfD;;AAgBA,UAAImmC,WAAW,GAAG,UAAUtiE,GAAV,EAAe;AAC/B,eAAOA,GAAG,CAACuiE,MAAJ,KAAe,CAAtB;AACD,OAFD;;AAGA,UAAIC,mBAAmB,GAAG,UAAUxiE,GAAV,EAAe;AACvC,YAAIA,GAAG,CAAColD,OAAJ,KAAgBvgE,SAApB,EAA+B;AAC7B,iBAAO,IAAP;AACD;;AACD,YAAIshE,QAAQ,CAAC15D,OAAT,CAAiBsE,MAAjB,MAA6BiP,GAAG,CAAColD,OAAJ,KAAgB,CAAjD,EAAoD;AAClD,iBAAO,IAAP;AACD;;AACD,eAAO,CAACplD,GAAG,CAAColD,OAAJ,GAAc,CAAf,MAAsB,CAA7B;AACD,OARD;;AASA,UAAIqd,SAAS,GAAG,UAAUb,EAAV,EAAc;AAC5BE,QAAAA,aAAa,CAAC7D,UAAd;AACD,OAFD;;AAGA,UAAIyE,SAAS,GAAG,UAAUpoE,CAAV,EAAa;AAC3B,YAAIgoE,WAAW,CAAChoE,CAAD,CAAX,IAAkBonE,iBAAiB,CAACpnE,CAAD,CAAvC,EAA4C;AAC1CwnE,UAAAA,aAAa,CAAClmC,SAAd,CAAwBxF,cAAc,CAAC97B,CAAD,CAAtC;AACD;AACF,OAJD;;AAKA,UAAIqoE,SAAS,GAAG,UAAUroE,CAAV,EAAa;AAC3B,YAAIkoE,mBAAmB,CAACloE,CAAD,CAAnB,IAA0BonE,iBAAiB,CAACpnE,CAAD,CAA/C,EAAoD;AAClDwnE,UAAAA,aAAa,CAAChmC,SAAd,CAAwB1F,cAAc,CAAC97B,CAAD,CAAtC;AACD;AACF,OAJD;;AAKA,UAAIsoE,OAAO,GAAG,UAAUtoE,CAAV,EAAa;AACzB,YAAIgoE,WAAW,CAAChoE,CAAD,CAAX,IAAkBonE,iBAAiB,CAACpnE,CAAD,CAAvC,EAA4C;AAC1CwnE,UAAAA,aAAa,CAAC1D,OAAd,CAAsBhoC,cAAc,CAAC97B,CAAD,CAApC;AACD;AACF,OAJD;;AAKA,UAAIuoE,YAAY,GAAG,YAAY;AAC7B,YAAIC,UAAU,GAAGvkD,IAAI,CAACppB,YAAY,CAACZ,OAAb,CAAqBsI,IAArB,CAAD,CAArB;AACA,YAAIkmE,aAAa,GAAGxkD,IAAI,CAAC,CAAD,CAAxB;;AACA,YAAIykD,QAAQ,GAAG,UAAUr/E,CAAV,EAAa;AAC1B,cAAIuM,MAAM,GAAGiF,YAAY,CAACZ,OAAb,CAAqB5Q,CAAC,CAACuM,MAAvB,CAAb;;AACA,cAAIlM,IAAI,CAACkM,MAAD,CAAJ,KAAiB,IAAjB,IAAyBlM,IAAI,CAACkM,MAAD,CAAJ,KAAiB,IAA9C,EAAoD;AAClD,gBAAI+yE,EAAE,GAAGH,UAAU,CAACv3E,GAAX,EAAT;AACA,gBAAI23E,GAAG,GAAGH,aAAa,CAACx3E,GAAd,EAAV;;AACA,gBAAI0K,IAAI,CAACgtE,EAAD,EAAK/yE,MAAL,CAAJ,IAAoBvM,CAAC,CAACw/E,SAAF,GAAcD,GAAd,GAAoB,GAA5C,EAAiD;AAC/Cv/E,cAAAA,CAAC,CAAC6jC,cAAF;AACAw6C,cAAAA,UAAU,CAAC9xE,MAAD,EAASA,MAAT,CAAV;AACD;AACF;;AACD4yE,UAAAA,UAAU,CAACzkE,GAAX,CAAenO,MAAf;AACA6yE,UAAAA,aAAa,CAAC1kE,GAAd,CAAkB1a,CAAC,CAACw/E,SAApB;AACD,SAZD;;AAaA,eAAO;AAAEH,UAAAA,QAAQ,EAAEA;AAAZ,SAAP;AACD,OAjBD;;AAkBA,UAAII,SAAS,GAAGP,YAAY,EAA5B;AACAr+C,MAAAA,MAAM,CAAC8C,EAAP,CAAU,WAAV,EAAuBm7C,SAAvB;AACAj+C,MAAAA,MAAM,CAAC8C,EAAP,CAAU,WAAV,EAAuBo7C,SAAvB;AACAl+C,MAAAA,MAAM,CAAC8C,EAAP,CAAU,WAAV,EAAuBq7C,SAAvB;AACAn+C,MAAAA,MAAM,CAAC8C,EAAP,CAAU,SAAV,EAAqBs7C,OAArB;AACAp+C,MAAAA,MAAM,CAAC8C,EAAP,CAAU,UAAV,EAAsB87C,SAAS,CAACJ,QAAhC;AACAx+C,MAAAA,MAAM,CAAC8C,EAAP,CAAU,OAAV,EAAmB64C,KAAnB;AACA37C,MAAAA,MAAM,CAAC8C,EAAP,CAAU,SAAV,EAAqBw4C,OAArB;AACAt7C,MAAAA,MAAM,CAAC8C,EAAP,CAAU,YAAV,EAAwBu6C,aAAxB;AACD,KA1HD;AA2HA,WAAO;AAAEx5C,MAAAA,KAAK,EAAEqtC,WAAW,CAACrtC;AAArB,KAAP;AACD;;AAED,MAAIg7C,mBAAmB,GAAG,UAAU7+C,MAAV,EAAkBc,UAAlB,EAA8B;AACtD,QAAIyC,OAAO,GAAGxJ,IAAI,CAACp1B,QAAQ,CAACtC,IAAT,EAAD,CAAlB;AACA,QAAIy8E,cAAc,GAAG/kD,IAAI,CAAC,EAAD,CAAzB;AACA,QAAIglD,gBAAgB,GAAGp6E,QAAQ,CAACtC,IAAT,EAAvB;AACA,QAAI28E,SAAS,GAAGnpE,KAAK,CAAC,SAAD,CAArB;;AACA,QAAIopE,sBAAsB,GAAG,UAAU/rE,GAAV,EAAe;AAC1C,aAAO6rE,gBAAgB,CAACl7E,MAAjB,CAAwB,UAAUgR,OAAV,EAAmB;AAChD,eAAO,CAACA,OAAO,CAAC3B,GAAD,CAAf;AACD,OAFM,CAAP;AAGD,KAJD;;AAKA,QAAIgsE,WAAW,GAAG,YAAY;AAC5B,aAAOzrB,8BAA8B,CAAC7yB,iBAAiB,CAACZ,MAAD,CAAlB,EAA4BhX,SAAS,CAACgX,MAAD,CAArC,CAA9B,CAA6Er8B,IAA7E,CAAkF,UAAUy/D,aAAV,EAAyB;AAChH,YAAI+b,OAAO,GAAGliE,KAAK,CAACmmD,aAAD,CAAnB;AACA,eAAO+b,OAAO,CAAC17E,GAAR,CAAY,UAAUwZ,KAAV,EAAiB;AAClC,cAAI+hE,SAAS,CAAC5b,aAAD,CAAb,EAA8B;AAC5B,mBAAOrhC,MAAM,CAACqhC,aAAD,CAAb;AACD,WAFD,MAEO;AACL,mBAAOphC,OAAO,CAAClB,UAAD,EAAa7jB,KAAb,EAAoBmmD,aAApB,CAAd;AACD;AACF,SANM,CAAP;AAOD,OATM,CAAP;AAUD,KAXD;;AAYA,QAAIgc,mBAAmB,GAAG,UAAU77C,OAAV,EAAmB;AAC3C,UAAItjB,QAAQ,GAAGhD,KAAK,CAACsmB,OAAO,CAAC3yB,OAAT,CAApB;AACA,aAAOqP,QAAQ,CAACxc,GAAT,CAAa,UAAUwZ,KAAV,EAAiB;AACnC,YAAImC,SAAS,GAAGkC,SAAS,CAAC/D,SAAV,CAAoBN,KAApB,CAAhB;AACA,YAAI0e,aAAa,GAAGinB,OAAO,CAACxjC,SAAD,EAAYmkB,OAAZ,CAAP,CAA4BrgC,KAA5B,CAAkC,EAAlC,CAApB;AACA,YAAI6b,MAAM,GAAG5Y,KAAK,CAACw1B,aAAD,EAAgB,UAAUz1B,GAAV,EAAe6V,IAAf,EAAqB;AACrD,cAAIA,IAAI,CAAC1H,QAAT,EAAmB;AACjBnO,YAAAA,GAAG,CAACm5E,KAAJ,GAAY,IAAZ;;AACA,gBAAItjE,IAAI,CAACjI,MAAL,KAAgB,CAApB,EAAuB;AACrB5N,cAAAA,GAAG,CAACo5E,OAAJ,GAAc,IAAd;AACD,aAFD,MAEO,IAAIvjE,IAAI,CAACjI,MAAL,GAAciI,IAAI,CAAC9H,OAAnB,IAA8BmL,SAAS,CAAC3L,IAAV,CAAeE,OAAjD,EAA0D;AAC/DzN,cAAAA,GAAG,CAACq5E,MAAJ,GAAa,IAAb;AACD;AACF;;AACD,iBAAOr5E,GAAP;AACD,SAViB,EAUf;AACDm5E,UAAAA,KAAK,EAAE,KADN;AAEDC,UAAAA,OAAO,EAAE,KAFR;AAGDC,UAAAA,MAAM,EAAE;AAHP,SAVe,CAAlB;AAeA,eAAO;AACLr8B,UAAAA,SAAS,EAAED,kBAAkB,CAAC7jC,SAAD,EAAYmkB,OAAZ,CAAlB,CAAuCtgC,MAAvC,EADN;AAELu8E,UAAAA,WAAW,EAAEr8B,oBAAoB,CAAC/jC,SAAD,EAAYmkB,OAAZ,CAApB,CAAyCtgC,MAAzC,EAFR;AAGL8b,UAAAA,MAAM,EAAEA;AAHH,SAAP;AAKD,OAvBM,CAAP;AAwBD,KA1BD;;AA2BA,QAAI0gE,YAAY,GAAG,YAAY;AAC7Bl8C,MAAAA,OAAO,CAAC1pB,GAAR,CAAYhS,MAAM,CAACq3E,WAAD,CAAN,EAAZ;AACAH,MAAAA,gBAAgB,GAAGx7C,OAAO,CAACx8B,GAAR,GAAcpD,IAAd,CAAmBy7E,mBAAnB,CAAnB;AACA17E,MAAAA,IAAI,CAACo7E,cAAc,CAAC/3E,GAAf,EAAD,EAAuB,UAAU0lC,OAAV,EAAmB;AAC5C,eAAOA,OAAO,EAAd;AACD,OAFG,CAAJ;AAGD,KAND;;AAOA,QAAIizC,OAAO,GAAG,UAAU/5D,GAAV,EAAeg6D,UAAf,EAA2B;AACvC,UAAIlzC,OAAO,GAAG,YAAY;AACxB,eAAOlJ,OAAO,CAACx8B,GAAR,GAAcjE,IAAd,CAAmB,YAAY;AACpC6iB,UAAAA,GAAG,CAACi6D,WAAJ,CAAgB,IAAhB;AACD,SAFM,EAEJ,UAAUr8C,OAAV,EAAmB;AACpB5d,UAAAA,GAAG,CAACi6D,WAAJ,CAAgBD,UAAU,CAACp8C,OAAD,CAA1B;AACD,SAJM,CAAP;AAKD,OAND;;AAOAkJ,MAAAA,OAAO;AACPqyC,MAAAA,cAAc,CAACjlE,GAAf,CAAmBilE,cAAc,CAAC/3E,GAAf,GAAqBlF,MAArB,CAA4B,CAAC4qC,OAAD,CAA5B,CAAnB;AACA,aAAO,YAAY;AACjBqyC,QAAAA,cAAc,CAACjlE,GAAf,CAAmB/V,MAAM,CAACg7E,cAAc,CAAC/3E,GAAf,EAAD,EAAuB,UAAU+mB,CAAV,EAAa;AAC3D,iBAAOA,CAAC,KAAK2e,OAAb;AACD,SAFwB,CAAzB;AAGD,OAJD;AAKD,KAfD;;AAgBA,QAAIozC,oBAAoB,GAAG,UAAUC,aAAV,EAAyB;AAClD,aAAOf,gBAAgB,CAACn7E,MAAjB,CAAwB,UAAUiR,OAAV,EAAmB;AAChD,eAAOA,OAAO,CAACkK,MAAR,CAAe+gE,aAAf,CAAP;AACD,OAFM,CAAP;AAGD,KAJD;;AAKA,QAAIC,YAAY,GAAG,UAAUp6D,GAAV,EAAe;AAChC,aAAO+5D,OAAO,CAAC/5D,GAAD,EAAM,UAAU0+B,CAAV,EAAa;AAC/B,eAAO,KAAP;AACD,OAFa,CAAd;AAGD,KAJD;;AAKA,QAAI27B,gBAAgB,GAAG,UAAUr6D,GAAV,EAAe;AACpC,aAAO+5D,OAAO,CAAC/5D,GAAD,EAAM,UAAU4d,OAAV,EAAmB;AACrC,eAAOy7C,SAAS,CAACz7C,OAAO,CAAC3yB,OAAT,CAAhB;AACD,OAFa,CAAd;AAGD,KAJD;;AAKA,QAAIqvE,aAAa,GAAG,UAAUH,aAAV,EAAyB;AAC3C,aAAO,UAAUn6D,GAAV,EAAe;AACpB,eAAO+5D,OAAO,CAAC/5D,GAAD,EAAM,UAAU4d,OAAV,EAAmB;AACrC,iBAAOy7C,SAAS,CAACz7C,OAAO,CAAC3yB,OAAT,CAAT,IAA8BivE,oBAAoB,CAACC,aAAD,CAAzD;AACD,SAFa,CAAd;AAGD,OAJD;AAKD,KAND;;AAOA,QAAII,gBAAgB,GAAG,UAAUC,gBAAV,EAA4B;AACjD,aAAO,UAAUx6D,GAAV,EAAe;AACpB,eAAO+5D,OAAO,CAAC/5D,GAAD,EAAM,UAAU4d,OAAV,EAAmB;AACrC,iBAAOy7C,SAAS,CAACz7C,OAAO,CAAC3yB,OAAT,CAAT,IAA8BuvE,gBAAgB,GAAG39E,MAAnB,EAArC;AACD,SAFa,CAAd;AAGD,OAJD;AAKD,KAND;;AAOA,QAAI49E,sBAAsB,GAAG,UAAUD,gBAAV,EAA4BL,aAA5B,EAA2C;AACtE,aAAO,UAAUn6D,GAAV,EAAe;AACpB,eAAO+5D,OAAO,CAAC/5D,GAAD,EAAM,UAAU4d,OAAV,EAAmB;AACrC,iBAAOy7C,SAAS,CAACz7C,OAAO,CAAC3yB,OAAT,CAAT,IAA8BuvE,gBAAgB,GAAG39E,MAAnB,EAA9B,IAA6Dq9E,oBAAoB,CAACC,aAAD,CAAxF;AACD,SAFa,CAAd;AAGD,OAJD;AAKD,KAND;;AAOA,QAAIO,gBAAgB,GAAG,UAAU16D,GAAV,EAAe;AACpC,aAAO+5D,OAAO,CAAC/5D,GAAD,EAAM,UAAU26D,QAAV,EAAoB;AACtC,eAAOrB,sBAAsB,CAAC,WAAD,CAA7B;AACD,OAFa,CAAd;AAGD,KAJD;;AAKA,QAAIsB,kBAAkB,GAAG,UAAU56D,GAAV,EAAe;AACtC,aAAO+5D,OAAO,CAAC/5D,GAAD,EAAM,UAAU26D,QAAV,EAAoB;AACtC,eAAOrB,sBAAsB,CAAC,aAAD,CAA7B;AACD,OAFa,CAAd;AAGD,KAJD;;AAKAj/C,IAAAA,MAAM,CAAC8C,EAAP,CAAU,4CAAV,EAAwD28C,YAAxD;AACA,WAAO;AACLM,MAAAA,YAAY,EAAEA,YADT;AAELC,MAAAA,gBAAgB,EAAEA,gBAFb;AAGLC,MAAAA,aAAa,EAAEA,aAHV;AAILC,MAAAA,gBAAgB,EAAEA,gBAJb;AAKLE,MAAAA,sBAAsB,EAAEA,sBALnB;AAMLC,MAAAA,gBAAgB,EAAEA,gBANb;AAOLE,MAAAA,kBAAkB,EAAEA,kBAPf;AAQLd,MAAAA,YAAY,EAAEA,YART;AASLl8C,MAAAA,OAAO,EAAE,YAAY;AACnB,eAAOA,OAAO,CAACx8B,GAAR,EAAP;AACD;AAXI,KAAP;AAaD,GApID;;AAsIA,MAAIy5E,UAAU,GAAG,UAAUxgD,MAAV,EAAkBi5B,gBAAlB,EAAoC/2B,SAApC,EAA+C;AAC9DlC,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB4zC,aAAnB,CAAiC,OAAjC,EAA0C;AACxCC,MAAAA,OAAO,EAAE,OAD+B;AAExCC,MAAAA,IAAI,EAAE,OAFkC;AAGxCC,MAAAA,KAAK,EAAE,UAAUC,QAAV,EAAoB;AACzB,eAAOA,QAAQ,CAAC,uEAAD,CAAf;AACD;AALuC,KAA1C;;AAOA,QAAIC,GAAG,GAAG,UAAUC,OAAV,EAAmB;AAC3B,aAAO,YAAY;AACjB,eAAO/gD,MAAM,CAACgwC,WAAP,CAAmB+Q,OAAnB,CAAP;AACD,OAFD;AAGD,KAJD;;AAKA/gD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,YAA7B,EAA2C;AACzCN,MAAAA,OAAO,EAAE,kBADgC;AAEzCO,MAAAA,QAAQ,EAAEH,GAAG,CAAC,eAAD,CAF4B;AAGzCH,MAAAA,IAAI,EAAE,OAHmC;AAIzCjB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC8mB;AAJe,KAA3C;AAMA//C,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,aAA7B,EAA4C;AAC1CN,MAAAA,OAAO,EAAE,cADiC;AAE1CO,MAAAA,QAAQ,EAAEH,GAAG,CAAC,gBAAD,CAF6B;AAG1CH,MAAAA,IAAI,EAAE,oBAHoC;AAI1CjB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC8mB;AAJgB,KAA5C;AAMA//C,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,gBAA7B,EAA+C;AAC7CN,MAAAA,OAAO,EAAE,iBADoC;AAE7CO,MAAAA,QAAQ,EAAEH,GAAG,CAAC,mBAAD,CAFgC;AAG7CH,MAAAA,IAAI,EAAE,uBAHuC;AAI7CjB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC+mB;AAJmB,KAA/C;AAMAhgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,iBAA7B,EAAgD;AAC9CN,MAAAA,OAAO,EAAE,aADqC;AAE9CO,MAAAA,QAAQ,EAAEH,GAAG,CAAC,oBAAD,CAFiC;AAG9CH,MAAAA,IAAI,EAAE,mBAHwC;AAI9CjB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAConB;AAJoB,KAAhD;AAMArgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,iBAA7B,EAAgD;AAC9CN,MAAAA,OAAO,EAAE,YADqC;AAE9CO,MAAAA,QAAQ,EAAEH,GAAG,CAAC,oBAAD,CAFiC;AAG9CH,MAAAA,IAAI,EAAE,mBAHwC;AAI9CjB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACsnB;AAJoB,KAAhD;AAMAvgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,sBAA7B,EAAqD;AACnDN,MAAAA,OAAO,EAAE,mBAD0C;AAEnDO,MAAAA,QAAQ,EAAEH,GAAG,CAAC,yBAAD,CAFsC;AAGnDH,MAAAA,IAAI,EAAE,wBAH6C;AAInDjB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC+mB;AAJyB,KAArD;AAMAhgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,qBAA7B,EAAoD;AAClDN,MAAAA,OAAO,EAAE,kBADyC;AAElDO,MAAAA,QAAQ,EAAEH,GAAG,CAAC,wBAAD,CAFqC;AAGlDH,MAAAA,IAAI,EAAE,wBAH4C;AAIlDjB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC+mB;AAJwB,KAApD;AAMAhgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,gBAA7B,EAA+C;AAC7CN,MAAAA,OAAO,EAAE,YADoC;AAE7CO,MAAAA,QAAQ,EAAEH,GAAG,CAAC,mBAAD,CAFgC;AAG7CH,MAAAA,IAAI,EAAE,kBAHuC;AAI7CjB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC+mB;AAJmB,KAA/C;AAMAhgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,eAA7B,EAA8C;AAC5CN,MAAAA,OAAO,EAAE,gBADmC;AAE5CO,MAAAA,QAAQ,EAAEH,GAAG,CAAC,kBAAD,CAF+B;AAG5CH,MAAAA,IAAI,EAAE,sBAHsC;AAI5CjB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC+mB;AAJkB,KAA9C;AAMAhgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,sBAA7B,EAAqD;AACnDN,MAAAA,OAAO,EAAE,sBAD0C;AAEnDO,MAAAA,QAAQ,EAAEH,GAAG,CAAC,yBAAD,CAFsC;AAGnDH,MAAAA,IAAI,EAAE,4BAH6C;AAInDjB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACgnB,aAAjB,CAA+B,SAA/B;AAJ0C,KAArD;AAMAjgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,qBAA7B,EAAoD;AAClDN,MAAAA,OAAO,EAAE,qBADyC;AAElDO,MAAAA,QAAQ,EAAEH,GAAG,CAAC,wBAAD,CAFqC;AAGlDH,MAAAA,IAAI,EAAE,2BAH4C;AAIlDjB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACgnB,aAAjB,CAA+B,QAA/B;AAJyC,KAApD;AAMAjgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,gBAA7B,EAA+C;AAC7CN,MAAAA,OAAO,EAAE,eADoC;AAE7CO,MAAAA,QAAQ,EAAEH,GAAG,CAAC,mBAAD,CAFgC;AAG7CH,MAAAA,IAAI,EAAE,qBAHuC;AAI7CjB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACgnB,aAAjB,CAA+B,OAA/B;AAJoC,KAA/C;AAMAjgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,aAA7B,EAA4C;AAC1CN,MAAAA,OAAO,EAAE,SADiC;AAE1CC,MAAAA,IAAI,EAAE,SAFoC;AAG1CM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,gBAAD,CAH6B;AAI1CpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC+mB;AAJgB,KAA5C;AAMAhgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,cAA7B,EAA6C;AAC3CN,MAAAA,OAAO,EAAE,UADkC;AAE3CC,MAAAA,IAAI,EAAE,eAFqC;AAG3CM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,iBAAD,CAH8B;AAI3CpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC+mB;AAJiB,KAA7C;AAMAhgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,qBAA7B,EAAoD;AAClDN,MAAAA,OAAO,EAAE,kBADyC;AAElDC,MAAAA,IAAI,EAAE,kBAF4C;AAGlDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,wBAAD,CAHqC;AAIlDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACinB,gBAAjB,CAAkCh+C,SAAS,CAACm3B,OAA5C;AAJyC,KAApD;AAMAr5B,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,oBAA7B,EAAmD;AACjDN,MAAAA,OAAO,EAAE,iBADwC;AAEjDC,MAAAA,IAAI,EAAE,iBAF2C;AAGjDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,uBAAD,CAHoC;AAIjDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACinB,gBAAjB,CAAkCh+C,SAAS,CAACm3B,OAA5C;AAJwC,KAAnD;AAMAr5B,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,aAA7B,EAA4C;AAC1CN,MAAAA,OAAO,EAAE,YADiC;AAE1CC,MAAAA,IAAI,EAAE,YAFoC;AAG1CM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,gBAAD,CAH6B;AAI1CpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACgnB,aAAjB,CAA+B,OAA/B;AAJiC,KAA5C;AAMAjgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,cAA7B,EAA6C;AAC3CN,MAAAA,OAAO,EAAE,aADkC;AAE3CC,MAAAA,IAAI,EAAE,kBAFqC;AAG3CM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,iBAAD,CAH8B;AAI3CpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACgnB,aAAjB,CAA+B,OAA/B;AAJkC,KAA7C;AAMAjgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,qBAA7B,EAAoD;AAClDN,MAAAA,OAAO,EAAE,qBADyC;AAElDC,MAAAA,IAAI,EAAE,qBAF4C;AAGlDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,wBAAD,CAHqC;AAIlDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACmnB,sBAAjB,CAAwCl+C,SAAS,CAACu3B,UAAlD,EAA8D,SAA9D;AAJyC,KAApD;AAMAz5B,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,oBAA7B,EAAmD;AACjDN,MAAAA,OAAO,EAAE,oBADwC;AAEjDC,MAAAA,IAAI,EAAE,oBAF2C;AAGjDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,uBAAD,CAHoC;AAIjDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACmnB,sBAAjB,CAAwCl+C,SAAS,CAACu3B,UAAlD,EAA8D,QAA9D;AAJwC,KAAnD;AAMAz5B,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBm0C,SAAnB,CAA6B,mBAA7B,EAAkD;AAChDN,MAAAA,OAAO,EAAE,cADuC;AAEhDO,MAAAA,QAAQ,EAAEH,GAAG,CAAC,gBAAD,CAFmC;AAGhDH,MAAAA,IAAI,EAAE;AAH0C,KAAlD;AAKD,GA1ID;;AA2IA,MAAIO,WAAW,GAAG,UAAUlhD,MAAV,EAAkB;AAClC,QAAIqD,OAAO,GAAG,UAAUpmB,KAAV,EAAiB;AAC7B,aAAO+iB,MAAM,CAAC1vB,GAAP,CAAWtN,EAAX,CAAcia,KAAd,EAAqB,OAArB,KAAiC+iB,MAAM,CAAC1nB,OAAP,GAAiBlT,QAAjB,CAA0B6X,KAA1B,CAAxC;AACD,KAFD;;AAGA,QAAIkkE,OAAO,GAAGtmC,UAAU,CAAC7a,MAAD,CAAxB;;AACA,QAAImhD,OAAO,CAAClgF,MAAR,GAAiB,CAArB,EAAwB;AACtB++B,MAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBu0C,iBAAnB,CAAqC,OAArC,EAA8C;AAC5C5oE,QAAAA,SAAS,EAAE6qB,OADiC;AAE5Cw4B,QAAAA,KAAK,EAAEslB,OAFqC;AAG5C9xE,QAAAA,KAAK,EAAE,MAHqC;AAI5C2jC,QAAAA,QAAQ,EAAE;AAJkC,OAA9C;AAMD;AACF,GAbD;;AAeA,MAAIquC,YAAY,GAAG,UAAUrhD,MAAV,EAAkBi5B,gBAAlB,EAAoC/2B,SAApC,EAA+C;AAChE,QAAI4+C,GAAG,GAAG,UAAUC,OAAV,EAAmB;AAC3B,aAAO,YAAY;AACjB,eAAO/gD,MAAM,CAACgwC,WAAP,CAAmB+Q,OAAnB,CAAP;AACD,OAFD;AAGD,KAJD;;AAKA,QAAIO,iBAAiB,GAAG,UAAU79C,IAAV,EAAgB;AACtCzD,MAAAA,MAAM,CAACgwC,WAAP,CAAmB,gBAAnB,EAAqC,KAArC,EAA4C;AAC1Ct8D,QAAAA,IAAI,EAAE+vB,IAAI,CAAC6zB,OAD+B;AAE1C3jD,QAAAA,OAAO,EAAE8vB,IAAI,CAAC89C;AAF4B,OAA5C;AAID,KALD;;AAMA,QAAIC,eAAe,GAAG;AACpBpxE,MAAAA,IAAI,EAAE,kBADc;AAEpBsvE,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC8mB,YAFN;AAGpBkB,MAAAA,QAAQ,EAAEH,GAAG,CAAC,eAAD;AAHO,KAAtB;AAKA,QAAIW,WAAW,GAAG;AAChBrxE,MAAAA,IAAI,EAAE,cADU;AAEhBuwE,MAAAA,IAAI,EAAE,oBAFU;AAGhBjB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC8mB,YAHV;AAIhBkB,MAAAA,QAAQ,EAAEH,GAAG,CAAC,gBAAD;AAJG,KAAlB;AAMA9gD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,sBAA/B,EAAuD;AACrDtxE,MAAAA,IAAI,EAAE,mBAD+C;AAErDuwE,MAAAA,IAAI,EAAE,wBAF+C;AAGrDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,yBAAD,CAHwC;AAIrDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC+mB;AAJ2B,KAAvD;AAMAhgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,qBAA/B,EAAsD;AACpDtxE,MAAAA,IAAI,EAAE,kBAD8C;AAEpDuwE,MAAAA,IAAI,EAAE,wBAF8C;AAGpDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,wBAAD,CAHuC;AAIpDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC+mB;AAJ0B,KAAtD;AAMAhgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,gBAA/B,EAAiD;AAC/CtxE,MAAAA,IAAI,EAAE,YADyC;AAE/CuwE,MAAAA,IAAI,EAAE,kBAFyC;AAG/CM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,mBAAD,CAHkC;AAI/CpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC+mB;AAJqB,KAAjD;AAMAhgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,eAA/B,EAAgD;AAC9CtxE,MAAAA,IAAI,EAAE,gBADwC;AAE9CuwE,MAAAA,IAAI,EAAE,sBAFwC;AAG9CM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,kBAAD,CAHiC;AAI9CpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC+mB;AAJoB,KAAhD;AAMAhgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,aAA/B,EAA8C;AAC5CtxE,MAAAA,IAAI,EAAE,SADsC;AAE5CuwE,MAAAA,IAAI,EAAE,SAFsC;AAG5CM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,gBAAD,CAH+B;AAI5CpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC+mB;AAJkB,KAA9C;AAMAhgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,cAA/B,EAA+C;AAC7CtxE,MAAAA,IAAI,EAAE,UADuC;AAE7CuwE,MAAAA,IAAI,EAAE,eAFuC;AAG7CM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,iBAAD,CAHgC;AAI7CpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC+mB;AAJmB,KAA/C;AAMAhgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,qBAA/B,EAAsD;AACpDtxE,MAAAA,IAAI,EAAE,kBAD8C;AAEpDuwE,MAAAA,IAAI,EAAE,kBAF8C;AAGpDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,wBAAD,CAHuC;AAIpDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACinB,gBAAjB,CAAkCh+C,SAAS,CAACm3B,OAA5C;AAJ2C,KAAtD;AAMAr5B,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,oBAA/B,EAAqD;AACnDtxE,MAAAA,IAAI,EAAE,iBAD6C;AAEnDuwE,MAAAA,IAAI,EAAE,iBAF6C;AAGnDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,uBAAD,CAHsC;AAInDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACinB,gBAAjB,CAAkCh+C,SAAS,CAACm3B,OAA5C;AAJ0C,KAArD;AAMA,QAAIxlD,GAAG,GAAG;AACRlU,MAAAA,IAAI,EAAE,gBADE;AAERyQ,MAAAA,IAAI,EAAE,KAFE;AAGRuxE,MAAAA,eAAe,EAAE,YAAY;AAC3B,eAAO,yIAAP;AACD;AALO,KAAV;AAOA3hD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,yBAA/B,EAA0D;AACxDtxE,MAAAA,IAAI,EAAE,sBADkD;AAExDuwE,MAAAA,IAAI,EAAE,4BAFkD;AAGxDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,yBAAD,CAH2C;AAIxDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACgnB,aAAjB,CAA+B,SAA/B;AAJ+C,KAA1D;AAMAjgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,wBAA/B,EAAyD;AACvDtxE,MAAAA,IAAI,EAAE,qBADiD;AAEvDuwE,MAAAA,IAAI,EAAE,2BAFiD;AAGvDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,wBAAD,CAH0C;AAIvDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACgnB,aAAjB,CAA+B,QAA/B;AAJ8C,KAAzD;AAMAjgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,mBAA/B,EAAoD;AAClDtxE,MAAAA,IAAI,EAAE,eAD4C;AAElDuwE,MAAAA,IAAI,EAAE,qBAF4C;AAGlDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,mBAAD,CAHqC;AAIlDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACgnB,aAAjB,CAA+B,OAA/B;AAJyC,KAApD;AAMAjgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,gBAA/B,EAAiD;AAC/CtxE,MAAAA,IAAI,EAAE,YADyC;AAE/CuwE,MAAAA,IAAI,EAAE,YAFyC;AAG/CM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,gBAAD,CAHkC;AAI/CpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACgnB,aAAjB,CAA+B,OAA/B;AAJsC,KAAjD;AAMAjgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,iBAA/B,EAAkD;AAChDtxE,MAAAA,IAAI,EAAE,aAD0C;AAEhDuwE,MAAAA,IAAI,EAAE,kBAF0C;AAGhDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,iBAAD,CAHmC;AAIhDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACgnB,aAAjB,CAA+B,OAA/B;AAJuC,KAAlD;AAMAjgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,wBAA/B,EAAyD;AACvDtxE,MAAAA,IAAI,EAAE,qBADiD;AAEvDuwE,MAAAA,IAAI,EAAE,qBAFiD;AAGvDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,wBAAD,CAH0C;AAIvDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACmnB,sBAAjB,CAAwCl+C,SAAS,CAACu3B,UAAlD,EAA8D,SAA9D;AAJ8C,KAAzD;AAMAz5B,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,uBAA/B,EAAwD;AACtDtxE,MAAAA,IAAI,EAAE,oBADgD;AAEtDuwE,MAAAA,IAAI,EAAE,oBAFgD;AAGtDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,uBAAD,CAHyC;AAItDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACmnB,sBAAjB,CAAwCl+C,SAAS,CAACu3B,UAAlD,EAA8D,QAA9D;AAJ6C,KAAxD;AAMA,QAAI3lD,MAAM,GAAG;AACXnU,MAAAA,IAAI,EAAE,gBADK;AAEXyQ,MAAAA,IAAI,EAAE,QAFK;AAGXuxE,MAAAA,eAAe,EAAE,YAAY;AAC3B,eAAO,gJAAP;AACD;AALU,KAAb;AAOA3hD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,gBAA/B,EAAiD;AAC/CtxE,MAAAA,IAAI,EAAE,iBADyC;AAE/CuwE,MAAAA,IAAI,EAAE,uBAFyC;AAG/CM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,mBAAD,CAHkC;AAI/CpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAC+mB;AAJqB,KAAjD;AAMAhgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,iBAA/B,EAAkD;AAChDtxE,MAAAA,IAAI,EAAE,aAD0C;AAEhDuwE,MAAAA,IAAI,EAAE,mBAF0C;AAGhDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,oBAAD,CAHmC;AAIhDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAAConB;AAJsB,KAAlD;AAMArgD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,iBAA/B,EAAkD;AAChDtxE,MAAAA,IAAI,EAAE,YAD0C;AAEhDuwE,MAAAA,IAAI,EAAE,mBAF0C;AAGhDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,oBAAD,CAHmC;AAIhDpB,MAAAA,OAAO,EAAEzmB,gBAAgB,CAACsnB;AAJsB,KAAlD;AAMA,QAAIxkE,IAAI,GAAG;AACTpc,MAAAA,IAAI,EAAE,gBADG;AAETyQ,MAAAA,IAAI,EAAE,MAFG;AAGTuxE,MAAAA,eAAe,EAAE,YAAY;AAC3B,eAAO,gDAAP;AACD;AALQ,KAAX;;AAOA,QAAIpnC,YAAY,CAACva,MAAD,CAAZ,KAAyB,KAA7B,EAAoC;AAClCA,MAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,aAA/B,EAA8C;AAC5CtxE,QAAAA,IAAI,EAAE,OADsC;AAE5CuwE,QAAAA,IAAI,EAAE,OAFsC;AAG5CM,QAAAA,QAAQ,EAAEH,GAAG,CAAC,gBAAD;AAH+B,OAA9C;AAKD,KAND,MAMO;AACL9gD,MAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB+0C,iBAAnB,CAAqC,aAArC,EAAoD;AAClDxxE,QAAAA,IAAI,EAAE,OAD4C;AAElDuwE,QAAAA,IAAI,EAAE,OAF4C;AAGlDgB,QAAAA,eAAe,EAAE,YAAY;AAC3B,iBAAO,CAAC;AACJhiF,YAAAA,IAAI,EAAE,eADF;AAEJkiF,YAAAA,SAAS,EAAE,aAFP;AAGJZ,YAAAA,QAAQ,EAAEK;AAHN,WAAD,CAAP;AAKD;AATiD,OAApD;AAWD;;AACDthD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,mBAA/B,EAAoD;AAClDtxE,MAAAA,IAAI,EAAE,cAD4C;AAElDuwE,MAAAA,IAAI,EAAE,OAF4C;AAGlDM,MAAAA,QAAQ,EAAEH,GAAG,CAAC,gBAAD;AAHqC,KAApD;AAKA9gD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,YAA/B,EAA6CF,eAA7C;AACAxhD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB60C,WAAnB,CAA+B,aAA/B,EAA8CD,WAA9C;AACAzhD,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB+0C,iBAAnB,CAAqC,KAArC,EAA4C/tE,GAA5C;AACAmsB,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB+0C,iBAAnB,CAAqC,QAArC,EAA+C9tE,MAA/C;AACAksB,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmB+0C,iBAAnB,CAAqC,MAArC,EAA6C7lE,IAA7C;AACAikB,IAAAA,MAAM,CAAColC,EAAP,CAAUv4B,QAAV,CAAmBi1C,cAAnB,CAAkC,OAAlC,EAA2C;AACzCjzC,MAAAA,MAAM,EAAE,YAAY;AAClBoqB,QAAAA,gBAAgB,CAACwmB,YAAjB;AACA,eAAOxmB,gBAAgB,CAAC11B,OAAjB,GAA2BzgC,IAA3B,CAAgC,YAAY;AACjD,iBAAO,EAAP;AACD,SAFM,EAEJ,UAAUygC,OAAV,EAAmB;AACpB,cAAI/jC,IAAI,CAAC+jC,OAAO,CAAC3yB,OAAT,CAAJ,KAA0B,SAA9B,EAAyC;AACvC,mBAAO,wBAAP;AACD,WAFD,MAEO;AACL,mBAAO,yDAAP;AACD;AACF,SARM,CAAP;AASD;AAZwC,KAA3C;AAcD,GAnMD;;AAqMA,MAAImxE,MAAM,GAAG,UAAU/hD,MAAV,EAAkB;AAC7B,QAAIc,UAAU,GAAGxU,UAAU,CAAC,YAAY;AACtC,aAAOyT,SAAS,CAACC,MAAD,CAAhB;AACD,KAF0B,EAExB,YAAY;AACb,aAAOyzB,8BAA8B,CAAC7yB,iBAAiB,CAACZ,MAAD,CAAlB,CAArC;AACD,KAJ0B,EAIxBmB,QAAQ,CAAC1U,gBAJe,CAA3B;AAKA,QAAIwsC,gBAAgB,GAAG4lB,mBAAmB,CAAC7+C,MAAD,EAASc,UAAT,CAA1C;AACA,QAAIk4B,aAAa,GAAGlc,gBAAgB,CAAC9c,MAAD,CAApC;AACA,QAAI6C,aAAa,GAAGs6C,aAAa,CAACn9C,MAAD,EAASg5B,aAAa,CAAC9b,UAAvB,EAAmC+b,gBAAnC,CAAjC;AACA,QAAIr2B,OAAO,GAAGkxB,YAAY,CAAC9zB,MAAD,EAASg5B,aAAa,CAAC7b,QAAvB,EAAiCrc,UAAjC,CAA1B;AACA,QAAIoB,SAAS,GAAGikC,SAAS,EAAzB;AACAjD,IAAAA,gBAAgB,CAACljC,MAAD,EAAS4C,OAAT,EAAkBC,aAAlB,EAAiC/B,UAAjC,EAA6CoB,SAA7C,CAAhB;AACA8jC,IAAAA,qBAAqB,CAAChmC,MAAD,EAAS4C,OAAT,EAAkB9B,UAAlB,CAArB;AACA6B,IAAAA,cAAc,CAAC3C,MAAD,EAASc,UAAT,EAAqB8B,OAArB,EAA8BC,aAA9B,CAAd;AACAw+C,IAAAA,YAAY,CAACrhD,MAAD,EAASi5B,gBAAT,EAA2B/2B,SAA3B,CAAZ;AACAs+C,IAAAA,UAAU,CAACxgD,MAAD,EAASi5B,gBAAT,EAA2B/2B,SAA3B,CAAV;AACAg/C,IAAAA,WAAW,CAAClhD,MAAD,CAAX;AACAA,IAAAA,MAAM,CAAC8C,EAAP,CAAU,SAAV,EAAqB,YAAY;AAC/B9C,MAAAA,MAAM,CAACuC,UAAP,CAAkBy/C,WAAlB,CAA8B7gD,QAAQ,CAACU,aAAvC;AACA7B,MAAAA,MAAM,CAACuC,UAAP,CAAkBy/C,WAAlB,CAA8B7gD,QAAQ,CAACW,YAAvC;AACAklC,MAAAA,eAAe,CAAChnC,MAAD,CAAf;AACD,KAJD;;AAKA,QAAIka,gBAAgB,CAACla,MAAD,CAApB,EAA8B;AAC5BA,MAAAA,MAAM,CAAC8C,EAAP,CAAU,SAAV,EAAqB,UAAUhtB,CAAV,EAAa;AAChCo6D,QAAAA,QAAQ,CAACp6D,CAAD,EAAIkqB,MAAJ,EAAY6C,aAAZ,CAAR;AACD,OAFD;AAGD;;AACD7C,IAAAA,MAAM,CAAC8C,EAAP,CAAU,QAAV,EAAoB,YAAY;AAC9Bk2B,MAAAA,aAAa,CAACtoB,OAAd;AACD,KAFD;AAGA,WAAOqoB,MAAM,CAAC/4B,MAAD,EAASkC,SAAT,EAAoB82B,aAApB,EAAmCC,gBAAnC,CAAb;AACD,GA/BD;;AAgCA,WAASgpB,QAAT,GAAqB;AACnBv1D,IAAAA,MAAM,CAACme,GAAP,CAAW,OAAX,EAAoBk3C,MAApB;AACD;;AAEDE,EAAAA,QAAQ;AAEX,CAtrVA,GAAD","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.8.2 (2021-06-23)\n */\n(function () {\n    'use strict';\n\n    var typeOf = function (x) {\n      var t = typeof x;\n      if (x === null) {\n        return 'null';\n      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      } else {\n        return t;\n      }\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isSimpleType = function (type) {\n      return function (value) {\n        return typeof value === type;\n      };\n    };\n    var eq = function (t) {\n      return function (a) {\n        return t === a;\n      };\n    };\n    var isString = isType('string');\n    var isObject = isType('object');\n    var isArray = isType('array');\n    var isBoolean = isSimpleType('boolean');\n    var isUndefined = eq(undefined);\n    var isNullable = function (a) {\n      return a === null || a === undefined;\n    };\n    var isNonNullable = function (a) {\n      return !isNullable(a);\n    };\n    var isFunction = isSimpleType('function');\n    var isNumber = isSimpleType('number');\n\n    var noop = function () {\n    };\n    var compose = function (fa, fb) {\n      return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        return fa(fb.apply(null, args));\n      };\n    };\n    var compose1 = function (fbc, fab) {\n      return function (a) {\n        return fbc(fab(a));\n      };\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var identity = function (x) {\n      return x;\n    };\n    function curry(fn) {\n      var initialArgs = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        initialArgs[_i - 1] = arguments[_i];\n      }\n      return function () {\n        var restArgs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          restArgs[_i] = arguments[_i];\n        }\n        var all = initialArgs.concat(restArgs);\n        return fn.apply(null, all);\n      };\n    }\n    var not = function (f) {\n      return function (t) {\n        return !f(t);\n      };\n    };\n    var die = function (msg) {\n      return function () {\n        throw new Error(msg);\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, _s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Optional = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var nativeSlice = Array.prototype.slice;\n    var nativeIndexOf = Array.prototype.indexOf;\n    var nativePush = Array.prototype.push;\n    var rawIndexOf = function (ts, t) {\n      return nativeIndexOf.call(ts, t);\n    };\n    var contains = function (xs, x) {\n      return rawIndexOf(xs, x) > -1;\n    };\n    var exists = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var range = function (num, f) {\n      var r = [];\n      for (var i = 0; i < num; i++) {\n        r.push(f(i));\n      }\n      return r;\n    };\n    var map = function (xs, f) {\n      var len = xs.length;\n      var r = new Array(len);\n      for (var i = 0; i < len; i++) {\n        var x = xs[i];\n        r[i] = f(x, i);\n      }\n      return r;\n    };\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var eachr = function (xs, f) {\n      for (var i = xs.length - 1; i >= 0; i--) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var partition = function (xs, pred) {\n      var pass = [];\n      var fail = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        var arr = pred(x, i) ? pass : fail;\n        arr.push(x);\n      }\n      return {\n        pass: pass,\n        fail: fail\n      };\n    };\n    var filter = function (xs, pred) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          r.push(x);\n        }\n      }\n      return r;\n    };\n    var foldr = function (xs, f, acc) {\n      eachr(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var foldl = function (xs, f, acc) {\n      each(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var findUntil = function (xs, pred, until) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return Optional.some(x);\n        } else if (until(x, i)) {\n          break;\n        }\n      }\n      return Optional.none();\n    };\n    var find = function (xs, pred) {\n      return findUntil(xs, pred, never);\n    };\n    var findIndex = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return Optional.some(i);\n        }\n      }\n      return Optional.none();\n    };\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n    var bind = function (xs, f) {\n      return flatten(map(xs, f));\n    };\n    var forall = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        var x = xs[i];\n        if (pred(x, i) !== true) {\n          return false;\n        }\n      }\n      return true;\n    };\n    var reverse = function (xs) {\n      var r = nativeSlice.call(xs, 0);\n      r.reverse();\n      return r;\n    };\n    var mapToObject = function (xs, f) {\n      var r = {};\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        r[String(x)] = f(x, i);\n      }\n      return r;\n    };\n    var pure = function (x) {\n      return [x];\n    };\n    var sort = function (xs, comparator) {\n      var copy = nativeSlice.call(xs, 0);\n      copy.sort(comparator);\n      return copy;\n    };\n    var get = function (xs, i) {\n      return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();\n    };\n    var head = function (xs) {\n      return get(xs, 0);\n    };\n    var last = function (xs) {\n      return get(xs, xs.length - 1);\n    };\n    var findMap = function (arr, f) {\n      for (var i = 0; i < arr.length; i++) {\n        var r = f(arr[i], i);\n        if (r.isSome()) {\n          return r;\n        }\n      }\n      return Optional.none();\n    };\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n    function __spreadArrays() {\n      for (var s = 0, i = 0, il = arguments.length; i < il; i++)\n        s += arguments[i].length;\n      for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n      return r;\n    }\n\n    var cached = function (f) {\n      var called = false;\n      var r;\n      return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (!called) {\n          called = true;\n          r = f.apply(null, args);\n        }\n        return r;\n      };\n    };\n\n    var DeviceType = function (os, browser, userAgent, mediaMatch) {\n      var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;\n      var isiPhone = os.isiOS() && !isiPad;\n      var isMobile = os.isiOS() || os.isAndroid();\n      var isTouch = isMobile || mediaMatch('(pointer:coarse)');\n      var isTablet = isiPad || !isiPhone && isMobile && mediaMatch('(min-device-width:768px)');\n      var isPhone = isiPhone || isMobile && !isTablet;\n      var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;\n      var isDesktop = !isPhone && !isTablet && !iOSwebview;\n      return {\n        isiPad: constant(isiPad),\n        isiPhone: constant(isiPhone),\n        isTablet: constant(isTablet),\n        isPhone: constant(isPhone),\n        isTouch: constant(isTouch),\n        isAndroid: os.isAndroid,\n        isiOS: os.isiOS,\n        isWebView: constant(iOSwebview),\n        isDesktop: constant(isDesktop)\n      };\n    };\n\n    var firstMatch = function (regexes, s) {\n      for (var i = 0; i < regexes.length; i++) {\n        var x = regexes[i];\n        if (x.test(s)) {\n          return x;\n        }\n      }\n      return undefined;\n    };\n    var find$1 = function (regexes, agent) {\n      var r = firstMatch(regexes, agent);\n      if (!r) {\n        return {\n          major: 0,\n          minor: 0\n        };\n      }\n      var group = function (i) {\n        return Number(agent.replace(r, '$' + i));\n      };\n      return nu(group(1), group(2));\n    };\n    var detect = function (versionRegexes, agent) {\n      var cleanedAgent = String(agent).toLowerCase();\n      if (versionRegexes.length === 0) {\n        return unknown();\n      }\n      return find$1(versionRegexes, cleanedAgent);\n    };\n    var unknown = function () {\n      return nu(0, 0);\n    };\n    var nu = function (major, minor) {\n      return {\n        major: major,\n        minor: minor\n      };\n    };\n    var Version = {\n      nu: nu,\n      detect: detect,\n      unknown: unknown\n    };\n\n    var detect$1 = function (candidates, userAgent) {\n      var agent = String(userAgent).toLowerCase();\n      return find(candidates, function (candidate) {\n        return candidate.search(agent);\n      });\n    };\n    var detectBrowser = function (browsers, userAgent) {\n      return detect$1(browsers, userAgent).map(function (browser) {\n        var version = Version.detect(browser.versionRegexes, userAgent);\n        return {\n          current: browser.name,\n          version: version\n        };\n      });\n    };\n    var detectOs = function (oses, userAgent) {\n      return detect$1(oses, userAgent).map(function (os) {\n        var version = Version.detect(os.versionRegexes, userAgent);\n        return {\n          current: os.name,\n          version: version\n        };\n      });\n    };\n    var UaString = {\n      detectBrowser: detectBrowser,\n      detectOs: detectOs\n    };\n\n    var checkRange = function (str, substr, start) {\n      return substr === '' || str.length >= substr.length && str.substr(start, start + substr.length) === substr;\n    };\n    var contains$1 = function (str, substr) {\n      return str.indexOf(substr) !== -1;\n    };\n    var startsWith = function (str, prefix) {\n      return checkRange(str, prefix, 0);\n    };\n    var endsWith = function (str, suffix) {\n      return checkRange(str, suffix, str.length - suffix.length);\n    };\n    var blank = function (r) {\n      return function (s) {\n        return s.replace(r, '');\n      };\n    };\n    var trim = blank(/^\\s+|\\s+$/g);\n    var isNotEmpty = function (s) {\n      return s.length > 0;\n    };\n\n    var normalVersionRegex = /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;\n    var checkContains = function (target) {\n      return function (uastring) {\n        return contains$1(uastring, target);\n      };\n    };\n    var browsers = [\n      {\n        name: 'Edge',\n        versionRegexes: [/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],\n        search: function (uastring) {\n          return contains$1(uastring, 'edge/') && contains$1(uastring, 'chrome') && contains$1(uastring, 'safari') && contains$1(uastring, 'applewebkit');\n        }\n      },\n      {\n        name: 'Chrome',\n        versionRegexes: [\n          /.*?chrome\\/([0-9]+)\\.([0-9]+).*/,\n          normalVersionRegex\n        ],\n        search: function (uastring) {\n          return contains$1(uastring, 'chrome') && !contains$1(uastring, 'chromeframe');\n        }\n      },\n      {\n        name: 'IE',\n        versionRegexes: [\n          /.*?msie\\ ?([0-9]+)\\.([0-9]+).*/,\n          /.*?rv:([0-9]+)\\.([0-9]+).*/\n        ],\n        search: function (uastring) {\n          return contains$1(uastring, 'msie') || contains$1(uastring, 'trident');\n        }\n      },\n      {\n        name: 'Opera',\n        versionRegexes: [\n          normalVersionRegex,\n          /.*?opera\\/([0-9]+)\\.([0-9]+).*/\n        ],\n        search: checkContains('opera')\n      },\n      {\n        name: 'Firefox',\n        versionRegexes: [/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],\n        search: checkContains('firefox')\n      },\n      {\n        name: 'Safari',\n        versionRegexes: [\n          normalVersionRegex,\n          /.*?cpu os ([0-9]+)_([0-9]+).*/\n        ],\n        search: function (uastring) {\n          return (contains$1(uastring, 'safari') || contains$1(uastring, 'mobile/')) && contains$1(uastring, 'applewebkit');\n        }\n      }\n    ];\n    var oses = [\n      {\n        name: 'Windows',\n        search: checkContains('win'),\n        versionRegexes: [/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]\n      },\n      {\n        name: 'iOS',\n        search: function (uastring) {\n          return contains$1(uastring, 'iphone') || contains$1(uastring, 'ipad');\n        },\n        versionRegexes: [\n          /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/,\n          /.*cpu os ([0-9]+)_([0-9]+).*/,\n          /.*cpu iphone os ([0-9]+)_([0-9]+).*/\n        ]\n      },\n      {\n        name: 'Android',\n        search: checkContains('android'),\n        versionRegexes: [/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]\n      },\n      {\n        name: 'OSX',\n        search: checkContains('mac os x'),\n        versionRegexes: [/.*?mac\\ os\\ x\\ ?([0-9]+)_([0-9]+).*/]\n      },\n      {\n        name: 'Linux',\n        search: checkContains('linux'),\n        versionRegexes: []\n      },\n      {\n        name: 'Solaris',\n        search: checkContains('sunos'),\n        versionRegexes: []\n      },\n      {\n        name: 'FreeBSD',\n        search: checkContains('freebsd'),\n        versionRegexes: []\n      },\n      {\n        name: 'ChromeOS',\n        search: checkContains('cros'),\n        versionRegexes: [/.*?chrome\\/([0-9]+)\\.([0-9]+).*/]\n      }\n    ];\n    var PlatformInfo = {\n      browsers: constant(browsers),\n      oses: constant(oses)\n    };\n\n    var edge = 'Edge';\n    var chrome = 'Chrome';\n    var ie = 'IE';\n    var opera = 'Opera';\n    var firefox = 'Firefox';\n    var safari = 'Safari';\n    var unknown$1 = function () {\n      return nu$1({\n        current: undefined,\n        version: Version.unknown()\n      });\n    };\n    var nu$1 = function (info) {\n      var current = info.current;\n      var version = info.version;\n      var isBrowser = function (name) {\n        return function () {\n          return current === name;\n        };\n      };\n      return {\n        current: current,\n        version: version,\n        isEdge: isBrowser(edge),\n        isChrome: isBrowser(chrome),\n        isIE: isBrowser(ie),\n        isOpera: isBrowser(opera),\n        isFirefox: isBrowser(firefox),\n        isSafari: isBrowser(safari)\n      };\n    };\n    var Browser = {\n      unknown: unknown$1,\n      nu: nu$1,\n      edge: constant(edge),\n      chrome: constant(chrome),\n      ie: constant(ie),\n      opera: constant(opera),\n      firefox: constant(firefox),\n      safari: constant(safari)\n    };\n\n    var windows = 'Windows';\n    var ios = 'iOS';\n    var android = 'Android';\n    var linux = 'Linux';\n    var osx = 'OSX';\n    var solaris = 'Solaris';\n    var freebsd = 'FreeBSD';\n    var chromeos = 'ChromeOS';\n    var unknown$2 = function () {\n      return nu$2({\n        current: undefined,\n        version: Version.unknown()\n      });\n    };\n    var nu$2 = function (info) {\n      var current = info.current;\n      var version = info.version;\n      var isOS = function (name) {\n        return function () {\n          return current === name;\n        };\n      };\n      return {\n        current: current,\n        version: version,\n        isWindows: isOS(windows),\n        isiOS: isOS(ios),\n        isAndroid: isOS(android),\n        isOSX: isOS(osx),\n        isLinux: isOS(linux),\n        isSolaris: isOS(solaris),\n        isFreeBSD: isOS(freebsd),\n        isChromeOS: isOS(chromeos)\n      };\n    };\n    var OperatingSystem = {\n      unknown: unknown$2,\n      nu: nu$2,\n      windows: constant(windows),\n      ios: constant(ios),\n      android: constant(android),\n      linux: constant(linux),\n      osx: constant(osx),\n      solaris: constant(solaris),\n      freebsd: constant(freebsd),\n      chromeos: constant(chromeos)\n    };\n\n    var detect$2 = function (userAgent, mediaMatch) {\n      var browsers = PlatformInfo.browsers();\n      var oses = PlatformInfo.oses();\n      var browser = UaString.detectBrowser(browsers, userAgent).fold(Browser.unknown, Browser.nu);\n      var os = UaString.detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);\n      var deviceType = DeviceType(os, browser, userAgent, mediaMatch);\n      return {\n        browser: browser,\n        os: os,\n        deviceType: deviceType\n      };\n    };\n    var PlatformDetection = { detect: detect$2 };\n\n    var mediaMatch = function (query) {\n      return window.matchMedia(query).matches;\n    };\n    var platform = cached(function () {\n      return PlatformDetection.detect(navigator.userAgent, mediaMatch);\n    });\n    var detect$3 = function () {\n      return platform();\n    };\n\n    var compareDocumentPosition = function (a, b, match) {\n      return (a.compareDocumentPosition(b) & match) !== 0;\n    };\n    var documentPositionContainedBy = function (a, b) {\n      return compareDocumentPosition(a, b, Node.DOCUMENT_POSITION_CONTAINED_BY);\n    };\n\n    var COMMENT = 8;\n    var DOCUMENT = 9;\n    var DOCUMENT_FRAGMENT = 11;\n    var ELEMENT = 1;\n    var TEXT = 3;\n\n    var fromHtml = function (html, scope) {\n      var doc = scope || document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      if (!div.hasChildNodes() || div.childNodes.length > 1) {\n        console.error('HTML does not have a single root node', html);\n        throw new Error('HTML must have a single root node');\n      }\n      return fromDom(div.childNodes[0]);\n    };\n    var fromTag = function (tag, scope) {\n      var doc = scope || document;\n      var node = doc.createElement(tag);\n      return fromDom(node);\n    };\n    var fromText = function (text, scope) {\n      var doc = scope || document;\n      var node = doc.createTextNode(text);\n      return fromDom(node);\n    };\n    var fromDom = function (node) {\n      if (node === null || node === undefined) {\n        throw new Error('Node cannot be null or undefined');\n      }\n      return { dom: node };\n    };\n    var fromPoint = function (docElm, x, y) {\n      return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n    };\n    var SugarElement = {\n      fromHtml: fromHtml,\n      fromTag: fromTag,\n      fromText: fromText,\n      fromDom: fromDom,\n      fromPoint: fromPoint\n    };\n\n    var is = function (element, selector) {\n      var dom = element.dom;\n      if (dom.nodeType !== ELEMENT) {\n        return false;\n      } else {\n        var elem = dom;\n        if (elem.matches !== undefined) {\n          return elem.matches(selector);\n        } else if (elem.msMatchesSelector !== undefined) {\n          return elem.msMatchesSelector(selector);\n        } else if (elem.webkitMatchesSelector !== undefined) {\n          return elem.webkitMatchesSelector(selector);\n        } else if (elem.mozMatchesSelector !== undefined) {\n          return elem.mozMatchesSelector(selector);\n        } else {\n          throw new Error('Browser lacks native selectors');\n        }\n      }\n    };\n    var bypassSelector = function (dom) {\n      return dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT && dom.nodeType !== DOCUMENT_FRAGMENT || dom.childElementCount === 0;\n    };\n    var all = function (selector, scope) {\n      var base = scope === undefined ? document : scope.dom;\n      return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), SugarElement.fromDom);\n    };\n    var one = function (selector, scope) {\n      var base = scope === undefined ? document : scope.dom;\n      return bypassSelector(base) ? Optional.none() : Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);\n    };\n\n    var eq$1 = function (e1, e2) {\n      return e1.dom === e2.dom;\n    };\n    var regularContains = function (e1, e2) {\n      var d1 = e1.dom;\n      var d2 = e2.dom;\n      return d1 === d2 ? false : d1.contains(d2);\n    };\n    var ieContains = function (e1, e2) {\n      return documentPositionContainedBy(e1.dom, e2.dom);\n    };\n    var contains$2 = function (e1, e2) {\n      return detect$3().browser.isIE() ? ieContains(e1, e2) : regularContains(e1, e2);\n    };\n    var is$1 = is;\n\n    var keys = Object.keys;\n    var hasOwnProperty = Object.hasOwnProperty;\n    var each$1 = function (obj, f) {\n      var props = keys(obj);\n      for (var k = 0, len = props.length; k < len; k++) {\n        var i = props[k];\n        var x = obj[i];\n        f(x, i);\n      }\n    };\n    var map$1 = function (obj, f) {\n      return tupleMap(obj, function (x, i) {\n        return {\n          k: i,\n          v: f(x, i)\n        };\n      });\n    };\n    var tupleMap = function (obj, f) {\n      var r = {};\n      each$1(obj, function (x, i) {\n        var tuple = f(x, i);\n        r[tuple.k] = tuple.v;\n      });\n      return r;\n    };\n    var objAcc = function (r) {\n      return function (x, i) {\n        r[i] = x;\n      };\n    };\n    var internalFilter = function (obj, pred, onTrue, onFalse) {\n      var r = {};\n      each$1(obj, function (x, i) {\n        (pred(x, i) ? onTrue : onFalse)(x, i);\n      });\n      return r;\n    };\n    var filter$1 = function (obj, pred) {\n      var t = {};\n      internalFilter(obj, pred, objAcc(t), noop);\n      return t;\n    };\n    var mapToArray = function (obj, f) {\n      var r = [];\n      each$1(obj, function (value, name) {\n        r.push(f(value, name));\n      });\n      return r;\n    };\n    var values = function (obj) {\n      return mapToArray(obj, function (v) {\n        return v;\n      });\n    };\n    var size = function (obj) {\n      return keys(obj).length;\n    };\n    var get$1 = function (obj, key) {\n      return has(obj, key) ? Optional.from(obj[key]) : Optional.none();\n    };\n    var has = function (obj, key) {\n      return hasOwnProperty.call(obj, key);\n    };\n    var hasNonNullableKey = function (obj, key) {\n      return has(obj, key) && obj[key] !== undefined && obj[key] !== null;\n    };\n    var isEmpty = function (r) {\n      for (var x in r) {\n        if (hasOwnProperty.call(r, x)) {\n          return false;\n        }\n      }\n      return true;\n    };\n\n    var validSectionList = [\n      'tfoot',\n      'thead',\n      'tbody',\n      'colgroup'\n    ];\n    var isValidSection = function (parentName) {\n      return contains(validSectionList, parentName);\n    };\n    var grid = function (rows, columns) {\n      return {\n        rows: rows,\n        columns: columns\n      };\n    };\n    var address = function (row, column) {\n      return {\n        row: row,\n        column: column\n      };\n    };\n    var detail = function (element, rowspan, colspan) {\n      return {\n        element: element,\n        rowspan: rowspan,\n        colspan: colspan\n      };\n    };\n    var detailnew = function (element, rowspan, colspan, isNew) {\n      return {\n        element: element,\n        rowspan: rowspan,\n        colspan: colspan,\n        isNew: isNew\n      };\n    };\n    var extended = function (element, rowspan, colspan, row, column, isLocked) {\n      return {\n        element: element,\n        rowspan: rowspan,\n        colspan: colspan,\n        row: row,\n        column: column,\n        isLocked: isLocked\n      };\n    };\n    var rowdata = function (element, cells, section) {\n      return {\n        element: element,\n        cells: cells,\n        section: section\n      };\n    };\n    var elementnew = function (element, isNew, isLocked) {\n      return {\n        element: element,\n        isNew: isNew,\n        isLocked: isLocked\n      };\n    };\n    var rowdatanew = function (element, cells, section, isNew) {\n      return {\n        element: element,\n        cells: cells,\n        section: section,\n        isNew: isNew\n      };\n    };\n    var rowcells = function (cells, section) {\n      return {\n        cells: cells,\n        section: section\n      };\n    };\n    var rowdetails = function (details, section) {\n      return {\n        details: details,\n        section: section\n      };\n    };\n    var bounds = function (startRow, startCol, finishRow, finishCol) {\n      return {\n        startRow: startRow,\n        startCol: startCol,\n        finishRow: finishRow,\n        finishCol: finishCol\n      };\n    };\n    var columnext = function (element, colspan, column) {\n      return {\n        element: element,\n        colspan: colspan,\n        column: column\n      };\n    };\n\n    var Global = typeof window !== 'undefined' ? window : Function('return this;')();\n\n    var name = function (element) {\n      var r = element.dom.nodeName;\n      return r.toLowerCase();\n    };\n    var type = function (element) {\n      return element.dom.nodeType;\n    };\n    var isType$1 = function (t) {\n      return function (element) {\n        return type(element) === t;\n      };\n    };\n    var isComment = function (element) {\n      return type(element) === COMMENT || name(element) === '#comment';\n    };\n    var isElement = isType$1(ELEMENT);\n    var isText = isType$1(TEXT);\n    var isDocument = isType$1(DOCUMENT);\n    var isDocumentFragment = isType$1(DOCUMENT_FRAGMENT);\n    var isTag = function (tag) {\n      return function (e) {\n        return isElement(e) && name(e) === tag;\n      };\n    };\n\n    var owner = function (element) {\n      return SugarElement.fromDom(element.dom.ownerDocument);\n    };\n    var documentOrOwner = function (dos) {\n      return isDocument(dos) ? dos : owner(dos);\n    };\n    var defaultView = function (element) {\n      return SugarElement.fromDom(documentOrOwner(element).dom.defaultView);\n    };\n    var parent = function (element) {\n      return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);\n    };\n    var parents = function (element, isRoot) {\n      var stop = isFunction(isRoot) ? isRoot : never;\n      var dom = element.dom;\n      var ret = [];\n      while (dom.parentNode !== null && dom.parentNode !== undefined) {\n        var rawParent = dom.parentNode;\n        var p = SugarElement.fromDom(rawParent);\n        ret.push(p);\n        if (stop(p) === true) {\n          break;\n        } else {\n          dom = rawParent;\n        }\n      }\n      return ret;\n    };\n    var offsetParent = function (element) {\n      return Optional.from(element.dom.offsetParent).map(SugarElement.fromDom);\n    };\n    var prevSibling = function (element) {\n      return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom);\n    };\n    var nextSibling = function (element) {\n      return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);\n    };\n    var children = function (element) {\n      return map(element.dom.childNodes, SugarElement.fromDom);\n    };\n    var child = function (element, index) {\n      var cs = element.dom.childNodes;\n      return Optional.from(cs[index]).map(SugarElement.fromDom);\n    };\n    var firstChild = function (element) {\n      return child(element, 0);\n    };\n\n    var isShadowRoot = function (dos) {\n      return isDocumentFragment(dos) && isNonNullable(dos.dom.host);\n    };\n    var supported = isFunction(Element.prototype.attachShadow) && isFunction(Node.prototype.getRootNode);\n    var isSupported = constant(supported);\n    var getRootNode = supported ? function (e) {\n      return SugarElement.fromDom(e.dom.getRootNode());\n    } : documentOrOwner;\n    var getShadowRoot = function (e) {\n      var r = getRootNode(e);\n      return isShadowRoot(r) ? Optional.some(r) : Optional.none();\n    };\n    var getShadowHost = function (e) {\n      return SugarElement.fromDom(e.dom.host);\n    };\n    var getOriginalEventTarget = function (event) {\n      if (isSupported() && isNonNullable(event.target)) {\n        var el = SugarElement.fromDom(event.target);\n        if (isElement(el) && isOpenShadowHost(el)) {\n          if (event.composed && event.composedPath) {\n            var composedPath = event.composedPath();\n            if (composedPath) {\n              return head(composedPath);\n            }\n          }\n        }\n      }\n      return Optional.from(event.target);\n    };\n    var isOpenShadowHost = function (element) {\n      return isNonNullable(element.dom.shadowRoot);\n    };\n\n    var inBody = function (element) {\n      var dom = isText(element) ? element.dom.parentNode : element.dom;\n      if (dom === undefined || dom === null || dom.ownerDocument === null) {\n        return false;\n      }\n      var doc = dom.ownerDocument;\n      return getShadowRoot(SugarElement.fromDom(dom)).fold(function () {\n        return doc.body.contains(dom);\n      }, compose1(inBody, getShadowHost));\n    };\n    var body = function () {\n      return getBody(SugarElement.fromDom(document));\n    };\n    var getBody = function (doc) {\n      var b = doc.dom.body;\n      if (b === null || b === undefined) {\n        throw new Error('Body is not available yet');\n      }\n      return SugarElement.fromDom(b);\n    };\n\n    var ancestors = function (scope, predicate, isRoot) {\n      return filter(parents(scope, isRoot), predicate);\n    };\n    var children$1 = function (scope, predicate) {\n      return filter(children(scope), predicate);\n    };\n    var descendants = function (scope, predicate) {\n      var result = [];\n      each(children(scope), function (x) {\n        if (predicate(x)) {\n          result = result.concat([x]);\n        }\n        result = result.concat(descendants(x, predicate));\n      });\n      return result;\n    };\n\n    var ancestors$1 = function (scope, selector, isRoot) {\n      return ancestors(scope, function (e) {\n        return is(e, selector);\n      }, isRoot);\n    };\n    var children$2 = function (scope, selector) {\n      return children$1(scope, function (e) {\n        return is(e, selector);\n      });\n    };\n    var descendants$1 = function (scope, selector) {\n      return all(selector, scope);\n    };\n\n    function ClosestOrAncestor (is, ancestor, scope, a, isRoot) {\n      if (is(scope, a)) {\n        return Optional.some(scope);\n      } else if (isFunction(isRoot) && isRoot(scope)) {\n        return Optional.none();\n      } else {\n        return ancestor(scope, a, isRoot);\n      }\n    }\n\n    var ancestor = function (scope, predicate, isRoot) {\n      var element = scope.dom;\n      var stop = isFunction(isRoot) ? isRoot : never;\n      while (element.parentNode) {\n        element = element.parentNode;\n        var el = SugarElement.fromDom(element);\n        if (predicate(el)) {\n          return Optional.some(el);\n        } else if (stop(el)) {\n          break;\n        }\n      }\n      return Optional.none();\n    };\n    var closest = function (scope, predicate, isRoot) {\n      var is = function (s, test) {\n        return test(s);\n      };\n      return ClosestOrAncestor(is, ancestor, scope, predicate, isRoot);\n    };\n    var child$1 = function (scope, predicate) {\n      var pred = function (node) {\n        return predicate(SugarElement.fromDom(node));\n      };\n      var result = find(scope.dom.childNodes, pred);\n      return result.map(SugarElement.fromDom);\n    };\n    var descendant = function (scope, predicate) {\n      var descend = function (node) {\n        for (var i = 0; i < node.childNodes.length; i++) {\n          var child_1 = SugarElement.fromDom(node.childNodes[i]);\n          if (predicate(child_1)) {\n            return Optional.some(child_1);\n          }\n          var res = descend(node.childNodes[i]);\n          if (res.isSome()) {\n            return res;\n          }\n        }\n        return Optional.none();\n      };\n      return descend(scope.dom);\n    };\n\n    var ancestor$1 = function (scope, selector, isRoot) {\n      return ancestor(scope, function (e) {\n        return is(e, selector);\n      }, isRoot);\n    };\n    var child$2 = function (scope, selector) {\n      return child$1(scope, function (e) {\n        return is(e, selector);\n      });\n    };\n    var descendant$1 = function (scope, selector) {\n      return one(selector, scope);\n    };\n    var closest$1 = function (scope, selector, isRoot) {\n      var is$1 = function (element, selector) {\n        return is(element, selector);\n      };\n      return ClosestOrAncestor(is$1, ancestor$1, scope, selector, isRoot);\n    };\n\n    var rawSet = function (dom, key, value) {\n      if (isString(value) || isBoolean(value) || isNumber(value)) {\n        dom.setAttribute(key, value + '');\n      } else {\n        console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n        throw new Error('Attribute value was not simple');\n      }\n    };\n    var set = function (element, key, value) {\n      rawSet(element.dom, key, value);\n    };\n    var setAll = function (element, attrs) {\n      var dom = element.dom;\n      each$1(attrs, function (v, k) {\n        rawSet(dom, k, v);\n      });\n    };\n    var get$2 = function (element, key) {\n      var v = element.dom.getAttribute(key);\n      return v === null ? undefined : v;\n    };\n    var getOpt = function (element, key) {\n      return Optional.from(get$2(element, key));\n    };\n    var remove = function (element, key) {\n      element.dom.removeAttribute(key);\n    };\n    var clone = function (element) {\n      return foldl(element.dom.attributes, function (acc, attr) {\n        acc[attr.name] = attr.value;\n        return acc;\n      }, {});\n    };\n\n    var isSupported$1 = function (dom) {\n      return dom.style !== undefined && isFunction(dom.style.getPropertyValue);\n    };\n\n    var internalSet = function (dom, property, value) {\n      if (!isString(value)) {\n        console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);\n        throw new Error('CSS value must be a string: ' + value);\n      }\n      if (isSupported$1(dom)) {\n        dom.style.setProperty(property, value);\n      }\n    };\n    var internalRemove = function (dom, property) {\n      if (isSupported$1(dom)) {\n        dom.style.removeProperty(property);\n      }\n    };\n    var set$1 = function (element, property, value) {\n      var dom = element.dom;\n      internalSet(dom, property, value);\n    };\n    var setAll$1 = function (element, css) {\n      var dom = element.dom;\n      each$1(css, function (v, k) {\n        internalSet(dom, k, v);\n      });\n    };\n    var get$3 = function (element, property) {\n      var dom = element.dom;\n      var styles = window.getComputedStyle(dom);\n      var r = styles.getPropertyValue(property);\n      return r === '' && !inBody(element) ? getUnsafeProperty(dom, property) : r;\n    };\n    var getUnsafeProperty = function (dom, property) {\n      return isSupported$1(dom) ? dom.style.getPropertyValue(property) : '';\n    };\n    var getRaw = function (element, property) {\n      var dom = element.dom;\n      var raw = getUnsafeProperty(dom, property);\n      return Optional.from(raw).filter(function (r) {\n        return r.length > 0;\n      });\n    };\n    var remove$1 = function (element, property) {\n      var dom = element.dom;\n      internalRemove(dom, property);\n      if (getOpt(element, 'style').map(trim).is('')) {\n        remove(element, 'style');\n      }\n    };\n    var copy = function (source, target) {\n      var sourceDom = source.dom;\n      var targetDom = target.dom;\n      if (isSupported$1(sourceDom) && isSupported$1(targetDom)) {\n        targetDom.style.cssText = sourceDom.style.cssText;\n      }\n    };\n\n    var getAttrValue = function (cell, name, fallback) {\n      if (fallback === void 0) {\n        fallback = 0;\n      }\n      return getOpt(cell, name).map(function (value) {\n        return parseInt(value, 10);\n      }).getOr(fallback);\n    };\n    var getSpan = function (cell, type) {\n      return getAttrValue(cell, type, 1);\n    };\n    var hasColspan = function (cell) {\n      return getSpan(cell, 'colspan') > 1;\n    };\n    var hasRowspan = function (cell) {\n      return getSpan(cell, 'rowspan') > 1;\n    };\n    var getCssValue = function (element, property) {\n      return parseInt(get$3(element, property), 10);\n    };\n    var minWidth = constant(10);\n    var minHeight = constant(10);\n\n    var firstLayer = function (scope, selector) {\n      return filterFirstLayer(scope, selector, always);\n    };\n    var filterFirstLayer = function (scope, selector, predicate) {\n      return bind(children(scope), function (x) {\n        if (is(x, selector)) {\n          return predicate(x) ? [x] : [];\n        } else {\n          return filterFirstLayer(x, selector, predicate);\n        }\n      });\n    };\n\n    var lookup = function (tags, element, isRoot) {\n      if (isRoot === void 0) {\n        isRoot = never;\n      }\n      if (isRoot(element)) {\n        return Optional.none();\n      }\n      if (contains(tags, name(element))) {\n        return Optional.some(element);\n      }\n      var isRootOrUpperTable = function (elm) {\n        return is(elm, 'table') || isRoot(elm);\n      };\n      return ancestor$1(element, tags.join(','), isRootOrUpperTable);\n    };\n    var cell = function (element, isRoot) {\n      return lookup([\n        'td',\n        'th'\n      ], element, isRoot);\n    };\n    var cells = function (ancestor) {\n      return firstLayer(ancestor, 'th,td');\n    };\n    var columns = function (ancestor) {\n      if (is(ancestor, 'colgroup')) {\n        return children$2(ancestor, 'col');\n      } else {\n        return bind(columnGroups(ancestor), function (columnGroup) {\n          return children$2(columnGroup, 'col');\n        });\n      }\n    };\n    var table = function (element, isRoot) {\n      return closest$1(element, 'table', isRoot);\n    };\n    var rows = function (ancestor) {\n      return firstLayer(ancestor, 'tr');\n    };\n    var columnGroups = function (ancestor) {\n      return table(ancestor).fold(constant([]), function (table) {\n        return children$2(table, 'colgroup');\n      });\n    };\n\n    var fromRowsOrColGroups = function (elems, getSection) {\n      return map(elems, function (row) {\n        if (name(row) === 'colgroup') {\n          var cells$1 = map(columns(row), function (column) {\n            var colspan = getAttrValue(column, 'span', 1);\n            return detail(column, 1, colspan);\n          });\n          return rowdata(row, cells$1, 'colgroup');\n        } else {\n          var cells$1 = map(cells(row), function (cell) {\n            var rowspan = getAttrValue(cell, 'rowspan', 1);\n            var colspan = getAttrValue(cell, 'colspan', 1);\n            return detail(cell, rowspan, colspan);\n          });\n          return rowdata(row, cells$1, getSection(row));\n        }\n      });\n    };\n    var getParentSection = function (group) {\n      return parent(group).map(function (parent) {\n        var parentName = name(parent);\n        return isValidSection(parentName) ? parentName : 'tbody';\n      }).getOr('tbody');\n    };\n    var fromTable = function (table) {\n      var rows$1 = rows(table);\n      var columnGroups$1 = columnGroups(table);\n      var elems = __spreadArrays(columnGroups$1, rows$1);\n      return fromRowsOrColGroups(elems, getParentSection);\n    };\n    var fromPastedRows = function (elems, section) {\n      return fromRowsOrColGroups(elems, function () {\n        return section;\n      });\n    };\n\n    var addCells = function (gridRow, index, cells) {\n      var existingCells = gridRow.cells;\n      var before = existingCells.slice(0, index);\n      var after = existingCells.slice(index);\n      var newCells = before.concat(cells).concat(after);\n      return setCells(gridRow, newCells);\n    };\n    var addCell = function (gridRow, index, cell) {\n      return addCells(gridRow, index, [cell]);\n    };\n    var mutateCell = function (gridRow, index, cell) {\n      var cells = gridRow.cells;\n      cells[index] = cell;\n    };\n    var setCells = function (gridRow, cells) {\n      return rowcells(cells, gridRow.section);\n    };\n    var mapCells = function (gridRow, f) {\n      var cells = gridRow.cells;\n      var r = map(cells, f);\n      return rowcells(r, gridRow.section);\n    };\n    var getCell = function (gridRow, index) {\n      return gridRow.cells[index];\n    };\n    var getCellElement = function (gridRow, index) {\n      return getCell(gridRow, index).element;\n    };\n    var cellLength = function (gridRow) {\n      return gridRow.cells.length;\n    };\n    var extractGridDetails = function (grid) {\n      var result = partition(grid, function (row) {\n        return row.section === 'colgroup';\n      });\n      return {\n        rows: result.fail,\n        cols: result.pass\n      };\n    };\n\n    var LOCKED_COL_ATTR = 'data-snooker-locked-cols';\n    var getLockedColumnsFromTable = function (table) {\n      return getOpt(table, LOCKED_COL_ATTR).bind(function (lockedColStr) {\n        return Optional.from(lockedColStr.match(/\\d+/g));\n      }).map(function (lockedCols) {\n        return mapToObject(lockedCols, always);\n      });\n    };\n    var getLockedColumnsFromGrid = function (grid) {\n      var locked = foldl(extractGridDetails(grid).rows, function (acc, row) {\n        each(row.cells, function (cell, idx) {\n          if (cell.isLocked) {\n            acc[idx] = true;\n          }\n        });\n        return acc;\n      }, {});\n      var lockedArr = mapToArray(locked, function (_val, key) {\n        return parseInt(key, 10);\n      });\n      return sort(lockedArr);\n    };\n\n    var key = function (row, column) {\n      return row + ',' + column;\n    };\n    var getAt = function (warehouse, row, column) {\n      var raw = warehouse.access[key(row, column)];\n      return raw !== undefined ? Optional.some(raw) : Optional.none();\n    };\n    var findItem = function (warehouse, item, comparator) {\n      var filtered = filterItems(warehouse, function (detail) {\n        return comparator(item, detail.element);\n      });\n      return filtered.length > 0 ? Optional.some(filtered[0]) : Optional.none();\n    };\n    var filterItems = function (warehouse, predicate) {\n      var all = bind(warehouse.all, function (r) {\n        return r.cells;\n      });\n      return filter(all, predicate);\n    };\n    var generateColumns = function (rowData) {\n      var columnsGroup = {};\n      var index = 0;\n      each(rowData.cells, function (column) {\n        var colspan = column.colspan;\n        range(colspan, function (columnIndex) {\n          var colIndex = index + columnIndex;\n          columnsGroup[colIndex] = columnext(column.element, colspan, colIndex);\n        });\n        index += colspan;\n      });\n      return columnsGroup;\n    };\n    var generate = function (list) {\n      var access = {};\n      var cells = [];\n      var columns = {};\n      var tableOpt = head(list).map(function (rowData) {\n        return rowData.element;\n      }).bind(table);\n      var lockedColumns = tableOpt.bind(getLockedColumnsFromTable).getOr({});\n      var maxRows = 0;\n      var maxColumns = 0;\n      var rowCount = 0;\n      each(list, function (rowData) {\n        if (rowData.section === 'colgroup') {\n          columns = generateColumns(rowData);\n        } else {\n          var currentRow_1 = [];\n          each(rowData.cells, function (rowCell) {\n            var start = 0;\n            while (access[key(rowCount, start)] !== undefined) {\n              start++;\n            }\n            var isLocked = hasNonNullableKey(lockedColumns, start.toString());\n            var current = extended(rowCell.element, rowCell.rowspan, rowCell.colspan, rowCount, start, isLocked);\n            for (var occupiedColumnPosition = 0; occupiedColumnPosition < rowCell.colspan; occupiedColumnPosition++) {\n              for (var occupiedRowPosition = 0; occupiedRowPosition < rowCell.rowspan; occupiedRowPosition++) {\n                var rowPosition = rowCount + occupiedRowPosition;\n                var columnPosition = start + occupiedColumnPosition;\n                var newpos = key(rowPosition, columnPosition);\n                access[newpos] = current;\n                maxColumns = Math.max(maxColumns, columnPosition + 1);\n              }\n            }\n            currentRow_1.push(current);\n          });\n          maxRows++;\n          cells.push(rowdata(rowData.element, currentRow_1, rowData.section));\n          rowCount++;\n        }\n      });\n      var grid$1 = grid(maxRows, maxColumns);\n      return {\n        grid: grid$1,\n        access: access,\n        all: cells,\n        columns: columns\n      };\n    };\n    var fromTable$1 = function (table) {\n      var list = fromTable(table);\n      return generate(list);\n    };\n    var justCells = function (warehouse) {\n      return bind(warehouse.all, function (w) {\n        return w.cells;\n      });\n    };\n    var justColumns = function (warehouse) {\n      return values(warehouse.columns);\n    };\n    var hasColumns = function (warehouse) {\n      return keys(warehouse.columns).length > 0;\n    };\n    var getColumnAt = function (warehouse, columnIndex) {\n      return Optional.from(warehouse.columns[columnIndex]);\n    };\n    var Warehouse = {\n      fromTable: fromTable$1,\n      generate: generate,\n      getAt: getAt,\n      findItem: findItem,\n      filterItems: filterItems,\n      justCells: justCells,\n      justColumns: justColumns,\n      hasColumns: hasColumns,\n      getColumnAt: getColumnAt\n    };\n\n    var inSelection = function (bounds, detail) {\n      var leftEdge = detail.column;\n      var rightEdge = detail.column + detail.colspan - 1;\n      var topEdge = detail.row;\n      var bottomEdge = detail.row + detail.rowspan - 1;\n      return leftEdge <= bounds.finishCol && rightEdge >= bounds.startCol && (topEdge <= bounds.finishRow && bottomEdge >= bounds.startRow);\n    };\n    var isWithin = function (bounds, detail) {\n      return detail.column >= bounds.startCol && detail.column + detail.colspan - 1 <= bounds.finishCol && detail.row >= bounds.startRow && detail.row + detail.rowspan - 1 <= bounds.finishRow;\n    };\n    var isRectangular = function (warehouse, bounds) {\n      var isRect = true;\n      var detailIsWithin = curry(isWithin, bounds);\n      for (var i = bounds.startRow; i <= bounds.finishRow; i++) {\n        for (var j = bounds.startCol; j <= bounds.finishCol; j++) {\n          isRect = isRect && Warehouse.getAt(warehouse, i, j).exists(detailIsWithin);\n        }\n      }\n      return isRect ? Optional.some(bounds) : Optional.none();\n    };\n\n    var getBounds = function (detailA, detailB) {\n      return bounds(Math.min(detailA.row, detailB.row), Math.min(detailA.column, detailB.column), Math.max(detailA.row + detailA.rowspan - 1, detailB.row + detailB.rowspan - 1), Math.max(detailA.column + detailA.colspan - 1, detailB.column + detailB.colspan - 1));\n    };\n    var getAnyBox = function (warehouse, startCell, finishCell) {\n      var startCoords = Warehouse.findItem(warehouse, startCell, eq$1);\n      var finishCoords = Warehouse.findItem(warehouse, finishCell, eq$1);\n      return startCoords.bind(function (sc) {\n        return finishCoords.map(function (fc) {\n          return getBounds(sc, fc);\n        });\n      });\n    };\n    var getBox = function (warehouse, startCell, finishCell) {\n      return getAnyBox(warehouse, startCell, finishCell).bind(function (bounds) {\n        return isRectangular(warehouse, bounds);\n      });\n    };\n\n    var moveBy = function (warehouse, cell, row, column) {\n      return Warehouse.findItem(warehouse, cell, eq$1).bind(function (detail) {\n        var startRow = row > 0 ? detail.row + detail.rowspan - 1 : detail.row;\n        var startCol = column > 0 ? detail.column + detail.colspan - 1 : detail.column;\n        var dest = Warehouse.getAt(warehouse, startRow + row, startCol + column);\n        return dest.map(function (d) {\n          return d.element;\n        });\n      });\n    };\n    var intercepts = function (warehouse, start, finish) {\n      return getAnyBox(warehouse, start, finish).map(function (bounds) {\n        var inside = Warehouse.filterItems(warehouse, curry(inSelection, bounds));\n        return map(inside, function (detail) {\n          return detail.element;\n        });\n      });\n    };\n    var parentCell = function (warehouse, innerCell) {\n      var isContainedBy = function (c1, c2) {\n        return contains$2(c2, c1);\n      };\n      return Warehouse.findItem(warehouse, innerCell, isContainedBy).map(function (detail) {\n        return detail.element;\n      });\n    };\n\n    var moveBy$1 = function (cell, deltaRow, deltaColumn) {\n      return table(cell).bind(function (table) {\n        var warehouse = getWarehouse(table);\n        return moveBy(warehouse, cell, deltaRow, deltaColumn);\n      });\n    };\n    var intercepts$1 = function (table, first, last) {\n      var warehouse = getWarehouse(table);\n      return intercepts(warehouse, first, last);\n    };\n    var nestedIntercepts = function (table, first, firstTable, last, lastTable) {\n      var warehouse = getWarehouse(table);\n      var optStartCell = eq$1(table, firstTable) ? Optional.some(first) : parentCell(warehouse, first);\n      var optLastCell = eq$1(table, lastTable) ? Optional.some(last) : parentCell(warehouse, last);\n      return optStartCell.bind(function (startCell) {\n        return optLastCell.bind(function (lastCell) {\n          return intercepts(warehouse, startCell, lastCell);\n        });\n      });\n    };\n    var getBox$1 = function (table, first, last) {\n      var warehouse = getWarehouse(table);\n      return getBox(warehouse, first, last);\n    };\n    var getWarehouse = Warehouse.fromTable;\n\n    var before = function (marker, element) {\n      var parent$1 = parent(marker);\n      parent$1.each(function (v) {\n        v.dom.insertBefore(element.dom, marker.dom);\n      });\n    };\n    var after = function (marker, element) {\n      var sibling = nextSibling(marker);\n      sibling.fold(function () {\n        var parent$1 = parent(marker);\n        parent$1.each(function (v) {\n          append(v, element);\n        });\n      }, function (v) {\n        before(v, element);\n      });\n    };\n    var prepend = function (parent, element) {\n      var firstChild$1 = firstChild(parent);\n      firstChild$1.fold(function () {\n        append(parent, element);\n      }, function (v) {\n        parent.dom.insertBefore(element.dom, v.dom);\n      });\n    };\n    var append = function (parent, element) {\n      parent.dom.appendChild(element.dom);\n    };\n    var wrap = function (element, wrapper) {\n      before(element, wrapper);\n      append(wrapper, element);\n    };\n\n    var before$1 = function (marker, elements) {\n      each(elements, function (x) {\n        before(marker, x);\n      });\n    };\n    var after$1 = function (marker, elements) {\n      each(elements, function (x, i) {\n        var e = i === 0 ? marker : elements[i - 1];\n        after(e, x);\n      });\n    };\n    var append$1 = function (parent, elements) {\n      each(elements, function (x) {\n        append(parent, x);\n      });\n    };\n\n    var empty = function (element) {\n      element.dom.textContent = '';\n      each(children(element), function (rogue) {\n        remove$2(rogue);\n      });\n    };\n    var remove$2 = function (element) {\n      var dom = element.dom;\n      if (dom.parentNode !== null) {\n        dom.parentNode.removeChild(dom);\n      }\n    };\n    var unwrap = function (wrapper) {\n      var children$1 = children(wrapper);\n      if (children$1.length > 0) {\n        before$1(wrapper, children$1);\n      }\n      remove$2(wrapper);\n    };\n\n    var NodeValue = function (is, name) {\n      var get = function (element) {\n        if (!is(element)) {\n          throw new Error('Can only get ' + name + ' value of a ' + name + ' node');\n        }\n        return getOption(element).getOr('');\n      };\n      var getOption = function (element) {\n        return is(element) ? Optional.from(element.dom.nodeValue) : Optional.none();\n      };\n      var set = function (element, value) {\n        if (!is(element)) {\n          throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');\n        }\n        element.dom.nodeValue = value;\n      };\n      return {\n        get: get,\n        getOption: getOption,\n        set: set\n      };\n    };\n\n    var api = NodeValue(isText, 'text');\n    var get$4 = function (element) {\n      return api.get(element);\n    };\n    var getOption = function (element) {\n      return api.getOption(element);\n    };\n    var set$2 = function (element, value) {\n      return api.set(element, value);\n    };\n\n    var TagBoundaries = [\n      'body',\n      'p',\n      'div',\n      'article',\n      'aside',\n      'figcaption',\n      'figure',\n      'footer',\n      'header',\n      'nav',\n      'section',\n      'ol',\n      'ul',\n      'li',\n      'table',\n      'thead',\n      'tbody',\n      'tfoot',\n      'caption',\n      'tr',\n      'td',\n      'th',\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6',\n      'blockquote',\n      'pre',\n      'address'\n    ];\n\n    function DomUniverse () {\n      var clone$1 = function (element) {\n        return SugarElement.fromDom(element.dom.cloneNode(false));\n      };\n      var document = function (element) {\n        return documentOrOwner(element).dom;\n      };\n      var isBoundary = function (element) {\n        if (!isElement(element)) {\n          return false;\n        }\n        if (name(element) === 'body') {\n          return true;\n        }\n        return contains(TagBoundaries, name(element));\n      };\n      var isEmptyTag = function (element) {\n        if (!isElement(element)) {\n          return false;\n        }\n        return contains([\n          'br',\n          'img',\n          'hr',\n          'input'\n        ], name(element));\n      };\n      var isNonEditable = function (element) {\n        return isElement(element) && get$2(element, 'contenteditable') === 'false';\n      };\n      var comparePosition = function (element, other) {\n        return element.dom.compareDocumentPosition(other.dom);\n      };\n      var copyAttributesTo = function (source, destination) {\n        var as = clone(source);\n        setAll(destination, as);\n      };\n      var isSpecial = function (element) {\n        var tag = name(element);\n        return contains([\n          'script',\n          'noscript',\n          'iframe',\n          'noframes',\n          'noembed',\n          'title',\n          'style',\n          'textarea',\n          'xmp'\n        ], tag);\n      };\n      return {\n        up: constant({\n          selector: ancestor$1,\n          closest: closest$1,\n          predicate: ancestor,\n          all: parents\n        }),\n        down: constant({\n          selector: descendants$1,\n          predicate: descendants\n        }),\n        styles: constant({\n          get: get$3,\n          getRaw: getRaw,\n          set: set$1,\n          remove: remove$1\n        }),\n        attrs: constant({\n          get: get$2,\n          set: set,\n          remove: remove,\n          copyTo: copyAttributesTo\n        }),\n        insert: constant({\n          before: before,\n          after: after,\n          afterAll: after$1,\n          append: append,\n          appendAll: append$1,\n          prepend: prepend,\n          wrap: wrap\n        }),\n        remove: constant({\n          unwrap: unwrap,\n          remove: remove$2\n        }),\n        create: constant({\n          nu: SugarElement.fromTag,\n          clone: clone$1,\n          text: SugarElement.fromText\n        }),\n        query: constant({\n          comparePosition: comparePosition,\n          prevSibling: prevSibling,\n          nextSibling: nextSibling\n        }),\n        property: constant({\n          children: children,\n          name: name,\n          parent: parent,\n          document: document,\n          isText: isText,\n          isComment: isComment,\n          isElement: isElement,\n          isSpecial: isSpecial,\n          getText: get$4,\n          setText: set$2,\n          isBoundary: isBoundary,\n          isEmptyTag: isEmptyTag,\n          isNonEditable: isNonEditable\n        }),\n        eq: eq$1,\n        is: is$1\n      };\n    }\n\n    var all$1 = function (universe, look, elements, f) {\n      var head = elements[0];\n      var tail = elements.slice(1);\n      return f(universe, look, head, tail);\n    };\n    var oneAll = function (universe, look, elements) {\n      return elements.length > 0 ? all$1(universe, look, elements, unsafeOne) : Optional.none();\n    };\n    var unsafeOne = function (universe, look, head, tail) {\n      var start = look(universe, head);\n      return foldr(tail, function (b, a) {\n        var current = look(universe, a);\n        return commonElement(universe, b, current);\n      }, start);\n    };\n    var commonElement = function (universe, start, end) {\n      return start.bind(function (s) {\n        return end.filter(curry(universe.eq, s));\n      });\n    };\n\n    var eq$2 = function (universe, item) {\n      return curry(universe.eq, item);\n    };\n    var ancestors$2 = function (universe, start, end, isRoot) {\n      if (isRoot === void 0) {\n        isRoot = never;\n      }\n      var ps1 = [start].concat(universe.up().all(start));\n      var ps2 = [end].concat(universe.up().all(end));\n      var prune = function (path) {\n        var index = findIndex(path, isRoot);\n        return index.fold(function () {\n          return path;\n        }, function (ind) {\n          return path.slice(0, ind + 1);\n        });\n      };\n      var pruned1 = prune(ps1);\n      var pruned2 = prune(ps2);\n      var shared = find(pruned1, function (x) {\n        return exists(pruned2, eq$2(universe, x));\n      });\n      return {\n        firstpath: pruned1,\n        secondpath: pruned2,\n        shared: shared\n      };\n    };\n\n    var sharedOne = oneAll;\n    var ancestors$3 = ancestors$2;\n\n    var universe = DomUniverse();\n    var sharedOne$1 = function (look, elements) {\n      return sharedOne(universe, function (_universe, element) {\n        return look(element);\n      }, elements);\n    };\n    var ancestors$4 = function (start, finish, isRoot) {\n      return ancestors$3(universe, start, finish, isRoot);\n    };\n\n    var lookupTable = function (container) {\n      return ancestor$1(container, 'table');\n    };\n    var identify = function (start, finish, isRoot) {\n      var getIsRoot = function (rootTable) {\n        return function (element) {\n          return isRoot !== undefined && isRoot(element) || eq$1(element, rootTable);\n        };\n      };\n      if (eq$1(start, finish)) {\n        return Optional.some({\n          boxes: Optional.some([start]),\n          start: start,\n          finish: finish\n        });\n      } else {\n        return lookupTable(start).bind(function (startTable) {\n          return lookupTable(finish).bind(function (finishTable) {\n            if (eq$1(startTable, finishTable)) {\n              return Optional.some({\n                boxes: intercepts$1(startTable, start, finish),\n                start: start,\n                finish: finish\n              });\n            } else if (contains$2(startTable, finishTable)) {\n              var ancestorCells = ancestors$1(finish, 'td,th', getIsRoot(startTable));\n              var finishCell = ancestorCells.length > 0 ? ancestorCells[ancestorCells.length - 1] : finish;\n              return Optional.some({\n                boxes: nestedIntercepts(startTable, start, startTable, finish, finishTable),\n                start: start,\n                finish: finishCell\n              });\n            } else if (contains$2(finishTable, startTable)) {\n              var ancestorCells = ancestors$1(start, 'td,th', getIsRoot(finishTable));\n              var startCell = ancestorCells.length > 0 ? ancestorCells[ancestorCells.length - 1] : start;\n              return Optional.some({\n                boxes: nestedIntercepts(finishTable, start, startTable, finish, finishTable),\n                start: start,\n                finish: startCell\n              });\n            } else {\n              return ancestors$4(start, finish).shared.bind(function (lca) {\n                return closest$1(lca, 'table', isRoot).bind(function (lcaTable) {\n                  var finishAncestorCells = ancestors$1(finish, 'td,th', getIsRoot(lcaTable));\n                  var finishCell = finishAncestorCells.length > 0 ? finishAncestorCells[finishAncestorCells.length - 1] : finish;\n                  var startAncestorCells = ancestors$1(start, 'td,th', getIsRoot(lcaTable));\n                  var startCell = startAncestorCells.length > 0 ? startAncestorCells[startAncestorCells.length - 1] : start;\n                  return Optional.some({\n                    boxes: nestedIntercepts(lcaTable, start, startTable, finish, finishTable),\n                    start: startCell,\n                    finish: finishCell\n                  });\n                });\n              });\n            }\n          });\n        });\n      }\n    };\n    var retrieve = function (container, selector) {\n      var sels = descendants$1(container, selector);\n      return sels.length > 0 ? Optional.some(sels) : Optional.none();\n    };\n    var getLast = function (boxes, lastSelectedSelector) {\n      return find(boxes, function (box) {\n        return is(box, lastSelectedSelector);\n      });\n    };\n    var getEdges = function (container, firstSelectedSelector, lastSelectedSelector) {\n      return descendant$1(container, firstSelectedSelector).bind(function (first) {\n        return descendant$1(container, lastSelectedSelector).bind(function (last) {\n          return sharedOne$1(lookupTable, [\n            first,\n            last\n          ]).map(function (table) {\n            return {\n              first: first,\n              last: last,\n              table: table\n            };\n          });\n        });\n      });\n    };\n    var expandTo = function (finish, firstSelectedSelector) {\n      return ancestor$1(finish, 'table').bind(function (table) {\n        return descendant$1(table, firstSelectedSelector).bind(function (start) {\n          return identify(start, finish).bind(function (identified) {\n            return identified.boxes.map(function (boxes) {\n              return {\n                boxes: boxes,\n                start: identified.start,\n                finish: identified.finish\n              };\n            });\n          });\n        });\n      });\n    };\n    var shiftSelection = function (boxes, deltaRow, deltaColumn, firstSelectedSelector, lastSelectedSelector) {\n      return getLast(boxes, lastSelectedSelector).bind(function (last) {\n        return moveBy$1(last, deltaRow, deltaColumn).bind(function (finish) {\n          return expandTo(finish, firstSelectedSelector);\n        });\n      });\n    };\n\n    var retrieve$1 = function (container, selector) {\n      return retrieve(container, selector);\n    };\n    var retrieveBox = function (container, firstSelectedSelector, lastSelectedSelector) {\n      return getEdges(container, firstSelectedSelector, lastSelectedSelector).bind(function (edges) {\n        var isRoot = function (ancestor) {\n          return eq$1(container, ancestor);\n        };\n        var sectionSelector = 'thead,tfoot,tbody,table';\n        var firstAncestor = ancestor$1(edges.first, sectionSelector, isRoot);\n        var lastAncestor = ancestor$1(edges.last, sectionSelector, isRoot);\n        return firstAncestor.bind(function (fA) {\n          return lastAncestor.bind(function (lA) {\n            return eq$1(fA, lA) ? getBox$1(edges.table, edges.first, edges.last) : Optional.none();\n          });\n        });\n      });\n    };\n\n    var generate$1 = function (cases) {\n      if (!isArray(cases)) {\n        throw new Error('cases must be an array');\n      }\n      if (cases.length === 0) {\n        throw new Error('there must be at least one case');\n      }\n      var constructors = [];\n      var adt = {};\n      each(cases, function (acase, count) {\n        var keys$1 = keys(acase);\n        if (keys$1.length !== 1) {\n          throw new Error('one and only one name per case');\n        }\n        var key = keys$1[0];\n        var value = acase[key];\n        if (adt[key] !== undefined) {\n          throw new Error('duplicate key detected:' + key);\n        } else if (key === 'cata') {\n          throw new Error('cannot have a case named cata (sorry)');\n        } else if (!isArray(value)) {\n          throw new Error('case arguments must be an array');\n        }\n        constructors.push(key);\n        adt[key] = function () {\n          var args = [];\n          for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n          }\n          var argLength = args.length;\n          if (argLength !== value.length) {\n            throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);\n          }\n          var match = function (branches) {\n            var branchKeys = keys(branches);\n            if (constructors.length !== branchKeys.length) {\n              throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\\nActual: ' + branchKeys.join(','));\n            }\n            var allReqd = forall(constructors, function (reqKey) {\n              return contains(branchKeys, reqKey);\n            });\n            if (!allReqd) {\n              throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\\nRequired: ' + constructors.join(', '));\n            }\n            return branches[key].apply(null, args);\n          };\n          return {\n            fold: function () {\n              var foldArgs = [];\n              for (var _i = 0; _i < arguments.length; _i++) {\n                foldArgs[_i] = arguments[_i];\n              }\n              if (foldArgs.length !== cases.length) {\n                throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + foldArgs.length);\n              }\n              var target = foldArgs[count];\n              return target.apply(null, args);\n            },\n            match: match,\n            log: function (label) {\n              console.log(label, {\n                constructors: constructors,\n                constructor: key,\n                params: args\n              });\n            }\n          };\n        };\n      });\n      return adt;\n    };\n    var Adt = { generate: generate$1 };\n\n    var type$1 = Adt.generate([\n      { none: [] },\n      { multiple: ['elements'] },\n      { single: ['element'] }\n    ]);\n    var cata = function (subject, onNone, onMultiple, onSingle) {\n      return subject.fold(onNone, onMultiple, onSingle);\n    };\n    var none$1 = type$1.none;\n    var multiple = type$1.multiple;\n    var single = type$1.single;\n\n    var Selections = function (lazyRoot, getStart, selectedSelector) {\n      var get = function () {\n        return retrieve$1(lazyRoot(), selectedSelector).fold(function () {\n          return getStart().map(single).getOrThunk(none$1);\n        }, function (cells) {\n          return multiple(cells);\n        });\n      };\n      return { get: get };\n    };\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var clone$1 = function (original, isDeep) {\n      return SugarElement.fromDom(original.dom.cloneNode(isDeep));\n    };\n    var shallow = function (original) {\n      return clone$1(original, false);\n    };\n    var deep = function (original) {\n      return clone$1(original, true);\n    };\n    var shallowAs = function (original, tag) {\n      var nu = SugarElement.fromTag(tag);\n      var attributes = clone(original);\n      setAll(nu, attributes);\n      return nu;\n    };\n    var copy$1 = function (original, tag) {\n      var nu = shallowAs(original, tag);\n      var cloneChildren = children(deep(original));\n      append$1(nu, cloneChildren);\n      return nu;\n    };\n\n    var cat = function (arr) {\n      var r = [];\n      var push = function (x) {\n        r.push(x);\n      };\n      for (var i = 0; i < arr.length; i++) {\n        arr[i].each(push);\n      }\n      return r;\n    };\n    var lift2 = function (oa, ob, f) {\n      return oa.isSome() && ob.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie())) : Optional.none();\n    };\n    var bindFrom = function (a, f) {\n      return a !== undefined && a !== null ? f(a) : Optional.none();\n    };\n    var someIf = function (b, a) {\n      return b ? Optional.some(a) : Optional.none();\n    };\n\n    var Dimension = function (name, getOffset) {\n      var set = function (element, h) {\n        if (!isNumber(h) && !h.match(/^[0-9]+$/)) {\n          throw new Error(name + '.set accepts only positive integer values. Value was ' + h);\n        }\n        var dom = element.dom;\n        if (isSupported$1(dom)) {\n          dom.style[name] = h + 'px';\n        }\n      };\n      var get = function (element) {\n        var r = getOffset(element);\n        if (r <= 0 || r === null) {\n          var css = get$3(element, name);\n          return parseFloat(css) || 0;\n        }\n        return r;\n      };\n      var getOuter = get;\n      var aggregate = function (element, properties) {\n        return foldl(properties, function (acc, property) {\n          var val = get$3(element, property);\n          var value = val === undefined ? 0 : parseInt(val, 10);\n          return isNaN(value) ? acc : acc + value;\n        }, 0);\n      };\n      var max = function (element, value, properties) {\n        var cumulativeInclusions = aggregate(element, properties);\n        var absoluteMax = value > cumulativeInclusions ? value - cumulativeInclusions : 0;\n        return absoluteMax;\n      };\n      return {\n        set: set,\n        get: get,\n        getOuter: getOuter,\n        aggregate: aggregate,\n        max: max\n      };\n    };\n\n    var api$1 = Dimension('width', function (element) {\n      return element.dom.offsetWidth;\n    });\n    var get$5 = function (element) {\n      return api$1.get(element);\n    };\n    var getOuter = function (element) {\n      return api$1.getOuter(element);\n    };\n\n    var columns$1 = function (warehouse, isValidCell) {\n      if (isValidCell === void 0) {\n        isValidCell = always;\n      }\n      var grid = warehouse.grid;\n      var cols = range(grid.columns, identity);\n      var rowsArr = range(grid.rows, identity);\n      return map(cols, function (col) {\n        var getBlock = function () {\n          return bind(rowsArr, function (r) {\n            return Warehouse.getAt(warehouse, r, col).filter(function (detail) {\n              return detail.column === col;\n            }).toArray();\n          });\n        };\n        var isValid = function (detail) {\n          return detail.colspan === 1 && isValidCell(detail.element);\n        };\n        var getFallback = function () {\n          return Warehouse.getAt(warehouse, 0, col);\n        };\n        return decide(getBlock, isValid, getFallback);\n      });\n    };\n    var decide = function (getBlock, isValid, getFallback) {\n      var inBlock = getBlock();\n      var validInBlock = find(inBlock, isValid);\n      var detailOption = validInBlock.orThunk(function () {\n        return Optional.from(inBlock[0]).orThunk(getFallback);\n      });\n      return detailOption.map(function (detail) {\n        return detail.element;\n      });\n    };\n    var rows$1 = function (warehouse) {\n      var grid = warehouse.grid;\n      var rowsArr = range(grid.rows, identity);\n      var cols = range(grid.columns, identity);\n      return map(rowsArr, function (row) {\n        var getBlock = function () {\n          return bind(cols, function (c) {\n            return Warehouse.getAt(warehouse, row, c).filter(function (detail) {\n              return detail.row === row;\n            }).fold(constant([]), function (detail) {\n              return [detail];\n            });\n          });\n        };\n        var isSingle = function (detail) {\n          return detail.rowspan === 1;\n        };\n        var getFallback = function () {\n          return Warehouse.getAt(warehouse, row, 0);\n        };\n        return decide(getBlock, isSingle, getFallback);\n      });\n    };\n\n    var deduce = function (xs, index) {\n      if (index < 0 || index >= xs.length - 1) {\n        return Optional.none();\n      }\n      var current = xs[index].fold(function () {\n        var rest = reverse(xs.slice(0, index));\n        return findMap(rest, function (a, i) {\n          return a.map(function (aa) {\n            return {\n              value: aa,\n              delta: i + 1\n            };\n          });\n        });\n      }, function (c) {\n        return Optional.some({\n          value: c,\n          delta: 0\n        });\n      });\n      var next = xs[index + 1].fold(function () {\n        var rest = xs.slice(index + 1);\n        return findMap(rest, function (a, i) {\n          return a.map(function (aa) {\n            return {\n              value: aa,\n              delta: i + 1\n            };\n          });\n        });\n      }, function (n) {\n        return Optional.some({\n          value: n,\n          delta: 1\n        });\n      });\n      return current.bind(function (c) {\n        return next.map(function (n) {\n          var extras = n.delta + c.delta;\n          return Math.abs(n.value - c.value) / extras;\n        });\n      });\n    };\n\n    var onDirection = function (isLtr, isRtl) {\n      return function (element) {\n        return getDirection(element) === 'rtl' ? isRtl : isLtr;\n      };\n    };\n    var getDirection = function (element) {\n      return get$3(element, 'direction') === 'rtl' ? 'rtl' : 'ltr';\n    };\n\n    var api$2 = Dimension('height', function (element) {\n      var dom = element.dom;\n      return inBody(element) ? dom.getBoundingClientRect().height : dom.offsetHeight;\n    });\n    var get$6 = function (element) {\n      return api$2.get(element);\n    };\n    var getOuter$1 = function (element) {\n      return api$2.getOuter(element);\n    };\n\n    var r = function (left, top) {\n      var translate = function (x, y) {\n        return r(left + x, top + y);\n      };\n      return {\n        left: left,\n        top: top,\n        translate: translate\n      };\n    };\n    var SugarPosition = r;\n\n    var boxPosition = function (dom) {\n      var box = dom.getBoundingClientRect();\n      return SugarPosition(box.left, box.top);\n    };\n    var firstDefinedOrZero = function (a, b) {\n      if (a !== undefined) {\n        return a;\n      } else {\n        return b !== undefined ? b : 0;\n      }\n    };\n    var absolute = function (element) {\n      var doc = element.dom.ownerDocument;\n      var body = doc.body;\n      var win = doc.defaultView;\n      var html = doc.documentElement;\n      if (body === element.dom) {\n        return SugarPosition(body.offsetLeft, body.offsetTop);\n      }\n      var scrollTop = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageYOffset, html.scrollTop);\n      var scrollLeft = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageXOffset, html.scrollLeft);\n      var clientTop = firstDefinedOrZero(html.clientTop, body.clientTop);\n      var clientLeft = firstDefinedOrZero(html.clientLeft, body.clientLeft);\n      return viewport(element).translate(scrollLeft - clientLeft, scrollTop - clientTop);\n    };\n    var viewport = function (element) {\n      var dom = element.dom;\n      var doc = dom.ownerDocument;\n      var body = doc.body;\n      if (body === dom) {\n        return SugarPosition(body.offsetLeft, body.offsetTop);\n      }\n      if (!inBody(element)) {\n        return SugarPosition(0, 0);\n      }\n      return boxPosition(dom);\n    };\n\n    var rowInfo = function (row, y) {\n      return {\n        row: row,\n        y: y\n      };\n    };\n    var colInfo = function (col, x) {\n      return {\n        col: col,\n        x: x\n      };\n    };\n    var rtlEdge = function (cell) {\n      var pos = absolute(cell);\n      return pos.left + getOuter(cell);\n    };\n    var ltrEdge = function (cell) {\n      return absolute(cell).left;\n    };\n    var getLeftEdge = function (index, cell) {\n      return colInfo(index, ltrEdge(cell));\n    };\n    var getRightEdge = function (index, cell) {\n      return colInfo(index, rtlEdge(cell));\n    };\n    var getTop = function (cell) {\n      return absolute(cell).top;\n    };\n    var getTopEdge = function (index, cell) {\n      return rowInfo(index, getTop(cell));\n    };\n    var getBottomEdge = function (index, cell) {\n      return rowInfo(index, getTop(cell) + getOuter$1(cell));\n    };\n    var findPositions = function (getInnerEdge, getOuterEdge, array) {\n      if (array.length === 0) {\n        return [];\n      }\n      var lines = map(array.slice(1), function (cellOption, index) {\n        return cellOption.map(function (cell) {\n          return getInnerEdge(index, cell);\n        });\n      });\n      var lastLine = array[array.length - 1].map(function (cell) {\n        return getOuterEdge(array.length - 1, cell);\n      });\n      return lines.concat([lastLine]);\n    };\n    var negate = function (step) {\n      return -step;\n    };\n    var height = {\n      delta: identity,\n      positions: function (optElements) {\n        return findPositions(getTopEdge, getBottomEdge, optElements);\n      },\n      edge: getTop\n    };\n    var ltr = {\n      delta: identity,\n      edge: ltrEdge,\n      positions: function (optElements) {\n        return findPositions(getLeftEdge, getRightEdge, optElements);\n      }\n    };\n    var rtl = {\n      delta: negate,\n      edge: rtlEdge,\n      positions: function (optElements) {\n        return findPositions(getRightEdge, getLeftEdge, optElements);\n      }\n    };\n    var detect$4 = onDirection(ltr, rtl);\n    var width = {\n      delta: function (amount, table) {\n        return detect$4(table).delta(amount, table);\n      },\n      positions: function (cols, table) {\n        return detect$4(table).positions(cols, table);\n      },\n      edge: function (cell) {\n        return detect$4(cell).edge(cell);\n      }\n    };\n\n    var units = {\n      unsupportedLength: [\n        'em',\n        'ex',\n        'cap',\n        'ch',\n        'ic',\n        'rem',\n        'lh',\n        'rlh',\n        'vw',\n        'vh',\n        'vi',\n        'vb',\n        'vmin',\n        'vmax',\n        'cm',\n        'mm',\n        'Q',\n        'in',\n        'pc',\n        'pt',\n        'px'\n      ],\n      fixed: [\n        'px',\n        'pt'\n      ],\n      relative: ['%'],\n      empty: ['']\n    };\n    var pattern = function () {\n      var decimalDigits = '[0-9]+';\n      var signedInteger = '[+-]?' + decimalDigits;\n      var exponentPart = '[eE]' + signedInteger;\n      var dot = '\\\\.';\n      var opt = function (input) {\n        return '(?:' + input + ')?';\n      };\n      var unsignedDecimalLiteral = [\n        'Infinity',\n        decimalDigits + dot + opt(decimalDigits) + opt(exponentPart),\n        dot + decimalDigits + opt(exponentPart),\n        decimalDigits + opt(exponentPart)\n      ].join('|');\n      var float = '[+-]?(?:' + unsignedDecimalLiteral + ')';\n      return new RegExp('^(' + float + ')(.*)$');\n    }();\n    var isUnit = function (unit, accepted) {\n      return exists(accepted, function (acc) {\n        return exists(units[acc], function (check) {\n          return unit === check;\n        });\n      });\n    };\n    var parse = function (input, accepted) {\n      var match = Optional.from(pattern.exec(input));\n      return match.bind(function (array) {\n        var value = Number(array[1]);\n        var unitRaw = array[2];\n        if (isUnit(unitRaw, accepted)) {\n          return Optional.some({\n            value: value,\n            unit: unitRaw\n          });\n        } else {\n          return Optional.none();\n        }\n      });\n    };\n\n    var needManualCalc = function () {\n      var browser = detect$3().browser;\n      return browser.isIE() || browser.isEdge();\n    };\n    var toNumber = function (px, fallback) {\n      var num = parseFloat(px);\n      return isNaN(num) ? fallback : num;\n    };\n    var getProp = function (elm, name, fallback) {\n      return toNumber(get$3(elm, name), fallback);\n    };\n    var getCalculatedHeight = function (cell) {\n      var height = cell.dom.getBoundingClientRect().height;\n      var boxSizing = get$3(cell, 'box-sizing');\n      if (boxSizing === 'border-box') {\n        return height;\n      } else {\n        var paddingTop = getProp(cell, 'padding-top', 0);\n        var paddingBottom = getProp(cell, 'padding-bottom', 0);\n        var borderTop = getProp(cell, 'border-top-width', 0);\n        var borderBottom = getProp(cell, 'border-bottom-width', 0);\n        var borders = borderTop + borderBottom;\n        return height - paddingTop - paddingBottom - borders;\n      }\n    };\n    var getCalculatedWidth = function (cell) {\n      var width = cell.dom.getBoundingClientRect().width;\n      var boxSizing = get$3(cell, 'box-sizing');\n      if (boxSizing === 'border-box') {\n        return width;\n      } else {\n        var paddingLeft = getProp(cell, 'padding-left', 0);\n        var paddingRight = getProp(cell, 'padding-right', 0);\n        var borderLeft = getProp(cell, 'border-left-width', 0);\n        var borderRight = getProp(cell, 'border-right-width', 0);\n        var borders = borderLeft + borderRight;\n        return width - paddingLeft - paddingRight - borders;\n      }\n    };\n    var getHeight = function (cell) {\n      return needManualCalc() ? getCalculatedHeight(cell) : getProp(cell, 'height', get$6(cell));\n    };\n    var getWidth = function (cell) {\n      return needManualCalc() ? getCalculatedWidth(cell) : getProp(cell, 'width', get$5(cell));\n    };\n\n    var rPercentageBasedSizeRegex = /(\\d+(\\.\\d+)?)%/;\n    var rPixelBasedSizeRegex = /(\\d+(\\.\\d+)?)px|em/;\n    var getPercentSize = function (elm, getter) {\n      var relativeParent = offsetParent(elm).getOr(getBody(owner(elm)));\n      return getter(elm) / getter(relativeParent) * 100;\n    };\n    var setPixelWidth = function (cell, amount) {\n      set$1(cell, 'width', amount + 'px');\n    };\n    var setPercentageWidth = function (cell, amount) {\n      set$1(cell, 'width', amount + '%');\n    };\n    var setHeight = function (cell, amount) {\n      set$1(cell, 'height', amount + 'px');\n    };\n    var getHeightValue = function (cell) {\n      return getRaw(cell, 'height').getOrThunk(function () {\n        return getHeight(cell) + 'px';\n      });\n    };\n    var convert = function (cell, number, getter, setter) {\n      var newSize = table(cell).map(function (table) {\n        var total = getter(table);\n        return Math.floor(number / 100 * total);\n      }).getOr(number);\n      setter(cell, newSize);\n      return newSize;\n    };\n    var normalizePixelSize = function (value, cell, getter, setter) {\n      var number = parseInt(value, 10);\n      return endsWith(value, '%') && name(cell) !== 'table' ? convert(cell, number, getter, setter) : number;\n    };\n    var getTotalHeight = function (cell) {\n      var value = getHeightValue(cell);\n      if (!value) {\n        return get$6(cell);\n      }\n      return normalizePixelSize(value, cell, get$6, setHeight);\n    };\n    var get$7 = function (cell, type, f) {\n      var v = f(cell);\n      var span = getSpan(cell, type);\n      return v / span;\n    };\n    var getRawWidth = function (element) {\n      var cssWidth = getRaw(element, 'width');\n      return cssWidth.fold(function () {\n        return Optional.from(get$2(element, 'width'));\n      }, function (width) {\n        return Optional.some(width);\n      });\n    };\n    var normalizePercentageWidth = function (cellWidth, tableSize) {\n      return cellWidth / tableSize.pixelWidth() * 100;\n    };\n    var choosePercentageSize = function (element, width, tableSize) {\n      var percentMatch = rPercentageBasedSizeRegex.exec(width);\n      if (percentMatch !== null) {\n        return parseFloat(percentMatch[1]);\n      } else {\n        var intWidth = getWidth(element);\n        return normalizePercentageWidth(intWidth, tableSize);\n      }\n    };\n    var getPercentageWidth = function (cell, tableSize) {\n      var width = getRawWidth(cell);\n      return width.fold(function () {\n        var intWidth = get$5(cell);\n        return normalizePercentageWidth(intWidth, tableSize);\n      }, function (w) {\n        return choosePercentageSize(cell, w, tableSize);\n      });\n    };\n    var normalizePixelWidth = function (cellWidth, tableSize) {\n      return cellWidth / 100 * tableSize.pixelWidth();\n    };\n    var choosePixelSize = function (element, width, tableSize) {\n      var pixelMatch = rPixelBasedSizeRegex.exec(width);\n      if (pixelMatch !== null) {\n        return parseInt(pixelMatch[1], 10);\n      }\n      var percentMatch = rPercentageBasedSizeRegex.exec(width);\n      if (percentMatch !== null) {\n        var floatWidth = parseFloat(percentMatch[1]);\n        return normalizePixelWidth(floatWidth, tableSize);\n      }\n      return getWidth(element);\n    };\n    var getPixelWidth = function (cell, tableSize) {\n      var width = getRawWidth(cell);\n      return width.fold(function () {\n        return getWidth(cell);\n      }, function (w) {\n        return choosePixelSize(cell, w, tableSize);\n      });\n    };\n    var getHeight$1 = function (cell) {\n      return get$7(cell, 'rowspan', getTotalHeight);\n    };\n    var getGenericWidth = function (cell) {\n      var width = getRawWidth(cell);\n      return width.bind(function (w) {\n        return parse(w, [\n          'fixed',\n          'relative',\n          'empty'\n        ]);\n      });\n    };\n    var setGenericWidth = function (cell, amount, unit) {\n      set$1(cell, 'width', amount + unit);\n    };\n    var getPixelTableWidth = function (table) {\n      return get$5(table) + 'px';\n    };\n    var getPercentTableWidth = function (table) {\n      return getPercentSize(table, get$5) + '%';\n    };\n    var isPercentSizing = function (table) {\n      return getRawWidth(table).exists(function (size) {\n        return rPercentageBasedSizeRegex.test(size);\n      });\n    };\n    var isPixelSizing = function (table) {\n      return getRawWidth(table).exists(function (size) {\n        return rPixelBasedSizeRegex.test(size);\n      });\n    };\n    var isNoneSizing = function (table) {\n      return getRawWidth(table).isNone();\n    };\n    var percentageBasedSizeRegex = constant(rPercentageBasedSizeRegex);\n    var pixelBasedSizeRegex = constant(rPixelBasedSizeRegex);\n\n    var isCol = isTag('col');\n    var getRaw$1 = function (cell, property, getter) {\n      return getRaw(cell, property).fold(function () {\n        return getter(cell) + 'px';\n      }, function (raw) {\n        return raw;\n      });\n    };\n    var getRawW = function (cell, tableSize) {\n      var fallback = function (e) {\n        return isCol(e) ? get$5(e) : getPixelWidth(e, tableSize);\n      };\n      return getRaw$1(cell, 'width', fallback);\n    };\n    var getRawH = function (cell) {\n      return getRaw$1(cell, 'height', getHeight$1);\n    };\n    var justCols = function (warehouse) {\n      return map(Warehouse.justColumns(warehouse), function (column) {\n        return Optional.from(column.element);\n      });\n    };\n    var hasRawStyle = function (cell, prop) {\n      return getRaw(cell, prop).isSome();\n    };\n    var isValidColumn = function (cell) {\n      return !isCol(cell) || hasRawStyle(cell, 'width');\n    };\n    var getDimension = function (cellOpt, index, backups, filter, getter, fallback) {\n      return cellOpt.filter(filter).fold(function () {\n        return fallback(deduce(backups, index));\n      }, function (cell) {\n        return getter(cell);\n      });\n    };\n    var getWidthFrom = function (warehouse, table, getWidth, fallback, tableSize) {\n      var columnCells = columns$1(warehouse, function (cell) {\n        return hasRawStyle(cell, 'width');\n      });\n      var columns = Warehouse.hasColumns(warehouse) ? justCols(warehouse) : columnCells;\n      var backups = [Optional.some(width.edge(table))].concat(map(width.positions(columnCells, table), function (pos) {\n        return pos.map(function (p) {\n          return p.x;\n        });\n      }));\n      var colFilter = not(hasColspan);\n      return map(columns, function (cellOption, c) {\n        return getDimension(cellOption, c, backups, colFilter, function (column) {\n          if (isValidColumn(column)) {\n            return getWidth(column, tableSize);\n          } else {\n            var cell = bindFrom(columnCells[c], identity);\n            return getDimension(cell, c, backups, colFilter, function (cell) {\n              return fallback(Optional.some(get$5(cell)));\n            }, fallback);\n          }\n        }, fallback);\n      });\n    };\n    var getDeduced = function (deduced) {\n      return deduced.map(function (d) {\n        return d + 'px';\n      }).getOr('');\n    };\n    var getRawWidths = function (warehouse, table, tableSize) {\n      return getWidthFrom(warehouse, table, getRawW, getDeduced, tableSize);\n    };\n    var getPercentageWidths = function (warehouse, table, tableSize) {\n      return getWidthFrom(warehouse, table, getPercentageWidth, function (deduced) {\n        return deduced.fold(function () {\n          return tableSize.minCellWidth();\n        }, function (cellWidth) {\n          return cellWidth / tableSize.pixelWidth() * 100;\n        });\n      }, tableSize);\n    };\n    var getPixelWidths = function (warehouse, table, tableSize) {\n      return getWidthFrom(warehouse, table, getPixelWidth, function (deduced) {\n        return deduced.getOrThunk(tableSize.minCellWidth);\n      }, tableSize);\n    };\n    var getHeightFrom = function (warehouse, table, direction, getHeight, fallback) {\n      var rows = rows$1(warehouse);\n      var backups = [Optional.some(direction.edge(table))].concat(map(direction.positions(rows, table), function (pos) {\n        return pos.map(function (p) {\n          return p.y;\n        });\n      }));\n      return map(rows, function (cellOption, c) {\n        return getDimension(cellOption, c, backups, not(hasRowspan), getHeight, fallback);\n      });\n    };\n    var getPixelHeights = function (warehouse, table, direction) {\n      return getHeightFrom(warehouse, table, direction, getHeight$1, function (deduced) {\n        return deduced.getOrThunk(minHeight);\n      });\n    };\n    var getRawHeights = function (warehouse, table, direction) {\n      return getHeightFrom(warehouse, table, direction, getRawH, getDeduced);\n    };\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      return {\n        get: get,\n        set: set\n      };\n    };\n\n    var noneSize = function (table) {\n      var getWidth = function () {\n        return get$5(table);\n      };\n      var zero = constant(0);\n      var getWidths = function (warehouse, tableSize) {\n        return getPixelWidths(warehouse, table, tableSize);\n      };\n      return {\n        width: getWidth,\n        pixelWidth: getWidth,\n        getWidths: getWidths,\n        getCellDelta: zero,\n        singleColumnWidth: constant([0]),\n        minCellWidth: zero,\n        setElementWidth: noop,\n        adjustTableWidth: noop,\n        isRelative: true,\n        label: 'none'\n      };\n    };\n    var percentageSize = function (initialWidth, table) {\n      var floatWidth = Cell(parseFloat(initialWidth));\n      var pixelWidth = Cell(get$5(table));\n      var getCellDelta = function (delta) {\n        return delta / pixelWidth.get() * 100;\n      };\n      var singleColumnWidth = function (w, _delta) {\n        return [100 - w];\n      };\n      var minCellWidth = function () {\n        return minWidth() / pixelWidth.get() * 100;\n      };\n      var adjustTableWidth = function (delta) {\n        var currentWidth = floatWidth.get();\n        var change = delta / 100 * currentWidth;\n        var newWidth = currentWidth + change;\n        setPercentageWidth(table, newWidth);\n        floatWidth.set(newWidth);\n        pixelWidth.set(get$5(table));\n      };\n      var getWidths = function (warehouse, tableSize) {\n        return getPercentageWidths(warehouse, table, tableSize);\n      };\n      return {\n        width: floatWidth.get,\n        pixelWidth: pixelWidth.get,\n        getWidths: getWidths,\n        getCellDelta: getCellDelta,\n        singleColumnWidth: singleColumnWidth,\n        minCellWidth: minCellWidth,\n        setElementWidth: setPercentageWidth,\n        adjustTableWidth: adjustTableWidth,\n        isRelative: true,\n        label: 'percent'\n      };\n    };\n    var pixelSize = function (initialWidth, table) {\n      var width = Cell(initialWidth);\n      var getWidth = width.get;\n      var getCellDelta = identity;\n      var singleColumnWidth = function (w, delta) {\n        var newNext = Math.max(minWidth(), w + delta);\n        return [newNext - w];\n      };\n      var adjustTableWidth = function (delta) {\n        var newWidth = getWidth() + delta;\n        setPixelWidth(table, newWidth);\n        width.set(newWidth);\n      };\n      var getWidths = function (warehouse, tableSize) {\n        return getPixelWidths(warehouse, table, tableSize);\n      };\n      return {\n        width: getWidth,\n        pixelWidth: getWidth,\n        getWidths: getWidths,\n        getCellDelta: getCellDelta,\n        singleColumnWidth: singleColumnWidth,\n        minCellWidth: minWidth,\n        setElementWidth: setPixelWidth,\n        adjustTableWidth: adjustTableWidth,\n        isRelative: false,\n        label: 'pixel'\n      };\n    };\n    var chooseSize = function (element, width) {\n      var percentMatch = percentageBasedSizeRegex().exec(width);\n      if (percentMatch !== null) {\n        return percentageSize(percentMatch[1], element);\n      }\n      var pixelMatch = pixelBasedSizeRegex().exec(width);\n      if (pixelMatch !== null) {\n        var intWidth = parseInt(pixelMatch[1], 10);\n        return pixelSize(intWidth, element);\n      }\n      var fallbackWidth = get$5(element);\n      return pixelSize(fallbackWidth, element);\n    };\n    var getTableSize = function (table) {\n      var width = getRawWidth(table);\n      return width.fold(function () {\n        return noneSize(table);\n      }, function (w) {\n        return chooseSize(table, w);\n      });\n    };\n    var TableSize = {\n      getTableSize: getTableSize,\n      pixelSize: pixelSize,\n      percentageSize: percentageSize,\n      noneSize: noneSize\n    };\n\n    var statsStruct = function (minRow, minCol, maxRow, maxCol, allCells, selectedCells) {\n      return {\n        minRow: minRow,\n        minCol: minCol,\n        maxRow: maxRow,\n        maxCol: maxCol,\n        allCells: allCells,\n        selectedCells: selectedCells\n      };\n    };\n    var findSelectedStats = function (house, isSelected) {\n      var totalColumns = house.grid.columns;\n      var totalRows = house.grid.rows;\n      var minRow = totalRows;\n      var minCol = totalColumns;\n      var maxRow = 0;\n      var maxCol = 0;\n      var allCells = [];\n      var selectedCells = [];\n      each$1(house.access, function (detail) {\n        allCells.push(detail);\n        if (isSelected(detail)) {\n          selectedCells.push(detail);\n          var startRow = detail.row;\n          var endRow = startRow + detail.rowspan - 1;\n          var startCol = detail.column;\n          var endCol = startCol + detail.colspan - 1;\n          if (startRow < minRow) {\n            minRow = startRow;\n          } else if (endRow > maxRow) {\n            maxRow = endRow;\n          }\n          if (startCol < minCol) {\n            minCol = startCol;\n          } else if (endCol > maxCol) {\n            maxCol = endCol;\n          }\n        }\n      });\n      return statsStruct(minRow, minCol, maxRow, maxCol, allCells, selectedCells);\n    };\n    var makeCell = function (list, seenSelected, rowIndex) {\n      var row = list[rowIndex].element;\n      var td = SugarElement.fromTag('td');\n      append(td, SugarElement.fromTag('br'));\n      var f = seenSelected ? append : prepend;\n      f(row, td);\n    };\n    var fillInGaps = function (list, house, stats, isSelected) {\n      var totalColumns = house.grid.columns;\n      var totalRows = house.grid.rows;\n      for (var i = 0; i < totalRows; i++) {\n        var seenSelected = false;\n        for (var j = 0; j < totalColumns; j++) {\n          if (!(i < stats.minRow || i > stats.maxRow || j < stats.minCol || j > stats.maxCol)) {\n            var needCell = Warehouse.getAt(house, i, j).filter(isSelected).isNone();\n            if (needCell) {\n              makeCell(list, seenSelected, i);\n            } else {\n              seenSelected = true;\n            }\n          }\n        }\n      }\n    };\n    var clean = function (replica, stats, house, widthDelta) {\n      each$1(house.columns, function (col) {\n        if (col.column < stats.minCol || col.column > stats.maxCol) {\n          remove$2(col.element);\n        }\n      });\n      var emptyRows = filter(firstLayer(replica, 'tr'), function (row) {\n        return row.dom.childElementCount === 0;\n      });\n      each(emptyRows, remove$2);\n      if (stats.minCol === stats.maxCol || stats.minRow === stats.maxRow) {\n        each(firstLayer(replica, 'th,td'), function (cell) {\n          remove(cell, 'rowspan');\n          remove(cell, 'colspan');\n        });\n      }\n      remove(replica, LOCKED_COL_ATTR);\n      remove(replica, 'data-snooker-col-series');\n      var tableSize = TableSize.getTableSize(replica);\n      tableSize.adjustTableWidth(widthDelta);\n    };\n    var getTableWidthDelta = function (table, warehouse, tableSize, stats) {\n      if (stats.minCol === 0 && warehouse.grid.columns === stats.maxCol + 1) {\n        return 0;\n      }\n      var colWidths = getPixelWidths(warehouse, table, tableSize);\n      var allColsWidth = foldl(colWidths, function (acc, width) {\n        return acc + width;\n      }, 0);\n      var selectedColsWidth = foldl(colWidths.slice(stats.minCol, stats.maxCol + 1), function (acc, width) {\n        return acc + width;\n      }, 0);\n      var newWidth = selectedColsWidth / allColsWidth * tableSize.pixelWidth();\n      var delta = newWidth - tableSize.pixelWidth();\n      return tableSize.getCellDelta(delta);\n    };\n    var extract = function (table, selectedSelector) {\n      var isSelected = function (detail) {\n        return is(detail.element, selectedSelector);\n      };\n      var replica = deep(table);\n      var list = fromTable(replica);\n      var tableSize = TableSize.getTableSize(table);\n      var replicaHouse = Warehouse.generate(list);\n      var replicaStats = findSelectedStats(replicaHouse, isSelected);\n      var selector = 'th:not(' + selectedSelector + ')' + ',td:not(' + selectedSelector + ')';\n      var unselectedCells = filterFirstLayer(replica, 'th,td', function (cell) {\n        return is(cell, selector);\n      });\n      each(unselectedCells, remove$2);\n      fillInGaps(list, replicaHouse, replicaStats, isSelected);\n      var house = Warehouse.fromTable(table);\n      var widthDelta = getTableWidthDelta(table, house, tableSize, replicaStats);\n      clean(replica, replicaStats, replicaHouse, widthDelta);\n      return replica;\n    };\n\n    var nbsp = '\\xA0';\n\n    var getEnd = function (element) {\n      return name(element) === 'img' ? 1 : getOption(element).fold(function () {\n        return children(element).length;\n      }, function (v) {\n        return v.length;\n      });\n    };\n    var isTextNodeWithCursorPosition = function (el) {\n      return getOption(el).filter(function (text) {\n        return text.trim().length !== 0 || text.indexOf(nbsp) > -1;\n      }).isSome();\n    };\n    var elementsWithCursorPosition = [\n      'img',\n      'br'\n    ];\n    var isCursorPosition = function (elem) {\n      var hasCursorPosition = isTextNodeWithCursorPosition(elem);\n      return hasCursorPosition || contains(elementsWithCursorPosition, name(elem));\n    };\n\n    var first = function (element) {\n      return descendant(element, isCursorPosition);\n    };\n    var last$1 = function (element) {\n      return descendantRtl(element, isCursorPosition);\n    };\n    var descendantRtl = function (scope, predicate) {\n      var descend = function (element) {\n        var children$1 = children(element);\n        for (var i = children$1.length - 1; i >= 0; i--) {\n          var child = children$1[i];\n          if (predicate(child)) {\n            return Optional.some(child);\n          }\n          var res = descend(child);\n          if (res.isSome()) {\n            return res;\n          }\n        }\n        return Optional.none();\n      };\n      return descend(scope);\n    };\n\n    var transferableAttributes = {\n      scope: [\n        'row',\n        'col'\n      ]\n    };\n    var createCell = function () {\n      var td = SugarElement.fromTag('td');\n      append(td, SugarElement.fromTag('br'));\n      return td;\n    };\n    var createCol = function () {\n      return SugarElement.fromTag('col');\n    };\n    var createColgroup = function () {\n      return SugarElement.fromTag('colgroup');\n    };\n    var replace = function (cell, tag, attrs) {\n      var replica = copy$1(cell, tag);\n      each$1(attrs, function (v, k) {\n        if (v === null) {\n          remove(replica, k);\n        } else {\n          set(replica, k, v);\n        }\n      });\n      return replica;\n    };\n    var pasteReplace = function (cell) {\n      return cell;\n    };\n    var newRow = function (doc) {\n      return function () {\n        return SugarElement.fromTag('tr', doc.dom);\n      };\n    };\n    var cloneFormats = function (oldCell, newCell, formats) {\n      var first$1 = first(oldCell);\n      return first$1.map(function (firstText) {\n        var formatSelector = formats.join(',');\n        var parents = ancestors$1(firstText, formatSelector, function (element) {\n          return eq$1(element, oldCell);\n        });\n        return foldr(parents, function (last, parent) {\n          var clonedFormat = shallow(parent);\n          remove(clonedFormat, 'contenteditable');\n          append(last, clonedFormat);\n          return clonedFormat;\n        }, newCell);\n      }).getOr(newCell);\n    };\n    var cloneAppropriateAttributes = function (original, clone) {\n      each$1(transferableAttributes, function (validAttributes, attributeName) {\n        return getOpt(original, attributeName).filter(function (attribute) {\n          return contains(validAttributes, attribute);\n        }).each(function (attribute) {\n          return set(clone, attributeName, attribute);\n        });\n      });\n    };\n    var cellOperations = function (mutate, doc, formatsToClone) {\n      var cloneCss = function (prev, clone) {\n        copy(prev.element, clone);\n        remove$1(clone, 'height');\n        if (prev.colspan !== 1) {\n          remove$1(clone, 'width');\n        }\n      };\n      var newCell = function (prev) {\n        var docu = owner(prev.element);\n        var td = SugarElement.fromTag(name(prev.element), docu.dom);\n        var formats = formatsToClone.getOr([\n          'strong',\n          'em',\n          'b',\n          'i',\n          'span',\n          'font',\n          'h1',\n          'h2',\n          'h3',\n          'h4',\n          'h5',\n          'h6',\n          'p',\n          'div'\n        ]);\n        var lastNode = formats.length > 0 ? cloneFormats(prev.element, td, formats) : td;\n        append(lastNode, SugarElement.fromTag('br'));\n        cloneCss(prev, td);\n        cloneAppropriateAttributes(prev.element, td);\n        mutate(prev.element, td);\n        return td;\n      };\n      var newCol = function (prev) {\n        var doc = owner(prev.element);\n        var col = SugarElement.fromTag(name(prev.element), doc.dom);\n        cloneCss(prev, col);\n        mutate(prev.element, col);\n        return col;\n      };\n      return {\n        col: newCol,\n        colgroup: createColgroup,\n        row: newRow(doc),\n        cell: newCell,\n        replace: replace,\n        gap: createCell\n      };\n    };\n    var paste = function (doc) {\n      return {\n        col: createCol,\n        colgroup: createColgroup,\n        row: newRow(doc),\n        cell: createCell,\n        replace: pasteReplace,\n        gap: createCell\n      };\n    };\n\n    var fromHtml$1 = function (html, scope) {\n      var doc = scope || document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      return children(SugarElement.fromDom(div));\n    };\n    var fromDom$1 = function (nodes) {\n      return map(nodes, SugarElement.fromDom);\n    };\n\n    var getNodeName = function (elm) {\n      return elm.nodeName.toLowerCase();\n    };\n    var getBody$1 = function (editor) {\n      return SugarElement.fromDom(editor.getBody());\n    };\n    var getPixelWidth$1 = function (elm) {\n      return elm.getBoundingClientRect().width;\n    };\n    var getPixelHeight = function (elm) {\n      return elm.getBoundingClientRect().height;\n    };\n    var getIsRoot = function (editor) {\n      return function (element) {\n        return eq$1(element, getBody$1(editor));\n      };\n    };\n    var removePxSuffix = function (size) {\n      return size ? size.replace(/px$/, '') : '';\n    };\n    var addPxSuffix = function (size) {\n      return /^\\d+(\\.\\d+)?$/.test(size) ? size + 'px' : size;\n    };\n    var removeDataStyle = function (table) {\n      remove(table, 'data-mce-style');\n      var removeStyleAttribute = function (element) {\n        return remove(element, 'data-mce-style');\n      };\n      each(cells(table), removeStyleAttribute);\n      each(columns(table), removeStyleAttribute);\n    };\n    var getRawWidth$1 = function (editor, elm) {\n      var raw = editor.dom.getStyle(elm, 'width') || editor.dom.getAttrib(elm, 'width');\n      return Optional.from(raw).filter(isNotEmpty);\n    };\n    var isPercentage = function (value) {\n      return /^(\\d+(\\.\\d+)?)%$/.test(value);\n    };\n    var isPixel = function (value) {\n      return /^(\\d+(\\.\\d+)?)px$/.test(value);\n    };\n    var getSelectionStart = function (editor) {\n      return SugarElement.fromDom(editor.selection.getStart());\n    };\n\n    var selection = function (selections) {\n      return cata(selections.get(), constant([]), identity, pure);\n    };\n    var unmergable = function (selections) {\n      var hasSpan = function (elem, type) {\n        return getOpt(elem, type).exists(function (span) {\n          return parseInt(span, 10) > 1;\n        });\n      };\n      var hasRowOrColSpan = function (elem) {\n        return hasSpan(elem, 'rowspan') || hasSpan(elem, 'colspan');\n      };\n      var candidates = selection(selections);\n      return candidates.length > 0 && forall(candidates, hasRowOrColSpan) ? Optional.some(candidates) : Optional.none();\n    };\n    var mergable = function (table, selections, ephemera) {\n      return cata(selections.get(), Optional.none, function (cells) {\n        if (cells.length <= 1) {\n          return Optional.none();\n        } else {\n          return retrieveBox(table, ephemera.firstSelectedSelector, ephemera.lastSelectedSelector).map(function (bounds) {\n            return {\n              bounds: bounds,\n              cells: cells\n            };\n          });\n        }\n      }, Optional.none);\n    };\n\n    var strSelected = 'data-mce-selected';\n    var strSelectedSelector = 'td[' + strSelected + '],th[' + strSelected + ']';\n    var strAttributeSelector = '[' + strSelected + ']';\n    var strFirstSelected = 'data-mce-first-selected';\n    var strFirstSelectedSelector = 'td[' + strFirstSelected + '],th[' + strFirstSelected + ']';\n    var strLastSelected = 'data-mce-last-selected';\n    var strLastSelectedSelector = 'td[' + strLastSelected + '],th[' + strLastSelected + ']';\n    var attributeSelector = strAttributeSelector;\n    var ephemera = {\n      selected: strSelected,\n      selectedSelector: strSelectedSelector,\n      firstSelected: strFirstSelected,\n      firstSelectedSelector: strFirstSelectedSelector,\n      lastSelected: strLastSelected,\n      lastSelectedSelector: strLastSelectedSelector\n    };\n\n    var noMenu = function (cell) {\n      return {\n        element: cell,\n        mergable: Optional.none(),\n        unmergable: Optional.none(),\n        selection: [cell]\n      };\n    };\n    var forMenu = function (selections, table, cell) {\n      return {\n        element: cell,\n        mergable: mergable(table, selections, ephemera),\n        unmergable: unmergable(selections),\n        selection: selection(selections)\n      };\n    };\n    var paste$1 = function (element, clipboard, generators) {\n      return {\n        element: element,\n        clipboard: clipboard,\n        generators: generators\n      };\n    };\n    var pasteRows = function (selections, cell, clipboard, generators) {\n      return {\n        selection: selection(selections),\n        clipboard: clipboard,\n        generators: generators\n      };\n    };\n\n    var extractSelected = function (cells) {\n      return table(cells[0]).map(function (table) {\n        var replica = extract(table, attributeSelector);\n        removeDataStyle(replica);\n        return [replica];\n      });\n    };\n    var serializeElements = function (editor, elements) {\n      return map(elements, function (elm) {\n        return editor.selection.serializer.serialize(elm.dom, {});\n      }).join('');\n    };\n    var getTextContent = function (elements) {\n      return map(elements, function (element) {\n        return element.dom.innerText;\n      }).join('');\n    };\n    var registerEvents = function (editor, selections, actions, cellSelection) {\n      editor.on('BeforeGetContent', function (e) {\n        var multiCellContext = function (cells) {\n          e.preventDefault();\n          extractSelected(cells).each(function (elements) {\n            e.content = e.format === 'text' ? getTextContent(elements) : serializeElements(editor, elements);\n          });\n        };\n        if (e.selection === true) {\n          cata(selections.get(), noop, multiCellContext, noop);\n        }\n      });\n      editor.on('BeforeSetContent', function (e) {\n        if (e.selection === true && e.paste === true) {\n          var cellOpt = Optional.from(editor.dom.getParent(editor.selection.getStart(), 'th,td'));\n          cellOpt.each(function (domCell) {\n            var cell = SugarElement.fromDom(domCell);\n            table(cell).each(function (table) {\n              var elements = filter(fromHtml$1(e.content), function (content) {\n                return name(content) !== 'meta';\n              });\n              var isTable = function (elm) {\n                return name(elm) === 'table';\n              };\n              if (elements.length === 1 && isTable(elements[0])) {\n                e.preventDefault();\n                var doc = SugarElement.fromDom(editor.getDoc());\n                var generators = paste(doc);\n                var targets = paste$1(cell, elements[0], generators);\n                actions.pasteCells(table, targets).each(function (data) {\n                  editor.selection.setRng(data.rng);\n                  editor.focus();\n                  cellSelection.clear(table);\n                });\n              }\n            });\n          });\n        }\n      });\n    };\n\n    var adt = Adt.generate([\n      { none: [] },\n      { only: ['index'] },\n      {\n        left: [\n          'index',\n          'next'\n        ]\n      },\n      {\n        middle: [\n          'prev',\n          'index',\n          'next'\n        ]\n      },\n      {\n        right: [\n          'prev',\n          'index'\n        ]\n      }\n    ]);\n    var ColumnContext = __assign({}, adt);\n\n    var neighbours = function (input, index) {\n      if (input.length === 0) {\n        return ColumnContext.none();\n      }\n      if (input.length === 1) {\n        return ColumnContext.only(0);\n      }\n      if (index === 0) {\n        return ColumnContext.left(0, 1);\n      }\n      if (index === input.length - 1) {\n        return ColumnContext.right(index - 1, index);\n      }\n      if (index > 0 && index < input.length - 1) {\n        return ColumnContext.middle(index - 1, index, index + 1);\n      }\n      return ColumnContext.none();\n    };\n    var determine = function (input, column, step, tableSize, resize) {\n      var result = input.slice(0);\n      var context = neighbours(input, column);\n      var onNone = constant(map(result, constant(0)));\n      var onOnly = function (index) {\n        return tableSize.singleColumnWidth(result[index], step);\n      };\n      var onLeft = function (index, next) {\n        return resize.calcLeftEdgeDeltas(result, index, next, step, tableSize.minCellWidth(), tableSize.isRelative);\n      };\n      var onMiddle = function (prev, index, next) {\n        return resize.calcMiddleDeltas(result, prev, index, next, step, tableSize.minCellWidth(), tableSize.isRelative);\n      };\n      var onRight = function (prev, index) {\n        return resize.calcRightEdgeDeltas(result, prev, index, step, tableSize.minCellWidth(), tableSize.isRelative);\n      };\n      return context.fold(onNone, onOnly, onLeft, onMiddle, onRight);\n    };\n\n    var total = function (start, end, measures) {\n      var r = 0;\n      for (var i = start; i < end; i++) {\n        r += measures[i] !== undefined ? measures[i] : 0;\n      }\n      return r;\n    };\n    var recalculateWidthForCells = function (warehouse, widths) {\n      var all = Warehouse.justCells(warehouse);\n      return map(all, function (cell) {\n        var width = total(cell.column, cell.column + cell.colspan, widths);\n        return {\n          element: cell.element,\n          width: width,\n          colspan: cell.colspan\n        };\n      });\n    };\n    var recalculateWidthForColumns = function (warehouse, widths) {\n      var groups = Warehouse.justColumns(warehouse);\n      return map(groups, function (column, index) {\n        return {\n          element: column.element,\n          width: widths[index],\n          colspan: column.colspan\n        };\n      });\n    };\n    var recalculateHeightForCells = function (warehouse, heights) {\n      var all = Warehouse.justCells(warehouse);\n      return map(all, function (cell) {\n        var height = total(cell.row, cell.row + cell.rowspan, heights);\n        return {\n          element: cell.element,\n          height: height,\n          rowspan: cell.rowspan\n        };\n      });\n    };\n    var matchRowHeight = function (warehouse, heights) {\n      return map(warehouse.all, function (row, i) {\n        return {\n          element: row.element,\n          height: heights[i]\n        };\n      });\n    };\n\n    var sumUp = function (newSize) {\n      return foldr(newSize, function (b, a) {\n        return b + a;\n      }, 0);\n    };\n    var recalculate = function (warehouse, widths) {\n      if (Warehouse.hasColumns(warehouse)) {\n        return recalculateWidthForColumns(warehouse, widths);\n      } else {\n        return recalculateWidthForCells(warehouse, widths);\n      }\n    };\n    var recalculateAndApply = function (warehouse, widths, tableSize) {\n      var newSizes = recalculate(warehouse, widths);\n      each(newSizes, function (cell) {\n        tableSize.setElementWidth(cell.element, cell.width);\n      });\n    };\n    var adjustWidth = function (table, delta, index, resizing, tableSize) {\n      var warehouse = Warehouse.fromTable(table);\n      var step = tableSize.getCellDelta(delta);\n      var widths = tableSize.getWidths(warehouse, tableSize);\n      var isLastColumn = index === warehouse.grid.columns - 1;\n      var clampedStep = resizing.clampTableDelta(widths, index, step, tableSize.minCellWidth(), isLastColumn);\n      var deltas = determine(widths, index, clampedStep, tableSize, resizing);\n      var newWidths = map(deltas, function (dx, i) {\n        return dx + widths[i];\n      });\n      recalculateAndApply(warehouse, newWidths, tableSize);\n      resizing.resizeTable(tableSize.adjustTableWidth, clampedStep, isLastColumn);\n    };\n    var adjustHeight = function (table, delta, index, direction) {\n      var warehouse = Warehouse.fromTable(table);\n      var heights = getPixelHeights(warehouse, table, direction);\n      var newHeights = map(heights, function (dy, i) {\n        return index === i ? Math.max(delta + dy, minHeight()) : dy;\n      });\n      var newCellSizes = recalculateHeightForCells(warehouse, newHeights);\n      var newRowSizes = matchRowHeight(warehouse, newHeights);\n      each(newRowSizes, function (row) {\n        setHeight(row.element, row.height);\n      });\n      each(newCellSizes, function (cell) {\n        setHeight(cell.element, cell.height);\n      });\n      var total = sumUp(newHeights);\n      setHeight(table, total);\n    };\n    var adjustAndRedistributeWidths = function (_table, list, details, tableSize, resizeBehaviour) {\n      var warehouse = Warehouse.generate(list);\n      var sizes = tableSize.getWidths(warehouse, tableSize);\n      var tablePixelWidth = tableSize.pixelWidth();\n      var _a = resizeBehaviour.calcRedestributedWidths(sizes, tablePixelWidth, details.pixelDelta, tableSize.isRelative), newSizes = _a.newSizes, delta = _a.delta;\n      recalculateAndApply(warehouse, newSizes, tableSize);\n      tableSize.adjustTableWidth(delta);\n    };\n    var adjustWidthTo = function (_table, list, _info, tableSize) {\n      var warehouse = Warehouse.generate(list);\n      var widths = tableSize.getWidths(warehouse, tableSize);\n      recalculateAndApply(warehouse, widths, tableSize);\n    };\n\n    var zero = function (array) {\n      return map(array, constant(0));\n    };\n    var surround = function (sizes, startIndex, endIndex, results, f) {\n      return f(sizes.slice(0, startIndex)).concat(results).concat(f(sizes.slice(endIndex)));\n    };\n    var clampDeltaHelper = function (predicate) {\n      return function (sizes, index, delta, minCellSize) {\n        if (!predicate(delta)) {\n          return delta;\n        } else {\n          var newSize = Math.max(minCellSize, sizes[index] - Math.abs(delta));\n          var diff = Math.abs(newSize - sizes[index]);\n          return delta >= 0 ? diff : -diff;\n        }\n      };\n    };\n    var clampNegativeDelta = clampDeltaHelper(function (delta) {\n      return delta < 0;\n    });\n    var clampDelta = clampDeltaHelper(always);\n    var resizeTable = function () {\n      var calcFixedDeltas = function (sizes, index, next, delta, minCellSize) {\n        var clampedDelta = clampNegativeDelta(sizes, index, delta, minCellSize);\n        return surround(sizes, index, next + 1, [\n          clampedDelta,\n          0\n        ], zero);\n      };\n      var calcRelativeDeltas = function (sizes, index, delta, minCellSize) {\n        var ratio = (100 + delta) / 100;\n        var newThis = Math.max(minCellSize, (sizes[index] + delta) / ratio);\n        return map(sizes, function (size, idx) {\n          var newSize = idx === index ? newThis : size / ratio;\n          return newSize - size;\n        });\n      };\n      var calcLeftEdgeDeltas = function (sizes, index, next, delta, minCellSize, isRelative) {\n        if (isRelative) {\n          return calcRelativeDeltas(sizes, index, delta, minCellSize);\n        } else {\n          return calcFixedDeltas(sizes, index, next, delta, minCellSize);\n        }\n      };\n      var calcMiddleDeltas = function (sizes, _prev, index, next, delta, minCellSize, isRelative) {\n        return calcLeftEdgeDeltas(sizes, index, next, delta, minCellSize, isRelative);\n      };\n      var resizeTable = function (resizer, delta) {\n        return resizer(delta);\n      };\n      var calcRightEdgeDeltas = function (sizes, _prev, index, delta, minCellSize, isRelative) {\n        if (isRelative) {\n          return calcRelativeDeltas(sizes, index, delta, minCellSize);\n        } else {\n          var clampedDelta = clampNegativeDelta(sizes, index, delta, minCellSize);\n          return zero(sizes.slice(0, index)).concat([clampedDelta]);\n        }\n      };\n      var calcRedestributedWidths = function (sizes, totalWidth, pixelDelta, isRelative) {\n        if (isRelative) {\n          var tableWidth = totalWidth + pixelDelta;\n          var ratio_1 = tableWidth / totalWidth;\n          var newSizes = map(sizes, function (size) {\n            return size / ratio_1;\n          });\n          return {\n            delta: ratio_1 * 100 - 100,\n            newSizes: newSizes\n          };\n        } else {\n          return {\n            delta: pixelDelta,\n            newSizes: sizes\n          };\n        }\n      };\n      return {\n        resizeTable: resizeTable,\n        clampTableDelta: clampNegativeDelta,\n        calcLeftEdgeDeltas: calcLeftEdgeDeltas,\n        calcMiddleDeltas: calcMiddleDeltas,\n        calcRightEdgeDeltas: calcRightEdgeDeltas,\n        calcRedestributedWidths: calcRedestributedWidths\n      };\n    };\n    var preserveTable = function () {\n      var calcLeftEdgeDeltas = function (sizes, index, next, delta, minCellSize) {\n        var idx = delta >= 0 ? next : index;\n        var clampedDelta = clampDelta(sizes, idx, delta, minCellSize);\n        return surround(sizes, index, next + 1, [\n          clampedDelta,\n          -clampedDelta\n        ], zero);\n      };\n      var calcMiddleDeltas = function (sizes, _prev, index, next, delta, minCellSize) {\n        return calcLeftEdgeDeltas(sizes, index, next, delta, minCellSize);\n      };\n      var resizeTable = function (resizer, delta, isLastColumn) {\n        if (isLastColumn) {\n          resizer(delta);\n        }\n      };\n      var calcRightEdgeDeltas = function (sizes, _prev, _index, delta, _minCellSize, isRelative) {\n        if (isRelative) {\n          return zero(sizes);\n        } else {\n          var diff = delta / sizes.length;\n          return map(sizes, constant(diff));\n        }\n      };\n      var clampTableDelta = function (sizes, index, delta, minCellSize, isLastColumn) {\n        if (isLastColumn) {\n          if (delta >= 0) {\n            return delta;\n          } else {\n            var maxDelta = foldl(sizes, function (a, b) {\n              return a + b - minCellSize;\n            }, 0);\n            return Math.max(-maxDelta, delta);\n          }\n        } else {\n          return clampNegativeDelta(sizes, index, delta, minCellSize);\n        }\n      };\n      var calcRedestributedWidths = function (sizes, _totalWidth, _pixelDelta, _isRelative) {\n        return {\n          delta: 0,\n          newSizes: sizes\n        };\n      };\n      return {\n        resizeTable: resizeTable,\n        clampTableDelta: clampTableDelta,\n        calcLeftEdgeDeltas: calcLeftEdgeDeltas,\n        calcMiddleDeltas: calcMiddleDeltas,\n        calcRightEdgeDeltas: calcRightEdgeDeltas,\n        calcRedestributedWidths: calcRedestributedWidths\n      };\n    };\n\n    var only = function (element, isResizable) {\n      var parent = Optional.from(element.dom.documentElement).map(SugarElement.fromDom).getOr(element);\n      return {\n        parent: constant(parent),\n        view: constant(element),\n        origin: constant(SugarPosition(0, 0)),\n        isResizable: isResizable\n      };\n    };\n    var detached = function (editable, chrome, isResizable) {\n      var origin = function () {\n        return absolute(chrome);\n      };\n      return {\n        parent: constant(chrome),\n        view: constant(editable),\n        origin: origin,\n        isResizable: isResizable\n      };\n    };\n    var body$1 = function (editable, chrome, isResizable) {\n      return {\n        parent: constant(chrome),\n        view: constant(editable),\n        origin: constant(SugarPosition(0, 0)),\n        isResizable: isResizable\n      };\n    };\n    var ResizeWire = {\n      only: only,\n      detached: detached,\n      body: body$1\n    };\n\n    var adt$1 = Adt.generate([\n      { invalid: ['raw'] },\n      { pixels: ['value'] },\n      { percent: ['value'] }\n    ]);\n    var validateFor = function (suffix, type, value) {\n      var rawAmount = value.substring(0, value.length - suffix.length);\n      var amount = parseFloat(rawAmount);\n      return rawAmount === amount.toString() ? type(amount) : adt$1.invalid(value);\n    };\n    var from$1 = function (value) {\n      if (endsWith(value, '%')) {\n        return validateFor('%', adt$1.percent, value);\n      }\n      if (endsWith(value, 'px')) {\n        return validateFor('px', adt$1.pixels, value);\n      }\n      return adt$1.invalid(value);\n    };\n    var Size = __assign(__assign({}, adt$1), { from: from$1 });\n\n    var redistributeToPercent = function (widths, totalWidth) {\n      return map(widths, function (w) {\n        var colType = Size.from(w);\n        return colType.fold(function () {\n          return w;\n        }, function (px) {\n          var ratio = px / totalWidth * 100;\n          return ratio + '%';\n        }, function (pc) {\n          return pc + '%';\n        });\n      });\n    };\n    var redistributeToPx = function (widths, totalWidth, newTotalWidth) {\n      var scale = newTotalWidth / totalWidth;\n      return map(widths, function (w) {\n        var colType = Size.from(w);\n        return colType.fold(function () {\n          return w;\n        }, function (px) {\n          return px * scale + 'px';\n        }, function (pc) {\n          return pc / 100 * newTotalWidth + 'px';\n        });\n      });\n    };\n    var redistributeEmpty = function (newWidthType, columns) {\n      var f = newWidthType.fold(function () {\n        return constant('');\n      }, function (pixels) {\n        var num = pixels / columns;\n        return constant(num + 'px');\n      }, function () {\n        var num = 100 / columns;\n        return constant(num + '%');\n      });\n      return range(columns, f);\n    };\n    var redistributeValues = function (newWidthType, widths, totalWidth) {\n      return newWidthType.fold(function () {\n        return widths;\n      }, function (px) {\n        return redistributeToPx(widths, totalWidth, px);\n      }, function (_pc) {\n        return redistributeToPercent(widths, totalWidth);\n      });\n    };\n    var redistribute = function (widths, totalWidth, newWidth) {\n      var newType = Size.from(newWidth);\n      var floats = forall(widths, function (s) {\n        return s === '0px';\n      }) ? redistributeEmpty(newType, widths.length) : redistributeValues(newType, widths, totalWidth);\n      return normalize(floats);\n    };\n    var sum = function (values, fallback) {\n      if (values.length === 0) {\n        return fallback;\n      }\n      return foldr(values, function (rest, v) {\n        return Size.from(v).fold(constant(0), identity, identity) + rest;\n      }, 0);\n    };\n    var roundDown = function (num, unit) {\n      var floored = Math.floor(num);\n      return {\n        value: floored + unit,\n        remainder: num - floored\n      };\n    };\n    var add = function (value, amount) {\n      return Size.from(value).fold(constant(value), function (px) {\n        return px + amount + 'px';\n      }, function (pc) {\n        return pc + amount + '%';\n      });\n    };\n    var normalize = function (values) {\n      if (values.length === 0) {\n        return values;\n      }\n      var scan = foldr(values, function (rest, value) {\n        var info = Size.from(value).fold(function () {\n          return {\n            value: value,\n            remainder: 0\n          };\n        }, function (num) {\n          return roundDown(num, 'px');\n        }, function (num) {\n          return {\n            value: num + '%',\n            remainder: 0\n          };\n        });\n        return {\n          output: [info.value].concat(rest.output),\n          remainder: rest.remainder + info.remainder\n        };\n      }, {\n        output: [],\n        remainder: 0\n      });\n      var r = scan.output;\n      return r.slice(0, r.length - 1).concat([add(r[r.length - 1], Math.round(scan.remainder))]);\n    };\n    var validate = Size.from;\n\n    var redistributeToW = function (newWidths, cells, unit) {\n      each(cells, function (cell) {\n        var widths = newWidths.slice(cell.column, cell.colspan + cell.column);\n        var w = sum(widths, minWidth());\n        set$1(cell.element, 'width', w + unit);\n      });\n    };\n    var redistributeToColumns = function (newWidths, columns, unit) {\n      each(columns, function (column, index) {\n        var width = sum([newWidths[index]], minWidth());\n        set$1(column.element, 'width', width + unit);\n      });\n    };\n    var redistributeToH = function (newHeights, rows, cells, unit) {\n      each(cells, function (cell) {\n        var heights = newHeights.slice(cell.row, cell.rowspan + cell.row);\n        var h = sum(heights, minHeight());\n        set$1(cell.element, 'height', h + unit);\n      });\n      each(rows, function (row, i) {\n        set$1(row.element, 'height', newHeights[i]);\n      });\n    };\n    var getUnit = function (newSize) {\n      return validate(newSize).fold(constant('px'), constant('px'), constant('%'));\n    };\n    var redistribute$1 = function (table, optWidth, optHeight, tableSize) {\n      var warehouse = Warehouse.fromTable(table);\n      var rows = warehouse.all;\n      var cells = Warehouse.justCells(warehouse);\n      var columns = Warehouse.justColumns(warehouse);\n      optWidth.each(function (newWidth) {\n        var widthUnit = getUnit(newWidth);\n        var totalWidth = get$5(table);\n        var oldWidths = getRawWidths(warehouse, table, tableSize);\n        var nuWidths = redistribute(oldWidths, totalWidth, newWidth);\n        if (Warehouse.hasColumns(warehouse)) {\n          redistributeToColumns(nuWidths, columns, widthUnit);\n        } else {\n          redistributeToW(nuWidths, cells, widthUnit);\n        }\n        set$1(table, 'width', newWidth);\n      });\n      optHeight.each(function (newHeight) {\n        var hUnit = getUnit(newHeight);\n        var totalHeight = get$6(table);\n        var oldHeights = getRawHeights(warehouse, table, height);\n        var nuHeights = redistribute(oldHeights, totalHeight, newHeight);\n        redistributeToH(nuHeights, rows, cells, hUnit);\n        set$1(table, 'height', newHeight);\n      });\n    };\n    var isPercentSizing$1 = isPercentSizing;\n    var isPixelSizing$1 = isPixelSizing;\n    var isNoneSizing$1 = isNoneSizing;\n    var getPercentTableWidth$1 = getPercentTableWidth;\n\n    var getGridSize = function (table) {\n      var warehouse = Warehouse.fromTable(table);\n      return warehouse.grid;\n    };\n\n    var Event = function (fields) {\n      var handlers = [];\n      var bind = function (handler) {\n        if (handler === undefined) {\n          throw new Error('Event bind error: undefined handler');\n        }\n        handlers.push(handler);\n      };\n      var unbind = function (handler) {\n        handlers = filter(handlers, function (h) {\n          return h !== handler;\n        });\n      };\n      var trigger = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        var event = {};\n        each(fields, function (name, i) {\n          event[name] = args[i];\n        });\n        each(handlers, function (handler) {\n          handler(event);\n        });\n      };\n      return {\n        bind: bind,\n        unbind: unbind,\n        trigger: trigger\n      };\n    };\n\n    var create = function (typeDefs) {\n      var registry = map$1(typeDefs, function (event) {\n        return {\n          bind: event.bind,\n          unbind: event.unbind\n        };\n      });\n      var trigger = map$1(typeDefs, function (event) {\n        return event.trigger;\n      });\n      return {\n        registry: registry,\n        trigger: trigger\n      };\n    };\n\n    var last$2 = function (fn, rate) {\n      var timer = null;\n      var cancel = function () {\n        if (timer !== null) {\n          clearTimeout(timer);\n          timer = null;\n        }\n      };\n      var throttle = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (timer !== null) {\n          clearTimeout(timer);\n        }\n        timer = setTimeout(function () {\n          fn.apply(null, args);\n          timer = null;\n        }, rate);\n      };\n      return {\n        cancel: cancel,\n        throttle: throttle\n      };\n    };\n\n    var sort$1 = function (arr) {\n      return arr.slice(0).sort();\n    };\n    var reqMessage = function (required, keys) {\n      throw new Error('All required keys (' + sort$1(required).join(', ') + ') were not specified. Specified keys were: ' + sort$1(keys).join(', ') + '.');\n    };\n    var unsuppMessage = function (unsupported) {\n      throw new Error('Unsupported keys for object: ' + sort$1(unsupported).join(', '));\n    };\n    var validateStrArr = function (label, array) {\n      if (!isArray(array)) {\n        throw new Error('The ' + label + ' fields must be an array. Was: ' + array + '.');\n      }\n      each(array, function (a) {\n        if (!isString(a)) {\n          throw new Error('The value ' + a + ' in the ' + label + ' fields was not a string.');\n        }\n      });\n    };\n    var invalidTypeMessage = function (incorrect, type) {\n      throw new Error('All values need to be of type: ' + type + '. Keys (' + sort$1(incorrect).join(', ') + ') were not.');\n    };\n    var checkDupes = function (everything) {\n      var sorted = sort$1(everything);\n      var dupe = find(sorted, function (s, i) {\n        return i < sorted.length - 1 && s === sorted[i + 1];\n      });\n      dupe.each(function (d) {\n        throw new Error('The field: ' + d + ' occurs more than once in the combined fields: [' + sorted.join(', ') + '].');\n      });\n    };\n\n    var base = function (handleUnsupported, required) {\n      return baseWith(handleUnsupported, required, {\n        validate: isFunction,\n        label: 'function'\n      });\n    };\n    var baseWith = function (handleUnsupported, required, pred) {\n      if (required.length === 0) {\n        throw new Error('You must specify at least one required field.');\n      }\n      validateStrArr('required', required);\n      checkDupes(required);\n      return function (obj) {\n        var keys$1 = keys(obj);\n        var allReqd = forall(required, function (req) {\n          return contains(keys$1, req);\n        });\n        if (!allReqd) {\n          reqMessage(required, keys$1);\n        }\n        handleUnsupported(required, keys$1);\n        var invalidKeys = filter(required, function (key) {\n          return !pred.validate(obj[key], key);\n        });\n        if (invalidKeys.length > 0) {\n          invalidTypeMessage(invalidKeys, pred.label);\n        }\n        return obj;\n      };\n    };\n    var handleExact = function (required, keys) {\n      var unsupported = filter(keys, function (key) {\n        return !contains(required, key);\n      });\n      if (unsupported.length > 0) {\n        unsuppMessage(unsupported);\n      }\n    };\n    var exactly = function (required) {\n      return base(handleExact, required);\n    };\n\n    var DragMode = exactly([\n      'compare',\n      'extract',\n      'mutate',\n      'sink'\n    ]);\n    var DragSink = exactly([\n      'element',\n      'start',\n      'stop',\n      'destroy'\n    ]);\n    var DragApi = exactly([\n      'forceDrop',\n      'drop',\n      'move',\n      'delayDrop'\n    ]);\n\n    var InDrag = function () {\n      var previous = Optional.none();\n      var reset = function () {\n        previous = Optional.none();\n      };\n      var update = function (mode, nu) {\n        var result = previous.map(function (old) {\n          return mode.compare(old, nu);\n        });\n        previous = Optional.some(nu);\n        return result;\n      };\n      var onEvent = function (event, mode) {\n        var dataOption = mode.extract(event);\n        dataOption.each(function (data) {\n          var offset = update(mode, data);\n          offset.each(function (d) {\n            events.trigger.move(d);\n          });\n        });\n      };\n      var events = create({ move: Event(['info']) });\n      return {\n        onEvent: onEvent,\n        reset: reset,\n        events: events.registry\n      };\n    };\n\n    var NoDrag = function () {\n      var events = create({ move: Event(['info']) });\n      return {\n        onEvent: noop,\n        reset: noop,\n        events: events.registry\n      };\n    };\n\n    var Movement = function () {\n      var noDragState = NoDrag();\n      var inDragState = InDrag();\n      var dragState = noDragState;\n      var on = function () {\n        dragState.reset();\n        dragState = inDragState;\n      };\n      var off = function () {\n        dragState.reset();\n        dragState = noDragState;\n      };\n      var onEvent = function (event, mode) {\n        dragState.onEvent(event, mode);\n      };\n      var isOn = function () {\n        return dragState === inDragState;\n      };\n      return {\n        on: on,\n        off: off,\n        isOn: isOn,\n        onEvent: onEvent,\n        events: inDragState.events\n      };\n    };\n\n    var setup = function (mutation, mode, settings) {\n      var active = false;\n      var events = create({\n        start: Event([]),\n        stop: Event([])\n      });\n      var movement = Movement();\n      var drop = function () {\n        sink.stop();\n        if (movement.isOn()) {\n          movement.off();\n          events.trigger.stop();\n        }\n      };\n      var throttledDrop = last$2(drop, 200);\n      var go = function (parent) {\n        sink.start(parent);\n        movement.on();\n        events.trigger.start();\n      };\n      var mousemove = function (event) {\n        throttledDrop.cancel();\n        movement.onEvent(event, mode);\n      };\n      movement.events.move.bind(function (event) {\n        mode.mutate(mutation, event.info);\n      });\n      var on = function () {\n        active = true;\n      };\n      var off = function () {\n        active = false;\n      };\n      var runIfActive = function (f) {\n        return function () {\n          var args = [];\n          for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n          }\n          if (active) {\n            f.apply(null, args);\n          }\n        };\n      };\n      var sink = mode.sink(DragApi({\n        forceDrop: drop,\n        drop: runIfActive(drop),\n        move: runIfActive(mousemove),\n        delayDrop: runIfActive(throttledDrop.throttle)\n      }), settings);\n      var destroy = function () {\n        sink.destroy();\n      };\n      return {\n        element: sink.element,\n        go: go,\n        on: on,\n        off: off,\n        destroy: destroy,\n        events: events.registry\n      };\n    };\n\n    var mkEvent = function (target, x, y, stop, prevent, kill, raw) {\n      return {\n        target: target,\n        x: x,\n        y: y,\n        stop: stop,\n        prevent: prevent,\n        kill: kill,\n        raw: raw\n      };\n    };\n    var fromRawEvent = function (rawEvent) {\n      var target = SugarElement.fromDom(getOriginalEventTarget(rawEvent).getOr(rawEvent.target));\n      var stop = function () {\n        return rawEvent.stopPropagation();\n      };\n      var prevent = function () {\n        return rawEvent.preventDefault();\n      };\n      var kill = compose(prevent, stop);\n      return mkEvent(target, rawEvent.clientX, rawEvent.clientY, stop, prevent, kill, rawEvent);\n    };\n    var handle = function (filter, handler) {\n      return function (rawEvent) {\n        if (filter(rawEvent)) {\n          handler(fromRawEvent(rawEvent));\n        }\n      };\n    };\n    var binder = function (element, event, filter, handler, useCapture) {\n      var wrapped = handle(filter, handler);\n      element.dom.addEventListener(event, wrapped, useCapture);\n      return { unbind: curry(unbind, element, event, wrapped, useCapture) };\n    };\n    var bind$1 = function (element, event, filter, handler) {\n      return binder(element, event, filter, handler, false);\n    };\n    var unbind = function (element, event, handler, useCapture) {\n      element.dom.removeEventListener(event, handler, useCapture);\n    };\n\n    var filter$2 = always;\n    var bind$2 = function (element, event, handler) {\n      return bind$1(element, event, filter$2, handler);\n    };\n    var fromRawEvent$1 = fromRawEvent;\n\n    var read = function (element, attr) {\n      var value = get$2(element, attr);\n      return value === undefined || value === '' ? [] : value.split(' ');\n    };\n    var add$1 = function (element, attr, id) {\n      var old = read(element, attr);\n      var nu = old.concat([id]);\n      set(element, attr, nu.join(' '));\n      return true;\n    };\n    var remove$3 = function (element, attr, id) {\n      var nu = filter(read(element, attr), function (v) {\n        return v !== id;\n      });\n      if (nu.length > 0) {\n        set(element, attr, nu.join(' '));\n      } else {\n        remove(element, attr);\n      }\n      return false;\n    };\n\n    var supports = function (element) {\n      return element.dom.classList !== undefined;\n    };\n    var get$8 = function (element) {\n      return read(element, 'class');\n    };\n    var add$2 = function (element, clazz) {\n      return add$1(element, 'class', clazz);\n    };\n    var remove$4 = function (element, clazz) {\n      return remove$3(element, 'class', clazz);\n    };\n\n    var add$3 = function (element, clazz) {\n      if (supports(element)) {\n        element.dom.classList.add(clazz);\n      } else {\n        add$2(element, clazz);\n      }\n    };\n    var cleanClass = function (element) {\n      var classList = supports(element) ? element.dom.classList : get$8(element);\n      if (classList.length === 0) {\n        remove(element, 'class');\n      }\n    };\n    var remove$5 = function (element, clazz) {\n      if (supports(element)) {\n        var classList = element.dom.classList;\n        classList.remove(clazz);\n      } else {\n        remove$4(element, clazz);\n      }\n      cleanClass(element);\n    };\n    var has$1 = function (element, clazz) {\n      return supports(element) && element.dom.classList.contains(clazz);\n    };\n\n    var css = function (namespace) {\n      var dashNamespace = namespace.replace(/\\./g, '-');\n      var resolve = function (str) {\n        return dashNamespace + '-' + str;\n      };\n      return { resolve: resolve };\n    };\n\n    var styles = css('ephox-dragster');\n    var resolve = styles.resolve;\n\n    var Blocker = function (options) {\n      var settings = __assign({ layerClass: resolve('blocker') }, options);\n      var div = SugarElement.fromTag('div');\n      set(div, 'role', 'presentation');\n      setAll$1(div, {\n        position: 'fixed',\n        left: '0px',\n        top: '0px',\n        width: '100%',\n        height: '100%'\n      });\n      add$3(div, resolve('blocker'));\n      add$3(div, settings.layerClass);\n      var element = function () {\n        return div;\n      };\n      var destroy = function () {\n        remove$2(div);\n      };\n      return {\n        element: element,\n        destroy: destroy\n      };\n    };\n\n    var compare = function (old, nu) {\n      return SugarPosition(nu.left - old.left, nu.top - old.top);\n    };\n    var extract$1 = function (event) {\n      return Optional.some(SugarPosition(event.x, event.y));\n    };\n    var mutate = function (mutation, info) {\n      mutation.mutate(info.left, info.top);\n    };\n    var sink = function (dragApi, settings) {\n      var blocker = Blocker(settings);\n      var mdown = bind$2(blocker.element(), 'mousedown', dragApi.forceDrop);\n      var mup = bind$2(blocker.element(), 'mouseup', dragApi.drop);\n      var mmove = bind$2(blocker.element(), 'mousemove', dragApi.move);\n      var mout = bind$2(blocker.element(), 'mouseout', dragApi.delayDrop);\n      var destroy = function () {\n        blocker.destroy();\n        mup.unbind();\n        mmove.unbind();\n        mout.unbind();\n        mdown.unbind();\n      };\n      var start = function (parent) {\n        append(parent, blocker.element());\n      };\n      var stop = function () {\n        remove$2(blocker.element());\n      };\n      return DragSink({\n        element: blocker.element,\n        start: start,\n        stop: stop,\n        destroy: destroy\n      });\n    };\n    var MouseDrag = DragMode({\n      compare: compare,\n      extract: extract$1,\n      sink: sink,\n      mutate: mutate\n    });\n\n    var transform = function (mutation, settings) {\n      if (settings === void 0) {\n        settings = {};\n      }\n      var mode = settings.mode !== undefined ? settings.mode : MouseDrag;\n      return setup(mutation, mode, settings);\n    };\n\n    var isContentEditableTrue = function (elm) {\n      return get$2(elm, 'contenteditable') === 'true';\n    };\n    var findClosestContentEditable = function (target, isRoot) {\n      return closest$1(target, '[contenteditable]', isRoot);\n    };\n\n    var styles$1 = css('ephox-snooker');\n    var resolve$1 = styles$1.resolve;\n\n    var Mutation = function () {\n      var events = create({\n        drag: Event([\n          'xDelta',\n          'yDelta'\n        ])\n      });\n      var mutate = function (x, y) {\n        events.trigger.drag(x, y);\n      };\n      return {\n        mutate: mutate,\n        events: events.registry\n      };\n    };\n\n    var BarMutation = function () {\n      var events = create({\n        drag: Event([\n          'xDelta',\n          'yDelta',\n          'target'\n        ])\n      });\n      var target = Optional.none();\n      var delegate = Mutation();\n      delegate.events.drag.bind(function (event) {\n        target.each(function (t) {\n          events.trigger.drag(event.xDelta, event.yDelta, t);\n        });\n      });\n      var assign = function (t) {\n        target = Optional.some(t);\n      };\n      var get = function () {\n        return target;\n      };\n      return {\n        assign: assign,\n        get: get,\n        mutate: delegate.mutate,\n        events: events.registry\n      };\n    };\n\n    var col = function (column, x, y, w, h) {\n      var bar = SugarElement.fromTag('div');\n      setAll$1(bar, {\n        position: 'absolute',\n        left: x - w / 2 + 'px',\n        top: y + 'px',\n        height: h + 'px',\n        width: w + 'px'\n      });\n      setAll(bar, {\n        'data-column': column,\n        'role': 'presentation'\n      });\n      return bar;\n    };\n    var row = function (r, x, y, w, h) {\n      var bar = SugarElement.fromTag('div');\n      setAll$1(bar, {\n        position: 'absolute',\n        left: x + 'px',\n        top: y - h / 2 + 'px',\n        height: h + 'px',\n        width: w + 'px'\n      });\n      setAll(bar, {\n        'data-row': r,\n        'role': 'presentation'\n      });\n      return bar;\n    };\n\n    var resizeBar = resolve$1('resizer-bar');\n    var resizeRowBar = resolve$1('resizer-rows');\n    var resizeColBar = resolve$1('resizer-cols');\n    var BAR_THICKNESS = 7;\n    var resizableRows = function (warehouse, isResizable) {\n      return bind(warehouse.all, function (row, i) {\n        return isResizable(row.element) ? [i] : [];\n      });\n    };\n    var resizableColumns = function (warehouse, isResizable) {\n      var resizableCols = [];\n      range(warehouse.grid.columns, function (index) {\n        var colElmOpt = Warehouse.getColumnAt(warehouse, index).map(function (col) {\n          return col.element;\n        });\n        if (colElmOpt.forall(isResizable)) {\n          resizableCols.push(index);\n        }\n      });\n      return filter(resizableCols, function (colIndex) {\n        var columnCells = Warehouse.filterItems(warehouse, function (cell) {\n          return cell.column === colIndex;\n        });\n        return forall(columnCells, function (cell) {\n          return isResizable(cell.element);\n        });\n      });\n    };\n    var destroy = function (wire) {\n      var previous = descendants$1(wire.parent(), '.' + resizeBar);\n      each(previous, remove$2);\n    };\n    var drawBar = function (wire, positions, create) {\n      var origin = wire.origin();\n      each(positions, function (cpOption) {\n        cpOption.each(function (cp) {\n          var bar = create(origin, cp);\n          add$3(bar, resizeBar);\n          append(wire.parent(), bar);\n        });\n      });\n    };\n    var refreshCol = function (wire, colPositions, position, tableHeight) {\n      drawBar(wire, colPositions, function (origin, cp) {\n        var colBar = col(cp.col, cp.x - origin.left, position.top - origin.top, BAR_THICKNESS, tableHeight);\n        add$3(colBar, resizeColBar);\n        return colBar;\n      });\n    };\n    var refreshRow = function (wire, rowPositions, position, tableWidth) {\n      drawBar(wire, rowPositions, function (origin, cp) {\n        var rowBar = row(cp.row, position.left - origin.left, cp.y - origin.top, tableWidth, BAR_THICKNESS);\n        add$3(rowBar, resizeRowBar);\n        return rowBar;\n      });\n    };\n    var refreshGrid = function (warhouse, wire, table, rows, cols) {\n      var position = absolute(table);\n      var isResizable = wire.isResizable;\n      var rowPositions = rows.length > 0 ? height.positions(rows, table) : [];\n      var resizableRowBars = rowPositions.length > 0 ? resizableRows(warhouse, isResizable) : [];\n      var resizableRowPositions = filter(rowPositions, function (_pos, i) {\n        return exists(resizableRowBars, function (barIndex) {\n          return i === barIndex;\n        });\n      });\n      refreshRow(wire, resizableRowPositions, position, getOuter(table));\n      var colPositions = cols.length > 0 ? width.positions(cols, table) : [];\n      var resizableColBars = colPositions.length > 0 ? resizableColumns(warhouse, isResizable) : [];\n      var resizableColPositions = filter(colPositions, function (_pos, i) {\n        return exists(resizableColBars, function (barIndex) {\n          return i === barIndex;\n        });\n      });\n      refreshCol(wire, resizableColPositions, position, getOuter$1(table));\n    };\n    var refresh = function (wire, table) {\n      destroy(wire);\n      if (wire.isResizable(table)) {\n        var warehouse = Warehouse.fromTable(table);\n        var rows = rows$1(warehouse);\n        var cols = columns$1(warehouse);\n        refreshGrid(warehouse, wire, table, rows, cols);\n      }\n    };\n    var each$2 = function (wire, f) {\n      var bars = descendants$1(wire.parent(), '.' + resizeBar);\n      each(bars, f);\n    };\n    var hide = function (wire) {\n      each$2(wire, function (bar) {\n        set$1(bar, 'display', 'none');\n      });\n    };\n    var show = function (wire) {\n      each$2(wire, function (bar) {\n        set$1(bar, 'display', 'block');\n      });\n    };\n    var isRowBar = function (element) {\n      return has$1(element, resizeRowBar);\n    };\n    var isColBar = function (element) {\n      return has$1(element, resizeColBar);\n    };\n\n    var resizeBarDragging = resolve$1('resizer-bar-dragging');\n    var BarManager = function (wire) {\n      var mutation = BarMutation();\n      var resizing = transform(mutation, {});\n      var hoverTable = Optional.none();\n      var getResizer = function (element, type) {\n        return Optional.from(get$2(element, type));\n      };\n      mutation.events.drag.bind(function (event) {\n        getResizer(event.target, 'data-row').each(function (_dataRow) {\n          var currentRow = getCssValue(event.target, 'top');\n          set$1(event.target, 'top', currentRow + event.yDelta + 'px');\n        });\n        getResizer(event.target, 'data-column').each(function (_dataCol) {\n          var currentCol = getCssValue(event.target, 'left');\n          set$1(event.target, 'left', currentCol + event.xDelta + 'px');\n        });\n      });\n      var getDelta = function (target, dir) {\n        var newX = getCssValue(target, dir);\n        var oldX = getAttrValue(target, 'data-initial-' + dir, 0);\n        return newX - oldX;\n      };\n      resizing.events.stop.bind(function () {\n        mutation.get().each(function (target) {\n          hoverTable.each(function (table) {\n            getResizer(target, 'data-row').each(function (row) {\n              var delta = getDelta(target, 'top');\n              remove(target, 'data-initial-top');\n              events.trigger.adjustHeight(table, delta, parseInt(row, 10));\n            });\n            getResizer(target, 'data-column').each(function (column) {\n              var delta = getDelta(target, 'left');\n              remove(target, 'data-initial-left');\n              events.trigger.adjustWidth(table, delta, parseInt(column, 10));\n            });\n            refresh(wire, table);\n          });\n        });\n      });\n      var handler = function (target, dir) {\n        events.trigger.startAdjust();\n        mutation.assign(target);\n        set(target, 'data-initial-' + dir, getCssValue(target, dir));\n        add$3(target, resizeBarDragging);\n        set$1(target, 'opacity', '0.2');\n        resizing.go(wire.parent());\n      };\n      var mousedown = bind$2(wire.parent(), 'mousedown', function (event) {\n        if (isRowBar(event.target)) {\n          handler(event.target, 'top');\n        }\n        if (isColBar(event.target)) {\n          handler(event.target, 'left');\n        }\n      });\n      var isRoot = function (e) {\n        return eq$1(e, wire.view());\n      };\n      var findClosestEditableTable = function (target) {\n        return closest$1(target, 'table', isRoot).filter(function (table) {\n          return findClosestContentEditable(table, isRoot).exists(isContentEditableTrue);\n        });\n      };\n      var mouseover = bind$2(wire.view(), 'mouseover', function (event) {\n        findClosestEditableTable(event.target).fold(function () {\n          if (inBody(event.target)) {\n            destroy(wire);\n          }\n        }, function (table) {\n          hoverTable = Optional.some(table);\n          refresh(wire, table);\n        });\n      });\n      var destroy$1 = function () {\n        mousedown.unbind();\n        mouseover.unbind();\n        resizing.destroy();\n        destroy(wire);\n      };\n      var refresh$1 = function (tbl) {\n        refresh(wire, tbl);\n      };\n      var events = create({\n        adjustHeight: Event([\n          'table',\n          'delta',\n          'row'\n        ]),\n        adjustWidth: Event([\n          'table',\n          'delta',\n          'column'\n        ]),\n        startAdjust: Event([])\n      });\n      return {\n        destroy: destroy$1,\n        refresh: refresh$1,\n        on: resizing.on,\n        off: resizing.off,\n        hideBars: curry(hide, wire),\n        showBars: curry(show, wire),\n        events: events.registry\n      };\n    };\n\n    var create$1 = function (wire, resizing, lazySizing) {\n      var hdirection = height;\n      var vdirection = width;\n      var manager = BarManager(wire);\n      var events = create({\n        beforeResize: Event([\n          'table',\n          'type'\n        ]),\n        afterResize: Event([\n          'table',\n          'type'\n        ]),\n        startDrag: Event([])\n      });\n      manager.events.adjustHeight.bind(function (event) {\n        var table = event.table;\n        events.trigger.beforeResize(table, 'row');\n        var delta = hdirection.delta(event.delta, table);\n        adjustHeight(table, delta, event.row, hdirection);\n        events.trigger.afterResize(table, 'row');\n      });\n      manager.events.startAdjust.bind(function (_event) {\n        events.trigger.startDrag();\n      });\n      manager.events.adjustWidth.bind(function (event) {\n        var table = event.table;\n        events.trigger.beforeResize(table, 'col');\n        var delta = vdirection.delta(event.delta, table);\n        var tableSize = lazySizing(table);\n        adjustWidth(table, delta, event.column, resizing, tableSize);\n        events.trigger.afterResize(table, 'col');\n      });\n      return {\n        on: manager.on,\n        off: manager.off,\n        hideBars: manager.hideBars,\n        showBars: manager.showBars,\n        destroy: manager.destroy,\n        events: events.registry\n      };\n    };\n    var TableResize = { create: create$1 };\n\n    var fireNewRow = function (editor, row) {\n      return editor.fire('newrow', { node: row });\n    };\n    var fireNewCell = function (editor, cell) {\n      return editor.fire('newcell', { node: cell });\n    };\n    var fireObjectResizeStart = function (editor, target, width, height, origin) {\n      editor.fire('ObjectResizeStart', {\n        target: target,\n        width: width,\n        height: height,\n        origin: origin\n      });\n    };\n    var fireObjectResized = function (editor, target, width, height, origin) {\n      editor.fire('ObjectResized', {\n        target: target,\n        width: width,\n        height: height,\n        origin: origin\n      });\n    };\n    var fireTableSelectionChange = function (editor, cells, start, finish, otherCells) {\n      editor.fire('TableSelectionChange', {\n        cells: cells,\n        start: start,\n        finish: finish,\n        otherCells: otherCells\n      });\n    };\n    var fireTableSelectionClear = function (editor) {\n      editor.fire('TableSelectionClear');\n    };\n    var fireTableModified = function (editor, table, data) {\n      editor.fire('TableModified', __assign(__assign({}, data), { table: table }));\n    };\n    var styleModified = {\n      structure: false,\n      style: true\n    };\n    var structureModified = {\n      structure: true,\n      style: false\n    };\n\n    var defaultTableToolbar = 'tableprops tabledelete | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol';\n    var defaultStyles = {\n      'border-collapse': 'collapse',\n      'width': '100%'\n    };\n    var determineDefaultStyles = function (editor) {\n      if (isPixelsForced(editor)) {\n        var editorWidth = editor.getBody().offsetWidth;\n        return __assign(__assign({}, defaultStyles), { width: editorWidth + 'px' });\n      } else if (isResponsiveForced(editor)) {\n        return filter$1(defaultStyles, function (_value, key) {\n          return key !== 'width';\n        });\n      } else {\n        return defaultStyles;\n      }\n    };\n    var defaultAttributes = { border: '1' };\n    var defaultColumnResizingBehaviour = 'preservetable';\n    var getTableSizingMode = function (editor) {\n      return editor.getParam('table_sizing_mode', 'auto');\n    };\n    var getTableResponseWidth = function (editor) {\n      return editor.getParam('table_responsive_width');\n    };\n    var getDefaultAttributes = function (editor) {\n      return editor.getParam('table_default_attributes', defaultAttributes, 'object');\n    };\n    var getDefaultStyles = function (editor) {\n      return editor.getParam('table_default_styles', determineDefaultStyles(editor), 'object');\n    };\n    var hasTableResizeBars = function (editor) {\n      return editor.getParam('table_resize_bars', true, 'boolean');\n    };\n    var hasTabNavigation = function (editor) {\n      return editor.getParam('table_tab_navigation', true, 'boolean');\n    };\n    var hasAdvancedCellTab = function (editor) {\n      return editor.getParam('table_cell_advtab', true, 'boolean');\n    };\n    var hasAdvancedRowTab = function (editor) {\n      return editor.getParam('table_row_advtab', true, 'boolean');\n    };\n    var hasAdvancedTableTab = function (editor) {\n      return editor.getParam('table_advtab', true, 'boolean');\n    };\n    var hasAppearanceOptions = function (editor) {\n      return editor.getParam('table_appearance_options', true, 'boolean');\n    };\n    var hasTableGrid = function (editor) {\n      return editor.getParam('table_grid', true, 'boolean');\n    };\n    var shouldStyleWithCss = function (editor) {\n      return editor.getParam('table_style_by_css', false, 'boolean');\n    };\n    var getCellClassList = function (editor) {\n      return editor.getParam('table_cell_class_list', [], 'array');\n    };\n    var getRowClassList = function (editor) {\n      return editor.getParam('table_row_class_list', [], 'array');\n    };\n    var getTableClassList = function (editor) {\n      return editor.getParam('table_class_list', [], 'array');\n    };\n    var isPercentagesForced = function (editor) {\n      return getTableSizingMode(editor) === 'relative' || getTableResponseWidth(editor) === true;\n    };\n    var isPixelsForced = function (editor) {\n      return getTableSizingMode(editor) === 'fixed' || getTableResponseWidth(editor) === false;\n    };\n    var isResponsiveForced = function (editor) {\n      return getTableSizingMode(editor) === 'responsive';\n    };\n    var getToolbar = function (editor) {\n      return editor.getParam('table_toolbar', defaultTableToolbar);\n    };\n    var useColumnGroup = function (editor) {\n      return editor.getParam('table_use_colgroups', false, 'boolean');\n    };\n    var getTableHeaderType = function (editor) {\n      var defaultValue = 'section';\n      var value = editor.getParam('table_header_type', defaultValue, 'string');\n      var validValues = [\n        'section',\n        'cells',\n        'sectionCells',\n        'auto'\n      ];\n      if (!contains(validValues, value)) {\n        return defaultValue;\n      } else {\n        return value;\n      }\n    };\n    var getColumnResizingBehaviour = function (editor) {\n      var validModes = [\n        'preservetable',\n        'resizetable'\n      ];\n      var givenMode = editor.getParam('table_column_resizing', defaultColumnResizingBehaviour, 'string');\n      return find(validModes, function (mode) {\n        return mode === givenMode;\n      }).getOr(defaultColumnResizingBehaviour);\n    };\n    var isPreserveTableColumnResizing = function (editor) {\n      return getColumnResizingBehaviour(editor) === 'preservetable';\n    };\n    var isResizeTableColumnResizing = function (editor) {\n      return getColumnResizingBehaviour(editor) === 'resizetable';\n    };\n    var getCloneElements = function (editor) {\n      var cloneElements = editor.getParam('table_clone_elements');\n      if (isString(cloneElements)) {\n        return Optional.some(cloneElements.split(/[ ,]/));\n      } else if (Array.isArray(cloneElements)) {\n        return Optional.some(cloneElements);\n      } else {\n        return Optional.none();\n      }\n    };\n    var hasObjectResizing = function (editor) {\n      var objectResizing = editor.getParam('object_resizing', true);\n      return isString(objectResizing) ? objectResizing === 'table' : objectResizing;\n    };\n\n    var get$9 = function (editor, table) {\n      if (isPercentagesForced(editor)) {\n        var width = getRawWidth$1(editor, table.dom).filter(isPercentage).getOrThunk(function () {\n          return getPercentTableWidth$1(table);\n        });\n        return TableSize.percentageSize(width, table);\n      } else if (isPixelsForced(editor)) {\n        return TableSize.pixelSize(get$5(table), table);\n      } else {\n        return TableSize.getTableSize(table);\n      }\n    };\n\n    var cleanupLegacyAttributes = function (element) {\n      remove(element, 'width');\n    };\n    var convertToPercentSize = function (table, tableSize) {\n      var newWidth = getPercentTableWidth(table);\n      redistribute$1(table, Optional.some(newWidth), Optional.none(), tableSize);\n      cleanupLegacyAttributes(table);\n    };\n    var convertToPixelSize = function (table, tableSize) {\n      var newWidth = getPixelTableWidth(table);\n      redistribute$1(table, Optional.some(newWidth), Optional.none(), tableSize);\n      cleanupLegacyAttributes(table);\n    };\n    var convertToNoneSize = function (table) {\n      remove$1(table, 'width');\n      var columns$1 = columns(table);\n      var rowElements = columns$1.length > 0 ? columns$1 : cells(table);\n      each(rowElements, function (cell) {\n        remove$1(cell, 'width');\n        cleanupLegacyAttributes(cell);\n      });\n      cleanupLegacyAttributes(table);\n    };\n\n    var enforcePercentage = function (editor, table) {\n      var tableSizing = get$9(editor, table);\n      convertToPercentSize(table, tableSizing);\n    };\n    var enforcePixels = function (editor, table) {\n      var tableSizing = get$9(editor, table);\n      convertToPixelSize(table, tableSizing);\n    };\n    var enforceNone = convertToNoneSize;\n    var syncPixels = function (table) {\n      var warehouse = Warehouse.fromTable(table);\n      if (!Warehouse.hasColumns(warehouse)) {\n        each(cells(table), function (cell) {\n          var computedWidth = get$3(cell, 'width');\n          set$1(cell, 'width', computedWidth);\n          remove(cell, 'width');\n        });\n      }\n    };\n\n    var createContainer = function () {\n      var container = SugarElement.fromTag('div');\n      setAll$1(container, {\n        position: 'static',\n        height: '0',\n        width: '0',\n        padding: '0',\n        margin: '0',\n        border: '0'\n      });\n      append(body(), container);\n      return container;\n    };\n    var get$a = function (editor, isResizable) {\n      return editor.inline ? ResizeWire.body(getBody$1(editor), createContainer(), isResizable) : ResizeWire.only(SugarElement.fromDom(editor.getDoc()), isResizable);\n    };\n    var remove$6 = function (editor, wire) {\n      if (editor.inline) {\n        remove$2(wire.parent());\n      }\n    };\n\n    var barResizerPrefix = 'bar-';\n    var isResizable = function (elm) {\n      return get$2(elm, 'data-mce-resize') !== 'false';\n    };\n    var getResizeHandler = function (editor) {\n      var selectionRng = Optional.none();\n      var resize = Optional.none();\n      var wire = Optional.none();\n      var startW;\n      var startRawW;\n      var isTable = function (elm) {\n        return elm.nodeName === 'TABLE';\n      };\n      var lazyResize = function () {\n        return resize;\n      };\n      var lazyWire = function () {\n        return wire.getOr(ResizeWire.only(SugarElement.fromDom(editor.getBody()), isResizable));\n      };\n      var lazySizing = function (table) {\n        return get$9(editor, table);\n      };\n      var lazyResizingBehaviour = function () {\n        return isPreserveTableColumnResizing(editor) ? preserveTable() : resizeTable();\n      };\n      var getNumColumns = function (table) {\n        return getGridSize(table).columns;\n      };\n      var afterCornerResize = function (table, origin, width) {\n        var isRightEdgeResize = endsWith(origin, 'e');\n        if (startRawW === '') {\n          enforcePercentage(editor, table);\n        }\n        if (width !== startW && startRawW !== '') {\n          set$1(table, 'width', startRawW);\n          var resizing = lazyResizingBehaviour();\n          var tableSize = lazySizing(table);\n          var col = isPreserveTableColumnResizing(editor) || isRightEdgeResize ? getNumColumns(table) - 1 : 0;\n          adjustWidth(table, width - startW, col, resizing, tableSize);\n        } else if (isPercentage(startRawW)) {\n          var percentW = parseFloat(startRawW.replace('%', ''));\n          var targetPercentW = width * percentW / startW;\n          set$1(table, 'width', targetPercentW + '%');\n        }\n        if (isPixel(startRawW)) {\n          syncPixels(table);\n        }\n      };\n      var destroy = function () {\n        resize.each(function (sz) {\n          sz.destroy();\n        });\n        wire.each(function (w) {\n          remove$6(editor, w);\n        });\n      };\n      editor.on('init', function () {\n        var rawWire = get$a(editor, isResizable);\n        wire = Optional.some(rawWire);\n        if (hasObjectResizing(editor) && hasTableResizeBars(editor)) {\n          var resizing = lazyResizingBehaviour();\n          var sz = TableResize.create(rawWire, resizing, lazySizing);\n          sz.on();\n          sz.events.startDrag.bind(function (_event) {\n            selectionRng = Optional.some(editor.selection.getRng());\n          });\n          sz.events.beforeResize.bind(function (event) {\n            var rawTable = event.table.dom;\n            fireObjectResizeStart(editor, rawTable, getPixelWidth$1(rawTable), getPixelHeight(rawTable), barResizerPrefix + event.type);\n          });\n          sz.events.afterResize.bind(function (event) {\n            var table = event.table;\n            var rawTable = table.dom;\n            removeDataStyle(table);\n            selectionRng.each(function (rng) {\n              editor.selection.setRng(rng);\n              editor.focus();\n            });\n            fireObjectResized(editor, rawTable, getPixelWidth$1(rawTable), getPixelHeight(rawTable), barResizerPrefix + event.type);\n            editor.undoManager.add();\n          });\n          resize = Optional.some(sz);\n        }\n      });\n      editor.on('ObjectResizeStart', function (e) {\n        var targetElm = e.target;\n        if (isTable(targetElm)) {\n          var table = SugarElement.fromDom(targetElm);\n          each(editor.dom.select('.mce-clonedresizable'), function (clone) {\n            editor.dom.addClass(clone, 'mce-' + getColumnResizingBehaviour(editor) + '-columns');\n          });\n          if (!isPixelSizing$1(table) && isPixelsForced(editor)) {\n            enforcePixels(editor, table);\n          } else if (!isPercentSizing$1(table) && isPercentagesForced(editor)) {\n            enforcePercentage(editor, table);\n          }\n          if (isNoneSizing$1(table) && startsWith(e.origin, barResizerPrefix)) {\n            enforcePercentage(editor, table);\n          }\n          startW = e.width;\n          startRawW = isResponsiveForced(editor) ? '' : getRawWidth$1(editor, targetElm).getOr('');\n        }\n      });\n      editor.on('ObjectResized', function (e) {\n        var targetElm = e.target;\n        if (isTable(targetElm)) {\n          var table = SugarElement.fromDom(targetElm);\n          var origin_1 = e.origin;\n          if (startsWith(origin_1, 'corner-')) {\n            afterCornerResize(table, origin_1, e.width);\n          }\n          removeDataStyle(table);\n          fireTableModified(editor, table.dom, styleModified);\n        }\n      });\n      editor.on('SwitchMode', function () {\n        lazyResize().each(function (resize) {\n          if (editor.mode.isReadOnly()) {\n            resize.hideBars();\n          } else {\n            resize.showBars();\n          }\n        });\n      });\n      return {\n        lazyResize: lazyResize,\n        lazyWire: lazyWire,\n        destroy: destroy\n      };\n    };\n\n    var point = function (element, offset) {\n      return {\n        element: element,\n        offset: offset\n      };\n    };\n\n    var scan = function (universe, element, direction) {\n      if (universe.property().isText(element) && universe.property().getText(element).trim().length === 0 || universe.property().isComment(element)) {\n        return direction(element).bind(function (elem) {\n          return scan(universe, elem, direction).orThunk(function () {\n            return Optional.some(elem);\n          });\n        });\n      } else {\n        return Optional.none();\n      }\n    };\n    var toEnd = function (universe, element) {\n      if (universe.property().isText(element)) {\n        return universe.property().getText(element).length;\n      }\n      var children = universe.property().children(element);\n      return children.length;\n    };\n    var freefallRtl = function (universe, element) {\n      var candidate = scan(universe, element, universe.query().prevSibling).getOr(element);\n      if (universe.property().isText(candidate)) {\n        return point(candidate, toEnd(universe, candidate));\n      }\n      var children = universe.property().children(candidate);\n      return children.length > 0 ? freefallRtl(universe, children[children.length - 1]) : point(candidate, toEnd(universe, candidate));\n    };\n\n    var freefallRtl$1 = freefallRtl;\n\n    var universe$1 = DomUniverse();\n    var freefallRtl$2 = function (element) {\n      return freefallRtl$1(universe$1, element);\n    };\n\n    var halve = function (main, other) {\n      var colspan = getSpan(main, 'colspan');\n      if (colspan === 1) {\n        var width = getGenericWidth(main);\n        width.each(function (w) {\n          var newWidth = w.value / 2;\n          setGenericWidth(main, newWidth, w.unit);\n          setGenericWidth(other, newWidth, w.unit);\n        });\n      }\n    };\n\n    var setIfNot = function (element, property, value, ignore) {\n      if (value === ignore) {\n        remove(element, property);\n      } else {\n        set(element, property, value);\n      }\n    };\n    var insert = function (table, selector, element) {\n      last(children$2(table, selector)).fold(function () {\n        return prepend(table, element);\n      }, function (child) {\n        return after(child, element);\n      });\n    };\n    var generateSection = function (table, sectionName) {\n      var section = child$2(table, sectionName).getOrThunk(function () {\n        var newSection = SugarElement.fromTag(sectionName, owner(table).dom);\n        if (sectionName === 'thead') {\n          insert(table, 'caption,colgroup', newSection);\n        } else if (sectionName === 'colgroup') {\n          insert(table, 'caption', newSection);\n        } else {\n          append(table, newSection);\n        }\n        return newSection;\n      });\n      empty(section);\n      return section;\n    };\n    var render = function (table, grid) {\n      var newRows = [];\n      var newCells = [];\n      var syncRows = function (gridSection) {\n        return map(gridSection, function (row) {\n          if (row.isNew) {\n            newRows.push(row.element);\n          }\n          var tr = row.element;\n          empty(tr);\n          each(row.cells, function (cell) {\n            if (cell.isNew) {\n              newCells.push(cell.element);\n            }\n            setIfNot(cell.element, 'colspan', cell.colspan, 1);\n            setIfNot(cell.element, 'rowspan', cell.rowspan, 1);\n            append(tr, cell.element);\n          });\n          return tr;\n        });\n      };\n      var syncColGroup = function (gridSection) {\n        return bind(gridSection, function (colGroup) {\n          return map(colGroup.cells, function (col) {\n            setIfNot(col.element, 'span', col.colspan, 1);\n            return col.element;\n          });\n        });\n      };\n      var renderSection = function (gridSection, sectionName) {\n        var section = generateSection(table, sectionName);\n        var sync = sectionName === 'colgroup' ? syncColGroup : syncRows;\n        var sectionElems = sync(gridSection);\n        append$1(section, sectionElems);\n      };\n      var removeSection = function (sectionName) {\n        child$2(table, sectionName).each(remove$2);\n      };\n      var renderOrRemoveSection = function (gridSection, sectionName) {\n        if (gridSection.length > 0) {\n          renderSection(gridSection, sectionName);\n        } else {\n          removeSection(sectionName);\n        }\n      };\n      var headSection = [];\n      var bodySection = [];\n      var footSection = [];\n      var columnGroupsSection = [];\n      each(grid, function (row) {\n        switch (row.section) {\n        case 'thead':\n          headSection.push(row);\n          break;\n        case 'tbody':\n          bodySection.push(row);\n          break;\n        case 'tfoot':\n          footSection.push(row);\n          break;\n        case 'colgroup':\n          columnGroupsSection.push(row);\n          break;\n        }\n      });\n      renderOrRemoveSection(columnGroupsSection, 'colgroup');\n      renderOrRemoveSection(headSection, 'thead');\n      renderOrRemoveSection(bodySection, 'tbody');\n      renderOrRemoveSection(footSection, 'tfoot');\n      return {\n        newRows: newRows,\n        newCells: newCells\n      };\n    };\n    var copy$2 = function (grid) {\n      return map(grid, function (row) {\n        var tr = shallow(row.element);\n        each(row.cells, function (cell) {\n          var clonedCell = deep(cell.element);\n          setIfNot(clonedCell, 'colspan', cell.colspan, 1);\n          setIfNot(clonedCell, 'rowspan', cell.rowspan, 1);\n          append(tr, clonedCell);\n        });\n        return tr;\n      });\n    };\n\n    var getColumn = function (grid, index) {\n      return map(grid, function (row) {\n        return getCell(row, index);\n      });\n    };\n    var getRow = function (grid, index) {\n      return grid[index];\n    };\n    var findDiff = function (xs, comp) {\n      if (xs.length === 0) {\n        return 0;\n      }\n      var first = xs[0];\n      var index = findIndex(xs, function (x) {\n        return !comp(first.element, x.element);\n      });\n      return index.fold(function () {\n        return xs.length;\n      }, function (ind) {\n        return ind;\n      });\n    };\n    var subgrid = function (grid, row, column, comparator) {\n      var restOfRow = getRow(grid, row).cells.slice(column);\n      var endColIndex = findDiff(restOfRow, comparator);\n      var restOfColumn = getColumn(grid, column).slice(row);\n      var endRowIndex = findDiff(restOfColumn, comparator);\n      return {\n        colspan: endColIndex,\n        rowspan: endRowIndex\n      };\n    };\n\n    var toDetails = function (grid, comparator) {\n      var seen = map(grid, function (row) {\n        return map(row.cells, never);\n      });\n      var updateSeen = function (rowIndex, columnIndex, rowspan, colspan) {\n        for (var row = rowIndex; row < rowIndex + rowspan; row++) {\n          for (var column = columnIndex; column < columnIndex + colspan; column++) {\n            seen[row][column] = true;\n          }\n        }\n      };\n      return map(grid, function (row, rowIndex) {\n        var details = bind(row.cells, function (cell, columnIndex) {\n          if (seen[rowIndex][columnIndex] === false) {\n            var result = subgrid(grid, rowIndex, columnIndex, comparator);\n            updateSeen(rowIndex, columnIndex, result.rowspan, result.colspan);\n            return [detailnew(cell.element, result.rowspan, result.colspan, cell.isNew)];\n          } else {\n            return [];\n          }\n        });\n        return rowdetails(details, row.section);\n      });\n    };\n    var toGrid = function (warehouse, generators, isNew) {\n      var grid = [];\n      if (Warehouse.hasColumns(warehouse)) {\n        var groupElementNew = map(Warehouse.justColumns(warehouse), function (column) {\n          return elementnew(column.element, isNew, false);\n        });\n        grid.push(rowcells(groupElementNew, 'colgroup'));\n      }\n      for (var rowIndex = 0; rowIndex < warehouse.grid.rows; rowIndex++) {\n        var rowCells = [];\n        for (var columnIndex = 0; columnIndex < warehouse.grid.columns; columnIndex++) {\n          var element = Warehouse.getAt(warehouse, rowIndex, columnIndex).map(function (item) {\n            return elementnew(item.element, isNew, item.isLocked);\n          }).getOrThunk(function () {\n            return elementnew(generators.gap(), true, false);\n          });\n          rowCells.push(element);\n        }\n        var row = rowcells(rowCells, warehouse.all[rowIndex].section);\n        grid.push(row);\n      }\n      return grid;\n    };\n\n    var fromWarehouse = function (warehouse, generators) {\n      return toGrid(warehouse, generators, false);\n    };\n    var deriveRows = function (rendered, generators) {\n      var findRow = function (details) {\n        var rowOfCells = findMap(details, function (detail) {\n          return parent(detail.element).map(function (row) {\n            var isNew = parent(row).isNone();\n            return elementnew(row, isNew, false);\n          });\n        });\n        return rowOfCells.getOrThunk(function () {\n          return elementnew(generators.row(), true, false);\n        });\n      };\n      return map(rendered, function (details) {\n        var row = findRow(details.details);\n        return rowdatanew(row.element, details.details, details.section, row.isNew);\n      });\n    };\n    var toDetailList = function (grid, generators) {\n      var rendered = toDetails(grid, eq$1);\n      return deriveRows(rendered, generators);\n    };\n    var findInWarehouse = function (warehouse, element) {\n      return findMap(warehouse.all, function (r) {\n        return find(r.cells, function (e) {\n          return eq$1(element, e.element);\n        });\n      });\n    };\n    var extractCells = function (warehouse, target, predicate) {\n      var details = map(target.selection, function (cell$1) {\n        return cell(cell$1).bind(function (lc) {\n          return findInWarehouse(warehouse, lc);\n        }).filter(predicate);\n      });\n      var cells = cat(details);\n      return someIf(cells.length > 0, cells);\n    };\n    var run = function (operation, extract, adjustment, postAction, genWrappers) {\n      return function (wire, table, target, generators, sizing, resizeBehaviour) {\n        var warehouse = Warehouse.fromTable(table);\n        var output = extract(warehouse, target).map(function (info) {\n          var model = fromWarehouse(warehouse, generators);\n          var result = operation(model, info, eq$1, genWrappers(generators));\n          var lockedColumns = getLockedColumnsFromGrid(result.grid);\n          var grid = toDetailList(result.grid, generators);\n          return {\n            info: info,\n            grid: grid,\n            cursor: result.cursor,\n            lockedColumns: lockedColumns\n          };\n        });\n        return output.bind(function (out) {\n          var newElements = render(table, out.grid);\n          var tableSizing = Optional.from(sizing).getOrThunk(function () {\n            return TableSize.getTableSize(table);\n          });\n          var resizing = Optional.from(resizeBehaviour).getOrThunk(preserveTable);\n          adjustment(table, out.grid, out.info, tableSizing, resizing);\n          postAction(table);\n          refresh(wire, table);\n          remove(table, LOCKED_COL_ATTR);\n          if (out.lockedColumns.length > 0) {\n            set(table, LOCKED_COL_ATTR, out.lockedColumns.join(','));\n          }\n          return Optional.some({\n            cursor: out.cursor,\n            newRows: newElements.newRows,\n            newCells: newElements.newCells\n          });\n        });\n      };\n    };\n    var onCell = function (warehouse, target) {\n      return cell(target.element).bind(function (cell) {\n        return findInWarehouse(warehouse, cell);\n      });\n    };\n    var onPaste = function (warehouse, target) {\n      return cell(target.element).bind(function (cell) {\n        return findInWarehouse(warehouse, cell).map(function (details) {\n          var value = __assign(__assign({}, details), {\n            generators: target.generators,\n            clipboard: target.clipboard\n          });\n          return value;\n        });\n      });\n    };\n    var onPasteByEditor = function (warehouse, target) {\n      return extractCells(warehouse, target, always).map(function (cells) {\n        return {\n          cells: cells,\n          generators: target.generators,\n          clipboard: target.clipboard\n        };\n      });\n    };\n    var onMergable = function (_warehouse, target) {\n      return target.mergable;\n    };\n    var onUnmergable = function (_warehouse, target) {\n      return target.unmergable;\n    };\n    var onCells = function (warehouse, target) {\n      return extractCells(warehouse, target, always);\n    };\n    var onUnlockedCell = function (warehouse, target) {\n      return onCell(warehouse, target).filter(function (detail) {\n        return !detail.isLocked;\n      });\n    };\n    var onUnlockedCells = function (warehouse, target) {\n      return extractCells(warehouse, target, function (detail) {\n        return !detail.isLocked;\n      });\n    };\n    var isUnlockedTableCell = function (warehouse, cell) {\n      return findInWarehouse(warehouse, cell).exists(function (detail) {\n        return !detail.isLocked;\n      });\n    };\n    var allUnlocked = function (warehouse, cells) {\n      return forall(cells, function (cell) {\n        return isUnlockedTableCell(warehouse, cell);\n      });\n    };\n    var onUnlockedMergable = function (warehouse, target) {\n      return onMergable(warehouse, target).filter(function (mergeable) {\n        return allUnlocked(warehouse, mergeable.cells);\n      });\n    };\n    var onUnlockedUnmergable = function (warehouse, target) {\n      return onUnmergable(warehouse, target).filter(function (cells) {\n        return allUnlocked(warehouse, cells);\n      });\n    };\n\n    var merge = function (grid, bounds, comparator, substitution) {\n      var rows = extractGridDetails(grid).rows;\n      if (rows.length === 0) {\n        return grid;\n      }\n      for (var i = bounds.startRow; i <= bounds.finishRow; i++) {\n        for (var j = bounds.startCol; j <= bounds.finishCol; j++) {\n          var row = rows[i];\n          var isLocked = getCell(row, j).isLocked;\n          mutateCell(row, j, elementnew(substitution(), false, isLocked));\n        }\n      }\n      return grid;\n    };\n    var unmerge = function (grid, target, comparator, substitution) {\n      var rows = extractGridDetails(grid).rows;\n      var first = true;\n      for (var i = 0; i < rows.length; i++) {\n        for (var j = 0; j < cellLength(rows[0]); j++) {\n          var row = rows[i];\n          var currentCell = getCell(row, j);\n          var currentCellElm = currentCell.element;\n          var isToReplace = comparator(currentCellElm, target);\n          if (isToReplace === true && first === false) {\n            mutateCell(row, j, elementnew(substitution(), true, currentCell.isLocked));\n          } else if (isToReplace === true) {\n            first = false;\n          }\n        }\n      }\n      return grid;\n    };\n    var uniqueCells = function (row, comparator) {\n      return foldl(row, function (rest, cell) {\n        return exists(rest, function (currentCell) {\n          return comparator(currentCell.element, cell.element);\n        }) ? rest : rest.concat([cell]);\n      }, []);\n    };\n    var splitCols = function (grid, index, comparator, substitution) {\n      if (index > 0 && index < grid[0].cells.length) {\n        each(grid, function (row) {\n          var prevCell = row.cells[index - 1];\n          var current = row.cells[index];\n          var isToReplace = comparator(current.element, prevCell.element);\n          if (isToReplace) {\n            mutateCell(row, index, elementnew(substitution(), true, current.isLocked));\n          }\n        });\n      }\n      return grid;\n    };\n    var splitRows = function (grid, index, comparator, substitution) {\n      var rows = extractGridDetails(grid).rows;\n      if (index > 0 && index < rows.length) {\n        var rowPrevCells = rows[index - 1].cells;\n        var cells = uniqueCells(rowPrevCells, comparator);\n        each(cells, function (cell) {\n          var replacement = Optional.none();\n          for (var i = index; i < rows.length; i++) {\n            var _loop_1 = function (j) {\n              var row = rows[i];\n              var current = getCell(row, j);\n              var isToReplace = comparator(current.element, cell.element);\n              if (isToReplace) {\n                if (replacement.isNone()) {\n                  replacement = Optional.some(substitution());\n                }\n                replacement.each(function (sub) {\n                  mutateCell(row, j, elementnew(sub, true, current.isLocked));\n                });\n              }\n            };\n            for (var j = 0; j < cellLength(rows[0]); j++) {\n              _loop_1(j);\n            }\n          }\n        });\n      }\n      return grid;\n    };\n\n    var value = function (o) {\n      var is = function (v) {\n        return o === v;\n      };\n      var or = function (_opt) {\n        return value(o);\n      };\n      var orThunk = function (_f) {\n        return value(o);\n      };\n      var map = function (f) {\n        return value(f(o));\n      };\n      var mapError = function (_f) {\n        return value(o);\n      };\n      var each = function (f) {\n        f(o);\n      };\n      var bind = function (f) {\n        return f(o);\n      };\n      var fold = function (_, onValue) {\n        return onValue(o);\n      };\n      var exists = function (f) {\n        return f(o);\n      };\n      var forall = function (f) {\n        return f(o);\n      };\n      var toOptional = function () {\n        return Optional.some(o);\n      };\n      return {\n        is: is,\n        isValue: always,\n        isError: never,\n        getOr: constant(o),\n        getOrThunk: constant(o),\n        getOrDie: constant(o),\n        or: or,\n        orThunk: orThunk,\n        fold: fold,\n        map: map,\n        mapError: mapError,\n        each: each,\n        bind: bind,\n        exists: exists,\n        forall: forall,\n        toOptional: toOptional\n      };\n    };\n    var error = function (message) {\n      var getOrThunk = function (f) {\n        return f();\n      };\n      var getOrDie = function () {\n        return die(String(message))();\n      };\n      var or = function (opt) {\n        return opt;\n      };\n      var orThunk = function (f) {\n        return f();\n      };\n      var map = function (_f) {\n        return error(message);\n      };\n      var mapError = function (f) {\n        return error(f(message));\n      };\n      var bind = function (_f) {\n        return error(message);\n      };\n      var fold = function (onError, _) {\n        return onError(message);\n      };\n      return {\n        is: never,\n        isValue: never,\n        isError: always,\n        getOr: identity,\n        getOrThunk: getOrThunk,\n        getOrDie: getOrDie,\n        or: or,\n        orThunk: orThunk,\n        fold: fold,\n        map: map,\n        mapError: mapError,\n        each: noop,\n        bind: bind,\n        exists: never,\n        forall: always,\n        toOptional: Optional.none\n      };\n    };\n    var fromOption = function (opt, err) {\n      return opt.fold(function () {\n        return error(err);\n      }, value);\n    };\n    var Result = {\n      value: value,\n      error: error,\n      fromOption: fromOption\n    };\n\n    var measure = function (startAddress, gridA, gridB) {\n      if (startAddress.row >= gridA.length || startAddress.column > cellLength(gridA[0])) {\n        return Result.error('invalid start address out of table bounds, row: ' + startAddress.row + ', column: ' + startAddress.column);\n      }\n      var rowRemainder = gridA.slice(startAddress.row);\n      var colRemainder = rowRemainder[0].cells.slice(startAddress.column);\n      var colRequired = cellLength(gridB[0]);\n      var rowRequired = gridB.length;\n      return Result.value({\n        rowDelta: rowRemainder.length - rowRequired,\n        colDelta: colRemainder.length - colRequired\n      });\n    };\n    var measureWidth = function (gridA, gridB) {\n      var colLengthA = cellLength(gridA[0]);\n      var colLengthB = cellLength(gridB[0]);\n      return {\n        rowDelta: 0,\n        colDelta: colLengthA - colLengthB\n      };\n    };\n    var measureHeight = function (gridA, gridB) {\n      var rowLengthA = gridA.length;\n      var rowLengthB = gridB.length;\n      return {\n        rowDelta: rowLengthA - rowLengthB,\n        colDelta: 0\n      };\n    };\n    var generateElements = function (amount, row, generators, isLocked) {\n      var generator = row.section === 'colgroup' ? generators.col : generators.cell;\n      return range(amount, function (idx) {\n        return elementnew(generator(), true, isLocked(idx));\n      });\n    };\n    var rowFill = function (grid, amount, generators, lockedColumns) {\n      return grid.concat(range(amount, function () {\n        var row = grid[grid.length - 1];\n        var elements = generateElements(row.cells.length, row, generators, function (idx) {\n          return has(lockedColumns, idx.toString());\n        });\n        return setCells(row, elements);\n      }));\n    };\n    var colFill = function (grid, amount, generators, startIndex) {\n      return map(grid, function (row) {\n        var newChildren = generateElements(amount, row, generators, never);\n        return addCells(row, startIndex, newChildren);\n      });\n    };\n    var lockedColFill = function (grid, generators, lockedColumns) {\n      return map(grid, function (row) {\n        return foldl(lockedColumns, function (acc, colNum) {\n          var newChild = generateElements(1, row, generators, always)[0];\n          return addCell(acc, colNum, newChild);\n        }, row);\n      });\n    };\n    var tailor = function (gridA, delta, generators) {\n      var fillCols = delta.colDelta < 0 ? colFill : identity;\n      var fillRows = delta.rowDelta < 0 ? rowFill : identity;\n      var lockedColumns = getLockedColumnsFromGrid(gridA);\n      var gridWidth = cellLength(gridA[0]);\n      var isLastColLocked = exists(lockedColumns, function (locked) {\n        return locked === gridWidth - 1;\n      });\n      var modifiedCols = fillCols(gridA, Math.abs(delta.colDelta), generators, isLastColLocked ? gridWidth - 1 : gridWidth);\n      var newLockedColumns = getLockedColumnsFromGrid(modifiedCols);\n      return fillRows(modifiedCols, Math.abs(delta.rowDelta), generators, mapToObject(newLockedColumns, always));\n    };\n\n    var isSpanning = function (grid, row, col, comparator) {\n      var candidate = getCell(grid[row], col);\n      var matching = curry(comparator, candidate.element);\n      var currentRow = grid[row];\n      return grid.length > 1 && cellLength(currentRow) > 1 && (col > 0 && matching(getCellElement(currentRow, col - 1)) || col < currentRow.cells.length - 1 && matching(getCellElement(currentRow, col + 1)) || row > 0 && matching(getCellElement(grid[row - 1], col)) || row < grid.length - 1 && matching(getCellElement(grid[row + 1], col)));\n    };\n    var mergeTables = function (startAddress, gridA, gridB, generator, comparator, lockedColumns) {\n      var startRow = startAddress.row;\n      var startCol = startAddress.column;\n      var mergeHeight = gridB.length;\n      var mergeWidth = cellLength(gridB[0]);\n      var endRow = startRow + mergeHeight;\n      var endCol = startCol + mergeWidth + lockedColumns.length;\n      var lockedColumnObj = mapToObject(lockedColumns, always);\n      for (var r = startRow; r < endRow; r++) {\n        var skippedCol = 0;\n        for (var c = startCol; c < endCol; c++) {\n          if (lockedColumnObj[c]) {\n            skippedCol++;\n            continue;\n          }\n          if (isSpanning(gridA, r, c, comparator)) {\n            unmerge(gridA, getCellElement(gridA[r], c), comparator, generator.cell);\n          }\n          var gridBColIndex = c - startCol - skippedCol;\n          var newCell = getCell(gridB[r - startRow], gridBColIndex);\n          var newCellElm = newCell.element;\n          var replacement = generator.replace(newCellElm);\n          mutateCell(gridA[r], c, elementnew(replacement, true, newCell.isLocked));\n        }\n      }\n      return gridA;\n    };\n    var getValidStartAddress = function (currentStartAddress, grid, lockedColumns) {\n      var gridColLength = cellLength(grid[0]);\n      var adjustedRowAddress = extractGridDetails(grid).cols.length + currentStartAddress.row;\n      var possibleColAddresses = range(gridColLength - currentStartAddress.column, function (num) {\n        return num + currentStartAddress.column;\n      });\n      var validColAddress = find(possibleColAddresses, function (num) {\n        return forall(lockedColumns, function (col) {\n          return col !== num;\n        });\n      }).getOr(gridColLength - 1);\n      return {\n        row: adjustedRowAddress,\n        column: validColAddress\n      };\n    };\n    var getLockedColumnsWithinBounds = function (startAddress, grid, lockedColumns) {\n      return filter(lockedColumns, function (colNum) {\n        return colNum >= startAddress.column && colNum <= cellLength(grid[0]) + startAddress.column;\n      });\n    };\n    var merge$1 = function (startAddress, gridA, gridB, generator, comparator) {\n      var lockedColumns = getLockedColumnsFromGrid(gridA);\n      var validStartAddress = getValidStartAddress(startAddress, gridA, lockedColumns);\n      var gridBRows = extractGridDetails(gridB).rows;\n      var lockedColumnsWithinBounds = getLockedColumnsWithinBounds(validStartAddress, gridBRows, lockedColumns);\n      var result = measure(validStartAddress, gridA, gridBRows);\n      return result.map(function (diff) {\n        var delta = __assign(__assign({}, diff), { colDelta: diff.colDelta - lockedColumnsWithinBounds.length });\n        var fittedGrid = tailor(gridA, delta, generator);\n        var newLockedColumns = getLockedColumnsFromGrid(fittedGrid);\n        var newLockedColumnsWithinBounds = getLockedColumnsWithinBounds(validStartAddress, gridBRows, newLockedColumns);\n        return mergeTables(validStartAddress, fittedGrid, gridBRows, generator, comparator, newLockedColumnsWithinBounds);\n      });\n    };\n    var insertCols = function (index, gridA, gridB, generator, comparator) {\n      splitCols(gridA, index, comparator, generator.cell);\n      var delta = measureHeight(gridB, gridA);\n      var fittedNewGrid = tailor(gridB, delta, generator);\n      var secondDelta = measureHeight(gridA, fittedNewGrid);\n      var fittedOldGrid = tailor(gridA, secondDelta, generator);\n      return map(fittedOldGrid, function (gridRow, i) {\n        return addCells(gridRow, index, fittedNewGrid[i].cells);\n      });\n    };\n    var insertRows = function (index, gridA, gridB, generator, comparator) {\n      splitRows(gridA, index, comparator, generator.cell);\n      var locked = getLockedColumnsFromGrid(gridA);\n      var diff = measureWidth(gridA, gridB);\n      var delta = __assign(__assign({}, diff), { colDelta: diff.colDelta - locked.length });\n      var fittedOldGrid = tailor(gridA, delta, generator);\n      var _a = extractGridDetails(fittedOldGrid), oldCols = _a.cols, oldRows = _a.rows;\n      var newLocked = getLockedColumnsFromGrid(fittedOldGrid);\n      var secondDiff = measureWidth(gridB, gridA);\n      var secondDelta = __assign(__assign({}, secondDiff), { colDelta: secondDiff.colDelta + newLocked.length });\n      var fittedGridB = lockedColFill(gridB, generator, newLocked);\n      var fittedNewGrid = tailor(fittedGridB, secondDelta, generator);\n      return oldCols.concat(oldRows.slice(0, index)).concat(fittedNewGrid).concat(oldRows.slice(index, oldRows.length));\n    };\n\n    var insertRowAt = function (grid, index, example, comparator, substitution) {\n      var _a = extractGridDetails(grid), rows = _a.rows, cols = _a.cols;\n      var before = rows.slice(0, index);\n      var after = rows.slice(index);\n      var between = mapCells(rows[example], function (ex, c) {\n        var withinSpan = index > 0 && index < rows.length && comparator(getCellElement(rows[index - 1], c), getCellElement(rows[index], c));\n        var ret = withinSpan ? getCell(rows[index], c) : elementnew(substitution(ex.element, comparator), true, ex.isLocked);\n        return ret;\n      });\n      return cols.concat(before).concat([between]).concat(after);\n    };\n    var getElementFor = function (row, column, section, withinSpan, example, comparator, substitution) {\n      if (section === 'colgroup' || !withinSpan) {\n        var cell = getCell(row, example);\n        return elementnew(substitution(cell.element, comparator), true, false);\n      } else {\n        return getCell(row, column);\n      }\n    };\n    var insertColumnAt = function (grid, index, example, comparator, substitution) {\n      return map(grid, function (row) {\n        var withinSpan = index > 0 && index < cellLength(row) && comparator(getCellElement(row, index - 1), getCellElement(row, index));\n        var sub = getElementFor(row, index, row.section, withinSpan, example, comparator, substitution);\n        return addCell(row, index, sub);\n      });\n    };\n    var deleteColumnsAt = function (grid, columns) {\n      return bind(grid, function (row) {\n        var existingCells = row.cells;\n        var cells = foldr(columns, function (acc, column) {\n          return column >= 0 && column < acc.length ? acc.slice(0, column).concat(acc.slice(column + 1)) : acc;\n        }, existingCells);\n        return cells.length > 0 ? [rowcells(cells, row.section)] : [];\n      });\n    };\n    var deleteRowsAt = function (grid, start, finish) {\n      var _a = extractGridDetails(grid), rows = _a.rows, cols = _a.cols;\n      return cols.concat(rows.slice(0, start)).concat(rows.slice(finish + 1));\n    };\n\n    var replaceIn = function (grid, targets, comparator, substitution) {\n      var isTarget = function (cell) {\n        return exists(targets, function (target) {\n          return comparator(cell.element, target.element);\n        });\n      };\n      return map(grid, function (row) {\n        return mapCells(row, function (cell) {\n          return isTarget(cell) ? elementnew(substitution(cell.element, comparator), true, cell.isLocked) : cell;\n        });\n      });\n    };\n    var notStartRow = function (grid, rowIndex, colIndex, comparator) {\n      return getCellElement(grid[rowIndex], colIndex) !== undefined && (rowIndex > 0 && comparator(getCellElement(grid[rowIndex - 1], colIndex), getCellElement(grid[rowIndex], colIndex)));\n    };\n    var notStartColumn = function (row, index, comparator) {\n      return index > 0 && comparator(getCellElement(row, index - 1), getCellElement(row, index));\n    };\n    var replaceColumn = function (grid, index, comparator, substitution) {\n      var rows = extractGridDetails(grid).rows;\n      var targets = bind(rows, function (row, i) {\n        var alreadyAdded = notStartRow(grid, i, index, comparator) || notStartColumn(row, index, comparator);\n        return alreadyAdded ? [] : [getCell(row, index)];\n      });\n      return replaceIn(grid, targets, comparator, substitution);\n    };\n    var replaceRow = function (grid, index, comparator, substitution) {\n      var rows = extractGridDetails(grid).rows;\n      var targetRow = rows[index];\n      var targets = bind(targetRow.cells, function (item, i) {\n        var alreadyAdded = notStartRow(rows, index, i, comparator) || notStartColumn(targetRow, i, comparator);\n        return alreadyAdded ? [] : [item];\n      });\n      return replaceIn(grid, targets, comparator, substitution);\n    };\n\n    var uniqueColumns = function (details) {\n      var uniqueCheck = function (rest, detail) {\n        var columnExists = exists(rest, function (currentDetail) {\n          return currentDetail.column === detail.column;\n        });\n        return columnExists ? rest : rest.concat([detail]);\n      };\n      return foldl(details, uniqueCheck, []).sort(function (detailA, detailB) {\n        return detailA.column - detailB.column;\n      });\n    };\n\n    var elementToData = function (element) {\n      var colspan = getAttrValue(element, 'colspan', 1);\n      var rowspan = getAttrValue(element, 'rowspan', 1);\n      return {\n        element: element,\n        colspan: colspan,\n        rowspan: rowspan\n      };\n    };\n    var modification = function (generators, toData) {\n      if (toData === void 0) {\n        toData = elementToData;\n      }\n      var position = Cell(Optional.none());\n      var nu = function (data) {\n        switch (name(data.element)) {\n        case 'col':\n          return generators.col(data);\n        default:\n          return generators.cell(data);\n        }\n      };\n      var nuFrom = function (element) {\n        var data = toData(element);\n        return nu(data);\n      };\n      var add = function (element) {\n        var replacement = nuFrom(element);\n        if (position.get().isNone()) {\n          position.set(Optional.some(replacement));\n        }\n        recent = Optional.some({\n          item: element,\n          replacement: replacement\n        });\n        return replacement;\n      };\n      var recent = Optional.none();\n      var getOrInit = function (element, comparator) {\n        return recent.fold(function () {\n          return add(element);\n        }, function (p) {\n          return comparator(element, p.item) ? p.replacement : add(element);\n        });\n      };\n      return {\n        getOrInit: getOrInit,\n        cursor: position.get\n      };\n    };\n    var transform$1 = function (scope, tag) {\n      return function (generators) {\n        var position = Cell(Optional.none());\n        var list = [];\n        var find$1 = function (element, comparator) {\n          return find(list, function (x) {\n            return comparator(x.item, element);\n          });\n        };\n        var makeNew = function (element) {\n          var attrs = { scope: scope };\n          var cell = generators.replace(element, tag, attrs);\n          list.push({\n            item: element,\n            sub: cell\n          });\n          if (position.get().isNone()) {\n            position.set(Optional.some(cell));\n          }\n          return cell;\n        };\n        var replaceOrInit = function (element, comparator) {\n          if (name(element) === 'col') {\n            return element;\n          } else {\n            return find$1(element, comparator).fold(function () {\n              return makeNew(element);\n            }, function (p) {\n              return comparator(element, p.item) ? p.sub : makeNew(element);\n            });\n          }\n        };\n        return {\n          replaceOrInit: replaceOrInit,\n          cursor: position.get\n        };\n      };\n    };\n    var getScopeAttribute = function (cell) {\n      return getOpt(cell, 'scope').map(function (attribute) {\n        return attribute.substr(0, 3);\n      });\n    };\n    var merging = function (generators) {\n      var position = Cell(Optional.none());\n      var unmerge = function (cell) {\n        if (position.get().isNone()) {\n          position.set(Optional.some(cell));\n        }\n        var scope = getScopeAttribute(cell);\n        scope.each(function (attribute) {\n          return set(cell, 'scope', attribute);\n        });\n        return function () {\n          var raw = generators.cell({\n            element: cell,\n            colspan: 1,\n            rowspan: 1\n          });\n          remove$1(raw, 'width');\n          remove$1(cell, 'width');\n          scope.each(function (attribute) {\n            return set(raw, 'scope', attribute);\n          });\n          return raw;\n        };\n      };\n      var merge = function (cells) {\n        var getScopeProperty = function () {\n          var stringAttributes = cat(map(cells, getScopeAttribute));\n          if (stringAttributes.length === 0) {\n            return Optional.none();\n          } else {\n            var baseScope_1 = stringAttributes[0];\n            var scopes_1 = [\n              'row',\n              'col'\n            ];\n            var isMixed = exists(stringAttributes, function (attribute) {\n              return attribute !== baseScope_1 && contains(scopes_1, attribute);\n            });\n            return isMixed ? Optional.none() : Optional.from(baseScope_1);\n          }\n        };\n        remove$1(cells[0], 'width');\n        getScopeProperty().fold(function () {\n          return remove(cells[0], 'scope');\n        }, function (attribute) {\n          return set(cells[0], 'scope', attribute + 'group');\n        });\n        return constant(cells[0]);\n      };\n      return {\n        unmerge: unmerge,\n        merge: merge,\n        cursor: position.get\n      };\n    };\n    var Generators = {\n      modification: modification,\n      transform: transform$1,\n      merging: merging\n    };\n\n    var blockList = [\n      'body',\n      'p',\n      'div',\n      'article',\n      'aside',\n      'figcaption',\n      'figure',\n      'footer',\n      'header',\n      'nav',\n      'section',\n      'ol',\n      'ul',\n      'table',\n      'thead',\n      'tfoot',\n      'tbody',\n      'caption',\n      'tr',\n      'td',\n      'th',\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6',\n      'blockquote',\n      'pre',\n      'address'\n    ];\n    var isList = function (universe, item) {\n      var tagName = universe.property().name(item);\n      return contains([\n        'ol',\n        'ul'\n      ], tagName);\n    };\n    var isBlock = function (universe, item) {\n      var tagName = universe.property().name(item);\n      return contains(blockList, tagName);\n    };\n    var isEmptyTag = function (universe, item) {\n      return contains([\n        'br',\n        'img',\n        'hr',\n        'input'\n      ], universe.property().name(item));\n    };\n\n    var universe$2 = DomUniverse();\n    var isBlock$1 = function (element) {\n      return isBlock(universe$2, element);\n    };\n    var isList$1 = function (element) {\n      return isList(universe$2, element);\n    };\n    var isEmptyTag$1 = function (element) {\n      return isEmptyTag(universe$2, element);\n    };\n\n    var merge$2 = function (cells) {\n      var isBr = function (el) {\n        return name(el) === 'br';\n      };\n      var advancedBr = function (children) {\n        return forall(children, function (c) {\n          return isBr(c) || isText(c) && get$4(c).trim().length === 0;\n        });\n      };\n      var isListItem = function (el) {\n        return name(el) === 'li' || ancestor(el, isList$1).isSome();\n      };\n      var siblingIsBlock = function (el) {\n        return nextSibling(el).map(function (rightSibling) {\n          if (isBlock$1(rightSibling)) {\n            return true;\n          }\n          if (isEmptyTag$1(rightSibling)) {\n            return name(rightSibling) === 'img' ? false : true;\n          }\n          return false;\n        }).getOr(false);\n      };\n      var markCell = function (cell) {\n        return last$1(cell).bind(function (rightEdge) {\n          var rightSiblingIsBlock = siblingIsBlock(rightEdge);\n          return parent(rightEdge).map(function (parent) {\n            return rightSiblingIsBlock === true || isListItem(parent) || isBr(rightEdge) || isBlock$1(parent) && !eq$1(cell, parent) ? [] : [SugarElement.fromTag('br')];\n          });\n        }).getOr([]);\n      };\n      var markContent = function () {\n        var content = bind(cells, function (cell) {\n          var children$1 = children(cell);\n          return advancedBr(children$1) ? [] : children$1.concat(markCell(cell));\n        });\n        return content.length === 0 ? [SugarElement.fromTag('br')] : content;\n      };\n      var contents = markContent();\n      empty(cells[0]);\n      append$1(cells[0], contents);\n    };\n\n    var prune = function (table) {\n      var cells$1 = cells(table);\n      if (cells$1.length === 0) {\n        remove$2(table);\n      }\n    };\n    var outcome = function (grid, cursor) {\n      return {\n        grid: grid,\n        cursor: cursor\n      };\n    };\n    var elementFromGrid = function (grid, row, column) {\n      var rows = extractGridDetails(grid).rows;\n      return findIn(rows, row, column).orThunk(function () {\n        return findIn(rows, 0, 0);\n      });\n    };\n    var findIn = function (grid, row, column) {\n      return Optional.from(grid[row]).bind(function (r) {\n        return Optional.from(r.cells[column]).bind(function (c) {\n          return Optional.from(c.element);\n        });\n      });\n    };\n    var bundle = function (grid, row, column) {\n      var rows = extractGridDetails(grid).rows;\n      return outcome(grid, findIn(rows, row, column));\n    };\n    var uniqueRows = function (details) {\n      var rowCompilation = function (rest, detail) {\n        var rowExists = exists(rest, function (currentDetail) {\n          return currentDetail.row === detail.row;\n        });\n        return rowExists ? rest : rest.concat([detail]);\n      };\n      return foldl(details, rowCompilation, []).sort(function (detailA, detailB) {\n        return detailA.row - detailB.row;\n      });\n    };\n    var opInsertRowsBefore = function (grid, details, comparator, genWrappers) {\n      var targetIndex = details[0].row;\n      var rows = uniqueRows(details);\n      var newGrid = foldr(rows, function (acc, row) {\n        var newG = insertRowAt(acc.grid, targetIndex, row.row + acc.delta, comparator, genWrappers.getOrInit);\n        return {\n          grid: newG,\n          delta: acc.delta + 1\n        };\n      }, {\n        grid: grid,\n        delta: 0\n      }).grid;\n      return bundle(newGrid, targetIndex, details[0].column);\n    };\n    var opInsertRowsAfter = function (grid, details, comparator, genWrappers) {\n      var rows = uniqueRows(details);\n      var target = rows[rows.length - 1];\n      var targetIndex = target.row + target.rowspan;\n      var newGrid = foldr(rows, function (newG, row) {\n        return insertRowAt(newG, targetIndex, row.row, comparator, genWrappers.getOrInit);\n      }, grid);\n      return bundle(newGrid, targetIndex, details[0].column);\n    };\n    var opInsertColumnsBefore = function (grid, extractDetail, comparator, genWrappers) {\n      var details = extractDetail.details;\n      var columns = uniqueColumns(details);\n      var targetIndex = columns[0].column;\n      var newGrid = foldr(columns, function (acc, col) {\n        var newG = insertColumnAt(acc.grid, targetIndex, col.column + acc.delta, comparator, genWrappers.getOrInit);\n        return {\n          grid: newG,\n          delta: acc.delta + 1\n        };\n      }, {\n        grid: grid,\n        delta: 0\n      }).grid;\n      return bundle(newGrid, details[0].row, targetIndex);\n    };\n    var opInsertColumnsAfter = function (grid, extractDetail, comparator, genWrappers) {\n      var details = extractDetail.details;\n      var target = details[details.length - 1];\n      var targetIndex = target.column + target.colspan;\n      var columns = uniqueColumns(details);\n      var newGrid = foldr(columns, function (newG, col) {\n        return insertColumnAt(newG, targetIndex, col.column, comparator, genWrappers.getOrInit);\n      }, grid);\n      return bundle(newGrid, details[0].row, targetIndex);\n    };\n    var opMakeRowHeader = function (grid, detail, comparator, genWrappers) {\n      var newGrid = replaceRow(grid, detail.row, comparator, genWrappers.replaceOrInit);\n      return bundle(newGrid, detail.row, detail.column);\n    };\n    var opMakeRowsHeader = function (initialGrid, details, comparator, genWrappers) {\n      var rows = uniqueRows(details);\n      var replacer = function (currentGrid, row) {\n        return replaceRow(currentGrid, row.row, comparator, genWrappers.replaceOrInit);\n      };\n      var newGrid = foldl(rows, replacer, initialGrid);\n      return bundle(newGrid, details[0].row, details[0].column);\n    };\n    var opMakeColumnHeader = function (initialGrid, detail, comparator, genWrappers) {\n      var newGrid = replaceColumn(initialGrid, detail.column, comparator, genWrappers.replaceOrInit);\n      return bundle(newGrid, detail.row, detail.column);\n    };\n    var opMakeColumnsHeader = function (initialGrid, details, comparator, genWrappers) {\n      var columns = uniqueColumns(details);\n      var replacer = function (currentGrid, column) {\n        return replaceColumn(currentGrid, column.column, comparator, genWrappers.replaceOrInit);\n      };\n      var newGrid = foldl(columns, replacer, initialGrid);\n      return bundle(newGrid, details[0].row, details[0].column);\n    };\n    var opUnmakeRowHeader = function (grid, detail, comparator, genWrappers) {\n      var newGrid = replaceRow(grid, detail.row, comparator, genWrappers.replaceOrInit);\n      return bundle(newGrid, detail.row, detail.column);\n    };\n    var opUnmakeRowsHeader = function (initialGrid, details, comparator, genWrappers) {\n      var rows = uniqueRows(details);\n      var replacer = function (currentGrid, row) {\n        return replaceRow(currentGrid, row.row, comparator, genWrappers.replaceOrInit);\n      };\n      var newGrid = foldl(rows, replacer, initialGrid);\n      return bundle(newGrid, details[0].row, details[0].column);\n    };\n    var opUnmakeColumnHeader = function (initialGrid, detail, comparator, genWrappers) {\n      var newGrid = replaceColumn(initialGrid, detail.column, comparator, genWrappers.replaceOrInit);\n      return bundle(newGrid, detail.row, detail.column);\n    };\n    var opUnmakeColumnsHeader = function (initialGrid, details, comparator, genWrappers) {\n      var columns = uniqueColumns(details);\n      var replacer = function (currentGrid, column) {\n        return replaceColumn(currentGrid, column.column, comparator, genWrappers.replaceOrInit);\n      };\n      var newGrid = foldl(columns, replacer, initialGrid);\n      return bundle(newGrid, details[0].row, details[0].column);\n    };\n    var opEraseColumns = function (grid, extractDetail, _comparator, _genWrappers) {\n      var columns = uniqueColumns(extractDetail.details);\n      var newGrid = deleteColumnsAt(grid, map(columns, function (column) {\n        return column.column;\n      }));\n      var cursor = elementFromGrid(newGrid, columns[0].row, columns[0].column);\n      return outcome(newGrid, cursor);\n    };\n    var opEraseRows = function (grid, details, _comparator, _genWrappers) {\n      var rows = uniqueRows(details);\n      var newGrid = deleteRowsAt(grid, rows[0].row, rows[rows.length - 1].row);\n      var cursor = elementFromGrid(newGrid, details[0].row, details[0].column);\n      return outcome(newGrid, cursor);\n    };\n    var opMergeCells = function (grid, mergable, comparator, genWrappers) {\n      var cells = mergable.cells;\n      merge$2(cells);\n      var newGrid = merge(grid, mergable.bounds, comparator, genWrappers.merge(cells));\n      return outcome(newGrid, Optional.from(cells[0]));\n    };\n    var opUnmergeCells = function (grid, unmergable, comparator, genWrappers) {\n      var unmerge$1 = function (b, cell) {\n        return unmerge(b, cell, comparator, genWrappers.unmerge(cell));\n      };\n      var newGrid = foldr(unmergable, unmerge$1, grid);\n      return outcome(newGrid, Optional.from(unmergable[0]));\n    };\n    var opPasteCells = function (grid, pasteDetails, comparator, _genWrappers) {\n      var gridify = function (table, generators) {\n        var wh = Warehouse.fromTable(table);\n        return toGrid(wh, generators, true);\n      };\n      var gridB = gridify(pasteDetails.clipboard, pasteDetails.generators);\n      var startAddress = address(pasteDetails.row, pasteDetails.column);\n      var mergedGrid = merge$1(startAddress, grid, gridB, pasteDetails.generators, comparator);\n      return mergedGrid.fold(function () {\n        return outcome(grid, Optional.some(pasteDetails.element));\n      }, function (newGrid) {\n        var cursor = elementFromGrid(newGrid, pasteDetails.row, pasteDetails.column);\n        return outcome(newGrid, cursor);\n      });\n    };\n    var gridifyRows = function (rows, generators, context) {\n      var pasteDetails = fromPastedRows(rows, context.section);\n      var wh = Warehouse.generate(pasteDetails);\n      return toGrid(wh, generators, true);\n    };\n    var opPasteColsBefore = function (grid, pasteDetails, comparator, _genWrappers) {\n      var rows = extractGridDetails(grid).rows;\n      var index = pasteDetails.cells[0].column;\n      var context = rows[pasteDetails.cells[0].row];\n      var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n      var mergedGrid = insertCols(index, grid, gridB, pasteDetails.generators, comparator);\n      var cursor = elementFromGrid(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n      return outcome(mergedGrid, cursor);\n    };\n    var opPasteColsAfter = function (grid, pasteDetails, comparator, _genWrappers) {\n      var rows = extractGridDetails(grid).rows;\n      var index = pasteDetails.cells[pasteDetails.cells.length - 1].column + pasteDetails.cells[pasteDetails.cells.length - 1].colspan;\n      var context = rows[pasteDetails.cells[0].row];\n      var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n      var mergedGrid = insertCols(index, grid, gridB, pasteDetails.generators, comparator);\n      var cursor = elementFromGrid(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n      return outcome(mergedGrid, cursor);\n    };\n    var opPasteRowsBefore = function (grid, pasteDetails, comparator, _genWrappers) {\n      var rows = extractGridDetails(grid).rows;\n      var index = pasteDetails.cells[0].row;\n      var context = rows[index];\n      var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n      var mergedGrid = insertRows(index, grid, gridB, pasteDetails.generators, comparator);\n      var cursor = elementFromGrid(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n      return outcome(mergedGrid, cursor);\n    };\n    var opPasteRowsAfter = function (grid, pasteDetails, comparator, _genWrappers) {\n      var rows = extractGridDetails(grid).rows;\n      var index = pasteDetails.cells[pasteDetails.cells.length - 1].row + pasteDetails.cells[pasteDetails.cells.length - 1].rowspan;\n      var context = rows[pasteDetails.cells[0].row];\n      var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);\n      var mergedGrid = insertRows(index, grid, gridB, pasteDetails.generators, comparator);\n      var cursor = elementFromGrid(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);\n      return outcome(mergedGrid, cursor);\n    };\n    var opGetColumnType = function (table, target) {\n      var house = Warehouse.fromTable(table);\n      var details = onCells(house, target);\n      return details.bind(function (selectedCells) {\n        var lastSelectedCell = selectedCells[selectedCells.length - 1];\n        var minColRange = selectedCells[0].column;\n        var maxColRange = lastSelectedCell.column + lastSelectedCell.colspan;\n        var selectedColumnCells = flatten(map(house.all, function (row) {\n          return filter(row.cells, function (cell) {\n            return cell.column >= minColRange && cell.column < maxColRange;\n          });\n        }));\n        return getCellsType(selectedColumnCells, function (cell) {\n          return name(cell.element) === 'th';\n        });\n      }).getOr('');\n    };\n    var getCellsType = function (cells, headerPred) {\n      var headerCells = filter(cells, headerPred);\n      if (headerCells.length === 0) {\n        return Optional.some('td');\n      } else if (headerCells.length === cells.length) {\n        return Optional.some('th');\n      } else {\n        return Optional.none();\n      }\n    };\n    var resize = adjustWidthTo;\n    var adjustAndRedistributeWidths$1 = adjustAndRedistributeWidths;\n    var firstColumnIsLocked = function (_warehouse, details) {\n      return exists(details, function (detail) {\n        return detail.column === 0 && detail.isLocked;\n      });\n    };\n    var lastColumnIsLocked = function (warehouse, details) {\n      return exists(details, function (detail) {\n        return detail.column + detail.colspan >= warehouse.grid.columns && detail.isLocked;\n      });\n    };\n    var getColumnsWidth = function (warehouse, details) {\n      var columns = columns$1(warehouse);\n      var uniqueCols = uniqueColumns(details);\n      return foldl(uniqueCols, function (acc, detail) {\n        var column = columns[detail.column];\n        var colWidth = column.map(getOuter).getOr(0);\n        return acc + colWidth;\n      }, 0);\n    };\n    var insertColumnsExtractor = function (before) {\n      return function (warehouse, target) {\n        return onCells(warehouse, target).filter(function (details) {\n          var checkLocked = before ? firstColumnIsLocked : lastColumnIsLocked;\n          return !checkLocked(warehouse, details);\n        }).map(function (details) {\n          return {\n            details: details,\n            pixelDelta: getColumnsWidth(warehouse, details)\n          };\n        });\n      };\n    };\n    var eraseColumnsExtractor = function (warehouse, target) {\n      return onUnlockedCells(warehouse, target).map(function (details) {\n        return {\n          details: details,\n          pixelDelta: -getColumnsWidth(warehouse, details)\n        };\n      });\n    };\n    var pasteColumnsExtractor = function (before) {\n      return function (warehouse, target) {\n        return onPasteByEditor(warehouse, target).filter(function (details) {\n          var checkLocked = before ? firstColumnIsLocked : lastColumnIsLocked;\n          return !checkLocked(warehouse, details.cells);\n        });\n      };\n    };\n    var insertRowsBefore = run(opInsertRowsBefore, onCells, noop, noop, Generators.modification);\n    var insertRowsAfter = run(opInsertRowsAfter, onCells, noop, noop, Generators.modification);\n    var insertColumnsBefore = run(opInsertColumnsBefore, insertColumnsExtractor(true), adjustAndRedistributeWidths$1, noop, Generators.modification);\n    var insertColumnsAfter = run(opInsertColumnsAfter, insertColumnsExtractor(false), adjustAndRedistributeWidths$1, noop, Generators.modification);\n    var eraseColumns = run(opEraseColumns, eraseColumnsExtractor, adjustAndRedistributeWidths$1, prune, Generators.modification);\n    var eraseRows = run(opEraseRows, onCells, noop, prune, Generators.modification);\n    var makeColumnHeader = run(opMakeColumnHeader, onUnlockedCell, noop, noop, Generators.transform('row', 'th'));\n    var makeColumnsHeader = run(opMakeColumnsHeader, onUnlockedCells, noop, noop, Generators.transform('row', 'th'));\n    var unmakeColumnHeader = run(opUnmakeColumnHeader, onUnlockedCell, noop, noop, Generators.transform(null, 'td'));\n    var unmakeColumnsHeader = run(opUnmakeColumnsHeader, onUnlockedCells, noop, noop, Generators.transform(null, 'td'));\n    var makeRowHeader = run(opMakeRowHeader, onCell, noop, noop, Generators.transform('col', 'th'));\n    var makeRowsHeader = run(opMakeRowsHeader, onCells, noop, noop, Generators.transform('col', 'th'));\n    var unmakeRowHeader = run(opUnmakeRowHeader, onCell, noop, noop, Generators.transform(null, 'td'));\n    var unmakeRowsHeader = run(opUnmakeRowsHeader, onCells, noop, noop, Generators.transform(null, 'td'));\n    var mergeCells = run(opMergeCells, onUnlockedMergable, resize, noop, Generators.merging);\n    var unmergeCells = run(opUnmergeCells, onUnlockedUnmergable, resize, noop, Generators.merging);\n    var pasteCells = run(opPasteCells, onPaste, resize, noop, Generators.modification);\n    var pasteColsBefore = run(opPasteColsBefore, pasteColumnsExtractor(true), noop, noop, Generators.modification);\n    var pasteColsAfter = run(opPasteColsAfter, pasteColumnsExtractor(false), noop, noop, Generators.modification);\n    var pasteRowsBefore = run(opPasteRowsBefore, onPasteByEditor, noop, noop, Generators.modification);\n    var pasteRowsAfter = run(opPasteRowsAfter, onPasteByEditor, noop, noop, Generators.modification);\n    var getColumnType = opGetColumnType;\n\n    var getSection = function (elm) {\n      return getNodeName(elm.parentNode);\n    };\n    var mapSectionNameToType = function (section) {\n      if (section === 'thead') {\n        return 'header';\n      } else if (section === 'tfoot') {\n        return 'footer';\n      } else {\n        return 'body';\n      }\n    };\n    var detectHeaderRow = function (editor, elm) {\n      var isThead = getSection(elm) === 'thead';\n      var areAllCellsThs = !exists(elm.cells, function (c) {\n        return getNodeName(c) !== 'th';\n      });\n      return isThead || areAllCellsThs ? Optional.some({\n        thead: isThead,\n        ths: areAllCellsThs\n      }) : Optional.none();\n    };\n    var getRowType = function (editor, elm) {\n      return mapSectionNameToType(detectHeaderRow(editor, elm).fold(function () {\n        return getSection(elm);\n      }, function (_rowConfig) {\n        return 'thead';\n      }));\n    };\n    var switchRowSection = function (dom, rowElm, newSectionName) {\n      var tableElm = dom.getParent(rowElm, 'table');\n      var oldSectionElm = rowElm.parentNode;\n      var oldSectionName = getNodeName(oldSectionElm);\n      if (newSectionName !== oldSectionName) {\n        var sectionElm_1 = dom.select(newSectionName, tableElm)[0];\n        if (!sectionElm_1) {\n          sectionElm_1 = dom.create(newSectionName);\n          var firstTableChild_1 = tableElm.firstChild;\n          if (newSectionName === 'thead') {\n            last(children$2(SugarElement.fromDom(tableElm), 'caption,colgroup')).fold(function () {\n              return tableElm.insertBefore(sectionElm_1, firstTableChild_1);\n            }, function (c) {\n              return dom.insertAfter(sectionElm_1, c.dom);\n            });\n          } else {\n            tableElm.appendChild(sectionElm_1);\n          }\n        }\n        if (newSectionName === 'tbody' && oldSectionName === 'thead' && sectionElm_1.firstChild) {\n          sectionElm_1.insertBefore(rowElm, sectionElm_1.firstChild);\n        } else {\n          sectionElm_1.appendChild(rowElm);\n        }\n        if (!oldSectionElm.hasChildNodes()) {\n          dom.remove(oldSectionElm);\n        }\n      }\n    };\n    var renameCell = function (editor, cell, newCellType) {\n      if (isNonNullable(newCellType) && getNodeName(cell) !== newCellType) {\n        var newCellElm = editor.dom.rename(cell, newCellType);\n        fireNewCell(editor, newCellElm);\n        return newCellElm;\n      } else {\n        return cell;\n      }\n    };\n    var switchCellType = function (editor, cell, newCellType, scope) {\n      var dom = editor.dom;\n      var newCell = renameCell(editor, cell, newCellType);\n      if (!isUndefined(scope)) {\n        dom.setAttrib(newCell, 'scope', scope);\n      }\n      return newCell;\n    };\n    var switchCellsType = function (editor, cells, newCellType, scope) {\n      return each(cells, function (c) {\n        return switchCellType(editor, c, newCellType, scope);\n      });\n    };\n    var switchSectionType = function (editor, rowElm, newType) {\n      var determineHeaderRowType = function () {\n        var allTableRows = table(SugarElement.fromDom(rowElm.cells[0])).map(function (table) {\n          return rows(table);\n        }).getOr([]);\n        return findMap(allTableRows, function (row) {\n          return detectHeaderRow(editor, row.dom);\n        }).map(function (detectedType) {\n          if (detectedType.thead && detectedType.ths) {\n            return 'sectionCells';\n          } else {\n            return detectedType.thead ? 'section' : 'cells';\n          }\n        }).getOr('section');\n      };\n      var dom = editor.dom;\n      if (newType === 'header') {\n        var headerRowTypeSetting = getTableHeaderType(editor);\n        var headerRowType = headerRowTypeSetting === 'auto' ? determineHeaderRowType() : headerRowTypeSetting;\n        switchCellsType(editor, rowElm.cells, headerRowType === 'section' ? 'td' : 'th', 'col');\n        switchRowSection(dom, rowElm, headerRowType === 'cells' ? 'tbody' : 'thead');\n      } else {\n        switchCellsType(editor, rowElm.cells, 'td', null);\n        switchRowSection(dom, rowElm, newType === 'footer' ? 'tfoot' : 'tbody');\n      }\n    };\n\n    var getSelectionStartCellFallback = function (start) {\n      return table(start).bind(function (table) {\n        return retrieve$1(table, ephemera.firstSelectedSelector);\n      }).fold(function () {\n        return start;\n      }, function (cells) {\n        return cells[0];\n      });\n    };\n    var getSelectionStartFromSelector = function (selector) {\n      return function (start, isRoot) {\n        var startCellName = name(start);\n        var startCell = startCellName === 'col' || startCellName === 'colgroup' ? getSelectionStartCellFallback(start) : start;\n        return closest$1(startCell, selector, isRoot);\n      };\n    };\n    var getSelectionStartCell = getSelectionStartFromSelector('th,td');\n    var getSelectionStartCellOrCaption = getSelectionStartFromSelector('th,td,caption');\n    var getCellsFromSelection = function (start, selections, isRoot) {\n      return getSelectionStartCell(start, isRoot).map(function (_cell) {\n        return selection(selections);\n      }).getOr([]);\n    };\n    var getRowsFromSelection = function (start, selector) {\n      var cellOpt = getSelectionStartCell(start);\n      var rowsOpt = cellOpt.bind(function (cell) {\n        return table(cell);\n      }).map(function (table) {\n        return rows(table);\n      });\n      return lift2(cellOpt, rowsOpt, function (cell, rows) {\n        return filter(rows, function (row) {\n          return exists(fromDom$1(row.dom.cells), function (rowCell) {\n            return get$2(rowCell, selector) === '1' || eq$1(rowCell, cell);\n          });\n        });\n      }).getOr([]);\n    };\n\n    var TableActions = function (editor, lazyWire, selections) {\n      var isTableBody = function (editor) {\n        return name(getBody$1(editor)) === 'table';\n      };\n      var lastRowGuard = function (table) {\n        return isTableBody(editor) === false || getGridSize(table).rows > 1;\n      };\n      var lastColumnGuard = function (table) {\n        return isTableBody(editor) === false || getGridSize(table).columns > 1;\n      };\n      var cloneFormats = getCloneElements(editor);\n      var colMutationOp = isResizeTableColumnResizing(editor) ? noop : halve;\n      var execute = function (operation, guard, mutate, lazyWire, effect) {\n        return function (table, target) {\n          removeDataStyle(table);\n          var wire = lazyWire();\n          var doc = SugarElement.fromDom(editor.getDoc());\n          var generators = cellOperations(mutate, doc, cloneFormats);\n          var sizing = get$9(editor, table);\n          var resizeBehaviour = isResizeTableColumnResizing(editor) ? resizeTable() : preserveTable();\n          return guard(table) ? operation(wire, table, target, generators, sizing, resizeBehaviour).bind(function (result) {\n            each(result.newRows, function (row) {\n              fireNewRow(editor, row.dom);\n            });\n            each(result.newCells, function (cell) {\n              fireNewCell(editor, cell.dom);\n            });\n            return result.cursor.map(function (cell) {\n              var des = freefallRtl$2(cell);\n              var rng = editor.dom.createRng();\n              rng.setStart(des.element.dom, des.offset);\n              rng.setEnd(des.element.dom, des.offset);\n              return {\n                rng: rng,\n                effect: effect\n              };\n            });\n          }) : Optional.none();\n        };\n      };\n      var deleteRow = execute(eraseRows, lastRowGuard, noop, lazyWire, structureModified);\n      var deleteColumn = execute(eraseColumns, lastColumnGuard, noop, lazyWire, structureModified);\n      var insertRowsBefore$1 = execute(insertRowsBefore, always, noop, lazyWire, structureModified);\n      var insertRowsAfter$1 = execute(insertRowsAfter, always, noop, lazyWire, structureModified);\n      var insertColumnsBefore$1 = execute(insertColumnsBefore, always, colMutationOp, lazyWire, structureModified);\n      var insertColumnsAfter$1 = execute(insertColumnsAfter, always, colMutationOp, lazyWire, structureModified);\n      var mergeCells$1 = execute(mergeCells, always, noop, lazyWire, structureModified);\n      var unmergeCells$1 = execute(unmergeCells, always, noop, lazyWire, structureModified);\n      var pasteColsBefore$1 = execute(pasteColsBefore, always, noop, lazyWire, structureModified);\n      var pasteColsAfter$1 = execute(pasteColsAfter, always, noop, lazyWire, structureModified);\n      var pasteRowsBefore$1 = execute(pasteRowsBefore, always, noop, lazyWire, structureModified);\n      var pasteRowsAfter$1 = execute(pasteRowsAfter, always, noop, lazyWire, structureModified);\n      var pasteCells$1 = execute(pasteCells, always, noop, lazyWire, structureModified);\n      var extractType = function (args, validTypes) {\n        return get$1(args, 'type').filter(function (type) {\n          return contains(validTypes, type);\n        });\n      };\n      var setTableCellType = function (editor, args) {\n        return extractType(args, [\n          'td',\n          'th'\n        ]).each(function (type) {\n          var cells = map(getCellsFromSelection(getSelectionStart(editor), selections), function (c) {\n            return c.dom;\n          });\n          switchCellsType(editor, cells, type, null);\n        });\n      };\n      var setTableRowType = function (editor, args) {\n        return extractType(args, [\n          'header',\n          'body',\n          'footer'\n        ]).each(function (type) {\n          map(getRowsFromSelection(getSelectionStart(editor), ephemera.selected), function (row) {\n            return switchSectionType(editor, row.dom, type);\n          });\n        });\n      };\n      var makeColumnsHeader$1 = execute(makeColumnsHeader, always, noop, lazyWire, structureModified);\n      var unmakeColumnsHeader$1 = execute(unmakeColumnsHeader, always, noop, lazyWire, structureModified);\n      var getTableRowType = function (editor) {\n        var rows = getRowsFromSelection(getSelectionStart(editor), ephemera.selected);\n        if (rows.length > 0) {\n          var rowTypes = map(rows, function (r) {\n            return getRowType(editor, r.dom);\n          });\n          var hasHeader = contains(rowTypes, 'header');\n          var hasFooter = contains(rowTypes, 'footer');\n          if (!hasHeader && !hasFooter) {\n            return 'body';\n          } else {\n            var hasBody = contains(rowTypes, 'body');\n            if (hasHeader && !hasBody && !hasFooter) {\n              return 'header';\n            } else if (!hasHeader && !hasBody && hasFooter) {\n              return 'footer';\n            } else {\n              return '';\n            }\n          }\n        }\n      };\n      var getTableCellType = function (editor) {\n        return getCellsType(getCellsFromSelection(getSelectionStart(editor), selections), function (cell) {\n          return name(cell) === 'th';\n        }).getOr('');\n      };\n      var getTableColType = getColumnType;\n      return {\n        deleteRow: deleteRow,\n        deleteColumn: deleteColumn,\n        insertRowsBefore: insertRowsBefore$1,\n        insertRowsAfter: insertRowsAfter$1,\n        insertColumnsBefore: insertColumnsBefore$1,\n        insertColumnsAfter: insertColumnsAfter$1,\n        mergeCells: mergeCells$1,\n        unmergeCells: unmergeCells$1,\n        pasteColsBefore: pasteColsBefore$1,\n        pasteColsAfter: pasteColsAfter$1,\n        pasteRowsBefore: pasteRowsBefore$1,\n        pasteRowsAfter: pasteRowsAfter$1,\n        pasteCells: pasteCells$1,\n        setTableCellType: setTableCellType,\n        setTableRowType: setTableRowType,\n        makeColumnsHeader: makeColumnsHeader$1,\n        unmakeColumnsHeader: unmakeColumnsHeader$1,\n        getTableRowType: getTableRowType,\n        getTableCellType: getTableCellType,\n        getTableColType: getTableColType\n      };\n    };\n\n    var DefaultRenderOptions = {\n      styles: {\n        'border-collapse': 'collapse',\n        'width': '100%'\n      },\n      attributes: { border: '1' },\n      colGroups: false\n    };\n    var tableHeaderCell = function () {\n      return SugarElement.fromTag('th');\n    };\n    var tableCell = function () {\n      return SugarElement.fromTag('td');\n    };\n    var tableColumn = function () {\n      return SugarElement.fromTag('col');\n    };\n    var createRow = function (columns, rowHeaders, columnHeaders, rowIndex) {\n      var tr = SugarElement.fromTag('tr');\n      for (var j = 0; j < columns; j++) {\n        var td = rowIndex < rowHeaders || j < columnHeaders ? tableHeaderCell() : tableCell();\n        if (j < columnHeaders) {\n          set(td, 'scope', 'row');\n        }\n        if (rowIndex < rowHeaders) {\n          set(td, 'scope', 'col');\n        }\n        append(td, SugarElement.fromTag('br'));\n        append(tr, td);\n      }\n      return tr;\n    };\n    var createGroupRow = function (columns) {\n      var columnGroup = SugarElement.fromTag('colgroup');\n      range(columns, function () {\n        return append(columnGroup, tableColumn());\n      });\n      return columnGroup;\n    };\n    var createRows = function (rows, columns, rowHeaders, columnHeaders) {\n      return range(rows, function (r) {\n        return createRow(columns, rowHeaders, columnHeaders, r);\n      });\n    };\n    var render$1 = function (rows, columns, rowHeaders, columnHeaders, headerType, renderOpts) {\n      if (renderOpts === void 0) {\n        renderOpts = DefaultRenderOptions;\n      }\n      var table = SugarElement.fromTag('table');\n      var rowHeadersGoInThead = headerType !== 'cells';\n      setAll$1(table, renderOpts.styles);\n      setAll(table, renderOpts.attributes);\n      if (renderOpts.colGroups) {\n        append(table, createGroupRow(columns));\n      }\n      var actualRowHeaders = Math.min(rows, rowHeaders);\n      if (rowHeadersGoInThead && rowHeaders > 0) {\n        var thead = SugarElement.fromTag('thead');\n        append(table, thead);\n        var theadRowHeaders = headerType === 'sectionCells' ? actualRowHeaders : 0;\n        var theadRows = createRows(rowHeaders, columns, theadRowHeaders, columnHeaders);\n        append$1(thead, theadRows);\n      }\n      var tbody = SugarElement.fromTag('tbody');\n      append(table, tbody);\n      var numRows = rowHeadersGoInThead ? rows - actualRowHeaders : rows;\n      var numRowHeaders = rowHeadersGoInThead ? 0 : rowHeaders;\n      var tbodyRows = createRows(numRows, columns, numRowHeaders, columnHeaders);\n      append$1(tbody, tbodyRows);\n      return table;\n    };\n\n    var get$b = function (element) {\n      return element.dom.innerHTML;\n    };\n    var getOuter$2 = function (element) {\n      var container = SugarElement.fromTag('div');\n      var clone = SugarElement.fromDom(element.dom.cloneNode(true));\n      append(container, clone);\n      return get$b(container);\n    };\n\n    var placeCaretInCell = function (editor, cell) {\n      editor.selection.select(cell.dom, true);\n      editor.selection.collapse(true);\n    };\n    var selectFirstCellInTable = function (editor, tableElm) {\n      descendant$1(tableElm, 'td,th').each(curry(placeCaretInCell, editor));\n    };\n    var fireEvents = function (editor, table) {\n      each(descendants$1(table, 'tr'), function (row) {\n        fireNewRow(editor, row.dom);\n        each(descendants$1(row, 'th,td'), function (cell) {\n          fireNewCell(editor, cell.dom);\n        });\n      });\n    };\n    var isPercentage$1 = function (width) {\n      return isString(width) && width.indexOf('%') !== -1;\n    };\n    var insert$1 = function (editor, columns, rows, colHeaders, rowHeaders) {\n      var defaultStyles = getDefaultStyles(editor);\n      var options = {\n        styles: defaultStyles,\n        attributes: getDefaultAttributes(editor),\n        colGroups: useColumnGroup(editor)\n      };\n      editor.undoManager.ignore(function () {\n        var table = render$1(rows, columns, rowHeaders, colHeaders, getTableHeaderType(editor), options);\n        set(table, 'data-mce-id', '__mce');\n        var html = getOuter$2(table);\n        editor.insertContent(html);\n        editor.addVisual();\n      });\n      return descendant$1(getBody$1(editor), 'table[data-mce-id=\"__mce\"]').map(function (table) {\n        if (isPixelsForced(editor)) {\n          enforcePixels(editor, table);\n        } else if (isResponsiveForced(editor)) {\n          enforceNone(table);\n        } else if (isPercentagesForced(editor) || isPercentage$1(defaultStyles.width)) {\n          enforcePercentage(editor, table);\n        }\n        removeDataStyle(table);\n        remove(table, 'data-mce-id');\n        fireEvents(editor, table);\n        selectFirstCellInTable(editor, table);\n        return table.dom;\n      }).getOr(null);\n    };\n    var insertTableWithDataValidation = function (editor, rows, columns, options, errorMsg) {\n      if (options === void 0) {\n        options = {};\n      }\n      var checkInput = function (val) {\n        return isNumber(val) && val > 0;\n      };\n      if (checkInput(rows) && checkInput(columns)) {\n        var headerRows = options.headerRows || 0;\n        var headerColumns = options.headerColumns || 0;\n        return insert$1(editor, columns, rows, headerColumns, headerRows);\n      } else {\n        console.error(errorMsg);\n        return null;\n      }\n    };\n\n    var getClipboardElements = function (getClipboard) {\n      return function () {\n        return getClipboard().fold(function () {\n          return [];\n        }, function (elems) {\n          return map(elems, function (e) {\n            return e.dom;\n          });\n        });\n      };\n    };\n    var setClipboardElements = function (setClipboard) {\n      return function (elems) {\n        var elmsOpt = elems.length > 0 ? Optional.some(fromDom$1(elems)) : Optional.none();\n        setClipboard(elmsOpt);\n      };\n    };\n    var insertTable = function (editor) {\n      return function (columns, rows, options) {\n        if (options === void 0) {\n          options = {};\n        }\n        var table = insertTableWithDataValidation(editor, rows, columns, options, 'Invalid values for insertTable - rows and columns values are required to insert a table.');\n        editor.undoManager.add();\n        return table;\n      };\n    };\n    var getApi = function (editor, clipboard, resizeHandler, selectionTargets) {\n      return {\n        insertTable: insertTable(editor),\n        setClipboardRows: setClipboardElements(clipboard.setRows),\n        getClipboardRows: getClipboardElements(clipboard.getRows),\n        setClipboardCols: setClipboardElements(clipboard.setColumns),\n        getClipboardCols: getClipboardElements(clipboard.getColumns),\n        resizeHandler: resizeHandler,\n        selectionTargets: selectionTargets\n      };\n    };\n\n    var constrainSpan = function (element, property, value) {\n      var currentColspan = getAttrValue(element, property, 1);\n      if (value === 1 || currentColspan <= 1) {\n        remove(element, property);\n      } else {\n        set(element, property, Math.min(value, currentColspan));\n      }\n    };\n    var generateColGroup = function (house, minColRange, maxColRange) {\n      if (Warehouse.hasColumns(house)) {\n        var colsToCopy = filter(Warehouse.justColumns(house), function (col) {\n          return col.column >= minColRange && col.column < maxColRange;\n        });\n        var copiedCols = map(colsToCopy, function (c) {\n          var clonedCol = deep(c.element);\n          constrainSpan(clonedCol, 'span', maxColRange - minColRange);\n          return clonedCol;\n        });\n        var fakeColgroup = SugarElement.fromTag('colgroup');\n        append$1(fakeColgroup, copiedCols);\n        return [fakeColgroup];\n      } else {\n        return [];\n      }\n    };\n    var generateRows = function (house, minColRange, maxColRange) {\n      return map(house.all, function (row) {\n        var cellsToCopy = filter(row.cells, function (cell) {\n          return cell.column >= minColRange && cell.column < maxColRange;\n        });\n        var copiedCells = map(cellsToCopy, function (cell) {\n          var clonedCell = deep(cell.element);\n          constrainSpan(clonedCell, 'colspan', maxColRange - minColRange);\n          return clonedCell;\n        });\n        var fakeTR = SugarElement.fromTag('tr');\n        append$1(fakeTR, copiedCells);\n        return fakeTR;\n      });\n    };\n    var copyCols = function (table, target) {\n      var house = Warehouse.fromTable(table);\n      var details = onUnlockedCells(house, target);\n      return details.map(function (selectedCells) {\n        var lastSelectedCell = selectedCells[selectedCells.length - 1];\n        var minColRange = selectedCells[0].column;\n        var maxColRange = lastSelectedCell.column + lastSelectedCell.colspan;\n        var fakeColGroups = generateColGroup(house, minColRange, maxColRange);\n        var fakeRows = generateRows(house, minColRange, maxColRange);\n        return __spreadArrays(fakeColGroups, fakeRows);\n      });\n    };\n\n    var copyRows = function (table, target, generators) {\n      var warehouse = Warehouse.fromTable(table);\n      var details = onCells(warehouse, target);\n      return details.bind(function (selectedCells) {\n        var grid = toGrid(warehouse, generators, false);\n        var rows = extractGridDetails(grid).rows;\n        var slicedGrid = rows.slice(selectedCells[0].row, selectedCells[selectedCells.length - 1].row + selectedCells[selectedCells.length - 1].rowspan);\n        var filteredGrid = bind(slicedGrid, function (row) {\n          var newCells = filter(row.cells, function (cell) {\n            return !cell.isLocked;\n          });\n          return newCells.length > 0 ? [__assign(__assign({}, row), { cells: newCells })] : [];\n        });\n        var slicedDetails = toDetailList(filteredGrid, generators);\n        return someIf(slicedDetails.length > 0, slicedDetails);\n      }).map(function (slicedDetails) {\n        return copy$2(slicedDetails);\n      });\n    };\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var getTDTHOverallStyle = function (dom, elm, name) {\n      var cells = dom.select('td,th', elm);\n      var firstChildStyle;\n      var checkChildren = function (firstChildStyle, elms) {\n        for (var i = 0; i < elms.length; i++) {\n          var currentStyle = dom.getStyle(elms[i], name);\n          if (typeof firstChildStyle === 'undefined') {\n            firstChildStyle = currentStyle;\n          }\n          if (firstChildStyle !== currentStyle) {\n            return '';\n          }\n        }\n        return firstChildStyle;\n      };\n      return checkChildren(firstChildStyle, cells);\n    };\n    var applyAlign = function (editor, elm, name) {\n      if (name) {\n        editor.formatter.apply('align' + name, {}, elm);\n      }\n    };\n    var applyVAlign = function (editor, elm, name) {\n      if (name) {\n        editor.formatter.apply('valign' + name, {}, elm);\n      }\n    };\n    var unApplyAlign = function (editor, elm) {\n      global$1.each('left center right'.split(' '), function (name) {\n        editor.formatter.remove('align' + name, {}, elm);\n      });\n    };\n    var unApplyVAlign = function (editor, elm) {\n      global$1.each('top middle bottom'.split(' '), function (name) {\n        editor.formatter.remove('valign' + name, {}, elm);\n      });\n    };\n\n    var isListGroup = function (item) {\n      return hasNonNullableKey(item, 'menu');\n    };\n    var buildListItems = function (inputList, startItems) {\n      var appendItems = function (values, acc) {\n        return acc.concat(map(values, function (item) {\n          var text = item.text || item.title;\n          if (isListGroup(item)) {\n            return {\n              text: text,\n              items: buildListItems(item.menu)\n            };\n          } else {\n            return {\n              text: text,\n              value: item.value\n            };\n          }\n        }));\n      };\n      return appendItems(inputList, startItems || []);\n    };\n    var rgbToHex = function (dom) {\n      return function (value) {\n        return startsWith(value, 'rgb') ? dom.toHex(value) : value;\n      };\n    };\n    var extractAdvancedStyles = function (dom, elm) {\n      var element = SugarElement.fromDom(elm);\n      return {\n        borderwidth: getRaw(element, 'border-width').getOr(''),\n        borderstyle: getRaw(element, 'border-style').getOr(''),\n        bordercolor: getRaw(element, 'border-color').map(rgbToHex(dom)).getOr(''),\n        backgroundcolor: getRaw(element, 'background-color').map(rgbToHex(dom)).getOr('')\n      };\n    };\n    var getSharedValues = function (data) {\n      var baseData = data[0];\n      var comparisonData = data.slice(1);\n      each(comparisonData, function (items) {\n        each(keys(baseData), function (key) {\n          each$1(items, function (itemValue, itemKey) {\n            var comparisonValue = baseData[key];\n            if (comparisonValue !== '' && key === itemKey) {\n              if (comparisonValue !== itemValue) {\n                baseData[key] = '';\n              }\n            }\n          });\n        });\n      });\n      return baseData;\n    };\n    var getAdvancedTab = function (dialogName) {\n      var advTabItems = [\n        {\n          name: 'borderstyle',\n          type: 'listbox',\n          label: 'Border style',\n          items: [\n            {\n              text: 'Select...',\n              value: ''\n            },\n            {\n              text: 'Solid',\n              value: 'solid'\n            },\n            {\n              text: 'Dotted',\n              value: 'dotted'\n            },\n            {\n              text: 'Dashed',\n              value: 'dashed'\n            },\n            {\n              text: 'Double',\n              value: 'double'\n            },\n            {\n              text: 'Groove',\n              value: 'groove'\n            },\n            {\n              text: 'Ridge',\n              value: 'ridge'\n            },\n            {\n              text: 'Inset',\n              value: 'inset'\n            },\n            {\n              text: 'Outset',\n              value: 'outset'\n            },\n            {\n              text: 'None',\n              value: 'none'\n            },\n            {\n              text: 'Hidden',\n              value: 'hidden'\n            }\n          ]\n        },\n        {\n          name: 'bordercolor',\n          type: 'colorinput',\n          label: 'Border color'\n        },\n        {\n          name: 'backgroundcolor',\n          type: 'colorinput',\n          label: 'Background color'\n        }\n      ];\n      var borderWidth = {\n        name: 'borderwidth',\n        type: 'input',\n        label: 'Border width'\n      };\n      var items = dialogName === 'cell' ? [borderWidth].concat(advTabItems) : advTabItems;\n      return {\n        title: 'Advanced',\n        name: 'advanced',\n        items: items\n      };\n    };\n    var getAlignment = function (formats, formatName, editor, elm) {\n      return find(formats, function (name) {\n        return editor.formatter.matchNode(elm, formatName + name);\n      }).getOr('');\n    };\n    var getHAlignment = curry(getAlignment, [\n      'left',\n      'center',\n      'right'\n    ], 'align');\n    var getVAlignment = curry(getAlignment, [\n      'top',\n      'middle',\n      'bottom'\n    ], 'valign');\n    var extractDataFromSettings = function (editor, hasAdvTableTab) {\n      var style = getDefaultStyles(editor);\n      var attrs = getDefaultAttributes(editor);\n      var extractAdvancedStyleData = function (dom) {\n        return {\n          borderstyle: get$1(style, 'border-style').getOr(''),\n          bordercolor: rgbToHex(dom)(get$1(style, 'border-color').getOr('')),\n          backgroundcolor: rgbToHex(dom)(get$1(style, 'background-color').getOr(''))\n        };\n      };\n      var defaultData = {\n        height: '',\n        width: '100%',\n        cellspacing: '',\n        cellpadding: '',\n        caption: false,\n        class: '',\n        align: '',\n        border: ''\n      };\n      var getBorder = function () {\n        var borderWidth = style['border-width'];\n        if (shouldStyleWithCss(editor) && borderWidth) {\n          return { border: borderWidth };\n        }\n        return get$1(attrs, 'border').fold(function () {\n          return {};\n        }, function (border) {\n          return { border: border };\n        });\n      };\n      var advStyle = hasAdvTableTab ? extractAdvancedStyleData(editor.dom) : {};\n      var getCellPaddingCellSpacing = function () {\n        var spacing = get$1(style, 'border-spacing').or(get$1(attrs, 'cellspacing')).fold(function () {\n          return {};\n        }, function (cellspacing) {\n          return { cellspacing: cellspacing };\n        });\n        var padding = get$1(style, 'border-padding').or(get$1(attrs, 'cellpadding')).fold(function () {\n          return {};\n        }, function (cellpadding) {\n          return { cellpadding: cellpadding };\n        });\n        return __assign(__assign({}, spacing), padding);\n      };\n      var data = __assign(__assign(__assign(__assign(__assign(__assign({}, defaultData), style), attrs), advStyle), getBorder()), getCellPaddingCellSpacing());\n      return data;\n    };\n    var extractDataFromTableElement = function (editor, elm, hasAdvTableTab) {\n      var getBorder = function (dom, elm) {\n        var optBorderWidth = getRaw(SugarElement.fromDom(elm), 'border-width');\n        if (shouldStyleWithCss(editor) && optBorderWidth.isSome()) {\n          return optBorderWidth.getOr('');\n        }\n        return dom.getAttrib(elm, 'border') || getTDTHOverallStyle(editor.dom, elm, 'border-width') || getTDTHOverallStyle(editor.dom, elm, 'border');\n      };\n      var dom = editor.dom;\n      return __assign({\n        width: dom.getStyle(elm, 'width') || dom.getAttrib(elm, 'width'),\n        height: dom.getStyle(elm, 'height') || dom.getAttrib(elm, 'height'),\n        cellspacing: dom.getStyle(elm, 'border-spacing') || dom.getAttrib(elm, 'cellspacing'),\n        cellpadding: dom.getAttrib(elm, 'cellpadding') || getTDTHOverallStyle(editor.dom, elm, 'padding'),\n        border: getBorder(dom, elm),\n        caption: !!dom.select('caption', elm)[0],\n        class: dom.getAttrib(elm, 'class', ''),\n        align: getHAlignment(editor, elm)\n      }, hasAdvTableTab ? extractAdvancedStyles(dom, elm) : {});\n    };\n    var extractDataFromRowElement = function (editor, elm, hasAdvancedRowTab) {\n      var dom = editor.dom;\n      return __assign({\n        height: dom.getStyle(elm, 'height') || dom.getAttrib(elm, 'height'),\n        class: dom.getAttrib(elm, 'class', ''),\n        type: getRowType(editor, elm),\n        align: getHAlignment(editor, elm)\n      }, hasAdvancedRowTab ? extractAdvancedStyles(dom, elm) : {});\n    };\n    var extractDataFromCellElement = function (editor, cell, hasAdvancedCellTab, column) {\n      var dom = editor.dom;\n      var colElm = column.getOr(cell);\n      var getStyle = function (element, style) {\n        return dom.getStyle(element, style) || dom.getAttrib(element, style);\n      };\n      return __assign({\n        width: getStyle(colElm, 'width'),\n        height: getStyle(cell, 'height'),\n        scope: dom.getAttrib(cell, 'scope'),\n        celltype: getNodeName(cell),\n        class: dom.getAttrib(cell, 'class', ''),\n        halign: getHAlignment(editor, cell),\n        valign: getVAlignment(editor, cell)\n      }, hasAdvancedCellTab ? extractAdvancedStyles(dom, cell) : {});\n    };\n\n    var getClassList = function (editor) {\n      var classes = buildListItems(getCellClassList(editor));\n      if (classes.length > 0) {\n        return Optional.some({\n          name: 'class',\n          type: 'listbox',\n          label: 'Class',\n          items: classes\n        });\n      }\n      return Optional.none();\n    };\n    var children$3 = [\n      {\n        name: 'width',\n        type: 'input',\n        label: 'Width'\n      },\n      {\n        name: 'height',\n        type: 'input',\n        label: 'Height'\n      },\n      {\n        name: 'celltype',\n        type: 'listbox',\n        label: 'Cell type',\n        items: [\n          {\n            text: 'Cell',\n            value: 'td'\n          },\n          {\n            text: 'Header cell',\n            value: 'th'\n          }\n        ]\n      },\n      {\n        name: 'scope',\n        type: 'listbox',\n        label: 'Scope',\n        items: [\n          {\n            text: 'None',\n            value: ''\n          },\n          {\n            text: 'Row',\n            value: 'row'\n          },\n          {\n            text: 'Column',\n            value: 'col'\n          },\n          {\n            text: 'Row group',\n            value: 'rowgroup'\n          },\n          {\n            text: 'Column group',\n            value: 'colgroup'\n          }\n        ]\n      },\n      {\n        name: 'halign',\n        type: 'listbox',\n        label: 'Horizontal align',\n        items: [\n          {\n            text: 'None',\n            value: ''\n          },\n          {\n            text: 'Left',\n            value: 'left'\n          },\n          {\n            text: 'Center',\n            value: 'center'\n          },\n          {\n            text: 'Right',\n            value: 'right'\n          }\n        ]\n      },\n      {\n        name: 'valign',\n        type: 'listbox',\n        label: 'Vertical align',\n        items: [\n          {\n            text: 'None',\n            value: ''\n          },\n          {\n            text: 'Top',\n            value: 'top'\n          },\n          {\n            text: 'Middle',\n            value: 'middle'\n          },\n          {\n            text: 'Bottom',\n            value: 'bottom'\n          }\n        ]\n      }\n    ];\n    var getItems = function (editor) {\n      return children$3.concat(getClassList(editor).toArray());\n    };\n\n    var modifiers = function (testTruthy) {\n      return function (editor, node) {\n        var dom = editor.dom;\n        var setAttrib = function (attr, value) {\n          if (!testTruthy || value) {\n            dom.setAttrib(node, attr, value);\n          }\n        };\n        var setStyle = function (prop, value) {\n          if (!testTruthy || value) {\n            dom.setStyle(node, prop, value);\n          }\n        };\n        var setFormat = function (formatName, value) {\n          if (!testTruthy || value) {\n            if (value === '') {\n              editor.formatter.remove(formatName, { value: null }, node, true);\n            } else {\n              editor.formatter.apply(formatName, { value: value }, node);\n            }\n          }\n        };\n        return {\n          setAttrib: setAttrib,\n          setStyle: setStyle,\n          setFormat: setFormat\n        };\n      };\n    };\n    var DomModifier = {\n      normal: modifiers(false),\n      ifTruthy: modifiers(true)\n    };\n\n    var getSelectedCells = function (cells) {\n      return table(cells[0]).map(function (table) {\n        var warehouse = Warehouse.fromTable(table);\n        var allCells = Warehouse.justCells(warehouse);\n        var filtered = filter(allCells, function (cellA) {\n          return exists(cells, function (cellB) {\n            return eq$1(cellA.element, cellB);\n          });\n        });\n        return map(filtered, function (cell) {\n          return {\n            element: cell.element.dom,\n            column: Warehouse.getColumnAt(warehouse, cell.column).map(function (col) {\n              return col.element.dom;\n            })\n          };\n        });\n      });\n    };\n    var updateSimpleProps = function (modifier, colModifier, data) {\n      modifier.setAttrib('scope', data.scope);\n      modifier.setAttrib('class', data.class);\n      modifier.setStyle('height', addPxSuffix(data.height));\n      colModifier.setStyle('width', addPxSuffix(data.width));\n    };\n    var updateAdvancedProps = function (modifier, data) {\n      modifier.setFormat('tablecellbackgroundcolor', data.backgroundcolor);\n      modifier.setFormat('tablecellbordercolor', data.bordercolor);\n      modifier.setFormat('tablecellborderstyle', data.borderstyle);\n      modifier.setFormat('tablecellborderwidth', addPxSuffix(data.borderwidth));\n    };\n    var applyCellData = function (editor, cells, oldData, data) {\n      var isSingleCell = cells.length === 1;\n      var modifiedData = filter$1(data, function (value, key) {\n        return oldData[key] !== value;\n      });\n      if (size(modifiedData) > 0 && cells.length >= 1) {\n        var tableOpt = table(cells[0]);\n        getSelectedCells(cells).each(function (selectedCells) {\n          each(selectedCells, function (item) {\n            var cellElm = switchCellType(editor, item.element, data.celltype);\n            var modifier = isSingleCell ? DomModifier.normal(editor, cellElm) : DomModifier.ifTruthy(editor, cellElm);\n            var colModifier = item.column.map(function (col) {\n              return isSingleCell ? DomModifier.normal(editor, col) : DomModifier.ifTruthy(editor, col);\n            }).getOr(modifier);\n            updateSimpleProps(modifier, colModifier, data);\n            if (hasAdvancedCellTab(editor)) {\n              updateAdvancedProps(modifier, data);\n            }\n            if (isSingleCell) {\n              unApplyAlign(editor, cellElm);\n              unApplyVAlign(editor, cellElm);\n            }\n            if (data.halign) {\n              applyAlign(editor, cellElm, data.halign);\n            }\n            if (data.valign) {\n              applyVAlign(editor, cellElm, data.valign);\n            }\n          });\n        });\n        var styleModified_1 = size(filter$1(modifiedData, function (_value, key) {\n          return key !== 'scope' && key !== 'celltype';\n        })) > 0;\n        tableOpt.each(function (table) {\n          return fireTableModified(editor, table.dom, {\n            structure: has(modifiedData, 'celltype'),\n            style: styleModified_1\n          });\n        });\n      }\n    };\n    var onSubmitCellForm = function (editor, cells, oldData, api) {\n      var data = api.getData();\n      api.close();\n      editor.undoManager.transact(function () {\n        applyCellData(editor, cells, oldData, data);\n        editor.focus();\n      });\n    };\n    var getData = function (editor, cells) {\n      var cellsData = getSelectedCells(cells).map(function (selectedCells) {\n        return map(selectedCells, function (item) {\n          return extractDataFromCellElement(editor, item.element, hasAdvancedCellTab(editor), item.column);\n        });\n      });\n      return getSharedValues(cellsData.getOrDie());\n    };\n    var open = function (editor, selections) {\n      var cells = getCellsFromSelection(getSelectionStart(editor), selections);\n      if (cells.length === 0) {\n        return;\n      }\n      var data = getData(editor, cells);\n      var dialogTabPanel = {\n        type: 'tabpanel',\n        tabs: [\n          {\n            title: 'General',\n            name: 'general',\n            items: getItems(editor)\n          },\n          getAdvancedTab('cell')\n        ]\n      };\n      var dialogPanel = {\n        type: 'panel',\n        items: [{\n            type: 'grid',\n            columns: 2,\n            items: getItems(editor)\n          }]\n      };\n      editor.windowManager.open({\n        title: 'Cell Properties',\n        size: 'normal',\n        body: hasAdvancedCellTab(editor) ? dialogTabPanel : dialogPanel,\n        buttons: [\n          {\n            type: 'cancel',\n            name: 'cancel',\n            text: 'Cancel'\n          },\n          {\n            type: 'submit',\n            name: 'save',\n            text: 'Save',\n            primary: true\n          }\n        ],\n        initialData: data,\n        onSubmit: curry(onSubmitCellForm, editor, cells, data)\n      });\n    };\n\n    var getClassList$1 = function (editor) {\n      var classes = buildListItems(getRowClassList(editor));\n      if (classes.length > 0) {\n        return Optional.some({\n          name: 'class',\n          type: 'listbox',\n          label: 'Class',\n          items: classes\n        });\n      }\n      return Optional.none();\n    };\n    var formChildren = [\n      {\n        type: 'listbox',\n        name: 'type',\n        label: 'Row type',\n        items: [\n          {\n            text: 'Header',\n            value: 'header'\n          },\n          {\n            text: 'Body',\n            value: 'body'\n          },\n          {\n            text: 'Footer',\n            value: 'footer'\n          }\n        ]\n      },\n      {\n        type: 'listbox',\n        name: 'align',\n        label: 'Alignment',\n        items: [\n          {\n            text: 'None',\n            value: ''\n          },\n          {\n            text: 'Left',\n            value: 'left'\n          },\n          {\n            text: 'Center',\n            value: 'center'\n          },\n          {\n            text: 'Right',\n            value: 'right'\n          }\n        ]\n      },\n      {\n        label: 'Height',\n        name: 'height',\n        type: 'input'\n      }\n    ];\n    var getItems$1 = function (editor) {\n      return formChildren.concat(getClassList$1(editor).toArray());\n    };\n\n    var updateSimpleProps$1 = function (modifier, data) {\n      modifier.setAttrib('class', data.class);\n      modifier.setStyle('height', addPxSuffix(data.height));\n    };\n    var updateAdvancedProps$1 = function (modifier, data) {\n      modifier.setStyle('background-color', data.backgroundcolor);\n      modifier.setStyle('border-color', data.bordercolor);\n      modifier.setStyle('border-style', data.borderstyle);\n    };\n    var applyRowData = function (editor, rows, oldData, data) {\n      var isSingleRow = rows.length === 1;\n      var modifiedData = filter$1(data, function (value, key) {\n        return oldData[key] !== value;\n      });\n      if (size(modifiedData) > 0) {\n        each(rows, function (rowElm) {\n          if (data.type !== getNodeName(rowElm.parentNode)) {\n            switchSectionType(editor, rowElm, data.type);\n          }\n          var modifier = isSingleRow ? DomModifier.normal(editor, rowElm) : DomModifier.ifTruthy(editor, rowElm);\n          updateSimpleProps$1(modifier, data);\n          if (hasAdvancedRowTab(editor)) {\n            updateAdvancedProps$1(modifier, data);\n          }\n          if (data.align !== oldData.align) {\n            unApplyAlign(editor, rowElm);\n            applyAlign(editor, rowElm, data.align);\n          }\n        });\n        var typeModified_1 = has(modifiedData, 'type');\n        var styleModified_1 = typeModified_1 ? size(modifiedData) > 1 : true;\n        table(SugarElement.fromDom(rows[0])).each(function (table) {\n          return fireTableModified(editor, table.dom, {\n            structure: typeModified_1,\n            style: styleModified_1\n          });\n        });\n      }\n    };\n    var onSubmitRowForm = function (editor, rows, oldData, api) {\n      var data = api.getData();\n      api.close();\n      editor.undoManager.transact(function () {\n        applyRowData(editor, rows, oldData, data);\n        editor.focus();\n      });\n    };\n    var open$1 = function (editor) {\n      var rows = getRowsFromSelection(getSelectionStart(editor), ephemera.selected);\n      if (rows.length === 0) {\n        return;\n      }\n      var rowsData = map(rows, function (rowElm) {\n        return extractDataFromRowElement(editor, rowElm.dom, hasAdvancedRowTab(editor));\n      });\n      var data = getSharedValues(rowsData);\n      var dialogTabPanel = {\n        type: 'tabpanel',\n        tabs: [\n          {\n            title: 'General',\n            name: 'general',\n            items: getItems$1(editor)\n          },\n          getAdvancedTab('row')\n        ]\n      };\n      var dialogPanel = {\n        type: 'panel',\n        items: [{\n            type: 'grid',\n            columns: 2,\n            items: getItems$1(editor)\n          }]\n      };\n      editor.windowManager.open({\n        title: 'Row Properties',\n        size: 'normal',\n        body: hasAdvancedRowTab(editor) ? dialogTabPanel : dialogPanel,\n        buttons: [\n          {\n            type: 'cancel',\n            name: 'cancel',\n            text: 'Cancel'\n          },\n          {\n            type: 'submit',\n            name: 'save',\n            text: 'Save',\n            primary: true\n          }\n        ],\n        initialData: data,\n        onSubmit: curry(onSubmitRowForm, editor, map(rows, function (r) {\n          return r.dom;\n        }), data)\n      });\n    };\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.Env');\n\n    var getItems$2 = function (editor, classes, insertNewTable) {\n      var rowColCountItems = !insertNewTable ? [] : [\n        {\n          type: 'input',\n          name: 'cols',\n          label: 'Cols',\n          inputMode: 'numeric'\n        },\n        {\n          type: 'input',\n          name: 'rows',\n          label: 'Rows',\n          inputMode: 'numeric'\n        }\n      ];\n      var alwaysItems = [\n        {\n          type: 'input',\n          name: 'width',\n          label: 'Width'\n        },\n        {\n          type: 'input',\n          name: 'height',\n          label: 'Height'\n        }\n      ];\n      var appearanceItems = hasAppearanceOptions(editor) ? [\n        {\n          type: 'input',\n          name: 'cellspacing',\n          label: 'Cell spacing',\n          inputMode: 'numeric'\n        },\n        {\n          type: 'input',\n          name: 'cellpadding',\n          label: 'Cell padding',\n          inputMode: 'numeric'\n        },\n        {\n          type: 'input',\n          name: 'border',\n          label: 'Border width'\n        },\n        {\n          type: 'label',\n          label: 'Caption',\n          items: [{\n              type: 'checkbox',\n              name: 'caption',\n              label: 'Show caption'\n            }]\n        }\n      ] : [];\n      var alignmentItem = [{\n          type: 'listbox',\n          name: 'align',\n          label: 'Alignment',\n          items: [\n            {\n              text: 'None',\n              value: ''\n            },\n            {\n              text: 'Left',\n              value: 'left'\n            },\n            {\n              text: 'Center',\n              value: 'center'\n            },\n            {\n              text: 'Right',\n              value: 'right'\n            }\n          ]\n        }];\n      var classListItem = classes.length > 0 ? [{\n          type: 'listbox',\n          name: 'class',\n          label: 'Class',\n          items: classes\n        }] : [];\n      return rowColCountItems.concat(alwaysItems).concat(appearanceItems).concat(alignmentItem).concat(classListItem);\n    };\n\n    var styleTDTH = function (dom, elm, name, value) {\n      if (elm.tagName === 'TD' || elm.tagName === 'TH') {\n        if (isString(name)) {\n          dom.setStyle(elm, name, value);\n        } else {\n          dom.setStyle(elm, name);\n        }\n      } else {\n        if (elm.children) {\n          for (var i = 0; i < elm.children.length; i++) {\n            styleTDTH(dom, elm.children[i], name, value);\n          }\n        }\n      }\n    };\n    var applyDataToElement = function (editor, tableElm, data) {\n      var dom = editor.dom;\n      var attrs = {};\n      var styles = {};\n      attrs.class = data.class;\n      styles.height = addPxSuffix(data.height);\n      if (dom.getAttrib(tableElm, 'width') && !shouldStyleWithCss(editor)) {\n        attrs.width = removePxSuffix(data.width);\n      } else {\n        styles.width = addPxSuffix(data.width);\n      }\n      if (shouldStyleWithCss(editor)) {\n        styles['border-width'] = addPxSuffix(data.border);\n        styles['border-spacing'] = addPxSuffix(data.cellspacing);\n      } else {\n        attrs.border = data.border;\n        attrs.cellpadding = data.cellpadding;\n        attrs.cellspacing = data.cellspacing;\n      }\n      if (shouldStyleWithCss(editor) && tableElm.children) {\n        for (var i = 0; i < tableElm.children.length; i++) {\n          styleTDTH(dom, tableElm.children[i], {\n            'border-width': addPxSuffix(data.border),\n            'padding': addPxSuffix(data.cellpadding)\n          });\n          if (hasAdvancedTableTab(editor)) {\n            styleTDTH(dom, tableElm.children[i], { 'border-color': data.bordercolor });\n          }\n        }\n      }\n      if (hasAdvancedTableTab(editor)) {\n        styles['background-color'] = data.backgroundcolor;\n        styles['border-color'] = data.bordercolor;\n        styles['border-style'] = data.borderstyle;\n      }\n      attrs.style = dom.serializeStyle(__assign(__assign({}, getDefaultStyles(editor)), styles));\n      dom.setAttribs(tableElm, __assign(__assign({}, getDefaultAttributes(editor)), attrs));\n    };\n    var onSubmitTableForm = function (editor, tableElm, oldData, api) {\n      var dom = editor.dom;\n      var captionElm;\n      var data = api.getData();\n      var modifiedData = filter$1(data, function (value, key) {\n        return oldData[key] !== value;\n      });\n      api.close();\n      if (data.class === '') {\n        delete data.class;\n      }\n      editor.undoManager.transact(function () {\n        if (!tableElm) {\n          var cols = parseInt(data.cols, 10) || 1;\n          var rows = parseInt(data.rows, 10) || 1;\n          tableElm = insert$1(editor, cols, rows, 0, 0);\n        }\n        if (size(modifiedData) > 0) {\n          applyDataToElement(editor, tableElm, data);\n          captionElm = dom.select('caption', tableElm)[0];\n          if (captionElm && !data.caption) {\n            dom.remove(captionElm);\n          }\n          if (!captionElm && data.caption) {\n            captionElm = dom.create('caption');\n            captionElm.innerHTML = !global$2.ie ? '<br data-mce-bogus=\"1\"/>' : nbsp;\n            tableElm.insertBefore(captionElm, tableElm.firstChild);\n          }\n          if (data.align === '') {\n            unApplyAlign(editor, tableElm);\n          } else {\n            applyAlign(editor, tableElm, data.align);\n          }\n        }\n        editor.focus();\n        editor.addVisual();\n        if (size(modifiedData) > 0) {\n          var captionModified = has(modifiedData, 'caption');\n          var styleModified = captionModified ? size(modifiedData) > 1 : true;\n          fireTableModified(editor, tableElm, {\n            structure: captionModified,\n            style: styleModified\n          });\n        }\n      });\n    };\n    var open$2 = function (editor, insertNewTable) {\n      var dom = editor.dom;\n      var tableElm;\n      var data = extractDataFromSettings(editor, hasAdvancedTableTab(editor));\n      if (insertNewTable === false) {\n        tableElm = dom.getParent(editor.selection.getStart(), 'table', editor.getBody());\n        if (tableElm) {\n          data = extractDataFromTableElement(editor, tableElm, hasAdvancedTableTab(editor));\n        } else {\n          if (hasAdvancedTableTab(editor)) {\n            data.borderstyle = '';\n            data.bordercolor = '';\n            data.backgroundcolor = '';\n          }\n        }\n      } else {\n        data.cols = '1';\n        data.rows = '1';\n        if (hasAdvancedTableTab(editor)) {\n          data.borderstyle = '';\n          data.bordercolor = '';\n          data.backgroundcolor = '';\n        }\n      }\n      var classes = buildListItems(getTableClassList(editor));\n      if (classes.length > 0) {\n        if (data.class) {\n          data.class = data.class.replace(/\\s*mce\\-item\\-table\\s*/g, '');\n        }\n      }\n      var generalPanel = {\n        type: 'grid',\n        columns: 2,\n        items: getItems$2(editor, classes, insertNewTable)\n      };\n      var nonAdvancedForm = function () {\n        return {\n          type: 'panel',\n          items: [generalPanel]\n        };\n      };\n      var advancedForm = function () {\n        return {\n          type: 'tabpanel',\n          tabs: [\n            {\n              title: 'General',\n              name: 'general',\n              items: [generalPanel]\n            },\n            getAdvancedTab('table')\n          ]\n        };\n      };\n      var dialogBody = hasAdvancedTableTab(editor) ? advancedForm() : nonAdvancedForm();\n      editor.windowManager.open({\n        title: 'Table Properties',\n        size: 'normal',\n        body: dialogBody,\n        onSubmit: curry(onSubmitTableForm, editor, tableElm, data),\n        buttons: [\n          {\n            type: 'cancel',\n            name: 'cancel',\n            text: 'Cancel'\n          },\n          {\n            type: 'submit',\n            name: 'save',\n            text: 'Save',\n            primary: true\n          }\n        ],\n        initialData: data\n      });\n    };\n\n    var getSelectionStartCellOrCaption$1 = function (editor) {\n      return getSelectionStartCellOrCaption(getSelectionStart(editor), getIsRoot(editor));\n    };\n    var getSelectionStartCell$1 = function (editor) {\n      return getSelectionStartCell(getSelectionStart(editor), getIsRoot(editor));\n    };\n    var registerCommands = function (editor, actions, cellSelection, selections, clipboard) {\n      var isRoot = getIsRoot(editor);\n      var eraseTable = function () {\n        return getSelectionStartCellOrCaption$1(editor).each(function (cellOrCaption) {\n          table(cellOrCaption, isRoot).filter(not(isRoot)).each(function (table) {\n            var cursor = SugarElement.fromText('');\n            after(table, cursor);\n            remove$2(table);\n            if (editor.dom.isEmpty(editor.getBody())) {\n              editor.setContent('');\n              editor.selection.setCursorLocation();\n            } else {\n              var rng = editor.dom.createRng();\n              rng.setStart(cursor.dom, 0);\n              rng.setEnd(cursor.dom, 0);\n              editor.selection.setRng(rng);\n              editor.nodeChanged();\n            }\n          });\n        });\n      };\n      var setSizingMode = function (sizing) {\n        return getSelectionStartCellOrCaption$1(editor).each(function (cellOrCaption) {\n          var isForcedSizing = isResponsiveForced(editor) || isPixelsForced(editor) || isPercentagesForced(editor);\n          if (!isForcedSizing) {\n            table(cellOrCaption, isRoot).each(function (table) {\n              if (sizing === 'relative' && !isPercentSizing$1(table)) {\n                enforcePercentage(editor, table);\n              } else if (sizing === 'fixed' && !isPixelSizing$1(table)) {\n                enforcePixels(editor, table);\n              } else if (sizing === 'responsive' && !isNoneSizing$1(table)) {\n                enforceNone(table);\n              }\n              removeDataStyle(table);\n              fireTableModified(editor, table.dom, structureModified);\n            });\n          }\n        });\n      };\n      var getTableFromCell = function (cell) {\n        return table(cell, isRoot);\n      };\n      var postExecute = function (table) {\n        return function (data) {\n          editor.selection.setRng(data.rng);\n          editor.focus();\n          cellSelection.clear(table);\n          removeDataStyle(table);\n          fireTableModified(editor, table.dom, data.effect);\n        };\n      };\n      var actOnSelection = function (execute) {\n        return getSelectionStartCell$1(editor).each(function (cell) {\n          getTableFromCell(cell).each(function (table) {\n            var targets = forMenu(selections, table, cell);\n            execute(table, targets).each(postExecute(table));\n          });\n        });\n      };\n      var copyRowSelection = function () {\n        return getSelectionStartCell$1(editor).map(function (cell) {\n          return getTableFromCell(cell).bind(function (table) {\n            var targets = forMenu(selections, table, cell);\n            var generators = cellOperations(noop, SugarElement.fromDom(editor.getDoc()), Optional.none());\n            return copyRows(table, targets, generators);\n          });\n        });\n      };\n      var copyColSelection = function () {\n        return getSelectionStartCell$1(editor).map(function (cell) {\n          return getTableFromCell(cell).bind(function (table) {\n            var targets = forMenu(selections, table, cell);\n            return copyCols(table, targets);\n          });\n        });\n      };\n      var pasteOnSelection = function (execute, getRows) {\n        return getRows().each(function (rows) {\n          var clonedRows = map(rows, function (row) {\n            return deep(row);\n          });\n          getSelectionStartCell$1(editor).each(function (cell) {\n            return getTableFromCell(cell).each(function (table) {\n              var generators = paste(SugarElement.fromDom(editor.getDoc()));\n              var targets = pasteRows(selections, cell, clonedRows, generators);\n              execute(table, targets).each(postExecute(table));\n            });\n          });\n        });\n      };\n      each$1({\n        mceTableSplitCells: function () {\n          return actOnSelection(actions.unmergeCells);\n        },\n        mceTableMergeCells: function () {\n          return actOnSelection(actions.mergeCells);\n        },\n        mceTableInsertRowBefore: function () {\n          return actOnSelection(actions.insertRowsBefore);\n        },\n        mceTableInsertRowAfter: function () {\n          return actOnSelection(actions.insertRowsAfter);\n        },\n        mceTableInsertColBefore: function () {\n          return actOnSelection(actions.insertColumnsBefore);\n        },\n        mceTableInsertColAfter: function () {\n          return actOnSelection(actions.insertColumnsAfter);\n        },\n        mceTableDeleteCol: function () {\n          return actOnSelection(actions.deleteColumn);\n        },\n        mceTableDeleteRow: function () {\n          return actOnSelection(actions.deleteRow);\n        },\n        mceTableCutCol: function (_grid) {\n          return copyColSelection().each(function (selection) {\n            clipboard.setColumns(selection);\n            actOnSelection(actions.deleteColumn);\n          });\n        },\n        mceTableCutRow: function (_grid) {\n          return copyRowSelection().each(function (selection) {\n            clipboard.setRows(selection);\n            actOnSelection(actions.deleteRow);\n          });\n        },\n        mceTableCopyCol: function (_grid) {\n          return copyColSelection().each(function (selection) {\n            return clipboard.setColumns(selection);\n          });\n        },\n        mceTableCopyRow: function (_grid) {\n          return copyRowSelection().each(function (selection) {\n            return clipboard.setRows(selection);\n          });\n        },\n        mceTablePasteColBefore: function (_grid) {\n          return pasteOnSelection(actions.pasteColsBefore, clipboard.getColumns);\n        },\n        mceTablePasteColAfter: function (_grid) {\n          return pasteOnSelection(actions.pasteColsAfter, clipboard.getColumns);\n        },\n        mceTablePasteRowBefore: function (_grid) {\n          return pasteOnSelection(actions.pasteRowsBefore, clipboard.getRows);\n        },\n        mceTablePasteRowAfter: function (_grid) {\n          return pasteOnSelection(actions.pasteRowsAfter, clipboard.getRows);\n        },\n        mceTableDelete: eraseTable,\n        mceTableSizingMode: function (ui, sizing) {\n          return setSizingMode(sizing);\n        }\n      }, function (func, name) {\n        return editor.addCommand(name, func);\n      });\n      var fireTableModifiedForSelection = function (editor, tableOpt) {\n        tableOpt.each(function (table) {\n          fireTableModified(editor, table.dom, structureModified);\n        });\n      };\n      each$1({\n        mceTableCellType: function (_ui, args) {\n          var tableOpt = table(getSelectionStart(editor), isRoot);\n          actions.setTableCellType(editor, args);\n          fireTableModifiedForSelection(editor, tableOpt);\n        },\n        mceTableRowType: function (_ui, args) {\n          var tableOpt = table(getSelectionStart(editor), isRoot);\n          actions.setTableRowType(editor, args);\n          fireTableModifiedForSelection(editor, tableOpt);\n        }\n      }, function (func, name) {\n        return editor.addCommand(name, func);\n      });\n      editor.addCommand('mceTableColType', function (_ui, args) {\n        return get$1(args, 'type').each(function (type) {\n          return actOnSelection(type === 'th' ? actions.makeColumnsHeader : actions.unmakeColumnsHeader);\n        });\n      });\n      each$1({\n        mceTableProps: curry(open$2, editor, false),\n        mceTableRowProps: curry(open$1, editor),\n        mceTableCellProps: curry(open, editor, selections)\n      }, function (func, name) {\n        return editor.addCommand(name, function () {\n          return func();\n        });\n      });\n      editor.addCommand('mceInsertTable', function (_ui, args) {\n        if (isObject(args) && keys(args).length > 0) {\n          insertTableWithDataValidation(editor, args.rows, args.columns, args.options, 'Invalid values for mceInsertTable - rows and columns values are required to insert a table.');\n        } else {\n          open$2(editor, true);\n        }\n      });\n      editor.addCommand('mceTableApplyCellStyle', function (_ui, args) {\n        var getFormatName = function (style) {\n          return 'tablecell' + style.toLowerCase().replace('-', '');\n        };\n        if (!isObject(args)) {\n          return;\n        }\n        var cells = getCellsFromSelection(getSelectionStart(editor), selections, isRoot);\n        if (cells.length === 0) {\n          return;\n        }\n        var validArgs = filter$1(args, function (value, style) {\n          return editor.formatter.has(getFormatName(style)) && isString(value);\n        });\n        if (isEmpty(validArgs)) {\n          return;\n        }\n        each$1(validArgs, function (value, style) {\n          each(cells, function (cell) {\n            DomModifier.normal(editor, cell.dom).setFormat(getFormatName(style), value);\n          });\n        });\n        getTableFromCell(cells[0]).each(function (table) {\n          return fireTableModified(editor, table.dom, styleModified);\n        });\n      });\n    };\n\n    var registerQueryCommands = function (editor, actions, selections) {\n      var isRoot = getIsRoot(editor);\n      var getTableFromCell = function (cell) {\n        return table(cell, isRoot);\n      };\n      each$1({\n        mceTableRowType: function () {\n          return actions.getTableRowType(editor);\n        },\n        mceTableCellType: function () {\n          return actions.getTableCellType(editor);\n        },\n        mceTableColType: function () {\n          return getSelectionStartCell(getSelectionStart(editor)).bind(function (cell) {\n            return getTableFromCell(cell).map(function (table) {\n              var targets = forMenu(selections, table, cell);\n              return actions.getTableColType(table, targets);\n            });\n          }).getOr('');\n        }\n      }, function (func, name) {\n        return editor.addQueryValueHandler(name, func);\n      });\n    };\n\n    var Clipboard = function () {\n      var rows = Cell(Optional.none());\n      var cols = Cell(Optional.none());\n      var clearClipboard = function (clipboard) {\n        clipboard.set(Optional.none());\n      };\n      return {\n        getRows: rows.get,\n        setRows: function (r) {\n          rows.set(r);\n          clearClipboard(cols);\n        },\n        clearRows: function () {\n          return clearClipboard(rows);\n        },\n        getColumns: cols.get,\n        setColumns: function (c) {\n          cols.set(c);\n          clearClipboard(rows);\n        },\n        clearColumns: function () {\n          return clearClipboard(cols);\n        }\n      };\n    };\n\n    var cellFormats = {\n      tablecellbackgroundcolor: {\n        selector: 'td,th',\n        styles: { backgroundColor: '%value' },\n        remove_similar: true\n      },\n      tablecellbordercolor: {\n        selector: 'td,th',\n        styles: { borderColor: '%value' },\n        remove_similar: true\n      },\n      tablecellborderstyle: {\n        selector: 'td,th',\n        styles: { borderStyle: '%value' },\n        remove_similar: true\n      },\n      tablecellborderwidth: {\n        selector: 'td,th',\n        styles: { borderWidth: '%value' },\n        remove_similar: true\n      }\n    };\n    var registerFormats = function (editor) {\n      editor.formatter.register(cellFormats);\n    };\n\n    var adt$2 = Adt.generate([\n      { none: ['current'] },\n      { first: ['current'] },\n      {\n        middle: [\n          'current',\n          'target'\n        ]\n      },\n      { last: ['current'] }\n    ]);\n    var none$2 = function (current) {\n      if (current === void 0) {\n        current = undefined;\n      }\n      return adt$2.none(current);\n    };\n    var CellLocation = __assign(__assign({}, adt$2), { none: none$2 });\n\n    var detect$5 = function (current, isRoot) {\n      return table(current, isRoot).bind(function (table) {\n        var all = cells(table);\n        var index = findIndex(all, function (x) {\n          return eq$1(current, x);\n        });\n        return index.map(function (index) {\n          return {\n            index: index,\n            all: all\n          };\n        });\n      });\n    };\n    var next = function (current, isRoot) {\n      var detection = detect$5(current, isRoot);\n      return detection.fold(function () {\n        return CellLocation.none(current);\n      }, function (info) {\n        return info.index + 1 < info.all.length ? CellLocation.middle(current, info.all[info.index + 1]) : CellLocation.last(current);\n      });\n    };\n    var prev = function (current, isRoot) {\n      var detection = detect$5(current, isRoot);\n      return detection.fold(function () {\n        return CellLocation.none();\n      }, function (info) {\n        return info.index - 1 >= 0 ? CellLocation.middle(current, info.all[info.index - 1]) : CellLocation.first(current);\n      });\n    };\n\n    var create$2 = function (start, soffset, finish, foffset) {\n      return {\n        start: start,\n        soffset: soffset,\n        finish: finish,\n        foffset: foffset\n      };\n    };\n    var SimRange = { create: create$2 };\n\n    var adt$3 = Adt.generate([\n      { before: ['element'] },\n      {\n        on: [\n          'element',\n          'offset'\n        ]\n      },\n      { after: ['element'] }\n    ]);\n    var cata$1 = function (subject, onBefore, onOn, onAfter) {\n      return subject.fold(onBefore, onOn, onAfter);\n    };\n    var getStart = function (situ) {\n      return situ.fold(identity, identity, identity);\n    };\n    var before$2 = adt$3.before;\n    var on = adt$3.on;\n    var after$2 = adt$3.after;\n    var Situ = {\n      before: before$2,\n      on: on,\n      after: after$2,\n      cata: cata$1,\n      getStart: getStart\n    };\n\n    var adt$4 = Adt.generate([\n      { domRange: ['rng'] },\n      {\n        relative: [\n          'startSitu',\n          'finishSitu'\n        ]\n      },\n      {\n        exact: [\n          'start',\n          'soffset',\n          'finish',\n          'foffset'\n        ]\n      }\n    ]);\n    var exactFromRange = function (simRange) {\n      return adt$4.exact(simRange.start, simRange.soffset, simRange.finish, simRange.foffset);\n    };\n    var getStart$1 = function (selection) {\n      return selection.match({\n        domRange: function (rng) {\n          return SugarElement.fromDom(rng.startContainer);\n        },\n        relative: function (startSitu, _finishSitu) {\n          return Situ.getStart(startSitu);\n        },\n        exact: function (start, _soffset, _finish, _foffset) {\n          return start;\n        }\n      });\n    };\n    var domRange = adt$4.domRange;\n    var relative = adt$4.relative;\n    var exact = adt$4.exact;\n    var getWin = function (selection) {\n      var start = getStart$1(selection);\n      return defaultView(start);\n    };\n    var range$1 = SimRange.create;\n    var SimSelection = {\n      domRange: domRange,\n      relative: relative,\n      exact: exact,\n      exactFromRange: exactFromRange,\n      getWin: getWin,\n      range: range$1\n    };\n\n    var selectNodeContents = function (win, element) {\n      var rng = win.document.createRange();\n      selectNodeContentsUsing(rng, element);\n      return rng;\n    };\n    var selectNodeContentsUsing = function (rng, element) {\n      return rng.selectNodeContents(element.dom);\n    };\n    var setStart = function (rng, situ) {\n      situ.fold(function (e) {\n        rng.setStartBefore(e.dom);\n      }, function (e, o) {\n        rng.setStart(e.dom, o);\n      }, function (e) {\n        rng.setStartAfter(e.dom);\n      });\n    };\n    var setFinish = function (rng, situ) {\n      situ.fold(function (e) {\n        rng.setEndBefore(e.dom);\n      }, function (e, o) {\n        rng.setEnd(e.dom, o);\n      }, function (e) {\n        rng.setEndAfter(e.dom);\n      });\n    };\n    var relativeToNative = function (win, startSitu, finishSitu) {\n      var range = win.document.createRange();\n      setStart(range, startSitu);\n      setFinish(range, finishSitu);\n      return range;\n    };\n    var exactToNative = function (win, start, soffset, finish, foffset) {\n      var rng = win.document.createRange();\n      rng.setStart(start.dom, soffset);\n      rng.setEnd(finish.dom, foffset);\n      return rng;\n    };\n    var toRect = function (rect) {\n      return {\n        left: rect.left,\n        top: rect.top,\n        right: rect.right,\n        bottom: rect.bottom,\n        width: rect.width,\n        height: rect.height\n      };\n    };\n    var getFirstRect = function (rng) {\n      var rects = rng.getClientRects();\n      var rect = rects.length > 0 ? rects[0] : rng.getBoundingClientRect();\n      return rect.width > 0 || rect.height > 0 ? Optional.some(rect).map(toRect) : Optional.none();\n    };\n\n    var adt$5 = Adt.generate([\n      {\n        ltr: [\n          'start',\n          'soffset',\n          'finish',\n          'foffset'\n        ]\n      },\n      {\n        rtl: [\n          'start',\n          'soffset',\n          'finish',\n          'foffset'\n        ]\n      }\n    ]);\n    var fromRange = function (win, type, range) {\n      return type(SugarElement.fromDom(range.startContainer), range.startOffset, SugarElement.fromDom(range.endContainer), range.endOffset);\n    };\n    var getRanges = function (win, selection) {\n      return selection.match({\n        domRange: function (rng) {\n          return {\n            ltr: constant(rng),\n            rtl: Optional.none\n          };\n        },\n        relative: function (startSitu, finishSitu) {\n          return {\n            ltr: cached(function () {\n              return relativeToNative(win, startSitu, finishSitu);\n            }),\n            rtl: cached(function () {\n              return Optional.some(relativeToNative(win, finishSitu, startSitu));\n            })\n          };\n        },\n        exact: function (start, soffset, finish, foffset) {\n          return {\n            ltr: cached(function () {\n              return exactToNative(win, start, soffset, finish, foffset);\n            }),\n            rtl: cached(function () {\n              return Optional.some(exactToNative(win, finish, foffset, start, soffset));\n            })\n          };\n        }\n      });\n    };\n    var doDiagnose = function (win, ranges) {\n      var rng = ranges.ltr();\n      if (rng.collapsed) {\n        var reversed = ranges.rtl().filter(function (rev) {\n          return rev.collapsed === false;\n        });\n        return reversed.map(function (rev) {\n          return adt$5.rtl(SugarElement.fromDom(rev.endContainer), rev.endOffset, SugarElement.fromDom(rev.startContainer), rev.startOffset);\n        }).getOrThunk(function () {\n          return fromRange(win, adt$5.ltr, rng);\n        });\n      } else {\n        return fromRange(win, adt$5.ltr, rng);\n      }\n    };\n    var diagnose = function (win, selection) {\n      var ranges = getRanges(win, selection);\n      return doDiagnose(win, ranges);\n    };\n    var asLtrRange = function (win, selection) {\n      var diagnosis = diagnose(win, selection);\n      return diagnosis.match({\n        ltr: function (start, soffset, finish, foffset) {\n          var rng = win.document.createRange();\n          rng.setStart(start.dom, soffset);\n          rng.setEnd(finish.dom, foffset);\n          return rng;\n        },\n        rtl: function (start, soffset, finish, foffset) {\n          var rng = win.document.createRange();\n          rng.setStart(finish.dom, foffset);\n          rng.setEnd(start.dom, soffset);\n          return rng;\n        }\n      });\n    };\n    var ltr$1 = adt$5.ltr;\n    var rtl$1 = adt$5.rtl;\n\n    var searchForPoint = function (rectForOffset, x, y, maxX, length) {\n      if (length === 0) {\n        return 0;\n      } else if (x === maxX) {\n        return length - 1;\n      }\n      var xDelta = maxX;\n      for (var i = 1; i < length; i++) {\n        var rect = rectForOffset(i);\n        var curDeltaX = Math.abs(x - rect.left);\n        if (y <= rect.bottom) {\n          if (y < rect.top || curDeltaX > xDelta) {\n            return i - 1;\n          } else {\n            xDelta = curDeltaX;\n          }\n        }\n      }\n      return 0;\n    };\n    var inRect = function (rect, x, y) {\n      return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;\n    };\n\n    var locateOffset = function (doc, textnode, x, y, rect) {\n      var rangeForOffset = function (o) {\n        var r = doc.dom.createRange();\n        r.setStart(textnode.dom, o);\n        r.collapse(true);\n        return r;\n      };\n      var rectForOffset = function (o) {\n        var r = rangeForOffset(o);\n        return r.getBoundingClientRect();\n      };\n      var length = get$4(textnode).length;\n      var offset = searchForPoint(rectForOffset, x, y, rect.right, length);\n      return rangeForOffset(offset);\n    };\n    var locate = function (doc, node, x, y) {\n      var r = doc.dom.createRange();\n      r.selectNode(node.dom);\n      var rects = r.getClientRects();\n      var foundRect = findMap(rects, function (rect) {\n        return inRect(rect, x, y) ? Optional.some(rect) : Optional.none();\n      });\n      return foundRect.map(function (rect) {\n        return locateOffset(doc, node, x, y, rect);\n      });\n    };\n\n    var searchInChildren = function (doc, node, x, y) {\n      var r = doc.dom.createRange();\n      var nodes = children(node);\n      return findMap(nodes, function (n) {\n        r.selectNode(n.dom);\n        return inRect(r.getBoundingClientRect(), x, y) ? locateNode(doc, n, x, y) : Optional.none();\n      });\n    };\n    var locateNode = function (doc, node, x, y) {\n      return isText(node) ? locate(doc, node, x, y) : searchInChildren(doc, node, x, y);\n    };\n    var locate$1 = function (doc, node, x, y) {\n      var r = doc.dom.createRange();\n      r.selectNode(node.dom);\n      var rect = r.getBoundingClientRect();\n      var boundedX = Math.max(rect.left, Math.min(rect.right, x));\n      var boundedY = Math.max(rect.top, Math.min(rect.bottom, y));\n      return locateNode(doc, node, boundedX, boundedY);\n    };\n\n    var COLLAPSE_TO_LEFT = true;\n    var COLLAPSE_TO_RIGHT = false;\n    var getCollapseDirection = function (rect, x) {\n      return x - rect.left < rect.right - x ? COLLAPSE_TO_LEFT : COLLAPSE_TO_RIGHT;\n    };\n    var createCollapsedNode = function (doc, target, collapseDirection) {\n      var r = doc.dom.createRange();\n      r.selectNode(target.dom);\n      r.collapse(collapseDirection);\n      return r;\n    };\n    var locateInElement = function (doc, node, x) {\n      var cursorRange = doc.dom.createRange();\n      cursorRange.selectNode(node.dom);\n      var rect = cursorRange.getBoundingClientRect();\n      var collapseDirection = getCollapseDirection(rect, x);\n      var f = collapseDirection === COLLAPSE_TO_LEFT ? first : last$1;\n      return f(node).map(function (target) {\n        return createCollapsedNode(doc, target, collapseDirection);\n      });\n    };\n    var locateInEmpty = function (doc, node, x) {\n      var rect = node.dom.getBoundingClientRect();\n      var collapseDirection = getCollapseDirection(rect, x);\n      return Optional.some(createCollapsedNode(doc, node, collapseDirection));\n    };\n    var search = function (doc, node, x) {\n      var f = children(node).length === 0 ? locateInEmpty : locateInElement;\n      return f(doc, node, x);\n    };\n\n    var caretPositionFromPoint = function (doc, x, y) {\n      return Optional.from(doc.dom.caretPositionFromPoint(x, y)).bind(function (pos) {\n        if (pos.offsetNode === null) {\n          return Optional.none();\n        }\n        var r = doc.dom.createRange();\n        r.setStart(pos.offsetNode, pos.offset);\n        r.collapse();\n        return Optional.some(r);\n      });\n    };\n    var caretRangeFromPoint = function (doc, x, y) {\n      return Optional.from(doc.dom.caretRangeFromPoint(x, y));\n    };\n    var searchTextNodes = function (doc, node, x, y) {\n      var r = doc.dom.createRange();\n      r.selectNode(node.dom);\n      var rect = r.getBoundingClientRect();\n      var boundedX = Math.max(rect.left, Math.min(rect.right, x));\n      var boundedY = Math.max(rect.top, Math.min(rect.bottom, y));\n      return locate$1(doc, node, boundedX, boundedY);\n    };\n    var searchFromPoint = function (doc, x, y) {\n      return SugarElement.fromPoint(doc, x, y).bind(function (elem) {\n        var fallback = function () {\n          return search(doc, elem, x);\n        };\n        return children(elem).length === 0 ? fallback() : searchTextNodes(doc, elem, x, y).orThunk(fallback);\n      });\n    };\n    var availableSearch = function () {\n      if (document.caretPositionFromPoint) {\n        return caretPositionFromPoint;\n      } else if (document.caretRangeFromPoint) {\n        return caretRangeFromPoint;\n      } else {\n        return searchFromPoint;\n      }\n    }();\n    var fromPoint$1 = function (win, x, y) {\n      var doc = SugarElement.fromDom(win.document);\n      return availableSearch(doc, x, y).map(function (rng) {\n        return SimRange.create(SugarElement.fromDom(rng.startContainer), rng.startOffset, SugarElement.fromDom(rng.endContainer), rng.endOffset);\n      });\n    };\n\n    var beforeSpecial = function (element, offset) {\n      var name$1 = name(element);\n      if ('input' === name$1) {\n        return Situ.after(element);\n      } else if (!contains([\n          'br',\n          'img'\n        ], name$1)) {\n        return Situ.on(element, offset);\n      } else {\n        return offset === 0 ? Situ.before(element) : Situ.after(element);\n      }\n    };\n    var preprocessRelative = function (startSitu, finishSitu) {\n      var start = startSitu.fold(Situ.before, beforeSpecial, Situ.after);\n      var finish = finishSitu.fold(Situ.before, beforeSpecial, Situ.after);\n      return SimSelection.relative(start, finish);\n    };\n    var preprocessExact = function (start, soffset, finish, foffset) {\n      var startSitu = beforeSpecial(start, soffset);\n      var finishSitu = beforeSpecial(finish, foffset);\n      return SimSelection.relative(startSitu, finishSitu);\n    };\n    var preprocess = function (selection) {\n      return selection.match({\n        domRange: function (rng) {\n          var start = SugarElement.fromDom(rng.startContainer);\n          var finish = SugarElement.fromDom(rng.endContainer);\n          return preprocessExact(start, rng.startOffset, finish, rng.endOffset);\n        },\n        relative: preprocessRelative,\n        exact: preprocessExact\n      });\n    };\n\n    var makeRange = function (start, soffset, finish, foffset) {\n      var doc = owner(start);\n      var rng = doc.dom.createRange();\n      rng.setStart(start.dom, soffset);\n      rng.setEnd(finish.dom, foffset);\n      return rng;\n    };\n    var after$3 = function (start, soffset, finish, foffset) {\n      var r = makeRange(start, soffset, finish, foffset);\n      var same = eq$1(start, finish) && soffset === foffset;\n      return r.collapsed && !same;\n    };\n\n    var getNativeSelection = function (win) {\n      return Optional.from(win.getSelection());\n    };\n    var doSetNativeRange = function (win, rng) {\n      getNativeSelection(win).each(function (selection) {\n        selection.removeAllRanges();\n        selection.addRange(rng);\n      });\n    };\n    var doSetRange = function (win, start, soffset, finish, foffset) {\n      var rng = exactToNative(win, start, soffset, finish, foffset);\n      doSetNativeRange(win, rng);\n    };\n    var setLegacyRtlRange = function (win, selection, start, soffset, finish, foffset) {\n      selection.collapse(start.dom, soffset);\n      selection.extend(finish.dom, foffset);\n    };\n    var setRangeFromRelative = function (win, relative) {\n      return diagnose(win, relative).match({\n        ltr: function (start, soffset, finish, foffset) {\n          doSetRange(win, start, soffset, finish, foffset);\n        },\n        rtl: function (start, soffset, finish, foffset) {\n          getNativeSelection(win).each(function (selection) {\n            if (selection.setBaseAndExtent) {\n              selection.setBaseAndExtent(start.dom, soffset, finish.dom, foffset);\n            } else if (selection.extend) {\n              try {\n                setLegacyRtlRange(win, selection, start, soffset, finish, foffset);\n              } catch (e) {\n                doSetRange(win, finish, foffset, start, soffset);\n              }\n            } else {\n              doSetRange(win, finish, foffset, start, soffset);\n            }\n          });\n        }\n      });\n    };\n    var setExact = function (win, start, soffset, finish, foffset) {\n      var relative = preprocessExact(start, soffset, finish, foffset);\n      setRangeFromRelative(win, relative);\n    };\n    var setRelative = function (win, startSitu, finishSitu) {\n      var relative = preprocessRelative(startSitu, finishSitu);\n      setRangeFromRelative(win, relative);\n    };\n    var toNative = function (selection) {\n      var win = SimSelection.getWin(selection).dom;\n      var getDomRange = function (start, soffset, finish, foffset) {\n        return exactToNative(win, start, soffset, finish, foffset);\n      };\n      var filtered = preprocess(selection);\n      return diagnose(win, filtered).match({\n        ltr: getDomRange,\n        rtl: getDomRange\n      });\n    };\n    var readRange = function (selection) {\n      if (selection.rangeCount > 0) {\n        var firstRng = selection.getRangeAt(0);\n        var lastRng = selection.getRangeAt(selection.rangeCount - 1);\n        return Optional.some(SimRange.create(SugarElement.fromDom(firstRng.startContainer), firstRng.startOffset, SugarElement.fromDom(lastRng.endContainer), lastRng.endOffset));\n      } else {\n        return Optional.none();\n      }\n    };\n    var doGetExact = function (selection) {\n      if (selection.anchorNode === null || selection.focusNode === null) {\n        return readRange(selection);\n      } else {\n        var anchor = SugarElement.fromDom(selection.anchorNode);\n        var focus_1 = SugarElement.fromDom(selection.focusNode);\n        return after$3(anchor, selection.anchorOffset, focus_1, selection.focusOffset) ? Optional.some(SimRange.create(anchor, selection.anchorOffset, focus_1, selection.focusOffset)) : readRange(selection);\n      }\n    };\n    var setToElement = function (win, element) {\n      var rng = selectNodeContents(win, element);\n      doSetNativeRange(win, rng);\n    };\n    var getExact = function (win) {\n      return getNativeSelection(win).filter(function (sel) {\n        return sel.rangeCount > 0;\n      }).bind(doGetExact);\n    };\n    var get$c = function (win) {\n      return getExact(win).map(function (range) {\n        return SimSelection.exact(range.start, range.soffset, range.finish, range.foffset);\n      });\n    };\n    var getFirstRect$1 = function (win, selection) {\n      var rng = asLtrRange(win, selection);\n      return getFirstRect(rng);\n    };\n    var getAtPoint = function (win, x, y) {\n      return fromPoint$1(win, x, y);\n    };\n    var clear = function (win) {\n      getNativeSelection(win).each(function (selection) {\n        return selection.removeAllRanges();\n      });\n    };\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.util.VK');\n\n    var forward = function (editor, isRoot, cell) {\n      return go(editor, isRoot, next(cell));\n    };\n    var backward = function (editor, isRoot, cell) {\n      return go(editor, isRoot, prev(cell));\n    };\n    var getCellFirstCursorPosition = function (editor, cell) {\n      var selection = SimSelection.exact(cell, 0, cell, 0);\n      return toNative(selection);\n    };\n    var getNewRowCursorPosition = function (editor, table) {\n      var rows = descendants$1(table, 'tr');\n      return last(rows).bind(function (last) {\n        return descendant$1(last, 'td,th').map(function (first) {\n          return getCellFirstCursorPosition(editor, first);\n        });\n      });\n    };\n    var go = function (editor, isRoot, cell) {\n      return cell.fold(Optional.none, Optional.none, function (current, next) {\n        return first(next).map(function (cell) {\n          return getCellFirstCursorPosition(editor, cell);\n        });\n      }, function (current) {\n        return table(current, isRoot).bind(function (table) {\n          editor.execCommand('mceTableInsertRowAfter');\n          return getNewRowCursorPosition(editor, table);\n        });\n      });\n    };\n    var rootElements = [\n      'table',\n      'li',\n      'dl'\n    ];\n    var handle$1 = function (event, editor, cellSelection) {\n      if (event.keyCode === global$3.TAB) {\n        var body_1 = getBody$1(editor);\n        var isRoot_1 = function (element) {\n          var name$1 = name(element);\n          return eq$1(element, body_1) || contains(rootElements, name$1);\n        };\n        var rng = editor.selection.getRng();\n        var container = SugarElement.fromDom(event.shiftKey ? rng.startContainer : rng.endContainer);\n        cell(container, isRoot_1).each(function (cell) {\n          event.preventDefault();\n          table(cell, isRoot_1).each(cellSelection.clear);\n          editor.selection.collapse(event.shiftKey);\n          var navigation = event.shiftKey ? backward : forward;\n          var rng = navigation(editor, isRoot_1, cell);\n          rng.each(function (range) {\n            editor.selection.setRng(range);\n          });\n        });\n      }\n    };\n\n    var create$3 = function (selection, kill) {\n      return {\n        selection: selection,\n        kill: kill\n      };\n    };\n    var Response = { create: create$3 };\n\n    var create$4 = function (start, soffset, finish, foffset) {\n      return {\n        start: Situ.on(start, soffset),\n        finish: Situ.on(finish, foffset)\n      };\n    };\n    var Situs = { create: create$4 };\n\n    var convertToRange = function (win, selection) {\n      var rng = asLtrRange(win, selection);\n      return SimRange.create(SugarElement.fromDom(rng.startContainer), rng.startOffset, SugarElement.fromDom(rng.endContainer), rng.endOffset);\n    };\n    var makeSitus = Situs.create;\n\n    var sync = function (container, isRoot, start, soffset, finish, foffset, selectRange) {\n      if (!(eq$1(start, finish) && soffset === foffset)) {\n        return closest$1(start, 'td,th', isRoot).bind(function (s) {\n          return closest$1(finish, 'td,th', isRoot).bind(function (f) {\n            return detect$6(container, isRoot, s, f, selectRange);\n          });\n        });\n      } else {\n        return Optional.none();\n      }\n    };\n    var detect$6 = function (container, isRoot, start, finish, selectRange) {\n      if (!eq$1(start, finish)) {\n        return identify(start, finish, isRoot).bind(function (cellSel) {\n          var boxes = cellSel.boxes.getOr([]);\n          if (boxes.length > 0) {\n            selectRange(container, boxes, cellSel.start, cellSel.finish);\n            return Optional.some(Response.create(Optional.some(makeSitus(start, 0, start, getEnd(start))), true));\n          } else {\n            return Optional.none();\n          }\n        });\n      } else {\n        return Optional.none();\n      }\n    };\n    var update = function (rows, columns, container, selected, annotations) {\n      var updateSelection = function (newSels) {\n        annotations.clearBeforeUpdate(container);\n        annotations.selectRange(container, newSels.boxes, newSels.start, newSels.finish);\n        return newSels.boxes;\n      };\n      return shiftSelection(selected, rows, columns, annotations.firstSelectedSelector, annotations.lastSelectedSelector).map(updateSelection);\n    };\n\n    var traverse = function (item, mode) {\n      return {\n        item: item,\n        mode: mode\n      };\n    };\n    var backtrack = function (universe, item, _direction, transition) {\n      if (transition === void 0) {\n        transition = sidestep;\n      }\n      return universe.property().parent(item).map(function (p) {\n        return traverse(p, transition);\n      });\n    };\n    var sidestep = function (universe, item, direction, transition) {\n      if (transition === void 0) {\n        transition = advance;\n      }\n      return direction.sibling(universe, item).map(function (p) {\n        return traverse(p, transition);\n      });\n    };\n    var advance = function (universe, item, direction, transition) {\n      if (transition === void 0) {\n        transition = advance;\n      }\n      var children = universe.property().children(item);\n      var result = direction.first(children);\n      return result.map(function (r) {\n        return traverse(r, transition);\n      });\n    };\n    var successors = [\n      {\n        current: backtrack,\n        next: sidestep,\n        fallback: Optional.none()\n      },\n      {\n        current: sidestep,\n        next: advance,\n        fallback: Optional.some(backtrack)\n      },\n      {\n        current: advance,\n        next: advance,\n        fallback: Optional.some(sidestep)\n      }\n    ];\n    var go$1 = function (universe, item, mode, direction, rules) {\n      if (rules === void 0) {\n        rules = successors;\n      }\n      var ruleOpt = find(rules, function (succ) {\n        return succ.current === mode;\n      });\n      return ruleOpt.bind(function (rule) {\n        return rule.current(universe, item, direction, rule.next).orThunk(function () {\n          return rule.fallback.bind(function (fb) {\n            return go$1(universe, item, fb, direction);\n          });\n        });\n      });\n    };\n\n    var left = function () {\n      var sibling = function (universe, item) {\n        return universe.query().prevSibling(item);\n      };\n      var first = function (children) {\n        return children.length > 0 ? Optional.some(children[children.length - 1]) : Optional.none();\n      };\n      return {\n        sibling: sibling,\n        first: first\n      };\n    };\n    var right = function () {\n      var sibling = function (universe, item) {\n        return universe.query().nextSibling(item);\n      };\n      var first = function (children) {\n        return children.length > 0 ? Optional.some(children[0]) : Optional.none();\n      };\n      return {\n        sibling: sibling,\n        first: first\n      };\n    };\n    var Walkers = {\n      left: left,\n      right: right\n    };\n\n    var hone = function (universe, item, predicate, mode, direction, isRoot) {\n      var next = go$1(universe, item, mode, direction);\n      return next.bind(function (n) {\n        if (isRoot(n.item)) {\n          return Optional.none();\n        } else {\n          return predicate(n.item) ? Optional.some(n.item) : hone(universe, n.item, predicate, n.mode, direction, isRoot);\n        }\n      });\n    };\n    var left$1 = function (universe, item, predicate, isRoot) {\n      return hone(universe, item, predicate, sidestep, Walkers.left(), isRoot);\n    };\n    var right$1 = function (universe, item, predicate, isRoot) {\n      return hone(universe, item, predicate, sidestep, Walkers.right(), isRoot);\n    };\n\n    var isLeaf = function (universe) {\n      return function (element) {\n        return universe.property().children(element).length === 0;\n      };\n    };\n    var before$3 = function (universe, item, isRoot) {\n      return seekLeft(universe, item, isLeaf(universe), isRoot);\n    };\n    var after$4 = function (universe, item, isRoot) {\n      return seekRight(universe, item, isLeaf(universe), isRoot);\n    };\n    var seekLeft = left$1;\n    var seekRight = right$1;\n\n    var universe$3 = DomUniverse();\n    var before$4 = function (element, isRoot) {\n      return before$3(universe$3, element, isRoot);\n    };\n    var after$5 = function (element, isRoot) {\n      return after$4(universe$3, element, isRoot);\n    };\n    var seekLeft$1 = function (element, predicate, isRoot) {\n      return seekLeft(universe$3, element, predicate, isRoot);\n    };\n    var seekRight$1 = function (element, predicate, isRoot) {\n      return seekRight(universe$3, element, predicate, isRoot);\n    };\n\n    var ancestor$2 = function (scope, predicate, isRoot) {\n      return ancestor(scope, predicate, isRoot).isSome();\n    };\n\n    var adt$6 = Adt.generate([\n      { none: ['message'] },\n      { success: [] },\n      { failedUp: ['cell'] },\n      { failedDown: ['cell'] }\n    ]);\n    var isOverlapping = function (bridge, before, after) {\n      var beforeBounds = bridge.getRect(before);\n      var afterBounds = bridge.getRect(after);\n      return afterBounds.right > beforeBounds.left && afterBounds.left < beforeBounds.right;\n    };\n    var isRow = function (elem) {\n      return closest$1(elem, 'tr');\n    };\n    var verify = function (bridge, before, beforeOffset, after, afterOffset, failure, isRoot) {\n      return closest$1(after, 'td,th', isRoot).bind(function (afterCell) {\n        return closest$1(before, 'td,th', isRoot).map(function (beforeCell) {\n          if (!eq$1(afterCell, beforeCell)) {\n            return sharedOne$1(isRow, [\n              afterCell,\n              beforeCell\n            ]).fold(function () {\n              return isOverlapping(bridge, beforeCell, afterCell) ? adt$6.success() : failure(beforeCell);\n            }, function (_sharedRow) {\n              return failure(beforeCell);\n            });\n          } else {\n            return eq$1(after, afterCell) && getEnd(afterCell) === afterOffset ? failure(beforeCell) : adt$6.none('in same cell');\n          }\n        });\n      }).getOr(adt$6.none('default'));\n    };\n    var cata$2 = function (subject, onNone, onSuccess, onFailedUp, onFailedDown) {\n      return subject.fold(onNone, onSuccess, onFailedUp, onFailedDown);\n    };\n    var BeforeAfter = __assign(__assign({}, adt$6), {\n      verify: verify,\n      cata: cata$2\n    });\n\n    var inParent = function (parent, children, element, index) {\n      return {\n        parent: parent,\n        children: children,\n        element: element,\n        index: index\n      };\n    };\n    var indexInParent = function (element) {\n      return parent(element).bind(function (parent) {\n        var children$1 = children(parent);\n        return indexOf(children$1, element).map(function (index) {\n          return inParent(parent, children$1, element, index);\n        });\n      });\n    };\n    var indexOf = function (elements, element) {\n      return findIndex(elements, curry(eq$1, element));\n    };\n\n    var isBr = function (elem) {\n      return name(elem) === 'br';\n    };\n    var gatherer = function (cand, gather, isRoot) {\n      return gather(cand, isRoot).bind(function (target) {\n        return isText(target) && get$4(target).trim().length === 0 ? gatherer(target, gather, isRoot) : Optional.some(target);\n      });\n    };\n    var handleBr = function (isRoot, element, direction) {\n      return direction.traverse(element).orThunk(function () {\n        return gatherer(element, direction.gather, isRoot);\n      }).map(direction.relative);\n    };\n    var findBr = function (element, offset) {\n      return child(element, offset).filter(isBr).orThunk(function () {\n        return child(element, offset - 1).filter(isBr);\n      });\n    };\n    var handleParent = function (isRoot, element, offset, direction) {\n      return findBr(element, offset).bind(function (br) {\n        return direction.traverse(br).fold(function () {\n          return gatherer(br, direction.gather, isRoot).map(direction.relative);\n        }, function (adjacent) {\n          return indexInParent(adjacent).map(function (info) {\n            return Situ.on(info.parent, info.index);\n          });\n        });\n      });\n    };\n    var tryBr = function (isRoot, element, offset, direction) {\n      var target = isBr(element) ? handleBr(isRoot, element, direction) : handleParent(isRoot, element, offset, direction);\n      return target.map(function (tgt) {\n        return {\n          start: tgt,\n          finish: tgt\n        };\n      });\n    };\n    var process = function (analysis) {\n      return BeforeAfter.cata(analysis, function (_message) {\n        return Optional.none();\n      }, function () {\n        return Optional.none();\n      }, function (cell) {\n        return Optional.some(point(cell, 0));\n      }, function (cell) {\n        return Optional.some(point(cell, getEnd(cell)));\n      });\n    };\n\n    var moveDown = function (caret, amount) {\n      return {\n        left: caret.left,\n        top: caret.top + amount,\n        right: caret.right,\n        bottom: caret.bottom + amount\n      };\n    };\n    var moveUp = function (caret, amount) {\n      return {\n        left: caret.left,\n        top: caret.top - amount,\n        right: caret.right,\n        bottom: caret.bottom - amount\n      };\n    };\n    var translate = function (caret, xDelta, yDelta) {\n      return {\n        left: caret.left + xDelta,\n        top: caret.top + yDelta,\n        right: caret.right + xDelta,\n        bottom: caret.bottom + yDelta\n      };\n    };\n    var getTop$1 = function (caret) {\n      return caret.top;\n    };\n    var getBottom = function (caret) {\n      return caret.bottom;\n    };\n\n    var getPartialBox = function (bridge, element, offset) {\n      if (offset >= 0 && offset < getEnd(element)) {\n        return bridge.getRangedRect(element, offset, element, offset + 1);\n      } else if (offset > 0) {\n        return bridge.getRangedRect(element, offset - 1, element, offset);\n      }\n      return Optional.none();\n    };\n    var toCaret = function (rect) {\n      return {\n        left: rect.left,\n        top: rect.top,\n        right: rect.right,\n        bottom: rect.bottom\n      };\n    };\n    var getElemBox = function (bridge, element) {\n      return Optional.some(bridge.getRect(element));\n    };\n    var getBoxAt = function (bridge, element, offset) {\n      if (isElement(element)) {\n        return getElemBox(bridge, element).map(toCaret);\n      } else if (isText(element)) {\n        return getPartialBox(bridge, element, offset).map(toCaret);\n      } else {\n        return Optional.none();\n      }\n    };\n    var getEntireBox = function (bridge, element) {\n      if (isElement(element)) {\n        return getElemBox(bridge, element).map(toCaret);\n      } else if (isText(element)) {\n        return bridge.getRangedRect(element, 0, element, getEnd(element)).map(toCaret);\n      } else {\n        return Optional.none();\n      }\n    };\n\n    var JUMP_SIZE = 5;\n    var NUM_RETRIES = 100;\n    var adt$7 = Adt.generate([\n      { none: [] },\n      { retry: ['caret'] }\n    ]);\n    var isOutside = function (caret, box) {\n      return caret.left < box.left || Math.abs(box.right - caret.left) < 1 || caret.left > box.right;\n    };\n    var inOutsideBlock = function (bridge, element, caret) {\n      return closest(element, isBlock$1).fold(never, function (cell) {\n        return getEntireBox(bridge, cell).exists(function (box) {\n          return isOutside(caret, box);\n        });\n      });\n    };\n    var adjustDown = function (bridge, element, guessBox, original, caret) {\n      var lowerCaret = moveDown(caret, JUMP_SIZE);\n      if (Math.abs(guessBox.bottom - original.bottom) < 1) {\n        return adt$7.retry(lowerCaret);\n      } else if (guessBox.top > caret.bottom) {\n        return adt$7.retry(lowerCaret);\n      } else if (guessBox.top === caret.bottom) {\n        return adt$7.retry(moveDown(caret, 1));\n      } else {\n        return inOutsideBlock(bridge, element, caret) ? adt$7.retry(translate(lowerCaret, JUMP_SIZE, 0)) : adt$7.none();\n      }\n    };\n    var adjustUp = function (bridge, element, guessBox, original, caret) {\n      var higherCaret = moveUp(caret, JUMP_SIZE);\n      if (Math.abs(guessBox.top - original.top) < 1) {\n        return adt$7.retry(higherCaret);\n      } else if (guessBox.bottom < caret.top) {\n        return adt$7.retry(higherCaret);\n      } else if (guessBox.bottom === caret.top) {\n        return adt$7.retry(moveUp(caret, 1));\n      } else {\n        return inOutsideBlock(bridge, element, caret) ? adt$7.retry(translate(higherCaret, JUMP_SIZE, 0)) : adt$7.none();\n      }\n    };\n    var upMovement = {\n      point: getTop$1,\n      adjuster: adjustUp,\n      move: moveUp,\n      gather: before$4\n    };\n    var downMovement = {\n      point: getBottom,\n      adjuster: adjustDown,\n      move: moveDown,\n      gather: after$5\n    };\n    var isAtTable = function (bridge, x, y) {\n      return bridge.elementFromPoint(x, y).filter(function (elm) {\n        return name(elm) === 'table';\n      }).isSome();\n    };\n    var adjustForTable = function (bridge, movement, original, caret, numRetries) {\n      return adjustTil(bridge, movement, original, movement.move(caret, JUMP_SIZE), numRetries);\n    };\n    var adjustTil = function (bridge, movement, original, caret, numRetries) {\n      if (numRetries === 0) {\n        return Optional.some(caret);\n      }\n      if (isAtTable(bridge, caret.left, movement.point(caret))) {\n        return adjustForTable(bridge, movement, original, caret, numRetries - 1);\n      }\n      return bridge.situsFromPoint(caret.left, movement.point(caret)).bind(function (guess) {\n        return guess.start.fold(Optional.none, function (element) {\n          return getEntireBox(bridge, element).bind(function (guessBox) {\n            return movement.adjuster(bridge, element, guessBox, original, caret).fold(Optional.none, function (newCaret) {\n              return adjustTil(bridge, movement, original, newCaret, numRetries - 1);\n            });\n          }).orThunk(function () {\n            return Optional.some(caret);\n          });\n        }, Optional.none);\n      });\n    };\n    var ieTryDown = function (bridge, caret) {\n      return bridge.situsFromPoint(caret.left, caret.bottom + JUMP_SIZE);\n    };\n    var ieTryUp = function (bridge, caret) {\n      return bridge.situsFromPoint(caret.left, caret.top - JUMP_SIZE);\n    };\n    var checkScroll = function (movement, adjusted, bridge) {\n      if (movement.point(adjusted) > bridge.getInnerHeight()) {\n        return Optional.some(movement.point(adjusted) - bridge.getInnerHeight());\n      } else if (movement.point(adjusted) < 0) {\n        return Optional.some(-movement.point(adjusted));\n      } else {\n        return Optional.none();\n      }\n    };\n    var retry = function (movement, bridge, caret) {\n      var moved = movement.move(caret, JUMP_SIZE);\n      var adjusted = adjustTil(bridge, movement, caret, moved, NUM_RETRIES).getOr(moved);\n      return checkScroll(movement, adjusted, bridge).fold(function () {\n        return bridge.situsFromPoint(adjusted.left, movement.point(adjusted));\n      }, function (delta) {\n        bridge.scrollBy(0, delta);\n        return bridge.situsFromPoint(adjusted.left, movement.point(adjusted) - delta);\n      });\n    };\n    var Retries = {\n      tryUp: curry(retry, upMovement),\n      tryDown: curry(retry, downMovement),\n      ieTryUp: ieTryUp,\n      ieTryDown: ieTryDown,\n      getJumpSize: constant(JUMP_SIZE)\n    };\n\n    var MAX_RETRIES = 20;\n    var findSpot = function (bridge, isRoot, direction) {\n      return bridge.getSelection().bind(function (sel) {\n        return tryBr(isRoot, sel.finish, sel.foffset, direction).fold(function () {\n          return Optional.some(point(sel.finish, sel.foffset));\n        }, function (brNeighbour) {\n          var range = bridge.fromSitus(brNeighbour);\n          var analysis = BeforeAfter.verify(bridge, sel.finish, sel.foffset, range.finish, range.foffset, direction.failure, isRoot);\n          return process(analysis);\n        });\n      });\n    };\n    var scan$1 = function (bridge, isRoot, element, offset, direction, numRetries) {\n      if (numRetries === 0) {\n        return Optional.none();\n      }\n      return tryCursor(bridge, isRoot, element, offset, direction).bind(function (situs) {\n        var range = bridge.fromSitus(situs);\n        var analysis = BeforeAfter.verify(bridge, element, offset, range.finish, range.foffset, direction.failure, isRoot);\n        return BeforeAfter.cata(analysis, function () {\n          return Optional.none();\n        }, function () {\n          return Optional.some(situs);\n        }, function (cell) {\n          if (eq$1(element, cell) && offset === 0) {\n            return tryAgain(bridge, element, offset, moveUp, direction);\n          } else {\n            return scan$1(bridge, isRoot, cell, 0, direction, numRetries - 1);\n          }\n        }, function (cell) {\n          if (eq$1(element, cell) && offset === getEnd(cell)) {\n            return tryAgain(bridge, element, offset, moveDown, direction);\n          } else {\n            return scan$1(bridge, isRoot, cell, getEnd(cell), direction, numRetries - 1);\n          }\n        });\n      });\n    };\n    var tryAgain = function (bridge, element, offset, move, direction) {\n      return getBoxAt(bridge, element, offset).bind(function (box) {\n        return tryAt(bridge, direction, move(box, Retries.getJumpSize()));\n      });\n    };\n    var tryAt = function (bridge, direction, box) {\n      var browser = detect$3().browser;\n      if (browser.isChrome() || browser.isSafari() || browser.isFirefox() || browser.isEdge()) {\n        return direction.otherRetry(bridge, box);\n      } else if (browser.isIE()) {\n        return direction.ieRetry(bridge, box);\n      } else {\n        return Optional.none();\n      }\n    };\n    var tryCursor = function (bridge, isRoot, element, offset, direction) {\n      return getBoxAt(bridge, element, offset).bind(function (box) {\n        return tryAt(bridge, direction, box);\n      });\n    };\n    var handle$2 = function (bridge, isRoot, direction) {\n      return findSpot(bridge, isRoot, direction).bind(function (spot) {\n        return scan$1(bridge, isRoot, spot.element, spot.offset, direction, MAX_RETRIES).map(bridge.fromSitus);\n      });\n    };\n\n    var inSameTable = function (elem, table) {\n      return ancestor$2(elem, function (e) {\n        return parent(e).exists(function (p) {\n          return eq$1(p, table);\n        });\n      });\n    };\n    var simulate = function (bridge, isRoot, direction, initial, anchor) {\n      return closest$1(initial, 'td,th', isRoot).bind(function (start) {\n        return closest$1(start, 'table', isRoot).bind(function (table) {\n          if (!inSameTable(anchor, table)) {\n            return Optional.none();\n          }\n          return handle$2(bridge, isRoot, direction).bind(function (range) {\n            return closest$1(range.finish, 'td,th', isRoot).map(function (finish) {\n              return {\n                start: start,\n                finish: finish,\n                range: range\n              };\n            });\n          });\n        });\n      });\n    };\n    var navigate = function (bridge, isRoot, direction, initial, anchor, precheck) {\n      if (detect$3().browser.isIE()) {\n        return Optional.none();\n      } else {\n        return precheck(initial, isRoot).orThunk(function () {\n          return simulate(bridge, isRoot, direction, initial, anchor).map(function (info) {\n            var range = info.range;\n            return Response.create(Optional.some(makeSitus(range.start, range.soffset, range.finish, range.foffset)), true);\n          });\n        });\n      }\n    };\n    var firstUpCheck = function (initial, isRoot) {\n      return closest$1(initial, 'tr', isRoot).bind(function (startRow) {\n        return closest$1(startRow, 'table', isRoot).bind(function (table) {\n          var rows = descendants$1(table, 'tr');\n          if (eq$1(startRow, rows[0])) {\n            return seekLeft$1(table, function (element) {\n              return last$1(element).isSome();\n            }, isRoot).map(function (last) {\n              var lastOffset = getEnd(last);\n              return Response.create(Optional.some(makeSitus(last, lastOffset, last, lastOffset)), true);\n            });\n          } else {\n            return Optional.none();\n          }\n        });\n      });\n    };\n    var lastDownCheck = function (initial, isRoot) {\n      return closest$1(initial, 'tr', isRoot).bind(function (startRow) {\n        return closest$1(startRow, 'table', isRoot).bind(function (table) {\n          var rows = descendants$1(table, 'tr');\n          if (eq$1(startRow, rows[rows.length - 1])) {\n            return seekRight$1(table, function (element) {\n              return first(element).isSome();\n            }, isRoot).map(function (first) {\n              return Response.create(Optional.some(makeSitus(first, 0, first, 0)), true);\n            });\n          } else {\n            return Optional.none();\n          }\n        });\n      });\n    };\n    var select = function (bridge, container, isRoot, direction, initial, anchor, selectRange) {\n      return simulate(bridge, isRoot, direction, initial, anchor).bind(function (info) {\n        return detect$6(container, isRoot, info.start, info.finish, selectRange);\n      });\n    };\n\n    var value$1 = function () {\n      var subject = Cell(Optional.none());\n      var clear = function () {\n        return subject.set(Optional.none());\n      };\n      var set = function (s) {\n        return subject.set(Optional.some(s));\n      };\n      var isSet = function () {\n        return subject.get().isSome();\n      };\n      var on = function (f) {\n        return subject.get().each(f);\n      };\n      return {\n        clear: clear,\n        set: set,\n        isSet: isSet,\n        on: on\n      };\n    };\n\n    var findCell = function (target, isRoot) {\n      return closest$1(target, 'td,th', isRoot);\n    };\n    var MouseSelection = function (bridge, container, isRoot, annotations) {\n      var cursor = value$1();\n      var clearstate = cursor.clear;\n      var applySelection = function (event) {\n        cursor.on(function (start) {\n          annotations.clearBeforeUpdate(container);\n          findCell(event.target, isRoot).each(function (finish) {\n            identify(start, finish, isRoot).each(function (cellSel) {\n              var boxes = cellSel.boxes.getOr([]);\n              if (boxes.length > 1 || boxes.length === 1 && !eq$1(start, finish)) {\n                annotations.selectRange(container, boxes, cellSel.start, cellSel.finish);\n                bridge.selectContents(finish);\n              }\n            });\n          });\n        });\n      };\n      var mousedown = function (event) {\n        annotations.clear(container);\n        findCell(event.target, isRoot).each(cursor.set);\n      };\n      var mouseover = function (event) {\n        applySelection(event);\n      };\n      var mouseup = function (event) {\n        applySelection(event);\n        clearstate();\n      };\n      return {\n        clearstate: clearstate,\n        mousedown: mousedown,\n        mouseover: mouseover,\n        mouseup: mouseup\n      };\n    };\n\n    var down = {\n      traverse: nextSibling,\n      gather: after$5,\n      relative: Situ.before,\n      otherRetry: Retries.tryDown,\n      ieRetry: Retries.ieTryDown,\n      failure: BeforeAfter.failedDown\n    };\n    var up = {\n      traverse: prevSibling,\n      gather: before$4,\n      relative: Situ.before,\n      otherRetry: Retries.tryUp,\n      ieRetry: Retries.ieTryUp,\n      failure: BeforeAfter.failedUp\n    };\n\n    var isKey = function (key) {\n      return function (keycode) {\n        return keycode === key;\n      };\n    };\n    var isUp = isKey(38);\n    var isDown = isKey(40);\n    var isNavigation = function (keycode) {\n      return keycode >= 37 && keycode <= 40;\n    };\n    var ltr$2 = {\n      isBackward: isKey(37),\n      isForward: isKey(39)\n    };\n    var rtl$2 = {\n      isBackward: isKey(39),\n      isForward: isKey(37)\n    };\n\n    var get$d = function (_DOC) {\n      var doc = _DOC !== undefined ? _DOC.dom : document;\n      var x = doc.body.scrollLeft || doc.documentElement.scrollLeft;\n      var y = doc.body.scrollTop || doc.documentElement.scrollTop;\n      return SugarPosition(x, y);\n    };\n    var by = function (x, y, _DOC) {\n      var doc = _DOC !== undefined ? _DOC.dom : document;\n      var win = doc.defaultView;\n      if (win) {\n        win.scrollBy(x, y);\n      }\n    };\n\n    var WindowBridge = function (win) {\n      var elementFromPoint = function (x, y) {\n        return SugarElement.fromPoint(SugarElement.fromDom(win.document), x, y);\n      };\n      var getRect = function (element) {\n        return element.dom.getBoundingClientRect();\n      };\n      var getRangedRect = function (start, soffset, finish, foffset) {\n        var sel = SimSelection.exact(start, soffset, finish, foffset);\n        return getFirstRect$1(win, sel);\n      };\n      var getSelection = function () {\n        return get$c(win).map(function (exactAdt) {\n          return convertToRange(win, exactAdt);\n        });\n      };\n      var fromSitus = function (situs) {\n        var relative = SimSelection.relative(situs.start, situs.finish);\n        return convertToRange(win, relative);\n      };\n      var situsFromPoint = function (x, y) {\n        return getAtPoint(win, x, y).map(function (exact) {\n          return Situs.create(exact.start, exact.soffset, exact.finish, exact.foffset);\n        });\n      };\n      var clearSelection = function () {\n        clear(win);\n      };\n      var collapseSelection = function (toStart) {\n        if (toStart === void 0) {\n          toStart = false;\n        }\n        get$c(win).each(function (sel) {\n          return sel.fold(function (rng) {\n            return rng.collapse(toStart);\n          }, function (startSitu, finishSitu) {\n            var situ = toStart ? startSitu : finishSitu;\n            setRelative(win, situ, situ);\n          }, function (start, soffset, finish, foffset) {\n            var node = toStart ? start : finish;\n            var offset = toStart ? soffset : foffset;\n            setExact(win, node, offset, node, offset);\n          });\n        });\n      };\n      var selectContents = function (element) {\n        setToElement(win, element);\n      };\n      var setSelection = function (sel) {\n        setExact(win, sel.start, sel.soffset, sel.finish, sel.foffset);\n      };\n      var setRelativeSelection = function (start, finish) {\n        setRelative(win, start, finish);\n      };\n      var getInnerHeight = function () {\n        return win.innerHeight;\n      };\n      var getScrollY = function () {\n        var pos = get$d(SugarElement.fromDom(win.document));\n        return pos.top;\n      };\n      var scrollBy = function (x, y) {\n        by(x, y, SugarElement.fromDom(win.document));\n      };\n      return {\n        elementFromPoint: elementFromPoint,\n        getRect: getRect,\n        getRangedRect: getRangedRect,\n        getSelection: getSelection,\n        fromSitus: fromSitus,\n        situsFromPoint: situsFromPoint,\n        clearSelection: clearSelection,\n        collapseSelection: collapseSelection,\n        setSelection: setSelection,\n        setRelativeSelection: setRelativeSelection,\n        selectContents: selectContents,\n        getInnerHeight: getInnerHeight,\n        getScrollY: getScrollY,\n        scrollBy: scrollBy\n      };\n    };\n\n    var rc = function (rows, cols) {\n      return {\n        rows: rows,\n        cols: cols\n      };\n    };\n    var mouse = function (win, container, isRoot, annotations) {\n      var bridge = WindowBridge(win);\n      var handlers = MouseSelection(bridge, container, isRoot, annotations);\n      return {\n        clearstate: handlers.clearstate,\n        mousedown: handlers.mousedown,\n        mouseover: handlers.mouseover,\n        mouseup: handlers.mouseup\n      };\n    };\n    var keyboard = function (win, container, isRoot, annotations) {\n      var bridge = WindowBridge(win);\n      var clearToNavigate = function () {\n        annotations.clear(container);\n        return Optional.none();\n      };\n      var keydown = function (event, start, soffset, finish, foffset, direction) {\n        var realEvent = event.raw;\n        var keycode = realEvent.which;\n        var shiftKey = realEvent.shiftKey === true;\n        var handler = retrieve(container, annotations.selectedSelector).fold(function () {\n          if (isDown(keycode) && shiftKey) {\n            return curry(select, bridge, container, isRoot, down, finish, start, annotations.selectRange);\n          } else if (isUp(keycode) && shiftKey) {\n            return curry(select, bridge, container, isRoot, up, finish, start, annotations.selectRange);\n          } else if (isDown(keycode)) {\n            return curry(navigate, bridge, isRoot, down, finish, start, lastDownCheck);\n          } else if (isUp(keycode)) {\n            return curry(navigate, bridge, isRoot, up, finish, start, firstUpCheck);\n          } else {\n            return Optional.none;\n          }\n        }, function (selected) {\n          var update$1 = function (attempts) {\n            return function () {\n              var navigation = findMap(attempts, function (delta) {\n                return update(delta.rows, delta.cols, container, selected, annotations);\n              });\n              return navigation.fold(function () {\n                return getEdges(container, annotations.firstSelectedSelector, annotations.lastSelectedSelector).map(function (edges) {\n                  var relative = isDown(keycode) || direction.isForward(keycode) ? Situ.after : Situ.before;\n                  bridge.setRelativeSelection(Situ.on(edges.first, 0), relative(edges.table));\n                  annotations.clear(container);\n                  return Response.create(Optional.none(), true);\n                });\n              }, function (_) {\n                return Optional.some(Response.create(Optional.none(), true));\n              });\n            };\n          };\n          if (isDown(keycode) && shiftKey) {\n            return update$1([rc(+1, 0)]);\n          } else if (isUp(keycode) && shiftKey) {\n            return update$1([rc(-1, 0)]);\n          } else if (direction.isBackward(keycode) && shiftKey) {\n            return update$1([\n              rc(0, -1),\n              rc(-1, 0)\n            ]);\n          } else if (direction.isForward(keycode) && shiftKey) {\n            return update$1([\n              rc(0, +1),\n              rc(+1, 0)\n            ]);\n          } else if (isNavigation(keycode) && shiftKey === false) {\n            return clearToNavigate;\n          } else {\n            return Optional.none;\n          }\n        });\n        return handler();\n      };\n      var keyup = function (event, start, soffset, finish, foffset) {\n        return retrieve(container, annotations.selectedSelector).fold(function () {\n          var realEvent = event.raw;\n          var keycode = realEvent.which;\n          var shiftKey = realEvent.shiftKey === true;\n          if (shiftKey === false) {\n            return Optional.none();\n          }\n          if (isNavigation(keycode)) {\n            return sync(container, isRoot, start, soffset, finish, foffset, annotations.selectRange);\n          } else {\n            return Optional.none();\n          }\n        }, Optional.none);\n      };\n      return {\n        keydown: keydown,\n        keyup: keyup\n      };\n    };\n    var external = function (win, container, isRoot, annotations) {\n      var bridge = WindowBridge(win);\n      return function (start, finish) {\n        annotations.clearBeforeUpdate(container);\n        identify(start, finish, isRoot).each(function (cellSel) {\n          var boxes = cellSel.boxes.getOr([]);\n          annotations.selectRange(container, boxes, cellSel.start, cellSel.finish);\n          bridge.selectContents(finish);\n          bridge.collapseSelection();\n        });\n      };\n    };\n\n    var remove$7 = function (element, classes) {\n      each(classes, function (x) {\n        remove$5(element, x);\n      });\n    };\n\n    var addClass = function (clazz) {\n      return function (element) {\n        add$3(element, clazz);\n      };\n    };\n    var removeClasses = function (classes) {\n      return function (element) {\n        remove$7(element, classes);\n      };\n    };\n\n    var byClass = function (ephemera) {\n      var addSelectionClass = addClass(ephemera.selected);\n      var removeSelectionClasses = removeClasses([\n        ephemera.selected,\n        ephemera.lastSelected,\n        ephemera.firstSelected\n      ]);\n      var clear = function (container) {\n        var sels = descendants$1(container, ephemera.selectedSelector);\n        each(sels, removeSelectionClasses);\n      };\n      var selectRange = function (container, cells, start, finish) {\n        clear(container);\n        each(cells, addSelectionClass);\n        add$3(start, ephemera.firstSelected);\n        add$3(finish, ephemera.lastSelected);\n      };\n      return {\n        clearBeforeUpdate: clear,\n        clear: clear,\n        selectRange: selectRange,\n        selectedSelector: ephemera.selectedSelector,\n        firstSelectedSelector: ephemera.firstSelectedSelector,\n        lastSelectedSelector: ephemera.lastSelectedSelector\n      };\n    };\n    var byAttr = function (ephemera, onSelection, onClear) {\n      var removeSelectionAttributes = function (element) {\n        remove(element, ephemera.selected);\n        remove(element, ephemera.firstSelected);\n        remove(element, ephemera.lastSelected);\n      };\n      var addSelectionAttribute = function (element) {\n        set(element, ephemera.selected, '1');\n      };\n      var clear = function (container) {\n        clearBeforeUpdate(container);\n        onClear();\n      };\n      var clearBeforeUpdate = function (container) {\n        var sels = descendants$1(container, ephemera.selectedSelector);\n        each(sels, removeSelectionAttributes);\n      };\n      var selectRange = function (container, cells, start, finish) {\n        clear(container);\n        each(cells, addSelectionAttribute);\n        set(start, ephemera.firstSelected, '1');\n        set(finish, ephemera.lastSelected, '1');\n        onSelection(cells, start, finish);\n      };\n      return {\n        clearBeforeUpdate: clearBeforeUpdate,\n        clear: clear,\n        selectRange: selectRange,\n        selectedSelector: ephemera.selectedSelector,\n        firstSelectedSelector: ephemera.firstSelectedSelector,\n        lastSelectedSelector: ephemera.lastSelectedSelector\n      };\n    };\n    var SelectionAnnotation = {\n      byClass: byClass,\n      byAttr: byAttr\n    };\n\n    var getUpOrLeftCells = function (grid, selectedCells, generators) {\n      var upGrid = grid.slice(0, selectedCells[selectedCells.length - 1].row + 1);\n      var upDetails = toDetailList(upGrid, generators);\n      return bind(upDetails, function (detail) {\n        var slicedCells = detail.cells.slice(0, selectedCells[selectedCells.length - 1].column + 1);\n        return map(slicedCells, function (cell) {\n          return cell.element;\n        });\n      });\n    };\n    var getDownOrRightCells = function (grid, selectedCells, generators) {\n      var downGrid = grid.slice(selectedCells[0].row + selectedCells[0].rowspan - 1, grid.length);\n      var downDetails = toDetailList(downGrid, generators);\n      return bind(downDetails, function (detail) {\n        var slicedCells = detail.cells.slice(selectedCells[0].column + selectedCells[0].colspan - 1, detail.cells.length);\n        return map(slicedCells, function (cell) {\n          return cell.element;\n        });\n      });\n    };\n    var getOtherCells = function (table, target, generators) {\n      var warehouse = Warehouse.fromTable(table);\n      var details = onCells(warehouse, target);\n      return details.map(function (selectedCells) {\n        var grid = toGrid(warehouse, generators, false);\n        var upOrLeftCells = getUpOrLeftCells(grid, selectedCells, generators);\n        var downOrRightCells = getDownOrRightCells(grid, selectedCells, generators);\n        return {\n          upOrLeftCells: upOrLeftCells,\n          downOrRightCells: downOrRightCells\n        };\n      });\n    };\n\n    var hasInternalTarget = function (e) {\n      return has$1(SugarElement.fromDom(e.target), 'ephox-snooker-resizer-bar') === false;\n    };\n    function CellSelection (editor, lazyResize, selectionTargets) {\n      var onSelection = function (cells, start, finish) {\n        selectionTargets.targets().each(function (targets) {\n          var tableOpt = table(start);\n          tableOpt.each(function (table) {\n            var cloneFormats = getCloneElements(editor);\n            var generators = cellOperations(noop, SugarElement.fromDom(editor.getDoc()), cloneFormats);\n            var otherCells = getOtherCells(table, targets, generators);\n            fireTableSelectionChange(editor, cells, start, finish, otherCells);\n          });\n        });\n      };\n      var onClear = function () {\n        return fireTableSelectionClear(editor);\n      };\n      var annotations = SelectionAnnotation.byAttr(ephemera, onSelection, onClear);\n      editor.on('init', function (_e) {\n        var win = editor.getWin();\n        var body = getBody$1(editor);\n        var isRoot = getIsRoot(editor);\n        var syncSelection = function () {\n          var sel = editor.selection;\n          var start = SugarElement.fromDom(sel.getStart());\n          var end = SugarElement.fromDom(sel.getEnd());\n          var shared = sharedOne$1(table, [\n            start,\n            end\n          ]);\n          shared.fold(function () {\n            return annotations.clear(body);\n          }, noop);\n        };\n        var mouseHandlers = mouse(win, body, isRoot, annotations);\n        var keyHandlers = keyboard(win, body, isRoot, annotations);\n        var external$1 = external(win, body, isRoot, annotations);\n        var hasShiftKey = function (event) {\n          return event.raw.shiftKey === true;\n        };\n        editor.on('TableSelectorChange', function (e) {\n          return external$1(e.start, e.finish);\n        });\n        var handleResponse = function (event, response) {\n          if (!hasShiftKey(event)) {\n            return;\n          }\n          if (response.kill) {\n            event.kill();\n          }\n          response.selection.each(function (ns) {\n            var relative = SimSelection.relative(ns.start, ns.finish);\n            var rng = asLtrRange(win, relative);\n            editor.selection.setRng(rng);\n          });\n        };\n        var keyup = function (event) {\n          var wrappedEvent = fromRawEvent$1(event);\n          if (wrappedEvent.raw.shiftKey && isNavigation(wrappedEvent.raw.which)) {\n            var rng = editor.selection.getRng();\n            var start = SugarElement.fromDom(rng.startContainer);\n            var end = SugarElement.fromDom(rng.endContainer);\n            keyHandlers.keyup(wrappedEvent, start, rng.startOffset, end, rng.endOffset).each(function (response) {\n              handleResponse(wrappedEvent, response);\n            });\n          }\n        };\n        var keydown = function (event) {\n          var wrappedEvent = fromRawEvent$1(event);\n          lazyResize().each(function (resize) {\n            return resize.hideBars();\n          });\n          var rng = editor.selection.getRng();\n          var start = SugarElement.fromDom(rng.startContainer);\n          var end = SugarElement.fromDom(rng.endContainer);\n          var direction = onDirection(ltr$2, rtl$2)(SugarElement.fromDom(editor.selection.getStart()));\n          keyHandlers.keydown(wrappedEvent, start, rng.startOffset, end, rng.endOffset, direction).each(function (response) {\n            handleResponse(wrappedEvent, response);\n          });\n          lazyResize().each(function (resize) {\n            return resize.showBars();\n          });\n        };\n        var isLeftMouse = function (raw) {\n          return raw.button === 0;\n        };\n        var isLeftButtonPressed = function (raw) {\n          if (raw.buttons === undefined) {\n            return true;\n          }\n          if (global$2.browser.isEdge() && raw.buttons === 0) {\n            return true;\n          }\n          return (raw.buttons & 1) !== 0;\n        };\n        var dragStart = function (_e) {\n          mouseHandlers.clearstate();\n        };\n        var mouseDown = function (e) {\n          if (isLeftMouse(e) && hasInternalTarget(e)) {\n            mouseHandlers.mousedown(fromRawEvent$1(e));\n          }\n        };\n        var mouseOver = function (e) {\n          if (isLeftButtonPressed(e) && hasInternalTarget(e)) {\n            mouseHandlers.mouseover(fromRawEvent$1(e));\n          }\n        };\n        var mouseUp = function (e) {\n          if (isLeftMouse(e) && hasInternalTarget(e)) {\n            mouseHandlers.mouseup(fromRawEvent$1(e));\n          }\n        };\n        var getDoubleTap = function () {\n          var lastTarget = Cell(SugarElement.fromDom(body));\n          var lastTimeStamp = Cell(0);\n          var touchEnd = function (t) {\n            var target = SugarElement.fromDom(t.target);\n            if (name(target) === 'td' || name(target) === 'th') {\n              var lT = lastTarget.get();\n              var lTS = lastTimeStamp.get();\n              if (eq$1(lT, target) && t.timeStamp - lTS < 300) {\n                t.preventDefault();\n                external$1(target, target);\n              }\n            }\n            lastTarget.set(target);\n            lastTimeStamp.set(t.timeStamp);\n          };\n          return { touchEnd: touchEnd };\n        };\n        var doubleTap = getDoubleTap();\n        editor.on('dragstart', dragStart);\n        editor.on('mousedown', mouseDown);\n        editor.on('mouseover', mouseOver);\n        editor.on('mouseup', mouseUp);\n        editor.on('touchend', doubleTap.touchEnd);\n        editor.on('keyup', keyup);\n        editor.on('keydown', keydown);\n        editor.on('NodeChange', syncSelection);\n      });\n      return { clear: annotations.clear };\n    }\n\n    var getSelectionTargets = function (editor, selections) {\n      var targets = Cell(Optional.none());\n      var changeHandlers = Cell([]);\n      var selectionDetails = Optional.none();\n      var isCaption = isTag('caption');\n      var isDisabledForSelection = function (key) {\n        return selectionDetails.forall(function (details) {\n          return !details[key];\n        });\n      };\n      var findTargets = function () {\n        return getSelectionStartCellOrCaption(getSelectionStart(editor), getIsRoot(editor)).bind(function (cellOrCaption) {\n          var table$1 = table(cellOrCaption);\n          return table$1.map(function (table) {\n            if (isCaption(cellOrCaption)) {\n              return noMenu(cellOrCaption);\n            } else {\n              return forMenu(selections, table, cellOrCaption);\n            }\n          });\n        });\n      };\n      var getExtractedDetails = function (targets) {\n        var tableOpt = table(targets.element);\n        return tableOpt.map(function (table) {\n          var warehouse = Warehouse.fromTable(table);\n          var selectedCells = onCells(warehouse, targets).getOr([]);\n          var locked = foldl(selectedCells, function (acc, cell) {\n            if (cell.isLocked) {\n              acc.onAny = true;\n              if (cell.column === 0) {\n                acc.onFirst = true;\n              } else if (cell.column + cell.colspan >= warehouse.grid.columns) {\n                acc.onLast = true;\n              }\n            }\n            return acc;\n          }, {\n            onAny: false,\n            onFirst: false,\n            onLast: false\n          });\n          return {\n            mergeable: onUnlockedMergable(warehouse, targets).isSome(),\n            unmergeable: onUnlockedUnmergable(warehouse, targets).isSome(),\n            locked: locked\n          };\n        });\n      };\n      var resetTargets = function () {\n        targets.set(cached(findTargets)());\n        selectionDetails = targets.get().bind(getExtractedDetails);\n        each(changeHandlers.get(), function (handler) {\n          return handler();\n        });\n      };\n      var onSetup = function (api, isDisabled) {\n        var handler = function () {\n          return targets.get().fold(function () {\n            api.setDisabled(true);\n          }, function (targets) {\n            api.setDisabled(isDisabled(targets));\n          });\n        };\n        handler();\n        changeHandlers.set(changeHandlers.get().concat([handler]));\n        return function () {\n          changeHandlers.set(filter(changeHandlers.get(), function (h) {\n            return h !== handler;\n          }));\n        };\n      };\n      var isDisabledFromLocked = function (lockedDisable) {\n        return selectionDetails.exists(function (details) {\n          return details.locked[lockedDisable];\n        });\n      };\n      var onSetupTable = function (api) {\n        return onSetup(api, function (_) {\n          return false;\n        });\n      };\n      var onSetupCellOrRow = function (api) {\n        return onSetup(api, function (targets) {\n          return isCaption(targets.element);\n        });\n      };\n      var onSetupColumn = function (lockedDisable) {\n        return function (api) {\n          return onSetup(api, function (targets) {\n            return isCaption(targets.element) || isDisabledFromLocked(lockedDisable);\n          });\n        };\n      };\n      var onSetupPasteable = function (getClipboardData) {\n        return function (api) {\n          return onSetup(api, function (targets) {\n            return isCaption(targets.element) || getClipboardData().isNone();\n          });\n        };\n      };\n      var onSetupPasteableColumn = function (getClipboardData, lockedDisable) {\n        return function (api) {\n          return onSetup(api, function (targets) {\n            return isCaption(targets.element) || getClipboardData().isNone() || isDisabledFromLocked(lockedDisable);\n          });\n        };\n      };\n      var onSetupMergeable = function (api) {\n        return onSetup(api, function (_targets) {\n          return isDisabledForSelection('mergeable');\n        });\n      };\n      var onSetupUnmergeable = function (api) {\n        return onSetup(api, function (_targets) {\n          return isDisabledForSelection('unmergeable');\n        });\n      };\n      editor.on('NodeChange ExecCommand TableSelectorChange', resetTargets);\n      return {\n        onSetupTable: onSetupTable,\n        onSetupCellOrRow: onSetupCellOrRow,\n        onSetupColumn: onSetupColumn,\n        onSetupPasteable: onSetupPasteable,\n        onSetupPasteableColumn: onSetupPasteableColumn,\n        onSetupMergeable: onSetupMergeable,\n        onSetupUnmergeable: onSetupUnmergeable,\n        resetTargets: resetTargets,\n        targets: function () {\n          return targets.get();\n        }\n      };\n    };\n\n    var addButtons = function (editor, selectionTargets, clipboard) {\n      editor.ui.registry.addMenuButton('table', {\n        tooltip: 'Table',\n        icon: 'table',\n        fetch: function (callback) {\n          return callback('inserttable | cell row column | advtablesort | tableprops deletetable');\n        }\n      });\n      var cmd = function (command) {\n        return function () {\n          return editor.execCommand(command);\n        };\n      };\n      editor.ui.registry.addButton('tableprops', {\n        tooltip: 'Table properties',\n        onAction: cmd('mceTableProps'),\n        icon: 'table',\n        onSetup: selectionTargets.onSetupTable\n      });\n      editor.ui.registry.addButton('tabledelete', {\n        tooltip: 'Delete table',\n        onAction: cmd('mceTableDelete'),\n        icon: 'table-delete-table',\n        onSetup: selectionTargets.onSetupTable\n      });\n      editor.ui.registry.addButton('tablecellprops', {\n        tooltip: 'Cell properties',\n        onAction: cmd('mceTableCellProps'),\n        icon: 'table-cell-properties',\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n      editor.ui.registry.addButton('tablemergecells', {\n        tooltip: 'Merge cells',\n        onAction: cmd('mceTableMergeCells'),\n        icon: 'table-merge-cells',\n        onSetup: selectionTargets.onSetupMergeable\n      });\n      editor.ui.registry.addButton('tablesplitcells', {\n        tooltip: 'Split cell',\n        onAction: cmd('mceTableSplitCells'),\n        icon: 'table-split-cells',\n        onSetup: selectionTargets.onSetupUnmergeable\n      });\n      editor.ui.registry.addButton('tableinsertrowbefore', {\n        tooltip: 'Insert row before',\n        onAction: cmd('mceTableInsertRowBefore'),\n        icon: 'table-insert-row-above',\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n      editor.ui.registry.addButton('tableinsertrowafter', {\n        tooltip: 'Insert row after',\n        onAction: cmd('mceTableInsertRowAfter'),\n        icon: 'table-insert-row-after',\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n      editor.ui.registry.addButton('tabledeleterow', {\n        tooltip: 'Delete row',\n        onAction: cmd('mceTableDeleteRow'),\n        icon: 'table-delete-row',\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n      editor.ui.registry.addButton('tablerowprops', {\n        tooltip: 'Row properties',\n        onAction: cmd('mceTableRowProps'),\n        icon: 'table-row-properties',\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n      editor.ui.registry.addButton('tableinsertcolbefore', {\n        tooltip: 'Insert column before',\n        onAction: cmd('mceTableInsertColBefore'),\n        icon: 'table-insert-column-before',\n        onSetup: selectionTargets.onSetupColumn('onFirst')\n      });\n      editor.ui.registry.addButton('tableinsertcolafter', {\n        tooltip: 'Insert column after',\n        onAction: cmd('mceTableInsertColAfter'),\n        icon: 'table-insert-column-after',\n        onSetup: selectionTargets.onSetupColumn('onLast')\n      });\n      editor.ui.registry.addButton('tabledeletecol', {\n        tooltip: 'Delete column',\n        onAction: cmd('mceTableDeleteCol'),\n        icon: 'table-delete-column',\n        onSetup: selectionTargets.onSetupColumn('onAny')\n      });\n      editor.ui.registry.addButton('tablecutrow', {\n        tooltip: 'Cut row',\n        icon: 'cut-row',\n        onAction: cmd('mceTableCutRow'),\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n      editor.ui.registry.addButton('tablecopyrow', {\n        tooltip: 'Copy row',\n        icon: 'duplicate-row',\n        onAction: cmd('mceTableCopyRow'),\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n      editor.ui.registry.addButton('tablepasterowbefore', {\n        tooltip: 'Paste row before',\n        icon: 'paste-row-before',\n        onAction: cmd('mceTablePasteRowBefore'),\n        onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)\n      });\n      editor.ui.registry.addButton('tablepasterowafter', {\n        tooltip: 'Paste row after',\n        icon: 'paste-row-after',\n        onAction: cmd('mceTablePasteRowAfter'),\n        onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)\n      });\n      editor.ui.registry.addButton('tablecutcol', {\n        tooltip: 'Cut column',\n        icon: 'cut-column',\n        onAction: cmd('mceTableCutCol'),\n        onSetup: selectionTargets.onSetupColumn('onAny')\n      });\n      editor.ui.registry.addButton('tablecopycol', {\n        tooltip: 'Copy column',\n        icon: 'duplicate-column',\n        onAction: cmd('mceTableCopyCol'),\n        onSetup: selectionTargets.onSetupColumn('onAny')\n      });\n      editor.ui.registry.addButton('tablepastecolbefore', {\n        tooltip: 'Paste column before',\n        icon: 'paste-column-before',\n        onAction: cmd('mceTablePasteColBefore'),\n        onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onFirst')\n      });\n      editor.ui.registry.addButton('tablepastecolafter', {\n        tooltip: 'Paste column after',\n        icon: 'paste-column-after',\n        onAction: cmd('mceTablePasteColAfter'),\n        onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onLast')\n      });\n      editor.ui.registry.addButton('tableinsertdialog', {\n        tooltip: 'Insert table',\n        onAction: cmd('mceInsertTable'),\n        icon: 'table'\n      });\n    };\n    var addToolbars = function (editor) {\n      var isTable = function (table) {\n        return editor.dom.is(table, 'table') && editor.getBody().contains(table);\n      };\n      var toolbar = getToolbar(editor);\n      if (toolbar.length > 0) {\n        editor.ui.registry.addContextToolbar('table', {\n          predicate: isTable,\n          items: toolbar,\n          scope: 'node',\n          position: 'node'\n        });\n      }\n    };\n\n    var addMenuItems = function (editor, selectionTargets, clipboard) {\n      var cmd = function (command) {\n        return function () {\n          return editor.execCommand(command);\n        };\n      };\n      var insertTableAction = function (data) {\n        editor.execCommand('mceInsertTable', false, {\n          rows: data.numRows,\n          columns: data.numColumns\n        });\n      };\n      var tableProperties = {\n        text: 'Table properties',\n        onSetup: selectionTargets.onSetupTable,\n        onAction: cmd('mceTableProps')\n      };\n      var deleteTable = {\n        text: 'Delete table',\n        icon: 'table-delete-table',\n        onSetup: selectionTargets.onSetupTable,\n        onAction: cmd('mceTableDelete')\n      };\n      editor.ui.registry.addMenuItem('tableinsertrowbefore', {\n        text: 'Insert row before',\n        icon: 'table-insert-row-above',\n        onAction: cmd('mceTableInsertRowBefore'),\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n      editor.ui.registry.addMenuItem('tableinsertrowafter', {\n        text: 'Insert row after',\n        icon: 'table-insert-row-after',\n        onAction: cmd('mceTableInsertRowAfter'),\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n      editor.ui.registry.addMenuItem('tabledeleterow', {\n        text: 'Delete row',\n        icon: 'table-delete-row',\n        onAction: cmd('mceTableDeleteRow'),\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n      editor.ui.registry.addMenuItem('tablerowprops', {\n        text: 'Row properties',\n        icon: 'table-row-properties',\n        onAction: cmd('mceTableRowProps'),\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n      editor.ui.registry.addMenuItem('tablecutrow', {\n        text: 'Cut row',\n        icon: 'cut-row',\n        onAction: cmd('mceTableCutRow'),\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n      editor.ui.registry.addMenuItem('tablecopyrow', {\n        text: 'Copy row',\n        icon: 'duplicate-row',\n        onAction: cmd('mceTableCopyRow'),\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n      editor.ui.registry.addMenuItem('tablepasterowbefore', {\n        text: 'Paste row before',\n        icon: 'paste-row-before',\n        onAction: cmd('mceTablePasteRowBefore'),\n        onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)\n      });\n      editor.ui.registry.addMenuItem('tablepasterowafter', {\n        text: 'Paste row after',\n        icon: 'paste-row-after',\n        onAction: cmd('mceTablePasteRowAfter'),\n        onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)\n      });\n      var row = {\n        type: 'nestedmenuitem',\n        text: 'Row',\n        getSubmenuItems: function () {\n          return 'tableinsertrowbefore tableinsertrowafter tabledeleterow tablerowprops | tablecutrow tablecopyrow tablepasterowbefore tablepasterowafter';\n        }\n      };\n      editor.ui.registry.addMenuItem('tableinsertcolumnbefore', {\n        text: 'Insert column before',\n        icon: 'table-insert-column-before',\n        onAction: cmd('mceTableInsertColBefore'),\n        onSetup: selectionTargets.onSetupColumn('onFirst')\n      });\n      editor.ui.registry.addMenuItem('tableinsertcolumnafter', {\n        text: 'Insert column after',\n        icon: 'table-insert-column-after',\n        onAction: cmd('mceTableInsertColAfter'),\n        onSetup: selectionTargets.onSetupColumn('onLast')\n      });\n      editor.ui.registry.addMenuItem('tabledeletecolumn', {\n        text: 'Delete column',\n        icon: 'table-delete-column',\n        onAction: cmd('mceTableDeleteCol'),\n        onSetup: selectionTargets.onSetupColumn('onAny')\n      });\n      editor.ui.registry.addMenuItem('tablecutcolumn', {\n        text: 'Cut column',\n        icon: 'cut-column',\n        onAction: cmd('mceTableCutCol'),\n        onSetup: selectionTargets.onSetupColumn('onAny')\n      });\n      editor.ui.registry.addMenuItem('tablecopycolumn', {\n        text: 'Copy column',\n        icon: 'duplicate-column',\n        onAction: cmd('mceTableCopyCol'),\n        onSetup: selectionTargets.onSetupColumn('onAny')\n      });\n      editor.ui.registry.addMenuItem('tablepastecolumnbefore', {\n        text: 'Paste column before',\n        icon: 'paste-column-before',\n        onAction: cmd('mceTablePasteColBefore'),\n        onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onFirst')\n      });\n      editor.ui.registry.addMenuItem('tablepastecolumnafter', {\n        text: 'Paste column after',\n        icon: 'paste-column-after',\n        onAction: cmd('mceTablePasteColAfter'),\n        onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onLast')\n      });\n      var column = {\n        type: 'nestedmenuitem',\n        text: 'Column',\n        getSubmenuItems: function () {\n          return 'tableinsertcolumnbefore tableinsertcolumnafter tabledeletecolumn | tablecutcolumn tablecopycolumn tablepastecolumnbefore tablepastecolumnafter';\n        }\n      };\n      editor.ui.registry.addMenuItem('tablecellprops', {\n        text: 'Cell properties',\n        icon: 'table-cell-properties',\n        onAction: cmd('mceTableCellProps'),\n        onSetup: selectionTargets.onSetupCellOrRow\n      });\n      editor.ui.registry.addMenuItem('tablemergecells', {\n        text: 'Merge cells',\n        icon: 'table-merge-cells',\n        onAction: cmd('mceTableMergeCells'),\n        onSetup: selectionTargets.onSetupMergeable\n      });\n      editor.ui.registry.addMenuItem('tablesplitcells', {\n        text: 'Split cell',\n        icon: 'table-split-cells',\n        onAction: cmd('mceTableSplitCells'),\n        onSetup: selectionTargets.onSetupUnmergeable\n      });\n      var cell = {\n        type: 'nestedmenuitem',\n        text: 'Cell',\n        getSubmenuItems: function () {\n          return 'tablecellprops tablemergecells tablesplitcells';\n        }\n      };\n      if (hasTableGrid(editor) === false) {\n        editor.ui.registry.addMenuItem('inserttable', {\n          text: 'Table',\n          icon: 'table',\n          onAction: cmd('mceInsertTable')\n        });\n      } else {\n        editor.ui.registry.addNestedMenuItem('inserttable', {\n          text: 'Table',\n          icon: 'table',\n          getSubmenuItems: function () {\n            return [{\n                type: 'fancymenuitem',\n                fancytype: 'inserttable',\n                onAction: insertTableAction\n              }];\n          }\n        });\n      }\n      editor.ui.registry.addMenuItem('inserttabledialog', {\n        text: 'Insert table',\n        icon: 'table',\n        onAction: cmd('mceInsertTable')\n      });\n      editor.ui.registry.addMenuItem('tableprops', tableProperties);\n      editor.ui.registry.addMenuItem('deletetable', deleteTable);\n      editor.ui.registry.addNestedMenuItem('row', row);\n      editor.ui.registry.addNestedMenuItem('column', column);\n      editor.ui.registry.addNestedMenuItem('cell', cell);\n      editor.ui.registry.addContextMenu('table', {\n        update: function () {\n          selectionTargets.resetTargets();\n          return selectionTargets.targets().fold(function () {\n            return '';\n          }, function (targets) {\n            if (name(targets.element) === 'caption') {\n              return 'tableprops deletetable';\n            } else {\n              return 'cell row column | advtablesort | tableprops deletetable';\n            }\n          });\n        }\n      });\n    };\n\n    var Plugin = function (editor) {\n      var selections = Selections(function () {\n        return getBody$1(editor);\n      }, function () {\n        return getSelectionStartCellOrCaption(getSelectionStart(editor));\n      }, ephemera.selectedSelector);\n      var selectionTargets = getSelectionTargets(editor, selections);\n      var resizeHandler = getResizeHandler(editor);\n      var cellSelection = CellSelection(editor, resizeHandler.lazyResize, selectionTargets);\n      var actions = TableActions(editor, resizeHandler.lazyWire, selections);\n      var clipboard = Clipboard();\n      registerCommands(editor, actions, cellSelection, selections, clipboard);\n      registerQueryCommands(editor, actions, selections);\n      registerEvents(editor, selections, actions, cellSelection);\n      addMenuItems(editor, selectionTargets, clipboard);\n      addButtons(editor, selectionTargets, clipboard);\n      addToolbars(editor);\n      editor.on('PreInit', function () {\n        editor.serializer.addTempAttr(ephemera.firstSelected);\n        editor.serializer.addTempAttr(ephemera.lastSelected);\n        registerFormats(editor);\n      });\n      if (hasTabNavigation(editor)) {\n        editor.on('keydown', function (e) {\n          handle$1(e, editor, cellSelection);\n        });\n      }\n      editor.on('remove', function () {\n        resizeHandler.destroy();\n      });\n      return getApi(editor, clipboard, resizeHandler, selectionTargets);\n    };\n    function Plugin$1 () {\n      global.add('table', Plugin);\n    }\n\n    Plugin$1();\n\n}());\n"]},"metadata":{},"sourceType":"script"}