{"ast":null,"code":"/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.8.2 (2021-06-23)\n */\n(function () {\n  'use strict';\n\n  var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n  var __assign = function () {\n    __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n\n      return t;\n    };\n\n    return __assign.apply(this, arguments);\n  };\n\n  var typeOf = function (x) {\n    var t = typeof x;\n\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n\n  var isType = function (type) {\n    return function (value) {\n      return typeOf(value) === type;\n    };\n  };\n\n  var isString = isType('string');\n  var isObject = isType('object');\n  var isArray = isType('array');\n\n  var isNullable = function (a) {\n    return a === null || a === undefined;\n  };\n\n  var isNonNullable = function (a) {\n    return !isNullable(a);\n  };\n\n  var noop = function () {};\n\n  var constant = function (value) {\n    return function () {\n      return value;\n    };\n  };\n\n  var never = constant(false);\n  var always = constant(true);\n\n  var none = function () {\n    return NONE;\n  };\n\n  var NONE = function () {\n    var eq = function (o) {\n      return o.isNone();\n    };\n\n    var call = function (thunk) {\n      return thunk();\n    };\n\n    var id = function (n) {\n      return n;\n    };\n\n    var me = {\n      fold: function (n, _s) {\n        return n();\n      },\n      is: never,\n      isSome: never,\n      isNone: always,\n      getOr: id,\n      getOrThunk: call,\n      getOrDie: function (msg) {\n        throw new Error(msg || 'error: getOrDie called on none.');\n      },\n      getOrNull: constant(null),\n      getOrUndefined: constant(undefined),\n      or: id,\n      orThunk: call,\n      map: none,\n      each: noop,\n      bind: none,\n      exists: never,\n      forall: always,\n      filter: none,\n      equals: eq,\n      equals_: eq,\n      toArray: function () {\n        return [];\n      },\n      toString: constant('none()')\n    };\n    return me;\n  }();\n\n  var some = function (a) {\n    var constant_a = constant(a);\n\n    var self = function () {\n      return me;\n    };\n\n    var bind = function (f) {\n      return f(a);\n    };\n\n    var me = {\n      fold: function (n, s) {\n        return s(a);\n      },\n      is: function (v) {\n        return a === v;\n      },\n      isSome: always,\n      isNone: never,\n      getOr: constant_a,\n      getOrThunk: constant_a,\n      getOrDie: constant_a,\n      getOrNull: constant_a,\n      getOrUndefined: constant_a,\n      or: self,\n      orThunk: self,\n      map: function (f) {\n        return some(f(a));\n      },\n      each: function (f) {\n        f(a);\n      },\n      bind: bind,\n      exists: bind,\n      forall: bind,\n      filter: function (f) {\n        return f(a) ? me : NONE;\n      },\n      toArray: function () {\n        return [a];\n      },\n      toString: function () {\n        return 'some(' + a + ')';\n      },\n      equals: function (o) {\n        return o.is(a);\n      },\n      equals_: function (o, elementEq) {\n        return o.fold(never, function (b) {\n          return elementEq(a, b);\n        });\n      }\n    };\n    return me;\n  };\n\n  var from = function (value) {\n    return value === null || value === undefined ? NONE : some(value);\n  };\n\n  var Optional = {\n    some: some,\n    none: none,\n    from: from\n  };\n  var nativePush = Array.prototype.push;\n\n  var each = function (xs, f) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n\n  var flatten = function (xs) {\n    var r = [];\n\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n\n      nativePush.apply(r, xs[i]);\n    }\n\n    return r;\n  };\n\n  var Cell = function (initial) {\n    var value = initial;\n\n    var get = function () {\n      return value;\n    };\n\n    var set = function (v) {\n      value = v;\n    };\n\n    return {\n      get: get,\n      set: set\n    };\n  };\n\n  var keys = Object.keys;\n  var hasOwnProperty = Object.hasOwnProperty;\n\n  var each$1 = function (obj, f) {\n    var props = keys(obj);\n\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n\n  var get = function (obj, key) {\n    return has(obj, key) ? Optional.from(obj[key]) : Optional.none();\n  };\n\n  var has = function (obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n\n  var getScripts = function (editor) {\n    return editor.getParam('media_scripts');\n  };\n\n  var getAudioTemplateCallback = function (editor) {\n    return editor.getParam('audio_template_callback');\n  };\n\n  var getVideoTemplateCallback = function (editor) {\n    return editor.getParam('video_template_callback');\n  };\n\n  var hasLiveEmbeds = function (editor) {\n    return editor.getParam('media_live_embeds', true);\n  };\n\n  var shouldFilterHtml = function (editor) {\n    return editor.getParam('media_filter_html', true);\n  };\n\n  var getUrlResolver = function (editor) {\n    return editor.getParam('media_url_resolver');\n  };\n\n  var hasAltSource = function (editor) {\n    return editor.getParam('media_alt_source', true);\n  };\n\n  var hasPoster = function (editor) {\n    return editor.getParam('media_poster', true);\n  };\n\n  var hasDimensions = function (editor) {\n    return editor.getParam('media_dimensions', true);\n  };\n\n  var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n  var global$2 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n  var global$3 = tinymce.util.Tools.resolve('tinymce.html.SaxParser');\n\n  var getVideoScriptMatch = function (prefixes, src) {\n    if (prefixes) {\n      for (var i = 0; i < prefixes.length; i++) {\n        if (src.indexOf(prefixes[i].filter) !== -1) {\n          return prefixes[i];\n        }\n      }\n    }\n  };\n\n  var DOM = global$2.DOM;\n\n  var trimPx = function (value) {\n    return value.replace(/px$/, '');\n  };\n\n  var getEphoxEmbedData = function (attrs) {\n    var style = attrs.map.style;\n    var styles = style ? DOM.parseStyle(style) : {};\n    return {\n      type: 'ephox-embed-iri',\n      source: attrs.map['data-ephox-embed-iri'],\n      altsource: '',\n      poster: '',\n      width: get(styles, 'max-width').map(trimPx).getOr(''),\n      height: get(styles, 'max-height').map(trimPx).getOr('')\n    };\n  };\n\n  var htmlToData = function (prefixes, html) {\n    var isEphoxEmbed = Cell(false);\n    var data = {};\n    global$3({\n      validate: false,\n      allow_conditional_comments: true,\n      start: function (name, attrs) {\n        if (isEphoxEmbed.get()) ;else if (has(attrs.map, 'data-ephox-embed-iri')) {\n          isEphoxEmbed.set(true);\n          data = getEphoxEmbedData(attrs);\n        } else {\n          if (!data.source && name === 'param') {\n            data.source = attrs.map.movie;\n          }\n\n          if (name === 'iframe' || name === 'object' || name === 'embed' || name === 'video' || name === 'audio') {\n            if (!data.type) {\n              data.type = name;\n            }\n\n            data = global$1.extend(attrs.map, data);\n          }\n\n          if (name === 'script') {\n            var videoScript = getVideoScriptMatch(prefixes, attrs.map.src);\n\n            if (!videoScript) {\n              return;\n            }\n\n            data = {\n              type: 'script',\n              source: attrs.map.src,\n              width: String(videoScript.width),\n              height: String(videoScript.height)\n            };\n          }\n\n          if (name === 'source') {\n            if (!data.source) {\n              data.source = attrs.map.src;\n            } else if (!data.altsource) {\n              data.altsource = attrs.map.src;\n            }\n          }\n\n          if (name === 'img' && !data.poster) {\n            data.poster = attrs.map.src;\n          }\n        }\n      }\n    }).parse(html);\n    data.source = data.source || data.src || data.data;\n    data.altsource = data.altsource || '';\n    data.poster = data.poster || '';\n    return data;\n  };\n\n  var guess = function (url) {\n    var mimes = {\n      mp3: 'audio/mpeg',\n      m4a: 'audio/x-m4a',\n      wav: 'audio/wav',\n      mp4: 'video/mp4',\n      webm: 'video/webm',\n      ogg: 'video/ogg',\n      swf: 'application/x-shockwave-flash'\n    };\n    var fileEnd = url.toLowerCase().split('.').pop();\n    var mime = mimes[fileEnd];\n    return mime ? mime : '';\n  };\n\n  var global$4 = tinymce.util.Tools.resolve('tinymce.html.Schema');\n  var global$5 = tinymce.util.Tools.resolve('tinymce.html.Writer');\n  var DOM$1 = global$2.DOM;\n\n  var addPx = function (value) {\n    return /^[0-9.]+$/.test(value) ? value + 'px' : value;\n  };\n\n  var setAttributes = function (attrs, updatedAttrs) {\n    each$1(updatedAttrs, function (val, name) {\n      var value = '' + val;\n\n      if (attrs.map[name]) {\n        var i = attrs.length;\n\n        while (i--) {\n          var attr = attrs[i];\n\n          if (attr.name === name) {\n            if (value) {\n              attrs.map[name] = value;\n              attr.value = value;\n            } else {\n              delete attrs.map[name];\n              attrs.splice(i, 1);\n            }\n          }\n        }\n      } else if (value) {\n        attrs.push({\n          name: name,\n          value: value\n        });\n        attrs.map[name] = value;\n      }\n    });\n  };\n\n  var updateEphoxEmbed = function (data, attrs) {\n    var style = attrs.map.style;\n    var styleMap = style ? DOM$1.parseStyle(style) : {};\n    styleMap['max-width'] = addPx(data.width);\n    styleMap['max-height'] = addPx(data.height);\n    setAttributes(attrs, {\n      style: DOM$1.serializeStyle(styleMap)\n    });\n  };\n\n  var sources = ['source', 'altsource'];\n\n  var updateHtml = function (html, data, updateAll) {\n    var writer = global$5();\n    var isEphoxEmbed = Cell(false);\n    var sourceCount = 0;\n    var hasImage;\n    global$3({\n      validate: false,\n      allow_conditional_comments: true,\n      comment: function (text) {\n        writer.comment(text);\n      },\n      cdata: function (text) {\n        writer.cdata(text);\n      },\n      text: function (text, raw) {\n        writer.text(text, raw);\n      },\n      start: function (name, attrs, empty) {\n        if (isEphoxEmbed.get()) ;else if (has(attrs.map, 'data-ephox-embed-iri')) {\n          isEphoxEmbed.set(true);\n          updateEphoxEmbed(data, attrs);\n        } else {\n          switch (name) {\n            case 'video':\n            case 'object':\n            case 'embed':\n            case 'img':\n            case 'iframe':\n              if (data.height !== undefined && data.width !== undefined) {\n                setAttributes(attrs, {\n                  width: data.width,\n                  height: data.height\n                });\n              }\n\n              break;\n          }\n\n          if (updateAll) {\n            switch (name) {\n              case 'video':\n                setAttributes(attrs, {\n                  poster: data.poster,\n                  src: ''\n                });\n\n                if (data.altsource) {\n                  setAttributes(attrs, {\n                    src: ''\n                  });\n                }\n\n                break;\n\n              case 'iframe':\n                setAttributes(attrs, {\n                  src: data.source\n                });\n                break;\n\n              case 'source':\n                if (sourceCount < 2) {\n                  setAttributes(attrs, {\n                    src: data[sources[sourceCount]],\n                    type: data[sources[sourceCount] + 'mime']\n                  });\n\n                  if (!data[sources[sourceCount]]) {\n                    return;\n                  }\n                }\n\n                sourceCount++;\n                break;\n\n              case 'img':\n                if (!data.poster) {\n                  return;\n                }\n\n                hasImage = true;\n                break;\n            }\n          }\n        }\n        writer.start(name, attrs, empty);\n      },\n      end: function (name) {\n        if (!isEphoxEmbed.get()) {\n          if (name === 'video' && updateAll) {\n            for (var index = 0; index < 2; index++) {\n              if (data[sources[index]]) {\n                var attrs = [];\n                attrs.map = {};\n\n                if (sourceCount <= index) {\n                  setAttributes(attrs, {\n                    src: data[sources[index]],\n                    type: data[sources[index] + 'mime']\n                  });\n                  writer.start('source', attrs, true);\n                }\n              }\n            }\n          }\n\n          if (data.poster && name === 'object' && updateAll && !hasImage) {\n            var imgAttrs = [];\n            imgAttrs.map = {};\n            setAttributes(imgAttrs, {\n              src: data.poster,\n              width: data.width,\n              height: data.height\n            });\n            writer.start('img', imgAttrs, true);\n          }\n        }\n\n        writer.end(name);\n      }\n    }, global$4({})).parse(html);\n    return writer.getContent();\n  };\n\n  var urlPatterns = [{\n    regex: /youtu\\.be\\/([\\w\\-_\\?&=.]+)/i,\n    type: 'iframe',\n    w: 560,\n    h: 314,\n    url: 'www.youtube.com/embed/$1',\n    allowFullscreen: true\n  }, {\n    regex: /youtube\\.com(.+)v=([^&]+)(&([a-z0-9&=\\-_]+))?/i,\n    type: 'iframe',\n    w: 560,\n    h: 314,\n    url: 'www.youtube.com/embed/$2?$4',\n    allowFullscreen: true\n  }, {\n    regex: /youtube.com\\/embed\\/([a-z0-9\\?&=\\-_]+)/i,\n    type: 'iframe',\n    w: 560,\n    h: 314,\n    url: 'www.youtube.com/embed/$1',\n    allowFullscreen: true\n  }, {\n    regex: /vimeo\\.com\\/([0-9]+)/,\n    type: 'iframe',\n    w: 425,\n    h: 350,\n    url: 'player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc',\n    allowFullscreen: true\n  }, {\n    regex: /vimeo\\.com\\/(.*)\\/([0-9]+)/,\n    type: 'iframe',\n    w: 425,\n    h: 350,\n    url: 'player.vimeo.com/video/$2?title=0&amp;byline=0',\n    allowFullscreen: true\n  }, {\n    regex: /maps\\.google\\.([a-z]{2,3})\\/maps\\/(.+)msid=(.+)/,\n    type: 'iframe',\n    w: 425,\n    h: 350,\n    url: 'maps.google.com/maps/ms?msid=$2&output=embed\"',\n    allowFullscreen: false\n  }, {\n    regex: /dailymotion\\.com\\/video\\/([^_]+)/,\n    type: 'iframe',\n    w: 480,\n    h: 270,\n    url: 'www.dailymotion.com/embed/video/$1',\n    allowFullscreen: true\n  }, {\n    regex: /dai\\.ly\\/([^_]+)/,\n    type: 'iframe',\n    w: 480,\n    h: 270,\n    url: 'www.dailymotion.com/embed/video/$1',\n    allowFullscreen: true\n  }];\n\n  var getProtocol = function (url) {\n    var protocolMatches = url.match(/^(https?:\\/\\/|www\\.)(.+)$/i);\n\n    if (protocolMatches && protocolMatches.length > 1) {\n      return protocolMatches[1] === 'www.' ? 'https://' : protocolMatches[1];\n    } else {\n      return 'https://';\n    }\n  };\n\n  var getUrl = function (pattern, url) {\n    var protocol = getProtocol(url);\n    var match = pattern.regex.exec(url);\n    var newUrl = protocol + pattern.url;\n\n    var _loop_1 = function (i) {\n      newUrl = newUrl.replace('$' + i, function () {\n        return match[i] ? match[i] : '';\n      });\n    };\n\n    for (var i = 0; i < match.length; i++) {\n      _loop_1(i);\n    }\n\n    return newUrl.replace(/\\?$/, '');\n  };\n\n  var matchPattern = function (url) {\n    var patterns = urlPatterns.filter(function (pattern) {\n      return pattern.regex.test(url);\n    });\n\n    if (patterns.length > 0) {\n      return global$1.extend({}, patterns[0], {\n        url: getUrl(patterns[0], url)\n      });\n    } else {\n      return null;\n    }\n  };\n\n  var getIframeHtml = function (data) {\n    var allowFullscreen = data.allowfullscreen ? ' allowFullscreen=\"1\"' : '';\n    return '<iframe src=\"' + data.source + '\" width=\"' + data.width + '\" height=\"' + data.height + '\"' + allowFullscreen + '></iframe>';\n  };\n\n  var getFlashHtml = function (data) {\n    var html = '<object data=\"' + data.source + '\" width=\"' + data.width + '\" height=\"' + data.height + '\" type=\"application/x-shockwave-flash\">';\n\n    if (data.poster) {\n      html += '<img src=\"' + data.poster + '\" width=\"' + data.width + '\" height=\"' + data.height + '\" />';\n    }\n\n    html += '</object>';\n    return html;\n  };\n\n  var getAudioHtml = function (data, audioTemplateCallback) {\n    if (audioTemplateCallback) {\n      return audioTemplateCallback(data);\n    } else {\n      return '<audio controls=\"controls\" src=\"' + data.source + '\">' + (data.altsource ? '\\n<source src=\"' + data.altsource + '\"' + (data.altsourcemime ? ' type=\"' + data.altsourcemime + '\"' : '') + ' />\\n' : '') + '</audio>';\n    }\n  };\n\n  var getVideoHtml = function (data, videoTemplateCallback) {\n    if (videoTemplateCallback) {\n      return videoTemplateCallback(data);\n    } else {\n      return '<video width=\"' + data.width + '\" height=\"' + data.height + '\"' + (data.poster ? ' poster=\"' + data.poster + '\"' : '') + ' controls=\"controls\">\\n' + '<source src=\"' + data.source + '\"' + (data.sourcemime ? ' type=\"' + data.sourcemime + '\"' : '') + ' />\\n' + (data.altsource ? '<source src=\"' + data.altsource + '\"' + (data.altsourcemime ? ' type=\"' + data.altsourcemime + '\"' : '') + ' />\\n' : '') + '</video>';\n    }\n  };\n\n  var getScriptHtml = function (data) {\n    return '<script src=\"' + data.source + '\"></script>';\n  };\n\n  var dataToHtml = function (editor, dataIn) {\n    var data = global$1.extend({}, dataIn);\n\n    if (!data.source) {\n      global$1.extend(data, htmlToData(getScripts(editor), data.embed));\n\n      if (!data.source) {\n        return '';\n      }\n    }\n\n    if (!data.altsource) {\n      data.altsource = '';\n    }\n\n    if (!data.poster) {\n      data.poster = '';\n    }\n\n    data.source = editor.convertURL(data.source, 'source');\n    data.altsource = editor.convertURL(data.altsource, 'source');\n    data.sourcemime = guess(data.source);\n    data.altsourcemime = guess(data.altsource);\n    data.poster = editor.convertURL(data.poster, 'poster');\n    var pattern = matchPattern(data.source);\n\n    if (pattern) {\n      data.source = pattern.url;\n      data.type = pattern.type;\n      data.allowfullscreen = pattern.allowFullscreen;\n      data.width = data.width || String(pattern.w);\n      data.height = data.height || String(pattern.h);\n    }\n\n    if (data.embed) {\n      return updateHtml(data.embed, data, true);\n    } else {\n      var videoScript = getVideoScriptMatch(getScripts(editor), data.source);\n\n      if (videoScript) {\n        data.type = 'script';\n        data.width = String(videoScript.width);\n        data.height = String(videoScript.height);\n      }\n\n      var audioTemplateCallback = getAudioTemplateCallback(editor);\n      var videoTemplateCallback = getVideoTemplateCallback(editor);\n      data.width = data.width || '300';\n      data.height = data.height || '150';\n      global$1.each(data, function (value, key) {\n        data[key] = editor.dom.encode('' + value);\n      });\n\n      if (data.type === 'iframe') {\n        return getIframeHtml(data);\n      } else if (data.sourcemime === 'application/x-shockwave-flash') {\n        return getFlashHtml(data);\n      } else if (data.sourcemime.indexOf('audio') !== -1) {\n        return getAudioHtml(data, audioTemplateCallback);\n      } else if (data.type === 'script') {\n        return getScriptHtml(data);\n      } else {\n        return getVideoHtml(data, videoTemplateCallback);\n      }\n    }\n  };\n\n  var global$6 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n  var cache = {};\n\n  var embedPromise = function (data, dataToHtml, handler) {\n    return new global$6(function (res, rej) {\n      var wrappedResolve = function (response) {\n        if (response.html) {\n          cache[data.source] = response;\n        }\n\n        return res({\n          url: data.source,\n          html: response.html ? response.html : dataToHtml(data)\n        });\n      };\n\n      if (cache[data.source]) {\n        wrappedResolve(cache[data.source]);\n      } else {\n        handler({\n          url: data.source\n        }, wrappedResolve, rej);\n      }\n    });\n  };\n\n  var defaultPromise = function (data, dataToHtml) {\n    return new global$6(function (res) {\n      res({\n        html: dataToHtml(data),\n        url: data.source\n      });\n    });\n  };\n\n  var loadedData = function (editor) {\n    return function (data) {\n      return dataToHtml(editor, data);\n    };\n  };\n\n  var getEmbedHtml = function (editor, data) {\n    var embedHandler = getUrlResolver(editor);\n    return embedHandler ? embedPromise(data, loadedData(editor), embedHandler) : defaultPromise(data, loadedData(editor));\n  };\n\n  var isCached = function (url) {\n    return cache.hasOwnProperty(url);\n  };\n\n  var extractMeta = function (sourceInput, data) {\n    return get(data, sourceInput).bind(function (mainData) {\n      return get(mainData, 'meta');\n    });\n  };\n\n  var getValue = function (data, metaData, sourceInput) {\n    return function (prop) {\n      var _a;\n\n      var getFromData = function () {\n        return get(data, prop);\n      };\n\n      var getFromMetaData = function () {\n        return get(metaData, prop);\n      };\n\n      var getNonEmptyValue = function (c) {\n        return get(c, 'value').bind(function (v) {\n          return v.length > 0 ? Optional.some(v) : Optional.none();\n        });\n      };\n\n      var getFromValueFirst = function () {\n        return getFromData().bind(function (child) {\n          return isObject(child) ? getNonEmptyValue(child).orThunk(getFromMetaData) : getFromMetaData().orThunk(function () {\n            return Optional.from(child);\n          });\n        });\n      };\n\n      var getFromMetaFirst = function () {\n        return getFromMetaData().orThunk(function () {\n          return getFromData().bind(function (child) {\n            return isObject(child) ? getNonEmptyValue(child) : Optional.from(child);\n          });\n        });\n      };\n\n      return _a = {}, _a[prop] = (prop === sourceInput ? getFromValueFirst() : getFromMetaFirst()).getOr(''), _a;\n    };\n  };\n\n  var getDimensions = function (data, metaData) {\n    var dimensions = {};\n    get(data, 'dimensions').each(function (dims) {\n      each(['width', 'height'], function (prop) {\n        get(metaData, prop).orThunk(function () {\n          return get(dims, prop);\n        }).each(function (value) {\n          return dimensions[prop] = value;\n        });\n      });\n    });\n    return dimensions;\n  };\n\n  var unwrap = function (data, sourceInput) {\n    var metaData = sourceInput ? extractMeta(sourceInput, data).getOr({}) : {};\n    var get = getValue(data, metaData, sourceInput);\n    return __assign(__assign(__assign(__assign(__assign({}, get('source')), get('altsource')), get('poster')), get('embed')), getDimensions(data, metaData));\n  };\n\n  var wrap = function (data) {\n    var wrapped = __assign(__assign({}, data), {\n      source: {\n        value: get(data, 'source').getOr('')\n      },\n      altsource: {\n        value: get(data, 'altsource').getOr('')\n      },\n      poster: {\n        value: get(data, 'poster').getOr('')\n      }\n    });\n\n    each(['width', 'height'], function (prop) {\n      get(data, prop).each(function (value) {\n        var dimensions = wrapped.dimensions || {};\n        dimensions[prop] = value;\n        wrapped.dimensions = dimensions;\n      });\n    });\n    return wrapped;\n  };\n\n  var handleError = function (editor) {\n    return function (error) {\n      var errorMessage = error && error.msg ? 'Media embed handler error: ' + error.msg : 'Media embed handler threw unknown error.';\n      editor.notificationManager.open({\n        type: 'error',\n        text: errorMessage\n      });\n    };\n  };\n\n  var snippetToData = function (editor, embedSnippet) {\n    return htmlToData(getScripts(editor), embedSnippet);\n  };\n\n  var isMediaElement = function (element) {\n    return element.getAttribute('data-mce-object') || element.getAttribute('data-ephox-embed-iri');\n  };\n\n  var getEditorData = function (editor) {\n    var element = editor.selection.getNode();\n    var snippet = isMediaElement(element) ? editor.serializer.serialize(element, {\n      selection: true\n    }) : '';\n    return __assign({\n      embed: snippet\n    }, htmlToData(getScripts(editor), snippet));\n  };\n\n  var addEmbedHtml = function (api, editor) {\n    return function (response) {\n      if (isString(response.url) && response.url.trim().length > 0) {\n        var html = response.html;\n        var snippetData = snippetToData(editor, html);\n\n        var nuData = __assign(__assign({}, snippetData), {\n          source: response.url,\n          embed: html\n        });\n\n        api.setData(wrap(nuData));\n      }\n    };\n  };\n\n  var selectPlaceholder = function (editor, beforeObjects) {\n    var afterObjects = editor.dom.select('*[data-mce-object]');\n\n    for (var i = 0; i < beforeObjects.length; i++) {\n      for (var y = afterObjects.length - 1; y >= 0; y--) {\n        if (beforeObjects[i] === afterObjects[y]) {\n          afterObjects.splice(y, 1);\n        }\n      }\n    }\n\n    editor.selection.select(afterObjects[0]);\n  };\n\n  var handleInsert = function (editor, html) {\n    var beforeObjects = editor.dom.select('*[data-mce-object]');\n    editor.insertContent(html);\n    selectPlaceholder(editor, beforeObjects);\n    editor.nodeChanged();\n  };\n\n  var submitForm = function (prevData, newData, editor) {\n    newData.embed = updateHtml(newData.embed, newData);\n\n    if (newData.embed && (prevData.source === newData.source || isCached(newData.source))) {\n      handleInsert(editor, newData.embed);\n    } else {\n      getEmbedHtml(editor, newData).then(function (response) {\n        handleInsert(editor, response.html);\n      }).catch(handleError(editor));\n    }\n  };\n\n  var showDialog = function (editor) {\n    var editorData = getEditorData(editor);\n    var currentData = Cell(editorData);\n    var initialData = wrap(editorData);\n\n    var handleSource = function (prevData, api) {\n      var serviceData = unwrap(api.getData(), 'source');\n\n      if (prevData.source !== serviceData.source) {\n        addEmbedHtml(win, editor)({\n          url: serviceData.source,\n          html: ''\n        });\n        getEmbedHtml(editor, serviceData).then(addEmbedHtml(win, editor)).catch(handleError(editor));\n      }\n    };\n\n    var handleEmbed = function (api) {\n      var data = unwrap(api.getData());\n      var dataFromEmbed = snippetToData(editor, data.embed);\n      api.setData(wrap(dataFromEmbed));\n    };\n\n    var handleUpdate = function (api, sourceInput) {\n      var data = unwrap(api.getData(), sourceInput);\n      var embed = dataToHtml(editor, data);\n      api.setData(wrap(__assign(__assign({}, data), {\n        embed: embed\n      })));\n    };\n\n    var mediaInput = [{\n      name: 'source',\n      type: 'urlinput',\n      filetype: 'media',\n      label: 'Source'\n    }];\n    var sizeInput = !hasDimensions(editor) ? [] : [{\n      type: 'sizeinput',\n      name: 'dimensions',\n      label: 'Constrain proportions',\n      constrain: true\n    }];\n    var generalTab = {\n      title: 'General',\n      name: 'general',\n      items: flatten([mediaInput, sizeInput])\n    };\n    var embedTextarea = {\n      type: 'textarea',\n      name: 'embed',\n      label: 'Paste your embed code below:'\n    };\n    var embedTab = {\n      title: 'Embed',\n      items: [embedTextarea]\n    };\n    var advancedFormItems = [];\n\n    if (hasAltSource(editor)) {\n      advancedFormItems.push({\n        name: 'altsource',\n        type: 'urlinput',\n        filetype: 'media',\n        label: 'Alternative source URL'\n      });\n    }\n\n    if (hasPoster(editor)) {\n      advancedFormItems.push({\n        name: 'poster',\n        type: 'urlinput',\n        filetype: 'image',\n        label: 'Media poster (Image URL)'\n      });\n    }\n\n    var advancedTab = {\n      title: 'Advanced',\n      name: 'advanced',\n      items: advancedFormItems\n    };\n    var tabs = [generalTab, embedTab];\n\n    if (advancedFormItems.length > 0) {\n      tabs.push(advancedTab);\n    }\n\n    var body = {\n      type: 'tabpanel',\n      tabs: tabs\n    };\n    var win = editor.windowManager.open({\n      title: 'Insert/Edit Media',\n      size: 'normal',\n      body: body,\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      onSubmit: function (api) {\n        var serviceData = unwrap(api.getData());\n        submitForm(currentData.get(), serviceData, editor);\n        api.close();\n      },\n      onChange: function (api, detail) {\n        switch (detail.name) {\n          case 'source':\n            handleSource(currentData.get(), api);\n            break;\n\n          case 'embed':\n            handleEmbed(api);\n            break;\n\n          case 'dimensions':\n          case 'altsource':\n          case 'poster':\n            handleUpdate(api, detail.name);\n            break;\n        }\n\n        currentData.set(unwrap(api.getData()));\n      },\n      initialData: initialData\n    });\n  };\n\n  var get$1 = function (editor) {\n    var showDialog$1 = function () {\n      showDialog(editor);\n    };\n\n    return {\n      showDialog: showDialog$1\n    };\n  };\n\n  var register = function (editor) {\n    var showDialog$1 = function () {\n      showDialog(editor);\n    };\n\n    editor.addCommand('mceMedia', showDialog$1);\n  };\n\n  var global$7 = tinymce.util.Tools.resolve('tinymce.html.Node');\n  var global$8 = tinymce.util.Tools.resolve('tinymce.Env');\n  var global$9 = tinymce.util.Tools.resolve('tinymce.html.DomParser');\n\n  var sanitize = function (editor, html) {\n    if (shouldFilterHtml(editor) === false) {\n      return html;\n    }\n\n    var writer = global$5();\n    var blocked;\n    global$3({\n      validate: false,\n      allow_conditional_comments: false,\n      comment: function (text) {\n        if (!blocked) {\n          writer.comment(text);\n        }\n      },\n      cdata: function (text) {\n        if (!blocked) {\n          writer.cdata(text);\n        }\n      },\n      text: function (text, raw) {\n        if (!blocked) {\n          writer.text(text, raw);\n        }\n      },\n      start: function (name, attrs, empty) {\n        blocked = true;\n\n        if (name === 'script' || name === 'noscript' || name === 'svg') {\n          return;\n        }\n\n        for (var i = attrs.length - 1; i >= 0; i--) {\n          var attrName = attrs[i].name;\n\n          if (attrName.indexOf('on') === 0) {\n            delete attrs.map[attrName];\n            attrs.splice(i, 1);\n          }\n\n          if (attrName === 'style') {\n            attrs[i].value = editor.dom.serializeStyle(editor.dom.parseStyle(attrs[i].value), name);\n          }\n        }\n\n        writer.start(name, attrs, empty);\n        blocked = false;\n      },\n      end: function (name) {\n        if (blocked) {\n          return;\n        }\n\n        writer.end(name);\n      }\n    }, global$4({})).parse(html);\n    return writer.getContent();\n  };\n\n  var isLiveEmbedNode = function (node) {\n    var name = node.name;\n    return name === 'iframe' || name === 'video' || name === 'audio';\n  };\n\n  var getDimension = function (node, styles, dimension, defaultValue) {\n    if (defaultValue === void 0) {\n      defaultValue = null;\n    }\n\n    var value = node.attr(dimension);\n\n    if (isNonNullable(value)) {\n      return value;\n    } else if (!has(styles, dimension)) {\n      return defaultValue;\n    } else {\n      return null;\n    }\n  };\n\n  var setDimensions = function (node, previewNode, styles) {\n    var useDefaults = previewNode.name === 'img' || node.name === 'video';\n    var defaultWidth = useDefaults ? '300' : null;\n    var fallbackHeight = node.name === 'audio' ? '30' : '150';\n    var defaultHeight = useDefaults ? fallbackHeight : null;\n    previewNode.attr({\n      width: getDimension(node, styles, 'width', defaultWidth),\n      height: getDimension(node, styles, 'height', defaultHeight)\n    });\n  };\n\n  var appendNodeContent = function (editor, nodeName, previewNode, html) {\n    var newNode = global$9({\n      forced_root_block: false,\n      validate: false\n    }, editor.schema).parse(html, {\n      context: nodeName\n    });\n\n    while (newNode.firstChild) {\n      previewNode.append(newNode.firstChild);\n    }\n  };\n\n  var createPlaceholderNode = function (editor, node) {\n    var name = node.name;\n    var placeHolder = new global$7('img', 1);\n    placeHolder.shortEnded = true;\n    retainAttributesAndInnerHtml(editor, node, placeHolder);\n    setDimensions(node, placeHolder, {});\n    placeHolder.attr({\n      'style': node.attr('style'),\n      'src': global$8.transparentSrc,\n      'data-mce-object': name,\n      'class': 'mce-object mce-object-' + name\n    });\n    return placeHolder;\n  };\n\n  var createPreviewNode = function (editor, node) {\n    var name = node.name;\n    var previewWrapper = new global$7('span', 1);\n    previewWrapper.attr({\n      'contentEditable': 'false',\n      'style': node.attr('style'),\n      'data-mce-object': name,\n      'class': 'mce-preview-object mce-object-' + name\n    });\n    retainAttributesAndInnerHtml(editor, node, previewWrapper);\n    var styles = editor.dom.parseStyle(node.attr('style'));\n    var previewNode = new global$7(name, 1);\n    setDimensions(node, previewNode, styles);\n    previewNode.attr({\n      src: node.attr('src'),\n      style: node.attr('style'),\n      class: node.attr('class')\n    });\n\n    if (name === 'iframe') {\n      previewNode.attr({\n        allowfullscreen: node.attr('allowfullscreen'),\n        frameborder: '0'\n      });\n    } else {\n      var attrs = ['controls', 'crossorigin', 'currentTime', 'loop', 'muted', 'poster', 'preload'];\n      each(attrs, function (attrName) {\n        previewNode.attr(attrName, node.attr(attrName));\n      });\n      var sanitizedHtml = previewWrapper.attr('data-mce-html');\n\n      if (isNonNullable(sanitizedHtml)) {\n        appendNodeContent(editor, name, previewNode, sanitizedHtml);\n      }\n    }\n\n    var shimNode = new global$7('span', 1);\n    shimNode.attr('class', 'mce-shim');\n    previewWrapper.append(previewNode);\n    previewWrapper.append(shimNode);\n    return previewWrapper;\n  };\n\n  var retainAttributesAndInnerHtml = function (editor, sourceNode, targetNode) {\n    var attribs = sourceNode.attributes;\n    var ai = attribs.length;\n\n    while (ai--) {\n      var attrName = attribs[ai].name;\n      var attrValue = attribs[ai].value;\n\n      if (attrName !== 'width' && attrName !== 'height' && attrName !== 'style') {\n        if (attrName === 'data' || attrName === 'src') {\n          attrValue = editor.convertURL(attrValue, attrName);\n        }\n\n        targetNode.attr('data-mce-p-' + attrName, attrValue);\n      }\n    }\n\n    var innerHtml = sourceNode.firstChild && sourceNode.firstChild.value;\n\n    if (innerHtml) {\n      targetNode.attr('data-mce-html', escape(sanitize(editor, innerHtml)));\n      targetNode.firstChild = null;\n    }\n  };\n\n  var isPageEmbedWrapper = function (node) {\n    var nodeClass = node.attr('class');\n    return nodeClass && /\\btiny-pageembed\\b/.test(nodeClass);\n  };\n\n  var isWithinEmbedWrapper = function (node) {\n    while (node = node.parent) {\n      if (node.attr('data-ephox-embed-iri') || isPageEmbedWrapper(node)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var placeHolderConverter = function (editor) {\n    return function (nodes) {\n      var i = nodes.length;\n      var node;\n      var videoScript;\n\n      while (i--) {\n        node = nodes[i];\n\n        if (!node.parent) {\n          continue;\n        }\n\n        if (node.parent.attr('data-mce-object')) {\n          continue;\n        }\n\n        if (node.name === 'script') {\n          videoScript = getVideoScriptMatch(getScripts(editor), node.attr('src'));\n\n          if (!videoScript) {\n            continue;\n          }\n        }\n\n        if (videoScript) {\n          if (videoScript.width) {\n            node.attr('width', videoScript.width.toString());\n          }\n\n          if (videoScript.height) {\n            node.attr('height', videoScript.height.toString());\n          }\n        }\n\n        if (isLiveEmbedNode(node) && hasLiveEmbeds(editor) && global$8.ceFalse) {\n          if (!isWithinEmbedWrapper(node)) {\n            node.replace(createPreviewNode(editor, node));\n          }\n        } else {\n          if (!isWithinEmbedWrapper(node)) {\n            node.replace(createPlaceholderNode(editor, node));\n          }\n        }\n      }\n    };\n  };\n\n  var setup = function (editor) {\n    editor.on('preInit', function () {\n      var specialElements = editor.schema.getSpecialElements();\n      global$1.each('video audio iframe object'.split(' '), function (name) {\n        specialElements[name] = new RegExp('</' + name + '[^>]*>', 'gi');\n      });\n      var boolAttrs = editor.schema.getBoolAttrs();\n      global$1.each('webkitallowfullscreen mozallowfullscreen allowfullscreen'.split(' '), function (name) {\n        boolAttrs[name] = {};\n      });\n      editor.parser.addNodeFilter('iframe,video,audio,object,embed,script', placeHolderConverter(editor));\n      editor.serializer.addAttributeFilter('data-mce-object', function (nodes, name) {\n        var i = nodes.length;\n        var node;\n        var realElm;\n        var ai;\n        var attribs;\n        var innerHtml;\n        var innerNode;\n        var realElmName;\n        var className;\n\n        while (i--) {\n          node = nodes[i];\n\n          if (!node.parent) {\n            continue;\n          }\n\n          realElmName = node.attr(name);\n          realElm = new global$7(realElmName, 1);\n\n          if (realElmName !== 'audio' && realElmName !== 'script') {\n            className = node.attr('class');\n\n            if (className && className.indexOf('mce-preview-object') !== -1) {\n              realElm.attr({\n                width: node.firstChild.attr('width'),\n                height: node.firstChild.attr('height')\n              });\n            } else {\n              realElm.attr({\n                width: node.attr('width'),\n                height: node.attr('height')\n              });\n            }\n          }\n\n          realElm.attr({\n            style: node.attr('style')\n          });\n          attribs = node.attributes;\n          ai = attribs.length;\n\n          while (ai--) {\n            var attrName = attribs[ai].name;\n\n            if (attrName.indexOf('data-mce-p-') === 0) {\n              realElm.attr(attrName.substr(11), attribs[ai].value);\n            }\n          }\n\n          if (realElmName === 'script') {\n            realElm.attr('type', 'text/javascript');\n          }\n\n          innerHtml = node.attr('data-mce-html');\n\n          if (innerHtml) {\n            innerNode = new global$7('#text', 3);\n            innerNode.raw = true;\n            innerNode.value = sanitize(editor, unescape(innerHtml));\n            realElm.append(innerNode);\n          }\n\n          node.replace(realElm);\n        }\n      });\n    });\n    editor.on('SetContent', function () {\n      editor.$('span.mce-preview-object').each(function (index, elm) {\n        var $elm = editor.$(elm);\n\n        if ($elm.find('span.mce-shim').length === 0) {\n          $elm.append('<span class=\"mce-shim\"></span>');\n        }\n      });\n    });\n  };\n\n  var setup$1 = function (editor) {\n    editor.on('ResolveName', function (e) {\n      var name;\n\n      if (e.target.nodeType === 1 && (name = e.target.getAttribute('data-mce-object'))) {\n        e.name = name;\n      }\n    });\n  };\n\n  var setup$2 = function (editor) {\n    editor.on('click keyup touchend', function () {\n      var selectedNode = editor.selection.getNode();\n\n      if (selectedNode && editor.dom.hasClass(selectedNode, 'mce-preview-object')) {\n        if (editor.dom.getAttrib(selectedNode, 'data-mce-selected')) {\n          selectedNode.setAttribute('data-mce-selected', '2');\n        }\n      }\n    });\n    editor.on('ObjectSelected', function (e) {\n      var objectType = e.target.getAttribute('data-mce-object');\n\n      if (objectType === 'script') {\n        e.preventDefault();\n      }\n    });\n    editor.on('ObjectResized', function (e) {\n      var target = e.target;\n      var html;\n\n      if (target.getAttribute('data-mce-object')) {\n        html = target.getAttribute('data-mce-html');\n\n        if (html) {\n          html = unescape(html);\n          target.setAttribute('data-mce-html', escape(updateHtml(html, {\n            width: String(e.width),\n            height: String(e.height)\n          })));\n        }\n      }\n    });\n  };\n\n  var stateSelectorAdapter = function (editor, selector) {\n    return function (buttonApi) {\n      return editor.selection.selectorChangedWithUnbind(selector.join(','), buttonApi.setActive).unbind;\n    };\n  };\n\n  var register$1 = function (editor) {\n    editor.ui.registry.addToggleButton('media', {\n      tooltip: 'Insert/edit media',\n      icon: 'embed',\n      onAction: function () {\n        editor.execCommand('mceMedia');\n      },\n      onSetup: stateSelectorAdapter(editor, ['img[data-mce-object]', 'span[data-mce-object]', 'div[data-ephox-embed-iri]'])\n    });\n    editor.ui.registry.addMenuItem('media', {\n      icon: 'embed',\n      text: 'Media...',\n      onAction: function () {\n        editor.execCommand('mceMedia');\n      }\n    });\n  };\n\n  function Plugin() {\n    global.add('media', function (editor) {\n      register(editor);\n      register$1(editor);\n      setup$1(editor);\n      setup(editor);\n      setup$2(editor);\n      return get$1(editor);\n    });\n  }\n\n  Plugin();\n})();","map":{"version":3,"sources":["/home/lin/phase5/My-Place-Frontend/my-place/node_modules/tinymce/plugins/media/plugin.js"],"names":["global","tinymce","util","Tools","resolve","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","typeOf","x","Array","isPrototypeOf","constructor","name","String","isType","type","value","isString","isObject","isArray","isNullable","a","undefined","isNonNullable","noop","constant","never","always","none","NONE","eq","o","isNone","thunk","id","me","fold","_s","is","isSome","getOr","getOrThunk","getOrDie","msg","Error","getOrNull","getOrUndefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","some","constant_a","self","f","v","elementEq","b","from","Optional","nativePush","push","xs","len","flatten","r","Cell","initial","get","set","keys","each$1","obj","props","k","key","has","getScripts","editor","getParam","getAudioTemplateCallback","getVideoTemplateCallback","hasLiveEmbeds","shouldFilterHtml","getUrlResolver","hasAltSource","hasPoster","hasDimensions","global$1","global$2","global$3","getVideoScriptMatch","prefixes","src","indexOf","DOM","trimPx","replace","getEphoxEmbedData","attrs","style","styles","parseStyle","source","altsource","poster","width","height","htmlToData","html","isEphoxEmbed","data","validate","allow_conditional_comments","start","movie","extend","videoScript","parse","guess","url","mimes","mp3","m4a","wav","mp4","webm","ogg","swf","fileEnd","toLowerCase","split","pop","mime","global$4","global$5","DOM$1","addPx","test","setAttributes","updatedAttrs","val","attr","splice","updateEphoxEmbed","styleMap","serializeStyle","sources","updateHtml","updateAll","writer","sourceCount","hasImage","comment","text","cdata","raw","empty","end","index","imgAttrs","getContent","urlPatterns","regex","w","h","allowFullscreen","getProtocol","protocolMatches","match","getUrl","pattern","protocol","exec","newUrl","_loop_1","matchPattern","patterns","getIframeHtml","allowfullscreen","getFlashHtml","getAudioHtml","audioTemplateCallback","altsourcemime","getVideoHtml","videoTemplateCallback","sourcemime","getScriptHtml","dataToHtml","dataIn","embed","convertURL","dom","encode","global$6","cache","embedPromise","handler","res","rej","wrappedResolve","response","defaultPromise","loadedData","getEmbedHtml","embedHandler","isCached","extractMeta","sourceInput","mainData","getValue","metaData","prop","_a","getFromData","getFromMetaData","getNonEmptyValue","c","getFromValueFirst","child","getFromMetaFirst","getDimensions","dimensions","dims","unwrap","wrap","wrapped","handleError","error","errorMessage","notificationManager","open","snippetToData","embedSnippet","isMediaElement","element","getAttribute","getEditorData","selection","getNode","snippet","serializer","serialize","addEmbedHtml","api","trim","snippetData","nuData","setData","selectPlaceholder","beforeObjects","afterObjects","select","y","handleInsert","insertContent","nodeChanged","submitForm","prevData","newData","then","catch","showDialog","editorData","currentData","initialData","handleSource","serviceData","getData","win","handleEmbed","dataFromEmbed","handleUpdate","mediaInput","filetype","label","sizeInput","constrain","generalTab","title","items","embedTextarea","embedTab","advancedFormItems","advancedTab","tabs","body","windowManager","size","buttons","primary","onSubmit","close","onChange","detail","get$1","showDialog$1","register","addCommand","global$7","global$8","global$9","sanitize","blocked","attrName","isLiveEmbedNode","node","getDimension","dimension","defaultValue","setDimensions","previewNode","useDefaults","defaultWidth","fallbackHeight","defaultHeight","appendNodeContent","nodeName","newNode","forced_root_block","schema","context","firstChild","append","createPlaceholderNode","placeHolder","shortEnded","retainAttributesAndInnerHtml","transparentSrc","createPreviewNode","previewWrapper","class","frameborder","sanitizedHtml","shimNode","sourceNode","targetNode","attribs","attributes","ai","attrValue","innerHtml","escape","isPageEmbedWrapper","nodeClass","isWithinEmbedWrapper","parent","placeHolderConverter","nodes","ceFalse","setup","on","specialElements","getSpecialElements","RegExp","boolAttrs","getBoolAttrs","parser","addNodeFilter","addAttributeFilter","realElm","innerNode","realElmName","className","substr","unescape","$","elm","$elm","find","setup$1","e","target","nodeType","setup$2","selectedNode","hasClass","getAttrib","setAttribute","objectType","preventDefault","stateSelectorAdapter","selector","buttonApi","selectorChangedWithUnbind","join","setActive","unbind","register$1","ui","registry","addToggleButton","tooltip","icon","onAction","execCommand","onSetup","addMenuItem","Plugin","add"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.8.2 (2021-06-23)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n\n    var typeOf = function (x) {\n      var t = typeof x;\n      if (x === null) {\n        return 'null';\n      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      } else {\n        return t;\n      }\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isString = isType('string');\n    var isObject = isType('object');\n    var isArray = isType('array');\n    var isNullable = function (a) {\n      return a === null || a === undefined;\n    };\n    var isNonNullable = function (a) {\n      return !isNullable(a);\n    };\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, _s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Optional = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var nativePush = Array.prototype.push;\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      return {\n        get: get,\n        set: set\n      };\n    };\n\n    var keys = Object.keys;\n    var hasOwnProperty = Object.hasOwnProperty;\n    var each$1 = function (obj, f) {\n      var props = keys(obj);\n      for (var k = 0, len = props.length; k < len; k++) {\n        var i = props[k];\n        var x = obj[i];\n        f(x, i);\n      }\n    };\n    var get = function (obj, key) {\n      return has(obj, key) ? Optional.from(obj[key]) : Optional.none();\n    };\n    var has = function (obj, key) {\n      return hasOwnProperty.call(obj, key);\n    };\n\n    var getScripts = function (editor) {\n      return editor.getParam('media_scripts');\n    };\n    var getAudioTemplateCallback = function (editor) {\n      return editor.getParam('audio_template_callback');\n    };\n    var getVideoTemplateCallback = function (editor) {\n      return editor.getParam('video_template_callback');\n    };\n    var hasLiveEmbeds = function (editor) {\n      return editor.getParam('media_live_embeds', true);\n    };\n    var shouldFilterHtml = function (editor) {\n      return editor.getParam('media_filter_html', true);\n    };\n    var getUrlResolver = function (editor) {\n      return editor.getParam('media_url_resolver');\n    };\n    var hasAltSource = function (editor) {\n      return editor.getParam('media_alt_source', true);\n    };\n    var hasPoster = function (editor) {\n      return editor.getParam('media_poster', true);\n    };\n    var hasDimensions = function (editor) {\n      return editor.getParam('media_dimensions', true);\n    };\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.html.SaxParser');\n\n    var getVideoScriptMatch = function (prefixes, src) {\n      if (prefixes) {\n        for (var i = 0; i < prefixes.length; i++) {\n          if (src.indexOf(prefixes[i].filter) !== -1) {\n            return prefixes[i];\n          }\n        }\n      }\n    };\n\n    var DOM = global$2.DOM;\n    var trimPx = function (value) {\n      return value.replace(/px$/, '');\n    };\n    var getEphoxEmbedData = function (attrs) {\n      var style = attrs.map.style;\n      var styles = style ? DOM.parseStyle(style) : {};\n      return {\n        type: 'ephox-embed-iri',\n        source: attrs.map['data-ephox-embed-iri'],\n        altsource: '',\n        poster: '',\n        width: get(styles, 'max-width').map(trimPx).getOr(''),\n        height: get(styles, 'max-height').map(trimPx).getOr('')\n      };\n    };\n    var htmlToData = function (prefixes, html) {\n      var isEphoxEmbed = Cell(false);\n      var data = {};\n      global$3({\n        validate: false,\n        allow_conditional_comments: true,\n        start: function (name, attrs) {\n          if (isEphoxEmbed.get()) ; else if (has(attrs.map, 'data-ephox-embed-iri')) {\n            isEphoxEmbed.set(true);\n            data = getEphoxEmbedData(attrs);\n          } else {\n            if (!data.source && name === 'param') {\n              data.source = attrs.map.movie;\n            }\n            if (name === 'iframe' || name === 'object' || name === 'embed' || name === 'video' || name === 'audio') {\n              if (!data.type) {\n                data.type = name;\n              }\n              data = global$1.extend(attrs.map, data);\n            }\n            if (name === 'script') {\n              var videoScript = getVideoScriptMatch(prefixes, attrs.map.src);\n              if (!videoScript) {\n                return;\n              }\n              data = {\n                type: 'script',\n                source: attrs.map.src,\n                width: String(videoScript.width),\n                height: String(videoScript.height)\n              };\n            }\n            if (name === 'source') {\n              if (!data.source) {\n                data.source = attrs.map.src;\n              } else if (!data.altsource) {\n                data.altsource = attrs.map.src;\n              }\n            }\n            if (name === 'img' && !data.poster) {\n              data.poster = attrs.map.src;\n            }\n          }\n        }\n      }).parse(html);\n      data.source = data.source || data.src || data.data;\n      data.altsource = data.altsource || '';\n      data.poster = data.poster || '';\n      return data;\n    };\n\n    var guess = function (url) {\n      var mimes = {\n        mp3: 'audio/mpeg',\n        m4a: 'audio/x-m4a',\n        wav: 'audio/wav',\n        mp4: 'video/mp4',\n        webm: 'video/webm',\n        ogg: 'video/ogg',\n        swf: 'application/x-shockwave-flash'\n      };\n      var fileEnd = url.toLowerCase().split('.').pop();\n      var mime = mimes[fileEnd];\n      return mime ? mime : '';\n    };\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.html.Schema');\n\n    var global$5 = tinymce.util.Tools.resolve('tinymce.html.Writer');\n\n    var DOM$1 = global$2.DOM;\n    var addPx = function (value) {\n      return /^[0-9.]+$/.test(value) ? value + 'px' : value;\n    };\n    var setAttributes = function (attrs, updatedAttrs) {\n      each$1(updatedAttrs, function (val, name) {\n        var value = '' + val;\n        if (attrs.map[name]) {\n          var i = attrs.length;\n          while (i--) {\n            var attr = attrs[i];\n            if (attr.name === name) {\n              if (value) {\n                attrs.map[name] = value;\n                attr.value = value;\n              } else {\n                delete attrs.map[name];\n                attrs.splice(i, 1);\n              }\n            }\n          }\n        } else if (value) {\n          attrs.push({\n            name: name,\n            value: value\n          });\n          attrs.map[name] = value;\n        }\n      });\n    };\n    var updateEphoxEmbed = function (data, attrs) {\n      var style = attrs.map.style;\n      var styleMap = style ? DOM$1.parseStyle(style) : {};\n      styleMap['max-width'] = addPx(data.width);\n      styleMap['max-height'] = addPx(data.height);\n      setAttributes(attrs, { style: DOM$1.serializeStyle(styleMap) });\n    };\n    var sources = [\n      'source',\n      'altsource'\n    ];\n    var updateHtml = function (html, data, updateAll) {\n      var writer = global$5();\n      var isEphoxEmbed = Cell(false);\n      var sourceCount = 0;\n      var hasImage;\n      global$3({\n        validate: false,\n        allow_conditional_comments: true,\n        comment: function (text) {\n          writer.comment(text);\n        },\n        cdata: function (text) {\n          writer.cdata(text);\n        },\n        text: function (text, raw) {\n          writer.text(text, raw);\n        },\n        start: function (name, attrs, empty) {\n          if (isEphoxEmbed.get()) ; else if (has(attrs.map, 'data-ephox-embed-iri')) {\n            isEphoxEmbed.set(true);\n            updateEphoxEmbed(data, attrs);\n          } else {\n            switch (name) {\n            case 'video':\n            case 'object':\n            case 'embed':\n            case 'img':\n            case 'iframe':\n              if (data.height !== undefined && data.width !== undefined) {\n                setAttributes(attrs, {\n                  width: data.width,\n                  height: data.height\n                });\n              }\n              break;\n            }\n            if (updateAll) {\n              switch (name) {\n              case 'video':\n                setAttributes(attrs, {\n                  poster: data.poster,\n                  src: ''\n                });\n                if (data.altsource) {\n                  setAttributes(attrs, { src: '' });\n                }\n                break;\n              case 'iframe':\n                setAttributes(attrs, { src: data.source });\n                break;\n              case 'source':\n                if (sourceCount < 2) {\n                  setAttributes(attrs, {\n                    src: data[sources[sourceCount]],\n                    type: data[sources[sourceCount] + 'mime']\n                  });\n                  if (!data[sources[sourceCount]]) {\n                    return;\n                  }\n                }\n                sourceCount++;\n                break;\n              case 'img':\n                if (!data.poster) {\n                  return;\n                }\n                hasImage = true;\n                break;\n              }\n            }\n          }\n          writer.start(name, attrs, empty);\n        },\n        end: function (name) {\n          if (!isEphoxEmbed.get()) {\n            if (name === 'video' && updateAll) {\n              for (var index = 0; index < 2; index++) {\n                if (data[sources[index]]) {\n                  var attrs = [];\n                  attrs.map = {};\n                  if (sourceCount <= index) {\n                    setAttributes(attrs, {\n                      src: data[sources[index]],\n                      type: data[sources[index] + 'mime']\n                    });\n                    writer.start('source', attrs, true);\n                  }\n                }\n              }\n            }\n            if (data.poster && name === 'object' && updateAll && !hasImage) {\n              var imgAttrs = [];\n              imgAttrs.map = {};\n              setAttributes(imgAttrs, {\n                src: data.poster,\n                width: data.width,\n                height: data.height\n              });\n              writer.start('img', imgAttrs, true);\n            }\n          }\n          writer.end(name);\n        }\n      }, global$4({})).parse(html);\n      return writer.getContent();\n    };\n\n    var urlPatterns = [\n      {\n        regex: /youtu\\.be\\/([\\w\\-_\\?&=.]+)/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: 'www.youtube.com/embed/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /youtube\\.com(.+)v=([^&]+)(&([a-z0-9&=\\-_]+))?/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: 'www.youtube.com/embed/$2?$4',\n        allowFullscreen: true\n      },\n      {\n        regex: /youtube.com\\/embed\\/([a-z0-9\\?&=\\-_]+)/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: 'www.youtube.com/embed/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /vimeo\\.com\\/([0-9]+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: 'player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc',\n        allowFullscreen: true\n      },\n      {\n        regex: /vimeo\\.com\\/(.*)\\/([0-9]+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: 'player.vimeo.com/video/$2?title=0&amp;byline=0',\n        allowFullscreen: true\n      },\n      {\n        regex: /maps\\.google\\.([a-z]{2,3})\\/maps\\/(.+)msid=(.+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: 'maps.google.com/maps/ms?msid=$2&output=embed\"',\n        allowFullscreen: false\n      },\n      {\n        regex: /dailymotion\\.com\\/video\\/([^_]+)/,\n        type: 'iframe',\n        w: 480,\n        h: 270,\n        url: 'www.dailymotion.com/embed/video/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /dai\\.ly\\/([^_]+)/,\n        type: 'iframe',\n        w: 480,\n        h: 270,\n        url: 'www.dailymotion.com/embed/video/$1',\n        allowFullscreen: true\n      }\n    ];\n    var getProtocol = function (url) {\n      var protocolMatches = url.match(/^(https?:\\/\\/|www\\.)(.+)$/i);\n      if (protocolMatches && protocolMatches.length > 1) {\n        return protocolMatches[1] === 'www.' ? 'https://' : protocolMatches[1];\n      } else {\n        return 'https://';\n      }\n    };\n    var getUrl = function (pattern, url) {\n      var protocol = getProtocol(url);\n      var match = pattern.regex.exec(url);\n      var newUrl = protocol + pattern.url;\n      var _loop_1 = function (i) {\n        newUrl = newUrl.replace('$' + i, function () {\n          return match[i] ? match[i] : '';\n        });\n      };\n      for (var i = 0; i < match.length; i++) {\n        _loop_1(i);\n      }\n      return newUrl.replace(/\\?$/, '');\n    };\n    var matchPattern = function (url) {\n      var patterns = urlPatterns.filter(function (pattern) {\n        return pattern.regex.test(url);\n      });\n      if (patterns.length > 0) {\n        return global$1.extend({}, patterns[0], { url: getUrl(patterns[0], url) });\n      } else {\n        return null;\n      }\n    };\n\n    var getIframeHtml = function (data) {\n      var allowFullscreen = data.allowfullscreen ? ' allowFullscreen=\"1\"' : '';\n      return '<iframe src=\"' + data.source + '\" width=\"' + data.width + '\" height=\"' + data.height + '\"' + allowFullscreen + '></iframe>';\n    };\n    var getFlashHtml = function (data) {\n      var html = '<object data=\"' + data.source + '\" width=\"' + data.width + '\" height=\"' + data.height + '\" type=\"application/x-shockwave-flash\">';\n      if (data.poster) {\n        html += '<img src=\"' + data.poster + '\" width=\"' + data.width + '\" height=\"' + data.height + '\" />';\n      }\n      html += '</object>';\n      return html;\n    };\n    var getAudioHtml = function (data, audioTemplateCallback) {\n      if (audioTemplateCallback) {\n        return audioTemplateCallback(data);\n      } else {\n        return '<audio controls=\"controls\" src=\"' + data.source + '\">' + (data.altsource ? '\\n<source src=\"' + data.altsource + '\"' + (data.altsourcemime ? ' type=\"' + data.altsourcemime + '\"' : '') + ' />\\n' : '') + '</audio>';\n      }\n    };\n    var getVideoHtml = function (data, videoTemplateCallback) {\n      if (videoTemplateCallback) {\n        return videoTemplateCallback(data);\n      } else {\n        return '<video width=\"' + data.width + '\" height=\"' + data.height + '\"' + (data.poster ? ' poster=\"' + data.poster + '\"' : '') + ' controls=\"controls\">\\n' + '<source src=\"' + data.source + '\"' + (data.sourcemime ? ' type=\"' + data.sourcemime + '\"' : '') + ' />\\n' + (data.altsource ? '<source src=\"' + data.altsource + '\"' + (data.altsourcemime ? ' type=\"' + data.altsourcemime + '\"' : '') + ' />\\n' : '') + '</video>';\n      }\n    };\n    var getScriptHtml = function (data) {\n      return '<script src=\"' + data.source + '\"></script>';\n    };\n    var dataToHtml = function (editor, dataIn) {\n      var data = global$1.extend({}, dataIn);\n      if (!data.source) {\n        global$1.extend(data, htmlToData(getScripts(editor), data.embed));\n        if (!data.source) {\n          return '';\n        }\n      }\n      if (!data.altsource) {\n        data.altsource = '';\n      }\n      if (!data.poster) {\n        data.poster = '';\n      }\n      data.source = editor.convertURL(data.source, 'source');\n      data.altsource = editor.convertURL(data.altsource, 'source');\n      data.sourcemime = guess(data.source);\n      data.altsourcemime = guess(data.altsource);\n      data.poster = editor.convertURL(data.poster, 'poster');\n      var pattern = matchPattern(data.source);\n      if (pattern) {\n        data.source = pattern.url;\n        data.type = pattern.type;\n        data.allowfullscreen = pattern.allowFullscreen;\n        data.width = data.width || String(pattern.w);\n        data.height = data.height || String(pattern.h);\n      }\n      if (data.embed) {\n        return updateHtml(data.embed, data, true);\n      } else {\n        var videoScript = getVideoScriptMatch(getScripts(editor), data.source);\n        if (videoScript) {\n          data.type = 'script';\n          data.width = String(videoScript.width);\n          data.height = String(videoScript.height);\n        }\n        var audioTemplateCallback = getAudioTemplateCallback(editor);\n        var videoTemplateCallback = getVideoTemplateCallback(editor);\n        data.width = data.width || '300';\n        data.height = data.height || '150';\n        global$1.each(data, function (value, key) {\n          data[key] = editor.dom.encode('' + value);\n        });\n        if (data.type === 'iframe') {\n          return getIframeHtml(data);\n        } else if (data.sourcemime === 'application/x-shockwave-flash') {\n          return getFlashHtml(data);\n        } else if (data.sourcemime.indexOf('audio') !== -1) {\n          return getAudioHtml(data, audioTemplateCallback);\n        } else if (data.type === 'script') {\n          return getScriptHtml(data);\n        } else {\n          return getVideoHtml(data, videoTemplateCallback);\n        }\n      }\n    };\n\n    var global$6 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n\n    var cache = {};\n    var embedPromise = function (data, dataToHtml, handler) {\n      return new global$6(function (res, rej) {\n        var wrappedResolve = function (response) {\n          if (response.html) {\n            cache[data.source] = response;\n          }\n          return res({\n            url: data.source,\n            html: response.html ? response.html : dataToHtml(data)\n          });\n        };\n        if (cache[data.source]) {\n          wrappedResolve(cache[data.source]);\n        } else {\n          handler({ url: data.source }, wrappedResolve, rej);\n        }\n      });\n    };\n    var defaultPromise = function (data, dataToHtml) {\n      return new global$6(function (res) {\n        res({\n          html: dataToHtml(data),\n          url: data.source\n        });\n      });\n    };\n    var loadedData = function (editor) {\n      return function (data) {\n        return dataToHtml(editor, data);\n      };\n    };\n    var getEmbedHtml = function (editor, data) {\n      var embedHandler = getUrlResolver(editor);\n      return embedHandler ? embedPromise(data, loadedData(editor), embedHandler) : defaultPromise(data, loadedData(editor));\n    };\n    var isCached = function (url) {\n      return cache.hasOwnProperty(url);\n    };\n\n    var extractMeta = function (sourceInput, data) {\n      return get(data, sourceInput).bind(function (mainData) {\n        return get(mainData, 'meta');\n      });\n    };\n    var getValue = function (data, metaData, sourceInput) {\n      return function (prop) {\n        var _a;\n        var getFromData = function () {\n          return get(data, prop);\n        };\n        var getFromMetaData = function () {\n          return get(metaData, prop);\n        };\n        var getNonEmptyValue = function (c) {\n          return get(c, 'value').bind(function (v) {\n            return v.length > 0 ? Optional.some(v) : Optional.none();\n          });\n        };\n        var getFromValueFirst = function () {\n          return getFromData().bind(function (child) {\n            return isObject(child) ? getNonEmptyValue(child).orThunk(getFromMetaData) : getFromMetaData().orThunk(function () {\n              return Optional.from(child);\n            });\n          });\n        };\n        var getFromMetaFirst = function () {\n          return getFromMetaData().orThunk(function () {\n            return getFromData().bind(function (child) {\n              return isObject(child) ? getNonEmptyValue(child) : Optional.from(child);\n            });\n          });\n        };\n        return _a = {}, _a[prop] = (prop === sourceInput ? getFromValueFirst() : getFromMetaFirst()).getOr(''), _a;\n      };\n    };\n    var getDimensions = function (data, metaData) {\n      var dimensions = {};\n      get(data, 'dimensions').each(function (dims) {\n        each([\n          'width',\n          'height'\n        ], function (prop) {\n          get(metaData, prop).orThunk(function () {\n            return get(dims, prop);\n          }).each(function (value) {\n            return dimensions[prop] = value;\n          });\n        });\n      });\n      return dimensions;\n    };\n    var unwrap = function (data, sourceInput) {\n      var metaData = sourceInput ? extractMeta(sourceInput, data).getOr({}) : {};\n      var get = getValue(data, metaData, sourceInput);\n      return __assign(__assign(__assign(__assign(__assign({}, get('source')), get('altsource')), get('poster')), get('embed')), getDimensions(data, metaData));\n    };\n    var wrap = function (data) {\n      var wrapped = __assign(__assign({}, data), {\n        source: { value: get(data, 'source').getOr('') },\n        altsource: { value: get(data, 'altsource').getOr('') },\n        poster: { value: get(data, 'poster').getOr('') }\n      });\n      each([\n        'width',\n        'height'\n      ], function (prop) {\n        get(data, prop).each(function (value) {\n          var dimensions = wrapped.dimensions || {};\n          dimensions[prop] = value;\n          wrapped.dimensions = dimensions;\n        });\n      });\n      return wrapped;\n    };\n    var handleError = function (editor) {\n      return function (error) {\n        var errorMessage = error && error.msg ? 'Media embed handler error: ' + error.msg : 'Media embed handler threw unknown error.';\n        editor.notificationManager.open({\n          type: 'error',\n          text: errorMessage\n        });\n      };\n    };\n    var snippetToData = function (editor, embedSnippet) {\n      return htmlToData(getScripts(editor), embedSnippet);\n    };\n    var isMediaElement = function (element) {\n      return element.getAttribute('data-mce-object') || element.getAttribute('data-ephox-embed-iri');\n    };\n    var getEditorData = function (editor) {\n      var element = editor.selection.getNode();\n      var snippet = isMediaElement(element) ? editor.serializer.serialize(element, { selection: true }) : '';\n      return __assign({ embed: snippet }, htmlToData(getScripts(editor), snippet));\n    };\n    var addEmbedHtml = function (api, editor) {\n      return function (response) {\n        if (isString(response.url) && response.url.trim().length > 0) {\n          var html = response.html;\n          var snippetData = snippetToData(editor, html);\n          var nuData = __assign(__assign({}, snippetData), {\n            source: response.url,\n            embed: html\n          });\n          api.setData(wrap(nuData));\n        }\n      };\n    };\n    var selectPlaceholder = function (editor, beforeObjects) {\n      var afterObjects = editor.dom.select('*[data-mce-object]');\n      for (var i = 0; i < beforeObjects.length; i++) {\n        for (var y = afterObjects.length - 1; y >= 0; y--) {\n          if (beforeObjects[i] === afterObjects[y]) {\n            afterObjects.splice(y, 1);\n          }\n        }\n      }\n      editor.selection.select(afterObjects[0]);\n    };\n    var handleInsert = function (editor, html) {\n      var beforeObjects = editor.dom.select('*[data-mce-object]');\n      editor.insertContent(html);\n      selectPlaceholder(editor, beforeObjects);\n      editor.nodeChanged();\n    };\n    var submitForm = function (prevData, newData, editor) {\n      newData.embed = updateHtml(newData.embed, newData);\n      if (newData.embed && (prevData.source === newData.source || isCached(newData.source))) {\n        handleInsert(editor, newData.embed);\n      } else {\n        getEmbedHtml(editor, newData).then(function (response) {\n          handleInsert(editor, response.html);\n        }).catch(handleError(editor));\n      }\n    };\n    var showDialog = function (editor) {\n      var editorData = getEditorData(editor);\n      var currentData = Cell(editorData);\n      var initialData = wrap(editorData);\n      var handleSource = function (prevData, api) {\n        var serviceData = unwrap(api.getData(), 'source');\n        if (prevData.source !== serviceData.source) {\n          addEmbedHtml(win, editor)({\n            url: serviceData.source,\n            html: ''\n          });\n          getEmbedHtml(editor, serviceData).then(addEmbedHtml(win, editor)).catch(handleError(editor));\n        }\n      };\n      var handleEmbed = function (api) {\n        var data = unwrap(api.getData());\n        var dataFromEmbed = snippetToData(editor, data.embed);\n        api.setData(wrap(dataFromEmbed));\n      };\n      var handleUpdate = function (api, sourceInput) {\n        var data = unwrap(api.getData(), sourceInput);\n        var embed = dataToHtml(editor, data);\n        api.setData(wrap(__assign(__assign({}, data), { embed: embed })));\n      };\n      var mediaInput = [{\n          name: 'source',\n          type: 'urlinput',\n          filetype: 'media',\n          label: 'Source'\n        }];\n      var sizeInput = !hasDimensions(editor) ? [] : [{\n          type: 'sizeinput',\n          name: 'dimensions',\n          label: 'Constrain proportions',\n          constrain: true\n        }];\n      var generalTab = {\n        title: 'General',\n        name: 'general',\n        items: flatten([\n          mediaInput,\n          sizeInput\n        ])\n      };\n      var embedTextarea = {\n        type: 'textarea',\n        name: 'embed',\n        label: 'Paste your embed code below:'\n      };\n      var embedTab = {\n        title: 'Embed',\n        items: [embedTextarea]\n      };\n      var advancedFormItems = [];\n      if (hasAltSource(editor)) {\n        advancedFormItems.push({\n          name: 'altsource',\n          type: 'urlinput',\n          filetype: 'media',\n          label: 'Alternative source URL'\n        });\n      }\n      if (hasPoster(editor)) {\n        advancedFormItems.push({\n          name: 'poster',\n          type: 'urlinput',\n          filetype: 'image',\n          label: 'Media poster (Image URL)'\n        });\n      }\n      var advancedTab = {\n        title: 'Advanced',\n        name: 'advanced',\n        items: advancedFormItems\n      };\n      var tabs = [\n        generalTab,\n        embedTab\n      ];\n      if (advancedFormItems.length > 0) {\n        tabs.push(advancedTab);\n      }\n      var body = {\n        type: 'tabpanel',\n        tabs: tabs\n      };\n      var win = editor.windowManager.open({\n        title: 'Insert/Edit Media',\n        size: 'normal',\n        body: body,\n        buttons: [\n          {\n            type: 'cancel',\n            name: 'cancel',\n            text: 'Cancel'\n          },\n          {\n            type: 'submit',\n            name: 'save',\n            text: 'Save',\n            primary: true\n          }\n        ],\n        onSubmit: function (api) {\n          var serviceData = unwrap(api.getData());\n          submitForm(currentData.get(), serviceData, editor);\n          api.close();\n        },\n        onChange: function (api, detail) {\n          switch (detail.name) {\n          case 'source':\n            handleSource(currentData.get(), api);\n            break;\n          case 'embed':\n            handleEmbed(api);\n            break;\n          case 'dimensions':\n          case 'altsource':\n          case 'poster':\n            handleUpdate(api, detail.name);\n            break;\n          }\n          currentData.set(unwrap(api.getData()));\n        },\n        initialData: initialData\n      });\n    };\n\n    var get$1 = function (editor) {\n      var showDialog$1 = function () {\n        showDialog(editor);\n      };\n      return { showDialog: showDialog$1 };\n    };\n\n    var register = function (editor) {\n      var showDialog$1 = function () {\n        showDialog(editor);\n      };\n      editor.addCommand('mceMedia', showDialog$1);\n    };\n\n    var global$7 = tinymce.util.Tools.resolve('tinymce.html.Node');\n\n    var global$8 = tinymce.util.Tools.resolve('tinymce.Env');\n\n    var global$9 = tinymce.util.Tools.resolve('tinymce.html.DomParser');\n\n    var sanitize = function (editor, html) {\n      if (shouldFilterHtml(editor) === false) {\n        return html;\n      }\n      var writer = global$5();\n      var blocked;\n      global$3({\n        validate: false,\n        allow_conditional_comments: false,\n        comment: function (text) {\n          if (!blocked) {\n            writer.comment(text);\n          }\n        },\n        cdata: function (text) {\n          if (!blocked) {\n            writer.cdata(text);\n          }\n        },\n        text: function (text, raw) {\n          if (!blocked) {\n            writer.text(text, raw);\n          }\n        },\n        start: function (name, attrs, empty) {\n          blocked = true;\n          if (name === 'script' || name === 'noscript' || name === 'svg') {\n            return;\n          }\n          for (var i = attrs.length - 1; i >= 0; i--) {\n            var attrName = attrs[i].name;\n            if (attrName.indexOf('on') === 0) {\n              delete attrs.map[attrName];\n              attrs.splice(i, 1);\n            }\n            if (attrName === 'style') {\n              attrs[i].value = editor.dom.serializeStyle(editor.dom.parseStyle(attrs[i].value), name);\n            }\n          }\n          writer.start(name, attrs, empty);\n          blocked = false;\n        },\n        end: function (name) {\n          if (blocked) {\n            return;\n          }\n          writer.end(name);\n        }\n      }, global$4({})).parse(html);\n      return writer.getContent();\n    };\n\n    var isLiveEmbedNode = function (node) {\n      var name = node.name;\n      return name === 'iframe' || name === 'video' || name === 'audio';\n    };\n    var getDimension = function (node, styles, dimension, defaultValue) {\n      if (defaultValue === void 0) {\n        defaultValue = null;\n      }\n      var value = node.attr(dimension);\n      if (isNonNullable(value)) {\n        return value;\n      } else if (!has(styles, dimension)) {\n        return defaultValue;\n      } else {\n        return null;\n      }\n    };\n    var setDimensions = function (node, previewNode, styles) {\n      var useDefaults = previewNode.name === 'img' || node.name === 'video';\n      var defaultWidth = useDefaults ? '300' : null;\n      var fallbackHeight = node.name === 'audio' ? '30' : '150';\n      var defaultHeight = useDefaults ? fallbackHeight : null;\n      previewNode.attr({\n        width: getDimension(node, styles, 'width', defaultWidth),\n        height: getDimension(node, styles, 'height', defaultHeight)\n      });\n    };\n    var appendNodeContent = function (editor, nodeName, previewNode, html) {\n      var newNode = global$9({\n        forced_root_block: false,\n        validate: false\n      }, editor.schema).parse(html, { context: nodeName });\n      while (newNode.firstChild) {\n        previewNode.append(newNode.firstChild);\n      }\n    };\n    var createPlaceholderNode = function (editor, node) {\n      var name = node.name;\n      var placeHolder = new global$7('img', 1);\n      placeHolder.shortEnded = true;\n      retainAttributesAndInnerHtml(editor, node, placeHolder);\n      setDimensions(node, placeHolder, {});\n      placeHolder.attr({\n        'style': node.attr('style'),\n        'src': global$8.transparentSrc,\n        'data-mce-object': name,\n        'class': 'mce-object mce-object-' + name\n      });\n      return placeHolder;\n    };\n    var createPreviewNode = function (editor, node) {\n      var name = node.name;\n      var previewWrapper = new global$7('span', 1);\n      previewWrapper.attr({\n        'contentEditable': 'false',\n        'style': node.attr('style'),\n        'data-mce-object': name,\n        'class': 'mce-preview-object mce-object-' + name\n      });\n      retainAttributesAndInnerHtml(editor, node, previewWrapper);\n      var styles = editor.dom.parseStyle(node.attr('style'));\n      var previewNode = new global$7(name, 1);\n      setDimensions(node, previewNode, styles);\n      previewNode.attr({\n        src: node.attr('src'),\n        style: node.attr('style'),\n        class: node.attr('class')\n      });\n      if (name === 'iframe') {\n        previewNode.attr({\n          allowfullscreen: node.attr('allowfullscreen'),\n          frameborder: '0'\n        });\n      } else {\n        var attrs = [\n          'controls',\n          'crossorigin',\n          'currentTime',\n          'loop',\n          'muted',\n          'poster',\n          'preload'\n        ];\n        each(attrs, function (attrName) {\n          previewNode.attr(attrName, node.attr(attrName));\n        });\n        var sanitizedHtml = previewWrapper.attr('data-mce-html');\n        if (isNonNullable(sanitizedHtml)) {\n          appendNodeContent(editor, name, previewNode, sanitizedHtml);\n        }\n      }\n      var shimNode = new global$7('span', 1);\n      shimNode.attr('class', 'mce-shim');\n      previewWrapper.append(previewNode);\n      previewWrapper.append(shimNode);\n      return previewWrapper;\n    };\n    var retainAttributesAndInnerHtml = function (editor, sourceNode, targetNode) {\n      var attribs = sourceNode.attributes;\n      var ai = attribs.length;\n      while (ai--) {\n        var attrName = attribs[ai].name;\n        var attrValue = attribs[ai].value;\n        if (attrName !== 'width' && attrName !== 'height' && attrName !== 'style') {\n          if (attrName === 'data' || attrName === 'src') {\n            attrValue = editor.convertURL(attrValue, attrName);\n          }\n          targetNode.attr('data-mce-p-' + attrName, attrValue);\n        }\n      }\n      var innerHtml = sourceNode.firstChild && sourceNode.firstChild.value;\n      if (innerHtml) {\n        targetNode.attr('data-mce-html', escape(sanitize(editor, innerHtml)));\n        targetNode.firstChild = null;\n      }\n    };\n    var isPageEmbedWrapper = function (node) {\n      var nodeClass = node.attr('class');\n      return nodeClass && /\\btiny-pageembed\\b/.test(nodeClass);\n    };\n    var isWithinEmbedWrapper = function (node) {\n      while (node = node.parent) {\n        if (node.attr('data-ephox-embed-iri') || isPageEmbedWrapper(node)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var placeHolderConverter = function (editor) {\n      return function (nodes) {\n        var i = nodes.length;\n        var node;\n        var videoScript;\n        while (i--) {\n          node = nodes[i];\n          if (!node.parent) {\n            continue;\n          }\n          if (node.parent.attr('data-mce-object')) {\n            continue;\n          }\n          if (node.name === 'script') {\n            videoScript = getVideoScriptMatch(getScripts(editor), node.attr('src'));\n            if (!videoScript) {\n              continue;\n            }\n          }\n          if (videoScript) {\n            if (videoScript.width) {\n              node.attr('width', videoScript.width.toString());\n            }\n            if (videoScript.height) {\n              node.attr('height', videoScript.height.toString());\n            }\n          }\n          if (isLiveEmbedNode(node) && hasLiveEmbeds(editor) && global$8.ceFalse) {\n            if (!isWithinEmbedWrapper(node)) {\n              node.replace(createPreviewNode(editor, node));\n            }\n          } else {\n            if (!isWithinEmbedWrapper(node)) {\n              node.replace(createPlaceholderNode(editor, node));\n            }\n          }\n        }\n      };\n    };\n\n    var setup = function (editor) {\n      editor.on('preInit', function () {\n        var specialElements = editor.schema.getSpecialElements();\n        global$1.each('video audio iframe object'.split(' '), function (name) {\n          specialElements[name] = new RegExp('</' + name + '[^>]*>', 'gi');\n        });\n        var boolAttrs = editor.schema.getBoolAttrs();\n        global$1.each('webkitallowfullscreen mozallowfullscreen allowfullscreen'.split(' '), function (name) {\n          boolAttrs[name] = {};\n        });\n        editor.parser.addNodeFilter('iframe,video,audio,object,embed,script', placeHolderConverter(editor));\n        editor.serializer.addAttributeFilter('data-mce-object', function (nodes, name) {\n          var i = nodes.length;\n          var node;\n          var realElm;\n          var ai;\n          var attribs;\n          var innerHtml;\n          var innerNode;\n          var realElmName;\n          var className;\n          while (i--) {\n            node = nodes[i];\n            if (!node.parent) {\n              continue;\n            }\n            realElmName = node.attr(name);\n            realElm = new global$7(realElmName, 1);\n            if (realElmName !== 'audio' && realElmName !== 'script') {\n              className = node.attr('class');\n              if (className && className.indexOf('mce-preview-object') !== -1) {\n                realElm.attr({\n                  width: node.firstChild.attr('width'),\n                  height: node.firstChild.attr('height')\n                });\n              } else {\n                realElm.attr({\n                  width: node.attr('width'),\n                  height: node.attr('height')\n                });\n              }\n            }\n            realElm.attr({ style: node.attr('style') });\n            attribs = node.attributes;\n            ai = attribs.length;\n            while (ai--) {\n              var attrName = attribs[ai].name;\n              if (attrName.indexOf('data-mce-p-') === 0) {\n                realElm.attr(attrName.substr(11), attribs[ai].value);\n              }\n            }\n            if (realElmName === 'script') {\n              realElm.attr('type', 'text/javascript');\n            }\n            innerHtml = node.attr('data-mce-html');\n            if (innerHtml) {\n              innerNode = new global$7('#text', 3);\n              innerNode.raw = true;\n              innerNode.value = sanitize(editor, unescape(innerHtml));\n              realElm.append(innerNode);\n            }\n            node.replace(realElm);\n          }\n        });\n      });\n      editor.on('SetContent', function () {\n        editor.$('span.mce-preview-object').each(function (index, elm) {\n          var $elm = editor.$(elm);\n          if ($elm.find('span.mce-shim').length === 0) {\n            $elm.append('<span class=\"mce-shim\"></span>');\n          }\n        });\n      });\n    };\n\n    var setup$1 = function (editor) {\n      editor.on('ResolveName', function (e) {\n        var name;\n        if (e.target.nodeType === 1 && (name = e.target.getAttribute('data-mce-object'))) {\n          e.name = name;\n        }\n      });\n    };\n\n    var setup$2 = function (editor) {\n      editor.on('click keyup touchend', function () {\n        var selectedNode = editor.selection.getNode();\n        if (selectedNode && editor.dom.hasClass(selectedNode, 'mce-preview-object')) {\n          if (editor.dom.getAttrib(selectedNode, 'data-mce-selected')) {\n            selectedNode.setAttribute('data-mce-selected', '2');\n          }\n        }\n      });\n      editor.on('ObjectSelected', function (e) {\n        var objectType = e.target.getAttribute('data-mce-object');\n        if (objectType === 'script') {\n          e.preventDefault();\n        }\n      });\n      editor.on('ObjectResized', function (e) {\n        var target = e.target;\n        var html;\n        if (target.getAttribute('data-mce-object')) {\n          html = target.getAttribute('data-mce-html');\n          if (html) {\n            html = unescape(html);\n            target.setAttribute('data-mce-html', escape(updateHtml(html, {\n              width: String(e.width),\n              height: String(e.height)\n            })));\n          }\n        }\n      });\n    };\n\n    var stateSelectorAdapter = function (editor, selector) {\n      return function (buttonApi) {\n        return editor.selection.selectorChangedWithUnbind(selector.join(','), buttonApi.setActive).unbind;\n      };\n    };\n    var register$1 = function (editor) {\n      editor.ui.registry.addToggleButton('media', {\n        tooltip: 'Insert/edit media',\n        icon: 'embed',\n        onAction: function () {\n          editor.execCommand('mceMedia');\n        },\n        onSetup: stateSelectorAdapter(editor, [\n          'img[data-mce-object]',\n          'span[data-mce-object]',\n          'div[data-ephox-embed-iri]'\n        ])\n      });\n      editor.ui.registry.addMenuItem('media', {\n        icon: 'embed',\n        text: 'Media...',\n        onAction: function () {\n          editor.execCommand('mceMedia');\n        }\n      });\n    };\n\n    function Plugin () {\n      global.add('media', function (editor) {\n        register(editor);\n        register$1(editor);\n        setup$1(editor);\n        setup(editor);\n        setup$2(editor);\n        return get$1(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]},"metadata":{},"sourceType":"script"}