{"ast":null,"code":"/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.8.2 (2021-06-23)\n */\n(function () {\n  'use strict';\n\n  var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n  var global$1 = tinymce.util.Tools.resolve('tinymce.dom.RangeUtils');\n  var global$2 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n  var allowHtmlInNamedAnchor = function (editor) {\n    return editor.getParam('allow_html_in_named_anchor', false, 'boolean');\n  };\n\n  var namedAnchorSelector = 'a:not([href])';\n\n  var isEmptyString = function (str) {\n    return !str;\n  };\n\n  var getIdFromAnchor = function (elm) {\n    var id = elm.getAttribute('id') || elm.getAttribute('name');\n    return id || '';\n  };\n\n  var isAnchor = function (elm) {\n    return elm && elm.nodeName.toLowerCase() === 'a';\n  };\n\n  var isNamedAnchor = function (elm) {\n    return isAnchor(elm) && !elm.getAttribute('href') && getIdFromAnchor(elm) !== '';\n  };\n\n  var isEmptyNamedAnchor = function (elm) {\n    return isNamedAnchor(elm) && !elm.firstChild;\n  };\n\n  var removeEmptyNamedAnchorsInSelection = function (editor) {\n    var dom = editor.dom;\n    global$1(dom).walk(editor.selection.getRng(), function (nodes) {\n      global$2.each(nodes, function (node) {\n        if (isEmptyNamedAnchor(node)) {\n          dom.remove(node, false);\n        }\n      });\n    });\n  };\n\n  var isValidId = function (id) {\n    return /^[A-Za-z][A-Za-z0-9\\-:._]*$/.test(id);\n  };\n\n  var getNamedAnchor = function (editor) {\n    return editor.dom.getParent(editor.selection.getStart(), namedAnchorSelector);\n  };\n\n  var getId = function (editor) {\n    var anchor = getNamedAnchor(editor);\n\n    if (anchor) {\n      return getIdFromAnchor(anchor);\n    } else {\n      return '';\n    }\n  };\n\n  var createAnchor = function (editor, id) {\n    editor.undoManager.transact(function () {\n      if (!allowHtmlInNamedAnchor(editor)) {\n        editor.selection.collapse(true);\n      }\n\n      if (editor.selection.isCollapsed()) {\n        editor.insertContent(editor.dom.createHTML('a', {\n          id: id\n        }));\n      } else {\n        removeEmptyNamedAnchorsInSelection(editor);\n        editor.formatter.remove('namedAnchor', null, null, true);\n        editor.formatter.apply('namedAnchor', {\n          value: id\n        });\n        editor.addVisual();\n      }\n    });\n  };\n\n  var updateAnchor = function (editor, id, anchorElement) {\n    anchorElement.removeAttribute('name');\n    anchorElement.id = id;\n    editor.addVisual();\n    editor.undoManager.add();\n  };\n\n  var insert = function (editor, id) {\n    var anchor = getNamedAnchor(editor);\n\n    if (anchor) {\n      updateAnchor(editor, id, anchor);\n    } else {\n      createAnchor(editor, id);\n    }\n\n    editor.focus();\n  };\n\n  var insertAnchor = function (editor, newId) {\n    if (!isValidId(newId)) {\n      editor.windowManager.alert('Id should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores.');\n      return false;\n    } else {\n      insert(editor, newId);\n      return true;\n    }\n  };\n\n  var open = function (editor) {\n    var currentId = getId(editor);\n    editor.windowManager.open({\n      title: 'Anchor',\n      size: 'normal',\n      body: {\n        type: 'panel',\n        items: [{\n          name: 'id',\n          type: 'input',\n          label: 'ID',\n          placeholder: 'example'\n        }]\n      },\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      initialData: {\n        id: currentId\n      },\n      onSubmit: function (api) {\n        if (insertAnchor(editor, api.getData().id)) {\n          api.close();\n        }\n      }\n    });\n  };\n\n  var register = function (editor) {\n    editor.addCommand('mceAnchor', function () {\n      open(editor);\n    });\n  };\n\n  var isNamedAnchorNode = function (node) {\n    return node && isEmptyString(node.attr('href')) && !isEmptyString(node.attr('id') || node.attr('name'));\n  };\n\n  var isEmptyNamedAnchorNode = function (node) {\n    return isNamedAnchorNode(node) && !node.firstChild;\n  };\n\n  var setContentEditable = function (state) {\n    return function (nodes) {\n      for (var i = 0; i < nodes.length; i++) {\n        var node = nodes[i];\n\n        if (isEmptyNamedAnchorNode(node)) {\n          node.attr('contenteditable', state);\n        }\n      }\n    };\n  };\n\n  var setup = function (editor) {\n    editor.on('PreInit', function () {\n      editor.parser.addNodeFilter('a', setContentEditable('false'));\n      editor.serializer.addNodeFilter('a', setContentEditable(null));\n    });\n  };\n\n  var registerFormats = function (editor) {\n    editor.formatter.register('namedAnchor', {\n      inline: 'a',\n      selector: namedAnchorSelector,\n      remove: 'all',\n      split: true,\n      deep: true,\n      attributes: {\n        id: '%value'\n      },\n      onmatch: function (node, _fmt, _itemName) {\n        return isNamedAnchor(node);\n      }\n    });\n  };\n\n  var register$1 = function (editor) {\n    editor.ui.registry.addToggleButton('anchor', {\n      icon: 'bookmark',\n      tooltip: 'Anchor',\n      onAction: function () {\n        return editor.execCommand('mceAnchor');\n      },\n      onSetup: function (buttonApi) {\n        return editor.selection.selectorChangedWithUnbind('a:not([href])', buttonApi.setActive).unbind;\n      }\n    });\n    editor.ui.registry.addMenuItem('anchor', {\n      icon: 'bookmark',\n      text: 'Anchor...',\n      onAction: function () {\n        return editor.execCommand('mceAnchor');\n      }\n    });\n  };\n\n  function Plugin() {\n    global.add('anchor', function (editor) {\n      setup(editor);\n      register(editor);\n      register$1(editor);\n      editor.on('PreInit', function () {\n        registerFormats(editor);\n      });\n    });\n  }\n\n  Plugin();\n})();","map":{"version":3,"sources":["/home/lin/phase5/My-Place-Frontend/my-place/node_modules/tinymce/plugins/anchor/plugin.js"],"names":["global","tinymce","util","Tools","resolve","global$1","global$2","allowHtmlInNamedAnchor","editor","getParam","namedAnchorSelector","isEmptyString","str","getIdFromAnchor","elm","id","getAttribute","isAnchor","nodeName","toLowerCase","isNamedAnchor","isEmptyNamedAnchor","firstChild","removeEmptyNamedAnchorsInSelection","dom","walk","selection","getRng","nodes","each","node","remove","isValidId","test","getNamedAnchor","getParent","getStart","getId","anchor","createAnchor","undoManager","transact","collapse","isCollapsed","insertContent","createHTML","formatter","apply","value","addVisual","updateAnchor","anchorElement","removeAttribute","add","insert","focus","insertAnchor","newId","windowManager","alert","open","currentId","title","size","body","type","items","name","label","placeholder","buttons","text","primary","initialData","onSubmit","api","getData","close","register","addCommand","isNamedAnchorNode","attr","isEmptyNamedAnchorNode","setContentEditable","state","i","length","setup","on","parser","addNodeFilter","serializer","registerFormats","inline","selector","split","deep","attributes","onmatch","_fmt","_itemName","register$1","ui","registry","addToggleButton","icon","tooltip","onAction","execCommand","onSetup","buttonApi","selectorChangedWithUnbind","setActive","unbind","addMenuItem","Plugin"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.8.2 (2021-06-23)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.dom.RangeUtils');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var allowHtmlInNamedAnchor = function (editor) {\n      return editor.getParam('allow_html_in_named_anchor', false, 'boolean');\n    };\n\n    var namedAnchorSelector = 'a:not([href])';\n    var isEmptyString = function (str) {\n      return !str;\n    };\n    var getIdFromAnchor = function (elm) {\n      var id = elm.getAttribute('id') || elm.getAttribute('name');\n      return id || '';\n    };\n    var isAnchor = function (elm) {\n      return elm && elm.nodeName.toLowerCase() === 'a';\n    };\n    var isNamedAnchor = function (elm) {\n      return isAnchor(elm) && !elm.getAttribute('href') && getIdFromAnchor(elm) !== '';\n    };\n    var isEmptyNamedAnchor = function (elm) {\n      return isNamedAnchor(elm) && !elm.firstChild;\n    };\n\n    var removeEmptyNamedAnchorsInSelection = function (editor) {\n      var dom = editor.dom;\n      global$1(dom).walk(editor.selection.getRng(), function (nodes) {\n        global$2.each(nodes, function (node) {\n          if (isEmptyNamedAnchor(node)) {\n            dom.remove(node, false);\n          }\n        });\n      });\n    };\n    var isValidId = function (id) {\n      return /^[A-Za-z][A-Za-z0-9\\-:._]*$/.test(id);\n    };\n    var getNamedAnchor = function (editor) {\n      return editor.dom.getParent(editor.selection.getStart(), namedAnchorSelector);\n    };\n    var getId = function (editor) {\n      var anchor = getNamedAnchor(editor);\n      if (anchor) {\n        return getIdFromAnchor(anchor);\n      } else {\n        return '';\n      }\n    };\n    var createAnchor = function (editor, id) {\n      editor.undoManager.transact(function () {\n        if (!allowHtmlInNamedAnchor(editor)) {\n          editor.selection.collapse(true);\n        }\n        if (editor.selection.isCollapsed()) {\n          editor.insertContent(editor.dom.createHTML('a', { id: id }));\n        } else {\n          removeEmptyNamedAnchorsInSelection(editor);\n          editor.formatter.remove('namedAnchor', null, null, true);\n          editor.formatter.apply('namedAnchor', { value: id });\n          editor.addVisual();\n        }\n      });\n    };\n    var updateAnchor = function (editor, id, anchorElement) {\n      anchorElement.removeAttribute('name');\n      anchorElement.id = id;\n      editor.addVisual();\n      editor.undoManager.add();\n    };\n    var insert = function (editor, id) {\n      var anchor = getNamedAnchor(editor);\n      if (anchor) {\n        updateAnchor(editor, id, anchor);\n      } else {\n        createAnchor(editor, id);\n      }\n      editor.focus();\n    };\n\n    var insertAnchor = function (editor, newId) {\n      if (!isValidId(newId)) {\n        editor.windowManager.alert('Id should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores.');\n        return false;\n      } else {\n        insert(editor, newId);\n        return true;\n      }\n    };\n    var open = function (editor) {\n      var currentId = getId(editor);\n      editor.windowManager.open({\n        title: 'Anchor',\n        size: 'normal',\n        body: {\n          type: 'panel',\n          items: [{\n              name: 'id',\n              type: 'input',\n              label: 'ID',\n              placeholder: 'example'\n            }]\n        },\n        buttons: [\n          {\n            type: 'cancel',\n            name: 'cancel',\n            text: 'Cancel'\n          },\n          {\n            type: 'submit',\n            name: 'save',\n            text: 'Save',\n            primary: true\n          }\n        ],\n        initialData: { id: currentId },\n        onSubmit: function (api) {\n          if (insertAnchor(editor, api.getData().id)) {\n            api.close();\n          }\n        }\n      });\n    };\n\n    var register = function (editor) {\n      editor.addCommand('mceAnchor', function () {\n        open(editor);\n      });\n    };\n\n    var isNamedAnchorNode = function (node) {\n      return node && isEmptyString(node.attr('href')) && !isEmptyString(node.attr('id') || node.attr('name'));\n    };\n    var isEmptyNamedAnchorNode = function (node) {\n      return isNamedAnchorNode(node) && !node.firstChild;\n    };\n    var setContentEditable = function (state) {\n      return function (nodes) {\n        for (var i = 0; i < nodes.length; i++) {\n          var node = nodes[i];\n          if (isEmptyNamedAnchorNode(node)) {\n            node.attr('contenteditable', state);\n          }\n        }\n      };\n    };\n    var setup = function (editor) {\n      editor.on('PreInit', function () {\n        editor.parser.addNodeFilter('a', setContentEditable('false'));\n        editor.serializer.addNodeFilter('a', setContentEditable(null));\n      });\n    };\n\n    var registerFormats = function (editor) {\n      editor.formatter.register('namedAnchor', {\n        inline: 'a',\n        selector: namedAnchorSelector,\n        remove: 'all',\n        split: true,\n        deep: true,\n        attributes: { id: '%value' },\n        onmatch: function (node, _fmt, _itemName) {\n          return isNamedAnchor(node);\n        }\n      });\n    };\n\n    var register$1 = function (editor) {\n      editor.ui.registry.addToggleButton('anchor', {\n        icon: 'bookmark',\n        tooltip: 'Anchor',\n        onAction: function () {\n          return editor.execCommand('mceAnchor');\n        },\n        onSetup: function (buttonApi) {\n          return editor.selection.selectorChangedWithUnbind('a:not([href])', buttonApi.setActive).unbind;\n        }\n      });\n      editor.ui.registry.addMenuItem('anchor', {\n        icon: 'bookmark',\n        text: 'Anchor...',\n        onAction: function () {\n          return editor.execCommand('mceAnchor');\n        }\n      });\n    };\n\n    function Plugin () {\n      global.add('anchor', function (editor) {\n        setup(editor);\n        register(editor);\n        register$1(editor);\n        editor.on('PreInit', function () {\n          registerFormats(editor);\n        });\n      });\n    }\n\n    Plugin();\n\n}());\n"]},"metadata":{},"sourceType":"script"}