{"ast":null,"code":"/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.8.2 (2021-06-23)\n */\n(function () {\n  'use strict';\n\n  var Cell = function (initial) {\n    var value = initial;\n\n    var get = function () {\n      return value;\n    };\n\n    var set = function (v) {\n      value = v;\n    };\n\n    return {\n      get: get,\n      set: set\n    };\n  };\n\n  var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n  var __assign = function () {\n    __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n\n      return t;\n    };\n\n    return __assign.apply(this, arguments);\n  };\n\n  var typeOf = function (x) {\n    var t = typeof x;\n\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n\n  var isType = function (type) {\n    return function (value) {\n      return typeOf(value) === type;\n    };\n  };\n\n  var isSimpleType = function (type) {\n    return function (value) {\n      return typeof value === type;\n    };\n  };\n\n  var isString = isType('string');\n  var isArray = isType('array');\n  var isBoolean = isSimpleType('boolean');\n  var isNumber = isSimpleType('number');\n\n  var noop = function () {};\n\n  var constant = function (value) {\n    return function () {\n      return value;\n    };\n  };\n\n  var never = constant(false);\n  var always = constant(true);\n  var punctuationStr = '[!-#%-*,-\\\\/:;?@\\\\[-\\\\]_{}\\xA1\\xAB\\xB7\\xBB\\xBF;\\xB7\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1361-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u3008\\u3009\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30\\u2E31\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uff3f\\uFF5B\\uFF5D\\uFF5F-\\uFF65]';\n  var punctuation = constant(punctuationStr);\n\n  var none = function () {\n    return NONE;\n  };\n\n  var NONE = function () {\n    var eq = function (o) {\n      return o.isNone();\n    };\n\n    var call = function (thunk) {\n      return thunk();\n    };\n\n    var id = function (n) {\n      return n;\n    };\n\n    var me = {\n      fold: function (n, _s) {\n        return n();\n      },\n      is: never,\n      isSome: never,\n      isNone: always,\n      getOr: id,\n      getOrThunk: call,\n      getOrDie: function (msg) {\n        throw new Error(msg || 'error: getOrDie called on none.');\n      },\n      getOrNull: constant(null),\n      getOrUndefined: constant(undefined),\n      or: id,\n      orThunk: call,\n      map: none,\n      each: noop,\n      bind: none,\n      exists: never,\n      forall: always,\n      filter: none,\n      equals: eq,\n      equals_: eq,\n      toArray: function () {\n        return [];\n      },\n      toString: constant('none()')\n    };\n    return me;\n  }();\n\n  var some = function (a) {\n    var constant_a = constant(a);\n\n    var self = function () {\n      return me;\n    };\n\n    var bind = function (f) {\n      return f(a);\n    };\n\n    var me = {\n      fold: function (n, s) {\n        return s(a);\n      },\n      is: function (v) {\n        return a === v;\n      },\n      isSome: always,\n      isNone: never,\n      getOr: constant_a,\n      getOrThunk: constant_a,\n      getOrDie: constant_a,\n      getOrNull: constant_a,\n      getOrUndefined: constant_a,\n      or: self,\n      orThunk: self,\n      map: function (f) {\n        return some(f(a));\n      },\n      each: function (f) {\n        f(a);\n      },\n      bind: bind,\n      exists: bind,\n      forall: bind,\n      filter: function (f) {\n        return f(a) ? me : NONE;\n      },\n      toArray: function () {\n        return [a];\n      },\n      toString: function () {\n        return 'some(' + a + ')';\n      },\n      equals: function (o) {\n        return o.is(a);\n      },\n      equals_: function (o, elementEq) {\n        return o.fold(never, function (b) {\n          return elementEq(a, b);\n        });\n      }\n    };\n    return me;\n  };\n\n  var from = function (value) {\n    return value === null || value === undefined ? NONE : some(value);\n  };\n\n  var Optional = {\n    some: some,\n    none: none,\n    from: from\n  };\n  var punctuation$1 = punctuation;\n  var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n  var nativeSlice = Array.prototype.slice;\n  var nativePush = Array.prototype.push;\n\n  var map = function (xs, f) {\n    var len = xs.length;\n    var r = new Array(len);\n\n    for (var i = 0; i < len; i++) {\n      var x = xs[i];\n      r[i] = f(x, i);\n    }\n\n    return r;\n  };\n\n  var each = function (xs, f) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n\n  var eachr = function (xs, f) {\n    for (var i = xs.length - 1; i >= 0; i--) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n\n  var groupBy = function (xs, f) {\n    if (xs.length === 0) {\n      return [];\n    } else {\n      var wasType = f(xs[0]);\n      var r = [];\n      var group = [];\n\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        var type = f(x);\n\n        if (type !== wasType) {\n          r.push(group);\n          group = [];\n        }\n\n        wasType = type;\n        group.push(x);\n      }\n\n      if (group.length !== 0) {\n        r.push(group);\n      }\n\n      return r;\n    }\n  };\n\n  var foldl = function (xs, f, acc) {\n    each(xs, function (x) {\n      acc = f(acc, x);\n    });\n    return acc;\n  };\n\n  var flatten = function (xs) {\n    var r = [];\n\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n\n      nativePush.apply(r, xs[i]);\n    }\n\n    return r;\n  };\n\n  var bind = function (xs, f) {\n    return flatten(map(xs, f));\n  };\n\n  var sort = function (xs, comparator) {\n    var copy = nativeSlice.call(xs, 0);\n    copy.sort(comparator);\n    return copy;\n  };\n\n  var hasOwnProperty = Object.hasOwnProperty;\n\n  var has = function (obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n\n  var Global = typeof window !== 'undefined' ? window : Function('return this;')();\n  var DOCUMENT = 9;\n  var DOCUMENT_FRAGMENT = 11;\n  var ELEMENT = 1;\n  var TEXT = 3;\n\n  var type = function (element) {\n    return element.dom.nodeType;\n  };\n\n  var isType$1 = function (t) {\n    return function (element) {\n      return type(element) === t;\n    };\n  };\n\n  var isText = isType$1(TEXT);\n\n  var rawSet = function (dom, key, value) {\n    if (isString(value) || isBoolean(value) || isNumber(value)) {\n      dom.setAttribute(key, value + '');\n    } else {\n      console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n      throw new Error('Attribute value was not simple');\n    }\n  };\n\n  var set = function (element, key, value) {\n    rawSet(element.dom, key, value);\n  };\n\n  var compareDocumentPosition = function (a, b, match) {\n    return (a.compareDocumentPosition(b) & match) !== 0;\n  };\n\n  var documentPositionPreceding = function (a, b) {\n    return compareDocumentPosition(a, b, Node.DOCUMENT_POSITION_PRECEDING);\n  };\n\n  var fromHtml = function (html, scope) {\n    var doc = scope || document;\n    var div = doc.createElement('div');\n    div.innerHTML = html;\n\n    if (!div.hasChildNodes() || div.childNodes.length > 1) {\n      console.error('HTML does not have a single root node', html);\n      throw new Error('HTML must have a single root node');\n    }\n\n    return fromDom(div.childNodes[0]);\n  };\n\n  var fromTag = function (tag, scope) {\n    var doc = scope || document;\n    var node = doc.createElement(tag);\n    return fromDom(node);\n  };\n\n  var fromText = function (text, scope) {\n    var doc = scope || document;\n    var node = doc.createTextNode(text);\n    return fromDom(node);\n  };\n\n  var fromDom = function (node) {\n    if (node === null || node === undefined) {\n      throw new Error('Node cannot be null or undefined');\n    }\n\n    return {\n      dom: node\n    };\n  };\n\n  var fromPoint = function (docElm, x, y) {\n    return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n  };\n\n  var SugarElement = {\n    fromHtml: fromHtml,\n    fromTag: fromTag,\n    fromText: fromText,\n    fromDom: fromDom,\n    fromPoint: fromPoint\n  };\n\n  var bypassSelector = function (dom) {\n    return dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT && dom.nodeType !== DOCUMENT_FRAGMENT || dom.childElementCount === 0;\n  };\n\n  var all = function (selector, scope) {\n    var base = scope === undefined ? document : scope.dom;\n    return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), SugarElement.fromDom);\n  };\n\n  var parent = function (element) {\n    return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);\n  };\n\n  var children = function (element) {\n    return map(element.dom.childNodes, SugarElement.fromDom);\n  };\n\n  var spot = function (element, offset) {\n    return {\n      element: element,\n      offset: offset\n    };\n  };\n\n  var leaf = function (element, offset) {\n    var cs = children(element);\n    return cs.length > 0 && offset < cs.length ? spot(cs[offset], 0) : spot(element, offset);\n  };\n\n  var before = function (marker, element) {\n    var parent$1 = parent(marker);\n    parent$1.each(function (v) {\n      v.dom.insertBefore(element.dom, marker.dom);\n    });\n  };\n\n  var append = function (parent, element) {\n    parent.dom.appendChild(element.dom);\n  };\n\n  var wrap = function (element, wrapper) {\n    before(element, wrapper);\n    append(wrapper, element);\n  };\n\n  var NodeValue = function (is, name) {\n    var get = function (element) {\n      if (!is(element)) {\n        throw new Error('Can only get ' + name + ' value of a ' + name + ' node');\n      }\n\n      return getOption(element).getOr('');\n    };\n\n    var getOption = function (element) {\n      return is(element) ? Optional.from(element.dom.nodeValue) : Optional.none();\n    };\n\n    var set = function (element, value) {\n      if (!is(element)) {\n        throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');\n      }\n\n      element.dom.nodeValue = value;\n    };\n\n    return {\n      get: get,\n      getOption: getOption,\n      set: set\n    };\n  };\n\n  var api = NodeValue(isText, 'text');\n\n  var get = function (element) {\n    return api.get(element);\n  };\n\n  var descendants = function (scope, selector) {\n    return all(selector, scope);\n  };\n\n  var global$2 = tinymce.util.Tools.resolve('tinymce.dom.TreeWalker');\n\n  var isSimpleBoundary = function (dom, node) {\n    return dom.isBlock(node) || has(dom.schema.getShortEndedElements(), node.nodeName);\n  };\n\n  var isContentEditableFalse = function (dom, node) {\n    return dom.getContentEditable(node) === 'false';\n  };\n\n  var isContentEditableTrueInCef = function (dom, node) {\n    return dom.getContentEditable(node) === 'true' && dom.getContentEditableParent(node.parentNode) === 'false';\n  };\n\n  var isHidden = function (dom, node) {\n    return !dom.isBlock(node) && has(dom.schema.getWhiteSpaceElements(), node.nodeName);\n  };\n\n  var isBoundary = function (dom, node) {\n    return isSimpleBoundary(dom, node) || isContentEditableFalse(dom, node) || isHidden(dom, node) || isContentEditableTrueInCef(dom, node);\n  };\n\n  var isText$1 = function (node) {\n    return node.nodeType === 3;\n  };\n\n  var nuSection = function () {\n    return {\n      sOffset: 0,\n      fOffset: 0,\n      elements: []\n    };\n  };\n\n  var toLeaf = function (node, offset) {\n    return leaf(SugarElement.fromDom(node), offset);\n  };\n\n  var walk = function (dom, walkerFn, startNode, callbacks, endNode, skipStart) {\n    if (skipStart === void 0) {\n      skipStart = true;\n    }\n\n    var next = skipStart ? walkerFn(false) : startNode;\n\n    while (next) {\n      var isCefNode = isContentEditableFalse(dom, next);\n\n      if (isCefNode || isHidden(dom, next)) {\n        var stopWalking = isCefNode ? callbacks.cef(next) : callbacks.boundary(next);\n\n        if (stopWalking) {\n          break;\n        } else {\n          next = walkerFn(true);\n          continue;\n        }\n      } else if (isSimpleBoundary(dom, next)) {\n        if (callbacks.boundary(next)) {\n          break;\n        }\n      } else if (isText$1(next)) {\n        callbacks.text(next);\n      }\n\n      if (next === endNode) {\n        break;\n      } else {\n        next = walkerFn(false);\n      }\n    }\n  };\n\n  var collectTextToBoundary = function (dom, section, node, rootNode, forwards) {\n    if (isBoundary(dom, node)) {\n      return;\n    }\n\n    var rootBlock = dom.getParent(rootNode, dom.isBlock);\n    var walker = new global$2(node, rootBlock);\n    var walkerFn = forwards ? walker.next.bind(walker) : walker.prev.bind(walker);\n    walk(dom, walkerFn, node, {\n      boundary: always,\n      cef: always,\n      text: function (next) {\n        if (forwards) {\n          section.fOffset += next.length;\n        } else {\n          section.sOffset += next.length;\n        }\n\n        section.elements.push(SugarElement.fromDom(next));\n      }\n    });\n  };\n\n  var collect = function (dom, rootNode, startNode, endNode, callbacks, skipStart) {\n    if (skipStart === void 0) {\n      skipStart = true;\n    }\n\n    var walker = new global$2(startNode, rootNode);\n    var sections = [];\n    var current = nuSection();\n    collectTextToBoundary(dom, current, startNode, rootNode, false);\n\n    var finishSection = function () {\n      if (current.elements.length > 0) {\n        sections.push(current);\n        current = nuSection();\n      }\n\n      return false;\n    };\n\n    walk(dom, walker.next.bind(walker), startNode, {\n      boundary: finishSection,\n      cef: function (node) {\n        finishSection();\n\n        if (callbacks) {\n          sections.push.apply(sections, callbacks.cef(node));\n        }\n\n        return false;\n      },\n      text: function (next) {\n        current.elements.push(SugarElement.fromDom(next));\n\n        if (callbacks) {\n          callbacks.text(next, current);\n        }\n      }\n    }, endNode, skipStart);\n\n    if (endNode) {\n      collectTextToBoundary(dom, current, endNode, rootNode, true);\n    }\n\n    finishSection();\n    return sections;\n  };\n\n  var collectRangeSections = function (dom, rng) {\n    var start = toLeaf(rng.startContainer, rng.startOffset);\n    var startNode = start.element.dom;\n    var end = toLeaf(rng.endContainer, rng.endOffset);\n    var endNode = end.element.dom;\n    return collect(dom, rng.commonAncestorContainer, startNode, endNode, {\n      text: function (node, section) {\n        if (node === endNode) {\n          section.fOffset += node.length - end.offset;\n        } else if (node === startNode) {\n          section.sOffset += start.offset;\n        }\n      },\n      cef: function (node) {\n        var sections = bind(descendants(SugarElement.fromDom(node), '*[contenteditable=true]'), function (e) {\n          var ceTrueNode = e.dom;\n          return collect(dom, ceTrueNode, ceTrueNode);\n        });\n        return sort(sections, function (a, b) {\n          return documentPositionPreceding(a.elements[0].dom, b.elements[0].dom) ? 1 : -1;\n        });\n      }\n    }, false);\n  };\n\n  var fromRng = function (dom, rng) {\n    return rng.collapsed ? [] : collectRangeSections(dom, rng);\n  };\n\n  var fromNode = function (dom, node) {\n    var rng = dom.createRng();\n    rng.selectNode(node);\n    return fromRng(dom, rng);\n  };\n\n  var fromNodes = function (dom, nodes) {\n    return bind(nodes, function (node) {\n      return fromNode(dom, node);\n    });\n  };\n\n  var find = function (text, pattern, start, finish) {\n    if (start === void 0) {\n      start = 0;\n    }\n\n    if (finish === void 0) {\n      finish = text.length;\n    }\n\n    var regex = pattern.regex;\n    regex.lastIndex = start;\n    var results = [];\n    var match;\n\n    while (match = regex.exec(text)) {\n      var matchedText = match[pattern.matchIndex];\n      var matchStart = match.index + match[0].indexOf(matchedText);\n      var matchFinish = matchStart + matchedText.length;\n\n      if (matchFinish > finish) {\n        break;\n      }\n\n      results.push({\n        start: matchStart,\n        finish: matchFinish\n      });\n      regex.lastIndex = matchFinish;\n    }\n\n    return results;\n  };\n\n  var extract = function (elements, matches) {\n    var nodePositions = foldl(elements, function (acc, element) {\n      var content = get(element);\n      var start = acc.last;\n      var finish = start + content.length;\n      var positions = bind(matches, function (match, matchIdx) {\n        if (match.start < finish && match.finish > start) {\n          return [{\n            element: element,\n            start: Math.max(start, match.start) - start,\n            finish: Math.min(finish, match.finish) - start,\n            matchId: matchIdx\n          }];\n        } else {\n          return [];\n        }\n      });\n      return {\n        results: acc.results.concat(positions),\n        last: finish\n      };\n    }, {\n      results: [],\n      last: 0\n    }).results;\n    return groupBy(nodePositions, function (position) {\n      return position.matchId;\n    });\n  };\n\n  var find$1 = function (pattern, sections) {\n    return bind(sections, function (section) {\n      var elements = section.elements;\n      var content = map(elements, get).join('');\n      var positions = find(content, pattern, section.sOffset, content.length - section.fOffset);\n      return extract(elements, positions);\n    });\n  };\n\n  var mark = function (matches, replacementNode) {\n    eachr(matches, function (match, idx) {\n      eachr(match, function (pos) {\n        var wrapper = SugarElement.fromDom(replacementNode.cloneNode(false));\n        set(wrapper, 'data-mce-index', idx);\n        var textNode = pos.element.dom;\n\n        if (textNode.length === pos.finish && pos.start === 0) {\n          wrap(pos.element, wrapper);\n        } else {\n          if (textNode.length !== pos.finish) {\n            textNode.splitText(pos.finish);\n          }\n\n          var matchNode = textNode.splitText(pos.start);\n          wrap(SugarElement.fromDom(matchNode), wrapper);\n        }\n      });\n    });\n  };\n\n  var findAndMark = function (dom, pattern, node, replacementNode) {\n    var textSections = fromNode(dom, node);\n    var matches = find$1(pattern, textSections);\n    mark(matches, replacementNode);\n    return matches.length;\n  };\n\n  var findAndMarkInSelection = function (dom, pattern, selection, replacementNode) {\n    var bookmark = selection.getBookmark();\n    var nodes = dom.select('td[data-mce-selected],th[data-mce-selected]');\n    var textSections = nodes.length > 0 ? fromNodes(dom, nodes) : fromRng(dom, selection.getRng());\n    var matches = find$1(pattern, textSections);\n    mark(matches, replacementNode);\n    selection.moveToBookmark(bookmark);\n    return matches.length;\n  };\n\n  var getElmIndex = function (elm) {\n    var value = elm.getAttribute('data-mce-index');\n\n    if (typeof value === 'number') {\n      return '' + value;\n    }\n\n    return value;\n  };\n\n  var markAllMatches = function (editor, currentSearchState, pattern, inSelection) {\n    var marker = editor.dom.create('span', {\n      'data-mce-bogus': 1\n    });\n    marker.className = 'mce-match-marker';\n    var node = editor.getBody();\n    done(editor, currentSearchState, false);\n\n    if (inSelection) {\n      return findAndMarkInSelection(editor.dom, pattern, editor.selection, marker);\n    } else {\n      return findAndMark(editor.dom, pattern, node, marker);\n    }\n  };\n\n  var unwrap = function (node) {\n    var parentNode = node.parentNode;\n\n    if (node.firstChild) {\n      parentNode.insertBefore(node.firstChild, node);\n    }\n\n    node.parentNode.removeChild(node);\n  };\n\n  var findSpansByIndex = function (editor, index) {\n    var spans = [];\n    var nodes = global$1.toArray(editor.getBody().getElementsByTagName('span'));\n\n    if (nodes.length) {\n      for (var i = 0; i < nodes.length; i++) {\n        var nodeIndex = getElmIndex(nodes[i]);\n\n        if (nodeIndex === null || !nodeIndex.length) {\n          continue;\n        }\n\n        if (nodeIndex === index.toString()) {\n          spans.push(nodes[i]);\n        }\n      }\n    }\n\n    return spans;\n  };\n\n  var moveSelection = function (editor, currentSearchState, forward) {\n    var searchState = currentSearchState.get();\n    var testIndex = searchState.index;\n    var dom = editor.dom;\n    forward = forward !== false;\n\n    if (forward) {\n      if (testIndex + 1 === searchState.count) {\n        testIndex = 0;\n      } else {\n        testIndex++;\n      }\n    } else {\n      if (testIndex - 1 === -1) {\n        testIndex = searchState.count - 1;\n      } else {\n        testIndex--;\n      }\n    }\n\n    dom.removeClass(findSpansByIndex(editor, searchState.index), 'mce-match-marker-selected');\n    var spans = findSpansByIndex(editor, testIndex);\n\n    if (spans.length) {\n      dom.addClass(findSpansByIndex(editor, testIndex), 'mce-match-marker-selected');\n      editor.selection.scrollIntoView(spans[0]);\n      return testIndex;\n    }\n\n    return -1;\n  };\n\n  var removeNode = function (dom, node) {\n    var parent = node.parentNode;\n    dom.remove(node);\n\n    if (dom.isEmpty(parent)) {\n      dom.remove(parent);\n    }\n  };\n\n  var escapeSearchText = function (text, wholeWord) {\n    var escapedText = text.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&').replace(/\\s/g, '[^\\\\S\\\\r\\\\n\\\\uFEFF]');\n    var wordRegex = '(' + escapedText + ')';\n    return wholeWord ? '(?:^|\\\\s|' + punctuation$1() + ')' + wordRegex + ('(?=$|\\\\s|' + punctuation$1() + ')') : wordRegex;\n  };\n\n  var find$2 = function (editor, currentSearchState, text, matchCase, wholeWord, inSelection) {\n    var escapedText = escapeSearchText(text, wholeWord);\n    var pattern = {\n      regex: new RegExp(escapedText, matchCase ? 'g' : 'gi'),\n      matchIndex: 1\n    };\n    var count = markAllMatches(editor, currentSearchState, pattern, inSelection);\n\n    if (count) {\n      var newIndex = moveSelection(editor, currentSearchState, true);\n      currentSearchState.set({\n        index: newIndex,\n        count: count,\n        text: text,\n        matchCase: matchCase,\n        wholeWord: wholeWord,\n        inSelection: inSelection\n      });\n    }\n\n    return count;\n  };\n\n  var next = function (editor, currentSearchState) {\n    var index = moveSelection(editor, currentSearchState, true);\n    currentSearchState.set(__assign(__assign({}, currentSearchState.get()), {\n      index: index\n    }));\n  };\n\n  var prev = function (editor, currentSearchState) {\n    var index = moveSelection(editor, currentSearchState, false);\n    currentSearchState.set(__assign(__assign({}, currentSearchState.get()), {\n      index: index\n    }));\n  };\n\n  var isMatchSpan = function (node) {\n    var matchIndex = getElmIndex(node);\n    return matchIndex !== null && matchIndex.length > 0;\n  };\n\n  var replace = function (editor, currentSearchState, text, forward, all) {\n    var searchState = currentSearchState.get();\n    var currentIndex = searchState.index;\n    var currentMatchIndex,\n        nextIndex = currentIndex;\n    forward = forward !== false;\n    var node = editor.getBody();\n    var nodes = global$1.grep(global$1.toArray(node.getElementsByTagName('span')), isMatchSpan);\n\n    for (var i = 0; i < nodes.length; i++) {\n      var nodeIndex = getElmIndex(nodes[i]);\n      var matchIndex = currentMatchIndex = parseInt(nodeIndex, 10);\n\n      if (all || matchIndex === searchState.index) {\n        if (text.length) {\n          nodes[i].firstChild.nodeValue = text;\n          unwrap(nodes[i]);\n        } else {\n          removeNode(editor.dom, nodes[i]);\n        }\n\n        while (nodes[++i]) {\n          matchIndex = parseInt(getElmIndex(nodes[i]), 10);\n\n          if (matchIndex === currentMatchIndex) {\n            removeNode(editor.dom, nodes[i]);\n          } else {\n            i--;\n            break;\n          }\n        }\n\n        if (forward) {\n          nextIndex--;\n        }\n      } else if (currentMatchIndex > currentIndex) {\n        nodes[i].setAttribute('data-mce-index', String(currentMatchIndex - 1));\n      }\n    }\n\n    currentSearchState.set(__assign(__assign({}, searchState), {\n      count: all ? 0 : searchState.count - 1,\n      index: nextIndex\n    }));\n\n    if (forward) {\n      next(editor, currentSearchState);\n    } else {\n      prev(editor, currentSearchState);\n    }\n\n    return !all && currentSearchState.get().count > 0;\n  };\n\n  var done = function (editor, currentSearchState, keepEditorSelection) {\n    var i, startContainer, endContainer;\n    var searchState = currentSearchState.get();\n    var nodes = global$1.toArray(editor.getBody().getElementsByTagName('span'));\n\n    for (i = 0; i < nodes.length; i++) {\n      var nodeIndex = getElmIndex(nodes[i]);\n\n      if (nodeIndex !== null && nodeIndex.length) {\n        if (nodeIndex === searchState.index.toString()) {\n          if (!startContainer) {\n            startContainer = nodes[i].firstChild;\n          }\n\n          endContainer = nodes[i].firstChild;\n        }\n\n        unwrap(nodes[i]);\n      }\n    }\n\n    currentSearchState.set(__assign(__assign({}, searchState), {\n      index: -1,\n      count: 0,\n      text: ''\n    }));\n\n    if (startContainer && endContainer) {\n      var rng = editor.dom.createRng();\n      rng.setStart(startContainer, 0);\n      rng.setEnd(endContainer, endContainer.data.length);\n\n      if (keepEditorSelection !== false) {\n        editor.selection.setRng(rng);\n      }\n\n      return rng;\n    }\n  };\n\n  var hasNext = function (editor, currentSearchState) {\n    return currentSearchState.get().count > 1;\n  };\n\n  var hasPrev = function (editor, currentSearchState) {\n    return currentSearchState.get().count > 1;\n  };\n\n  var get$1 = function (editor, currentState) {\n    var done$1 = function (keepEditorSelection) {\n      return done(editor, currentState, keepEditorSelection);\n    };\n\n    var find = function (text, matchCase, wholeWord, inSelection) {\n      if (inSelection === void 0) {\n        inSelection = false;\n      }\n\n      return find$2(editor, currentState, text, matchCase, wholeWord, inSelection);\n    };\n\n    var next$1 = function () {\n      return next(editor, currentState);\n    };\n\n    var prev$1 = function () {\n      return prev(editor, currentState);\n    };\n\n    var replace$1 = function (text, forward, all) {\n      return replace(editor, currentState, text, forward, all);\n    };\n\n    return {\n      done: done$1,\n      find: find,\n      next: next$1,\n      prev: prev$1,\n      replace: replace$1\n    };\n  };\n\n  var value = function () {\n    var subject = Cell(Optional.none());\n\n    var clear = function () {\n      return subject.set(Optional.none());\n    };\n\n    var set = function (s) {\n      return subject.set(Optional.some(s));\n    };\n\n    var isSet = function () {\n      return subject.get().isSome();\n    };\n\n    var on = function (f) {\n      return subject.get().each(f);\n    };\n\n    return {\n      clear: clear,\n      set: set,\n      isSet: isSet,\n      on: on\n    };\n  };\n\n  var global$3 = tinymce.util.Tools.resolve('tinymce.Env');\n\n  var open = function (editor, currentSearchState) {\n    var dialogApi = value();\n    editor.undoManager.add();\n    var selectedText = global$1.trim(editor.selection.getContent({\n      format: 'text'\n    }));\n\n    var updateButtonStates = function (api) {\n      var updateNext = hasNext(editor, currentSearchState) ? api.enable : api.disable;\n      updateNext('next');\n      var updatePrev = hasPrev(editor, currentSearchState) ? api.enable : api.disable;\n      updatePrev('prev');\n    };\n\n    var updateSearchState = function (api) {\n      var data = api.getData();\n      var current = currentSearchState.get();\n      currentSearchState.set(__assign(__assign({}, current), {\n        matchCase: data.matchcase,\n        wholeWord: data.wholewords,\n        inSelection: data.inselection\n      }));\n    };\n\n    var disableAll = function (api, disable) {\n      var buttons = ['replace', 'replaceall', 'prev', 'next'];\n      var toggle = disable ? api.disable : api.enable;\n      each(buttons, toggle);\n    };\n\n    var notFoundAlert = function (api) {\n      editor.windowManager.alert('Could not find the specified string.', function () {\n        api.focus('findtext');\n      });\n    };\n\n    var focusButtonIfRequired = function (api, name) {\n      if (global$3.browser.isSafari() && global$3.deviceType.isTouch() && (name === 'find' || name === 'replace' || name === 'replaceall')) {\n        api.focus(name);\n      }\n    };\n\n    var reset = function (api) {\n      done(editor, currentSearchState, false);\n      disableAll(api, true);\n      updateButtonStates(api);\n    };\n\n    var doFind = function (api) {\n      var data = api.getData();\n      var last = currentSearchState.get();\n\n      if (!data.findtext.length) {\n        reset(api);\n        return;\n      }\n\n      if (last.text === data.findtext && last.matchCase === data.matchcase && last.wholeWord === data.wholewords) {\n        next(editor, currentSearchState);\n      } else {\n        var count = find$2(editor, currentSearchState, data.findtext, data.matchcase, data.wholewords, data.inselection);\n\n        if (count <= 0) {\n          notFoundAlert(api);\n        }\n\n        disableAll(api, count === 0);\n      }\n\n      updateButtonStates(api);\n    };\n\n    var initialState = currentSearchState.get();\n    var initialData = {\n      findtext: selectedText,\n      replacetext: '',\n      wholewords: initialState.wholeWord,\n      matchcase: initialState.matchCase,\n      inselection: initialState.inSelection\n    };\n    var spec = {\n      title: 'Find and Replace',\n      size: 'normal',\n      body: {\n        type: 'panel',\n        items: [{\n          type: 'bar',\n          items: [{\n            type: 'input',\n            name: 'findtext',\n            placeholder: 'Find',\n            maximized: true,\n            inputMode: 'search'\n          }, {\n            type: 'button',\n            name: 'prev',\n            text: 'Previous',\n            icon: 'action-prev',\n            disabled: true,\n            borderless: true\n          }, {\n            type: 'button',\n            name: 'next',\n            text: 'Next',\n            icon: 'action-next',\n            disabled: true,\n            borderless: true\n          }]\n        }, {\n          type: 'input',\n          name: 'replacetext',\n          placeholder: 'Replace with',\n          inputMode: 'search'\n        }]\n      },\n      buttons: [{\n        type: 'menu',\n        name: 'options',\n        icon: 'preferences',\n        tooltip: 'Preferences',\n        align: 'start',\n        items: [{\n          type: 'togglemenuitem',\n          name: 'matchcase',\n          text: 'Match case'\n        }, {\n          type: 'togglemenuitem',\n          name: 'wholewords',\n          text: 'Find whole words only'\n        }, {\n          type: 'togglemenuitem',\n          name: 'inselection',\n          text: 'Find in selection'\n        }]\n      }, {\n        type: 'custom',\n        name: 'find',\n        text: 'Find',\n        primary: true\n      }, {\n        type: 'custom',\n        name: 'replace',\n        text: 'Replace',\n        disabled: true\n      }, {\n        type: 'custom',\n        name: 'replaceall',\n        text: 'Replace all',\n        disabled: true\n      }],\n      initialData: initialData,\n      onChange: function (api, details) {\n        if (details.name === 'findtext' && currentSearchState.get().count > 0) {\n          reset(api);\n        }\n      },\n      onAction: function (api, details) {\n        var data = api.getData();\n\n        switch (details.name) {\n          case 'find':\n            doFind(api);\n            break;\n\n          case 'replace':\n            if (!replace(editor, currentSearchState, data.replacetext)) {\n              reset(api);\n            } else {\n              updateButtonStates(api);\n            }\n\n            break;\n\n          case 'replaceall':\n            replace(editor, currentSearchState, data.replacetext, true, true);\n            reset(api);\n            break;\n\n          case 'prev':\n            prev(editor, currentSearchState);\n            updateButtonStates(api);\n            break;\n\n          case 'next':\n            next(editor, currentSearchState);\n            updateButtonStates(api);\n            break;\n\n          case 'matchcase':\n          case 'wholewords':\n          case 'inselection':\n            updateSearchState(api);\n            reset(api);\n            break;\n        }\n\n        focusButtonIfRequired(api, details.name);\n      },\n      onSubmit: function (api) {\n        doFind(api);\n        focusButtonIfRequired(api, 'find');\n      },\n      onClose: function () {\n        editor.focus();\n        done(editor, currentSearchState);\n        editor.undoManager.add();\n      }\n    };\n    dialogApi.set(editor.windowManager.open(spec, {\n      inline: 'toolbar'\n    }));\n  };\n\n  var register = function (editor, currentSearchState) {\n    editor.addCommand('SearchReplace', function () {\n      open(editor, currentSearchState);\n    });\n  };\n\n  var showDialog = function (editor, currentSearchState) {\n    return function () {\n      open(editor, currentSearchState);\n    };\n  };\n\n  var register$1 = function (editor, currentSearchState) {\n    editor.ui.registry.addMenuItem('searchreplace', {\n      text: 'Find and replace...',\n      shortcut: 'Meta+F',\n      onAction: showDialog(editor, currentSearchState),\n      icon: 'search'\n    });\n    editor.ui.registry.addButton('searchreplace', {\n      tooltip: 'Find and replace',\n      onAction: showDialog(editor, currentSearchState),\n      icon: 'search'\n    });\n    editor.shortcuts.add('Meta+F', '', showDialog(editor, currentSearchState));\n  };\n\n  function Plugin() {\n    global.add('searchreplace', function (editor) {\n      var currentSearchState = Cell({\n        index: -1,\n        count: 0,\n        text: '',\n        matchCase: false,\n        wholeWord: false,\n        inSelection: false\n      });\n      register(editor, currentSearchState);\n      register$1(editor, currentSearchState);\n      return get$1(editor, currentSearchState);\n    });\n  }\n\n  Plugin();\n})();","map":{"version":3,"sources":["/home/lin/phase5/My-Place-Frontend/my-place/node_modules/tinymce/plugins/searchreplace/plugin.js"],"names":["Cell","initial","value","get","set","v","global","tinymce","util","Tools","resolve","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","typeOf","x","Array","isPrototypeOf","constructor","name","String","isType","type","isSimpleType","isString","isArray","isBoolean","isNumber","noop","constant","never","always","punctuationStr","punctuation","none","NONE","eq","o","isNone","thunk","id","me","fold","_s","is","isSome","getOr","getOrThunk","getOrDie","msg","Error","getOrNull","getOrUndefined","undefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","some","a","constant_a","self","f","elementEq","b","from","Optional","punctuation$1","global$1","nativeSlice","slice","nativePush","push","xs","len","r","eachr","groupBy","wasType","group","foldl","acc","flatten","sort","comparator","copy","has","obj","key","Global","window","Function","DOCUMENT","DOCUMENT_FRAGMENT","ELEMENT","TEXT","element","dom","nodeType","isType$1","isText","rawSet","setAttribute","console","error","compareDocumentPosition","match","documentPositionPreceding","Node","DOCUMENT_POSITION_PRECEDING","fromHtml","html","scope","doc","document","div","createElement","innerHTML","hasChildNodes","childNodes","fromDom","fromTag","tag","node","fromText","text","createTextNode","fromPoint","docElm","y","elementFromPoint","SugarElement","bypassSelector","childElementCount","all","selector","base","querySelectorAll","parent","parentNode","children","spot","offset","leaf","cs","before","marker","parent$1","insertBefore","append","appendChild","wrap","wrapper","NodeValue","getOption","nodeValue","api","descendants","global$2","isSimpleBoundary","isBlock","schema","getShortEndedElements","nodeName","isContentEditableFalse","getContentEditable","isContentEditableTrueInCef","getContentEditableParent","isHidden","getWhiteSpaceElements","isBoundary","isText$1","nuSection","sOffset","fOffset","elements","toLeaf","walk","walkerFn","startNode","callbacks","endNode","skipStart","next","isCefNode","stopWalking","cef","boundary","collectTextToBoundary","section","rootNode","forwards","rootBlock","getParent","walker","prev","collect","sections","current","finishSection","collectRangeSections","rng","start","startContainer","startOffset","end","endContainer","endOffset","commonAncestorContainer","e","ceTrueNode","fromRng","collapsed","fromNode","createRng","selectNode","fromNodes","nodes","find","pattern","finish","regex","lastIndex","results","exec","matchedText","matchIndex","matchStart","index","indexOf","matchFinish","extract","matches","nodePositions","content","last","positions","matchIdx","Math","max","min","matchId","concat","position","find$1","join","mark","replacementNode","idx","pos","cloneNode","textNode","splitText","matchNode","findAndMark","textSections","findAndMarkInSelection","selection","bookmark","getBookmark","select","getRng","moveToBookmark","getElmIndex","elm","getAttribute","markAllMatches","editor","currentSearchState","inSelection","create","className","getBody","done","unwrap","firstChild","removeChild","findSpansByIndex","spans","getElementsByTagName","nodeIndex","moveSelection","forward","searchState","testIndex","count","removeClass","addClass","scrollIntoView","removeNode","remove","isEmpty","escapeSearchText","wholeWord","escapedText","replace","wordRegex","find$2","matchCase","RegExp","newIndex","isMatchSpan","currentIndex","currentMatchIndex","nextIndex","grep","parseInt","keepEditorSelection","setStart","setEnd","data","setRng","hasNext","hasPrev","get$1","currentState","done$1","next$1","prev$1","replace$1","subject","clear","isSet","on","global$3","open","dialogApi","undoManager","add","selectedText","trim","getContent","format","updateButtonStates","updateNext","enable","disable","updatePrev","updateSearchState","getData","matchcase","wholewords","inselection","disableAll","buttons","toggle","notFoundAlert","windowManager","alert","focus","focusButtonIfRequired","browser","isSafari","deviceType","isTouch","reset","doFind","findtext","initialState","initialData","replacetext","spec","title","size","body","items","placeholder","maximized","inputMode","icon","disabled","borderless","tooltip","align","primary","onChange","details","onAction","onSubmit","onClose","inline","register","addCommand","showDialog","register$1","ui","registry","addMenuItem","shortcut","addButton","shortcuts","Plugin"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.8.2 (2021-06-23)\n */\n(function () {\n    'use strict';\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      return {\n        get: get,\n        set: set\n      };\n    };\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n\n    var typeOf = function (x) {\n      var t = typeof x;\n      if (x === null) {\n        return 'null';\n      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      } else {\n        return t;\n      }\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isSimpleType = function (type) {\n      return function (value) {\n        return typeof value === type;\n      };\n    };\n    var isString = isType('string');\n    var isArray = isType('array');\n    var isBoolean = isSimpleType('boolean');\n    var isNumber = isSimpleType('number');\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var punctuationStr = '[!-#%-*,-\\\\/:;?@\\\\[-\\\\]_{}\\xA1\\xAB\\xB7\\xBB\\xBF;\\xB7\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1361-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u3008\\u3009\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30\\u2E31\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uff3f\\uFF5B\\uFF5D\\uFF5F-\\uFF65]';\n\n    var punctuation = constant(punctuationStr);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, _s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Optional = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var punctuation$1 = punctuation;\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var nativeSlice = Array.prototype.slice;\n    var nativePush = Array.prototype.push;\n    var map = function (xs, f) {\n      var len = xs.length;\n      var r = new Array(len);\n      for (var i = 0; i < len; i++) {\n        var x = xs[i];\n        r[i] = f(x, i);\n      }\n      return r;\n    };\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var eachr = function (xs, f) {\n      for (var i = xs.length - 1; i >= 0; i--) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var groupBy = function (xs, f) {\n      if (xs.length === 0) {\n        return [];\n      } else {\n        var wasType = f(xs[0]);\n        var r = [];\n        var group = [];\n        for (var i = 0, len = xs.length; i < len; i++) {\n          var x = xs[i];\n          var type = f(x);\n          if (type !== wasType) {\n            r.push(group);\n            group = [];\n          }\n          wasType = type;\n          group.push(x);\n        }\n        if (group.length !== 0) {\n          r.push(group);\n        }\n        return r;\n      }\n    };\n    var foldl = function (xs, f, acc) {\n      each(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n    var bind = function (xs, f) {\n      return flatten(map(xs, f));\n    };\n    var sort = function (xs, comparator) {\n      var copy = nativeSlice.call(xs, 0);\n      copy.sort(comparator);\n      return copy;\n    };\n\n    var hasOwnProperty = Object.hasOwnProperty;\n    var has = function (obj, key) {\n      return hasOwnProperty.call(obj, key);\n    };\n\n    var Global = typeof window !== 'undefined' ? window : Function('return this;')();\n\n    var DOCUMENT = 9;\n    var DOCUMENT_FRAGMENT = 11;\n    var ELEMENT = 1;\n    var TEXT = 3;\n\n    var type = function (element) {\n      return element.dom.nodeType;\n    };\n    var isType$1 = function (t) {\n      return function (element) {\n        return type(element) === t;\n      };\n    };\n    var isText = isType$1(TEXT);\n\n    var rawSet = function (dom, key, value) {\n      if (isString(value) || isBoolean(value) || isNumber(value)) {\n        dom.setAttribute(key, value + '');\n      } else {\n        console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n        throw new Error('Attribute value was not simple');\n      }\n    };\n    var set = function (element, key, value) {\n      rawSet(element.dom, key, value);\n    };\n\n    var compareDocumentPosition = function (a, b, match) {\n      return (a.compareDocumentPosition(b) & match) !== 0;\n    };\n    var documentPositionPreceding = function (a, b) {\n      return compareDocumentPosition(a, b, Node.DOCUMENT_POSITION_PRECEDING);\n    };\n\n    var fromHtml = function (html, scope) {\n      var doc = scope || document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      if (!div.hasChildNodes() || div.childNodes.length > 1) {\n        console.error('HTML does not have a single root node', html);\n        throw new Error('HTML must have a single root node');\n      }\n      return fromDom(div.childNodes[0]);\n    };\n    var fromTag = function (tag, scope) {\n      var doc = scope || document;\n      var node = doc.createElement(tag);\n      return fromDom(node);\n    };\n    var fromText = function (text, scope) {\n      var doc = scope || document;\n      var node = doc.createTextNode(text);\n      return fromDom(node);\n    };\n    var fromDom = function (node) {\n      if (node === null || node === undefined) {\n        throw new Error('Node cannot be null or undefined');\n      }\n      return { dom: node };\n    };\n    var fromPoint = function (docElm, x, y) {\n      return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n    };\n    var SugarElement = {\n      fromHtml: fromHtml,\n      fromTag: fromTag,\n      fromText: fromText,\n      fromDom: fromDom,\n      fromPoint: fromPoint\n    };\n\n    var bypassSelector = function (dom) {\n      return dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT && dom.nodeType !== DOCUMENT_FRAGMENT || dom.childElementCount === 0;\n    };\n    var all = function (selector, scope) {\n      var base = scope === undefined ? document : scope.dom;\n      return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), SugarElement.fromDom);\n    };\n\n    var parent = function (element) {\n      return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);\n    };\n    var children = function (element) {\n      return map(element.dom.childNodes, SugarElement.fromDom);\n    };\n    var spot = function (element, offset) {\n      return {\n        element: element,\n        offset: offset\n      };\n    };\n    var leaf = function (element, offset) {\n      var cs = children(element);\n      return cs.length > 0 && offset < cs.length ? spot(cs[offset], 0) : spot(element, offset);\n    };\n\n    var before = function (marker, element) {\n      var parent$1 = parent(marker);\n      parent$1.each(function (v) {\n        v.dom.insertBefore(element.dom, marker.dom);\n      });\n    };\n    var append = function (parent, element) {\n      parent.dom.appendChild(element.dom);\n    };\n    var wrap = function (element, wrapper) {\n      before(element, wrapper);\n      append(wrapper, element);\n    };\n\n    var NodeValue = function (is, name) {\n      var get = function (element) {\n        if (!is(element)) {\n          throw new Error('Can only get ' + name + ' value of a ' + name + ' node');\n        }\n        return getOption(element).getOr('');\n      };\n      var getOption = function (element) {\n        return is(element) ? Optional.from(element.dom.nodeValue) : Optional.none();\n      };\n      var set = function (element, value) {\n        if (!is(element)) {\n          throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');\n        }\n        element.dom.nodeValue = value;\n      };\n      return {\n        get: get,\n        getOption: getOption,\n        set: set\n      };\n    };\n\n    var api = NodeValue(isText, 'text');\n    var get = function (element) {\n      return api.get(element);\n    };\n\n    var descendants = function (scope, selector) {\n      return all(selector, scope);\n    };\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.dom.TreeWalker');\n\n    var isSimpleBoundary = function (dom, node) {\n      return dom.isBlock(node) || has(dom.schema.getShortEndedElements(), node.nodeName);\n    };\n    var isContentEditableFalse = function (dom, node) {\n      return dom.getContentEditable(node) === 'false';\n    };\n    var isContentEditableTrueInCef = function (dom, node) {\n      return dom.getContentEditable(node) === 'true' && dom.getContentEditableParent(node.parentNode) === 'false';\n    };\n    var isHidden = function (dom, node) {\n      return !dom.isBlock(node) && has(dom.schema.getWhiteSpaceElements(), node.nodeName);\n    };\n    var isBoundary = function (dom, node) {\n      return isSimpleBoundary(dom, node) || isContentEditableFalse(dom, node) || isHidden(dom, node) || isContentEditableTrueInCef(dom, node);\n    };\n    var isText$1 = function (node) {\n      return node.nodeType === 3;\n    };\n    var nuSection = function () {\n      return {\n        sOffset: 0,\n        fOffset: 0,\n        elements: []\n      };\n    };\n    var toLeaf = function (node, offset) {\n      return leaf(SugarElement.fromDom(node), offset);\n    };\n    var walk = function (dom, walkerFn, startNode, callbacks, endNode, skipStart) {\n      if (skipStart === void 0) {\n        skipStart = true;\n      }\n      var next = skipStart ? walkerFn(false) : startNode;\n      while (next) {\n        var isCefNode = isContentEditableFalse(dom, next);\n        if (isCefNode || isHidden(dom, next)) {\n          var stopWalking = isCefNode ? callbacks.cef(next) : callbacks.boundary(next);\n          if (stopWalking) {\n            break;\n          } else {\n            next = walkerFn(true);\n            continue;\n          }\n        } else if (isSimpleBoundary(dom, next)) {\n          if (callbacks.boundary(next)) {\n            break;\n          }\n        } else if (isText$1(next)) {\n          callbacks.text(next);\n        }\n        if (next === endNode) {\n          break;\n        } else {\n          next = walkerFn(false);\n        }\n      }\n    };\n    var collectTextToBoundary = function (dom, section, node, rootNode, forwards) {\n      if (isBoundary(dom, node)) {\n        return;\n      }\n      var rootBlock = dom.getParent(rootNode, dom.isBlock);\n      var walker = new global$2(node, rootBlock);\n      var walkerFn = forwards ? walker.next.bind(walker) : walker.prev.bind(walker);\n      walk(dom, walkerFn, node, {\n        boundary: always,\n        cef: always,\n        text: function (next) {\n          if (forwards) {\n            section.fOffset += next.length;\n          } else {\n            section.sOffset += next.length;\n          }\n          section.elements.push(SugarElement.fromDom(next));\n        }\n      });\n    };\n    var collect = function (dom, rootNode, startNode, endNode, callbacks, skipStart) {\n      if (skipStart === void 0) {\n        skipStart = true;\n      }\n      var walker = new global$2(startNode, rootNode);\n      var sections = [];\n      var current = nuSection();\n      collectTextToBoundary(dom, current, startNode, rootNode, false);\n      var finishSection = function () {\n        if (current.elements.length > 0) {\n          sections.push(current);\n          current = nuSection();\n        }\n        return false;\n      };\n      walk(dom, walker.next.bind(walker), startNode, {\n        boundary: finishSection,\n        cef: function (node) {\n          finishSection();\n          if (callbacks) {\n            sections.push.apply(sections, callbacks.cef(node));\n          }\n          return false;\n        },\n        text: function (next) {\n          current.elements.push(SugarElement.fromDom(next));\n          if (callbacks) {\n            callbacks.text(next, current);\n          }\n        }\n      }, endNode, skipStart);\n      if (endNode) {\n        collectTextToBoundary(dom, current, endNode, rootNode, true);\n      }\n      finishSection();\n      return sections;\n    };\n    var collectRangeSections = function (dom, rng) {\n      var start = toLeaf(rng.startContainer, rng.startOffset);\n      var startNode = start.element.dom;\n      var end = toLeaf(rng.endContainer, rng.endOffset);\n      var endNode = end.element.dom;\n      return collect(dom, rng.commonAncestorContainer, startNode, endNode, {\n        text: function (node, section) {\n          if (node === endNode) {\n            section.fOffset += node.length - end.offset;\n          } else if (node === startNode) {\n            section.sOffset += start.offset;\n          }\n        },\n        cef: function (node) {\n          var sections = bind(descendants(SugarElement.fromDom(node), '*[contenteditable=true]'), function (e) {\n            var ceTrueNode = e.dom;\n            return collect(dom, ceTrueNode, ceTrueNode);\n          });\n          return sort(sections, function (a, b) {\n            return documentPositionPreceding(a.elements[0].dom, b.elements[0].dom) ? 1 : -1;\n          });\n        }\n      }, false);\n    };\n    var fromRng = function (dom, rng) {\n      return rng.collapsed ? [] : collectRangeSections(dom, rng);\n    };\n    var fromNode = function (dom, node) {\n      var rng = dom.createRng();\n      rng.selectNode(node);\n      return fromRng(dom, rng);\n    };\n    var fromNodes = function (dom, nodes) {\n      return bind(nodes, function (node) {\n        return fromNode(dom, node);\n      });\n    };\n\n    var find = function (text, pattern, start, finish) {\n      if (start === void 0) {\n        start = 0;\n      }\n      if (finish === void 0) {\n        finish = text.length;\n      }\n      var regex = pattern.regex;\n      regex.lastIndex = start;\n      var results = [];\n      var match;\n      while (match = regex.exec(text)) {\n        var matchedText = match[pattern.matchIndex];\n        var matchStart = match.index + match[0].indexOf(matchedText);\n        var matchFinish = matchStart + matchedText.length;\n        if (matchFinish > finish) {\n          break;\n        }\n        results.push({\n          start: matchStart,\n          finish: matchFinish\n        });\n        regex.lastIndex = matchFinish;\n      }\n      return results;\n    };\n    var extract = function (elements, matches) {\n      var nodePositions = foldl(elements, function (acc, element) {\n        var content = get(element);\n        var start = acc.last;\n        var finish = start + content.length;\n        var positions = bind(matches, function (match, matchIdx) {\n          if (match.start < finish && match.finish > start) {\n            return [{\n                element: element,\n                start: Math.max(start, match.start) - start,\n                finish: Math.min(finish, match.finish) - start,\n                matchId: matchIdx\n              }];\n          } else {\n            return [];\n          }\n        });\n        return {\n          results: acc.results.concat(positions),\n          last: finish\n        };\n      }, {\n        results: [],\n        last: 0\n      }).results;\n      return groupBy(nodePositions, function (position) {\n        return position.matchId;\n      });\n    };\n\n    var find$1 = function (pattern, sections) {\n      return bind(sections, function (section) {\n        var elements = section.elements;\n        var content = map(elements, get).join('');\n        var positions = find(content, pattern, section.sOffset, content.length - section.fOffset);\n        return extract(elements, positions);\n      });\n    };\n    var mark = function (matches, replacementNode) {\n      eachr(matches, function (match, idx) {\n        eachr(match, function (pos) {\n          var wrapper = SugarElement.fromDom(replacementNode.cloneNode(false));\n          set(wrapper, 'data-mce-index', idx);\n          var textNode = pos.element.dom;\n          if (textNode.length === pos.finish && pos.start === 0) {\n            wrap(pos.element, wrapper);\n          } else {\n            if (textNode.length !== pos.finish) {\n              textNode.splitText(pos.finish);\n            }\n            var matchNode = textNode.splitText(pos.start);\n            wrap(SugarElement.fromDom(matchNode), wrapper);\n          }\n        });\n      });\n    };\n    var findAndMark = function (dom, pattern, node, replacementNode) {\n      var textSections = fromNode(dom, node);\n      var matches = find$1(pattern, textSections);\n      mark(matches, replacementNode);\n      return matches.length;\n    };\n    var findAndMarkInSelection = function (dom, pattern, selection, replacementNode) {\n      var bookmark = selection.getBookmark();\n      var nodes = dom.select('td[data-mce-selected],th[data-mce-selected]');\n      var textSections = nodes.length > 0 ? fromNodes(dom, nodes) : fromRng(dom, selection.getRng());\n      var matches = find$1(pattern, textSections);\n      mark(matches, replacementNode);\n      selection.moveToBookmark(bookmark);\n      return matches.length;\n    };\n\n    var getElmIndex = function (elm) {\n      var value = elm.getAttribute('data-mce-index');\n      if (typeof value === 'number') {\n        return '' + value;\n      }\n      return value;\n    };\n    var markAllMatches = function (editor, currentSearchState, pattern, inSelection) {\n      var marker = editor.dom.create('span', { 'data-mce-bogus': 1 });\n      marker.className = 'mce-match-marker';\n      var node = editor.getBody();\n      done(editor, currentSearchState, false);\n      if (inSelection) {\n        return findAndMarkInSelection(editor.dom, pattern, editor.selection, marker);\n      } else {\n        return findAndMark(editor.dom, pattern, node, marker);\n      }\n    };\n    var unwrap = function (node) {\n      var parentNode = node.parentNode;\n      if (node.firstChild) {\n        parentNode.insertBefore(node.firstChild, node);\n      }\n      node.parentNode.removeChild(node);\n    };\n    var findSpansByIndex = function (editor, index) {\n      var spans = [];\n      var nodes = global$1.toArray(editor.getBody().getElementsByTagName('span'));\n      if (nodes.length) {\n        for (var i = 0; i < nodes.length; i++) {\n          var nodeIndex = getElmIndex(nodes[i]);\n          if (nodeIndex === null || !nodeIndex.length) {\n            continue;\n          }\n          if (nodeIndex === index.toString()) {\n            spans.push(nodes[i]);\n          }\n        }\n      }\n      return spans;\n    };\n    var moveSelection = function (editor, currentSearchState, forward) {\n      var searchState = currentSearchState.get();\n      var testIndex = searchState.index;\n      var dom = editor.dom;\n      forward = forward !== false;\n      if (forward) {\n        if (testIndex + 1 === searchState.count) {\n          testIndex = 0;\n        } else {\n          testIndex++;\n        }\n      } else {\n        if (testIndex - 1 === -1) {\n          testIndex = searchState.count - 1;\n        } else {\n          testIndex--;\n        }\n      }\n      dom.removeClass(findSpansByIndex(editor, searchState.index), 'mce-match-marker-selected');\n      var spans = findSpansByIndex(editor, testIndex);\n      if (spans.length) {\n        dom.addClass(findSpansByIndex(editor, testIndex), 'mce-match-marker-selected');\n        editor.selection.scrollIntoView(spans[0]);\n        return testIndex;\n      }\n      return -1;\n    };\n    var removeNode = function (dom, node) {\n      var parent = node.parentNode;\n      dom.remove(node);\n      if (dom.isEmpty(parent)) {\n        dom.remove(parent);\n      }\n    };\n    var escapeSearchText = function (text, wholeWord) {\n      var escapedText = text.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&').replace(/\\s/g, '[^\\\\S\\\\r\\\\n\\\\uFEFF]');\n      var wordRegex = '(' + escapedText + ')';\n      return wholeWord ? '(?:^|\\\\s|' + punctuation$1() + ')' + wordRegex + ('(?=$|\\\\s|' + punctuation$1() + ')') : wordRegex;\n    };\n    var find$2 = function (editor, currentSearchState, text, matchCase, wholeWord, inSelection) {\n      var escapedText = escapeSearchText(text, wholeWord);\n      var pattern = {\n        regex: new RegExp(escapedText, matchCase ? 'g' : 'gi'),\n        matchIndex: 1\n      };\n      var count = markAllMatches(editor, currentSearchState, pattern, inSelection);\n      if (count) {\n        var newIndex = moveSelection(editor, currentSearchState, true);\n        currentSearchState.set({\n          index: newIndex,\n          count: count,\n          text: text,\n          matchCase: matchCase,\n          wholeWord: wholeWord,\n          inSelection: inSelection\n        });\n      }\n      return count;\n    };\n    var next = function (editor, currentSearchState) {\n      var index = moveSelection(editor, currentSearchState, true);\n      currentSearchState.set(__assign(__assign({}, currentSearchState.get()), { index: index }));\n    };\n    var prev = function (editor, currentSearchState) {\n      var index = moveSelection(editor, currentSearchState, false);\n      currentSearchState.set(__assign(__assign({}, currentSearchState.get()), { index: index }));\n    };\n    var isMatchSpan = function (node) {\n      var matchIndex = getElmIndex(node);\n      return matchIndex !== null && matchIndex.length > 0;\n    };\n    var replace = function (editor, currentSearchState, text, forward, all) {\n      var searchState = currentSearchState.get();\n      var currentIndex = searchState.index;\n      var currentMatchIndex, nextIndex = currentIndex;\n      forward = forward !== false;\n      var node = editor.getBody();\n      var nodes = global$1.grep(global$1.toArray(node.getElementsByTagName('span')), isMatchSpan);\n      for (var i = 0; i < nodes.length; i++) {\n        var nodeIndex = getElmIndex(nodes[i]);\n        var matchIndex = currentMatchIndex = parseInt(nodeIndex, 10);\n        if (all || matchIndex === searchState.index) {\n          if (text.length) {\n            nodes[i].firstChild.nodeValue = text;\n            unwrap(nodes[i]);\n          } else {\n            removeNode(editor.dom, nodes[i]);\n          }\n          while (nodes[++i]) {\n            matchIndex = parseInt(getElmIndex(nodes[i]), 10);\n            if (matchIndex === currentMatchIndex) {\n              removeNode(editor.dom, nodes[i]);\n            } else {\n              i--;\n              break;\n            }\n          }\n          if (forward) {\n            nextIndex--;\n          }\n        } else if (currentMatchIndex > currentIndex) {\n          nodes[i].setAttribute('data-mce-index', String(currentMatchIndex - 1));\n        }\n      }\n      currentSearchState.set(__assign(__assign({}, searchState), {\n        count: all ? 0 : searchState.count - 1,\n        index: nextIndex\n      }));\n      if (forward) {\n        next(editor, currentSearchState);\n      } else {\n        prev(editor, currentSearchState);\n      }\n      return !all && currentSearchState.get().count > 0;\n    };\n    var done = function (editor, currentSearchState, keepEditorSelection) {\n      var i, startContainer, endContainer;\n      var searchState = currentSearchState.get();\n      var nodes = global$1.toArray(editor.getBody().getElementsByTagName('span'));\n      for (i = 0; i < nodes.length; i++) {\n        var nodeIndex = getElmIndex(nodes[i]);\n        if (nodeIndex !== null && nodeIndex.length) {\n          if (nodeIndex === searchState.index.toString()) {\n            if (!startContainer) {\n              startContainer = nodes[i].firstChild;\n            }\n            endContainer = nodes[i].firstChild;\n          }\n          unwrap(nodes[i]);\n        }\n      }\n      currentSearchState.set(__assign(__assign({}, searchState), {\n        index: -1,\n        count: 0,\n        text: ''\n      }));\n      if (startContainer && endContainer) {\n        var rng = editor.dom.createRng();\n        rng.setStart(startContainer, 0);\n        rng.setEnd(endContainer, endContainer.data.length);\n        if (keepEditorSelection !== false) {\n          editor.selection.setRng(rng);\n        }\n        return rng;\n      }\n    };\n    var hasNext = function (editor, currentSearchState) {\n      return currentSearchState.get().count > 1;\n    };\n    var hasPrev = function (editor, currentSearchState) {\n      return currentSearchState.get().count > 1;\n    };\n\n    var get$1 = function (editor, currentState) {\n      var done$1 = function (keepEditorSelection) {\n        return done(editor, currentState, keepEditorSelection);\n      };\n      var find = function (text, matchCase, wholeWord, inSelection) {\n        if (inSelection === void 0) {\n          inSelection = false;\n        }\n        return find$2(editor, currentState, text, matchCase, wholeWord, inSelection);\n      };\n      var next$1 = function () {\n        return next(editor, currentState);\n      };\n      var prev$1 = function () {\n        return prev(editor, currentState);\n      };\n      var replace$1 = function (text, forward, all) {\n        return replace(editor, currentState, text, forward, all);\n      };\n      return {\n        done: done$1,\n        find: find,\n        next: next$1,\n        prev: prev$1,\n        replace: replace$1\n      };\n    };\n\n    var value = function () {\n      var subject = Cell(Optional.none());\n      var clear = function () {\n        return subject.set(Optional.none());\n      };\n      var set = function (s) {\n        return subject.set(Optional.some(s));\n      };\n      var isSet = function () {\n        return subject.get().isSome();\n      };\n      var on = function (f) {\n        return subject.get().each(f);\n      };\n      return {\n        clear: clear,\n        set: set,\n        isSet: isSet,\n        on: on\n      };\n    };\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.Env');\n\n    var open = function (editor, currentSearchState) {\n      var dialogApi = value();\n      editor.undoManager.add();\n      var selectedText = global$1.trim(editor.selection.getContent({ format: 'text' }));\n      var updateButtonStates = function (api) {\n        var updateNext = hasNext(editor, currentSearchState) ? api.enable : api.disable;\n        updateNext('next');\n        var updatePrev = hasPrev(editor, currentSearchState) ? api.enable : api.disable;\n        updatePrev('prev');\n      };\n      var updateSearchState = function (api) {\n        var data = api.getData();\n        var current = currentSearchState.get();\n        currentSearchState.set(__assign(__assign({}, current), {\n          matchCase: data.matchcase,\n          wholeWord: data.wholewords,\n          inSelection: data.inselection\n        }));\n      };\n      var disableAll = function (api, disable) {\n        var buttons = [\n          'replace',\n          'replaceall',\n          'prev',\n          'next'\n        ];\n        var toggle = disable ? api.disable : api.enable;\n        each(buttons, toggle);\n      };\n      var notFoundAlert = function (api) {\n        editor.windowManager.alert('Could not find the specified string.', function () {\n          api.focus('findtext');\n        });\n      };\n      var focusButtonIfRequired = function (api, name) {\n        if (global$3.browser.isSafari() && global$3.deviceType.isTouch() && (name === 'find' || name === 'replace' || name === 'replaceall')) {\n          api.focus(name);\n        }\n      };\n      var reset = function (api) {\n        done(editor, currentSearchState, false);\n        disableAll(api, true);\n        updateButtonStates(api);\n      };\n      var doFind = function (api) {\n        var data = api.getData();\n        var last = currentSearchState.get();\n        if (!data.findtext.length) {\n          reset(api);\n          return;\n        }\n        if (last.text === data.findtext && last.matchCase === data.matchcase && last.wholeWord === data.wholewords) {\n          next(editor, currentSearchState);\n        } else {\n          var count = find$2(editor, currentSearchState, data.findtext, data.matchcase, data.wholewords, data.inselection);\n          if (count <= 0) {\n            notFoundAlert(api);\n          }\n          disableAll(api, count === 0);\n        }\n        updateButtonStates(api);\n      };\n      var initialState = currentSearchState.get();\n      var initialData = {\n        findtext: selectedText,\n        replacetext: '',\n        wholewords: initialState.wholeWord,\n        matchcase: initialState.matchCase,\n        inselection: initialState.inSelection\n      };\n      var spec = {\n        title: 'Find and Replace',\n        size: 'normal',\n        body: {\n          type: 'panel',\n          items: [\n            {\n              type: 'bar',\n              items: [\n                {\n                  type: 'input',\n                  name: 'findtext',\n                  placeholder: 'Find',\n                  maximized: true,\n                  inputMode: 'search'\n                },\n                {\n                  type: 'button',\n                  name: 'prev',\n                  text: 'Previous',\n                  icon: 'action-prev',\n                  disabled: true,\n                  borderless: true\n                },\n                {\n                  type: 'button',\n                  name: 'next',\n                  text: 'Next',\n                  icon: 'action-next',\n                  disabled: true,\n                  borderless: true\n                }\n              ]\n            },\n            {\n              type: 'input',\n              name: 'replacetext',\n              placeholder: 'Replace with',\n              inputMode: 'search'\n            }\n          ]\n        },\n        buttons: [\n          {\n            type: 'menu',\n            name: 'options',\n            icon: 'preferences',\n            tooltip: 'Preferences',\n            align: 'start',\n            items: [\n              {\n                type: 'togglemenuitem',\n                name: 'matchcase',\n                text: 'Match case'\n              },\n              {\n                type: 'togglemenuitem',\n                name: 'wholewords',\n                text: 'Find whole words only'\n              },\n              {\n                type: 'togglemenuitem',\n                name: 'inselection',\n                text: 'Find in selection'\n              }\n            ]\n          },\n          {\n            type: 'custom',\n            name: 'find',\n            text: 'Find',\n            primary: true\n          },\n          {\n            type: 'custom',\n            name: 'replace',\n            text: 'Replace',\n            disabled: true\n          },\n          {\n            type: 'custom',\n            name: 'replaceall',\n            text: 'Replace all',\n            disabled: true\n          }\n        ],\n        initialData: initialData,\n        onChange: function (api, details) {\n          if (details.name === 'findtext' && currentSearchState.get().count > 0) {\n            reset(api);\n          }\n        },\n        onAction: function (api, details) {\n          var data = api.getData();\n          switch (details.name) {\n          case 'find':\n            doFind(api);\n            break;\n          case 'replace':\n            if (!replace(editor, currentSearchState, data.replacetext)) {\n              reset(api);\n            } else {\n              updateButtonStates(api);\n            }\n            break;\n          case 'replaceall':\n            replace(editor, currentSearchState, data.replacetext, true, true);\n            reset(api);\n            break;\n          case 'prev':\n            prev(editor, currentSearchState);\n            updateButtonStates(api);\n            break;\n          case 'next':\n            next(editor, currentSearchState);\n            updateButtonStates(api);\n            break;\n          case 'matchcase':\n          case 'wholewords':\n          case 'inselection':\n            updateSearchState(api);\n            reset(api);\n            break;\n          }\n          focusButtonIfRequired(api, details.name);\n        },\n        onSubmit: function (api) {\n          doFind(api);\n          focusButtonIfRequired(api, 'find');\n        },\n        onClose: function () {\n          editor.focus();\n          done(editor, currentSearchState);\n          editor.undoManager.add();\n        }\n      };\n      dialogApi.set(editor.windowManager.open(spec, { inline: 'toolbar' }));\n    };\n\n    var register = function (editor, currentSearchState) {\n      editor.addCommand('SearchReplace', function () {\n        open(editor, currentSearchState);\n      });\n    };\n\n    var showDialog = function (editor, currentSearchState) {\n      return function () {\n        open(editor, currentSearchState);\n      };\n    };\n    var register$1 = function (editor, currentSearchState) {\n      editor.ui.registry.addMenuItem('searchreplace', {\n        text: 'Find and replace...',\n        shortcut: 'Meta+F',\n        onAction: showDialog(editor, currentSearchState),\n        icon: 'search'\n      });\n      editor.ui.registry.addButton('searchreplace', {\n        tooltip: 'Find and replace',\n        onAction: showDialog(editor, currentSearchState),\n        icon: 'search'\n      });\n      editor.shortcuts.add('Meta+F', '', showDialog(editor, currentSearchState));\n    };\n\n    function Plugin () {\n      global.add('searchreplace', function (editor) {\n        var currentSearchState = Cell({\n          index: -1,\n          count: 0,\n          text: '',\n          matchCase: false,\n          wholeWord: false,\n          inSelection: false\n        });\n        register(editor, currentSearchState);\n        register$1(editor, currentSearchState);\n        return get$1(editor, currentSearchState);\n      });\n    }\n\n    Plugin();\n\n}());\n"]},"metadata":{},"sourceType":"script"}