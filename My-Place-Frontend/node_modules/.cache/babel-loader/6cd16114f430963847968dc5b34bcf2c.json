{"ast":null,"code":"/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.8.2 (2021-06-23)\n */\n(function () {\n  'use strict';\n\n  var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n  var global$1 = tinymce.util.Tools.resolve('tinymce.util.VK');\n\n  var typeOf = function (x) {\n    var t = typeof x;\n\n    if (x === null) {\n      return 'null';\n    } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n      return 'array';\n    } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n      return 'string';\n    } else {\n      return t;\n    }\n  };\n\n  var isType = function (type) {\n    return function (value) {\n      return typeOf(value) === type;\n    };\n  };\n\n  var isSimpleType = function (type) {\n    return function (value) {\n      return typeof value === type;\n    };\n  };\n\n  var eq = function (t) {\n    return function (a) {\n      return t === a;\n    };\n  };\n\n  var isString = isType('string');\n  var isArray = isType('array');\n  var isNull = eq(null);\n  var isBoolean = isSimpleType('boolean');\n  var isFunction = isSimpleType('function');\n\n  var assumeExternalTargets = function (editor) {\n    var externalTargets = editor.getParam('link_assume_external_targets', false);\n\n    if (isBoolean(externalTargets) && externalTargets) {\n      return 1;\n    } else if (isString(externalTargets) && (externalTargets === 'http' || externalTargets === 'https')) {\n      return externalTargets;\n    }\n\n    return 0;\n  };\n\n  var hasContextToolbar = function (editor) {\n    return editor.getParam('link_context_toolbar', false, 'boolean');\n  };\n\n  var getLinkList = function (editor) {\n    return editor.getParam('link_list');\n  };\n\n  var getDefaultLinkTarget = function (editor) {\n    return editor.getParam('default_link_target');\n  };\n\n  var getTargetList = function (editor) {\n    return editor.getParam('target_list', true);\n  };\n\n  var getRelList = function (editor) {\n    return editor.getParam('rel_list', [], 'array');\n  };\n\n  var getLinkClassList = function (editor) {\n    return editor.getParam('link_class_list', [], 'array');\n  };\n\n  var shouldShowLinkTitle = function (editor) {\n    return editor.getParam('link_title', true, 'boolean');\n  };\n\n  var allowUnsafeLinkTarget = function (editor) {\n    return editor.getParam('allow_unsafe_link_target', false, 'boolean');\n  };\n\n  var useQuickLink = function (editor) {\n    return editor.getParam('link_quicklink', false, 'boolean');\n  };\n\n  var getDefaultLinkProtocol = function (editor) {\n    return editor.getParam('link_default_protocol', 'http', 'string');\n  };\n\n  var noop = function () {};\n\n  var constant = function (value) {\n    return function () {\n      return value;\n    };\n  };\n\n  var never = constant(false);\n  var always = constant(true);\n\n  var none = function () {\n    return NONE;\n  };\n\n  var NONE = function () {\n    var eq = function (o) {\n      return o.isNone();\n    };\n\n    var call = function (thunk) {\n      return thunk();\n    };\n\n    var id = function (n) {\n      return n;\n    };\n\n    var me = {\n      fold: function (n, _s) {\n        return n();\n      },\n      is: never,\n      isSome: never,\n      isNone: always,\n      getOr: id,\n      getOrThunk: call,\n      getOrDie: function (msg) {\n        throw new Error(msg || 'error: getOrDie called on none.');\n      },\n      getOrNull: constant(null),\n      getOrUndefined: constant(undefined),\n      or: id,\n      orThunk: call,\n      map: none,\n      each: noop,\n      bind: none,\n      exists: never,\n      forall: always,\n      filter: none,\n      equals: eq,\n      equals_: eq,\n      toArray: function () {\n        return [];\n      },\n      toString: constant('none()')\n    };\n    return me;\n  }();\n\n  var some = function (a) {\n    var constant_a = constant(a);\n\n    var self = function () {\n      return me;\n    };\n\n    var bind = function (f) {\n      return f(a);\n    };\n\n    var me = {\n      fold: function (n, s) {\n        return s(a);\n      },\n      is: function (v) {\n        return a === v;\n      },\n      isSome: always,\n      isNone: never,\n      getOr: constant_a,\n      getOrThunk: constant_a,\n      getOrDie: constant_a,\n      getOrNull: constant_a,\n      getOrUndefined: constant_a,\n      or: self,\n      orThunk: self,\n      map: function (f) {\n        return some(f(a));\n      },\n      each: function (f) {\n        f(a);\n      },\n      bind: bind,\n      exists: bind,\n      forall: bind,\n      filter: function (f) {\n        return f(a) ? me : NONE;\n      },\n      toArray: function () {\n        return [a];\n      },\n      toString: function () {\n        return 'some(' + a + ')';\n      },\n      equals: function (o) {\n        return o.is(a);\n      },\n      equals_: function (o, elementEq) {\n        return o.fold(never, function (b) {\n          return elementEq(a, b);\n        });\n      }\n    };\n    return me;\n  };\n\n  var from = function (value) {\n    return value === null || value === undefined ? NONE : some(value);\n  };\n\n  var Optional = {\n    some: some,\n    none: none,\n    from: from\n  };\n  var nativeIndexOf = Array.prototype.indexOf;\n  var nativePush = Array.prototype.push;\n\n  var rawIndexOf = function (ts, t) {\n    return nativeIndexOf.call(ts, t);\n  };\n\n  var contains = function (xs, x) {\n    return rawIndexOf(xs, x) > -1;\n  };\n\n  var map = function (xs, f) {\n    var len = xs.length;\n    var r = new Array(len);\n\n    for (var i = 0; i < len; i++) {\n      var x = xs[i];\n      r[i] = f(x, i);\n    }\n\n    return r;\n  };\n\n  var each = function (xs, f) {\n    for (var i = 0, len = xs.length; i < len; i++) {\n      var x = xs[i];\n      f(x, i);\n    }\n  };\n\n  var foldl = function (xs, f, acc) {\n    each(xs, function (x) {\n      acc = f(acc, x);\n    });\n    return acc;\n  };\n\n  var flatten = function (xs) {\n    var r = [];\n\n    for (var i = 0, len = xs.length; i < len; ++i) {\n      if (!isArray(xs[i])) {\n        throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n      }\n\n      nativePush.apply(r, xs[i]);\n    }\n\n    return r;\n  };\n\n  var bind = function (xs, f) {\n    return flatten(map(xs, f));\n  };\n\n  var findMap = function (arr, f) {\n    for (var i = 0; i < arr.length; i++) {\n      var r = f(arr[i], i);\n\n      if (r.isSome()) {\n        return r;\n      }\n    }\n\n    return Optional.none();\n  };\n\n  var cat = function (arr) {\n    var r = [];\n\n    var push = function (x) {\n      r.push(x);\n    };\n\n    for (var i = 0; i < arr.length; i++) {\n      arr[i].each(push);\n    }\n\n    return r;\n  };\n\n  var someIf = function (b, a) {\n    return b ? Optional.some(a) : Optional.none();\n  };\n\n  var global$2 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n  var getValue = function (item) {\n    return isString(item.value) ? item.value : '';\n  };\n\n  var getText = function (item) {\n    if (isString(item.text)) {\n      return item.text;\n    } else if (isString(item.title)) {\n      return item.title;\n    } else {\n      return '';\n    }\n  };\n\n  var sanitizeList = function (list, extractValue) {\n    var out = [];\n    global$2.each(list, function (item) {\n      var text = getText(item);\n\n      if (item.menu !== undefined) {\n        var items = sanitizeList(item.menu, extractValue);\n        out.push({\n          text: text,\n          items: items\n        });\n      } else {\n        var value = extractValue(item);\n        out.push({\n          text: text,\n          value: value\n        });\n      }\n    });\n    return out;\n  };\n\n  var sanitizeWith = function (extracter) {\n    if (extracter === void 0) {\n      extracter = getValue;\n    }\n\n    return function (list) {\n      return Optional.from(list).map(function (list) {\n        return sanitizeList(list, extracter);\n      });\n    };\n  };\n\n  var sanitize = function (list) {\n    return sanitizeWith(getValue)(list);\n  };\n\n  var createUi = function (name, label) {\n    return function (items) {\n      return {\n        name: name,\n        type: 'listbox',\n        label: label,\n        items: items\n      };\n    };\n  };\n\n  var ListOptions = {\n    sanitize: sanitize,\n    sanitizeWith: sanitizeWith,\n    createUi: createUi,\n    getValue: getValue\n  };\n\n  var __assign = function () {\n    __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n\n      return t;\n    };\n\n    return __assign.apply(this, arguments);\n  };\n\n  var keys = Object.keys;\n  var hasOwnProperty = Object.hasOwnProperty;\n\n  var each$1 = function (obj, f) {\n    var props = keys(obj);\n\n    for (var k = 0, len = props.length; k < len; k++) {\n      var i = props[k];\n      var x = obj[i];\n      f(x, i);\n    }\n  };\n\n  var objAcc = function (r) {\n    return function (x, i) {\n      r[i] = x;\n    };\n  };\n\n  var internalFilter = function (obj, pred, onTrue, onFalse) {\n    var r = {};\n    each$1(obj, function (x, i) {\n      (pred(x, i) ? onTrue : onFalse)(x, i);\n    });\n    return r;\n  };\n\n  var filter = function (obj, pred) {\n    var t = {};\n    internalFilter(obj, pred, objAcc(t), noop);\n    return t;\n  };\n\n  var has = function (obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n\n  var hasNonNullableKey = function (obj, key) {\n    return has(obj, key) && obj[key] !== undefined && obj[key] !== null;\n  };\n\n  var global$3 = tinymce.util.Tools.resolve('tinymce.dom.TreeWalker');\n\n  var isAnchor = function (elm) {\n    return elm && elm.nodeName.toLowerCase() === 'a';\n  };\n\n  var isLink = function (elm) {\n    return isAnchor(elm) && !!getHref(elm);\n  };\n\n  var collectNodesInRange = function (rng, predicate) {\n    if (rng.collapsed) {\n      return [];\n    } else {\n      var contents = rng.cloneContents();\n      var walker = new global$3(contents.firstChild, contents);\n      var elements = [];\n      var current = contents.firstChild;\n\n      do {\n        if (predicate(current)) {\n          elements.push(current);\n        }\n      } while (current = walker.next());\n\n      return elements;\n    }\n  };\n\n  var hasProtocol = function (url) {\n    return /^\\w+:/i.test(url);\n  };\n\n  var getHref = function (elm) {\n    var href = elm.getAttribute('data-mce-href');\n    return href ? href : elm.getAttribute('href');\n  };\n\n  var applyRelTargetRules = function (rel, isUnsafe) {\n    var rules = ['noopener'];\n    var rels = rel ? rel.split(/\\s+/) : [];\n\n    var toString = function (rels) {\n      return global$2.trim(rels.sort().join(' '));\n    };\n\n    var addTargetRules = function (rels) {\n      rels = removeTargetRules(rels);\n      return rels.length > 0 ? rels.concat(rules) : rules;\n    };\n\n    var removeTargetRules = function (rels) {\n      return rels.filter(function (val) {\n        return global$2.inArray(rules, val) === -1;\n      });\n    };\n\n    var newRels = isUnsafe ? addTargetRules(rels) : removeTargetRules(rels);\n    return newRels.length > 0 ? toString(newRels) : '';\n  };\n\n  var trimCaretContainers = function (text) {\n    return text.replace(/\\uFEFF/g, '');\n  };\n\n  var getAnchorElement = function (editor, selectedElm) {\n    selectedElm = selectedElm || editor.selection.getNode();\n\n    if (isImageFigure(selectedElm)) {\n      return editor.dom.select('a[href]', selectedElm)[0];\n    } else {\n      return editor.dom.getParent(selectedElm, 'a[href]');\n    }\n  };\n\n  var getAnchorText = function (selection, anchorElm) {\n    var text = anchorElm ? anchorElm.innerText || anchorElm.textContent : selection.getContent({\n      format: 'text'\n    });\n    return trimCaretContainers(text);\n  };\n\n  var hasLinks = function (elements) {\n    return global$2.grep(elements, isLink).length > 0;\n  };\n\n  var hasLinksInSelection = function (rng) {\n    return collectNodesInRange(rng, isLink).length > 0;\n  };\n\n  var isOnlyTextSelected = function (editor) {\n    var inlineTextElements = editor.schema.getTextInlineElements();\n\n    var isElement = function (elm) {\n      return elm.nodeType === 1 && !isAnchor(elm) && !has(inlineTextElements, elm.nodeName.toLowerCase());\n    };\n\n    var elements = collectNodesInRange(editor.selection.getRng(), isElement);\n    return elements.length === 0;\n  };\n\n  var isImageFigure = function (elm) {\n    return elm && elm.nodeName === 'FIGURE' && /\\bimage\\b/i.test(elm.className);\n  };\n\n  var getLinkAttrs = function (data) {\n    return foldl(['title', 'rel', 'class', 'target'], function (acc, key) {\n      data[key].each(function (value) {\n        acc[key] = value.length > 0 ? value : null;\n      });\n      return acc;\n    }, {\n      href: data.href\n    });\n  };\n\n  var handleExternalTargets = function (href, assumeExternalTargets) {\n    if ((assumeExternalTargets === 'http' || assumeExternalTargets === 'https') && !hasProtocol(href)) {\n      return assumeExternalTargets + '://' + href;\n    }\n\n    return href;\n  };\n\n  var applyLinkOverrides = function (editor, linkAttrs) {\n    var newLinkAttrs = __assign({}, linkAttrs);\n\n    if (!(getRelList(editor).length > 0) && allowUnsafeLinkTarget(editor) === false) {\n      var newRel = applyRelTargetRules(newLinkAttrs.rel, newLinkAttrs.target === '_blank');\n      newLinkAttrs.rel = newRel ? newRel : null;\n    }\n\n    if (Optional.from(newLinkAttrs.target).isNone() && getTargetList(editor) === false) {\n      newLinkAttrs.target = getDefaultLinkTarget(editor);\n    }\n\n    newLinkAttrs.href = handleExternalTargets(newLinkAttrs.href, assumeExternalTargets(editor));\n    return newLinkAttrs;\n  };\n\n  var updateLink = function (editor, anchorElm, text, linkAttrs) {\n    text.each(function (text) {\n      if (anchorElm.hasOwnProperty('innerText')) {\n        anchorElm.innerText = text;\n      } else {\n        anchorElm.textContent = text;\n      }\n    });\n    editor.dom.setAttribs(anchorElm, linkAttrs);\n    editor.selection.select(anchorElm);\n  };\n\n  var createLink = function (editor, selectedElm, text, linkAttrs) {\n    if (isImageFigure(selectedElm)) {\n      linkImageFigure(editor, selectedElm, linkAttrs);\n    } else {\n      text.fold(function () {\n        editor.execCommand('mceInsertLink', false, linkAttrs);\n      }, function (text) {\n        editor.insertContent(editor.dom.createHTML('a', linkAttrs, editor.dom.encode(text)));\n      });\n    }\n  };\n\n  var linkDomMutation = function (editor, attachState, data) {\n    var selectedElm = editor.selection.getNode();\n    var anchorElm = getAnchorElement(editor, selectedElm);\n    var linkAttrs = applyLinkOverrides(editor, getLinkAttrs(data));\n    editor.undoManager.transact(function () {\n      if (data.href === attachState.href) {\n        attachState.attach();\n      }\n\n      if (anchorElm) {\n        editor.focus();\n        updateLink(editor, anchorElm, data.text, linkAttrs);\n      } else {\n        createLink(editor, selectedElm, data.text, linkAttrs);\n      }\n    });\n  };\n\n  var unlinkSelection = function (editor) {\n    var dom = editor.dom,\n        selection = editor.selection;\n    var bookmark = selection.getBookmark();\n    var rng = selection.getRng().cloneRange();\n    var startAnchorElm = dom.getParent(rng.startContainer, 'a[href]', editor.getBody());\n    var endAnchorElm = dom.getParent(rng.endContainer, 'a[href]', editor.getBody());\n\n    if (startAnchorElm) {\n      rng.setStartBefore(startAnchorElm);\n    }\n\n    if (endAnchorElm) {\n      rng.setEndAfter(endAnchorElm);\n    }\n\n    selection.setRng(rng);\n    editor.execCommand('unlink');\n    selection.moveToBookmark(bookmark);\n  };\n\n  var unlinkDomMutation = function (editor) {\n    editor.undoManager.transact(function () {\n      var node = editor.selection.getNode();\n\n      if (isImageFigure(node)) {\n        unlinkImageFigure(editor, node);\n      } else {\n        unlinkSelection(editor);\n      }\n\n      editor.focus();\n    });\n  };\n\n  var unwrapOptions = function (data) {\n    var cls = data.class,\n        href = data.href,\n        rel = data.rel,\n        target = data.target,\n        text = data.text,\n        title = data.title;\n    return filter({\n      class: cls.getOrNull(),\n      href: href,\n      rel: rel.getOrNull(),\n      target: target.getOrNull(),\n      text: text.getOrNull(),\n      title: title.getOrNull()\n    }, function (v, _k) {\n      return isNull(v) === false;\n    });\n  };\n\n  var link = function (editor, attachState, data) {\n    editor.hasPlugin('rtc', true) ? editor.execCommand('createlink', false, unwrapOptions(data)) : linkDomMutation(editor, attachState, data);\n  };\n\n  var unlink = function (editor) {\n    editor.hasPlugin('rtc', true) ? editor.execCommand('unlink') : unlinkDomMutation(editor);\n  };\n\n  var unlinkImageFigure = function (editor, fig) {\n    var img = editor.dom.select('img', fig)[0];\n\n    if (img) {\n      var a = editor.dom.getParents(img, 'a[href]', fig)[0];\n\n      if (a) {\n        a.parentNode.insertBefore(img, a);\n        editor.dom.remove(a);\n      }\n    }\n  };\n\n  var linkImageFigure = function (editor, fig, attrs) {\n    var img = editor.dom.select('img', fig)[0];\n\n    if (img) {\n      var a = editor.dom.create('a', attrs);\n      img.parentNode.insertBefore(a, img);\n      a.appendChild(img);\n    }\n  };\n\n  var isListGroup = function (item) {\n    return hasNonNullableKey(item, 'items');\n  };\n\n  var findTextByValue = function (value, catalog) {\n    return findMap(catalog, function (item) {\n      if (isListGroup(item)) {\n        return findTextByValue(value, item.items);\n      } else {\n        return someIf(item.value === value, item);\n      }\n    });\n  };\n\n  var getDelta = function (persistentText, fieldName, catalog, data) {\n    var value = data[fieldName];\n    var hasPersistentText = persistentText.length > 0;\n    return value !== undefined ? findTextByValue(value, catalog).map(function (i) {\n      return {\n        url: {\n          value: i.value,\n          meta: {\n            text: hasPersistentText ? persistentText : i.text,\n            attach: noop\n          }\n        },\n        text: hasPersistentText ? persistentText : i.text\n      };\n    }) : Optional.none();\n  };\n\n  var findCatalog = function (catalogs, fieldName) {\n    if (fieldName === 'link') {\n      return catalogs.link;\n    } else if (fieldName === 'anchor') {\n      return catalogs.anchor;\n    } else {\n      return Optional.none();\n    }\n  };\n\n  var init = function (initialData, linkCatalog) {\n    var persistentData = {\n      text: initialData.text,\n      title: initialData.title\n    };\n\n    var getTitleFromUrlChange = function (url) {\n      return someIf(persistentData.title.length <= 0, Optional.from(url.meta.title).getOr(''));\n    };\n\n    var getTextFromUrlChange = function (url) {\n      return someIf(persistentData.text.length <= 0, Optional.from(url.meta.text).getOr(url.value));\n    };\n\n    var onUrlChange = function (data) {\n      var text = getTextFromUrlChange(data.url);\n      var title = getTitleFromUrlChange(data.url);\n\n      if (text.isSome() || title.isSome()) {\n        return Optional.some(__assign(__assign({}, text.map(function (text) {\n          return {\n            text: text\n          };\n        }).getOr({})), title.map(function (title) {\n          return {\n            title: title\n          };\n        }).getOr({})));\n      } else {\n        return Optional.none();\n      }\n    };\n\n    var onCatalogChange = function (data, change) {\n      var catalog = findCatalog(linkCatalog, change.name).getOr([]);\n      return getDelta(persistentData.text, change.name, catalog, data);\n    };\n\n    var onChange = function (getData, change) {\n      var name = change.name;\n\n      if (name === 'url') {\n        return onUrlChange(getData());\n      } else if (contains(['anchor', 'link'], name)) {\n        return onCatalogChange(getData(), change);\n      } else if (name === 'text' || name === 'title') {\n        persistentData[name] = getData()[name];\n        return Optional.none();\n      } else {\n        return Optional.none();\n      }\n    };\n\n    return {\n      onChange: onChange\n    };\n  };\n\n  var DialogChanges = {\n    init: init,\n    getDelta: getDelta\n  };\n  var global$4 = tinymce.util.Tools.resolve('tinymce.util.Delay');\n  var global$5 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n\n  var delayedConfirm = function (editor, message, callback) {\n    var rng = editor.selection.getRng();\n    global$4.setEditorTimeout(editor, function () {\n      editor.windowManager.confirm(message, function (state) {\n        editor.selection.setRng(rng);\n        callback(state);\n      });\n    });\n  };\n\n  var tryEmailTransform = function (data) {\n    var url = data.href;\n    var suggestMailTo = url.indexOf('@') > 0 && url.indexOf('/') === -1 && url.indexOf('mailto:') === -1;\n    return suggestMailTo ? Optional.some({\n      message: 'The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?',\n      preprocess: function (oldData) {\n        return __assign(__assign({}, oldData), {\n          href: 'mailto:' + url\n        });\n      }\n    }) : Optional.none();\n  };\n\n  var tryProtocolTransform = function (assumeExternalTargets, defaultLinkProtocol) {\n    return function (data) {\n      var url = data.href;\n      var suggestProtocol = assumeExternalTargets === 1 && !hasProtocol(url) || assumeExternalTargets === 0 && /^\\s*www(\\.|\\d\\.)/i.test(url);\n      return suggestProtocol ? Optional.some({\n        message: 'The URL you entered seems to be an external link. Do you want to add the required ' + defaultLinkProtocol + ':// prefix?',\n        preprocess: function (oldData) {\n          return __assign(__assign({}, oldData), {\n            href: defaultLinkProtocol + '://' + url\n          });\n        }\n      }) : Optional.none();\n    };\n  };\n\n  var preprocess = function (editor, data) {\n    return findMap([tryEmailTransform, tryProtocolTransform(assumeExternalTargets(editor), getDefaultLinkProtocol(editor))], function (f) {\n      return f(data);\n    }).fold(function () {\n      return global$5.resolve(data);\n    }, function (transform) {\n      return new global$5(function (callback) {\n        delayedConfirm(editor, transform.message, function (state) {\n          callback(state ? transform.preprocess(data) : data);\n        });\n      });\n    });\n  };\n\n  var DialogConfirms = {\n    preprocess: preprocess\n  };\n\n  var getAnchors = function (editor) {\n    var anchorNodes = editor.dom.select('a:not([href])');\n    var anchors = bind(anchorNodes, function (anchor) {\n      var id = anchor.name || anchor.id;\n      return id ? [{\n        text: id,\n        value: '#' + id\n      }] : [];\n    });\n    return anchors.length > 0 ? Optional.some([{\n      text: 'None',\n      value: ''\n    }].concat(anchors)) : Optional.none();\n  };\n\n  var AnchorListOptions = {\n    getAnchors: getAnchors\n  };\n\n  var getClasses = function (editor) {\n    var list = getLinkClassList(editor);\n\n    if (list.length > 0) {\n      return ListOptions.sanitize(list);\n    }\n\n    return Optional.none();\n  };\n\n  var ClassListOptions = {\n    getClasses: getClasses\n  };\n  var global$6 = tinymce.util.Tools.resolve('tinymce.util.XHR');\n\n  var parseJson = function (text) {\n    try {\n      return Optional.some(JSON.parse(text));\n    } catch (err) {\n      return Optional.none();\n    }\n  };\n\n  var getLinks = function (editor) {\n    var extractor = function (item) {\n      return editor.convertURL(item.value || item.url, 'href');\n    };\n\n    var linkList = getLinkList(editor);\n    return new global$5(function (callback) {\n      if (isString(linkList)) {\n        global$6.send({\n          url: linkList,\n          success: function (text) {\n            return callback(parseJson(text));\n          },\n          error: function (_) {\n            return callback(Optional.none());\n          }\n        });\n      } else if (isFunction(linkList)) {\n        linkList(function (output) {\n          return callback(Optional.some(output));\n        });\n      } else {\n        callback(Optional.from(linkList));\n      }\n    }).then(function (optItems) {\n      return optItems.bind(ListOptions.sanitizeWith(extractor)).map(function (items) {\n        if (items.length > 0) {\n          var noneItem = [{\n            text: 'None',\n            value: ''\n          }];\n          return noneItem.concat(items);\n        } else {\n          return items;\n        }\n      });\n    });\n  };\n\n  var LinkListOptions = {\n    getLinks: getLinks\n  };\n\n  var getRels = function (editor, initialTarget) {\n    var list = getRelList(editor);\n\n    if (list.length > 0) {\n      var isTargetBlank_1 = initialTarget.is('_blank');\n      var enforceSafe = allowUnsafeLinkTarget(editor) === false;\n\n      var safeRelExtractor = function (item) {\n        return applyRelTargetRules(ListOptions.getValue(item), isTargetBlank_1);\n      };\n\n      var sanitizer = enforceSafe ? ListOptions.sanitizeWith(safeRelExtractor) : ListOptions.sanitize;\n      return sanitizer(list);\n    }\n\n    return Optional.none();\n  };\n\n  var RelOptions = {\n    getRels: getRels\n  };\n  var fallbacks = [{\n    text: 'Current window',\n    value: ''\n  }, {\n    text: 'New window',\n    value: '_blank'\n  }];\n\n  var getTargets = function (editor) {\n    var list = getTargetList(editor);\n\n    if (isArray(list)) {\n      return ListOptions.sanitize(list).orThunk(function () {\n        return Optional.some(fallbacks);\n      });\n    } else if (list === false) {\n      return Optional.none();\n    }\n\n    return Optional.some(fallbacks);\n  };\n\n  var TargetOptions = {\n    getTargets: getTargets\n  };\n\n  var nonEmptyAttr = function (dom, elem, name) {\n    var val = dom.getAttrib(elem, name);\n    return val !== null && val.length > 0 ? Optional.some(val) : Optional.none();\n  };\n\n  var extractFromAnchor = function (editor, anchor) {\n    var dom = editor.dom;\n    var onlyText = isOnlyTextSelected(editor);\n    var text = onlyText ? Optional.some(getAnchorText(editor.selection, anchor)) : Optional.none();\n    var url = anchor ? Optional.some(dom.getAttrib(anchor, 'href')) : Optional.none();\n    var target = anchor ? Optional.from(dom.getAttrib(anchor, 'target')) : Optional.none();\n    var rel = nonEmptyAttr(dom, anchor, 'rel');\n    var linkClass = nonEmptyAttr(dom, anchor, 'class');\n    var title = nonEmptyAttr(dom, anchor, 'title');\n    return {\n      url: url,\n      text: text,\n      title: title,\n      target: target,\n      rel: rel,\n      linkClass: linkClass\n    };\n  };\n\n  var collect = function (editor, linkNode) {\n    return LinkListOptions.getLinks(editor).then(function (links) {\n      var anchor = extractFromAnchor(editor, linkNode);\n      return {\n        anchor: anchor,\n        catalogs: {\n          targets: TargetOptions.getTargets(editor),\n          rels: RelOptions.getRels(editor, anchor.target),\n          classes: ClassListOptions.getClasses(editor),\n          anchor: AnchorListOptions.getAnchors(editor),\n          link: links\n        },\n        optNode: Optional.from(linkNode),\n        flags: {\n          titleEnabled: shouldShowLinkTitle(editor)\n        }\n      };\n    });\n  };\n\n  var DialogInfo = {\n    collect: collect\n  };\n\n  var handleSubmit = function (editor, info) {\n    return function (api) {\n      var data = api.getData();\n\n      if (!data.url.value) {\n        unlink(editor);\n        api.close();\n        return;\n      }\n\n      var getChangedValue = function (key) {\n        return Optional.from(data[key]).filter(function (value) {\n          return !info.anchor[key].is(value);\n        });\n      };\n\n      var changedData = {\n        href: data.url.value,\n        text: getChangedValue('text'),\n        target: getChangedValue('target'),\n        rel: getChangedValue('rel'),\n        class: getChangedValue('linkClass'),\n        title: getChangedValue('title')\n      };\n      var attachState = {\n        href: data.url.value,\n        attach: data.url.meta !== undefined && data.url.meta.attach ? data.url.meta.attach : noop\n      };\n      DialogConfirms.preprocess(editor, changedData).then(function (pData) {\n        link(editor, attachState, pData);\n      });\n      api.close();\n    };\n  };\n\n  var collectData = function (editor) {\n    var anchorNode = getAnchorElement(editor);\n    return DialogInfo.collect(editor, anchorNode);\n  };\n\n  var getInitialData = function (info, defaultTarget) {\n    var anchor = info.anchor;\n    var url = anchor.url.getOr('');\n    return {\n      url: {\n        value: url,\n        meta: {\n          original: {\n            value: url\n          }\n        }\n      },\n      text: anchor.text.getOr(''),\n      title: anchor.title.getOr(''),\n      anchor: url,\n      link: url,\n      rel: anchor.rel.getOr(''),\n      target: anchor.target.or(defaultTarget).getOr(''),\n      linkClass: anchor.linkClass.getOr('')\n    };\n  };\n\n  var makeDialog = function (settings, onSubmit, editor) {\n    var urlInput = [{\n      name: 'url',\n      type: 'urlinput',\n      filetype: 'file',\n      label: 'URL'\n    }];\n    var displayText = settings.anchor.text.map(function () {\n      return {\n        name: 'text',\n        type: 'input',\n        label: 'Text to display'\n      };\n    }).toArray();\n    var titleText = settings.flags.titleEnabled ? [{\n      name: 'title',\n      type: 'input',\n      label: 'Title'\n    }] : [];\n    var defaultTarget = Optional.from(getDefaultLinkTarget(editor));\n    var initialData = getInitialData(settings, defaultTarget);\n    var catalogs = settings.catalogs;\n    var dialogDelta = DialogChanges.init(initialData, catalogs);\n    var body = {\n      type: 'panel',\n      items: flatten([urlInput, displayText, titleText, cat([catalogs.anchor.map(ListOptions.createUi('anchor', 'Anchors')), catalogs.rels.map(ListOptions.createUi('rel', 'Rel')), catalogs.targets.map(ListOptions.createUi('target', 'Open link in...')), catalogs.link.map(ListOptions.createUi('link', 'Link list')), catalogs.classes.map(ListOptions.createUi('linkClass', 'Class'))])])\n    };\n    return {\n      title: 'Insert/Edit Link',\n      size: 'normal',\n      body: body,\n      buttons: [{\n        type: 'cancel',\n        name: 'cancel',\n        text: 'Cancel'\n      }, {\n        type: 'submit',\n        name: 'save',\n        text: 'Save',\n        primary: true\n      }],\n      initialData: initialData,\n      onChange: function (api, _a) {\n        var name = _a.name;\n        dialogDelta.onChange(api.getData, {\n          name: name\n        }).each(function (newData) {\n          api.setData(newData);\n        });\n      },\n      onSubmit: onSubmit\n    };\n  };\n\n  var open = function (editor) {\n    var data = collectData(editor);\n    data.then(function (info) {\n      var onSubmit = handleSubmit(editor, info);\n      return makeDialog(info, onSubmit, editor);\n    }).then(function (spec) {\n      editor.windowManager.open(spec);\n    });\n  };\n\n  var appendClickRemove = function (link, evt) {\n    document.body.appendChild(link);\n    link.dispatchEvent(evt);\n    document.body.removeChild(link);\n  };\n\n  var open$1 = function (url) {\n    var link = document.createElement('a');\n    link.target = '_blank';\n    link.href = url;\n    link.rel = 'noreferrer noopener';\n    var evt = document.createEvent('MouseEvents');\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n    appendClickRemove(link, evt);\n  };\n\n  var getLink = function (editor, elm) {\n    return editor.dom.getParent(elm, 'a[href]');\n  };\n\n  var getSelectedLink = function (editor) {\n    return getLink(editor, editor.selection.getStart());\n  };\n\n  var hasOnlyAltModifier = function (e) {\n    return e.altKey === true && e.shiftKey === false && e.ctrlKey === false && e.metaKey === false;\n  };\n\n  var gotoLink = function (editor, a) {\n    if (a) {\n      var href = getHref(a);\n\n      if (/^#/.test(href)) {\n        var targetEl = editor.$(href);\n\n        if (targetEl.length) {\n          editor.selection.scrollIntoView(targetEl[0], true);\n        }\n      } else {\n        open$1(a.href);\n      }\n    }\n  };\n\n  var openDialog = function (editor) {\n    return function () {\n      open(editor);\n    };\n  };\n\n  var gotoSelectedLink = function (editor) {\n    return function () {\n      gotoLink(editor, getSelectedLink(editor));\n    };\n  };\n\n  var setupGotoLinks = function (editor) {\n    editor.on('click', function (e) {\n      var link = getLink(editor, e.target);\n\n      if (link && global$1.metaKeyPressed(e)) {\n        e.preventDefault();\n        gotoLink(editor, link);\n      }\n    });\n    editor.on('keydown', function (e) {\n      var link = getSelectedLink(editor);\n\n      if (link && e.keyCode === 13 && hasOnlyAltModifier(e)) {\n        e.preventDefault();\n        gotoLink(editor, link);\n      }\n    });\n  };\n\n  var toggleState = function (editor, toggler) {\n    editor.on('NodeChange', toggler);\n    return function () {\n      return editor.off('NodeChange', toggler);\n    };\n  };\n\n  var toggleActiveState = function (editor) {\n    return function (api) {\n      return toggleState(editor, function () {\n        api.setActive(!editor.mode.isReadOnly() && getAnchorElement(editor, editor.selection.getNode()) !== null);\n      });\n    };\n  };\n\n  var toggleEnabledState = function (editor) {\n    return function (api) {\n      var updateState = function () {\n        return api.setDisabled(getAnchorElement(editor, editor.selection.getNode()) === null);\n      };\n\n      updateState();\n      return toggleState(editor, updateState);\n    };\n  };\n\n  var toggleUnlinkState = function (editor) {\n    return function (api) {\n      var hasLinks$1 = function (parents) {\n        return hasLinks(parents) || hasLinksInSelection(editor.selection.getRng());\n      };\n\n      var parents = editor.dom.getParents(editor.selection.getStart());\n      api.setDisabled(!hasLinks$1(parents));\n      return toggleState(editor, function (e) {\n        return api.setDisabled(!hasLinks$1(e.parents));\n      });\n    };\n  };\n\n  var register = function (editor) {\n    editor.addCommand('mceLink', function () {\n      if (useQuickLink(editor)) {\n        editor.fire('contexttoolbar-show', {\n          toolbarKey: 'quicklink'\n        });\n      } else {\n        openDialog(editor)();\n      }\n    });\n  };\n\n  var setup = function (editor) {\n    editor.addShortcut('Meta+K', '', function () {\n      editor.execCommand('mceLink');\n    });\n  };\n\n  var setupButtons = function (editor) {\n    editor.ui.registry.addToggleButton('link', {\n      icon: 'link',\n      tooltip: 'Insert/edit link',\n      onAction: openDialog(editor),\n      onSetup: toggleActiveState(editor)\n    });\n    editor.ui.registry.addButton('openlink', {\n      icon: 'new-tab',\n      tooltip: 'Open link',\n      onAction: gotoSelectedLink(editor),\n      onSetup: toggleEnabledState(editor)\n    });\n    editor.ui.registry.addButton('unlink', {\n      icon: 'unlink',\n      tooltip: 'Remove link',\n      onAction: function () {\n        return unlink(editor);\n      },\n      onSetup: toggleUnlinkState(editor)\n    });\n  };\n\n  var setupMenuItems = function (editor) {\n    editor.ui.registry.addMenuItem('openlink', {\n      text: 'Open link',\n      icon: 'new-tab',\n      onAction: gotoSelectedLink(editor),\n      onSetup: toggleEnabledState(editor)\n    });\n    editor.ui.registry.addMenuItem('link', {\n      icon: 'link',\n      text: 'Link...',\n      shortcut: 'Meta+K',\n      onAction: openDialog(editor)\n    });\n    editor.ui.registry.addMenuItem('unlink', {\n      icon: 'unlink',\n      text: 'Remove link',\n      onAction: function () {\n        return unlink(editor);\n      },\n      onSetup: toggleUnlinkState(editor)\n    });\n  };\n\n  var setupContextMenu = function (editor) {\n    var inLink = 'link unlink openlink';\n    var noLink = 'link';\n    editor.ui.registry.addContextMenu('link', {\n      update: function (element) {\n        return hasLinks(editor.dom.getParents(element, 'a')) ? inLink : noLink;\n      }\n    });\n  };\n\n  var setupContextToolbars = function (editor) {\n    var collapseSelectionToEnd = function (editor) {\n      editor.selection.collapse(false);\n    };\n\n    var onSetupLink = function (buttonApi) {\n      var node = editor.selection.getNode();\n      buttonApi.setDisabled(!getAnchorElement(editor, node));\n      return noop;\n    };\n\n    editor.ui.registry.addContextForm('quicklink', {\n      launch: {\n        type: 'contextformtogglebutton',\n        icon: 'link',\n        tooltip: 'Link',\n        onSetup: toggleActiveState(editor)\n      },\n      label: 'Link',\n      predicate: function (node) {\n        return !!getAnchorElement(editor, node) && hasContextToolbar(editor);\n      },\n      initValue: function () {\n        var elm = getAnchorElement(editor);\n        return !!elm ? getHref(elm) : '';\n      },\n      commands: [{\n        type: 'contextformtogglebutton',\n        icon: 'link',\n        tooltip: 'Link',\n        primary: true,\n        onSetup: function (buttonApi) {\n          var node = editor.selection.getNode();\n          buttonApi.setActive(!!getAnchorElement(editor, node));\n          return toggleActiveState(editor)(buttonApi);\n        },\n        onAction: function (formApi) {\n          var anchor = getAnchorElement(editor);\n          var value = formApi.getValue();\n\n          if (!anchor) {\n            var attachState = {\n              href: value,\n              attach: noop\n            };\n            var onlyText = isOnlyTextSelected(editor);\n            var text = onlyText ? Optional.some(getAnchorText(editor.selection, anchor)).filter(function (t) {\n              return t.length > 0;\n            }).or(Optional.from(value)) : Optional.none();\n            link(editor, attachState, {\n              href: value,\n              text: text,\n              title: Optional.none(),\n              rel: Optional.none(),\n              target: Optional.none(),\n              class: Optional.none()\n            });\n            formApi.hide();\n          } else {\n            editor.undoManager.transact(function () {\n              editor.dom.setAttrib(anchor, 'href', value);\n              collapseSelectionToEnd(editor);\n              formApi.hide();\n            });\n          }\n        }\n      }, {\n        type: 'contextformbutton',\n        icon: 'unlink',\n        tooltip: 'Remove link',\n        onSetup: onSetupLink,\n        onAction: function (formApi) {\n          unlink(editor);\n          formApi.hide();\n        }\n      }, {\n        type: 'contextformbutton',\n        icon: 'new-tab',\n        tooltip: 'Open link',\n        onSetup: onSetupLink,\n        onAction: function (formApi) {\n          gotoSelectedLink(editor)();\n          formApi.hide();\n        }\n      }]\n    });\n  };\n\n  function Plugin() {\n    global.add('link', function (editor) {\n      setupButtons(editor);\n      setupMenuItems(editor);\n      setupContextMenu(editor);\n      setupContextToolbars(editor);\n      setupGotoLinks(editor);\n      register(editor);\n      setup(editor);\n    });\n  }\n\n  Plugin();\n})();","map":{"version":3,"sources":["/home/lin/phase5/My-Place-Frontend/my-place/node_modules/tinymce/plugins/link/plugin.js"],"names":["global","tinymce","util","Tools","resolve","global$1","typeOf","x","t","Array","prototype","isPrototypeOf","constructor","name","String","isType","type","value","isSimpleType","eq","a","isString","isArray","isNull","isBoolean","isFunction","assumeExternalTargets","editor","externalTargets","getParam","hasContextToolbar","getLinkList","getDefaultLinkTarget","getTargetList","getRelList","getLinkClassList","shouldShowLinkTitle","allowUnsafeLinkTarget","useQuickLink","getDefaultLinkProtocol","noop","constant","never","always","none","NONE","o","isNone","call","thunk","id","n","me","fold","_s","is","isSome","getOr","getOrThunk","getOrDie","msg","Error","getOrNull","getOrUndefined","undefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","some","constant_a","self","f","s","v","elementEq","b","from","Optional","nativeIndexOf","indexOf","nativePush","push","rawIndexOf","ts","contains","xs","len","length","r","i","foldl","acc","flatten","apply","findMap","arr","cat","someIf","global$2","getValue","item","getText","text","title","sanitizeList","list","extractValue","out","menu","items","sanitizeWith","extracter","sanitize","createUi","label","ListOptions","__assign","Object","assign","arguments","p","hasOwnProperty","keys","each$1","obj","props","k","objAcc","internalFilter","pred","onTrue","onFalse","has","key","hasNonNullableKey","global$3","isAnchor","elm","nodeName","toLowerCase","isLink","getHref","collectNodesInRange","rng","predicate","collapsed","contents","cloneContents","walker","firstChild","elements","current","next","hasProtocol","url","test","href","getAttribute","applyRelTargetRules","rel","isUnsafe","rules","rels","split","trim","sort","join","addTargetRules","removeTargetRules","concat","val","inArray","newRels","trimCaretContainers","replace","getAnchorElement","selectedElm","selection","getNode","isImageFigure","dom","select","getParent","getAnchorText","anchorElm","innerText","textContent","getContent","format","hasLinks","grep","hasLinksInSelection","isOnlyTextSelected","inlineTextElements","schema","getTextInlineElements","isElement","nodeType","getRng","className","getLinkAttrs","data","handleExternalTargets","applyLinkOverrides","linkAttrs","newLinkAttrs","newRel","target","updateLink","setAttribs","createLink","linkImageFigure","execCommand","insertContent","createHTML","encode","linkDomMutation","attachState","undoManager","transact","attach","focus","unlinkSelection","bookmark","getBookmark","cloneRange","startAnchorElm","startContainer","getBody","endAnchorElm","endContainer","setStartBefore","setEndAfter","setRng","moveToBookmark","unlinkDomMutation","node","unlinkImageFigure","unwrapOptions","cls","class","_k","link","hasPlugin","unlink","fig","img","getParents","parentNode","insertBefore","remove","attrs","create","appendChild","isListGroup","findTextByValue","catalog","getDelta","persistentText","fieldName","hasPersistentText","meta","findCatalog","catalogs","anchor","init","initialData","linkCatalog","persistentData","getTitleFromUrlChange","getTextFromUrlChange","onUrlChange","onCatalogChange","change","onChange","getData","DialogChanges","global$4","global$5","delayedConfirm","message","callback","setEditorTimeout","windowManager","confirm","state","tryEmailTransform","suggestMailTo","preprocess","oldData","tryProtocolTransform","defaultLinkProtocol","suggestProtocol","transform","DialogConfirms","getAnchors","anchorNodes","anchors","AnchorListOptions","getClasses","ClassListOptions","global$6","parseJson","JSON","parse","err","getLinks","extractor","convertURL","linkList","send","success","error","_","output","then","optItems","noneItem","LinkListOptions","getRels","initialTarget","isTargetBlank_1","enforceSafe","safeRelExtractor","sanitizer","RelOptions","fallbacks","getTargets","TargetOptions","nonEmptyAttr","elem","getAttrib","extractFromAnchor","onlyText","linkClass","collect","linkNode","links","targets","classes","optNode","flags","titleEnabled","DialogInfo","handleSubmit","info","api","close","getChangedValue","changedData","pData","collectData","anchorNode","getInitialData","defaultTarget","original","makeDialog","settings","onSubmit","urlInput","filetype","displayText","titleText","dialogDelta","body","size","buttons","primary","_a","newData","setData","open","spec","appendClickRemove","evt","document","dispatchEvent","removeChild","open$1","createElement","createEvent","initMouseEvent","window","getLink","getSelectedLink","getStart","hasOnlyAltModifier","e","altKey","shiftKey","ctrlKey","metaKey","gotoLink","targetEl","$","scrollIntoView","openDialog","gotoSelectedLink","setupGotoLinks","on","metaKeyPressed","preventDefault","keyCode","toggleState","toggler","off","toggleActiveState","setActive","mode","isReadOnly","toggleEnabledState","updateState","setDisabled","toggleUnlinkState","hasLinks$1","parents","register","addCommand","fire","toolbarKey","setup","addShortcut","setupButtons","ui","registry","addToggleButton","icon","tooltip","onAction","onSetup","addButton","setupMenuItems","addMenuItem","shortcut","setupContextMenu","inLink","noLink","addContextMenu","update","element","setupContextToolbars","collapseSelectionToEnd","collapse","onSetupLink","buttonApi","addContextForm","launch","initValue","commands","formApi","hide","setAttrib","Plugin","add"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.8.2 (2021-06-23)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.VK');\n\n    var typeOf = function (x) {\n      var t = typeof x;\n      if (x === null) {\n        return 'null';\n      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      } else {\n        return t;\n      }\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isSimpleType = function (type) {\n      return function (value) {\n        return typeof value === type;\n      };\n    };\n    var eq = function (t) {\n      return function (a) {\n        return t === a;\n      };\n    };\n    var isString = isType('string');\n    var isArray = isType('array');\n    var isNull = eq(null);\n    var isBoolean = isSimpleType('boolean');\n    var isFunction = isSimpleType('function');\n\n    var assumeExternalTargets = function (editor) {\n      var externalTargets = editor.getParam('link_assume_external_targets', false);\n      if (isBoolean(externalTargets) && externalTargets) {\n        return 1;\n      } else if (isString(externalTargets) && (externalTargets === 'http' || externalTargets === 'https')) {\n        return externalTargets;\n      }\n      return 0;\n    };\n    var hasContextToolbar = function (editor) {\n      return editor.getParam('link_context_toolbar', false, 'boolean');\n    };\n    var getLinkList = function (editor) {\n      return editor.getParam('link_list');\n    };\n    var getDefaultLinkTarget = function (editor) {\n      return editor.getParam('default_link_target');\n    };\n    var getTargetList = function (editor) {\n      return editor.getParam('target_list', true);\n    };\n    var getRelList = function (editor) {\n      return editor.getParam('rel_list', [], 'array');\n    };\n    var getLinkClassList = function (editor) {\n      return editor.getParam('link_class_list', [], 'array');\n    };\n    var shouldShowLinkTitle = function (editor) {\n      return editor.getParam('link_title', true, 'boolean');\n    };\n    var allowUnsafeLinkTarget = function (editor) {\n      return editor.getParam('allow_unsafe_link_target', false, 'boolean');\n    };\n    var useQuickLink = function (editor) {\n      return editor.getParam('link_quicklink', false, 'boolean');\n    };\n    var getDefaultLinkProtocol = function (editor) {\n      return editor.getParam('link_default_protocol', 'http', 'string');\n    };\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, _s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Optional = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var nativeIndexOf = Array.prototype.indexOf;\n    var nativePush = Array.prototype.push;\n    var rawIndexOf = function (ts, t) {\n      return nativeIndexOf.call(ts, t);\n    };\n    var contains = function (xs, x) {\n      return rawIndexOf(xs, x) > -1;\n    };\n    var map = function (xs, f) {\n      var len = xs.length;\n      var r = new Array(len);\n      for (var i = 0; i < len; i++) {\n        var x = xs[i];\n        r[i] = f(x, i);\n      }\n      return r;\n    };\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var foldl = function (xs, f, acc) {\n      each(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n    var bind = function (xs, f) {\n      return flatten(map(xs, f));\n    };\n    var findMap = function (arr, f) {\n      for (var i = 0; i < arr.length; i++) {\n        var r = f(arr[i], i);\n        if (r.isSome()) {\n          return r;\n        }\n      }\n      return Optional.none();\n    };\n\n    var cat = function (arr) {\n      var r = [];\n      var push = function (x) {\n        r.push(x);\n      };\n      for (var i = 0; i < arr.length; i++) {\n        arr[i].each(push);\n      }\n      return r;\n    };\n    var someIf = function (b, a) {\n      return b ? Optional.some(a) : Optional.none();\n    };\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var getValue = function (item) {\n      return isString(item.value) ? item.value : '';\n    };\n    var getText = function (item) {\n      if (isString(item.text)) {\n        return item.text;\n      } else if (isString(item.title)) {\n        return item.title;\n      } else {\n        return '';\n      }\n    };\n    var sanitizeList = function (list, extractValue) {\n      var out = [];\n      global$2.each(list, function (item) {\n        var text = getText(item);\n        if (item.menu !== undefined) {\n          var items = sanitizeList(item.menu, extractValue);\n          out.push({\n            text: text,\n            items: items\n          });\n        } else {\n          var value = extractValue(item);\n          out.push({\n            text: text,\n            value: value\n          });\n        }\n      });\n      return out;\n    };\n    var sanitizeWith = function (extracter) {\n      if (extracter === void 0) {\n        extracter = getValue;\n      }\n      return function (list) {\n        return Optional.from(list).map(function (list) {\n          return sanitizeList(list, extracter);\n        });\n      };\n    };\n    var sanitize = function (list) {\n      return sanitizeWith(getValue)(list);\n    };\n    var createUi = function (name, label) {\n      return function (items) {\n        return {\n          name: name,\n          type: 'listbox',\n          label: label,\n          items: items\n        };\n      };\n    };\n    var ListOptions = {\n      sanitize: sanitize,\n      sanitizeWith: sanitizeWith,\n      createUi: createUi,\n      getValue: getValue\n    };\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n\n    var keys = Object.keys;\n    var hasOwnProperty = Object.hasOwnProperty;\n    var each$1 = function (obj, f) {\n      var props = keys(obj);\n      for (var k = 0, len = props.length; k < len; k++) {\n        var i = props[k];\n        var x = obj[i];\n        f(x, i);\n      }\n    };\n    var objAcc = function (r) {\n      return function (x, i) {\n        r[i] = x;\n      };\n    };\n    var internalFilter = function (obj, pred, onTrue, onFalse) {\n      var r = {};\n      each$1(obj, function (x, i) {\n        (pred(x, i) ? onTrue : onFalse)(x, i);\n      });\n      return r;\n    };\n    var filter = function (obj, pred) {\n      var t = {};\n      internalFilter(obj, pred, objAcc(t), noop);\n      return t;\n    };\n    var has = function (obj, key) {\n      return hasOwnProperty.call(obj, key);\n    };\n    var hasNonNullableKey = function (obj, key) {\n      return has(obj, key) && obj[key] !== undefined && obj[key] !== null;\n    };\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.dom.TreeWalker');\n\n    var isAnchor = function (elm) {\n      return elm && elm.nodeName.toLowerCase() === 'a';\n    };\n    var isLink = function (elm) {\n      return isAnchor(elm) && !!getHref(elm);\n    };\n    var collectNodesInRange = function (rng, predicate) {\n      if (rng.collapsed) {\n        return [];\n      } else {\n        var contents = rng.cloneContents();\n        var walker = new global$3(contents.firstChild, contents);\n        var elements = [];\n        var current = contents.firstChild;\n        do {\n          if (predicate(current)) {\n            elements.push(current);\n          }\n        } while (current = walker.next());\n        return elements;\n      }\n    };\n    var hasProtocol = function (url) {\n      return /^\\w+:/i.test(url);\n    };\n    var getHref = function (elm) {\n      var href = elm.getAttribute('data-mce-href');\n      return href ? href : elm.getAttribute('href');\n    };\n    var applyRelTargetRules = function (rel, isUnsafe) {\n      var rules = ['noopener'];\n      var rels = rel ? rel.split(/\\s+/) : [];\n      var toString = function (rels) {\n        return global$2.trim(rels.sort().join(' '));\n      };\n      var addTargetRules = function (rels) {\n        rels = removeTargetRules(rels);\n        return rels.length > 0 ? rels.concat(rules) : rules;\n      };\n      var removeTargetRules = function (rels) {\n        return rels.filter(function (val) {\n          return global$2.inArray(rules, val) === -1;\n        });\n      };\n      var newRels = isUnsafe ? addTargetRules(rels) : removeTargetRules(rels);\n      return newRels.length > 0 ? toString(newRels) : '';\n    };\n    var trimCaretContainers = function (text) {\n      return text.replace(/\\uFEFF/g, '');\n    };\n    var getAnchorElement = function (editor, selectedElm) {\n      selectedElm = selectedElm || editor.selection.getNode();\n      if (isImageFigure(selectedElm)) {\n        return editor.dom.select('a[href]', selectedElm)[0];\n      } else {\n        return editor.dom.getParent(selectedElm, 'a[href]');\n      }\n    };\n    var getAnchorText = function (selection, anchorElm) {\n      var text = anchorElm ? anchorElm.innerText || anchorElm.textContent : selection.getContent({ format: 'text' });\n      return trimCaretContainers(text);\n    };\n    var hasLinks = function (elements) {\n      return global$2.grep(elements, isLink).length > 0;\n    };\n    var hasLinksInSelection = function (rng) {\n      return collectNodesInRange(rng, isLink).length > 0;\n    };\n    var isOnlyTextSelected = function (editor) {\n      var inlineTextElements = editor.schema.getTextInlineElements();\n      var isElement = function (elm) {\n        return elm.nodeType === 1 && !isAnchor(elm) && !has(inlineTextElements, elm.nodeName.toLowerCase());\n      };\n      var elements = collectNodesInRange(editor.selection.getRng(), isElement);\n      return elements.length === 0;\n    };\n    var isImageFigure = function (elm) {\n      return elm && elm.nodeName === 'FIGURE' && /\\bimage\\b/i.test(elm.className);\n    };\n    var getLinkAttrs = function (data) {\n      return foldl([\n        'title',\n        'rel',\n        'class',\n        'target'\n      ], function (acc, key) {\n        data[key].each(function (value) {\n          acc[key] = value.length > 0 ? value : null;\n        });\n        return acc;\n      }, { href: data.href });\n    };\n    var handleExternalTargets = function (href, assumeExternalTargets) {\n      if ((assumeExternalTargets === 'http' || assumeExternalTargets === 'https') && !hasProtocol(href)) {\n        return assumeExternalTargets + '://' + href;\n      }\n      return href;\n    };\n    var applyLinkOverrides = function (editor, linkAttrs) {\n      var newLinkAttrs = __assign({}, linkAttrs);\n      if (!(getRelList(editor).length > 0) && allowUnsafeLinkTarget(editor) === false) {\n        var newRel = applyRelTargetRules(newLinkAttrs.rel, newLinkAttrs.target === '_blank');\n        newLinkAttrs.rel = newRel ? newRel : null;\n      }\n      if (Optional.from(newLinkAttrs.target).isNone() && getTargetList(editor) === false) {\n        newLinkAttrs.target = getDefaultLinkTarget(editor);\n      }\n      newLinkAttrs.href = handleExternalTargets(newLinkAttrs.href, assumeExternalTargets(editor));\n      return newLinkAttrs;\n    };\n    var updateLink = function (editor, anchorElm, text, linkAttrs) {\n      text.each(function (text) {\n        if (anchorElm.hasOwnProperty('innerText')) {\n          anchorElm.innerText = text;\n        } else {\n          anchorElm.textContent = text;\n        }\n      });\n      editor.dom.setAttribs(anchorElm, linkAttrs);\n      editor.selection.select(anchorElm);\n    };\n    var createLink = function (editor, selectedElm, text, linkAttrs) {\n      if (isImageFigure(selectedElm)) {\n        linkImageFigure(editor, selectedElm, linkAttrs);\n      } else {\n        text.fold(function () {\n          editor.execCommand('mceInsertLink', false, linkAttrs);\n        }, function (text) {\n          editor.insertContent(editor.dom.createHTML('a', linkAttrs, editor.dom.encode(text)));\n        });\n      }\n    };\n    var linkDomMutation = function (editor, attachState, data) {\n      var selectedElm = editor.selection.getNode();\n      var anchorElm = getAnchorElement(editor, selectedElm);\n      var linkAttrs = applyLinkOverrides(editor, getLinkAttrs(data));\n      editor.undoManager.transact(function () {\n        if (data.href === attachState.href) {\n          attachState.attach();\n        }\n        if (anchorElm) {\n          editor.focus();\n          updateLink(editor, anchorElm, data.text, linkAttrs);\n        } else {\n          createLink(editor, selectedElm, data.text, linkAttrs);\n        }\n      });\n    };\n    var unlinkSelection = function (editor) {\n      var dom = editor.dom, selection = editor.selection;\n      var bookmark = selection.getBookmark();\n      var rng = selection.getRng().cloneRange();\n      var startAnchorElm = dom.getParent(rng.startContainer, 'a[href]', editor.getBody());\n      var endAnchorElm = dom.getParent(rng.endContainer, 'a[href]', editor.getBody());\n      if (startAnchorElm) {\n        rng.setStartBefore(startAnchorElm);\n      }\n      if (endAnchorElm) {\n        rng.setEndAfter(endAnchorElm);\n      }\n      selection.setRng(rng);\n      editor.execCommand('unlink');\n      selection.moveToBookmark(bookmark);\n    };\n    var unlinkDomMutation = function (editor) {\n      editor.undoManager.transact(function () {\n        var node = editor.selection.getNode();\n        if (isImageFigure(node)) {\n          unlinkImageFigure(editor, node);\n        } else {\n          unlinkSelection(editor);\n        }\n        editor.focus();\n      });\n    };\n    var unwrapOptions = function (data) {\n      var cls = data.class, href = data.href, rel = data.rel, target = data.target, text = data.text, title = data.title;\n      return filter({\n        class: cls.getOrNull(),\n        href: href,\n        rel: rel.getOrNull(),\n        target: target.getOrNull(),\n        text: text.getOrNull(),\n        title: title.getOrNull()\n      }, function (v, _k) {\n        return isNull(v) === false;\n      });\n    };\n    var link = function (editor, attachState, data) {\n      editor.hasPlugin('rtc', true) ? editor.execCommand('createlink', false, unwrapOptions(data)) : linkDomMutation(editor, attachState, data);\n    };\n    var unlink = function (editor) {\n      editor.hasPlugin('rtc', true) ? editor.execCommand('unlink') : unlinkDomMutation(editor);\n    };\n    var unlinkImageFigure = function (editor, fig) {\n      var img = editor.dom.select('img', fig)[0];\n      if (img) {\n        var a = editor.dom.getParents(img, 'a[href]', fig)[0];\n        if (a) {\n          a.parentNode.insertBefore(img, a);\n          editor.dom.remove(a);\n        }\n      }\n    };\n    var linkImageFigure = function (editor, fig, attrs) {\n      var img = editor.dom.select('img', fig)[0];\n      if (img) {\n        var a = editor.dom.create('a', attrs);\n        img.parentNode.insertBefore(a, img);\n        a.appendChild(img);\n      }\n    };\n\n    var isListGroup = function (item) {\n      return hasNonNullableKey(item, 'items');\n    };\n    var findTextByValue = function (value, catalog) {\n      return findMap(catalog, function (item) {\n        if (isListGroup(item)) {\n          return findTextByValue(value, item.items);\n        } else {\n          return someIf(item.value === value, item);\n        }\n      });\n    };\n    var getDelta = function (persistentText, fieldName, catalog, data) {\n      var value = data[fieldName];\n      var hasPersistentText = persistentText.length > 0;\n      return value !== undefined ? findTextByValue(value, catalog).map(function (i) {\n        return {\n          url: {\n            value: i.value,\n            meta: {\n              text: hasPersistentText ? persistentText : i.text,\n              attach: noop\n            }\n          },\n          text: hasPersistentText ? persistentText : i.text\n        };\n      }) : Optional.none();\n    };\n    var findCatalog = function (catalogs, fieldName) {\n      if (fieldName === 'link') {\n        return catalogs.link;\n      } else if (fieldName === 'anchor') {\n        return catalogs.anchor;\n      } else {\n        return Optional.none();\n      }\n    };\n    var init = function (initialData, linkCatalog) {\n      var persistentData = {\n        text: initialData.text,\n        title: initialData.title\n      };\n      var getTitleFromUrlChange = function (url) {\n        return someIf(persistentData.title.length <= 0, Optional.from(url.meta.title).getOr(''));\n      };\n      var getTextFromUrlChange = function (url) {\n        return someIf(persistentData.text.length <= 0, Optional.from(url.meta.text).getOr(url.value));\n      };\n      var onUrlChange = function (data) {\n        var text = getTextFromUrlChange(data.url);\n        var title = getTitleFromUrlChange(data.url);\n        if (text.isSome() || title.isSome()) {\n          return Optional.some(__assign(__assign({}, text.map(function (text) {\n            return { text: text };\n          }).getOr({})), title.map(function (title) {\n            return { title: title };\n          }).getOr({})));\n        } else {\n          return Optional.none();\n        }\n      };\n      var onCatalogChange = function (data, change) {\n        var catalog = findCatalog(linkCatalog, change.name).getOr([]);\n        return getDelta(persistentData.text, change.name, catalog, data);\n      };\n      var onChange = function (getData, change) {\n        var name = change.name;\n        if (name === 'url') {\n          return onUrlChange(getData());\n        } else if (contains([\n            'anchor',\n            'link'\n          ], name)) {\n          return onCatalogChange(getData(), change);\n        } else if (name === 'text' || name === 'title') {\n          persistentData[name] = getData()[name];\n          return Optional.none();\n        } else {\n          return Optional.none();\n        }\n      };\n      return { onChange: onChange };\n    };\n    var DialogChanges = {\n      init: init,\n      getDelta: getDelta\n    };\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.util.Delay');\n\n    var global$5 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n\n    var delayedConfirm = function (editor, message, callback) {\n      var rng = editor.selection.getRng();\n      global$4.setEditorTimeout(editor, function () {\n        editor.windowManager.confirm(message, function (state) {\n          editor.selection.setRng(rng);\n          callback(state);\n        });\n      });\n    };\n    var tryEmailTransform = function (data) {\n      var url = data.href;\n      var suggestMailTo = url.indexOf('@') > 0 && url.indexOf('/') === -1 && url.indexOf('mailto:') === -1;\n      return suggestMailTo ? Optional.some({\n        message: 'The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?',\n        preprocess: function (oldData) {\n          return __assign(__assign({}, oldData), { href: 'mailto:' + url });\n        }\n      }) : Optional.none();\n    };\n    var tryProtocolTransform = function (assumeExternalTargets, defaultLinkProtocol) {\n      return function (data) {\n        var url = data.href;\n        var suggestProtocol = assumeExternalTargets === 1 && !hasProtocol(url) || assumeExternalTargets === 0 && /^\\s*www(\\.|\\d\\.)/i.test(url);\n        return suggestProtocol ? Optional.some({\n          message: 'The URL you entered seems to be an external link. Do you want to add the required ' + defaultLinkProtocol + ':// prefix?',\n          preprocess: function (oldData) {\n            return __assign(__assign({}, oldData), { href: defaultLinkProtocol + '://' + url });\n          }\n        }) : Optional.none();\n      };\n    };\n    var preprocess = function (editor, data) {\n      return findMap([\n        tryEmailTransform,\n        tryProtocolTransform(assumeExternalTargets(editor), getDefaultLinkProtocol(editor))\n      ], function (f) {\n        return f(data);\n      }).fold(function () {\n        return global$5.resolve(data);\n      }, function (transform) {\n        return new global$5(function (callback) {\n          delayedConfirm(editor, transform.message, function (state) {\n            callback(state ? transform.preprocess(data) : data);\n          });\n        });\n      });\n    };\n    var DialogConfirms = { preprocess: preprocess };\n\n    var getAnchors = function (editor) {\n      var anchorNodes = editor.dom.select('a:not([href])');\n      var anchors = bind(anchorNodes, function (anchor) {\n        var id = anchor.name || anchor.id;\n        return id ? [{\n            text: id,\n            value: '#' + id\n          }] : [];\n      });\n      return anchors.length > 0 ? Optional.some([{\n          text: 'None',\n          value: ''\n        }].concat(anchors)) : Optional.none();\n    };\n    var AnchorListOptions = { getAnchors: getAnchors };\n\n    var getClasses = function (editor) {\n      var list = getLinkClassList(editor);\n      if (list.length > 0) {\n        return ListOptions.sanitize(list);\n      }\n      return Optional.none();\n    };\n    var ClassListOptions = { getClasses: getClasses };\n\n    var global$6 = tinymce.util.Tools.resolve('tinymce.util.XHR');\n\n    var parseJson = function (text) {\n      try {\n        return Optional.some(JSON.parse(text));\n      } catch (err) {\n        return Optional.none();\n      }\n    };\n    var getLinks = function (editor) {\n      var extractor = function (item) {\n        return editor.convertURL(item.value || item.url, 'href');\n      };\n      var linkList = getLinkList(editor);\n      return new global$5(function (callback) {\n        if (isString(linkList)) {\n          global$6.send({\n            url: linkList,\n            success: function (text) {\n              return callback(parseJson(text));\n            },\n            error: function (_) {\n              return callback(Optional.none());\n            }\n          });\n        } else if (isFunction(linkList)) {\n          linkList(function (output) {\n            return callback(Optional.some(output));\n          });\n        } else {\n          callback(Optional.from(linkList));\n        }\n      }).then(function (optItems) {\n        return optItems.bind(ListOptions.sanitizeWith(extractor)).map(function (items) {\n          if (items.length > 0) {\n            var noneItem = [{\n                text: 'None',\n                value: ''\n              }];\n            return noneItem.concat(items);\n          } else {\n            return items;\n          }\n        });\n      });\n    };\n    var LinkListOptions = { getLinks: getLinks };\n\n    var getRels = function (editor, initialTarget) {\n      var list = getRelList(editor);\n      if (list.length > 0) {\n        var isTargetBlank_1 = initialTarget.is('_blank');\n        var enforceSafe = allowUnsafeLinkTarget(editor) === false;\n        var safeRelExtractor = function (item) {\n          return applyRelTargetRules(ListOptions.getValue(item), isTargetBlank_1);\n        };\n        var sanitizer = enforceSafe ? ListOptions.sanitizeWith(safeRelExtractor) : ListOptions.sanitize;\n        return sanitizer(list);\n      }\n      return Optional.none();\n    };\n    var RelOptions = { getRels: getRels };\n\n    var fallbacks = [\n      {\n        text: 'Current window',\n        value: ''\n      },\n      {\n        text: 'New window',\n        value: '_blank'\n      }\n    ];\n    var getTargets = function (editor) {\n      var list = getTargetList(editor);\n      if (isArray(list)) {\n        return ListOptions.sanitize(list).orThunk(function () {\n          return Optional.some(fallbacks);\n        });\n      } else if (list === false) {\n        return Optional.none();\n      }\n      return Optional.some(fallbacks);\n    };\n    var TargetOptions = { getTargets: getTargets };\n\n    var nonEmptyAttr = function (dom, elem, name) {\n      var val = dom.getAttrib(elem, name);\n      return val !== null && val.length > 0 ? Optional.some(val) : Optional.none();\n    };\n    var extractFromAnchor = function (editor, anchor) {\n      var dom = editor.dom;\n      var onlyText = isOnlyTextSelected(editor);\n      var text = onlyText ? Optional.some(getAnchorText(editor.selection, anchor)) : Optional.none();\n      var url = anchor ? Optional.some(dom.getAttrib(anchor, 'href')) : Optional.none();\n      var target = anchor ? Optional.from(dom.getAttrib(anchor, 'target')) : Optional.none();\n      var rel = nonEmptyAttr(dom, anchor, 'rel');\n      var linkClass = nonEmptyAttr(dom, anchor, 'class');\n      var title = nonEmptyAttr(dom, anchor, 'title');\n      return {\n        url: url,\n        text: text,\n        title: title,\n        target: target,\n        rel: rel,\n        linkClass: linkClass\n      };\n    };\n    var collect = function (editor, linkNode) {\n      return LinkListOptions.getLinks(editor).then(function (links) {\n        var anchor = extractFromAnchor(editor, linkNode);\n        return {\n          anchor: anchor,\n          catalogs: {\n            targets: TargetOptions.getTargets(editor),\n            rels: RelOptions.getRels(editor, anchor.target),\n            classes: ClassListOptions.getClasses(editor),\n            anchor: AnchorListOptions.getAnchors(editor),\n            link: links\n          },\n          optNode: Optional.from(linkNode),\n          flags: { titleEnabled: shouldShowLinkTitle(editor) }\n        };\n      });\n    };\n    var DialogInfo = { collect: collect };\n\n    var handleSubmit = function (editor, info) {\n      return function (api) {\n        var data = api.getData();\n        if (!data.url.value) {\n          unlink(editor);\n          api.close();\n          return;\n        }\n        var getChangedValue = function (key) {\n          return Optional.from(data[key]).filter(function (value) {\n            return !info.anchor[key].is(value);\n          });\n        };\n        var changedData = {\n          href: data.url.value,\n          text: getChangedValue('text'),\n          target: getChangedValue('target'),\n          rel: getChangedValue('rel'),\n          class: getChangedValue('linkClass'),\n          title: getChangedValue('title')\n        };\n        var attachState = {\n          href: data.url.value,\n          attach: data.url.meta !== undefined && data.url.meta.attach ? data.url.meta.attach : noop\n        };\n        DialogConfirms.preprocess(editor, changedData).then(function (pData) {\n          link(editor, attachState, pData);\n        });\n        api.close();\n      };\n    };\n    var collectData = function (editor) {\n      var anchorNode = getAnchorElement(editor);\n      return DialogInfo.collect(editor, anchorNode);\n    };\n    var getInitialData = function (info, defaultTarget) {\n      var anchor = info.anchor;\n      var url = anchor.url.getOr('');\n      return {\n        url: {\n          value: url,\n          meta: { original: { value: url } }\n        },\n        text: anchor.text.getOr(''),\n        title: anchor.title.getOr(''),\n        anchor: url,\n        link: url,\n        rel: anchor.rel.getOr(''),\n        target: anchor.target.or(defaultTarget).getOr(''),\n        linkClass: anchor.linkClass.getOr('')\n      };\n    };\n    var makeDialog = function (settings, onSubmit, editor) {\n      var urlInput = [{\n          name: 'url',\n          type: 'urlinput',\n          filetype: 'file',\n          label: 'URL'\n        }];\n      var displayText = settings.anchor.text.map(function () {\n        return {\n          name: 'text',\n          type: 'input',\n          label: 'Text to display'\n        };\n      }).toArray();\n      var titleText = settings.flags.titleEnabled ? [{\n          name: 'title',\n          type: 'input',\n          label: 'Title'\n        }] : [];\n      var defaultTarget = Optional.from(getDefaultLinkTarget(editor));\n      var initialData = getInitialData(settings, defaultTarget);\n      var catalogs = settings.catalogs;\n      var dialogDelta = DialogChanges.init(initialData, catalogs);\n      var body = {\n        type: 'panel',\n        items: flatten([\n          urlInput,\n          displayText,\n          titleText,\n          cat([\n            catalogs.anchor.map(ListOptions.createUi('anchor', 'Anchors')),\n            catalogs.rels.map(ListOptions.createUi('rel', 'Rel')),\n            catalogs.targets.map(ListOptions.createUi('target', 'Open link in...')),\n            catalogs.link.map(ListOptions.createUi('link', 'Link list')),\n            catalogs.classes.map(ListOptions.createUi('linkClass', 'Class'))\n          ])\n        ])\n      };\n      return {\n        title: 'Insert/Edit Link',\n        size: 'normal',\n        body: body,\n        buttons: [\n          {\n            type: 'cancel',\n            name: 'cancel',\n            text: 'Cancel'\n          },\n          {\n            type: 'submit',\n            name: 'save',\n            text: 'Save',\n            primary: true\n          }\n        ],\n        initialData: initialData,\n        onChange: function (api, _a) {\n          var name = _a.name;\n          dialogDelta.onChange(api.getData, { name: name }).each(function (newData) {\n            api.setData(newData);\n          });\n        },\n        onSubmit: onSubmit\n      };\n    };\n    var open = function (editor) {\n      var data = collectData(editor);\n      data.then(function (info) {\n        var onSubmit = handleSubmit(editor, info);\n        return makeDialog(info, onSubmit, editor);\n      }).then(function (spec) {\n        editor.windowManager.open(spec);\n      });\n    };\n\n    var appendClickRemove = function (link, evt) {\n      document.body.appendChild(link);\n      link.dispatchEvent(evt);\n      document.body.removeChild(link);\n    };\n    var open$1 = function (url) {\n      var link = document.createElement('a');\n      link.target = '_blank';\n      link.href = url;\n      link.rel = 'noreferrer noopener';\n      var evt = document.createEvent('MouseEvents');\n      evt.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n      appendClickRemove(link, evt);\n    };\n\n    var getLink = function (editor, elm) {\n      return editor.dom.getParent(elm, 'a[href]');\n    };\n    var getSelectedLink = function (editor) {\n      return getLink(editor, editor.selection.getStart());\n    };\n    var hasOnlyAltModifier = function (e) {\n      return e.altKey === true && e.shiftKey === false && e.ctrlKey === false && e.metaKey === false;\n    };\n    var gotoLink = function (editor, a) {\n      if (a) {\n        var href = getHref(a);\n        if (/^#/.test(href)) {\n          var targetEl = editor.$(href);\n          if (targetEl.length) {\n            editor.selection.scrollIntoView(targetEl[0], true);\n          }\n        } else {\n          open$1(a.href);\n        }\n      }\n    };\n    var openDialog = function (editor) {\n      return function () {\n        open(editor);\n      };\n    };\n    var gotoSelectedLink = function (editor) {\n      return function () {\n        gotoLink(editor, getSelectedLink(editor));\n      };\n    };\n    var setupGotoLinks = function (editor) {\n      editor.on('click', function (e) {\n        var link = getLink(editor, e.target);\n        if (link && global$1.metaKeyPressed(e)) {\n          e.preventDefault();\n          gotoLink(editor, link);\n        }\n      });\n      editor.on('keydown', function (e) {\n        var link = getSelectedLink(editor);\n        if (link && e.keyCode === 13 && hasOnlyAltModifier(e)) {\n          e.preventDefault();\n          gotoLink(editor, link);\n        }\n      });\n    };\n    var toggleState = function (editor, toggler) {\n      editor.on('NodeChange', toggler);\n      return function () {\n        return editor.off('NodeChange', toggler);\n      };\n    };\n    var toggleActiveState = function (editor) {\n      return function (api) {\n        return toggleState(editor, function () {\n          api.setActive(!editor.mode.isReadOnly() && getAnchorElement(editor, editor.selection.getNode()) !== null);\n        });\n      };\n    };\n    var toggleEnabledState = function (editor) {\n      return function (api) {\n        var updateState = function () {\n          return api.setDisabled(getAnchorElement(editor, editor.selection.getNode()) === null);\n        };\n        updateState();\n        return toggleState(editor, updateState);\n      };\n    };\n    var toggleUnlinkState = function (editor) {\n      return function (api) {\n        var hasLinks$1 = function (parents) {\n          return hasLinks(parents) || hasLinksInSelection(editor.selection.getRng());\n        };\n        var parents = editor.dom.getParents(editor.selection.getStart());\n        api.setDisabled(!hasLinks$1(parents));\n        return toggleState(editor, function (e) {\n          return api.setDisabled(!hasLinks$1(e.parents));\n        });\n      };\n    };\n\n    var register = function (editor) {\n      editor.addCommand('mceLink', function () {\n        if (useQuickLink(editor)) {\n          editor.fire('contexttoolbar-show', { toolbarKey: 'quicklink' });\n        } else {\n          openDialog(editor)();\n        }\n      });\n    };\n\n    var setup = function (editor) {\n      editor.addShortcut('Meta+K', '', function () {\n        editor.execCommand('mceLink');\n      });\n    };\n\n    var setupButtons = function (editor) {\n      editor.ui.registry.addToggleButton('link', {\n        icon: 'link',\n        tooltip: 'Insert/edit link',\n        onAction: openDialog(editor),\n        onSetup: toggleActiveState(editor)\n      });\n      editor.ui.registry.addButton('openlink', {\n        icon: 'new-tab',\n        tooltip: 'Open link',\n        onAction: gotoSelectedLink(editor),\n        onSetup: toggleEnabledState(editor)\n      });\n      editor.ui.registry.addButton('unlink', {\n        icon: 'unlink',\n        tooltip: 'Remove link',\n        onAction: function () {\n          return unlink(editor);\n        },\n        onSetup: toggleUnlinkState(editor)\n      });\n    };\n    var setupMenuItems = function (editor) {\n      editor.ui.registry.addMenuItem('openlink', {\n        text: 'Open link',\n        icon: 'new-tab',\n        onAction: gotoSelectedLink(editor),\n        onSetup: toggleEnabledState(editor)\n      });\n      editor.ui.registry.addMenuItem('link', {\n        icon: 'link',\n        text: 'Link...',\n        shortcut: 'Meta+K',\n        onAction: openDialog(editor)\n      });\n      editor.ui.registry.addMenuItem('unlink', {\n        icon: 'unlink',\n        text: 'Remove link',\n        onAction: function () {\n          return unlink(editor);\n        },\n        onSetup: toggleUnlinkState(editor)\n      });\n    };\n    var setupContextMenu = function (editor) {\n      var inLink = 'link unlink openlink';\n      var noLink = 'link';\n      editor.ui.registry.addContextMenu('link', {\n        update: function (element) {\n          return hasLinks(editor.dom.getParents(element, 'a')) ? inLink : noLink;\n        }\n      });\n    };\n    var setupContextToolbars = function (editor) {\n      var collapseSelectionToEnd = function (editor) {\n        editor.selection.collapse(false);\n      };\n      var onSetupLink = function (buttonApi) {\n        var node = editor.selection.getNode();\n        buttonApi.setDisabled(!getAnchorElement(editor, node));\n        return noop;\n      };\n      editor.ui.registry.addContextForm('quicklink', {\n        launch: {\n          type: 'contextformtogglebutton',\n          icon: 'link',\n          tooltip: 'Link',\n          onSetup: toggleActiveState(editor)\n        },\n        label: 'Link',\n        predicate: function (node) {\n          return !!getAnchorElement(editor, node) && hasContextToolbar(editor);\n        },\n        initValue: function () {\n          var elm = getAnchorElement(editor);\n          return !!elm ? getHref(elm) : '';\n        },\n        commands: [\n          {\n            type: 'contextformtogglebutton',\n            icon: 'link',\n            tooltip: 'Link',\n            primary: true,\n            onSetup: function (buttonApi) {\n              var node = editor.selection.getNode();\n              buttonApi.setActive(!!getAnchorElement(editor, node));\n              return toggleActiveState(editor)(buttonApi);\n            },\n            onAction: function (formApi) {\n              var anchor = getAnchorElement(editor);\n              var value = formApi.getValue();\n              if (!anchor) {\n                var attachState = {\n                  href: value,\n                  attach: noop\n                };\n                var onlyText = isOnlyTextSelected(editor);\n                var text = onlyText ? Optional.some(getAnchorText(editor.selection, anchor)).filter(function (t) {\n                  return t.length > 0;\n                }).or(Optional.from(value)) : Optional.none();\n                link(editor, attachState, {\n                  href: value,\n                  text: text,\n                  title: Optional.none(),\n                  rel: Optional.none(),\n                  target: Optional.none(),\n                  class: Optional.none()\n                });\n                formApi.hide();\n              } else {\n                editor.undoManager.transact(function () {\n                  editor.dom.setAttrib(anchor, 'href', value);\n                  collapseSelectionToEnd(editor);\n                  formApi.hide();\n                });\n              }\n            }\n          },\n          {\n            type: 'contextformbutton',\n            icon: 'unlink',\n            tooltip: 'Remove link',\n            onSetup: onSetupLink,\n            onAction: function (formApi) {\n              unlink(editor);\n              formApi.hide();\n            }\n          },\n          {\n            type: 'contextformbutton',\n            icon: 'new-tab',\n            tooltip: 'Open link',\n            onSetup: onSetupLink,\n            onAction: function (formApi) {\n              gotoSelectedLink(editor)();\n              formApi.hide();\n            }\n          }\n        ]\n      });\n    };\n\n    function Plugin () {\n      global.add('link', function (editor) {\n        setupButtons(editor);\n        setupMenuItems(editor);\n        setupContextMenu(editor);\n        setupContextToolbars(editor);\n        setupGotoLinks(editor);\n        register(editor);\n        setup(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]},"metadata":{},"sourceType":"script"}