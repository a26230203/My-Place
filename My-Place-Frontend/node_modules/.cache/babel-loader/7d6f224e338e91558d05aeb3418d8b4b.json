{"ast":null,"code":"/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.8.2 (2021-06-23)\n */\n(function () {\n  'use strict';\n\n  var Cell = function (initial) {\n    var value = initial;\n\n    var get = function () {\n      return value;\n    };\n\n    var set = function (v) {\n      value = v;\n    };\n\n    return {\n      get: get,\n      set: set\n    };\n  };\n\n  var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n  var hasProPlugin = function (editor) {\n    if (editor.hasPlugin('tinymcespellchecker', true)) {\n      if (typeof window.console !== 'undefined' && window.console.log) {\n        window.console.log('Spell Checker Pro is incompatible with Spell Checker plugin! ' + 'Remove \\'spellchecker\\' from the \\'plugins\\' option.');\n      }\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  var hasOwnProperty = Object.hasOwnProperty;\n\n  var isEmpty = function (r) {\n    for (var x in r) {\n      if (hasOwnProperty.call(r, x)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n  var global$2 = tinymce.util.Tools.resolve('tinymce.util.URI');\n  var global$3 = tinymce.util.Tools.resolve('tinymce.util.XHR');\n\n  var fireSpellcheckStart = function (editor) {\n    return editor.fire('SpellcheckStart');\n  };\n\n  var fireSpellcheckEnd = function (editor) {\n    return editor.fire('SpellcheckEnd');\n  };\n\n  var getLanguages = function (editor) {\n    var defaultLanguages = 'English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv';\n    return editor.getParam('spellchecker_languages', defaultLanguages);\n  };\n\n  var getLanguage = function (editor) {\n    var defaultLanguage = editor.getParam('language', 'en');\n    return editor.getParam('spellchecker_language', defaultLanguage);\n  };\n\n  var getRpcUrl = function (editor) {\n    return editor.getParam('spellchecker_rpc_url');\n  };\n\n  var getSpellcheckerCallback = function (editor) {\n    return editor.getParam('spellchecker_callback');\n  };\n\n  var getSpellcheckerWordcharPattern = function (editor) {\n    var defaultPattern = new RegExp('[^' + '\\\\s!\"#$%&()*+,-./:;<=>?@[\\\\]^_{|}`' + '\\xA7\\xA9\\xAB\\xAE\\xB1\\xB6\\xB7\\xB8\\xBB' + '\\xBC\\xBD\\xBE\\xBF\\xD7\\xF7\\xA4\\u201D\\u201C\\u201E\\xA0\\u2002\\u2003\\u2009' + ']+', 'g');\n    return editor.getParam('spellchecker_wordchar_pattern', defaultPattern);\n  };\n\n  var isContentEditableFalse = function (node) {\n    return node && node.nodeType === 1 && node.contentEditable === 'false';\n  };\n\n  var DomTextMatcher = function (node, editor) {\n    var m,\n        matches = [];\n    var dom = editor.dom;\n    var blockElementsMap = editor.schema.getBlockElements();\n    var hiddenTextElementsMap = editor.schema.getWhiteSpaceElements();\n    var shortEndedElementsMap = editor.schema.getShortEndedElements();\n\n    var createMatch = function (m, data) {\n      if (!m[0]) {\n        throw new Error('findAndReplaceDOMText cannot handle zero-length matches');\n      }\n\n      return {\n        start: m.index,\n        end: m.index + m[0].length,\n        text: m[0],\n        data: data\n      };\n    };\n\n    var getText = function (node) {\n      var txt;\n\n      if (node.nodeType === 3) {\n        return node.data;\n      }\n\n      if (hiddenTextElementsMap[node.nodeName] && !blockElementsMap[node.nodeName]) {\n        return '';\n      }\n\n      if (isContentEditableFalse(node)) {\n        return '\\n';\n      }\n\n      txt = '';\n\n      if (blockElementsMap[node.nodeName] || shortEndedElementsMap[node.nodeName]) {\n        txt += '\\n';\n      }\n\n      if (node = node.firstChild) {\n        do {\n          txt += getText(node);\n        } while (node = node.nextSibling);\n      }\n\n      return txt;\n    };\n\n    var stepThroughMatches = function (node, matches, replaceFn) {\n      var startNode,\n          endNode,\n          startNodeIndex,\n          endNodeIndex,\n          innerNodes = [],\n          atIndex = 0,\n          curNode = node,\n          matchLocation,\n          matchIndex = 0;\n      matches = matches.slice(0);\n      matches.sort(function (a, b) {\n        return a.start - b.start;\n      });\n      matchLocation = matches.shift();\n\n      out: while (true) {\n        if (blockElementsMap[curNode.nodeName] || shortEndedElementsMap[curNode.nodeName] || isContentEditableFalse(curNode)) {\n          atIndex++;\n        }\n\n        if (curNode.nodeType === 3) {\n          if (!endNode && curNode.length + atIndex >= matchLocation.end) {\n            endNode = curNode;\n            endNodeIndex = matchLocation.end - atIndex;\n          } else if (startNode) {\n            innerNodes.push(curNode);\n          }\n\n          if (!startNode && curNode.length + atIndex > matchLocation.start) {\n            startNode = curNode;\n            startNodeIndex = matchLocation.start - atIndex;\n          }\n\n          atIndex += curNode.length;\n        }\n\n        if (startNode && endNode) {\n          curNode = replaceFn({\n            startNode: startNode,\n            startNodeIndex: startNodeIndex,\n            endNode: endNode,\n            endNodeIndex: endNodeIndex,\n            innerNodes: innerNodes,\n            match: matchLocation.text,\n            matchIndex: matchIndex\n          });\n          atIndex -= endNode.length - endNodeIndex;\n          startNode = null;\n          endNode = null;\n          innerNodes = [];\n          matchLocation = matches.shift();\n          matchIndex++;\n\n          if (!matchLocation) {\n            break;\n          }\n        } else if ((!hiddenTextElementsMap[curNode.nodeName] || blockElementsMap[curNode.nodeName]) && curNode.firstChild) {\n          if (!isContentEditableFalse(curNode)) {\n            curNode = curNode.firstChild;\n            continue;\n          }\n        } else if (curNode.nextSibling) {\n          curNode = curNode.nextSibling;\n          continue;\n        }\n\n        while (true) {\n          if (curNode.nextSibling) {\n            curNode = curNode.nextSibling;\n            break;\n          } else if (curNode.parentNode !== node) {\n            curNode = curNode.parentNode;\n          } else {\n            break out;\n          }\n        }\n      }\n    };\n\n    var genReplacer = function (callback) {\n      var makeReplacementNode = function (fill, matchIndex) {\n        var match = matches[matchIndex];\n\n        if (!match.stencil) {\n          match.stencil = callback(match);\n        }\n\n        var clone = match.stencil.cloneNode(false);\n        clone.setAttribute('data-mce-index', matchIndex);\n\n        if (fill) {\n          clone.appendChild(dom.doc.createTextNode(fill));\n        }\n\n        return clone;\n      };\n\n      return function (range) {\n        var before;\n        var after;\n        var parentNode;\n        var startNode = range.startNode;\n        var endNode = range.endNode;\n        var matchIndex = range.matchIndex;\n        var doc = dom.doc;\n\n        if (startNode === endNode) {\n          var node_1 = startNode;\n          parentNode = node_1.parentNode;\n\n          if (range.startNodeIndex > 0) {\n            before = doc.createTextNode(node_1.data.substring(0, range.startNodeIndex));\n            parentNode.insertBefore(before, node_1);\n          }\n\n          var el = makeReplacementNode(range.match, matchIndex);\n          parentNode.insertBefore(el, node_1);\n\n          if (range.endNodeIndex < node_1.length) {\n            after = doc.createTextNode(node_1.data.substring(range.endNodeIndex));\n            parentNode.insertBefore(after, node_1);\n          }\n\n          node_1.parentNode.removeChild(node_1);\n          return el;\n        }\n\n        before = doc.createTextNode(startNode.data.substring(0, range.startNodeIndex));\n        after = doc.createTextNode(endNode.data.substring(range.endNodeIndex));\n        var elA = makeReplacementNode(startNode.data.substring(range.startNodeIndex), matchIndex);\n\n        for (var i = 0, l = range.innerNodes.length; i < l; ++i) {\n          var innerNode = range.innerNodes[i];\n          var innerEl = makeReplacementNode(innerNode.data, matchIndex);\n          innerNode.parentNode.replaceChild(innerEl, innerNode);\n        }\n\n        var elB = makeReplacementNode(endNode.data.substring(0, range.endNodeIndex), matchIndex);\n        parentNode = startNode.parentNode;\n        parentNode.insertBefore(before, startNode);\n        parentNode.insertBefore(elA, startNode);\n        parentNode.removeChild(startNode);\n        parentNode = endNode.parentNode;\n        parentNode.insertBefore(elB, endNode);\n        parentNode.insertBefore(after, endNode);\n        parentNode.removeChild(endNode);\n        return elB;\n      };\n    };\n\n    var unwrapElement = function (element) {\n      var parentNode = element.parentNode;\n\n      while (element.childNodes.length > 0) {\n        parentNode.insertBefore(element.childNodes[0], element);\n      }\n\n      parentNode.removeChild(element);\n    };\n\n    var hasClass = function (elm) {\n      return elm.className.indexOf('mce-spellchecker-word') !== -1;\n    };\n\n    var getWrappersByIndex = function (index) {\n      var elements = node.getElementsByTagName('*'),\n          wrappers = [];\n      index = typeof index === 'number' ? '' + index : null;\n\n      for (var i = 0; i < elements.length; i++) {\n        var element = elements[i],\n            dataIndex = element.getAttribute('data-mce-index');\n\n        if (dataIndex !== null && dataIndex.length && hasClass(element)) {\n          if (dataIndex === index || index === null) {\n            wrappers.push(element);\n          }\n        }\n      }\n\n      return wrappers;\n    };\n\n    var indexOf = function (match) {\n      var i = matches.length;\n\n      while (i--) {\n        if (matches[i] === match) {\n          return i;\n        }\n      }\n\n      return -1;\n    };\n\n    function filter(callback) {\n      var filteredMatches = [];\n      each(function (match, i) {\n        if (callback(match, i)) {\n          filteredMatches.push(match);\n        }\n      });\n      matches = filteredMatches;\n      return this;\n    }\n\n    function each(callback) {\n      for (var i = 0, l = matches.length; i < l; i++) {\n        if (callback(matches[i], i) === false) {\n          break;\n        }\n      }\n\n      return this;\n    }\n\n    function wrap(callback) {\n      if (matches.length) {\n        stepThroughMatches(node, matches, genReplacer(callback));\n      }\n\n      return this;\n    }\n\n    function find(regex, data) {\n      if (text && regex.global) {\n        while (m = regex.exec(text)) {\n          matches.push(createMatch(m, data));\n        }\n      }\n\n      return this;\n    }\n\n    function unwrap(match) {\n      var i;\n      var elements = getWrappersByIndex(match ? indexOf(match) : null);\n      i = elements.length;\n\n      while (i--) {\n        unwrapElement(elements[i]);\n      }\n\n      return this;\n    }\n\n    var matchFromElement = function (element) {\n      return matches[element.getAttribute('data-mce-index')];\n    };\n\n    var elementFromMatch = function (match) {\n      return getWrappersByIndex(indexOf(match))[0];\n    };\n\n    function add(start, length, data) {\n      matches.push({\n        start: start,\n        end: start + length,\n        text: text.substr(start, length),\n        data: data\n      });\n      return this;\n    }\n\n    var rangeFromMatch = function (match) {\n      var wrappers = getWrappersByIndex(indexOf(match));\n      var rng = editor.dom.createRng();\n      rng.setStartBefore(wrappers[0]);\n      rng.setEndAfter(wrappers[wrappers.length - 1]);\n      return rng;\n    };\n\n    var replace = function (match, text) {\n      var rng = rangeFromMatch(match);\n      rng.deleteContents();\n\n      if (text.length > 0) {\n        rng.insertNode(editor.dom.doc.createTextNode(text));\n      }\n\n      return rng;\n    };\n\n    function reset() {\n      matches.splice(0, matches.length);\n      unwrap();\n      return this;\n    }\n\n    var text = getText(node);\n    return {\n      text: text,\n      matches: matches,\n      each: each,\n      filter: filter,\n      reset: reset,\n      matchFromElement: matchFromElement,\n      elementFromMatch: elementFromMatch,\n      find: find,\n      add: add,\n      wrap: wrap,\n      unwrap: unwrap,\n      replace: replace,\n      rangeFromMatch: rangeFromMatch,\n      indexOf: indexOf\n    };\n  };\n\n  var getTextMatcher = function (editor, textMatcherState) {\n    if (!textMatcherState.get()) {\n      var textMatcher = DomTextMatcher(editor.getBody(), editor);\n      textMatcherState.set(textMatcher);\n    }\n\n    return textMatcherState.get();\n  };\n\n  var defaultSpellcheckCallback = function (editor, pluginUrl, currentLanguageState) {\n    return function (method, text, doneCallback, errorCallback) {\n      var data = {\n        method: method,\n        lang: currentLanguageState.get()\n      };\n      var postData = '';\n      data[method === 'addToDictionary' ? 'word' : 'text'] = text;\n      global$1.each(data, function (value, key) {\n        if (postData) {\n          postData += '&';\n        }\n\n        postData += key + '=' + encodeURIComponent(value);\n      });\n      global$3.send({\n        url: new global$2(pluginUrl).toAbsolute(getRpcUrl(editor)),\n        type: 'post',\n        content_type: 'application/x-www-form-urlencoded',\n        data: postData,\n        success: function (result) {\n          var parseResult = JSON.parse(result);\n\n          if (!parseResult) {\n            var message = editor.translate('Server response wasn\\'t proper JSON.');\n            errorCallback(message);\n          } else if (parseResult.error) {\n            errorCallback(parseResult.error);\n          } else {\n            doneCallback(parseResult);\n          }\n        },\n        error: function () {\n          var message = editor.translate('The spelling service was not found: (') + getRpcUrl(editor) + editor.translate(')');\n          errorCallback(message);\n        }\n      });\n    };\n  };\n\n  var sendRpcCall = function (editor, pluginUrl, currentLanguageState, name, data, successCallback, errorCallback) {\n    var userSpellcheckCallback = getSpellcheckerCallback(editor);\n    var spellCheckCallback = userSpellcheckCallback ? userSpellcheckCallback : defaultSpellcheckCallback(editor, pluginUrl, currentLanguageState);\n    spellCheckCallback.call(editor.plugins.spellchecker, name, data, successCallback, errorCallback);\n  };\n\n  var spellcheck = function (editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState) {\n    if (finish(editor, startedState, textMatcherState)) {\n      return;\n    }\n\n    var errorCallback = function (message) {\n      editor.notificationManager.open({\n        text: message,\n        type: 'error'\n      });\n      editor.setProgressState(false);\n      finish(editor, startedState, textMatcherState);\n    };\n\n    var successCallback = function (data) {\n      markErrors(editor, startedState, textMatcherState, lastSuggestionsState, data);\n    };\n\n    editor.setProgressState(true);\n    sendRpcCall(editor, pluginUrl, currentLanguageState, 'spellcheck', getTextMatcher(editor, textMatcherState).text, successCallback, errorCallback);\n    editor.focus();\n  };\n\n  var checkIfFinished = function (editor, startedState, textMatcherState) {\n    if (!editor.dom.select('span.mce-spellchecker-word').length) {\n      finish(editor, startedState, textMatcherState);\n    }\n  };\n\n  var addToDictionary = function (editor, pluginUrl, startedState, textMatcherState, currentLanguageState, word, spans) {\n    editor.setProgressState(true);\n    sendRpcCall(editor, pluginUrl, currentLanguageState, 'addToDictionary', word, function () {\n      editor.setProgressState(false);\n      editor.dom.remove(spans, true);\n      checkIfFinished(editor, startedState, textMatcherState);\n    }, function (message) {\n      editor.notificationManager.open({\n        text: message,\n        type: 'error'\n      });\n      editor.setProgressState(false);\n    });\n  };\n\n  var ignoreWord = function (editor, startedState, textMatcherState, word, spans, all) {\n    editor.selection.collapse();\n\n    if (all) {\n      global$1.each(editor.dom.select('span.mce-spellchecker-word'), function (span) {\n        if (span.getAttribute('data-mce-word') === word) {\n          editor.dom.remove(span, true);\n        }\n      });\n    } else {\n      editor.dom.remove(spans, true);\n    }\n\n    checkIfFinished(editor, startedState, textMatcherState);\n  };\n\n  var finish = function (editor, startedState, textMatcherState) {\n    var bookmark = editor.selection.getBookmark();\n    getTextMatcher(editor, textMatcherState).reset();\n    editor.selection.moveToBookmark(bookmark);\n    textMatcherState.set(null);\n\n    if (startedState.get()) {\n      startedState.set(false);\n      fireSpellcheckEnd(editor);\n      return true;\n    }\n  };\n\n  var getElmIndex = function (elm) {\n    var value = elm.getAttribute('data-mce-index');\n\n    if (typeof value === 'number') {\n      return '' + value;\n    }\n\n    return value;\n  };\n\n  var findSpansByIndex = function (editor, index) {\n    var spans = [];\n    var nodes = global$1.toArray(editor.getBody().getElementsByTagName('span'));\n\n    if (nodes.length) {\n      for (var i = 0; i < nodes.length; i++) {\n        var nodeIndex = getElmIndex(nodes[i]);\n\n        if (nodeIndex === null || !nodeIndex.length) {\n          continue;\n        }\n\n        if (nodeIndex === index.toString()) {\n          spans.push(nodes[i]);\n        }\n      }\n    }\n\n    return spans;\n  };\n\n  var markErrors = function (editor, startedState, textMatcherState, lastSuggestionsState, data) {\n    var hasDictionarySupport = !!data.dictionary;\n    var suggestions = data.words;\n    editor.setProgressState(false);\n\n    if (isEmpty(suggestions)) {\n      var message = editor.translate('No misspellings found.');\n      editor.notificationManager.open({\n        text: message,\n        type: 'info'\n      });\n      startedState.set(false);\n      return;\n    }\n\n    lastSuggestionsState.set({\n      suggestions: suggestions,\n      hasDictionarySupport: hasDictionarySupport\n    });\n    var bookmark = editor.selection.getBookmark();\n    getTextMatcher(editor, textMatcherState).find(getSpellcheckerWordcharPattern(editor)).filter(function (match) {\n      return !!suggestions[match.text];\n    }).wrap(function (match) {\n      return editor.dom.create('span', {\n        'class': 'mce-spellchecker-word',\n        'aria-invalid': 'spelling',\n        'data-mce-bogus': 1,\n        'data-mce-word': match.text\n      });\n    });\n    editor.selection.moveToBookmark(bookmark);\n    startedState.set(true);\n    fireSpellcheckStart(editor);\n  };\n\n  var get = function (editor, startedState, lastSuggestionsState, textMatcherState, currentLanguageState, _url) {\n    var getWordCharPattern = function () {\n      return getSpellcheckerWordcharPattern(editor);\n    };\n\n    var markErrors$1 = function (data) {\n      markErrors(editor, startedState, textMatcherState, lastSuggestionsState, data);\n    };\n\n    return {\n      getTextMatcher: textMatcherState.get,\n      getWordCharPattern: getWordCharPattern,\n      markErrors: markErrors$1,\n      getLanguage: currentLanguageState.get\n    };\n  };\n\n  var register = function (editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState) {\n    editor.addCommand('mceSpellCheck', function () {\n      spellcheck(editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState);\n    });\n  };\n\n  var __assign = function () {\n    __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n\n      return t;\n    };\n\n    return __assign.apply(this, arguments);\n  };\n\n  var spellcheckerEvents = 'SpellcheckStart SpellcheckEnd';\n\n  var buildMenuItems = function (listName, languageValues) {\n    var items = [];\n    global$1.each(languageValues, function (languageValue) {\n      items.push({\n        selectable: true,\n        text: languageValue.name,\n        data: languageValue.value\n      });\n    });\n    return items;\n  };\n\n  var getItems = function (editor) {\n    return global$1.map(getLanguages(editor).split(','), function (langPair) {\n      var langPairs = langPair.split('=');\n      return {\n        name: langPairs[0],\n        value: langPairs[1]\n      };\n    });\n  };\n\n  var register$1 = function (editor, pluginUrl, startedState, textMatcherState, currentLanguageState, lastSuggestionsState) {\n    var languageMenuItems = buildMenuItems('Language', getItems(editor));\n\n    var startSpellchecking = function () {\n      spellcheck(editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState);\n    };\n\n    var buttonArgs = {\n      tooltip: 'Spellcheck',\n      onAction: startSpellchecking,\n      icon: 'spell-check',\n      onSetup: function (buttonApi) {\n        var setButtonState = function () {\n          buttonApi.setActive(startedState.get());\n        };\n\n        editor.on(spellcheckerEvents, setButtonState);\n        return function () {\n          editor.off(spellcheckerEvents, setButtonState);\n        };\n      }\n    };\n\n    var splitButtonArgs = __assign(__assign({}, buttonArgs), {\n      type: 'splitbutton',\n      select: function (value) {\n        return value === currentLanguageState.get();\n      },\n      fetch: function (callback) {\n        var items = global$1.map(languageMenuItems, function (languageItem) {\n          return {\n            type: 'choiceitem',\n            value: languageItem.data,\n            text: languageItem.text\n          };\n        });\n        callback(items);\n      },\n      onItemAction: function (splitButtonApi, value) {\n        currentLanguageState.set(value);\n      }\n    });\n\n    if (languageMenuItems.length > 1) {\n      editor.ui.registry.addSplitButton('spellchecker', splitButtonArgs);\n    } else {\n      editor.ui.registry.addToggleButton('spellchecker', buttonArgs);\n    }\n\n    editor.ui.registry.addToggleMenuItem('spellchecker', {\n      text: 'Spellcheck',\n      icon: 'spell-check',\n      onSetup: function (menuApi) {\n        menuApi.setActive(startedState.get());\n\n        var setMenuItemCheck = function () {\n          menuApi.setActive(startedState.get());\n        };\n\n        editor.on(spellcheckerEvents, setMenuItemCheck);\n        return function () {\n          editor.off(spellcheckerEvents, setMenuItemCheck);\n        };\n      },\n      onAction: startSpellchecking\n    });\n  };\n\n  var ignoreAll = true;\n\n  var getSuggestions = function (editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState, word, spans) {\n    var items = [];\n    var suggestions = lastSuggestionsState.get().suggestions[word];\n    global$1.each(suggestions, function (suggestion) {\n      items.push({\n        text: suggestion,\n        onAction: function () {\n          editor.insertContent(editor.dom.encode(suggestion));\n          editor.dom.remove(spans);\n          checkIfFinished(editor, startedState, textMatcherState);\n        }\n      });\n    });\n    var hasDictionarySupport = lastSuggestionsState.get().hasDictionarySupport;\n\n    if (hasDictionarySupport) {\n      items.push({\n        type: 'separator'\n      });\n      items.push({\n        text: 'Add to dictionary',\n        onAction: function () {\n          addToDictionary(editor, pluginUrl, startedState, textMatcherState, currentLanguageState, word, spans);\n        }\n      });\n    }\n\n    items.push.apply(items, [{\n      type: 'separator'\n    }, {\n      text: 'Ignore',\n      onAction: function () {\n        ignoreWord(editor, startedState, textMatcherState, word, spans);\n      }\n    }, {\n      text: 'Ignore all',\n      onAction: function () {\n        ignoreWord(editor, startedState, textMatcherState, word, spans, ignoreAll);\n      }\n    }]);\n    return items;\n  };\n\n  var setup = function (editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState) {\n    var update = function (element) {\n      var target = element;\n\n      if (target.className === 'mce-spellchecker-word') {\n        var spans = findSpansByIndex(editor, getElmIndex(target));\n\n        if (spans.length > 0) {\n          var rng = editor.dom.createRng();\n          rng.setStartBefore(spans[0]);\n          rng.setEndAfter(spans[spans.length - 1]);\n          editor.selection.setRng(rng);\n          return getSuggestions(editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState, target.getAttribute('data-mce-word'), spans);\n        }\n      } else {\n        return [];\n      }\n    };\n\n    editor.ui.registry.addContextMenu('spellchecker', {\n      update: update\n    });\n  };\n\n  function Plugin() {\n    global.add('spellchecker', function (editor, pluginUrl) {\n      if (hasProPlugin(editor) === false) {\n        var startedState = Cell(false);\n        var currentLanguageState = Cell(getLanguage(editor));\n        var textMatcherState = Cell(null);\n        var lastSuggestionsState = Cell(null);\n        register$1(editor, pluginUrl, startedState, textMatcherState, currentLanguageState, lastSuggestionsState);\n        setup(editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState);\n        register(editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState);\n        return get(editor, startedState, lastSuggestionsState, textMatcherState, currentLanguageState);\n      }\n    });\n  }\n\n  Plugin();\n})();","map":{"version":3,"sources":["/home/lin/phase5/My-Place-Frontend/my-place/node_modules/tinymce/plugins/spellchecker/plugin.js"],"names":["Cell","initial","value","get","set","v","global","tinymce","util","Tools","resolve","hasProPlugin","editor","hasPlugin","window","console","log","hasOwnProperty","Object","isEmpty","r","x","call","global$1","global$2","global$3","fireSpellcheckStart","fire","fireSpellcheckEnd","getLanguages","defaultLanguages","getParam","getLanguage","defaultLanguage","getRpcUrl","getSpellcheckerCallback","getSpellcheckerWordcharPattern","defaultPattern","RegExp","isContentEditableFalse","node","nodeType","contentEditable","DomTextMatcher","m","matches","dom","blockElementsMap","schema","getBlockElements","hiddenTextElementsMap","getWhiteSpaceElements","shortEndedElementsMap","getShortEndedElements","createMatch","data","Error","start","index","end","length","text","getText","txt","nodeName","firstChild","nextSibling","stepThroughMatches","replaceFn","startNode","endNode","startNodeIndex","endNodeIndex","innerNodes","atIndex","curNode","matchLocation","matchIndex","slice","sort","a","b","shift","out","push","match","parentNode","genReplacer","callback","makeReplacementNode","fill","stencil","clone","cloneNode","setAttribute","appendChild","doc","createTextNode","range","before","after","node_1","substring","insertBefore","el","removeChild","elA","i","l","innerNode","innerEl","replaceChild","elB","unwrapElement","element","childNodes","hasClass","elm","className","indexOf","getWrappersByIndex","elements","getElementsByTagName","wrappers","dataIndex","getAttribute","filter","filteredMatches","each","wrap","find","regex","exec","unwrap","matchFromElement","elementFromMatch","add","substr","rangeFromMatch","rng","createRng","setStartBefore","setEndAfter","replace","deleteContents","insertNode","reset","splice","getTextMatcher","textMatcherState","textMatcher","getBody","defaultSpellcheckCallback","pluginUrl","currentLanguageState","method","doneCallback","errorCallback","lang","postData","key","encodeURIComponent","send","url","toAbsolute","type","content_type","success","result","parseResult","JSON","parse","message","translate","error","sendRpcCall","name","successCallback","userSpellcheckCallback","spellCheckCallback","plugins","spellchecker","spellcheck","startedState","lastSuggestionsState","finish","notificationManager","open","setProgressState","markErrors","focus","checkIfFinished","select","addToDictionary","word","spans","remove","ignoreWord","all","selection","collapse","span","bookmark","getBookmark","moveToBookmark","getElmIndex","findSpansByIndex","nodes","toArray","nodeIndex","toString","hasDictionarySupport","dictionary","suggestions","words","create","_url","getWordCharPattern","markErrors$1","register","addCommand","__assign","assign","t","s","n","arguments","p","prototype","apply","spellcheckerEvents","buildMenuItems","listName","languageValues","items","languageValue","selectable","getItems","map","split","langPair","langPairs","register$1","languageMenuItems","startSpellchecking","buttonArgs","tooltip","onAction","icon","onSetup","buttonApi","setButtonState","setActive","on","off","splitButtonArgs","fetch","languageItem","onItemAction","splitButtonApi","ui","registry","addSplitButton","addToggleButton","addToggleMenuItem","menuApi","setMenuItemCheck","ignoreAll","getSuggestions","suggestion","insertContent","encode","setup","update","target","setRng","addContextMenu","Plugin"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.8.2 (2021-06-23)\n */\n(function () {\n    'use strict';\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      return {\n        get: get,\n        set: set\n      };\n    };\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var hasProPlugin = function (editor) {\n      if (editor.hasPlugin('tinymcespellchecker', true)) {\n        if (typeof window.console !== 'undefined' && window.console.log) {\n          window.console.log('Spell Checker Pro is incompatible with Spell Checker plugin! ' + 'Remove \\'spellchecker\\' from the \\'plugins\\' option.');\n        }\n        return true;\n      } else {\n        return false;\n      }\n    };\n\n    var hasOwnProperty = Object.hasOwnProperty;\n    var isEmpty = function (r) {\n      for (var x in r) {\n        if (hasOwnProperty.call(r, x)) {\n          return false;\n        }\n      }\n      return true;\n    };\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.util.URI');\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.util.XHR');\n\n    var fireSpellcheckStart = function (editor) {\n      return editor.fire('SpellcheckStart');\n    };\n    var fireSpellcheckEnd = function (editor) {\n      return editor.fire('SpellcheckEnd');\n    };\n\n    var getLanguages = function (editor) {\n      var defaultLanguages = 'English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv';\n      return editor.getParam('spellchecker_languages', defaultLanguages);\n    };\n    var getLanguage = function (editor) {\n      var defaultLanguage = editor.getParam('language', 'en');\n      return editor.getParam('spellchecker_language', defaultLanguage);\n    };\n    var getRpcUrl = function (editor) {\n      return editor.getParam('spellchecker_rpc_url');\n    };\n    var getSpellcheckerCallback = function (editor) {\n      return editor.getParam('spellchecker_callback');\n    };\n    var getSpellcheckerWordcharPattern = function (editor) {\n      var defaultPattern = new RegExp('[^' + '\\\\s!\"#$%&()*+,-./:;<=>?@[\\\\]^_{|}`' + '\\xA7\\xA9\\xAB\\xAE\\xB1\\xB6\\xB7\\xB8\\xBB' + '\\xBC\\xBD\\xBE\\xBF\\xD7\\xF7\\xA4\\u201D\\u201C\\u201E\\xA0\\u2002\\u2003\\u2009' + ']+', 'g');\n      return editor.getParam('spellchecker_wordchar_pattern', defaultPattern);\n    };\n\n    var isContentEditableFalse = function (node) {\n      return node && node.nodeType === 1 && node.contentEditable === 'false';\n    };\n    var DomTextMatcher = function (node, editor) {\n      var m, matches = [];\n      var dom = editor.dom;\n      var blockElementsMap = editor.schema.getBlockElements();\n      var hiddenTextElementsMap = editor.schema.getWhiteSpaceElements();\n      var shortEndedElementsMap = editor.schema.getShortEndedElements();\n      var createMatch = function (m, data) {\n        if (!m[0]) {\n          throw new Error('findAndReplaceDOMText cannot handle zero-length matches');\n        }\n        return {\n          start: m.index,\n          end: m.index + m[0].length,\n          text: m[0],\n          data: data\n        };\n      };\n      var getText = function (node) {\n        var txt;\n        if (node.nodeType === 3) {\n          return node.data;\n        }\n        if (hiddenTextElementsMap[node.nodeName] && !blockElementsMap[node.nodeName]) {\n          return '';\n        }\n        if (isContentEditableFalse(node)) {\n          return '\\n';\n        }\n        txt = '';\n        if (blockElementsMap[node.nodeName] || shortEndedElementsMap[node.nodeName]) {\n          txt += '\\n';\n        }\n        if (node = node.firstChild) {\n          do {\n            txt += getText(node);\n          } while (node = node.nextSibling);\n        }\n        return txt;\n      };\n      var stepThroughMatches = function (node, matches, replaceFn) {\n        var startNode, endNode, startNodeIndex, endNodeIndex, innerNodes = [], atIndex = 0, curNode = node, matchLocation, matchIndex = 0;\n        matches = matches.slice(0);\n        matches.sort(function (a, b) {\n          return a.start - b.start;\n        });\n        matchLocation = matches.shift();\n        out:\n          while (true) {\n            if (blockElementsMap[curNode.nodeName] || shortEndedElementsMap[curNode.nodeName] || isContentEditableFalse(curNode)) {\n              atIndex++;\n            }\n            if (curNode.nodeType === 3) {\n              if (!endNode && curNode.length + atIndex >= matchLocation.end) {\n                endNode = curNode;\n                endNodeIndex = matchLocation.end - atIndex;\n              } else if (startNode) {\n                innerNodes.push(curNode);\n              }\n              if (!startNode && curNode.length + atIndex > matchLocation.start) {\n                startNode = curNode;\n                startNodeIndex = matchLocation.start - atIndex;\n              }\n              atIndex += curNode.length;\n            }\n            if (startNode && endNode) {\n              curNode = replaceFn({\n                startNode: startNode,\n                startNodeIndex: startNodeIndex,\n                endNode: endNode,\n                endNodeIndex: endNodeIndex,\n                innerNodes: innerNodes,\n                match: matchLocation.text,\n                matchIndex: matchIndex\n              });\n              atIndex -= endNode.length - endNodeIndex;\n              startNode = null;\n              endNode = null;\n              innerNodes = [];\n              matchLocation = matches.shift();\n              matchIndex++;\n              if (!matchLocation) {\n                break;\n              }\n            } else if ((!hiddenTextElementsMap[curNode.nodeName] || blockElementsMap[curNode.nodeName]) && curNode.firstChild) {\n              if (!isContentEditableFalse(curNode)) {\n                curNode = curNode.firstChild;\n                continue;\n              }\n            } else if (curNode.nextSibling) {\n              curNode = curNode.nextSibling;\n              continue;\n            }\n            while (true) {\n              if (curNode.nextSibling) {\n                curNode = curNode.nextSibling;\n                break;\n              } else if (curNode.parentNode !== node) {\n                curNode = curNode.parentNode;\n              } else {\n                break out;\n              }\n            }\n          }\n      };\n      var genReplacer = function (callback) {\n        var makeReplacementNode = function (fill, matchIndex) {\n          var match = matches[matchIndex];\n          if (!match.stencil) {\n            match.stencil = callback(match);\n          }\n          var clone = match.stencil.cloneNode(false);\n          clone.setAttribute('data-mce-index', matchIndex);\n          if (fill) {\n            clone.appendChild(dom.doc.createTextNode(fill));\n          }\n          return clone;\n        };\n        return function (range) {\n          var before;\n          var after;\n          var parentNode;\n          var startNode = range.startNode;\n          var endNode = range.endNode;\n          var matchIndex = range.matchIndex;\n          var doc = dom.doc;\n          if (startNode === endNode) {\n            var node_1 = startNode;\n            parentNode = node_1.parentNode;\n            if (range.startNodeIndex > 0) {\n              before = doc.createTextNode(node_1.data.substring(0, range.startNodeIndex));\n              parentNode.insertBefore(before, node_1);\n            }\n            var el = makeReplacementNode(range.match, matchIndex);\n            parentNode.insertBefore(el, node_1);\n            if (range.endNodeIndex < node_1.length) {\n              after = doc.createTextNode(node_1.data.substring(range.endNodeIndex));\n              parentNode.insertBefore(after, node_1);\n            }\n            node_1.parentNode.removeChild(node_1);\n            return el;\n          }\n          before = doc.createTextNode(startNode.data.substring(0, range.startNodeIndex));\n          after = doc.createTextNode(endNode.data.substring(range.endNodeIndex));\n          var elA = makeReplacementNode(startNode.data.substring(range.startNodeIndex), matchIndex);\n          for (var i = 0, l = range.innerNodes.length; i < l; ++i) {\n            var innerNode = range.innerNodes[i];\n            var innerEl = makeReplacementNode(innerNode.data, matchIndex);\n            innerNode.parentNode.replaceChild(innerEl, innerNode);\n          }\n          var elB = makeReplacementNode(endNode.data.substring(0, range.endNodeIndex), matchIndex);\n          parentNode = startNode.parentNode;\n          parentNode.insertBefore(before, startNode);\n          parentNode.insertBefore(elA, startNode);\n          parentNode.removeChild(startNode);\n          parentNode = endNode.parentNode;\n          parentNode.insertBefore(elB, endNode);\n          parentNode.insertBefore(after, endNode);\n          parentNode.removeChild(endNode);\n          return elB;\n        };\n      };\n      var unwrapElement = function (element) {\n        var parentNode = element.parentNode;\n        while (element.childNodes.length > 0) {\n          parentNode.insertBefore(element.childNodes[0], element);\n        }\n        parentNode.removeChild(element);\n      };\n      var hasClass = function (elm) {\n        return elm.className.indexOf('mce-spellchecker-word') !== -1;\n      };\n      var getWrappersByIndex = function (index) {\n        var elements = node.getElementsByTagName('*'), wrappers = [];\n        index = typeof index === 'number' ? '' + index : null;\n        for (var i = 0; i < elements.length; i++) {\n          var element = elements[i], dataIndex = element.getAttribute('data-mce-index');\n          if (dataIndex !== null && dataIndex.length && hasClass(element)) {\n            if (dataIndex === index || index === null) {\n              wrappers.push(element);\n            }\n          }\n        }\n        return wrappers;\n      };\n      var indexOf = function (match) {\n        var i = matches.length;\n        while (i--) {\n          if (matches[i] === match) {\n            return i;\n          }\n        }\n        return -1;\n      };\n      function filter(callback) {\n        var filteredMatches = [];\n        each(function (match, i) {\n          if (callback(match, i)) {\n            filteredMatches.push(match);\n          }\n        });\n        matches = filteredMatches;\n        return this;\n      }\n      function each(callback) {\n        for (var i = 0, l = matches.length; i < l; i++) {\n          if (callback(matches[i], i) === false) {\n            break;\n          }\n        }\n        return this;\n      }\n      function wrap(callback) {\n        if (matches.length) {\n          stepThroughMatches(node, matches, genReplacer(callback));\n        }\n        return this;\n      }\n      function find(regex, data) {\n        if (text && regex.global) {\n          while (m = regex.exec(text)) {\n            matches.push(createMatch(m, data));\n          }\n        }\n        return this;\n      }\n      function unwrap(match) {\n        var i;\n        var elements = getWrappersByIndex(match ? indexOf(match) : null);\n        i = elements.length;\n        while (i--) {\n          unwrapElement(elements[i]);\n        }\n        return this;\n      }\n      var matchFromElement = function (element) {\n        return matches[element.getAttribute('data-mce-index')];\n      };\n      var elementFromMatch = function (match) {\n        return getWrappersByIndex(indexOf(match))[0];\n      };\n      function add(start, length, data) {\n        matches.push({\n          start: start,\n          end: start + length,\n          text: text.substr(start, length),\n          data: data\n        });\n        return this;\n      }\n      var rangeFromMatch = function (match) {\n        var wrappers = getWrappersByIndex(indexOf(match));\n        var rng = editor.dom.createRng();\n        rng.setStartBefore(wrappers[0]);\n        rng.setEndAfter(wrappers[wrappers.length - 1]);\n        return rng;\n      };\n      var replace = function (match, text) {\n        var rng = rangeFromMatch(match);\n        rng.deleteContents();\n        if (text.length > 0) {\n          rng.insertNode(editor.dom.doc.createTextNode(text));\n        }\n        return rng;\n      };\n      function reset() {\n        matches.splice(0, matches.length);\n        unwrap();\n        return this;\n      }\n      var text = getText(node);\n      return {\n        text: text,\n        matches: matches,\n        each: each,\n        filter: filter,\n        reset: reset,\n        matchFromElement: matchFromElement,\n        elementFromMatch: elementFromMatch,\n        find: find,\n        add: add,\n        wrap: wrap,\n        unwrap: unwrap,\n        replace: replace,\n        rangeFromMatch: rangeFromMatch,\n        indexOf: indexOf\n      };\n    };\n\n    var getTextMatcher = function (editor, textMatcherState) {\n      if (!textMatcherState.get()) {\n        var textMatcher = DomTextMatcher(editor.getBody(), editor);\n        textMatcherState.set(textMatcher);\n      }\n      return textMatcherState.get();\n    };\n    var defaultSpellcheckCallback = function (editor, pluginUrl, currentLanguageState) {\n      return function (method, text, doneCallback, errorCallback) {\n        var data = {\n          method: method,\n          lang: currentLanguageState.get()\n        };\n        var postData = '';\n        data[method === 'addToDictionary' ? 'word' : 'text'] = text;\n        global$1.each(data, function (value, key) {\n          if (postData) {\n            postData += '&';\n          }\n          postData += key + '=' + encodeURIComponent(value);\n        });\n        global$3.send({\n          url: new global$2(pluginUrl).toAbsolute(getRpcUrl(editor)),\n          type: 'post',\n          content_type: 'application/x-www-form-urlencoded',\n          data: postData,\n          success: function (result) {\n            var parseResult = JSON.parse(result);\n            if (!parseResult) {\n              var message = editor.translate('Server response wasn\\'t proper JSON.');\n              errorCallback(message);\n            } else if (parseResult.error) {\n              errorCallback(parseResult.error);\n            } else {\n              doneCallback(parseResult);\n            }\n          },\n          error: function () {\n            var message = editor.translate('The spelling service was not found: (') + getRpcUrl(editor) + editor.translate(')');\n            errorCallback(message);\n          }\n        });\n      };\n    };\n    var sendRpcCall = function (editor, pluginUrl, currentLanguageState, name, data, successCallback, errorCallback) {\n      var userSpellcheckCallback = getSpellcheckerCallback(editor);\n      var spellCheckCallback = userSpellcheckCallback ? userSpellcheckCallback : defaultSpellcheckCallback(editor, pluginUrl, currentLanguageState);\n      spellCheckCallback.call(editor.plugins.spellchecker, name, data, successCallback, errorCallback);\n    };\n    var spellcheck = function (editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState) {\n      if (finish(editor, startedState, textMatcherState)) {\n        return;\n      }\n      var errorCallback = function (message) {\n        editor.notificationManager.open({\n          text: message,\n          type: 'error'\n        });\n        editor.setProgressState(false);\n        finish(editor, startedState, textMatcherState);\n      };\n      var successCallback = function (data) {\n        markErrors(editor, startedState, textMatcherState, lastSuggestionsState, data);\n      };\n      editor.setProgressState(true);\n      sendRpcCall(editor, pluginUrl, currentLanguageState, 'spellcheck', getTextMatcher(editor, textMatcherState).text, successCallback, errorCallback);\n      editor.focus();\n    };\n    var checkIfFinished = function (editor, startedState, textMatcherState) {\n      if (!editor.dom.select('span.mce-spellchecker-word').length) {\n        finish(editor, startedState, textMatcherState);\n      }\n    };\n    var addToDictionary = function (editor, pluginUrl, startedState, textMatcherState, currentLanguageState, word, spans) {\n      editor.setProgressState(true);\n      sendRpcCall(editor, pluginUrl, currentLanguageState, 'addToDictionary', word, function () {\n        editor.setProgressState(false);\n        editor.dom.remove(spans, true);\n        checkIfFinished(editor, startedState, textMatcherState);\n      }, function (message) {\n        editor.notificationManager.open({\n          text: message,\n          type: 'error'\n        });\n        editor.setProgressState(false);\n      });\n    };\n    var ignoreWord = function (editor, startedState, textMatcherState, word, spans, all) {\n      editor.selection.collapse();\n      if (all) {\n        global$1.each(editor.dom.select('span.mce-spellchecker-word'), function (span) {\n          if (span.getAttribute('data-mce-word') === word) {\n            editor.dom.remove(span, true);\n          }\n        });\n      } else {\n        editor.dom.remove(spans, true);\n      }\n      checkIfFinished(editor, startedState, textMatcherState);\n    };\n    var finish = function (editor, startedState, textMatcherState) {\n      var bookmark = editor.selection.getBookmark();\n      getTextMatcher(editor, textMatcherState).reset();\n      editor.selection.moveToBookmark(bookmark);\n      textMatcherState.set(null);\n      if (startedState.get()) {\n        startedState.set(false);\n        fireSpellcheckEnd(editor);\n        return true;\n      }\n    };\n    var getElmIndex = function (elm) {\n      var value = elm.getAttribute('data-mce-index');\n      if (typeof value === 'number') {\n        return '' + value;\n      }\n      return value;\n    };\n    var findSpansByIndex = function (editor, index) {\n      var spans = [];\n      var nodes = global$1.toArray(editor.getBody().getElementsByTagName('span'));\n      if (nodes.length) {\n        for (var i = 0; i < nodes.length; i++) {\n          var nodeIndex = getElmIndex(nodes[i]);\n          if (nodeIndex === null || !nodeIndex.length) {\n            continue;\n          }\n          if (nodeIndex === index.toString()) {\n            spans.push(nodes[i]);\n          }\n        }\n      }\n      return spans;\n    };\n    var markErrors = function (editor, startedState, textMatcherState, lastSuggestionsState, data) {\n      var hasDictionarySupport = !!data.dictionary;\n      var suggestions = data.words;\n      editor.setProgressState(false);\n      if (isEmpty(suggestions)) {\n        var message = editor.translate('No misspellings found.');\n        editor.notificationManager.open({\n          text: message,\n          type: 'info'\n        });\n        startedState.set(false);\n        return;\n      }\n      lastSuggestionsState.set({\n        suggestions: suggestions,\n        hasDictionarySupport: hasDictionarySupport\n      });\n      var bookmark = editor.selection.getBookmark();\n      getTextMatcher(editor, textMatcherState).find(getSpellcheckerWordcharPattern(editor)).filter(function (match) {\n        return !!suggestions[match.text];\n      }).wrap(function (match) {\n        return editor.dom.create('span', {\n          'class': 'mce-spellchecker-word',\n          'aria-invalid': 'spelling',\n          'data-mce-bogus': 1,\n          'data-mce-word': match.text\n        });\n      });\n      editor.selection.moveToBookmark(bookmark);\n      startedState.set(true);\n      fireSpellcheckStart(editor);\n    };\n\n    var get = function (editor, startedState, lastSuggestionsState, textMatcherState, currentLanguageState, _url) {\n      var getWordCharPattern = function () {\n        return getSpellcheckerWordcharPattern(editor);\n      };\n      var markErrors$1 = function (data) {\n        markErrors(editor, startedState, textMatcherState, lastSuggestionsState, data);\n      };\n      return {\n        getTextMatcher: textMatcherState.get,\n        getWordCharPattern: getWordCharPattern,\n        markErrors: markErrors$1,\n        getLanguage: currentLanguageState.get\n      };\n    };\n\n    var register = function (editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState) {\n      editor.addCommand('mceSpellCheck', function () {\n        spellcheck(editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState);\n      });\n    };\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n\n    var spellcheckerEvents = 'SpellcheckStart SpellcheckEnd';\n    var buildMenuItems = function (listName, languageValues) {\n      var items = [];\n      global$1.each(languageValues, function (languageValue) {\n        items.push({\n          selectable: true,\n          text: languageValue.name,\n          data: languageValue.value\n        });\n      });\n      return items;\n    };\n    var getItems = function (editor) {\n      return global$1.map(getLanguages(editor).split(','), function (langPair) {\n        var langPairs = langPair.split('=');\n        return {\n          name: langPairs[0],\n          value: langPairs[1]\n        };\n      });\n    };\n    var register$1 = function (editor, pluginUrl, startedState, textMatcherState, currentLanguageState, lastSuggestionsState) {\n      var languageMenuItems = buildMenuItems('Language', getItems(editor));\n      var startSpellchecking = function () {\n        spellcheck(editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState);\n      };\n      var buttonArgs = {\n        tooltip: 'Spellcheck',\n        onAction: startSpellchecking,\n        icon: 'spell-check',\n        onSetup: function (buttonApi) {\n          var setButtonState = function () {\n            buttonApi.setActive(startedState.get());\n          };\n          editor.on(spellcheckerEvents, setButtonState);\n          return function () {\n            editor.off(spellcheckerEvents, setButtonState);\n          };\n        }\n      };\n      var splitButtonArgs = __assign(__assign({}, buttonArgs), {\n        type: 'splitbutton',\n        select: function (value) {\n          return value === currentLanguageState.get();\n        },\n        fetch: function (callback) {\n          var items = global$1.map(languageMenuItems, function (languageItem) {\n            return {\n              type: 'choiceitem',\n              value: languageItem.data,\n              text: languageItem.text\n            };\n          });\n          callback(items);\n        },\n        onItemAction: function (splitButtonApi, value) {\n          currentLanguageState.set(value);\n        }\n      });\n      if (languageMenuItems.length > 1) {\n        editor.ui.registry.addSplitButton('spellchecker', splitButtonArgs);\n      } else {\n        editor.ui.registry.addToggleButton('spellchecker', buttonArgs);\n      }\n      editor.ui.registry.addToggleMenuItem('spellchecker', {\n        text: 'Spellcheck',\n        icon: 'spell-check',\n        onSetup: function (menuApi) {\n          menuApi.setActive(startedState.get());\n          var setMenuItemCheck = function () {\n            menuApi.setActive(startedState.get());\n          };\n          editor.on(spellcheckerEvents, setMenuItemCheck);\n          return function () {\n            editor.off(spellcheckerEvents, setMenuItemCheck);\n          };\n        },\n        onAction: startSpellchecking\n      });\n    };\n\n    var ignoreAll = true;\n    var getSuggestions = function (editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState, word, spans) {\n      var items = [];\n      var suggestions = lastSuggestionsState.get().suggestions[word];\n      global$1.each(suggestions, function (suggestion) {\n        items.push({\n          text: suggestion,\n          onAction: function () {\n            editor.insertContent(editor.dom.encode(suggestion));\n            editor.dom.remove(spans);\n            checkIfFinished(editor, startedState, textMatcherState);\n          }\n        });\n      });\n      var hasDictionarySupport = lastSuggestionsState.get().hasDictionarySupport;\n      if (hasDictionarySupport) {\n        items.push({ type: 'separator' });\n        items.push({\n          text: 'Add to dictionary',\n          onAction: function () {\n            addToDictionary(editor, pluginUrl, startedState, textMatcherState, currentLanguageState, word, spans);\n          }\n        });\n      }\n      items.push.apply(items, [\n        { type: 'separator' },\n        {\n          text: 'Ignore',\n          onAction: function () {\n            ignoreWord(editor, startedState, textMatcherState, word, spans);\n          }\n        },\n        {\n          text: 'Ignore all',\n          onAction: function () {\n            ignoreWord(editor, startedState, textMatcherState, word, spans, ignoreAll);\n          }\n        }\n      ]);\n      return items;\n    };\n    var setup = function (editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState) {\n      var update = function (element) {\n        var target = element;\n        if (target.className === 'mce-spellchecker-word') {\n          var spans = findSpansByIndex(editor, getElmIndex(target));\n          if (spans.length > 0) {\n            var rng = editor.dom.createRng();\n            rng.setStartBefore(spans[0]);\n            rng.setEndAfter(spans[spans.length - 1]);\n            editor.selection.setRng(rng);\n            return getSuggestions(editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState, target.getAttribute('data-mce-word'), spans);\n          }\n        } else {\n          return [];\n        }\n      };\n      editor.ui.registry.addContextMenu('spellchecker', { update: update });\n    };\n\n    function Plugin () {\n      global.add('spellchecker', function (editor, pluginUrl) {\n        if (hasProPlugin(editor) === false) {\n          var startedState = Cell(false);\n          var currentLanguageState = Cell(getLanguage(editor));\n          var textMatcherState = Cell(null);\n          var lastSuggestionsState = Cell(null);\n          register$1(editor, pluginUrl, startedState, textMatcherState, currentLanguageState, lastSuggestionsState);\n          setup(editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState);\n          register(editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState);\n          return get(editor, startedState, lastSuggestionsState, textMatcherState, currentLanguageState);\n        }\n      });\n    }\n\n    Plugin();\n\n}());\n"]},"metadata":{},"sourceType":"script"}